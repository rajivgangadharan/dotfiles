{"version":3,"file":"background.js","mappings":"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Ae,EAKf,KAAAyB,eAAiB,EAKjB,KAAAC,YAAa,EAKb,KAAAC,eAAgB,CA8BlB,CAvBEC,WACE,MACuB,KAArB7jF,KAAKyjF,aACLzjF,KAAK4T,UAAY,GACjB5T,KAAKgiF,YAAc,GACnBhiF,KAAKiiF,aAAe,GACpBjiF,KAAKqiF,cACLriF,KAAKsiF,cACLtiF,KAAKuiF,YACLviF,KAAKwiF,YACLxiF,KAAK0jF,eAAiB,GACtB1jF,KAAK2jF,YACL3jF,KAAK4jF,aAET,CAIAE,QACE,MAAM/2D,EAAS,IAAIy2D,GAEnB,OADA57E,OAAOC,OAAOklB,EAAQ/sB,MACf+sB,CACT,EC3FK,MAAMg3D,GAAkB,CAC7B,SACA,UACA,YACA,QACA,UACA,UACA,SACA,OACA,WACA,WACA,WACA,UACA,UACA,SACA,WACA,UACA,WACA,WACA,WACA,WACA,UACA,UACA,WACA,SACA,SACA,UACA,YACA,YACA,UACA,WACA,WACA,WACA,UACA,WACA,SACA,OACA,QACA,WACA,UACA,OACA,UACA,UACA,SACA,SACA,WACA,YACA,SACA,WACA,WACA,WACA,UACA,OACA,UACA,YACA,WACA,WACA,UACA,YACA,OACA,SACA,WACA,YACA,YACA,YACA,YACA,SACA,QACA,YACA,WACA,SACA,UACA,SACA,SACA,WACA,QACA,SACA,YACA,YACA,YACA,YACA,YACA,OACA,UACA,SACA,SACA,QACA,YACA,SACA,QACA,UACA,QACA,WACA,UACA,YACA,QACA,YACA,YACA,SACA,WACA,YACA,UACA,QACA,OACA,OACA,OACA,MACA,OACA,YACA,QACA,YACA,QACA,UACA,UACA,YACA,QACA,QACA,YACA,WACA,SACA,QACA,QACA,WACA,WACA,UACA,WACA,SACA,OACA,QACA,QACA,QACA,YACA,QACA,WACA,UACA,WACA,WACA,OACA,WACA,SACA,SACA,WACA,QACA,YACA,QACA,WACA,YACA,YACA,WACA,YACA,YACA,SACA,YACA,YACA,SACA,UACA,UACA,WACA,OACA,QACA,QACA,QACA,UACA,WACA,UACA,WACA,QACA,SACA,WACA,QACA,YACA,UACA,QACA,QACA,SACA,WACA,SACA,YACA,SACA,UACA,WACA,YACA,UACA,YACA,UACA,SACA,UACA,UACA,UACA,SACA,SACA,WACA,OACA,YACA,UACA,QACA,SACA,SACA,SACA,UACA,UACA,YACA,YACA,UACA,SACA,UACA,YACA,YACA,WACA,QACA,YACA,QACA,QACA,WACA,YACA,WACA,WACA,UACA,WACA,UACA,YACA,UACA,YACA,WACA,WACA,WACA,SACA,UACA,YACA,WACA,SACA,WACA,WACA,YACA,WACA,YACA,WACA,YACA,YACA,YACA,YACA,SACA,UACA,QACA,QACA,UACA,SACA,UACA,SACA,WACA,WACA,UACA,SACA,WACA,QACA,SACA,UACA,YACA,SACA,UACA,YACA,YACA,WACA,WACA,YACA,UACA,WACA,QACA,YACA,YACA,UACA,QACA,YACA,YACA,YACA,YACA,WACA,WACA,UACA,UACA,QACA,QACA,WACA,QACA,OACA,WACA,YACA,YACA,WACA,OACA,QACA,WACA,WACA,QACA,QACA,YACA,UACA,WACA,QACA,SACA,UACA,SACA,UACA,UACA,UACA,SACA,UACA,OACA,QACA,QACA,SACA,UACA,UACA,QACA,SACA,UACA,SACA,YACA,WACA,QACA,MACA,SACA,YACA,SACA,YACA,UACA,QACA,QACA,OACA,QACA,QACA,SACA,YACA,SACA,WACA,SACA,UACA,WACA,UACA,UACA,YACA,YACA,YACA,SACA,WACA,QACA,OACA,WACA,OACA,SACA,YACA,UACA,SACA,SACA,UACA,YACA,WACA,YACA,YACA,SACA,QACA,SACA,WACA,YACA,YACA,WACA,UACA,YACA,WACA,UACA,UACA,WACA,QACA,WACA,YACA,SACA,YACA,SACA,SACA,WACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,SACA,SACA,WACA,SACA,UACA,WACA,QACA,WACA,UACA,OACA,QACA,QACA,SACA,QACA,QACA,SACA,UACA,SACA,QACA,OACA,OACA,SACA,WACA,SACA,SACA,WACA,YACA,YACA,WACA,SACA,SACA,YACA,WACA,WACA,UACA,YACA,WACA,WACA,YACA,UACA,UACA,WACA,YACA,WACA,WACA,YACA,WACA,WACA,YACA,WACA,WACA,YACA,WACA,YACA,SACA,WACA,WACA,YACA,WACA,QACA,WACA,YACA,SACA,QACA,UACA,QACA,UACA,SACA,WACA,QACA,SACA,UACA,SACA,SACA,YACA,UACA,QACA,UACA,WACA,QACA,SACA,WACA,SACA,UACA,YACA,UACA,QACA,WACA,SACA,SACA,SACA,WACA,QACA,WACA,WACA,SACA,SACA,UACA,WACA,WACA,SACA,YACA,UACA,SACA,WACA,SACA,UACA,SACA,UACA,QACA,WACA,UACA,WACA,SACA,UACA,SACA,OACA,YACA,UACA,YACA,SACA,WACA,YACA,UACA,WACA,YACA,WACA,OACA,YACA,SACA,QACA,QACA,QACA,SACA,SACA,QACA,OACA,QACA,OACA,YACA,WACA,YACA,UACA,UACA,SACA,SACA,UACA,UACA,UACA,QACA,OACA,QACA,UACA,YACA,YACA,QACA,YACA,YACA,QACA,WACA,YACA,SACA,UACA,SACA,QACA,QACA,UACA,QACA,QACA,WACA,QACA,QACA,UACA,UACA,WACA,SACA,OACA,WACA,QACA,WACA,UACA,WACA,OACA,OACA,WACA,WACA,UACA,OACA,SACA,UACA,QACA,SACA,YACA,QACA,QACA,UACA,SACA,QACA,QACA,WACA,UACA,WACA,WACA,OACA,SACA,UACA,SACA,SACA,UACA,UACA,YACA,OACA,SACA,SACA,QACA,OACA,MACA,UACA,OACA,UACA,SACA,UACA,WACA,QACA,WACA,WACA,WACA,QACA,UACA,SACA,SACA,QACA,OACA,YACA,YACA,OACA,YACA,SACA,QACA,SACA,UACA,WACA,UACA,QACA,QACA,QACA,SACA,UACA,WACA,YACA,OACA,YACA,WACA,SACA,QACA,OACA,SACA,WACA,SACA,SACA,WACA,SACA,WACA,YACA,YACA,SACA,SACA,QACA,SACA,UACA,OACA,SACA,SACA,WACA,YACA,UACA,WACA,SACA,SACA,WACA,UACA,UACA,QACA,QACA,QACA,QACA,UACA,UACA,SACA,YACA,OACA,QACA,QACA,UACA,UACA,YACA,UACA,UACA,YACA,YACA,UACA,UACA,YACA,YACA,YACA,UACA,WACA,SACA,SACA,YACA,SACA,SACA,WACA,QACA,QACA,UACA,WACA,YACA,SACA,WACA,WACA,SACA,WACA,QACA,QACA,WACA,QACA,YACA,SACA,WACA,SACA,YACA,SACA,SACA,SACA,WACA,WACA,YACA,YACA,WACA,WACA,UACA,QACA,SACA,UACA,SACA,SACA,UACA,UACA,QACA,OACA,QACA,YACA,SACA,OACA,UACA,YACA,YACA,WACA,WACA,UACA,UACA,UACA,WACA,WACA,WACA,QACA,QACA,SACA,SACA,SACA,UACA,YACA,WACA,QACA,OACA,SACA,OACA,SACA,UACA,OACA,WACA,OACA,SACA,UACA,SACA,YACA,QACA,UACA,QACA,SACA,QACA,SACA,SACA,QACA,QACA,WACA,UACA,OACA,UACA,OACA,WACA,WACA,UACA,YACA,WACA,UACA,YACA,OACA,UACA,UACA,UACA,YACA,QACA,SACA,WACA,SACA,WACA,UACA,WACA,SACA,QACA,SACA,SACA,UACA,SACA,QACA,OACA,SACA,WACA,WACA,SACA,UACA,SACA,SACA,SACA,QACA,YACA,SACA,UACA,SACA,UACA,UACA,WACA,OACA,YACA,UACA,UACA,SACA,YACA,UACA,UACA,UACA,YACA,UACA,YACA,UACA,UACA,QACA,UACA,SACA,YACA,SACA,UACA,WACA,WACA,YACA,YACA,YACA,WACA,SACA,YACA,QACA,SACA,UACA,UACA,WACA,UACA,YACA,WACA,YACA,QACA,YACA,YACA,UACA,UACA,UACA,SACA,YACA,QACA,SACA,WACA,SACA,UACA,YACA,YACA,QACA,UACA,UACA,UACA,OACA,OACA,SACA,SACA,SACA,WACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,WACA,YACA,UACA,YACA,UACA,WACA,SACA,UACA,WACA,WACA,UACA,YACA,WACA,UACA,SACA,SACA,SACA,UACA,YACA,SACA,QACA,UACA,YACA,SACA,SACA,YACA,QACA,UACA,YACA,UACA,WACA,WACA,UACA,SACA,SACA,QACA,SACA,YACA,WACA,WACA,SACA,SACA,SACA,WACA,WACA,YACA,YACA,YACA,UACA,WACA,WACA,QACA,WACA,QACA,QACA,UACA,YACA,UACA,YACA,WACA,SACA,SACA,UACA,QACA,QACA,YACA,WACA,UACA,QACA,UACA,YACA,YACA,WACA,UACA,WACA,UACA,UACA,QACA,UACA,UACA,WACA,QACA,UACA,SACA,WACA,WACA,WACA,UACA,WACA,SACA,WACA,UACA,QACA,QACA,SACA,SACA,OACA,YACA,UACA,QACA,YACA,SACA,QACA,QACA,UACA,QACA,WACA,SACA,UACA,QACA,QACA,YACA,YACA,YACA,WACA,YACA,YACA,QACA,QACA,QACA,OACA,WACA,SACA,WACA,WACA,QACA,WACA,WACA,SACA,YACA,UACA,QACA,UACA,WACA,SACA,OACA,SACA,UACA,WACA,SACA,SACA,QACA,OACA,SACA,QACA,QACA,QACA,QACA,QACA,WACA,QACA,SACA,WACA,SACA,WACA,WACA,YACA,SACA,UACA,UACA,WACA,UACA,SACA,SACA,OACA,QACA,QACA,OACA,QACA,WACA,SACA,SACA,QACA,YACA,QACA,WACA,UACA,UACA,WACA,UACA,WACA,UACA,QACA,QACA,QACA,UACA,SACA,WACA,OACA,OACA,QACA,QACA,QACA,UACA,QACA,SACA,YACA,WACA,QACA,SACA,UACA,SACA,UACA,WACA,QACA,SACA,WACA,OACA,SACA,QACA,UACA,QACA,QACA,UACA,WACA,UACA,UACA,WACA,QACA,SACA,UACA,WACA,YACA,QACA,WACA,SACA,SACA,YACA,SACA,UACA,QACA,YACA,UACA,UACA,WACA,YACA,YACA,OACA,WACA,SACA,UACA,SACA,QACA,UACA,MACA,WACA,SACA,UACA,SACA,YACA,YACA,YACA,WACA,YACA,WACA,WACA,OACA,OACA,OACA,OACA,WACA,WACA,UACA,WACA,SACA,YACA,YACA,UACA,SACA,YACA,WACA,WACA,WACA,SACA,WACA,OACA,OACA,OACA,UACA,QACA,QACA,SACA,QACA,WACA,UACA,UACA,WACA,UACA,YACA,YACA,SACA,YACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,UACA,UACA,SACA,UACA,SACA,YACA,WACA,WACA,YACA,UACA,YACA,WACA,WACA,YACA,WACA,YACA,UACA,UACA,UACA,WACA,UACA,YACA,UACA,QACA,YACA,UACA,WACA,WACA,SACA,WACA,YACA,YACA,UACA,YACA,YACA,UACA,OACA,UACA,WACA,YACA,YACA,WACA,YACA,YACA,WACA,YACA,UACA,WACA,UACA,WACA,WACA,WACA,YACA,YACA,YACA,YACA,WACA,WACA,UACA,YACA,UACA,WACA,YACA,YACA,YACA,UACA,UACA,YACA,YACA,YACA,WACA,YACA,YACA,YACA,UACA,WACA,YACA,UACA,YACA,WACA,UACA,YACA,YACA,WACA,UACA,UACA,UACA,UACA,WACA,UACA,YACA,UACA,UACA,YACA,OACA,SACA,SACA,UACA,SACA,UACA,SACA,OACA,QACA,OACA,WACA,YACA,UACA,SACA,SACA,SACA,YACA,YACA,WACA,WACA,YACA,QACA,WACA,UACA,WACA,YACA,SACA,UACA,WACA,UACA,YACA,YACA,UACA,SACA,SACA,WACA,YACA,SACA,SACA,YACA,OACA,UACA,SACA,QACA,QACA,QACA,YACA,YACA,WACA,YACA,UACA,SACA,UACA,WACA,QACA,UACA,WACA,UACA,SACA,WACA,OACA,WACA,YACA,WACA,WACA,SACA,WACA,UACA,WACA,YACA,YACA,SACA,QACA,YACA,QACA,UACA,UACA,QACA,QACA,QACA,UACA,WACA,WACA,WACA,WACA,SACA,SACA,UACA,YACA,QACA,UACA,UACA,YACA,SACA,WACA,YACA,SACA,WACA,WACA,WACA,WACA,WACA,SACA,QACA,QACA,SACA,QACA,QACA,WACA,UACA,WACA,YACA,UACA,WACA,UACA,WACA,OACA,UACA,QACA,QACA,QACA,UACA,SACA,WACA,UACA,UACA,UACA,WACA,UACA,YACA,SACA,WACA,UACA,QACA,QACA,QACA,QACA,OACA,QACA,SACA,UACA,UACA,QACA,QACA,UACA,UACA,YACA,UACA,YACA,UACA,QACA,YACA,SACA,UACA,WACA,WACA,YACA,UACA,WACA,YACA,UACA,UACA,WACA,QACA,OACA,SACA,UACA,UACA,YACA,OACA,UACA,UACA,WACA,SACA,SACA,WACA,WACA,YACA,WACA,UACA,YACA,WACA,UACA,YACA,UACA,QACA,SACA,UACA,UACA,UACA,SACA,OACA,SACA,SACA,SACA,SACA,YACA,UACA,QACA,QACA,QACA,UACA,SACA,UACA,SACA,SACA,YACA,QACA,QACA,QACA,OACA,SACA,UACA,YACA,UACA,YACA,WACA,YACA,UACA,MACA,QACA,SACA,UACA,UACA,WACA,SACA,YACA,YACA,MACA,MACA,WACA,SACA,QACA,WACA,SACA,QACA,QACA,WACA,QACA,UACA,YACA,SACA,WACA,QACA,SACA,SACA,WACA,YACA,QACA,WACA,WACA,YACA,UACA,WACA,WACA,UACA,OACA,OACA,YACA,OACA,YACA,OACA,WACA,SACA,WACA,WACA,UACA,OACA,SACA,WACA,UACA,WACA,WACA,UACA,UACA,UACA,UACA,WACA,SACA,YACA,WACA,SACA,UACA,YACA,QACA,OACA,YACA,SACA,WACA,QACA,UACA,WACA,SACA,QACA,SACA,SACA,QACA,QACA,YACA,QACA,WACA,SACA,WACA,YACA,WACA,UACA,SACA,YACA,YACA,UACA,YACA,UACA,YACA,WACA,OACA,WACA,UACA,SACA,YACA,YACA,YACA,QACA,WACA,SACA,WACA,YACA,SACA,SACA,OACA,OACA,SACA,SACA,WACA,SACA,WACA,SACA,UACA,SACA,YACA,YACA,YACA,WACA,UACA,YACA,WACA,WACA,WACA,UACA,SACA,WACA,SACA,WACA,UACA,YACA,WACA,YACA,YACA,QACA,WACA,UACA,UACA,SACA,SACA,OACA,WACA,YACA,WACA,SACA,YACA,QACA,WACA,QACA,WACA,YACA,SACA,WACA,WACA,WACA,YACA,YACA,YACA,WACA,YACA,WACA,UACA,QACA,SACA,WACA,SACA,YACA,YACA,WACA,SACA,YACA,WACA,SACA,WACA,YACA,YACA,WACA,SACA,QACA,SACA,QACA,UACA,SACA,UACA,UACA,OACA,YACA,YACA,WACA,YACA,SACA,UACA,YACA,WACA,SACA,SACA,SACA,WACA,YACA,YACA,UACA,UACA,QACA,WACA,SACA,SACA,WACA,QACA,UACA,YACA,UACA,YACA,YACA,WACA,WACA,YACA,YACA,UACA,WACA,WACA,UACA,UACA,UACA,UACA,YACA,WACA,WACA,SACA,YACA,YACA,WACA,YACA,YACA,SACA,WACA,YACA,WACA,UACA,QACA,UACA,WACA,UACA,UACA,YACA,WACA,SACA,UACA,YACA,UACA,WACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,WACA,YACA,YACA,UACA,OACA,WACA,SACA,YACA,QACA,OACA,SACA,UACA,YACA,WACA,YACA,WACA,WACA,YACA,YACA,MACA,WACA,YACA,WACA,OACA,SACA,OACA,WACA,QACA,SACA,SACA,UACA,SACA,QACA,UACA,SACA,YACA,QACA,QACA,SACA,SACA,UACA,UACA,UACA,SACA,SACA,UACA,WACA,YACA,YACA,WACA,YACA,WACA,YACA,WACA,WACA,WACA,SACA,WACA,WACA,UACA,YACA,WACA,UACA,UACA,YACA,WACA,WACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,WACA,OACA,YACA,UACA,OACA,UACA,YACA,YACA,WACA,WACA,YACA,SACA,UACA,WACA,UACA,WACA,SACA,YACA,YACA,WACA,WACA,YACA,YACA,YACA,WACA,UACA,YACA,WACA,UACA,WACA,UACA,YACA,UACA,WACA,WACA,UACA,WACA,UACA,WACA,UACA,WACA,WACA,WACA,WACA,QACA,QACA,QACA,YACA,UACA,WACA,WACA,WACA,WACA,SACA,WACA,YACA,YACA,WACA,WACA,WACA,YACA,QACA,SACA,SACA,OACA,WACA,WACA,QACA,QACA,QACA,QACA,OACA,SACA,YACA,SACA,QACA,UACA,SACA,WACA,WACA,WACA,WACA,UACA,WACA,UACA,QACA,QACA,SACA,WACA,YACA,WACA,UACA,UACA,WACA,WACA,WACA,WACA,UACA,QACA,OACA,YACA,SACA,SACA,OACA,SACA,WACA,SACA,OACA,OACA,QACA,OACA,OACA,WACA,YACA,YACA,WACA,YACA,WACA,UACA,UACA,YACA,WACA,YACA,QACA,UACA,UACA,OACA,UACA,WACA,YACA,YACA,WACA,YACA,YACA,YACA,SACA,SACA,WACA,SACA,SACA,QACA,OACA,UACA,QACA,QACA,QACA,UACA,WACA,YACA,WACA,WACA,SACA,WACA,SACA,SACA,WACA,UACA,UACA,UACA,QACA,QACA,QACA,YACA,UACA,WACA,UACA,UACA,UACA,QACA,QACA,WACA,SACA,OACA,MACA,SACA,YACA,UACA,WACA,UACA,WACA,WACA,QACA,OACA,OACA,SACA,SACA,MACA,OACA,SACA,WACA,OACA,UACA,WACA,WACA,MACA,OACA,SACA,YACA,YACA,UACA,UACA,WACA,SACA,SACA,OACA,OACA,UACA,OACA,QACA,QACA,QACA,UACA,UACA,WACA,UACA,YACA,UACA,WACA,UACA,WACA,WACA,OACA,QACA,UACA,UACA,UACA,SACA,UACA,QACA,UACA,UACA,WACA,WACA,WACA,UACA,UACA,UACA,YACA,YACA,UACA,YACA,SACA,SACA,UACA,QACA,UACA,SACA,WACA,SACA,YACA,YACA,SACA,WACA,UACA,QACA,SACA,SACA,OACA,OACA,QACA,QACA,QACA,YACA,OACA,SACA,UACA,YACA,UACA,WACA,YACA,UACA,YACA,YACA,OACA,WACA,SACA,OACA,UACA,SACA,WACA,YACA,WACA,MACA,YACA,UACA,YACA,SACA,YACA,SACA,SACA,WACA,WACA,YACA,UACA,YACA,SACA,QACA,YACA,UACA,SACA,QACA,YACA,UACA,SACA,YACA,WACA,WACA,WACA,UACA,YACA,YACA,WACA,SACA,MACA,WACA,WACA,YACA,QACA,UACA,SACA,MACA,UACA,WACA,MACA,YACA,QACA,YACA,WACA,YACA,QACA,UACA,QACA,QACA,UACA,SACA,UACA,YACA,YACA,QACA,WACA,UACA,SACA,SACA,WACA,SACA,YACA,QACA,UACA,YACA,WACA,OACA,QACA,WACA,UACA,WACA,UACA,UACA,WACA,WACA,YACA,WACA,YACA,WACA,WACA,WACA,WACA,UACA,UACA,YACA,QACA,MACA,SACA,YACA,SACA,YACA,YACA,WACA,UACA,YACA,SACA,SACA,YACA,YACA,WACA,UACA,UACA,WACA,WACA,YACA,QACA,SACA,UACA,UACA,YACA,YACA,UACA,YACA,WACA,YACA,YACA,WACA,YACA,WACA,SACA,WACA,WACA,UACA,WACA,SACA,UACA,WACA,WACA,YACA,UACA,SACA,UACA,YACA,YACA,YACA,UACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,SACA,SACA,SACA,UACA,UACA,SACA,SACA,YACA,WACA,YACA,WACA,SACA,UACA,SACA,SACA,YACA,SACA,SACA,WACA,UACA,WACA,UACA,YACA,WACA,WACA,WACA,UACA,WACA,QACA,OACA,SACA,OACA,WACA,YACA,YACA,WACA,WACA,YACA,WACA,WACA,UACA,QACA,SACA,WACA,UACA,UACA,YACA,SACA,YACA,YACA,WACA,SACA,SACA,UACA,YACA,SACA,SACA,UACA,QACA,QACA,WACA,YACA,YACA,WACA,WACA,WACA,SACA,YACA,YACA,WACA,UACA,QACA,UACA,YACA,YACA,SACA,WACA,WACA,YACA,YACA,WACA,UACA,UACA,WACA,UACA,QACA,YACA,SACA,YACA,WACA,UACA,QACA,WACA,YACA,YACA,UACA,UACA,OACA,YACA,YACA,YACA,WACA,WACA,QACA,WACA,UACA,OACA,QACA,YACA,SACA,QACA,UACA,UACA,WACA,YACA,YACA,YACA,SACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,SACA,YACA,YACA,YACA,YACA,QACA,OACA,YACA,SACA,UACA,SACA,QACA,WACA,OACA,SACA,YACA,WACA,WACA,SACA,UACA,YACA,YACA,YACA,YACA,YACA,QACA,SACA,WACA,YACA,SACA,SACA,WACA,UACA,YACA,WACA,UACA,UACA,UACA,YACA,WACA,WACA,YACA,SACA,WACA,UACA,YACA,YACA,WACA,YACA,SACA,YACA,WACA,WACA,UACA,YACA,YACA,SACA,YACA,UACA,YACA,YACA,QACA,SACA,WACA,WACA,YACA,WACA,WACA,WACA,YACA,UACA,SACA,WACA,SACA,YACA,UACA,UACA,SACA,YACA,UACA,UACA,OACA,SACA,UACA,SACA,OACA,QACA,UACA,OACA,WACA,SACA,SACA,WACA,UACA,UACA,YACA,QACA,UACA,OACA,UACA,YACA,YACA,UACA,UACA,WACA,SACA,UACA,WACA,SACA,YACA,YACA,UACA,WACA,WACA,MACA,QACA,UACA,SACA,SACA,OACA,OACA,SACA,SACA,WACA,WACA,WACA,WACA,WACA,QACA,QACA,UACA,SACA,UACA,WACA,YACA,WACA,SACA,SACA,QACA,SACA,SACA,WACA,UACA,YACA,QACA,QACA,QACA,QACA,UACA,SACA,WACA,WACA,YACA,UACA,UACA,QACA,WACA,QACA,UACA,SACA,WACA,SACA,SACA,SACA,UACA,OACA,SACA,QACA,WACA,SACA,WACA,WACA,UACA,UACA,YACA,QACA,WACA,QACA,UACA,WACA,WACA,YACA,SACA,UACA,UACA,WACA,MACA,OACA,UACA,UACA,WACA,WACA,YACA,YACA,QACA,UACA,QACA,QACA,YACA,UACA,WACA,WACA,OACA,UACA,YACA,YACA,YACA,WACA,WACA,SACA,QACA,UACA,WACA,SACA,WACA,UACA,YACA,YACA,WACA,UACA,WACA,WACA,WACA,YACA,YACA,WACA,OACA,UACA,SACA,QACA,QACA,SACA,SACA,QACA,QACA,OACA,QACA,QACA,QACA,WACA,OACA,SACA,UACA,QACA,WACA,UACA,UACA,QACA,SACA,UACA,WACA,OACA,MACA,MACA,OACA,QACA,OACA,WACA,SACA,WACA,SACA,WACA,SACA,OACA,OACA,OACA,UACA,WACA,WACA,YACA,SACA,WACA,WACA,WACA,UACA,WACA,UACA,WACA,UACA,WACA,YACA,WACA,UACA,WACA,WACA,WACA,SACA,SACA,UACA,WACA,WACA,MACA,QACA,WACA,WACA,UACA,YACA,WACA,YACA,WACA,QACA,QACA,UACA,UACA,YACA,SACA,UACA,QACA,WACA,WACA,WACA,UACA,UACA,UACA,WACA,WACA,UACA,WACA,SACA,YACA,WACA,YACA,WACA,UACA,WACA,YACA,WACA,UACA,SACA,WACA,SACA,YACA,WACA,QACA,UACA,UACA,WACA,SACA,SACA,QACA,SACA,WACA,YACA,YACA,WACA,QACA,SACA,UACA,QACA,UACA,YACA,SACA,OACA,QACA,YACA,UACA,WACA,WACA,YACA,SACA,QACA,QACA,SACA,WACA,YACA,WACA,QACA,YACA,SACA,MACA,QACA,MACA,YACA,UACA,QACA,OACA,YACA,WACA,UACA,SACA,SACA,UACA,YACA,SACA,YACA,WACA,OACA,SACA,QACA,SACA,SACA,WACA,UACA,MACA,SACA,UACA,SACA,SACA,UACA,SACA,UACA,SACA,UACA,SACA,MACA,WACA,YACA,SACA,UACA,WACA,QACA,OACA,OACA,SACA,OACA,QACA,OACA,SACA,MACA,SACA,UACA,WACA,WACA,QACA,UACA,YACA,SACA,QACA,YACA,WACA,YACA,UACA,YACA,WACA,WACA,SACA,YACA,YACA,YACA,WACA,YACA,UACA,YACA,UACA,UACA,UACA,QACA,QACA,YACA,SACA,UACA,YACA,QACA,OACA,WACA,YACA,WACA,SACA,WACA,SACA,SACA,SACA,QACA,UACA,SACA,WACA,QACA,QACA,SACA,QACA,UACA,UACA,UACA,QACA,YACA,SACA,YACA,UACA,SACA,WACA,YACA,QACA,UACA,QACA,WACA,UACA,WACA,UACA,SACA,UACA,UACA,UACA,UACA,SACA,UACA,SACA,UACA,WACA,WACA,SACA,YACA,YACA,UACA,WACA,QACA,QACA,QACA,UACA,WACA,UACA,OACA,SACA,YACA,UACA,SACA,OACA,OACA,WACA,OACA,UACA,QACA,WACA,WACA,YACA,OACA,UACA,QACA,UACA,OACA,OACA,OACA,QACA,WACA,YACA,QACA,SACA,OACA,SACA,OACA,SACA,WACA,OACA,UACA,SACA,SACA,SACA,OACA,OACA,OACA,WACA,YACA,WACA,YACA,SACA,SACA,WACA,UACA,YACA,WACA,WACA,UACA,WACA,QACA,WACA,WACA,UACA,UACA,UACA,WACA,UACA,SACA,UACA,QACA,WACA,QACA,QACA,UACA,YACA,QACA,QACA,YACA,UACA,UACA,YACA,WACA,SACA,YACA,SACA,YACA,YACA,UACA,QACA,OACA,UACA,WACA,WACA,YACA,SACA,QACA,UACA,WACA,OACA,YACA,OACA,QACA,YACA,WACA,WACA,QACA,UACA,YACA,QACA,YACA,QACA,SACA,WACA,OACA,UACA,OACA,WACA,SACA,QACA,QACA,SACA,WACA,SACA,QACA,SACA,UACA,QACA,QACA,SACA,UACA,QACA,OACA,SACA,WACA,WACA,UACA,UACA,YACA,UACA,WACA,SACA,QACA,YACA,WACA,WACA,QACA,UACA,YACA,QACA,OACA,WACA,QACA,OACA,UACA,UACA,YACA,UACA,QACA,SACA,WACA,OACA,OACA,QACA,QACA,UACA,OACA,SACA,MACA,UACA,WACA,YACA,WACA,UACA,WACA,SACA,SACA,UACA,UACA,MACA,UACA,QACA,OACA,UACA,OACA,SACA,SACA,YACA,SACA,UACA,SACA,UACA,YACA,UACA,WACA,WACA,YACA,WACA,WACA,YACA,YACA,WACA,SACA,UACA,WACA,UACA,WACA,YACA,YACA,YACA,UACA,UACA,WACA,WACA,UACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,YACA,WACA,WACA,YACA,YACA,WACA,WACA,UACA,WACA,SACA,YACA,SACA,QACA,YACA,YACA,UACA,WACA,UACA,YACA,QACA,SACA,WACA,WACA,YACA,WACA,WACA,WACA,YACA,UACA,WACA,YACA,SACA,WACA,WACA,WACA,YACA,WACA,QACA,UACA,WACA,YACA,YACA,YACA,UACA,UACA,UACA,QACA,UACA,OACA,SACA,QACA,UACA,YACA,QACA,SACA,YACA,WACA,UACA,WACA,YACA,OACA,UACA,SACA,QACA,QACA,SACA,WACA,SACA,WACA,SACA,OACA,WACA,WACA,YACA,YACA,YACA,SACA,SACA,YACA,WACA,UACA,WACA,WACA,WACA,YACA,YACA,WACA,WACA,YACA,UACA,WACA,YACA,YACA,UACA,WACA,OACA,OACA,QACA,UACA,YACA,UACA,QACA,UACA,YACA,QACA,SACA,SACA,SACA,UACA,UACA,WACA,WACA,UACA,YACA,QACA,WACA,QACA,SACA,SACA,YACA,QACA,WACA,SACA,UACA,UACA,UACA,UACA,QACA,YACA,WACA,WACA,UACA,WACA,SACA,SACA,WACA,OACA,MACA,OACA,OACA,OACA,QACA,SACA,WACA,SACA,QACA,YACA,WACA,UACA,SACA,YACA,WACA,YACA,WACA,WACA,SACA,SACA,YACA,YACA,SACA,WACA,SACA,OACA,SACA,UACA,WACA,WACA,SACA,SACA,SACA,UACA,SACA,YACA,UACA,QACA,OACA,UACA,OACA,SACA,YACA,MACA,SACA,UACA,WACA,YACA,WACA,YACA,YACA,YACA,SACA,WACA,WACA,WACA,YACA,YACA,YACA,YACA,YACA,YACA,MACA,UACA,QACA,OACA,OACA,MACA,WACA,WACA,WACA,UACA,YACA,YACA,WACA,WACA,WACA,SACA,QACA,OACA,QACA,WACA,SACA,SACA,YACA,WACA,WACA,QACA,YACA,WACA,UACA,WACA,UACA,YACA,WACA,UACA,YACA,WACA,WACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,WACA,SACA,SACA,YACA,UACA,WACA,YACA,YACA,WACA,SACA,UACA,YACA,YACA,WACA,UACA,YACA,YACA,QACA,WACA,YACA,WACA,SACA,WACA,YACA,YACA,WACA,UACA,YACA,UACA,WACA,YACA,WACA,UACA,YACA,YACA,YACA,UACA,YACA,SACA,WACA,SACA,SACA,MACA,OACA,SACA,OACA,QACA,MACA,OACA,YACA,WACA,YACA,YACA,WACA,WACA,UACA,WACA,WACA,YACA,YACA,UACA,QACA,UACA,YACA,UACA,OACA,YACA,SACA,QACA,MACA,MACA,SACA,SACA,YACA,UACA,WACA,YACA,SACA,YACA,WACA,MACA,UACA,UACA,SACA,UACA,UACA,WACA,QACA,OACA,QACA,UACA,UACA,OACA,UACA,YACA,OACA,OACA,YACA,UACA,QACA,SACA,SACA,MACA,QACA,SACA,QACA,SACA,WACA,OACA,UACA,UACA,MACA,SACA,YACA,SACA,UACA,OACA,UACA,WACA,WACA,YACA,QACA,OACA,MACA,SACA,WACA,YACA,SACA,UACA,WACA,YACA,WACA,QACA,YACA,WACA,YACA,OACA,SACA,WACA,UACA,QACA,YACA,QACA,UACA,UACA,OACA,SACA,QACA,OACA,WACA,WACA,OACA,SACA,UACA,SACA,UACA,WACA,SACA,QACA,OACA,UACA,YACA,UACA,SACA,WACA,WACA,QACA,WACA,UACA,SACA,QACA,QACA,SACA,WACA,OACA,MACA,OACA,SACA,OACA,WACA,WACA,SACA,OACA,OACA,WACA,WACA,YACA,WACA,OACA,SACA,SACA,WACA,SACA,WACA,UACA,UACA,UACA,OACA,UACA,UACA,YACA,WACA,SACA,UACA,UACA,OACA,SACA,QACA,OACA,UACA,WACA,OACA,QACA,WACA,QACA,QACA,QACA,SACA,UACA,QACA,OACA,UACA,UACA,WACA,YACA,WACA,SACA,SACA,QACA,UACA,WACA,SACA,UACA,SACA,OACA,OACA,QACA,SACA,WACA,WACA,UACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,YACA,YACA,WACA,YACA,WACA,YACA,QACA,UACA,SACA,QACA,SACA,UACA,SACA,OACA,QACA,OACA,OACA,QACA,OACA,QACA,OACA,SACA,WACA,UACA,SACA,WACA,SACA,UACA,UACA,SACA,WACA,SACA,WACA,SACA,WACA,OACA,WACA,OACA,SACA,QACA,SACA,SACA,WACA,UACA,UACA,YACA,OACA,UACA,SACA,YACA,UACA,QACA,OACA,SACA,OACA,OACA,UACA,SACA,UACA,YACA,WACA,SACA,UACA,QACA,WACA,SACA,WACA,YACA,YACA,SACA,UACA,YACA,UACA,UACA,WACA,MACA,OACA,SACA,UACA,UACA,WACA,SACA,WACA,WACA,SACA,QACA,QACA,OACA,OACA,UACA,YACA,QACA,QACA,UACA,WACA,OACA,QACA,WACA,WACA,SACA,SACA,WACA,UACA,OACA,OACA,MACA,UACA,UACA,SACA,OACA,OACA,WACA,YACA,SACA,SACA,SACA,UACA,QACA,SACA,QACA,YACA,UACA,SACA,SACA,YACA,YACA,QACA,UACA,YACA,WACA,YACA,YACA,SACA,WACA,UACA,SACA,YACA,WACA,YACA,UACA,UACA,SACA,QACA,WACA,WACA,YACA,YACA,OACA,QACA,OACA,YACA,OACA,SACA,WACA,SACA,YACA,UACA,YACA,WACA,QACA,YACA,SACA,QACA,YACA,WACA,WACA,SACA,WACA,WACA,QACA,OACA,UACA,YACA,WACA,UACA,SACA,UACA,WACA,QACA,YACA,WACA,YACA,YACA,YACA,UACA,YACA,WACA,WACA,SACA,WACA,UACA,YACA,WACA,WACA,QACA,YACA,SACA,YACA,OACA,OACA,SACA,UACA,YACA,UACA,WACA,UACA,WACA,UACA,YACA,WACA,SACA,SACA,QACA,QACA,YACA,UACA,UACA,UACA,YACA,WACA,YACA,SACA,UACA,UACA,YACA,QACA,UACA,SACA,UACA,QACA,WACA,SACA,SACA,SACA,OACA,MACA,WACA,YACA,UACA,UACA,WACA,QACA,QACA,YACA,YACA,SACA,WACA,SACA,SACA,UACA,WACA,SACA,YACA,SACA,UACA,SACA,QACA,YACA,SACA,YACA,YACA,UACA,SACA,YACA,SACA,UACA,WACA,SACA,UACA,UACA,UACA,YACA,WACA,UACA,WACA,YACA,WACA,WACA,YACA,OACA,SACA,YACA,YACA,SACA,SACA,SACA,SACA,WACA,WACA,WACA,QACA,WACA,WACA,UACA,QACA,SACA,YACA,SACA,UACA,SACA,WACA,WACA,UACA,QACA,SACA,SACA,WACA,SACA,UACA,YACA,SACA,UACA,YACA,WACA,QACA,WACA,OACA,YACA,WACA,WACA,UACA,MACA,YACA,SACA,WACA,WACA,YACA,YACA,YACA,WACA,UACA,UACA,WACA,WACA,WACA,YACA,WACA,WACA,WACA,WACA,WACA,WACA,UACA,YACA,UACA,WACA,UACA,YACA,QACA,SACA,WACA,SACA,YACA,WACA,UACA,WACA,YACA,YACA,YACA,WACA,MACA,SACA,WACA,UACA,YACA,WACA,WACA,WACA,QACA,YACA,WACA,YACA,YACA,UACA,WACA,SACA,QACA,OACA,WACA,YACA,SACA,WACA,YACA,SACA,YACA,QACA,QACA,YACA,WACA,UACA,WACA,UACA,WACA,QACA,YACA,YACA,QACA,QACA,UACA,OACA,QACA,SACA,QACA,SACA,OACA,OACA,MACA,MACA,WACA,QACA,OACA,SACA,UACA,WACA,WACA,YACA,YACA,SACA,WACA,QACA,YACA,UACA,QACA,QACA,WACA,UACA,YACA,SACA,QACA,YACA,QACA,YACA,WACA,SACA,UACA,YACA,WACA,QACA,QACA,SACA,YACA,QACA,UACA,UACA,SACA,YACA,QACA,UACA,SACA,WACA,OACA,YACA,YACA,SACA,OACA,SACA,SACA,SACA,UACA,YACA,UACA,OACA,QACA,MACA,OACA,OACA,SACA,QACA,YACA,OACA,SACA,SACA,UACA,QACA,SACA,UACA,YACA,WACA,SACA,WACA,UACA,SACA,WACA,WACA,WACA,YACA,OACA,SACA,UACA,SACA,WACA,SACA,WACA,SACA,YACA,SACA,SACA,WACA,WACA,YACA,WACA,YACA,YACA,UACA,UACA,OACA,SACA,OACA,UACA,QACA,OACA,MACA,YACA,SACA,WACA,WACA,SACA,UACA,QACA,OACA,SACA,WACA,WACA,QACA,QACA,SACA,SACA,WACA,YACA,QACA,WACA,QACA,UACA,SACA,UACA,SACA,UACA,SACA,UACA,SACA,WACA,UACA,WACA,YACA,UACA,WACA,WACA,UACA,UACA,UACA,UACA,UACA,SACA,WACA,WACA,YACA,QACA,SACA,QACA,MACA,MACA,QACA,MACA,YACA,WACA,WACA,SACA,WACA,UACA,WACA,YACA,SACA,YACA,OACA,UACA,YACA,YACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,YACA,WACA,SACA,YACA,SACA,UACA,YACA,YACA,WACA,WACA,SACA,QACA,SACA,UACA,SACA,UACA,UACA,OACA,MACA,OACA,WACA,OACA,MACA,QACA,WACA,QACA,OACA,UACA,WACA,OACA,WACA,UACA,WACA,UACA,QACA,SACA,WACA,OACA,WACA,QACA,UACA,YACA,UACA,OACA,SACA,OACA,OACA,OACA,OACA,UACA,OACA,OACA,WACA,UACA,YACA,YACA,YACA,WACA,QACA,UACA,WACA,SACA,WACA,WACA,YACA,YACA,MACA,YACA,UACA,QACA,QACA,OACA,QACA,QACA,SACA,UACA,SACA,WACA,WACA,WACA,WACA,UACA,WACA,UACA,WACA,WACA,QACA,WACA,SACA,WACA,WACA,UACA,WACA,SACA,UACA,SACA,UACA,UACA,WACA,WACA,UACA,YACA,YACA,UACA,UACA,SACA,UACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,YACA,WACA,YACA,YACA,WACA,WACA,UACA,WACA,SACA,OACA,QACA,OACA,UACA,UACA,WACA,UACA,WACA,WACA,YACA,YACA,WACA,YACA,WACA,WACA,WACA,WACA,YACA,YACA,YACA,YACA,YACA,UACA,YACA,YACA,YACA,UACA,WACA,WACA,WACA,WACA,YACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,YACA,WACA,YACA,WACA,UACA,UACA,WACA,WACA,WACA,YACA,YACA,WACA,UACA,YACA,WACA,YACA,YACA,WACA,YACA,YACA,WACA,WACA,WACA,UACA,YACA,WACA,YACA,YACA,YACA,WACA,YACA,YACA,WACA,WACA,YACA,YACA,YACA,WACA,YACA,WACA,UACA,WACA,WACA,WACA,UACA,YACA,WACA,YACA,MACA,SACA,UACA,YACA,UACA,YACA,SACA,WACA,SACA,QACA,QACA,YACA,UACA,WACA,WACA,WACA,SACA,SACA,UACA,SACA,WACA,UACA,QACA,QACA,SACA,UACA,SACA,YACA,OACA,WACA,YACA,SACA,WACA,WACA,UACA,WACA,SACA,UACA,WACA,QACA,WACA,OACA,YACA,QACA,UACA,WACA,YACA,UACA,YACA,SACA,QACA,YACA,YACA,SACA,QACA,UACA,UACA,WACA,YACA,SACA,UACA,YACA,WACA,YACA,YACA,YACA,WACA,YACA,YACA,YACA,WACA,WACA,YACA,SACA,UACA,YACA,SACA,SACA,QACA,UACA,UACA,SACA,WACA,SACA,SACA,UACA,UACA,UACA,SACA,UACA,YACA,SACA,UACA,YACA,QACA,WACA,WACA,UACA,WACA,YACA,WACA,UACA,UACA,UACA,YACA,WACA,WACA,WACA,QACA,SACA,SACA,UACA,SACA,WACA,UACA,QACA,YACA,SACA,WACA,YACA,OACA,WACA,UACA,QACA,YACA,UACA,SACA,YACA,YACA,SACA,WACA,QACA,YACA,WACA,SACA,SACA,UACA,UACA,WACA,SACA,QACA,QACA,SACA,UACA,WACA,UACA,SACA,SACA,QACA,SACA,WACA,WACA,YACA,WACA,WACA,YACA,WACA,UACA,SACA,OACA,SACA,WACA,UACA,SACA,UACA,UACA,YACA,WACA,UACA,YACA,QACA,SACA,UACA,WACA,YACA,MACA,WACA,UACA,QACA,YACA,YACA,YACA,YACA,UACA,YACA,SACA,WACA,UACA,YACA,QACA,OACA,WACA,YACA,YACA,YACA,YACA,YACA,YACA,QACA,OACA,YACA,YACA,SACA,YACA,QACA,SACA,WACA,QACA,YACA,SACA,YACA,YACA,QACA,UACA,UACA,SACA,UACA,YACA,SACA,UACA,YACA,QACA,YACA,QACA,SACA,WACA,UACA,UACA,WACA,QACA,UACA,QACA,SACA,UACA,UACA,SACA,WACA,UACA,WACA,WACA,UACA,WACA,YACA,YACA,WACA,WACA,SACA,UACA,YACA,YACA,UACA,WACA,YACA,WACA,UACA,UACA,WACA,UACA,YACA,WACA,QACA,WACA,QACA,SACA,YACA,SACA,WACA,YACA,UACA,OACA,OACA,OACA,OACA,OACA,QACA,OACA,UACA,WACA,SACA,OACA,YACA,UACA,QACA,MACA,OACA,OACA,OACA,UACA,UACA,WACA,YACA,SACA,QACA,SACA,QACA,SACA,QACA,SACA,SACA,QACA,SACA,WACA,QACA,OACA,YACA,UACA,YACA,UACA,SACA,OACA,OACA,UACA,OACA,SACA,SACA,QACA,WACA,WACA,UACA,WACA,YACA,OACA,SACA,WACA,WACA,SACA,YACA,WACA,UACA,SACA,WACA,QACA,OACA,SACA,WACA,WACA,SACA,UACA,SACA,UACA,WACA,SACA,SACA,UACA,YACA,UACA,UACA,QACA,SACA,WACA,QACA,UACA,OACA,WACA,YACA,UACA,QACA,SACA,MACA,WACA,SACA,WACA,UACA,WACA,YACA,SACA,UACA,WACA,YACA,UACA,WACA,WACA,UACA,YACA,UACA,SACA,WACA,YACA,UACA,UACA,SACA,YACA,YACA,UACA,YACA,WACA,YACA,YACA,SACA,UACA,WACA,WACA,UACA,WACA,YACA,WACA,UACA,SACA,UACA,SACA,YACA,YACA,YACA,SACA,UACA,YACA,UACA,QACA,UACA,YACA,UACA,YACA,YACA,WACA,UACA,SACA,UACA,UACA,YACA,UACA,UACA,WACA,SACA,YACA,WACA,QACA,SACA,YACA,UACA,UACA,SACA,QACA,WACA,QACA,QACA,QACA,SACA,SACA,WACA,UACA,UACA,YACA,QACA,YACA,WACA,WACA,YACA,QACA,UACA,YACA,UACA,YACA,UACA,WACA,YACA,WACA,WACA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,UACA,WACA,YACA,UACA,YACA,UACA,WACA,YACA,WACA,YACA,YACA,YACA,WACA,YACA,WACA,WACA,QACA,QACA,YACA,SACA,WACA,YACA,SACA,YACA,WACA,WACA,YACA,WACA,UACA,QACA,UACA,YACA,WACA,SACA,YACA,YACA,WACA,WACA,QACA,WACA,SACA,SACA,WACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,UACA,UACA,WACA,YACA,QACA,SACA,QACA,YACA,QACA,UACA,MACA,UACA,SACA,YACA,SACA,SACA,MACA,OACA,YACA,OACA,UACA,QACA,YACA,OACA,SACA,SACA,QACA,WACA,YACA,YACA,UACA,WACA,OACA,QACA,SACA,QACA,WACA,YACA,WACA,SACA,WACA,YACA,QACA,UACA,WACA,SACA,SACA,UACA,SACA,SACA,WACA,YACA,OACA,QACA,YACA,WACA,UACA,WACA,WACA,YACA,SACA,YACA,UACA,WACA,UACA,SACA,QACA,UACA,OACA,SACA,WACA,UACA,YACA,SACA,QACA,WACA,QACA,WACA,QACA,UACA,YACA,YACA,UACA,UACA,QACA,UACA,UACA,SACA,YACA,YACA,WACA,UACA,SACA,QACA,UACA,UACA,YACA,YACA,YACA,QACA,QACA,QACA,UACA,YACA,QACA,OACA,SACA,YACA,WACA,YACA,QACA,QACA,OACA,SACA,SACA,OACA,SACA,QACA,SACA,WACA,YACA,WACA,YACA,WACA,QACA,SACA,SACA,OACA,OACA,SACA,SACA,UACA,SACA,UACA,UACA,WACA,UACA,SACA,OACA,SACA,QACA,SACA,WACA,OACA,SACA,QACA,YACA,SACA,SACA,SACA,UACA,SACA,UACA,UACA,UACA,QACA,OACA,SACA,SACA,OACA,UACA,SACA,QACA,SACA,SACA,UACA,YACA,WACA,QACA,YACA,WACA,WACA,UACA,WACA,OACA,YACA,WACA,UACA,YACA,YACA,YACA,WACA,SACA,WACA,WACA,WACA,UACA,YACA,SACA,QACA,UACA,SACA,SACA,UACA,SACA,UACA,UACA,WACA,WACA,SACA,SACA,YACA,SACA,SACA,SACA,SACA,YACA,YACA,UACA,SACA,WACA,UACA,WACA,YACA,UACA,YACA,YACA,SACA,YACA,UACA,YACA,YACA,YACA,SACA,SACA,UACA,SACA,WACA,WACA,SACA,YACA,YACA,UACA,WACA,WACA,YACA,WACA,UACA,UACA,UACA,YACA,YACA,UACA,YACA,SACA,YACA,UACA,WACA,WACA,WACA,YACA,YACA,SACA,SACA,UACA,SACA,WACA,WACA,WACA,WACA,YACA,UACA,UACA,WACA,UACA,UACA,YACA,SACA,YACA,YACA,UACA,SACA,WACA,YACA,SACA,SACA,UACA,UACA,SACA,SACA,SACA,WACA,YACA,WACA,UACA,YACA,UACA,UACA,WACA,YACA,QACA,SACA,SACA,YACA,YACA,UACA,YACA,UACA,YACA,SACA,WACA,UACA,YACA,YACA,UACA,WACA,WACA,QACA,QACA,UACA,UACA,YACA,WACA,WACA,WACA,UACA,QACA,UACA,YACA,UACA,SACA,SACA,SACA,WACA,SACA,YACA,OACA,SACA,SACA,UACA,UACA,WACA,SACA,WACA,WACA,YACA,YACA,QACA,UACA,YACA,SACA,UACA,SACA,YACA,UACA,UACA,UACA,WACA,SACA,WACA,YACA,YACA,WACA,YACA,YACA,UACA,UACA,WACA,WACA,YACA,WACA,SACA,SACA,SACA,WACA,UACA,SACA,UACA,YACA,YACA,UACA,SACA,SACA,WACA,YACA,SACA,WACA,WACA,SACA,WACA,UACA,SACA,UACA,QACA,WACA,SACA,YACA,SACA,YACA,YACA,UACA,UACA,WACA,YACA,YACA,YACA,OACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,UACA,UACA,YACA,UACA,QACA,SACA,WACA,UACA,SACA,WACA,WACA,WACA,WACA,SACA,SACA,QACA,UACA,UACA,YACA,YACA,YACA,WACA,WACA,UACA,WACA,YACA,YACA,YACA,SACA,WACA,WACA,WACA,WACA,SACA,WACA,UACA,WACA,SACA,SACA,WACA,YACA,YACA,SACA,WACA,YACA,SACA,YACA,YACA,UACA,UACA,UACA,UACA,WACA,SACA,SACA,WACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,YACA,YACA,QACA,SACA,UACA,SACA,UACA,UACA,WACA,QACA,SACA,UACA,UACA,UACA,SACA,UACA,YACA,WACA,WACA,UACA,YACA,YACA,SACA,YACA,SACA,WACA,UACA,YACA,UACA,UACA,WACA,YACA,SACA,SACA,WACA,YACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,UACA,QACA,SACA,UACA,OACA,SACA,SACA,WACA,UACA,UACA,WACA,SACA,OACA,SACA,UACA,OACA,UACA,QACA,QACA,UACA,SACA,OACA,OACA,QACA,UACA,OACA,UACA,WACA,WACA,UACA,SACA,WACA,UACA,OACA,SACA,OACA,UACA,UACA,QACA,QACA,YACA,WACA,YACA,YACA,UACA,WACA,SACA,UACA,QACA,UACA,OACA,QACA,WACA,SACA,WACA,SACA,SACA,WACA,YACA,UACA,WACA,YACA,WACA,QACA,QACA,QACA,OACA,OACA,SACA,SACA,OACA,SACA,UACA,UACA,WACA,WACA,WACA,YACA,UACA,YACA,UACA,UACA,QACA,SACA,QACA,SACA,SACA,UACA,SACA,UACA,OACA,SACA,SACA,MACA,SACA,OACA,SACA,WACA,UACA,QACA,YACA,UACA,SACA,UACA,QACA,OACA,SACA,UACA,QACA,OACA,OACA,OACA,MACA,UACA,WACA,YACA,SACA,YACA,SACA,YACA,UACA,WACA,QACA,UACA,SACA,YACA,YACA,SACA,WACA,UACA,OACA,OACA,UACA,QACA,OACA,QACA,OACA,QACA,SACA,WACA,SACA,SACA,QACA,SACA,QACA,OACA,WACA,SACA,UACA,YACA,YACA,OACA,SACA,WACA,WACA,WACA,YACA,SACA,UACA,WACA,UACA,YACA,UACA,SACA,WACA,UACA,UACA,YACA,UACA,YACA,YACA,WACA,QACA,WACA,YACA,OACA,QACA,UACA,YACA,QACA,UACA,YACA,UACA,OACA,YACA,QACA,UACA,WACA,QACA,YACA,YACA,UACA,WACA,WACA,YACA,QACA,QACA,SACA,UACA,QACA,UACA,SACA,QACA,YACA,MACA,UACA,SACA,UACA,WACA,QACA,UACA,WACA,UACA,WACA,OACA,UACA,UACA,WACA,QACA,YACA,SACA,WACA,YACA,SACA,QACA,UACA,YACA,WACA,QACA,YACA,SACA,WACA,YACA,SACA,WACA,YACA,WACA,UACA,UACA,YACA,QACA,QACA,WACA,QACA,QACA,UACA,QACA,SACA,YACA,YACA,SACA,YACA,SACA,UACA,QACA,WACA,SACA,YACA,UACA,WACA,WACA,SACA,WACA,WACA,WACA,YACA,YACA,QACA,UACA,UACA,SACA,WACA,SACA,WACA,YACA,SACA,SACA,UACA,YACA,WACA,WACA,UACA,UACA,WACA,QACA,QACA,WACA,YACA,SACA,UACA,WACA,YACA,YACA,SACA,UACA,SACA,YACA,SACA,UACA,WACA,WACA,QACA,SACA,WACA,WACA,WACA,SACA,WACA,UACA,UACA,UACA,SACA,WACA,YACA,YACA,WACA,OACA,UACA,WACA,WACA,YACA,YACA,UACA,WACA,YACA,SACA,UACA,OACA,SACA,WACA,YACA,YACA,YACA,YACA,WACA,QACA,YACA,SACA,SACA,SACA,WACA,YACA,SACA,SACA,YACA,UACA,WACA,QACA,UACA,UACA,SACA,WACA,UACA,UACA,SACA,WACA,QACA,YACA,YACA,UACA,UACA,WACA,SACA,QACA,SACA,UACA,YACA,UACA,SACA,QACA,QACA,WACA,UACA,YACA,UACA,QACA,QACA,UACA,UACA,QACA,UACA,WACA,QACA,SACA,QACA,UACA,QACA,YACA,UACA,UACA,UACA,YACA,QACA,SACA,OACA,QACA,QACA,QACA,QACA,UACA,SACA,WACA,SACA,SACA,UACA,WACA,YACA,SACA,UACA,SACA,UACA,QACA,UACA,YACA,UACA,QACA,OACA,QACA,YACA,QACA,QACA,WACA,UACA,WACA,WACA,QACA,WACA,YACA,WACA,UACA,UACA,YACA,YACA,UACA,YACA,SACA,YACA,SACA,QACA,QACA,UACA,WACA,WACA,SACA,WACA,UACA,UACA,QACA,UACA,YACA,YACA,WACA,QACA,SACA,WACA,WACA,YACA,WACA,SACA,SACA,SACA,SACA,SACA,UACA,WACA,YACA,SACA,QACA,SACA,WACA,UACA,UACA,YACA,OACA,QACA,OACA,MACA,UACA,WACA,UACA,SACA,SACA,SACA,OACA,UACA,WACA,WACA,SACA,SACA,UACA,OACA,YACA,QACA,OACA,OACA,SACA,YACA,SACA,YACA,SACA,WACA,SACA,UACA,YACA,SACA,UACA,SACA,WACA,WACA,UACA,SACA,UACA,MACA,QACA,SACA,SACA,SACA,UACA,WACA,YACA,UACA,UACA,QACA,UACA,WACA,YACA,UACA,UACA,OACA,SACA,SACA,WACA,SACA,UACA,YACA,WACA,WACA,UACA,SACA,SACA,SACA,OACA,QACA,QACA,QACA,SACA,UACA,UACA,WACA,UACA,UACA,WACA,WACA,WACA,WACA,WACA,WACA,SACA,YACA,UACA,WACA,WACA,QACA,UACA,WACA,WACA,UACA,QACA,YACA,UACA,OACA,UACA,UACA,WACA,YACA,SACA,QACA,OACA,UACA,QACA,WACA,YACA,UACA,WACA,QACA,UACA,OACA,OACA,QACA,QACA,QACA,SACA,QACA,YACA,SACA,SACA,UACA,QACA,SACA,YACA,UACA,WACA,YACA,WACA,WACA,QACA,WACA,YACA,SACA,OACA,OACA,SACA,WACA,SACA,SACA,UACA,WACA,SACA,OACA,YACA,UACA,SACA,OACA,OACA,QACA,QACA,MACA,QACA,UACA,YACA,UACA,WACA,UACA,QACA,WACA,QACA,YACA,QACA,QACA,QACA,UACA,QACA,OACA,SACA,YACA,YACA,UACA,QACA,UACA,SACA,UACA,SACA,SACA,WACA,YACA,SACA,WACA,QACA,UACA,UACA,OACA,QACA,QACA,SACA,QACA,QACA,SACA,WACA,QACA,QACA,UACA,WACA,SACA,UACA,SACA,QACA,UACA,UACA,QACA,QACA,WACA,YACA,YACA,UACA,YACA,WACA,WACA,YACA,YACA,YACA,WACA,UACA,WACA,WACA,YACA,WACA,QACA,OACA,QACA,UACA,SACA,WACA,QACA,YACA,YACA,WACA,YACA,UACA,WACA,UACA,WACA,SACA,YACA,YACA,WACA,YACA,SACA,QACA,YACA,UACA,WACA,YACA,UACA,WACA,QACA,OACA,SACA,YACA,SACA,SACA,QACA,SACA,QACA,QACA,UACA,SACA,UACA,UACA,WACA,UACA,WACA,QACA,SACA,WACA,YACA,UACA,YACA,WACA,YACA,UACA,WACA,SACA,WACA,WACA,SACA,WACA,WACA,WACA,UACA,WACA,UACA,UACA,WACA,SACA,SACA,YACA,SACA,SACA,UACA,QACA,WACA,SACA,QACA,QACA,QACA,WACA,SACA,SACA,WACA,YACA,UACA,UACA,WACA,SACA,UACA,SACA,QACA,SACA,SACA,SACA,QACA,QACA,QACA,SACA,YACA,YACA,SACA,SACA,SACA,SACA,SACA,OACA,OACA,OACA,UACA,WACA,WACA,QACA,SACA,WACA,SACA,WACA,WACA,YACA,SACA,WACA,YACA,YACA,WACA,UACA,YACA,QACA,WACA,WACA,SACA,SACA,SACA,YACA,UACA,YACA,YACA,SACA,QACA,UACA,QACA,QACA,UACA,WACA,WACA,YACA,UACA,WACA,YACA,YACA,YACA,WACA,WACA,UACA,UACA,QACA,QACA,QACA,SACA,WACA,YACA,SACA,UACA,WACA,WACA,YACA,UACA,QACA,WACA,UACA,YACA,UACA,WACA,SACA,WACA,UACA,WACA,UACA,YACA,UACA,UACA,WACA,QACA,QACA,SACA,YACA,SACA,UACA,SACA,UACA,YACA,UACA,QACA,YACA,WACA,WACA,YACA,QACA,QACA,QACA,YACA,WACA,YACA,YACA,UACA,OACA,SACA,UACA,OACA,SACA,UACA,YACA,YACA,WACA,YACA,UACA,OACA,QACA,UACA,UACA,YACA,SACA,WACA,YACA,QACA,YACA,YACA,UACA,WACA,UACA,WACA,WACA,WACA,SACA,WACA,SACA,UACA,YACA,OACA,SACA,QACA,QACA,QACA,QACA,QACA,YACA,YACA,YACA,UACA,QACA,QACA,SACA,QACA,QACA,YACA,YACA,WACA,UACA,UACA,WACA,YACA,WACA,UACA,YACA,YACA,QACA,QACA,QACA,WACA,UACA,WACA,YACA,WACA,WACA,YACA,YACA,WACA,WACA,YACA,WACA,UACA,QACA,QACA,SACA,SACA,SACA,WACA,YACA,QACA,SACA,UACA,SACA,WACA,SACA,SACA,SACA,SACA,WACA,SACA,WACA,SACA,SACA,WACA,YACA,WACA,YACA,SACA,YACA,UACA,WACA,QACA,SACA,QACA,UACA,UACA,UACA,WACA,SACA,QACA,UACA,UACA,SACA,QACA,UACA,WACA,SACA,UACA,YACA,QACA,QACA,UACA,UACA,WACA,QACA,SACA,WACA,SACA,UACA,YACA,UACA,WACA,SACA,QACA,YACA,YACA,YACA,UACA,WACA,WACA,WACA,YACA,UACA,WACA,SACA,WACA,UACA,YACA,WACA,YACA,YACA,WACA,SACA,UACA,WACA,YACA,YACA,YACA,UACA,YACA,YACA,UACA,UACA,WACA,YACA,YACA,UACA,WACA,SACA,WACA,WACA,UACA,SACA,SACA,YACA,UACA,YACA,OACA,UACA,SACA,SACA,OACA,WACA,YACA,UACA,SACA,YACA,WACA,QACA,UACA,QACA,WACA,WACA,WACA,SACA,UACA,UACA,UACA,SACA,OACA,SACA,WACA,YACA,SACA,YACA,YACA,YACA,WACA,WACA,WACA,WACA,YACA,YACA,SACA,WACA,SACA,UACA,YACA,UACA,YACA,SACA,WACA,UACA,YACA,YACA,SACA,UACA,WACA,UACA,UACA,UACA,UACA,WACA,UACA,YACA,YACA,WACA,SACA,WACA,UACA,YACA,WACA,QACA,UACA,UACA,WACA,YACA,YACA,OACA,YACA,UACA,YACA,OACA,WACA,QACA,OACA,QACA,QACA,QACA,QACA,QACA,SACA,UACA,UACA,YACA,YACA,UACA,WACA,WACA,WACA,UACA,WACA,QACA,QACA,SACA,SACA,UACA,UACA,QACA,SACA,QACA,QACA,QACA,WACA,WACA,YACA,WACA,UACA,UACA,WACA,UACA,WACA,WACA,YACA,YACA,QACA,SACA,UACA,UACA,QACA,WACA,SACA,SACA,YACA,UACA,YACA,UACA,SACA,WACA,QACA,OACA,UACA,WACA,UACA,UACA,WACA,UACA,YACA,MACA,UACA,OACA,SACA,SACA,WACA,OACA,QACA,SACA,WACA,QACA,SACA,OACA,SACA,UACA,UACA,UACA,WACA,UACA,WACA,WACA,UACA,UACA,OACA,YACA,SACA,SACA,UACA,QACA,SACA,SACA,WACA,OACA,SACA,QACA,YACA,UACA,QACA,WACA,SACA,WACA,SACA,QACA,SACA,QACA,OACA,OACA,UACA,YACA,OACA,QACA,QACA,WACA,WACA,UACA,UACA,YACA,QACA,SACA,WACA,UACA,UACA,YACA,WACA,WACA,QACA,UACA,QACA,QACA,SACA,UACA,WACA,WACA,YACA,YACA,UACA,WACA,SACA,QACA,QACA,QACA,WACA,SACA,SACA,WACA,YACA,SACA,SACA,SACA,WACA,SACA,YACA,SACA,WACA,YACA,YACA,UACA,WACA,OACA,QACA,WACA,WACA,OACA,YACA,UACA,QACA,QACA,QACA,SACA,WACA,UACA,OACA,QACA,UACA,UACA,YACA,YACA,WACA,UACA,OACA,SACA,OACA,OACA,QACA,SACA,UACA,YACA,UACA,SACA,WACA,SACA,SACA,WACA,SACA,WACA,OACA,UACA,OACA,SACA,SACA,SACA,UACA,YACA,SACA,SACA,SACA,QACA,UACA,QACA,WACA,UACA,QACA,UACA,YACA,UACA,UACA,WACA,YACA,QACA,UACA,SACA,WACA,WACA,YACA,YACA,YACA,YACA,YACA,WACA,UACA,YACA,UACA,UACA,WACA,QACA,QACA,SACA,WACA,WACA,OACA,YACA,WACA,YACA,UACA,QACA,SACA,OACA,UACA,UACA,YACA,SACA,SACA,QACA,WACA,SACA,QACA,WACA,YACA,WACA,UACA,YACA,UACA,UACA,WACA,WACA,WACA,UACA,YACA,SACA,WACA,WACA,UACA,QACA,SACA,YACA,WACA,UACA,YACA,UACA,WACA,WACA,UACA,OACA,SACA,WACA,UACA,UACA,UACA,WACA,WACA,SACA,WACA,UACA,UACA,YACA,SACA,WACA,QACA,SACA,QACA,QACA,UACA,QACA,SACA,YACA,UACA,WACA,WACA,YACA,QACA,MACA,QACA,WACA,UACA,UACA,UACA,MACA,UACA,QACA,SACA,WACA,QACA,SACA,UACA,WACA,WACA,YACA,OACA,SACA,UACA,SACA,SACA,OACA,QACA,OACA,MACA,QACA,QACA,QACA,WACA,SACA,YACA,SACA,QACA,QACA,UACA,YACA,OACA,WACA,QACA,QACA,QACA,YACA,UACA,UACA,WACA,SACA,SACA,UACA,SACA,QACA,OACA,QACA,WACA,YACA,QACA,YACA,WACA,SACA,YACA,SACA,YACA,YACA,WACA,UACA,YACA,YACA,YACA,YACA,YACA,UACA,UACA,UACA,YACA,WACA,SACA,SACA,WACA,WACA,YACA,YACA,UACA,WACA,YACA,UACA,YACA,WACA,WACA,YACA,WACA,WACA,WACA,UACA,WACA,WACA,YACA,UACA,YACA,YACA,UACA,UACA,SACA,YACA,YACA,UACA,QACA,SACA,UACA,SACA,YACA,WACA,WACA,YACA,WACA,WACA,WACA,SACA,YACA,YACA,WACA,UACA,UACA,UACA,UACA,YACA,UACA,YACA,WACA,QACA,YACA,UACA,YACA,SACA,YACA,YACA,WACA,WACA,YACA,YACA,WACA,WACA,YACA,WACA,YACA,YACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,WACA,YACA,YACA,YACA,YACA,WACA,WACA,YACA,YACA,YACA,YACA,YACA,YACA,WACA,UACA,SACA,YACA,UACA,YACA,WACA,UACA,WACA,UACA,SACA,WACA,SACA,YACA,UACA,WACA,YACA,WACA,YACA,WACA,UACA,YACA,SACA,YACA,YACA,YACA,SACA,WACA,UACA,YACA,UACA,WACA,WACA,YACA,YACA,UACA,WACA,YACA,SACA,YACA,WACA,WACA,YACA,WACA,WACA,WACA,WACA,SACA,UACA,WACA,YACA,YACA,WACA,YACA,UACA,WACA,YACA,UACA,YACA,WACA,YACA,WACA,UACA,YACA,SACA,SACA,UACA,WACA,UACA,UACA,YACA,YACA,QACA,YACA,YACA,YACA,YACA,YACA,QACA,WACA,YACA,SACA,WACA,OACA,YACA,WACA,WACA,UACA,SACA,YACA,YACA,UACA,UACA,UACA,WACA,WACA,YACA,UACA,SACA,YACA,YACA,YACA,YACA,UACA,WACA,WACA,QACA,YACA,WACA,WACA,WACA,YACA,YACA,UACA,WACA,WACA,YACA,UACA,SACA,YACA,WACA,WACA,WACA,WACA,YACA,YACA,YACA,YACA,UACA,WACA,UACA,YACA,UACA,WACA,YACA,UACA,YACA,WACA,UACA,YACA,YACA,WACA,YACA,SACA,WACA,SACA,YACA,WACA,UACA,WACA,WACA,YACA,WACA,YACA,YACA,YACA,YACA,WACA,SACA,YACA,WACA,UACA,WACA,UACA,YACA,YACA,SACA,SACA,YACA,YACA,YACA,WACA,SACA,YACA,YACA,WACA,SACA,YACA,YACA,UACA,SACA,YACA,SACA,WACA,WACA,SACA,SACA,WACA,UACA,WACA,YACA,YACA,UACA,WACA,WACA,YACA,WACA,WACA,SACA,WACA,YACA,SACA,YACA,YACA,WACA,WACA,WACA,YACA,YACA,YACA,WACA,YACA,WACA,WACA,SACA,WACA,WACA,SACA,WACA,WACA,YACA,WACA,WACA,YACA,YACA,WACA,YACA,YACA,WACA,YACA,UACA,YACA,YACA,WACA,WACA,WACA,SACA,UACA,WACA,YACA,UACA,UACA,YACA,WACA,UACA,WACA,WACA,SACA,QACA,QACA,UACA,WACA,WACA,YACA,SACA,YACA,YACA,YACA,YACA,UACA,YACA,SACA,UACA,WACA,UACA,UACA,WACA,SACA,UACA,WACA,WACA,YACA,WACA,YACA,WACA,WACA,YACA,UACA,WACA,YACA,SACA,WACA,YACA,UACA,QACA,YACA,SACA,WACA,YACA,SACA,UACA,YACA,YACA,YACA,SACA,YACA,WACA,UACA,UACA,YACA,YACA,QACA,SACA,UACA,WACA,YACA,SACA,UACA,UACA,WACA,SACA,SACA,SACA,WACA,YACA,SACA,OACA,QACA,UACA,WACA,UACA,SACA,SACA,UACA,SACA,UACA,WACA,UACA,UACA,WACA,WACA,UACA,SACA,UACA,SACA,WACA,SACA,SACA,UACA,QACA,SACA,WACA,UACA,SACA,SACA,YACA,UACA,SACA,QACA,UACA,OACA,YACA,OACA,QACA,QACA,UACA,UACA,UACA,SACA,SACA,QACA,UACA,SACA,SACA,WACA,WACA,WACA,YACA,UACA,YACA,UACA,QACA,SACA,SACA,YACA,QACA,UACA,SACA,SACA,WACA,UACA,YACA,WACA,WACA,SACA,UACA,UACA,UACA,UACA,UACA,UACA,WACA,WACA,SACA,WACA,OACA,QACA,SACA,YACA,SACA,WACA,SACA,WACA,UACA,SACA,YACA,WACA,WACA,YACA,UACA,QACA,QACA,YACA,WACA,UACA,UACA,SACA,QACA,UACA,SACA,YACA,WACA,UACA,OACA,SACA,OACA,UACA,OACA,WACA,YACA,SACA,QACA,OACA,WACA,UACA,QACA,WACA,SACA,UACA,WACA,YACA,WACA,UACA,UACA,YACA,WACA,UACA,UACA,YACA,WACA,SACA,SACA,QACA,QACA,UACA,WACA,QACA,OACA,YACA,UACA,WACA,UACA,UACA,SACA,WACA,UACA,QACA,QACA,WACA,WACA,UACA,WACA,YACA,UACA,YACA,QACA,WACA,WACA,UACA,WACA,QACA,UACA,OACA,WACA,SACA,UACA,UACA,QACA,SACA,UACA,QACA,QACA,SACA,YACA,MACA,QACA,SACA,QACA,QACA,QACA,SACA,QACA,OACA,SACA,OACA,UACA,SACA,SACA,QACA,OACA,UACA,SACA,UACA,SACA,WACA,YACA,YACA,WACA,YACA,UACA,SACA,SACA,YACA,UACA,UACA,WACA,YACA,UACA,OACA,UACA,QACA,QACA,WACA,SACA,OACA,WACA,SACA,OACA,QACA,QACA,WACA,QACA,YACA,SACA,QACA,WACA,UACA,QACA,WACA,UACA,WACA,SACA,MACA,OACA,SACA,QACA,SACA,QACA,QACA,YACA,UACA,OACA,OACA,YACA,WACA,UACA,SACA,WACA,WACA,WACA,WACA,SACA,WACA,SACA,YACA,UACA,SACA,YACA,OACA,OACA,QACA,UACA,OACA,OACA,UACA,SACA,WACA,SACA,OACA,QACA,WACA,SACA,OACA,SACA,OACA,OACA,WACA,QACA,UACA,SACA,SACA,WACA,SACA,MACA,OACA,YACA,YACA,YACA,YACA,YACA,UACA,OACA,OACA,SACA,OACA,QACA,OACA,OACA,UACA,UACA,YACA,QACA,YACA,YACA,QACA,QACA,QACA,MACA,UACA,QACA,SACA,WACA,UACA,WACA,SACA,UACA,UACA,UACA,UACA,QACA,UACA,UACA,YACA,UACA,WACA,UACA,YACA,UACA,OACA,QACA,QACA,MACA,UACA,UACA,OACA,OACA,OACA,WACA,WACA,SACA,WACA,QACA,UACA,OACA,MACA,YACA,UACA,QACA,MACA,SACA,QACA,QACA,OACA,SACA,SACA,OACA,QACA,MACA,UACA,QACA,MACA,WACA,OACA,YACA,QACA,YACA,UACA,UACA,QACA,OACA,MACA,SACA,SACA,OACA,SACA,YACA,YACA,UACA,QCrkPWC,GACXp8E,OAAO85E,OAAO,CACZuC,SAAU,EACVC,cAAe,IACfP,YAAY,EACZC,eAAe,ICNZ,MAAM,GAdb,WACE,MAAMK,EAAWr8E,OAAO85E,OAAO,CAC7BxhF,IAAK,EACLC,IAAK,KAGP,OAAOyH,OAAO85E,OAAO,CACnBuC,YAEJ,CAKiC,GAI1B,MAAME,GAuBXvkF,YAAYmtB,GACV,IAAwBxsB,EAAewhF,EASvC/hF,KAAK+sB,OAASiyB,gBAAgBjyB,GAC9B/sB,KAAKikF,UAVmB1jF,EAUOwsB,EAAO22D,eAVC3B,EAUe,GAA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ACpCyC,GAAkB7rG,EAAOopG,G,KAGvC,CCrCA,MAAMyoB,GACY,gCCcH,MAAMC,GAArB,cACE,KAAAC,OAAuB,GACvB,KAAAC,WAAuC,CAAC,EACxC,KAAAjsF,SAAgB,CAAC,EACjB,KAAAksF,WAAkB,IAIpB,ECvBO,MAAMC,IACK,GAAAC,mBAA+B,CAE7C,WACA,YACA,QACA,gBACA,SACA,iBACA,SACA,UACA,cACA,WACA,QAEA,eACA,gBACA,gBACA,iBACA,aACA,eAGc,GAAAC,eAA2B,CACzC,OACA,MACA,MACA,WACA,UACA,iBACA,OACA,UACA,MACA,WACA,WACA,UACA,MACA,gBACA,YACA,QACA,gBACA,oBAGc,GAAAC,iBAA6B,CAAC,SAAU,QAAS,OAAQ,MAEzD,GAAAC,gBAA4B,CAAC,UAAW,eAAgB,UAExD,GAAAC,yBAAqC,IAChDL,GAAkBI,gBACrB,mBAGc,GAAAE,2BAAuC,CACrD,SACA,OACA,SACA,QACA,QACA,UAGc,GAAAC,sBAAkC,CAChD,QACA,cACGP,GAAkBM,4BAGP,GAAAE,qBAAiC,CAC/C,cACGR,GAAkBO,uBAIlB,MAAME,IACK,GAAAC,eAA2B,CACzC,mBACA,cACA,WACA,SACA,YACA,cACA,aACA,YACA,gBAGc,GAAAC,uBAAmC,IAC9CF,GAA4BC,eAC/B,eAGc,GAAAE,qBAAiC,CAC/C,UACA,YACA,kBACA,aACA,OACA,OAGc,GAAAC,0BAAsC,CACpD,UACA,YACA,kBACA,aACA,UAGc,GAAAC,qBAAiC,CAC/C,YACA,SACA,cACA,WACA,SACA,KACA,QACA,UACA,cACA,eACA,QACA,eACA,YACA,SACA,YAGc,GAAAC,0BAAsC,CACpD,YACA,SACA,cACA,WACA,QACA,UACA,eACA,YACA,UAGc,GAAAC,qBAAiC,CAC/C,SACA,WACA,gBACA,kBACA,QACA,UACA,cACA,cACA,WACA,aACA,SACA,QACA,UACA,QACA,UACA,kBACA,0BACA,mBAGc,GAAAC,0BAAsC,CACpD,QACA,UACA,QACA,UACA,kBACA,2BAGc,GAAAC,sBAAkC,CAChD,YACA,eACA,WACA,aACA,QACA,UACA,SACA,cACA,YACA,wBACA,mBACA,QACA,OACA,UACA,SACA,cACA,YACA,SACA,QACA,eACA,YACA,eACA,YACA,oBACA,iBACA,oBACA,iBACA,gBACA,kBACA,aACA,eACA,0BACA,wBACA,qBACA,UACA,cACA,cACA,eACA,UAGc,GAAAC,qBAAiC,CAC/C,WACA,cACA,UACA,YACA,QACA,UACA,SACA,cACA,YACA,uBACA,kBACA,QACA,OACA,UACA,SACA,cACA,YACA,SACA,QACA,UACA,YACA,gBACA,cACA,cACA,YACA,cACA,YACA,mBACA,iBACA,mBACA,iBACA,cACA,gBACA,iBACA,mBACA,yBACA,uBACA,cACA,qBACA,uBACA,gBACA,gBACA,UAGc,GAAAC,cAA0B,CACxC,MACA,MACA,OACA,SACA,SACA,WACA,WACA,MACA,MACA,OACA,MACA,OACA,UACA,YACA,gBACA,gBACA,SACA,aACA,oBACA,MACA,OAGc,GAAAC,oBAAgC,CAC9C,UACA,YACA,aACA,WACA,WAKc,GAAAC,UAAY,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC3C,GAAAC,cAAgB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/C,GAAAC,aAAe,CAAC,OAAQ,OAAQ,OAAQ,KAAM,OAAQ,QAGjE,MAAMC,IACK,GAAAC,mBAA+B,CAC7C,mBACA,cACA,WACA,SACA,YACA,cACA,aACA,YACA,gBAGc,GAAAC,mBAA+B,CAAC,OAAQ,YAAa,aAErD,GAAAC,wBAAoC,CAAC,YAAa,aAElD,GAAAC,gBAA4B,CAC1C,mBACA,SACA,QAEA,UAGc,GAAAC,oBAAgC,CAE9C,SACA,aACA,aACA,UAEA,WAGc,GAAAC,qBAAiC,CAC/C,SACA,cACA,kBACA,iBACA,WACA,YAGc,GAAAC,mBAA+B,CAE7C,SACA,YACA,SACA,UACA,cACA,WACA,SAEA,WACA,gBAGc,GAAAC,gBAA4B,CAAC,SAAU,iBAEvC,GAAAC,kBAA8B,CAC5C,UACA,iBACA,OACA,SACA,eACA,eACA,YACA,YAEA,UACA,WAG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","sources":["webpack:///webpack/runtime/chunk loaded","webpack:///webpack/runtime/create fake namespace object","webpack:///../../libs/common/src/auth/enums/authentication-type.ts","webpack:///../../libs/common/src/platform/enums/encryption-type.enum.ts","webpack:///../../libs/common/src/platform/enums/file-upload-type.enum.ts","webpack:///../../libs/common/src/platform/enums/hash-purpose.enum.ts","webpack:///../../libs/common/src/platform/enums/html-storage-location.enum.ts","webpack:///../../libs/common/src/platform/enums/kdf-type.enum.ts","webpack:///../../libs/common/src/auth/models/domain/kdf-config.ts","webpack:///../../libs/common/src/platform/misc/range-with-default.ts","webpack:///../../libs/common/src/platform/enums/key-suffix-options.enum.ts","webpack:///../../libs/common/src/platform/enums/log-level-type.enum.ts","webpack:///../../libs/common/src/platform/enums/storage-location.enum.ts","webpack:///../../libs/common/src/platform/enums/theme-type.enum.ts","webpack:///../../libs/common/src/platform/misc/utils.ts","webpack:///../../libs/common/src/platform/models/domain/enc-string.ts","webpack:///../../libs/auth/src/common/services/pin-crypto/pin-crypto.service.implementation.ts","webpack:///../../libs/common/src/auth/enums/two-factor-provider-type.ts","webpack:///../../libs/common/src/auth/models/domain/force-set-password-reason.ts","webpack:///../../libs/common/src/enums/client-type.enum.ts","webpack:///../../libs/common/src/enums/device-type.enum.ts","webpack:///../../libs/common/src/models/request/prelogin.request.ts","webpack:///../../libs/common/src/models/response/base.response.ts","webpack:///../../libs/common/src/models/response/error.response.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/token.request.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/password-token.request.ts","webpack:///../../libs/common/src/auth/models/domain/auth-result.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/device.request.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/token-two-factor.request.ts","webpack:///../../libs/common/src/auth/models/response/identity-captcha.response.ts","webpack:///../../libs/common/src/auth/models/response/master-password-policy.response.ts","webpack:///../../libs/common/src/auth/models/response/user-decryption-options/key-connector-user-decryption-option.response.ts","webpack:///../../libs/common/src/auth/models/response/user-decryption-options/trusted-device-user-decryption-option.response.ts","webpack:///../../libs/common/src/auth/models/response/user-decryption-options/webauthn-prf-decryption-option.response.ts","webpack:///../../libs/common/src/auth/models/response/user-decryption-options/user-decryption-options.response.ts","webpack:///../../libs/common/src/auth/models/response/identity-token.response.ts","webpack:///../../libs/common/src/auth/models/response/identity-two-factor.response.ts","webpack:///../../libs/common/src/enums/event-system-user.enum.ts","webpack:///../../libs/common/src/enums/event-type.enum.ts","webpack:///../../libs/common/src/enums/http-status-code.enum.ts","webpack:///../../libs/common/src/enums/native-messaging-version.enum.ts","webpack:///../../libs/common/src/enums/notification-type.enum.ts","webpack:///../../libs/common/src/enums/product-type.enum.ts","webpack:///../../libs/common/src/platform/services/cryptography/initializer-key.ts","webpack:///../../libs/common/src/vault/enums/cipher-reprompt-type.ts","webpack:///../../libs/common/src/vault/enums/cipher-type.ts","webpack:///../../libs/common/src/vault/enums/field-type.enum.ts","webpack:///../../libs/common/src/vault/enums/linked-id-type.enum.ts","webpack:///../../libs/common/src/vault/enums/secure-note-type.enum.ts","webpack:///../../libs/common/src/vault/enums/uri-match-type.enum.ts","webpack:///../../libs/common/src/models/request/keys.request.ts","webpack:///../../libs/common/src/auth/models/domain/admin-auth-req-storable.ts","webpack:///../../libs/common/src/auth/models/domain/user-decryption-options/key-connector-user-decryption-option.ts","webpack:///../../libs/common/src/auth/models/domain/user-decryption-options/trusted-device-user-decryption-option.ts","webpack:///../../libs/common/src/platform/models/domain/symmetric-crypto-key.ts","webpack:///../../libs/common/src/vault/models/view/attachment.view.ts","webpack:///../../libs/common/src/vault/linked-field-option.decorator.ts","webpack:///../../libs/common/src/vault/models/view/item.view.ts","webpack:///../../libs/common/src/vault/models/view/card.view.ts","webpack:///../../libs/common/src/vault/models/view/field.view.ts","webpack:///../../libs/common/src/vault/models/view/identity.view.ts","webpack:///../../libs/common/src/vault/models/view/fido2-credential.view.ts","webpack:///../../libs/common/src/platform/misc/safe-urls.ts","webpack:///../../libs/common/src/vault/models/view/login-uri.view.ts","webpack:///../../libs/common/src/vault/models/view/login.view.ts","webpack:///../../libs/common/src/vault/models/view/password-history.view.ts","webpack:///../../libs/common/src/vault/models/view/secure-note.view.ts","webpack:///../../libs/common/src/vault/models/view/cipher.view.ts","webpack:///../../libs/common/src/platform/models/data/server-config.data.ts","webpack:///../../libs/common/src/platform/models/domain/account.ts","webpack:///../../libs/auth/src/common/login-strategies/login.strategy.ts","webpack:///../../libs/auth/src/common/login-strategies/auth-request-login.strategy.ts","webpack:///../../libs/common/src/platform/models/domain/domain-base.ts","webpack:///../../libs/common/src/admin-console/models/domain/master-password-policy-options.ts","webpack:///../../libs/auth/src/common/login-strategies/password-login.strategy.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/sso-token.request.ts","webpack:///../../libs/auth/src/common/login-strategies/sso-login.strategy.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/user-api-token.request.ts","webpack:///../../libs/auth/src/common/login-strategies/user-api-login.strategy.ts","webpack:///../../libs/common/src/auth/models/request/identity-token/webauthn-login-token.request.ts","webpack:///../../libs/auth/src/common/login-strategies/webauthn-login.strategy.ts","webpack:///../../libs/auth/src/common/services/login-strategies/login-strategy.service.ts","webpack:///../../libs/common/src/auth/models/request/passwordless-auth.request.ts","webpack:///../../libs/auth/src/common/services/auth-request/auth-request.service.ts","webpack:///../../libs/common/src/models/response/list.response.ts","webpack:///../../libs/common/src/admin-console/models/data/policy.data.ts","webpack:///../../libs/common/src/admin-console/models/response/policy.response.ts","webpack:///../../libs/common/src/admin-console/services/policy/policy-api.service.ts","webpack:///../../libs/common/src/platform/state/derive-definition.ts","webpack:///../../libs/common/src/platform/state/state.provider.ts","webpack:///../../libs/common/src/platform/state/deserialization-helpers.ts","webpack:///../../libs/common/src/platform/state/key-definition.ts","webpack:///../../libs/common/src/platform/state/user-key-definition.ts","webpack:///../../libs/common/src/platform/state/state-definition.ts","webpack:///../../libs/common/src/platform/state/state-definitions.ts","webpack:///../../libs/common/src/admin-console/enums/organization-api-key-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/organization-connection-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/organization-user-status-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/organization-user-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/policy-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/provider-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/provider-user-status-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/provider-user-type.enum.ts","webpack:///../../libs/common/src/admin-console/enums/scim-provider-type.enum.ts","webpack:///../../libs/common/src/admin-console/models/domain/provider.ts","webpack:///../../libs/common/src/admin-console/services/provider.service.ts","webpack:///../../libs/common/src/auth/enums/authentication-status.ts","webpack:///../../libs/common/src/auth/abstractions/account.service.ts","webpack:///../../libs/common/src/auth/services/account.service.ts","webpack:///../../libs/common/src/auth/services/auth.service.ts","webpack:///../../libs/common/src/auth/models/request/secret-verification.request.ts","webpack:///../../libs/common/src/auth/models/request/update-devices-trust.request.ts","webpack:///../../libs/common/src/auth/services/device-trust-crypto.service.implementation.ts","webpack:///../../libs/common/src/auth/abstractions/devices/views/device.view.ts","webpack:///../../libs/common/src/auth/services/devices/devices.service.implementation.ts","webpack:///../../libs/common/src/auth/abstractions/devices/responses/device.response.ts","webpack:///../../libs/common/src/auth/models/response/protected-device.response.ts","webpack:///../../libs/common/src/auth/services/devices/requests/trusted-device-keys.request.ts","webpack:///../../libs/common/src/auth/services/devices-api.service.implementation.ts","webpack:///../../libs/common/src/auth/models/request/key-connector-user-key.request.ts","webpack:///../../libs/common/src/auth/models/request/set-key-connector-key.request.ts","webpack:///../../libs/common/src/auth/services/key-connector.service.ts","webpack:///../../libs/common/src/auth/services/sso-login.service.ts","webpack:///../../libs/common/src/auth/services/token.service.ts","webpack:///../../libs/common/src/auth/services/two-factor.service.ts","webpack:///../../libs/common/src/auth/enums/verification-type.ts","webpack:///../../libs/common/src/auth/services/user-verification/user-verification-api.service.ts","webpack:///../../libs/common/src/auth/models/request/verify-otp.request.ts","webpack:///../../libs/common/src/auth/services/user-verification/user-verification.service.ts","webpack:///../../libs/common/src/auth/types/verification.ts","webpack:///./src/autofill/constants.ts","webpack:///./src/autofill/utils/autofill-overlay.enum.ts","webpack:///../../libs/common/src/autofill/services/autofill-settings.service.ts","webpack:///../../libs/common/src/platform/abstractions/messaging.service.ts","webpack:///../../libs/common/src/platform/biometrics/biometric.state.ts","webpack:///../../libs/common/src/platform/biometrics/biometric-state.service.ts","webpack:///../../libs/common/src/platform/factories/account-factory.ts","webpack:///../../libs/common/src/platform/factories/global-state-factory.ts","webpack:///../../libs/common/src/platform/factories/state-factory.ts","webpack:///../../libs/common/src/models/domain/window-state.ts","webpack:///../../libs/common/src/platform/models/domain/global-state.ts","webpack:///../../libs/common/src/platform/services/app-id.service.ts","webpack:///../../libs/common/src/platform/models/response/server-config.response.ts","webpack:///../../libs/common/src/platform/services/config/config-api.service.ts","webpack:///../../libs/common/src/platform/services/console-log.service.ts","webpack:///../../libs/common/src/platform/services/container.service.ts","webpack:///../../libs/common/src/platform/models/domain/enc-array-buffer.ts","webpack:///../../libs/common/src/platform/models/domain/encrypted-object.ts","webpack:///../../libs/common/src/platform/services/cryptography/encrypt.service.implementation.ts","webpack:///../../libs/common/src/vault/models/data/attachment.data.ts","webpack:///../../libs/common/src/vault/models/data/card.data.ts","webpack:///../../libs/common/src/vault/models/data/field.data.ts","webpack:///../../libs/common/src/vault/models/data/identity.data.ts","webpack:///../../libs/common/src/vault/models/data/fido2-credential.data.ts","webpack:///../../libs/common/src/vault/models/data/login-uri.data.ts","webpack:///../../libs/common/src/vault/models/data/login.data.ts","webpack:///../../libs/common/src/vault/models/data/password-history.data.ts","webpack:///../../libs/common/src/vault/models/data/secure-note.data.ts","webpack:///../../libs/common/src/vault/models/data/cipher.data.ts","webpack:///../../libs/common/src/vault/models/domain/attachment.ts","webpack:///../../libs/common/src/vault/models/domain/card.ts","webpack:///../../libs/common/src/vault/models/domain/field.ts","webpack:///../../libs/common/src/vault/models/domain/identity.ts","webpack:///../../libs/common/src/vault/models/domain/fido2-credential.ts","webpack:///../../libs/common/src/vault/models/domain/login-uri.ts","webpack:///../../libs/common/src/vault/models/domain/login.ts","webpack:///../../libs/common/src/vault/models/domain/password.ts","webpack:///../../libs/common/src/vault/models/domain/secure-note.ts","webpack:///../../libs/common/src/vault/models/domain/cipher.ts","webpack:///../../libs/common/src/platform/services/cryptography/get-class-initializer.ts","webpack:///../../libs/common/src/platform/services/cryptography/multithread-encrypt.service.implementation.ts","webpack:///../../libs/common/src/platform/services/file-upload/azure-file-upload.service.ts","webpack:///../../libs/common/src/platform/services/file-upload/bitwarden-file-upload.service.ts","webpack:///../../libs/common/src/platform/services/file-upload/file-upload.service.ts","webpack:///../../libs/common/src/platform/services/key-generation.service.ts","webpack:///../../libs/common/src/platform/abstractions/storage.service.ts","webpack:///../../libs/common/src/platform/services/memory-storage.service.ts","webpack:///../../libs/common/src/state-migrations/migration-builder.ts","webpack:///../../libs/common/src/state-migrations/migrator.ts","webpack:///../../libs/common/src/state-migrations/migrations/10-move-ever-had-user-key-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/11-move-org-keys-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/12-move-environment-state-to-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/13-move-provider-keys-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/14-move-biometric-client-key-half-state-to-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/15-move-folder-state-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/16-move-last-sync-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/17-move-enable-passkeys-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/18-move-autofill-settings-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/19-migrate-require-password-on-start.ts","webpack:///../../libs/common/src/state-migrations/migrations/20-move-private-key-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/21-move-collections-state-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/22-move-collapsed-groupings-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/23-move-biometric-prompts-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/24-move-sm-onboarding-key-to-state-providers.ts","webpack:///../../libs/common/src/state-migrations/migrations/25-move-clear-clipboard-to-autofill-settings-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/26-revert-move-last-sync-to-state-provider.ts","webpack:///../../libs/common/src/state-migrations/migrations/3-fix-premium.ts","webpack:///../../libs/common/src/state-migrations/migrations/4-remove-ever-been-unlocked.ts","webpack:///../../libs/common/src/state-migrations/migrations/5-add-key-type-to-org-keys.ts","webpack:///../../libs/common/src/state-migrations/migrations/6-remove-legacy-etm-key.ts","webpack:///../../libs/common/src/state-migrations/migrations/7-move-biometric-auto-prompt-to-account.ts","webpack:///../../libs/common/src/state-migrations/migrations/8-move-state-version.ts","webpack:///../../libs/common/src/state-migrations/migrations/9-move-browser-settings-to-global.ts","webpack:///../../libs/common/src/state-migrations/migrations/min-version.ts","webpack:///../../libs/common/src/state-migrations/migrate.ts","webpack:///../../libs/common/src/platform/services/migration-builder.service.ts","webpack:///../../libs/common/src/state-migrations/migration-helper.ts","webpack:///../../libs/common/src/platform/services/migration-runner.ts","webpack:///../../libs/common/src/enums/vault-timeout-action.enum.ts","webpack:///../../libs/common/src/platform/services/system.service.ts","webpack:///../../libs/common/src/platform/models/domain/decrypt-parameters.ts","webpack:///../../libs/common/src/platform/services/web-crypto-function.service.ts","webpack:///../../libs/common/src/platform/state/state-update-options.ts","webpack:///../../libs/common/src/platform/state/user-state.ts","webpack:///../../libs/common/src/platform/state/implementations/util.ts","webpack:///../../libs/common/src/platform/state/implementations/default-active-user-state.ts","webpack:///../../libs/common/src/platform/state/implementations/default-active-user-state.provider.ts","webpack:///../../libs/common/src/platform/state/implementations/default-global-state.ts","webpack:///../../libs/common/src/platform/state/implementations/default-global-state.provider.ts","webpack:///../../libs/common/src/platform/state/implementations/default-single-user-state.ts","webpack:///../../libs/common/src/platform/state/implementations/default-single-user-state.provider.ts","webpack:///../../libs/common/src/platform/state/implementations/default-state.provider.ts","webpack:///../../libs/common/src/models/request/update-avatar.request.ts","webpack:///../../libs/common/src/services/account/avatar-update.service.ts","webpack:///../../libs/common/src/admin-console/models/response/organization-connection.response.ts","webpack:///../../libs/common/src/vault/models/api/card.api.ts","webpack:///../../libs/common/src/vault/models/api/field.api.ts","webpack:///../../libs/common/src/vault/models/api/identity.api.ts","webpack:///../../libs/common/src/vault/models/api/fido2-credential.api.ts","webpack:///../../libs/common/src/vault/models/api/login-uri.api.ts","webpack:///../../libs/common/src/vault/models/api/login.api.ts","webpack:///../../libs/common/src/vault/models/api/secure-note.api.ts","webpack:///../../libs/common/src/vault/models/response/attachment.response.ts","webpack:///../../libs/common/src/vault/models/response/password-history.response.ts","webpack:///../../libs/common/src/vault/models/response/cipher.response.ts","webpack:///../../libs/common/src/admin-console/models/response/selection-read-only.response.ts","webpack:///../../libs/common/src/vault/models/response/collection.response.ts","webpack:///../../libs/common/src/admin-console/models/response/organization-export.response.ts","webpack:///../../libs/common/src/admin-console/models/response/organization-sponsorship-sync-status.response.ts","webpack:///../../libs/common/src/admin-console/models/response/provider/provider-organization.response.ts","webpack:///../../libs/common/src/admin-console/abstractions/organization-user/responses/organization-user-bulk-public-key.response.ts","webpack:///../../libs/common/src/admin-console/models/response/provider/provider-user-bulk-public-key.response.ts","webpack:///../../libs/common/src/admin-console/models/response/provider/provider-user-bulk.response.ts","webpack:///../../libs/common/src/admin-console/models/api/permissions.api.ts","webpack:///../../libs/common/src/admin-console/models/response/provider/provider-user.response.ts","webpack:///../../libs/common/src/admin-console/models/response/provider/provider.response.ts","webpack:///../../libs/common/src/auth/models/response/api-key.response.ts","webpack:///../../libs/common/src/auth/models/response/auth-request.response.ts","webpack:///../../libs/common/src/auth/models/response/device-verification.response.ts","webpack:///../../libs/common/src/auth/models/response/key-connector-user-key.response.ts","webpack:///../../libs/common/src/auth/models/response/prelogin.response.ts","webpack:///../../libs/common/src/auth/models/response/register.response.ts","webpack:///../../libs/common/src/auth/models/response/sso-pre-validate.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-authenticator.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-duo.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-email.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-provider.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-recover.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-web-authn.response.ts","webpack:///../../libs/common/src/auth/models/response/two-factor-yubi-key.response.ts","webpack:///../../libs/common/src/billing/models/response/billing.response.ts","webpack:///../../libs/common/src/billing/models/response/billing-history.response.ts","webpack:///../../libs/common/src/billing/models/response/billing-payment.response.ts","webpack:///../../libs/common/src/admin-console/models/response/profile-organization.response.ts","webpack:///../../libs/common/src/admin-console/models/response/profile-provider-organization.response.ts","webpack:///../../libs/common/src/admin-console/models/response/profile-provider.response.ts","webpack:///../../libs/common/src/models/response/profile.response.ts","webpack:///../../libs/common/src/billing/models/response/payment.response.ts","webpack:///../../libs/common/src/billing/models/response/plan.response.ts","webpack:///../../libs/common/src/billing/models/response/subscription.response.ts","webpack:///../../libs/common/src/billing/models/response/tax-info.response.ts","webpack:///../../libs/common/src/billing/models/response/tax-rate.response.ts","webpack:///../../libs/common/src/models/request/collection-bulk-delete.request.ts","webpack:///../../libs/common/src/models/response/breach-account.response.ts","webpack:///../../libs/common/src/models/response/global-domain.response.ts","webpack:///../../libs/common/src/models/response/domains.response.ts","webpack:///../../libs/common/src/models/response/event.response.ts","webpack:///../../libs/common/src/models/response/user-key.response.ts","webpack:///../../libs/common/src/vault/models/response/attachment-upload-data.response.ts","webpack:///../../libs/common/src/tools/send/models/api/send-file.api.ts","webpack:///../../libs/common/src/tools/send/models/api/send-text.api.ts","webpack:///../../libs/common/src/tools/send/models/response/send.response.ts","webpack:///../../libs/common/src/vault/models/response/folder.response.ts","webpack:///../../libs/common/src/vault/models/response/sync.response.ts","webpack:///../../libs/common/src/services/api.service.ts","webpack:///../../libs/common/src/services/audit.service.ts","webpack:///../../libs/common/src/platform/misc/throttle.ts","webpack:///../../libs/common/src/models/data/event.data.ts","webpack:///../../libs/common/src/services/event/event-collection.service.ts","webpack:///../../libs/common/src/models/request/event.request.ts","webpack:///../../libs/common/src/services/event/event-upload.service.ts","webpack:///../../libs/common/src/models/response/notification.response.ts","webpack:///../../libs/common/src/services/notifications.service.ts","webpack:///../../libs/common/src/services/search.service.ts","webpack:///../../libs/common/src/services/vault-timeout/vault-timeout-settings.service.ts","webpack:///../../libs/common/src/tools/generator/password/password-generator-options-evaluator.ts","webpack:///../../libs/common/src/tools/generator/password/password-generation-options.ts","webpack:///../../libs/common/src/tools/generator/key-definitions.ts","webpack:///../../libs/common/src/admin-console/models/domain/password-generator-policy-options.ts","webpack:///../../libs/common/src/platform/misc/wordlist.ts","webpack:///../../libs/common/src/tools/generator/passphrase/passphrase-generation-options.ts","webpack:///../../libs/common/src/tools/generator/passphrase/passphrase-generator-options-evaluator.ts","webpack:///../../libs/common/src/tools/generator/password/generated-password-history.ts","webpack:///../../libs/common/src/tools/generator/password/password-generation.service.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/anon-addy-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/duck-duck-go-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/fastmail-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/firefox-relay-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/forwarder-options.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/simple-login-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/email-forwarders/forward-email-forwarder.ts","webpack:///../../libs/common/src/tools/generator/username/username-generation.service.ts","webpack:///../../libs/common/src/tools/send/enums/send-type.ts","webpack:///../../libs/common/src/tools/password-strength/password-strength.service.ts","webpack:///../../libs/common/src/tools/send/models/data/send-file.data.ts","webpack:///../../libs/common/src/tools/send/models/data/send-text.data.ts","webpack:///../../libs/common/src/tools/send/models/data/send.data.ts","webpack:///../../libs/common/src/tools/send/models/request/send.request.ts","webpack:///../../libs/common/src/tools/send/models/response/send-access.response.ts","webpack:///../../libs/common/src/tools/send/models/response/send-file-download-data.response.ts","webpack:///../../libs/common/src/tools/send/models/response/send-file-upload-data.response.ts","webpack:///../../libs/common/src/tools/send/services/send-api.service.ts","webpack:///../../libs/common/src/platform/misc/flags.ts","webpack:///../../libs/common/src/platform/misc/sequentialize.ts","webpack:///../../libs/common/src/vault/models/domain/sorted-ciphers-cache.ts","webpack:///../../libs/common/src/vault/models/request/cipher-bulk-delete.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-bulk-move.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-bulk-restore.request.ts","webpack:///../../libs/common/src/vault/models/request/attachment.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-with-id.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-bulk-share.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-collections.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-create.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-partial.request.ts","webpack:///../../libs/common/src/vault/models/request/cipher-share.request.ts","webpack:///../../libs/common/src/vault/services/cipher.service.ts","webpack:///../../libs/common/src/vault/models/data/collection.data.ts","webpack:///../../libs/common/src/vault/models/view/collection.view.ts","webpack:///../../libs/common/src/vault/models/domain/collection.ts","webpack:///../../libs/common/src/vault/models/domain/tree-node.ts","webpack:///../../libs/common/src/vault/service-utils.ts","webpack:///../../libs/common/src/vault/services/collection.service.ts","webpack:///../../libs/common/src/vault/abstractions/fido2/fido2-authenticator.service.abstraction.ts","webpack:///../../libs/common/src/vault/services/fido2/cbor.ts","webpack:///../../libs/common/src/vault/services/fido2/ecdsa-utils.ts","webpack:///../../libs/common/src/vault/services/fido2/fido2-utils.ts","webpack:///../../libs/common/src/vault/services/fido2/guid-utils.ts","webpack:///../../libs/common/src/vault/services/fido2/fido2-authenticator.service.ts","webpack:///../../libs/common/src/vault/abstractions/fido2/fido2-client.service.abstraction.ts","webpack:///../../libs/common/src/vault/services/fido2/domain-utils.ts","webpack:///../../libs/common/src/vault/services/fido2/fido2-client.service.ts","webpack:///../../libs/common/src/vault/services/file-upload/cipher-file-upload.service.ts","webpack:///../../libs/common/src/vault/models/data/folder.data.ts","webpack:///../../libs/common/src/vault/models/request/folder.request.ts","webpack:///../../libs/common/src/vault/services/folder/folder-api.service.ts","webpack:///../../libs/common/src/vault/models/view/folder.view.ts","webpack:///../../libs/common/src/vault/models/domain/folder.ts","webpack:///../../libs/common/src/vault/services/key-state/folder.state.ts","webpack:///../../libs/common/src/vault/services/folder/folder.service.ts","webpack:///../../libs/common/src/vault/services/sync/sync-notifier.service.ts","webpack:///../../libs/common/src/admin-console/models/data/organization.data.ts","webpack:///../../libs/common/src/admin-console/models/data/provider.data.ts","webpack:///../../libs/common/src/vault/services/sync/sync.service.ts","webpack:///../../libs/common/src/vault/services/totp.service.ts","webpack:///../../libs/common/src/vault/services/key-state/enable-passkey.state.ts","webpack:///../../libs/common/src/vault/services/vault-settings/vault-settings.service.ts","webpack:///../../libs/importer/src/services/import-api.service.ts","webpack:///../../libs/common/src/models/request/import-ciphers.request.ts","webpack:///../../libs/common/src/models/request/import-organization-ciphers.request.ts","webpack:///../../libs/common/src/models/request/kvp.request.ts","webpack:///../../libs/common/src/vault/models/request/collection.request.ts","webpack:///../../libs/common/src/vault/models/request/collection-with-id.request.ts","webpack:///../../libs/common/src/vault/models/request/folder-with-id.request.ts","webpack:///../../libs/importer/src/models/import-result.ts","webpack:///../../libs/importer/src/importers/base-importer.ts","webpack:///../../libs/importer/src/importers/ascendo-csv-importer.ts","webpack:///../../libs/importer/src/importers/avast/avast-csv-importer.ts","webpack:///../../libs/importer/src/importers/avast/avast-json-importer.ts","webpack:///../../libs/importer/src/importers/avira-csv-importer.ts","webpack:///../../libs/importer/src/importers/blackberry-csv-importer.ts","webpack:///../../libs/importer/src/importers/chrome-csv-importer.ts","webpack:///../../libs/importer/src/importers/bitwarden/bitwarden-csv-importer.ts","webpack:///../../libs/common/src/models/export/card.export.ts","webpack:///../../libs/common/src/models/export/field.export.ts","webpack:///../../libs/common/src/models/export/identity.export.ts","webpack:///../../libs/common/src/models/export/fido2-credential.export.ts","webpack:///../../libs/common/src/models/export/login-uri.export.ts","webpack:///../../libs/common/src/models/export/login.export.ts","webpack:///../../libs/common/src/models/export/password-history.export.ts","webpack:///../../libs/common/src/models/export/secure-note.export.ts","webpack:///../../libs/common/src/models/export/cipher.export.ts","webpack:///../../libs/common/src/models/export/cipher-with-ids.export.ts","webpack:///../../libs/common/src/models/export/collection.export.ts","webpack:///../../libs/common/src/models/export/collection-with-id.export.ts","webpack:///../../libs/common/src/models/export/folder.export.ts","webpack:///../../libs/common/src/models/export/folder-with-id.export.ts","webpack:///../../libs/importer/src/importers/bitwarden/bitwarden-json-importer.ts","webpack:///../../libs/importer/src/importers/bitwarden/bitwarden-password-protected-importer.ts","webpack:///../../libs/importer/src/importers/blur-csv-importer.ts","webpack:///../../libs/importer/src/importers/buttercup-csv-importer.ts","webpack:///../../libs/importer/src/importers/clipperz-html-importer.ts","webpack:///../../libs/importer/src/importers/codebook-csv-importer.ts","webpack:///../../libs/importer/src/importers/dashlane/dashlane-csv-importer.ts","webpack:///../../libs/importer/src/importers/dashlane/dashlane-json-importer.ts","webpack:///../../libs/importer/src/importers/encryptr-csv-importer.ts","webpack:///../../libs/importer/src/importers/enpass/enpass-csv-importer.ts","webpack:///../../libs/importer/src/importers/enpass/enpass-json-importer.ts","webpack:///../../libs/importer/src/importers/firefox-csv-importer.ts","webpack:///../../libs/importer/src/importers/fsecure/fsecure-fsk-types.ts","webpack:///../../libs/importer/src/importers/fsecure/fsecure-fsk-importer.ts","webpack:///../../libs/importer/src/importers/gnome-json-importer.ts","webpack:///../../libs/importer/src/importers/kaspersky-txt-importer.ts","webpack:///../../libs/importer/src/importers/keepass2-xml-importer.ts","webpack:///../../libs/importer/src/importers/keepassx-csv-importer.ts","webpack:///../../libs/importer/src/importers/keeper/keeper-csv-importer.ts","webpack:///../../libs/importer/src/importers/lastpass-csv-importer.ts","webpack:///../../libs/importer/src/importers/logmeonce-csv-importer.ts","webpack:///../../libs/importer/src/importers/meldium-csv-importer.ts","webpack:///../../libs/importer/src/importers/msecure-csv-importer.ts","webpack:///../../libs/importer/src/importers/myki-csv-importer.ts","webpack:///../../libs/importer/src/importers/nordpass-csv-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-1pif-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/types/onepassword-1pux-importer-types.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-1pux-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/cipher-import-context.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-csv-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-mac-csv-importer.ts","webpack:///../../libs/importer/src/importers/onepassword/onepassword-win-csv-importer.ts","webpack:///../../libs/importer/src/importers/padlock-csv-importer.ts","webpack:///../../libs/importer/src/importers/passkeep-csv-importer.ts","webpack:///../../libs/importer/src/importers/passky/passky-json-importer.ts","webpack:///../../libs/importer/src/importers/passman-json-importer.ts","webpack:///../../libs/importer/src/importers/passpack-csv-importer.ts","webpack:///../../libs/importer/src/importers/passwordagent-csv-importer.ts","webpack:///../../libs/importer/src/importers/passwordboss-json-importer.ts","webpack:///../../libs/importer/src/importers/passworddragon-xml-importer.ts","webpack:///../../libs/importer/src/importers/passwordsafe-xml-importer.ts","webpack:///../../libs/importer/src/importers/passwordwallet-txt-importer.ts","webpack:///../../libs/importer/src/importers/protonpass/types/protonpass-json-type.ts","webpack:///../../libs/importer/src/importers/protonpass/protonpass-json-importer.ts","webpack:///../../libs/importer/src/importers/psono/psono-json-importer.ts","webpack:///../../libs/importer/src/importers/remembear-csv-importer.ts","webpack:///../../libs/importer/src/importers/roboform-csv-importer.ts","webpack:///../../libs/importer/src/importers/safari-csv-importer.ts","webpack:///../../libs/importer/src/importers/safeincloud-xml-importer.ts","webpack:///../../libs/importer/src/importers/saferpass-csv-importer.ts","webpack:///../../libs/importer/src/importers/securesafe-csv-importer.ts","webpack:///../../libs/importer/src/importers/splashid-csv-importer.ts","webpack:///../../libs/importer/src/importers/stickypassword-xml-importer.ts","webpack:///../../libs/importer/src/importers/truekey-csv-importer.ts","webpack:///../../libs/importer/src/importers/upm-csv-importer.ts","webpack:///../../libs/importer/src/importers/yoti-csv-importer.ts","webpack:///../../libs/importer/src/importers/zohovault-csv-importer.ts","webpack:///../../libs/importer/src/models/import-options.ts","webpack:///../../libs/importer/src/services/import.service.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/export-helper.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/vault-export.service.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/base-vault-export.service.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/org-vault-export.service.ts","webpack:///../../libs/tools/export/vault-export/vault-export-core/src/services/individual-vault-export.service.ts","webpack:///../../libs/common/src/admin-console/models/domain/organization.ts","webpack:///../../libs/common/src/admin-console/abstractions/organization/organization.service.abstraction.ts","webpack:///../../libs/common/src/admin-console/services/organization/organization.service.ts","webpack:///./src/browser/safariApp.ts","webpack:///./src/platform/services/browser-platform-utils.service.ts","webpack:///./src/platform/browser/browser-api.ts","webpack:///./src/platform/decorators/session-sync-observable/sync-item-metadata.ts","webpack:///./src/platform/decorators/session-sync-observable/session-syncer.ts","webpack:///./src/platform/decorators/session-sync-observable/browser-session.decorator.ts","webpack:///./src/platform/decorators/session-sync-observable/session-sync.decorator.ts","webpack:///./src/admin-console/services/browser-organization.service.ts","webpack:///../../libs/common/src/admin-console/models/domain/policy.ts","webpack:///../../libs/common/src/admin-console/models/domain/reset-password-policy-options.ts","webpack:///../../libs/common/src/admin-console/services/policy/policy.service.ts","webpack:///./src/admin-console/services/browser-policy.service.ts","webpack:///./src/autofill/background/context-menus.background.ts","webpack:///./src/platform/popup/browser-popup-utils.ts","webpack:///./src/auth/popup/utils/auth-popout-window.ts","webpack:///./src/vault/popup/utils/vault-popout-window.ts","webpack:///./src/autofill/enums/notification-queue-message-type.enum.ts","webpack:///./src/autofill/background/notification.background.ts","webpack:///../../libs/common/src/vault/icon/build-cipher-icon.ts","webpack:///./src/autofill/background/overlay.background.ts","webpack:///./src/autofill/background/tabs.background.ts","webpack:///./src/autofill/background/web-request.background.ts","webpack:///./src/platform/background/service-factories/factory-options.ts","webpack:///./src/platform/services/abstractions/abstract-chrome-storage-api.service.ts","webpack:///./src/platform/browser/from-chrome-event.ts","webpack:///./src/platform/services/browser-local-storage.service.ts","webpack:///./src/platform/flags.ts","webpack:///./src/platform/services/browser-memory-storage.service.ts","webpack:///./src/platform/services/local-backed-session-storage.service.ts","webpack:///./src/platform/decorators/dev-flag.decorator.ts","webpack:///../../libs/common/src/platform/state/storage/memory-storage.service.ts","webpack:///./src/platform/storage/background-memory-storage.service.ts","webpack:///./src/platform/storage/port-name.ts","webpack:///./src/platform/background/service-factories/log-service.factory.ts","webpack:///./src/platform/background/service-factories/crypto-function-service.factory.ts","webpack:///./src/platform/background/service-factories/encrypt-service.factory.ts","webpack:///./src/platform/background/service-factories/key-generation-service.factory.ts","webpack:///./src/platform/background/service-factories/storage-service.factory.ts","webpack:///./src/platform/background/service-factories/global-state-provider.factory.ts","webpack:///./src/platform/services/browser-messaging.service.ts","webpack:///./src/platform/background/service-factories/messaging-service.factory.ts","webpack:///../../libs/common/src/platform/abstractions/environment.service.ts","webpack:///./src/auth/background/service-factories/account-service.factory.ts","webpack:///../../libs/common/src/platform/abstractions/log.service.ts","webpack:///../../libs/common/src/tools/send/models/view/send-file.view.ts","webpack:///../../libs/common/src/tools/send/models/view/send-text.view.ts","webpack:///../../libs/common/src/tools/send/models/view/send.view.ts","webpack:///../../libs/common/src/platform/models/domain/state.ts","webpack:///../../libs/common/src/platform/services/state.service.ts","webpack:///./src/models/browserComponentState.ts","webpack:///./src/models/browserGroupingsComponentState.ts","webpack:///./src/models/browserSendComponentState.ts","webpack:///./src/models/account.ts","webpack:///./src/platform/services/browser-state.service.ts","webpack:///../../libs/common/src/auth/models/domain/environment-urls.ts","webpack:///../../libs/common/src/platform/services/environment.service.ts","webpack:///./src/platform/services/browser-environment.service.ts","webpack:///../../libs/common/src/platform/state/implementations/default-derived-state.ts","webpack:///../../libs/common/src/platform/state/implementations/default-derived-state.provider.ts","webpack:///./src/platform/state/background-derived-state.ts","webpack:///./src/platform/state/background-derived-state.provider.ts","webpack:///./src/platform/background/service-factories/state-provider.factory.ts","webpack:///./src/platform/background/service-factories/active-user-state-provider.factory.ts","webpack:///./src/platform/background/service-factories/single-user-state-provider.factory.ts","webpack:///./src/platform/background/service-factories/derived-state-provider.factory.ts","webpack:///./src/platform/background/service-factories/environment-service.factory.ts","webpack:///./src/platform/background/service-factories/state-service.factory.ts","webpack:///./src/platform/background/service-factories/migration-runner.factory.ts","webpack:///./src/auth/background/service-factories/token-service.factory.ts","webpack:///./src/platform/background/service-factories/platform-utils-service.factory.ts","webpack:///./src/platform/background/service-factories/api-service.factory.ts","webpack:///./src/platform/background/service-factories/app-id-service.factory.ts","webpack:///../../libs/common/src/admin-console/models/domain/encrypted-organization-key.ts","webpack:///../../libs/common/src/platform/services/key-state/org-keys.state.ts","webpack:///../../libs/common/src/platform/services/key-state/provider-keys.state.ts","webpack:///../../libs/common/src/platform/services/key-state/user-key.state.ts","webpack:///../../libs/common/src/platform/services/crypto.service.ts","webpack:///./src/platform/services/browser-crypto.service.ts","webpack:///./src/platform/background/service-factories/crypto-service.factory.ts","webpack:///./src/auth/background/service-factories/auth-service.factory.ts","webpack:///./src/admin-console/background/service-factories/organization-service.factory.ts","webpack:///./src/admin-console/background/service-factories/policy-service.factory.ts","webpack:///./src/autofill/background/service_factories/autofill-settings-service.factory.ts","webpack:///./src/background/service-factories/cipher-file-upload-service.factory.ts","webpack:///./src/platform/background/service-factories/file-upload-service.factory.ts","webpack:///../../libs/common/src/platform/services/translation.service.ts","webpack:///../../libs/common/src/platform/services/i18n.service.ts","webpack:///./src/platform/services/i18n.service.ts","webpack:///./src/platform/background/service-factories/i18n-service.factory.ts","webpack:///../../libs/common/src/services/settings.service.ts","webpack:///./src/services/browser-settings.service.ts","webpack:///./src/background/service-factories/settings-service.factory.ts","webpack:///../../libs/common/src/platform/abstractions/config/server-config.ts","webpack:///../../libs/common/src/platform/services/config/config.service.ts","webpack:///./src/platform/background/service-factories/config-service.factory.ts","webpack:///./src/platform/background/service-factories/config-api.service.factory.ts","webpack:///./src/vault/background/service_factories/cipher-service.factory.ts","webpack:///./src/background/service-factories/search-service.factory.ts","webpack:///./src/autofill/browser/main-context-menu-handler.ts","webpack:///./src/autofill/browser/cipher-context-menu-handler.ts","webpack:///./src/background/service-factories/vault-timeout-settings-service.factory.ts","webpack:///./src/auth/background/service-factories/user-verification-service.factory.ts","webpack:///./src/auth/background/service-factories/user-verification-api-service.factory.ts","webpack:///./src/auth/background/service-factories/pin-crypto-service.factory.ts","webpack:///./src/background/service-factories/event-collection-service.factory.ts","webpack:///./src/background/service-factories/event-upload-service.factory.ts","webpack:///./src/tools/background/service_factories/password-generation-service.factory.ts","webpack:///./src/vault/background/service_factories/totp-service.factory.ts","webpack:///./src/autofill/enums/autofill-port.enums.ts","webpack:///./src/autofill/models/autofill-script.ts","webpack:///./src/autofill/services/autofill-constants.ts","webpack:///./src/autofill/services/autofill.service.ts","webpack:///./src/autofill/background/service_factories/autofill-service.factory.ts","webpack:///./src/autofill/clipboard/clear-clipboard.ts","webpack:///./src/autofill/clipboard/copy-to-clipboard-command.ts","webpack:///./src/platform/alarms/alarm-state.ts","webpack:///./src/autofill/clipboard/generate-password-to-clipboard-command.ts","webpack:///./src/autofill/commands/autofill-tab-command.ts","webpack:///./src/autofill/browser/context-menu-clicked-handler.ts","webpack:///./src/platform/listeners/update-badge.ts","webpack:///../../libs/common/src/platform/abstractions/state.service.ts","webpack:///./src/platform/services/browser-config.service.ts","webpack:///../../libs/common/src/platform/abstractions/config/config-api.service.abstraction.ts","webpack:///../../libs/common/src/auth/abstractions/auth.service.ts","webpack:///./src/platform/services/browser-i18n.service.ts","webpack:///./src/platform/services/browser-messaging-private-mode-background.service.ts","webpack:///../../libs/common/src/tools/send/models/domain/send-file.ts","webpack:///../../libs/common/src/tools/send/models/domain/send-text.ts","webpack:///../../libs/common/src/tools/send/models/domain/send.ts","webpack:///../../libs/common/src/tools/send/models/request/send-with-id.request.ts","webpack:///../../libs/common/src/tools/send/services/send.service.ts","webpack:///../../libs/common/src/tools/send/send-kdf.ts","webpack:///./src/services/browser-send.service.ts","webpack:///../../libs/common/src/services/vault-timeout/vault-timeout.service.ts","webpack:///../../libs/common/src/enums/feature-flag.enum.ts","webpack:///./src/services/vault-timeout/vault-timeout.service.ts","webpack:///./src/tools/enums/fileless-import.enums.ts","webpack:///./src/tools/background/fileless-importer.background.ts","webpack:///./src/vault/fido2/browser-fido2-user-interface.service.ts","webpack:///./src/vault/services/fido2.service.ts","webpack:///../../libs/angular/src/vault/vault-filter/models/vault-filter.model.ts","webpack:///../../libs/angular/src/vault/vault-filter/models/dynamic-tree-node.model.ts","webpack:///../../libs/common/src/vault/services/key-state/collapsed-groupings.state.ts","webpack:///../../libs/common/src/vault/abstractions/folder/folder.service.abstraction.ts","webpack:///../../libs/common/src/vault/abstractions/cipher.service.ts","webpack:///../../libs/common/src/vault/abstractions/collection.service.ts","webpack:///../../libs/common/src/admin-console/abstractions/policy/policy.service.abstraction.ts","webpack:///../../libs/angular/src/vault/vault-filter/services/vault-filter.service.ts","webpack:///./src/vault/services/vault-filter.service.ts","webpack:///./src/background/commands.background.ts","webpack:///./src/background/idle.background.ts","webpack:///./src/background/nativeMessaging.background.ts","webpack:///./src/vault/background/abort-manager.ts","webpack:///./src/background/runtime.background.ts","webpack:///./src/background/main.background.ts","webpack:///./src/platform/alarms/on-alarm-listener.ts","webpack:///./src/platform/listeners/combine.ts","webpack:///./src/platform/listeners/on-command-listener.ts","webpack:///./src/platform/listeners/index.ts","webpack:///./src/platform/background.ts","webpack:///./src/platform/listeners/on-install-listener.ts","webpack:///./src/platform/alarms/register-alarms.ts","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/get javascript chunk filename","webpack:///webpack/runtime/global","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///webpack/runtime/node module decorator","webpack:///webpack/runtime/publicPath","webpack:///webpack/runtime/jsonp chunk loading","webpack:///webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","export enum AuthenticationType {\n  Password = 0,\n  Sso = 1,\n  UserApi = 2,\n  AuthRequest = 3,\n  WebAuthn = 4,\n}\n","export enum EncryptionType {\n  AesCbc256_B64 = 0,\n  AesCbc128_HmacSha256_B64 = 1,\n  AesCbc256_HmacSha256_B64 = 2,\n  Rsa2048_OaepSha256_B64 = 3,\n  Rsa2048_OaepSha1_B64 = 4,\n  Rsa2048_OaepSha256_HmacSha256_B64 = 5,\n  Rsa2048_OaepSha1_HmacSha256_B64 = 6,\n}\n\n/** The expected number of parts to a serialized EncString of the given encryption type.\n * For example, an EncString of type AesCbc256_B64 will have 2 parts, and an EncString of type\n * AesCbc128_HmacSha256_B64 will have 3 parts.\n *\n * Example of annotated serialized EncStrings:\n * 0.iv|data\n * 1.iv|data|mac\n * 2.iv|data|mac\n * 3.data\n * 4.data\n *\n * @see EncString\n * @see EncryptionType\n * @see EncString.parseEncryptedString\n */\nexport const EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE = {\n  [EncryptionType.AesCbc256_B64]: 2,\n  [EncryptionType.AesCbc128_HmacSha256_B64]: 3,\n  [EncryptionType.AesCbc256_HmacSha256_B64]: 3,\n  [EncryptionType.Rsa2048_OaepSha256_B64]: 1,\n  [EncryptionType.Rsa2048_OaepSha1_B64]: 1,\n  [EncryptionType.Rsa2048_OaepSha256_HmacSha256_B64]: 2,\n  [EncryptionType.Rsa2048_OaepSha1_HmacSha256_B64]: 2,\n};\n","export enum FileUploadType {\n  Direct = 0,\n  Azure = 1,\n}\n","export enum HashPurpose {\n  ServerAuthorization = 1,\n  LocalAuthorization = 2,\n}\n","export enum HtmlStorageLocation {\n  Local = \"local\",\n  Memory = \"memory\",\n  Session = \"session\",\n}\n","import { KdfConfig } from \"../../auth/models/domain/kdf-config\";\nimport { RangeWithDefault } from \"../misc/range-with-default\";\n\nexport enum KdfType {\n  PBKDF2_SHA256 = 0,\n  Argon2id = 1,\n}\n\nexport const ARGON2_MEMORY = new RangeWithDefault(16, 1024, 64);\nexport const ARGON2_PARALLELISM = new RangeWithDefault(1, 16, 4);\nexport const ARGON2_ITERATIONS = new RangeWithDefault(2, 10, 3);\n\nexport const DEFAULT_KDF_TYPE = KdfType.PBKDF2_SHA256;\nexport const PBKDF2_ITERATIONS = new RangeWithDefault(600_000, 2_000_000, 600_000);\nexport const DEFAULT_KDF_CONFIG = new KdfConfig(PBKDF2_ITERATIONS.defaultValue);\n","export class KdfConfig {\n  iterations: number;\n  memory?: number;\n  parallelism?: number;\n\n  constructor(iterations: number, memory?: number, parallelism?: number) {\n    this.iterations = iterations;\n    this.memory = memory;\n    this.parallelism = parallelism;\n  }\n}\n","/**\n * A range with a default value.\n *\n * Enforces constraints to ensure min > default > max.\n */\nexport class RangeWithDefault {\n  constructor(\n    readonly min: number,\n    readonly max: number,\n    readonly defaultValue: number,\n  ) {\n    if (min > max) {\n      throw new Error(`${min} is greater than ${max}.`);\n    }\n\n    if (this.inRange(defaultValue) === false) {\n      throw new Error(\"Default value is not in range.\");\n    }\n  }\n\n  inRange(value: number): boolean {\n    return value >= this.min && value <= this.max;\n  }\n}\n","export enum KeySuffixOptions {\n  Auto = \"auto\",\n  Biometric = \"biometric\",\n  Pin = \"pin\",\n}\n","export enum LogLevelType {\n  Debug,\n  Info,\n  Warning,\n  Error,\n}\n","export enum StorageLocation {\n  Both = \"both\",\n  Disk = \"disk\",\n  Memory = \"memory\",\n}\n","export enum ThemeType {\n  System = \"system\",\n  Light = \"light\",\n  Dark = \"dark\",\n  Nord = \"nord\",\n  SolarizedDark = \"solarizedDark\",\n}\n","/* eslint-disable no-useless-escape */\nimport * as path from \"path\";\n\nimport { Buffer as BufferLib } from \"buffer/\";\nimport { Observable, of, switchMap } from \"rxjs\";\nimport { getHostname, parse } from \"tldts\";\nimport { Merge } from \"type-fest\";\n\nimport { CryptoService } from \"../abstractions/crypto.service\";\nimport { EncryptService } from \"../abstractions/encrypt.service\";\nimport { I18nService } from \"../abstractions/i18n.service\";\n\nconst nodeURL = typeof window === \"undefined\" ? require(\"url\") : null;\n\ndeclare global {\n  /* eslint-disable-next-line no-var */\n  var bitwardenContainerService: BitwardenContainerService;\n}\n\ninterface BitwardenContainerService {\n  getCryptoService: () => CryptoService;\n  getEncryptService: () => EncryptService;\n}\n\nexport class Utils {\n  static inited = false;\n  static isNode = false;\n  static isBrowser = true;\n  static isMobileBrowser = false;\n  static isAppleMobileBrowser = false;\n  static global: typeof global = null;\n  // Transpiled version of /\\p{Emoji_Presentation}/gu using https://mothereff.in/regexpu. Used for compatability in older browsers.\n  static regexpEmojiPresentation =\n    /(?:[\\u231A\\u231B\\u23E9-\\u23EC\\u23F0\\u23F3\\u25FD\\u25FE\\u2614\\u2615\\u2648-\\u2653\\u267F\\u2693\\u26A1\\u26AA\\u26AB\\u26BD\\u26BE\\u26C4\\u26C5\\u26CE\\u26D4\\u26EA\\u26F2\\u26F3\\u26F5\\u26FA\\u26FD\\u2705\\u270A\\u270B\\u2728\\u274C\\u274E\\u2753-\\u2755\\u2757\\u2795-\\u2797\\u27B0\\u27BF\\u2B1B\\u2B1C\\u2B50\\u2B55]|\\uD83C[\\uDC04\\uDCCF\\uDD8E\\uDD91-\\uDD9A\\uDDE6-\\uDDFF\\uDE01\\uDE1A\\uDE2F\\uDE32-\\uDE36\\uDE38-\\uDE3A\\uDE50\\uDE51\\uDF00-\\uDF20\\uDF2D-\\uDF35\\uDF37-\\uDF7C\\uDF7E-\\uDF93\\uDFA0-\\uDFCA\\uDFCF-\\uDFD3\\uDFE0-\\uDFF0\\uDFF4\\uDFF8-\\uDFFF]|\\uD83D[\\uDC00-\\uDC3E\\uDC40\\uDC42-\\uDCFC\\uDCFF-\\uDD3D\\uDD4B-\\uDD4E\\uDD50-\\uDD67\\uDD7A\\uDD95\\uDD96\\uDDA4\\uDDFB-\\uDE4F\\uDE80-\\uDEC5\\uDECC\\uDED0-\\uDED2\\uDED5-\\uDED7\\uDEEB\\uDEEC\\uDEF4-\\uDEFC\\uDFE0-\\uDFEB]|\\uD83E[\\uDD0C-\\uDD3A\\uDD3C-\\uDD45\\uDD47-\\uDD78\\uDD7A-\\uDDCB\\uDDCD-\\uDDFF\\uDE70-\\uDE74\\uDE78-\\uDE7A\\uDE80-\\uDE86\\uDE90-\\uDEA8\\uDEB0-\\uDEB6\\uDEC0-\\uDEC2\\uDED0-\\uDED6])/g;\n  static readonly validHosts: string[] = [\"localhost\"];\n  static readonly originalMinimumPasswordLength = 8;\n  static readonly minimumPasswordLength = 12;\n  static readonly DomainMatchBlacklist = new Map<string, Set<string>>([\n    [\"google.com\", new Set([\"script.google.com\"])],\n  ]);\n\n  static init() {\n    if (Utils.inited) {\n      return;\n    }\n\n    Utils.inited = true;\n    Utils.isNode =\n      typeof process !== \"undefined\" &&\n      (process as any).release != null &&\n      (process as any).release.name === \"node\";\n    Utils.isBrowser = typeof window !== \"undefined\";\n\n    Utils.isMobileBrowser = Utils.isBrowser && this.isMobile(window);\n    Utils.isAppleMobileBrowser = Utils.isBrowser && this.isAppleMobile(window);\n\n    if (Utils.isNode) {\n      Utils.global = global;\n    } else if (Utils.isBrowser) {\n      Utils.global = window;\n    } else {\n      // If it's not browser or node then it must be a service worker\n      Utils.global = self;\n    }\n  }\n\n  static fromB64ToArray(str: string): Uint8Array {\n    if (str == null) {\n      return null;\n    }\n\n    if (Utils.isNode) {\n      return new Uint8Array(Buffer.from(str, \"base64\"));\n    } else {\n      const binaryString = Utils.global.atob(str);\n      const bytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n      }\n      return bytes;\n    }\n  }\n\n  static fromUrlB64ToArray(str: string): Uint8Array {\n    return Utils.fromB64ToArray(Utils.fromUrlB64ToB64(str));\n  }\n\n  static fromHexToArray(str: string): Uint8Array {\n    if (Utils.isNode) {\n      return new Uint8Array(Buffer.from(str, \"hex\"));\n    } else {\n      const bytes = new Uint8Array(str.length / 2);\n      for (let i = 0; i < str.length; i += 2) {\n        bytes[i / 2] = parseInt(str.substr(i, 2), 16);\n      }\n      return bytes;\n    }\n  }\n\n  static fromUtf8ToArray(str: string): Uint8Array {\n    if (Utils.isNode) {\n      return new Uint8Array(Buffer.from(str, \"utf8\"));\n    } else {\n      const strUtf8 = unescape(encodeURIComponent(str));\n      const arr = new Uint8Array(strUtf8.length);\n      for (let i = 0; i < strUtf8.length; i++) {\n        arr[i] = strUtf8.charCodeAt(i);\n      }\n      return arr;\n    }\n  }\n\n  static fromByteStringToArray(str: string): Uint8Array {\n    if (str == null) {\n      return null;\n    }\n    const arr = new Uint8Array(str.length);\n    for (let i = 0; i < str.length; i++) {\n      arr[i] = str.charCodeAt(i);\n    }\n    return arr;\n  }\n\n  static fromBufferToB64(buffer: ArrayBuffer): string {\n    if (buffer == null) {\n      return null;\n    }\n    if (Utils.isNode) {\n      return Buffer.from(buffer).toString(\"base64\");\n    } else {\n      let binary = \"\";\n      const bytes = new Uint8Array(buffer);\n      for (let i = 0; i < bytes.byteLength; i++) {\n        binary += String.fromCharCode(bytes[i]);\n      }\n      return Utils.global.btoa(binary);\n    }\n  }\n\n  static fromBufferToUrlB64(buffer: ArrayBuffer): string {\n    return Utils.fromB64toUrlB64(Utils.fromBufferToB64(buffer));\n  }\n\n  static fromB64toUrlB64(b64Str: string) {\n    return b64Str.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"\");\n  }\n\n  static fromBufferToUtf8(buffer: ArrayBuffer): string {\n    return BufferLib.from(buffer).toString(\"utf8\");\n  }\n\n  static fromBufferToByteString(buffer: ArrayBuffer): string {\n    return String.fromCharCode.apply(null, new Uint8Array(buffer));\n  }\n\n  // ref: https://stackoverflow.com/a/40031979/1090359\n  static fromBufferToHex(buffer: ArrayBuffer): string {\n    if (Utils.isNode) {\n      return Buffer.from(buffer).toString(\"hex\");\n    } else {\n      const bytes = new Uint8Array(buffer);\n      return Array.prototype.map\n        .call(bytes, (x: number) => (\"00\" + x.toString(16)).slice(-2))\n        .join(\"\");\n    }\n  }\n\n  /**\n   * Converts a hex string to an ArrayBuffer.\n   * Note: this doesn't need any Node specific code as parseInt() / ArrayBuffer / Uint8Array\n   * work the same in Node and the browser.\n   * @param {string} hexString - A string of hexadecimal characters.\n   * @returns {ArrayBuffer} The ArrayBuffer representation of the hex string.\n   */\n  static hexStringToArrayBuffer(hexString: string): ArrayBuffer {\n    // Check if the hexString has an even length, as each hex digit represents half a byte (4 bits),\n    // and it takes two hex digits to represent a full byte (8 bits).\n    if (hexString.length % 2 !== 0) {\n      throw \"HexString has to be an even length\";\n    }\n\n    // Create an ArrayBuffer with a length that is half the length of the hex string,\n    // because each pair of hex digits will become a single byte.\n    const arrayBuffer = new ArrayBuffer(hexString.length / 2);\n\n    // Create a Uint8Array view on top of the ArrayBuffer (each position represents a byte)\n    // as ArrayBuffers cannot be edited directly.\n    const uint8Array = new Uint8Array(arrayBuffer);\n\n    // Loop through the bytes\n    for (let i = 0; i < uint8Array.length; i++) {\n      // Extract two hex characters (1 byte)\n      const hexByte = hexString.substr(i * 2, 2);\n\n      // Convert hexByte into a decimal value from base 16. (ex: ff --> 255)\n      const byteValue = parseInt(hexByte, 16);\n\n      // Place the byte value into the uint8Array\n      uint8Array[i] = byteValue;\n    }\n\n    return arrayBuffer;\n  }\n\n  static fromUrlB64ToB64(urlB64Str: string): string {\n    let output = urlB64Str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    switch (output.length % 4) {\n      case 0:\n        break;\n      case 2:\n        output += \"==\";\n        break;\n      case 3:\n        output += \"=\";\n        break;\n      default:\n        throw new Error(\"Illegal base64url string!\");\n    }\n\n    return output;\n  }\n\n  static fromUrlB64ToUtf8(urlB64Str: string): string {\n    return Utils.fromB64ToUtf8(Utils.fromUrlB64ToB64(urlB64Str));\n  }\n\n  static fromUtf8ToB64(utfStr: string): string {\n    if (Utils.isNode) {\n      return Buffer.from(utfStr, \"utf8\").toString(\"base64\");\n    } else {\n      return decodeURIComponent(escape(Utils.global.btoa(utfStr)));\n    }\n  }\n\n  static fromUtf8ToUrlB64(utfStr: string): string {\n    return Utils.fromBufferToUrlB64(Utils.fromUtf8ToArray(utfStr));\n  }\n\n  static fromB64ToUtf8(b64Str: string): string {\n    if (Utils.isNode) {\n      return Buffer.from(b64Str, \"base64\").toString(\"utf8\");\n    } else {\n      return decodeURIComponent(escape(Utils.global.atob(b64Str)));\n    }\n  }\n\n  // ref: http://stackoverflow.com/a/2117523/1090359\n  static newGuid(): string {\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\n      const r = (Math.random() * 16) | 0;\n      const v = c === \"x\" ? r : (r & 0x3) | 0x8;\n      return v.toString(16);\n    });\n  }\n\n  static isGuid(id: string) {\n    return RegExp(\n      /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/,\n      \"i\",\n    ).test(id);\n  }\n\n  static getHostname(uriString: string): string {\n    if (Utils.isNullOrWhitespace(uriString)) {\n      return null;\n    }\n\n    uriString = uriString.trim();\n\n    if (uriString.startsWith(\"data:\")) {\n      return null;\n    }\n\n    if (uriString.startsWith(\"about:\")) {\n      return null;\n    }\n\n    if (uriString.startsWith(\"file:\")) {\n      return null;\n    }\n\n    // Does uriString contain invalid characters\n    // TODO Needs to possibly be extended, although '!' is a reserved character\n    if (uriString.indexOf(\"!\") > 0) {\n      return null;\n    }\n\n    try {\n      const hostname = getHostname(uriString, { validHosts: this.validHosts });\n      if (hostname != null) {\n        return hostname;\n      }\n    } catch {\n      return null;\n    }\n    return null;\n  }\n\n  static getHost(uriString: string): string {\n    const url = Utils.getUrl(uriString);\n    try {\n      return url != null && url.host !== \"\" ? url.host : null;\n    } catch {\n      return null;\n    }\n  }\n\n  static getDomain(uriString: string): string {\n    if (Utils.isNullOrWhitespace(uriString)) {\n      return null;\n    }\n\n    uriString = uriString.trim();\n\n    if (uriString.startsWith(\"data:\")) {\n      return null;\n    }\n\n    if (uriString.startsWith(\"about:\")) {\n      return null;\n    }\n\n    try {\n      const parseResult = parse(uriString, {\n        validHosts: this.validHosts,\n        allowPrivateDomains: true,\n      });\n      if (parseResult != null && parseResult.hostname != null) {\n        if (parseResult.hostname === \"localhost\" || parseResult.isIp) {\n          return parseResult.hostname;\n        }\n\n        if (parseResult.domain != null) {\n          return parseResult.domain;\n        }\n        return null;\n      }\n    } catch {\n      return null;\n    }\n    return null;\n  }\n\n  static getQueryParams(uriString: string): Map<string, string> {\n    const url = Utils.getUrl(uriString);\n    if (url == null || url.search == null || url.search === \"\") {\n      return null;\n    }\n    const map = new Map<string, string>();\n    const pairs = (url.search[0] === \"?\" ? url.search.substr(1) : url.search).split(\"&\");\n    pairs.forEach((pair) => {\n      const parts = pair.split(\"=\");\n      if (parts.length < 1) {\n        return;\n      }\n      map.set(\n        decodeURIComponent(parts[0]).toLowerCase(),\n        parts[1] == null ? \"\" : decodeURIComponent(parts[1]),\n      );\n    });\n    return map;\n  }\n\n  static getSortFunction<T>(\n    i18nService: I18nService,\n    prop: { [K in keyof T]: T[K] extends string ? K : never }[keyof T],\n  ): (a: T, b: T) => number {\n    return (a, b) => {\n      if (a[prop] == null && b[prop] != null) {\n        return -1;\n      }\n      if (a[prop] != null && b[prop] == null) {\n        return 1;\n      }\n      if (a[prop] == null && b[prop] == null) {\n        return 0;\n      }\n\n      // The `as unknown as string` here is unfortunate because typescript doesn't property understand that the return of T[prop] will be a string\n      return i18nService.collator\n        ? i18nService.collator.compare(a[prop] as unknown as string, b[prop] as unknown as string)\n        : (a[prop] as unknown as string).localeCompare(b[prop] as unknown as string);\n    };\n  }\n\n  static isNullOrWhitespace(str: string): boolean {\n    return str == null || typeof str !== \"string\" || str.trim() === \"\";\n  }\n\n  static isNullOrEmpty(str: string): boolean {\n    return str == null || typeof str !== \"string\" || str == \"\";\n  }\n\n  static isPromise(obj: any): obj is Promise<unknown> {\n    return (\n      obj != undefined && typeof obj[\"then\"] === \"function\" && typeof obj[\"catch\"] === \"function\"\n    );\n  }\n\n  static nameOf<T>(name: string & keyof T) {\n    return name;\n  }\n\n  static assign<T>(target: T, source: Partial<T>): T {\n    return Object.assign(target, source);\n  }\n\n  static iterateEnum<O extends object, K extends keyof O = keyof O>(obj: O) {\n    return (Object.keys(obj).filter((k) => Number.isNaN(+k)) as K[]).map((k) => obj[k]);\n  }\n\n  static getUrl(uriString: string): URL {\n    if (this.isNullOrWhitespace(uriString)) {\n      return null;\n    }\n\n    uriString = uriString.trim();\n\n    return Utils.getUrlObject(uriString);\n  }\n\n  static camelToPascalCase(s: string) {\n    return s.charAt(0).toUpperCase() + s.slice(1);\n  }\n\n  /**\n   * There are a few ways to calculate text color for contrast, this one seems to fit accessibility guidelines best.\n   * https://stackoverflow.com/a/3943023/6869691\n   *\n   * @param {string} bgColor\n   * @param {number} [threshold] see stackoverflow link above\n   * @param {boolean} [svgTextFill]\n   * Indicates if this method is performed on an SVG <text> 'fill' attribute (e.g. <text fill=\"black\"></text>).\n   * This check is necessary because the '!important' tag cannot be used in a 'fill' attribute.\n   */\n  static pickTextColorBasedOnBgColor(bgColor: string, threshold = 186, svgTextFill = false) {\n    const bgColorHexNums = bgColor.charAt(0) === \"#\" ? bgColor.substring(1, 7) : bgColor;\n    const r = parseInt(bgColorHexNums.substring(0, 2), 16); // hexToR\n    const g = parseInt(bgColorHexNums.substring(2, 4), 16); // hexToG\n    const b = parseInt(bgColorHexNums.substring(4, 6), 16); // hexToB\n    const blackColor = svgTextFill ? \"black\" : \"black !important\";\n    const whiteColor = svgTextFill ? \"white\" : \"white !important\";\n    return r * 0.299 + g * 0.587 + b * 0.114 > threshold ? blackColor : whiteColor;\n  }\n\n  static stringToColor(str: string): string {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      hash = str.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    let color = \"#\";\n    for (let i = 0; i < 3; i++) {\n      const value = (hash >> (i * 8)) & 0xff;\n      color += (\"00\" + value.toString(16)).substr(-2);\n    }\n    return color;\n  }\n\n  /**\n   * @throws Will throw an error if the ContainerService has not been attached to the window object\n   */\n  static getContainerService(): BitwardenContainerService {\n    if (this.global.bitwardenContainerService == null) {\n      throw new Error(\"global bitwardenContainerService not initialized.\");\n    }\n    return this.global.bitwardenContainerService;\n  }\n\n  static validateHexColor(color: string) {\n    return /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(color);\n  }\n\n  /**\n   * Converts map to a Record<string, V> with the same data. Inverse of recordToMap\n   * Useful in toJSON methods, since Maps are not serializable\n   * @param map\n   * @returns\n   */\n  static mapToRecord<K extends string | number, V>(map: Map<K, V>): Record<string, V> {\n    if (map == null) {\n      return null;\n    }\n    if (!(map instanceof Map)) {\n      return map;\n    }\n    return Object.fromEntries(map);\n  }\n\n  /**\n   * Converts record to a Map<string, V> with the same data. Inverse of mapToRecord\n   * Useful in fromJSON methods, since Maps are not serializable\n   *\n   * Warning: If the record has string keys that are numbers, they will be converted to numbers in the map\n   * @param record\n   * @returns\n   */\n  static recordToMap<K extends string | number, V>(record: Record<K, V>): Map<K, V> {\n    if (record == null) {\n      return null;\n    } else if (record instanceof Map) {\n      return record;\n    }\n\n    const entries = Object.entries(record);\n    if (entries.length === 0) {\n      return new Map();\n    }\n\n    if (isNaN(Number(entries[0][0]))) {\n      return new Map(entries) as Map<K, V>;\n    } else {\n      return new Map(entries.map((e) => [Number(e[0]), e[1]])) as Map<K, V>;\n    }\n  }\n\n  /** Applies Object.assign, but converts the type nicely using Type-Fest Merge<Destination, Source> */\n  static merge<Destination, Source>(\n    destination: Destination,\n    source: Source,\n  ): Merge<Destination, Source> {\n    return Object.assign(destination, source) as unknown as Merge<Destination, Source>;\n  }\n\n  /**\n   * encodeURIComponent escapes all characters except the following:\n   * alphabetic, decimal digits, - _ . ! ~ * ' ( )\n   * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent#encoding_for_rfc3986\n   */\n  static encodeRFC3986URIComponent(str: string): string {\n    return encodeURIComponent(str).replace(\n      /[!'()*]/g,\n      (c) => `%${c.charCodeAt(0).toString(16).toUpperCase()}`,\n    );\n  }\n\n  /**\n   * Normalizes a path for defense against attacks like traversals\n   * @param denormalizedPath\n   * @returns\n   */\n  static normalizePath(denormalizedPath: string): string {\n    return path.normalize(decodeURIComponent(denormalizedPath)).replace(/^(\\.\\.(\\/|\\\\|$))+/, \"\");\n  }\n\n  private static isMobile(win: Window) {\n    let mobile = false;\n    ((a) => {\n      if (\n        /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(\n          a,\n        ) ||\n        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\n          a.substr(0, 4),\n        )\n      ) {\n        mobile = true;\n      }\n    })(win.navigator.userAgent || win.navigator.vendor || (win as any).opera);\n    return mobile || win.navigator.userAgent.match(/iPad/i) != null;\n  }\n\n  static delay(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Generate an observable from a function that returns a promise.\n   * Similar to the rxjs function {@link from} with one big exception:\n   * {@link from} will not re-execute the function when observers resubscribe.\n   * {@link Util.asyncToObservable} will execute `generator` for every\n   * subscribe, making it ideal if the value ever needs to be refreshed.\n   * */\n  static asyncToObservable<T>(generator: () => Promise<T>): Observable<T> {\n    return of(undefined).pipe(switchMap(() => generator()));\n  }\n\n  /**\n   * Return the number of days remaining before a target date arrives.\n   * Returns 0 if the day has already passed.\n   */\n  static daysRemaining(targetDate: Date): number {\n    const diffTime = targetDate.getTime() - Date.now();\n    const msPerDay = 86400000;\n    return Math.max(0, Math.floor(diffTime / msPerDay));\n  }\n\n  private static isAppleMobile(win: Window) {\n    return (\n      win.navigator.userAgent.match(/iPhone/i) != null ||\n      win.navigator.userAgent.match(/iPad/i) != null\n    );\n  }\n\n  private static getUrlObject(uriString: string): URL {\n    // All the methods below require a protocol to properly parse a URL string\n    // Assume http if no other protocol is present\n    const hasProtocol = uriString.indexOf(\"://\") > -1;\n    if (!hasProtocol && uriString.indexOf(\".\") > -1) {\n      uriString = \"http://\" + uriString;\n    } else if (!hasProtocol) {\n      return null;\n    }\n\n    try {\n      if (nodeURL != null) {\n        return new nodeURL.URL(uriString);\n      }\n\n      return new URL(uriString);\n    } catch (e) {\n      // Ignore error\n    }\n\n    return null;\n  }\n}\n\nUtils.init();\n","import { Jsonify, Opaque } from \"type-fest\";\n\nimport { EncryptionType, EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE } from \"../../enums\";\nimport { Encrypted } from \"../../interfaces/encrypted\";\nimport { Utils } from \"../../misc/utils\";\n\nimport { SymmetricCryptoKey } from \"./symmetric-crypto-key\";\n\nexport class EncString implements Encrypted {\n  encryptedString?: EncryptedString;\n  encryptionType?: EncryptionType;\n  decryptedValue?: string;\n  data?: string;\n  iv?: string;\n  mac?: string;\n\n  constructor(\n    encryptedStringOrType: string | EncryptionType,\n    data?: string,\n    iv?: string,\n    mac?: string,\n  ) {\n    if (data != null) {\n      this.initFromData(encryptedStringOrType as EncryptionType, data, iv, mac);\n    } else {\n      this.initFromEncryptedString(encryptedStringOrType as string);\n    }\n  }\n\n  get ivBytes(): Uint8Array {\n    return this.iv == null ? null : Utils.fromB64ToArray(this.iv);\n  }\n\n  get macBytes(): Uint8Array {\n    return this.mac == null ? null : Utils.fromB64ToArray(this.mac);\n  }\n\n  get dataBytes(): Uint8Array {\n    return this.data == null ? null : Utils.fromB64ToArray(this.data);\n  }\n\n  toJSON() {\n    return this.encryptedString as string;\n  }\n\n  static fromJSON(obj: Jsonify<EncString>): EncString {\n    if (obj == null) {\n      return null;\n    }\n\n    return new EncString(obj);\n  }\n\n  private initFromData(encType: EncryptionType, data: string, iv: string, mac: string) {\n    if (iv != null) {\n      this.encryptedString = (encType + \".\" + iv + \"|\" + data) as EncryptedString;\n    } else {\n      this.encryptedString = (encType + \".\" + data) as EncryptedString;\n    }\n\n    // mac\n    if (mac != null) {\n      this.encryptedString = (this.encryptedString + \"|\" + mac) as EncryptedString;\n    }\n\n    this.encryptionType = encType;\n    this.data = data;\n    this.iv = iv;\n    this.mac = mac;\n  }\n\n  private initFromEncryptedString(encryptedString: string) {\n    this.encryptedString = encryptedString as EncryptedString;\n    if (!this.encryptedString) {\n      return;\n    }\n\n    const { encType, encPieces } = EncString.parseEncryptedString(this.encryptedString);\n    this.encryptionType = encType;\n\n    if (encPieces.length !== EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE[encType]) {\n      return;\n    }\n\n    switch (encType) {\n      case EncryptionType.AesCbc128_HmacSha256_B64:\n      case EncryptionType.AesCbc256_HmacSha256_B64:\n        this.iv = encPieces[0];\n        this.data = encPieces[1];\n        this.mac = encPieces[2];\n        break;\n      case EncryptionType.AesCbc256_B64:\n        this.iv = encPieces[0];\n        this.data = encPieces[1];\n        break;\n      case EncryptionType.Rsa2048_OaepSha256_B64:\n      case EncryptionType.Rsa2048_OaepSha1_B64:\n        this.data = encPieces[0];\n        break;\n      default:\n        return;\n    }\n  }\n\n  private static parseEncryptedString(encryptedString: string): {\n    encType: EncryptionType;\n    encPieces: string[];\n  } {\n    const headerPieces = encryptedString.split(\".\");\n    let encType: EncryptionType;\n    let encPieces: string[] = null;\n\n    if (headerPieces.length === 2) {\n      try {\n        encType = parseInt(headerPieces[0], null);\n        encPieces = headerPieces[1].split(\"|\");\n      } catch (e) {\n        return;\n      }\n    } else {\n      encPieces = encryptedString.split(\"|\");\n      encType =\n        encPieces.length === 3\n          ? EncryptionType.AesCbc128_HmacSha256_B64\n          : EncryptionType.AesCbc256_B64;\n    }\n\n    return {\n      encType,\n      encPieces,\n    };\n  }\n\n  static isSerializedEncString(s: string): boolean {\n    const { encType, encPieces } = this.parseEncryptedString(s);\n\n    return EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE[encType] === encPieces.length;\n  }\n\n  async decrypt(orgId: string, key: SymmetricCryptoKey = null): Promise<string> {\n    if (this.decryptedValue != null) {\n      return this.decryptedValue;\n    }\n\n    try {\n      if (key == null) {\n        key = await this.getKeyForDecryption(orgId);\n      }\n      if (key == null) {\n        throw new Error(\"No key to decrypt EncString with orgId \" + orgId);\n      }\n\n      const encryptService = Utils.getContainerService().getEncryptService();\n      this.decryptedValue = await encryptService.decryptToUtf8(this, key);\n    } catch (e) {\n      this.decryptedValue = \"[error: cannot decrypt]\";\n    }\n    return this.decryptedValue;\n  }\n\n  private async getKeyForDecryption(orgId: string) {\n    const cryptoService = Utils.getContainerService().getCryptoService();\n    return orgId != null\n      ? await cryptoService.getOrgKey(orgId)\n      : await cryptoService.getUserKeyWithLegacySupport();\n  }\n}\n\nexport type EncryptedString = Opaque<string, \"EncString\">;\n","import { VaultTimeoutSettingsService } from \"@bitwarden/common/abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { KdfConfig } from \"@bitwarden/common/auth/models/domain/kdf-config\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { KdfType } from \"@bitwarden/common/platform/enums\";\nimport { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { PinLockType } from \"@bitwarden/common/services/vault-timeout/vault-timeout-settings.service\";\nimport { UserKey } from \"@bitwarden/common/types/key\";\n\nimport { PinCryptoServiceAbstraction } from \"../../abstractions/pin-crypto.service.abstraction\";\n\nexport class PinCryptoService implements PinCryptoServiceAbstraction {\n  constructor(\n    private stateService: StateService,\n    private cryptoService: CryptoService,\n    private vaultTimeoutSettingsService: VaultTimeoutSettingsService,\n    private logService: LogService,\n  ) {}\n  async decryptUserKeyWithPin(pin: string): Promise<UserKey | null> {\n    try {\n      const pinLockType: PinLockType = await this.vaultTimeoutSettingsService.isPinLockSet();\n\n      const { pinKeyEncryptedUserKey, oldPinKeyEncryptedMasterKey } =\n        await this.getPinKeyEncryptedKeys(pinLockType);\n\n      const kdf: KdfType = await this.stateService.getKdfType();\n      const kdfConfig: KdfConfig = await this.stateService.getKdfConfig();\n      let userKey: UserKey;\n      const email = await this.stateService.getEmail();\n      if (oldPinKeyEncryptedMasterKey) {\n        userKey = await this.cryptoService.decryptAndMigrateOldPinKey(\n          pinLockType === \"TRANSIENT\",\n          pin,\n          email,\n          kdf,\n          kdfConfig,\n          oldPinKeyEncryptedMasterKey,\n        );\n      } else {\n        userKey = await this.cryptoService.decryptUserKeyWithPin(\n          pin,\n          email,\n          kdf,\n          kdfConfig,\n          pinKeyEncryptedUserKey,\n        );\n      }\n\n      if (!userKey) {\n        this.logService.warning(`User key null after pin key decryption.`);\n        return null;\n      }\n\n      if (!(await this.validatePin(userKey, pin))) {\n        this.logService.warning(`Pin key decryption successful but pin validation failed.`);\n        return null;\n      }\n\n      return userKey;\n    } catch (error) {\n      this.logService.error(`Error decrypting user key with pin: ${error}`);\n      return null;\n    }\n  }\n\n  // Note: oldPinKeyEncryptedMasterKey is only used for migrating old pin keys\n  // and will be null for all migrated accounts\n  private async getPinKeyEncryptedKeys(\n    pinLockType: PinLockType,\n  ): Promise<{ pinKeyEncryptedUserKey: EncString; oldPinKeyEncryptedMasterKey?: EncString }> {\n    switch (pinLockType) {\n      case \"PERSISTANT\": {\n        const pinKeyEncryptedUserKey = await this.stateService.getPinKeyEncryptedUserKey();\n        const oldPinKeyEncryptedMasterKey = await this.stateService.getEncryptedPinProtected();\n        return {\n          pinKeyEncryptedUserKey,\n          oldPinKeyEncryptedMasterKey: oldPinKeyEncryptedMasterKey\n            ? new EncString(oldPinKeyEncryptedMasterKey)\n            : undefined,\n        };\n      }\n      case \"TRANSIENT\": {\n        const pinKeyEncryptedUserKey = await this.stateService.getPinKeyEncryptedUserKeyEphemeral();\n        const oldPinKeyEncryptedMasterKey = await this.stateService.getDecryptedPinProtected();\n        return { pinKeyEncryptedUserKey, oldPinKeyEncryptedMasterKey };\n      }\n      case \"DISABLED\":\n        throw new Error(\"Pin is disabled\");\n      default: {\n        // Compile-time check for exhaustive switch\n        const _exhaustiveCheck: never = pinLockType;\n        return _exhaustiveCheck;\n      }\n    }\n  }\n\n  private async validatePin(userKey: UserKey, pin: string): Promise<boolean> {\n    const protectedPin = await this.stateService.getProtectedPin();\n    const decryptedPin = await this.cryptoService.decryptToUtf8(\n      new EncString(protectedPin),\n      userKey,\n    );\n    return decryptedPin === pin;\n  }\n}\n","export enum TwoFactorProviderType {\n  Authenticator = 0,\n  Email = 1,\n  Duo = 2,\n  Yubikey = 3,\n  U2f = 4,\n  Remember = 5,\n  OrganizationDuo = 6,\n  WebAuthn = 7,\n}\n","/*\n * This enum is used to determine if a user should be forced to initially set or reset their password\n * on login (server flag) or unlock via MP (client evaluation).\n */\nexport enum ForceSetPasswordReason {\n  /**\n   * A password reset should not be forced.\n   */\n  None,\n\n  /**\n   * Occurs when an organization admin forces a user to reset their password.\n   * Communicated via server flag.\n   */\n  AdminForcePasswordReset,\n\n  /**\n   * Occurs when a user logs in / unlocks their vault with a master password that does not meet an organization's\n   * master password policy that is enforced on login/unlock.\n   * Only set client side b/c server can't evaluate MP.\n   */\n  WeakMasterPassword,\n\n  /**\n   * Occurs when a TDE user without a password obtains the password reset permission.\n   * Set post login & decryption client side and by server in sync (to catch logged in users).\n   */\n  TdeUserWithoutPasswordHasPasswordResetPermission,\n}\n","export enum ClientType {\n  Web = \"web\",\n  Browser = \"browser\",\n  Desktop = \"desktop\",\n  // Mobile = \"mobile\",\n  Cli = \"cli\",\n  // DirectoryConnector = \"connector\",\n}\n","export enum DeviceType {\n  Android = 0,\n  iOS = 1,\n  ChromeExtension = 2,\n  FirefoxExtension = 3,\n  OperaExtension = 4,\n  EdgeExtension = 5,\n  WindowsDesktop = 6,\n  MacOsDesktop = 7,\n  LinuxDesktop = 8,\n  ChromeBrowser = 9,\n  FirefoxBrowser = 10,\n  OperaBrowser = 11,\n  EdgeBrowser = 12,\n  IEBrowser = 13,\n  UnknownBrowser = 14,\n  AndroidAmazon = 15,\n  UWP = 16,\n  SafariBrowser = 17,\n  VivaldiBrowser = 18,\n  VivaldiExtension = 19,\n  SafariExtension = 20,\n  SDK = 21,\n  Server = 22,\n  WindowsCLI = 23,\n  MacOsCLI = 24,\n  LinuxCLI = 25,\n}\n\nexport const MobileDeviceTypes: Set<DeviceType> = new Set([\n  DeviceType.Android,\n  DeviceType.iOS,\n  DeviceType.AndroidAmazon,\n]);\n\nexport const DesktopDeviceTypes: Set<DeviceType> = new Set([\n  DeviceType.WindowsDesktop,\n  DeviceType.MacOsDesktop,\n  DeviceType.LinuxDesktop,\n  DeviceType.UWP,\n  DeviceType.WindowsCLI,\n  DeviceType.MacOsCLI,\n  DeviceType.LinuxCLI,\n]);\n","export class PreloginRequest {\n  email: string;\n\n  constructor(email: string) {\n    this.email = email;\n  }\n}\n","export abstract class BaseResponse {\n  private response: any;\n\n  constructor(response: any) {\n    this.response = response;\n  }\n\n  protected getResponseProperty(\n    propertyName: string,\n    response: any = null,\n    exactName = false,\n  ): any {\n    if (propertyName == null || propertyName === \"\") {\n      throw new Error(\"propertyName must not be null/empty.\");\n    }\n    if (response == null && this.response != null) {\n      response = this.response;\n    }\n    if (response == null) {\n      return null;\n    }\n    if (!exactName && response[propertyName] === undefined) {\n      let otherCasePropertyName: string = null;\n      if (propertyName.charAt(0) === propertyName.charAt(0).toUpperCase()) {\n        otherCasePropertyName = propertyName.charAt(0).toLowerCase();\n      } else {\n        otherCasePropertyName = propertyName.charAt(0).toUpperCase();\n      }\n      if (propertyName.length > 1) {\n        otherCasePropertyName += propertyName.slice(1);\n      }\n\n      propertyName = otherCasePropertyName;\n      if (response[propertyName] === undefined) {\n        propertyName = propertyName.toLowerCase();\n      }\n      if (response[propertyName] === undefined) {\n        propertyName = propertyName.toUpperCase();\n      }\n    }\n    return response[propertyName];\n  }\n}\n","import { Utils } from \"../../platform/misc/utils\";\n\nimport { BaseResponse } from \"./base.response\";\n\nexport class ErrorResponse extends BaseResponse {\n  message: string;\n  validationErrors: { [key: string]: string[] };\n  statusCode: number;\n  captchaRequired: boolean;\n  captchaSiteKey: string;\n\n  constructor(response: any, status: number, identityResponse?: boolean) {\n    super(response);\n    let errorModel = null;\n    if (response != null) {\n      const responseErrorModel = this.getResponseProperty(\"ErrorModel\");\n      if (responseErrorModel && identityResponse) {\n        errorModel = responseErrorModel;\n      } else {\n        errorModel = response;\n      }\n    }\n\n    if (status === 429) {\n      this.message = \"Rate limit exceeded. Try again later.\";\n    } else if (errorModel) {\n      this.message = this.getResponseProperty(\"Message\", errorModel);\n      this.validationErrors = this.getResponseProperty(\"ValidationErrors\", errorModel);\n      this.captchaSiteKey = this.validationErrors?.HCaptcha_SiteKey?.[0];\n      this.captchaRequired = !Utils.isNullOrWhitespace(this.captchaSiteKey);\n    }\n    this.statusCode = status;\n  }\n\n  getSingleMessage(): string {\n    if (this.validationErrors == null) {\n      return this.message;\n    }\n    for (const key in this.validationErrors) {\n      // eslint-disable-next-line\n      if (!this.validationErrors.hasOwnProperty(key)) {\n        continue;\n      }\n      if (this.validationErrors[key].length) {\n        return this.validationErrors[key][0];\n      }\n    }\n    return this.message;\n  }\n\n  getAllMessages(): string[] {\n    const messages: string[] = [];\n    if (this.validationErrors == null) {\n      return messages;\n    }\n    for (const key in this.validationErrors) {\n      // eslint-disable-next-line\n      if (!this.validationErrors.hasOwnProperty(key)) {\n        continue;\n      }\n      this.validationErrors[key].forEach((item: string) => {\n        let prefix = \"\";\n        if (key.indexOf(\"[\") > -1 && key.indexOf(\"]\") > -1) {\n          const lastSep = key.lastIndexOf(\".\");\n          prefix = key.substr(0, lastSep > -1 ? lastSep : key.length) + \": \";\n        }\n        messages.push(prefix + item);\n      });\n    }\n    return messages;\n  }\n}\n","import { DeviceRequest } from \"./device.request\";\nimport { TokenTwoFactorRequest } from \"./token-two-factor.request\";\n\nexport abstract class TokenRequest {\n  protected device?: DeviceRequest;\n  protected authRequest: string;\n\n  constructor(\n    protected twoFactor?: TokenTwoFactorRequest,\n    device?: DeviceRequest,\n  ) {\n    this.device = device != null ? device : null;\n  }\n\n  // eslint-disable-next-line\n  alterIdentityTokenHeaders(headers: Headers) {\n    // Implemented in subclass if required\n  }\n\n  setTwoFactor(twoFactor: TokenTwoFactorRequest | undefined) {\n    this.twoFactor = twoFactor;\n  }\n\n  setAuthRequestAccessCode(accessCode: string) {\n    this.authRequest = accessCode;\n  }\n\n  protected toIdentityToken(clientId: string) {\n    const obj: any = {\n      scope: \"api offline_access\",\n      client_id: clientId,\n    };\n\n    if (this.device) {\n      obj.deviceType = this.device.type;\n      obj.deviceIdentifier = this.device.identifier;\n      obj.deviceName = this.device.name;\n      // no push tokens for browser apps yet\n      // obj.devicePushToken = this.device.pushToken;\n    }\n\n    //passswordless login\n    if (this.authRequest) {\n      obj.authRequest = this.authRequest;\n    }\n\n    if (this.twoFactor) {\n      if (this.twoFactor.token && this.twoFactor.provider != null) {\n        obj.twoFactorToken = this.twoFactor.token;\n        obj.twoFactorProvider = this.twoFactor.provider;\n        obj.twoFactorRemember = this.twoFactor.remember ? \"1\" : \"0\";\n      }\n    }\n\n    return obj;\n  }\n}\n","import { ClientType } from \"../../../../enums\";\nimport { Utils } from \"../../../../platform/misc/utils\";\nimport { CaptchaProtectedRequest } from \"../captcha-protected.request\";\n\nimport { DeviceRequest } from \"./device.request\";\nimport { TokenTwoFactorRequest } from \"./token-two-factor.request\";\nimport { TokenRequest } from \"./token.request\";\n\nexport class PasswordTokenRequest extends TokenRequest implements CaptchaProtectedRequest {\n  constructor(\n    public email: string,\n    public masterPasswordHash: string,\n    public captchaResponse: string,\n    protected twoFactor: TokenTwoFactorRequest,\n    device?: DeviceRequest,\n  ) {\n    super(twoFactor, device);\n  }\n\n  toIdentityToken(clientId: ClientType) {\n    const obj = super.toIdentityToken(clientId);\n\n    obj.grant_type = \"password\";\n    obj.username = this.email;\n    obj.password = this.masterPasswordHash;\n\n    if (this.captchaResponse != null) {\n      obj.captchaResponse = this.captchaResponse;\n    }\n\n    return obj;\n  }\n\n  alterIdentityTokenHeaders(headers: Headers) {\n    headers.set(\"Auth-Email\", Utils.fromUtf8ToUrlB64(this.email));\n  }\n}\n","import { Utils } from \"../../../platform/misc/utils\";\nimport { TwoFactorProviderType } from \"../../enums/two-factor-provider-type\";\n\nimport { ForceSetPasswordReason } from \"./force-set-password-reason\";\n\nexport class AuthResult {\n  captchaSiteKey = \"\";\n  // TODO: PM-3287 - Remove this after 3 releases of backwards compatibility. - Target release 2023.12 for removal\n  /**\n   * @deprecated\n   * Replace with using AccountDecryptionOptions to determine if the user does\n   * not have a master password and is not using Key Connector.\n   * */\n  resetMasterPassword = false;\n\n  forcePasswordReset: ForceSetPasswordReason = ForceSetPasswordReason.None;\n  twoFactorProviders: Map<TwoFactorProviderType, { [key: string]: string }> = null;\n  ssoEmail2FaSessionToken?: string;\n  email: string;\n  requiresEncryptionKeyMigration: boolean;\n\n  get requiresCaptcha() {\n    return !Utils.isNullOrWhitespace(this.captchaSiteKey);\n  }\n\n  get requiresTwoFactor() {\n    return this.twoFactorProviders != null;\n  }\n}\n","import { DeviceType } from \"../../../../enums\";\nimport { PlatformUtilsService } from \"../../../../platform/abstractions/platform-utils.service\";\n\nexport class DeviceRequest {\n  type: DeviceType;\n  name: string;\n  identifier: string;\n  pushToken?: string;\n\n  constructor(appId: string, platformUtilsService: PlatformUtilsService) {\n    this.type = platformUtilsService.getDevice();\n    this.name = platformUtilsService.getDeviceString();\n    this.identifier = appId;\n    this.pushToken = null;\n  }\n}\n","import { TwoFactorProviderType } from \"../../../enums/two-factor-provider-type\";\n\nexport class TokenTwoFactorRequest {\n  constructor(\n    public provider: TwoFactorProviderType = null,\n    public token: string = null,\n    public remember: boolean = false,\n  ) {}\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class IdentityCaptchaResponse extends BaseResponse {\n  siteKey: string;\n\n  constructor(response: any) {\n    super(response);\n    this.siteKey = this.getResponseProperty(\"HCaptcha_SiteKey\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class MasterPasswordPolicyResponse extends BaseResponse {\n  minComplexity: number;\n  minLength: number;\n  requireUpper: boolean;\n  requireLower: boolean;\n  requireNumbers: boolean;\n  requireSpecial: boolean;\n\n  /**\n   * Flag to indicate if the policy should be enforced on login.\n   * If true, and the user's password does not meet the policy requirements,\n   * the user will be forced to update their password.\n   */\n  enforceOnLogin: boolean;\n\n  constructor(response: any) {\n    super(response);\n\n    this.minComplexity = this.getResponseProperty(\"MinComplexity\");\n    this.minLength = this.getResponseProperty(\"MinLength\");\n    this.requireUpper = this.getResponseProperty(\"RequireUpper\");\n    this.requireLower = this.getResponseProperty(\"RequireLower\");\n    this.requireNumbers = this.getResponseProperty(\"RequireNumbers\");\n    this.requireSpecial = this.getResponseProperty(\"RequireSpecial\");\n    this.enforceOnLogin = this.getResponseProperty(\"EnforceOnLogin\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport interface IKeyConnectorUserDecryptionOptionServerResponse {\n  KeyConnectorUrl: string;\n}\n\nexport class KeyConnectorUserDecryptionOptionResponse extends BaseResponse {\n  keyConnectorUrl: string;\n\n  constructor(response: IKeyConnectorUserDecryptionOptionServerResponse) {\n    super(response);\n    this.keyConnectorUrl = this.getResponseProperty(\"KeyConnectorUrl\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\n\nexport interface ITrustedDeviceUserDecryptionOptionServerResponse {\n  HasAdminApproval: boolean;\n  HasLoginApprovingDevice: boolean;\n  HasManageResetPasswordPermission: boolean;\n  EncryptedPrivateKey?: string;\n  EncryptedUserKey?: string;\n}\n\nexport class TrustedDeviceUserDecryptionOptionResponse extends BaseResponse {\n  hasAdminApproval: boolean;\n  hasLoginApprovingDevice: boolean;\n  hasManageResetPasswordPermission: boolean;\n  encryptedPrivateKey: EncString;\n  encryptedUserKey: EncString;\n\n  constructor(response: any) {\n    super(response);\n    this.hasAdminApproval = this.getResponseProperty(\"HasAdminApproval\");\n\n    this.hasLoginApprovingDevice = this.getResponseProperty(\"HasLoginApprovingDevice\");\n    this.hasManageResetPasswordPermission = this.getResponseProperty(\n      \"HasManageResetPasswordPermission\",\n    );\n\n    if (response.EncryptedPrivateKey) {\n      this.encryptedPrivateKey = new EncString(this.getResponseProperty(\"EncryptedPrivateKey\"));\n    }\n    if (response.EncryptedUserKey) {\n      this.encryptedUserKey = new EncString(this.getResponseProperty(\"EncryptedUserKey\"));\n    }\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\n\nexport interface IWebAuthnPrfDecryptionOptionServerResponse {\n  EncryptedPrivateKey: string;\n  EncryptedUserKey: string;\n}\n\nexport class WebAuthnPrfDecryptionOptionResponse extends BaseResponse {\n  encryptedPrivateKey: EncString;\n  encryptedUserKey: EncString;\n\n  constructor(response: IWebAuthnPrfDecryptionOptionServerResponse) {\n    super(response);\n    if (response.EncryptedPrivateKey) {\n      this.encryptedPrivateKey = new EncString(this.getResponseProperty(\"EncryptedPrivateKey\"));\n    }\n    if (response.EncryptedUserKey) {\n      this.encryptedUserKey = new EncString(this.getResponseProperty(\"EncryptedUserKey\"));\n    }\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nimport {\n  IKeyConnectorUserDecryptionOptionServerResponse,\n  KeyConnectorUserDecryptionOptionResponse,\n} from \"./key-connector-user-decryption-option.response\";\nimport {\n  ITrustedDeviceUserDecryptionOptionServerResponse,\n  TrustedDeviceUserDecryptionOptionResponse,\n} from \"./trusted-device-user-decryption-option.response\";\nimport {\n  IWebAuthnPrfDecryptionOptionServerResponse,\n  WebAuthnPrfDecryptionOptionResponse,\n} from \"./webauthn-prf-decryption-option.response\";\n\nexport interface IUserDecryptionOptionsServerResponse {\n  HasMasterPassword: boolean;\n  TrustedDeviceOption?: ITrustedDeviceUserDecryptionOptionServerResponse;\n  KeyConnectorOption?: IKeyConnectorUserDecryptionOptionServerResponse;\n  WebAuthnPrfOption?: IWebAuthnPrfDecryptionOptionServerResponse;\n}\n\nexport class UserDecryptionOptionsResponse extends BaseResponse {\n  hasMasterPassword: boolean;\n  trustedDeviceOption?: TrustedDeviceUserDecryptionOptionResponse;\n  keyConnectorOption?: KeyConnectorUserDecryptionOptionResponse;\n  webAuthnPrfOption?: WebAuthnPrfDecryptionOptionResponse;\n\n  constructor(response: IUserDecryptionOptionsServerResponse) {\n    super(response);\n\n    this.hasMasterPassword = this.getResponseProperty(\"HasMasterPassword\");\n\n    if (response.TrustedDeviceOption) {\n      this.trustedDeviceOption = new TrustedDeviceUserDecryptionOptionResponse(\n        this.getResponseProperty(\"TrustedDeviceOption\"),\n      );\n    }\n    if (response.KeyConnectorOption) {\n      this.keyConnectorOption = new KeyConnectorUserDecryptionOptionResponse(\n        this.getResponseProperty(\"KeyConnectorOption\"),\n      );\n    }\n    if (response.WebAuthnPrfOption) {\n      this.webAuthnPrfOption = new WebAuthnPrfDecryptionOptionResponse(\n        this.getResponseProperty(\"WebAuthnPrfOption\"),\n      );\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { KdfType } from \"../../../platform/enums\";\n\nimport { MasterPasswordPolicyResponse } from \"./master-password-policy.response\";\nimport { UserDecryptionOptionsResponse } from \"./user-decryption-options/user-decryption-options.response\";\n\nexport class IdentityTokenResponse extends BaseResponse {\n  accessToken: string;\n  expiresIn: number;\n  refreshToken: string;\n  tokenType: string;\n\n  resetMasterPassword: boolean;\n  privateKey: string;\n  key: string;\n  twoFactorToken: string;\n  kdf: KdfType;\n  kdfIterations: number;\n  kdfMemory?: number;\n  kdfParallelism?: number;\n  forcePasswordReset: boolean;\n  masterPasswordPolicy: MasterPasswordPolicyResponse;\n  apiUseKeyConnector: boolean;\n  keyConnectorUrl: string;\n\n  userDecryptionOptions: UserDecryptionOptionsResponse;\n\n  constructor(response: any) {\n    super(response);\n    this.accessToken = response.access_token;\n    this.expiresIn = response.expires_in;\n    this.refreshToken = response.refresh_token;\n    this.tokenType = response.token_type;\n\n    this.resetMasterPassword = this.getResponseProperty(\"ResetMasterPassword\");\n    this.privateKey = this.getResponseProperty(\"PrivateKey\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.twoFactorToken = this.getResponseProperty(\"TwoFactorToken\");\n    this.kdf = this.getResponseProperty(\"Kdf\");\n    this.kdfIterations = this.getResponseProperty(\"KdfIterations\");\n    this.kdfMemory = this.getResponseProperty(\"KdfMemory\");\n    this.kdfParallelism = this.getResponseProperty(\"KdfParallelism\");\n    this.forcePasswordReset = this.getResponseProperty(\"ForcePasswordReset\");\n    this.apiUseKeyConnector = this.getResponseProperty(\"ApiUseKeyConnector\");\n    this.keyConnectorUrl = this.getResponseProperty(\"KeyConnectorUrl\");\n    this.masterPasswordPolicy = new MasterPasswordPolicyResponse(\n      this.getResponseProperty(\"MasterPasswordPolicy\"),\n    );\n\n    if (response.UserDecryptionOptions) {\n      this.userDecryptionOptions = new UserDecryptionOptionsResponse(\n        this.getResponseProperty(\"UserDecryptionOptions\"),\n      );\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { TwoFactorProviderType } from \"../../enums/two-factor-provider-type\";\n\nimport { MasterPasswordPolicyResponse } from \"./master-password-policy.response\";\n\nexport class IdentityTwoFactorResponse extends BaseResponse {\n  twoFactorProviders: TwoFactorProviderType[];\n  twoFactorProviders2 = new Map<TwoFactorProviderType, { [key: string]: string }>();\n  captchaToken: string;\n  ssoEmail2faSessionToken: string;\n  email?: string;\n  masterPasswordPolicy?: MasterPasswordPolicyResponse;\n\n  constructor(response: any) {\n    super(response);\n    this.captchaToken = this.getResponseProperty(\"CaptchaBypassToken\");\n    this.twoFactorProviders = this.getResponseProperty(\"TwoFactorProviders\");\n    const twoFactorProviders2 = this.getResponseProperty(\"TwoFactorProviders2\");\n    if (twoFactorProviders2 != null) {\n      for (const prop in twoFactorProviders2) {\n        // eslint-disable-next-line\n        if (twoFactorProviders2.hasOwnProperty(prop)) {\n          this.twoFactorProviders2.set(parseInt(prop, null), twoFactorProviders2[prop]);\n        }\n      }\n    }\n    this.masterPasswordPolicy = new MasterPasswordPolicyResponse(\n      this.getResponseProperty(\"MasterPasswordPolicy\"),\n    );\n\n    this.ssoEmail2faSessionToken = this.getResponseProperty(\"SsoEmail2faSessionToken\");\n    this.email = this.getResponseProperty(\"Email\");\n  }\n}\n","// Note: the enum key is used to describe the EventSystemUser in the UI. Be careful about changing it.\nexport enum EventSystemUser {\n  SCIM = 1,\n  DomainVerification = 2,\n}\n","// Increment by 100 for each new set of events\nexport enum EventType {\n  User_LoggedIn = 1000,\n  User_ChangedPassword = 1001,\n  User_Updated2fa = 1002,\n  User_Disabled2fa = 1003,\n  User_Recovered2fa = 1004,\n  User_FailedLogIn = 1005,\n  User_FailedLogIn2fa = 1006,\n  User_ClientExportedVault = 1007,\n  User_UpdatedTempPassword = 1008,\n  User_MigratedKeyToKeyConnector = 1009,\n  User_RequestedDeviceApproval = 1010,\n\n  Cipher_Created = 1100,\n  Cipher_Updated = 1101,\n  Cipher_Deleted = 1102,\n  Cipher_AttachmentCreated = 1103,\n  Cipher_AttachmentDeleted = 1104,\n  Cipher_Shared = 1105,\n  Cipher_UpdatedCollections = 1106,\n  Cipher_ClientViewed = 1107,\n  Cipher_ClientToggledPasswordVisible = 1108,\n  Cipher_ClientToggledHiddenFieldVisible = 1109,\n  Cipher_ClientToggledCardCodeVisible = 1110,\n  Cipher_ClientCopiedPassword = 1111,\n  Cipher_ClientCopiedHiddenField = 1112,\n  Cipher_ClientCopiedCardCode = 1113,\n  Cipher_ClientAutofilled = 1114,\n  Cipher_SoftDeleted = 1115,\n  Cipher_Restored = 1116,\n  Cipher_ClientToggledCardNumberVisible = 1117,\n  Cipher_ClientToggledTOTPSeedVisible = 1118,\n\n  Collection_Created = 1300,\n  Collection_Updated = 1301,\n  Collection_Deleted = 1302,\n\n  Group_Created = 1400,\n  Group_Updated = 1401,\n  Group_Deleted = 1402,\n\n  OrganizationUser_Invited = 1500,\n  OrganizationUser_Confirmed = 1501,\n  OrganizationUser_Updated = 1502,\n  OrganizationUser_Removed = 1503,\n  OrganizationUser_UpdatedGroups = 1504,\n  OrganizationUser_UnlinkedSso = 1505,\n  OrganizationUser_ResetPassword_Enroll = 1506,\n  OrganizationUser_ResetPassword_Withdraw = 1507,\n  OrganizationUser_AdminResetPassword = 1508,\n  OrganizationUser_ResetSsoLink = 1509,\n  OrganizationUser_FirstSsoLogin = 1510,\n  OrganizationUser_Revoked = 1511,\n  OrganizationUser_Restored = 1512,\n  OrganizationUser_ApprovedAuthRequest = 1513,\n  OrganizationUser_RejectedAuthRequest = 1514,\n\n  Organization_Updated = 1600,\n  Organization_PurgedVault = 1601,\n  Organization_ClientExportedVault = 1602,\n  Organization_VaultAccessed = 1603,\n  Organization_EnabledSso = 1604,\n  Organization_DisabledSso = 1605,\n  Organization_EnabledKeyConnector = 1606,\n  Organization_DisabledKeyConnector = 1607,\n  Organization_SponsorshipsSynced = 1608,\n  Organization_CollectionManagementUpdated = 1609,\n\n  Policy_Updated = 1700,\n\n  ProviderUser_Invited = 1800,\n  ProviderUser_Confirmed = 1801,\n  ProviderUser_Updated = 1802,\n  ProviderUser_Removed = 1803,\n\n  ProviderOrganization_Created = 1900,\n  ProviderOrganization_Added = 1901,\n  ProviderOrganization_Removed = 1902,\n  ProviderOrganization_VaultAccessed = 1903,\n\n  OrganizationDomain_Added = 2000,\n  OrganizationDomain_Removed = 2001,\n  OrganizationDomain_Verified = 2002,\n  OrganizationDomain_NotVerified = 2003,\n\n  Secret_Retrieved = 2100,\n}\n","/**\n * Hypertext Transfer Protocol (HTTP) response status codes.\n *\n * @see {@link https://en.wikipedia.org/wiki/List_of_HTTP_status_codes}\n * src: https://gist.github.com/RWOverdijk/6cef816cfdf5722228e01cc05fd4b094\n */\nexport enum HttpStatusCode {\n  /**\n   * The server has received the request headers and the client should proceed to send the request body\n   * (in the case of a request for which a body needs to be sent; for example, a POST request).\n   * Sending a large request body to a server after a request has been rejected for inappropriate headers would be inefficient.\n   * To have a server check the request's headers, a client must send Expect: 100-continue as a header in its initial request\n   * and receive a 100 Continue status code in response before sending the body. The response 417 Expectation Failed indicates the request should not be continued.\n   */\n  Continue = 100,\n\n  /**\n   * The requester has asked the server to switch protocols and the server has agreed to do so.\n   */\n  SwitchingProtocols = 101,\n\n  /**\n   * A WebDAV request may contain many sub-requests involving file operations, requiring a long time to complete the request.\n   * This code indicates that the server has received and is processing the request, but no response is available yet.\n   * This prevents the client from timing out and assuming the request was lost.\n   */\n  Processing = 102,\n\n  // **********************************************************************************************************\n  // 200s - SUCCESS\n  // **********************************************************************************************************\n\n  /**\n   * Standard response for successful HTTP requests.\n   * The actual response will depend on the request method used.\n   * In a GET request, the response will contain an entity corresponding to the requested resource.\n   * In a POST request, the response will contain an entity describing or containing the result of the action.\n   */\n  Ok = 200,\n\n  /**\n   * The request has been fulfilled, resulting in the creation of a new resource.\n   */\n  Created = 201,\n\n  /**\n   * The request has been accepted for processing, but the processing has not been completed.\n   * The request might or might not be eventually acted upon, and may be disallowed when processing occurs.\n   */\n  Accepted = 202,\n\n  /**\n   * SINCE HTTP/1.1\n   * The server is a transforming proxy that received a 200 OK from its origin,\n   * but is returning a modified version of the origin's response.\n   */\n  NonAuthoritativeInformation = 203,\n\n  /**\n   * The server successfully processed the request and is not returning any content.\n   */\n  NoContent = 204,\n\n  /**\n   * The server successfully processed the request, but is not returning any content.\n   * Unlike a 204 response, this response requires that the requester reset the document view.\n   */\n  ResetContent = 205,\n\n  /**\n   * The server is delivering only part of the resource (byte serving) due to a range header sent by the client.\n   * The range header is used by HTTP clients to enable resuming of interrupted downloads,\n   * or split a download into multiple simultaneous streams.\n   */\n  PartialContent = 206,\n\n  /**\n   * The message body that follows is an XML message and can contain a number of separate response codes,\n   * depending on how many sub-requests were made.\n   */\n  MultiStatus = 207,\n\n  /**\n   * The members of a DAV binding have already been enumerated in a preceding part of the (multistatus) response,\n   * and are not being included again.\n   */\n  AlreadyReported = 208,\n\n  /**\n   * The server has fulfilled a request for the resource,\n   * and the response is a representation of the result of one or more instance-manipulations applied to the current instance.\n   */\n  ImUsed = 226,\n\n  // **********************************************************************************************************\n  // 300s - Redirections\n  // **********************************************************************************************************\n\n  /**\n   * Indicates multiple options for the resource from which the client may choose (via agent-driven content negotiation).\n   * For example, this code could be used to present multiple video format options,\n   * to list files with different filename extensions, or to suggest word-sense disambiguation.\n   */\n  MultipleChoices = 300,\n\n  /**\n   * This and all future requests should be directed to the given URI.\n   */\n  MovedPermanently = 301,\n\n  /**\n   * This is an example of industry practice contradicting the standard.\n   * The HTTP/1.0 specification (RFC 1945) required the client to perform a temporary redirect\n   * (the original describing phrase was \"Moved Temporarily\"), but popular browsers implemented 302\n   * with the functionality of a 303 See Other. Therefore, HTTP/1.1 added status codes 303 and 307\n   * to distinguish between the two behaviours. However, some Web applications and frameworks\n   * use the 302 status code as if it were the 303.\n   */\n  Found = 302,\n\n  /**\n   * SINCE HTTP/1.1\n   * The response to the request can be found under another URI using a GET method.\n   * When received in response to a POST (or PUT/DELETE), the client should presume that\n   * the server has received the data and should issue a redirect with a separate GET message.\n   */\n  SeeOther = 303,\n\n  /**\n   * Indicates that the resource has not been modified since the version specified by the request headers If-Modified-Since or If-None-Match.\n   * In such case, there is no need to retransmit the resource since the client still has a previously-downloaded copy.\n   */\n  NotModified = 304,\n\n  /**\n   * SINCE HTTP/1.1\n   * The requested resource is available only through a proxy, the address for which is provided in the response.\n   * Many HTTP clients (such as Mozilla and Internet Explorer) do not correctly handle responses with this status code, primarily for security reasons.\n   */\n  UseProxy = 305,\n\n  /**\n   * No longer used. Originally meant \"Subsequent requests should use the specified proxy.\"\n   */\n  SwitchProxy = 306,\n\n  /**\n   * SINCE HTTP/1.1\n   * In this case, the request should be repeated with another URI; however, future requests should still use the original URI.\n   * In contrast to how 302 was historically implemented, the request method is not allowed to be changed when reissuing the original request.\n   * For example, a POST request should be repeated using another POST request.\n   */\n  TemporaryRedirect = 307,\n\n  /**\n   * The request and all future requests should be repeated using another URI.\n   * 307 and 308 parallel the behaviors of 302 and 301, but do not allow the HTTP method to change.\n   * So, for example, submitting a form to a permanently redirected resource may continue smoothly.\n   */\n  PermanentRedirect = 308,\n\n  // **********************************************************************************************************\n  // 400s - Client / User messed up\n  // **********************************************************************************************************\n\n  /**\n   * The server cannot or will not process the request due to an apparent client error\n   * (e.g., malformed request syntax, too large size, invalid request message framing, or deceptive request routing).\n   */\n  BadRequest = 400,\n\n  /**\n   * Similar to 403 Forbidden, but specifically for use when authentication is required and has failed or has not yet\n   * been provided. The response must include a WWW-Authenticate header field containing a challenge applicable to the\n   * requested resource. See Basic access authentication and Digest access authentication. 401 semantically means\n   * \"unauthenticated\",i.e. the user does not have the necessary credentials.\n   */\n  Unauthorized = 401,\n\n  /**\n   * Reserved for future use. The original intention was that this code might be used as part of some form of digital\n   * cash or micro payment scheme, but that has not happened, and this code is not usually used.\n   * Google Developers API uses this status if a particular developer has exceeded the daily limit on requests.\n   */\n  PaymentRequired = 402,\n\n  /**\n   * The request was valid, but the server is refusing action.\n   * The user might not have the necessary permissions for a resource.\n   */\n  Forbidden = 403,\n\n  /**\n   * The requested resource could not be found but may be available in the future.\n   * Subsequent requests by the client are permissible.\n   */\n  NotFound = 404,\n\n  /**\n   * A request method is not supported for the requested resource;\n   * for example, a GET request on a form that requires data to be presented via POST, or a PUT request on a read-only resource.\n   */\n  MethodNotAllowed = 405,\n\n  /**\n   * The requested resource is capable of generating only content not acceptable according to the Accept headers sent in the request.\n   */\n  NotAcceptable = 406,\n\n  /**\n   * The client must first authenticate itself with the proxy.\n   */\n  ProxyAuthenticationRequired = 407,\n\n  /**\n   * The server timed out waiting for the request.\n   * According to HTTP specifications:\n   * \"The client did not produce a request within the time that the server was prepared to wait. The client MAY repeat the request without modifications at any later time.\"\n   */\n  RequestTimeout = 408,\n\n  /**\n   * Indicates that the request could not be processed because of conflict in the request,\n   * such as an edit conflict between multiple simultaneous updates.\n   */\n  Conflict = 409,\n\n  /**\n   * Indicates that the resource requested is no longer available and will not be available again.\n   * This should be used when a resource has been intentionally removed and the resource should be purged.\n   * Upon receiving a 410 status code, the client should not request the resource in the future.\n   * Clients such as search engines should remove the resource from their indices.\n   * Most use cases do not require clients and search engines to purge the resource, and a \"404 Not Found\" may be used instead.\n   */\n  Gone = 410,\n\n  /**\n   * The request did not specify the length of its content, which is required by the requested resource.\n   */\n  LengthRequired = 411,\n\n  /**\n   * The server does not meet one of the preconditions that the requester put on the request.\n   */\n  PreconditionFailed = 412,\n\n  /**\n   * The request is larger than the server is willing or able to process. Previously called \"Request Entity Too Large\".\n   */\n  PayloadTooLarge = 413,\n\n  /**\n   * The URI provided was too long for the server to process. Often the result of too much data being encoded as a query-string of a GET request,\n   * in which case it should be converted to a POST request.\n   * Called \"Request-URI Too Long\" previously.\n   */\n  UriTooLong = 414,\n\n  /**\n   * The request entity has a media type which the server or resource does not support.\n   * For example, the client uploads an image as image/svg+xml, but the server requires that images use a different format.\n   */\n  UnsupportedMediaType = 415,\n\n  /**\n   * The client has asked for a portion of the file (byte serving), but the server cannot supply that portion.\n   * For example, if the client asked for a part of the file that lies beyond the end of the file.\n   * Called \"Requested Range Not Satisfiable\" previously.\n   */\n  RangeNotSatisfiable = 416,\n\n  /**\n   * The server cannot meet the requirements of the Expect request-header field.\n   */\n  ExpectationFailed = 417,\n\n  /**\n   * This code was defined in 1998 as one of the traditional IETF April Fools' jokes, in RFC 2324, Hyper Text Coffee Pot Control Protocol,\n   * and is not expected to be implemented by actual HTTP servers. The RFC specifies this code should be returned by\n   * teapots requested to brew coffee. This HTTP status is used as an Easter egg in some websites, including Google.com.\n   */\n  IAmATeapot = 418,\n\n  /**\n   * The request was directed at a server that is not able to produce a response (for example because a connection reuse).\n   */\n  MisdirectedRequest = 421,\n\n  /**\n   * The request was well-formed but was unable to be followed due to semantic errors.\n   */\n  UnprocessableEntity = 422,\n\n  /**\n   * The resource that is being accessed is locked.\n   */\n  Locked = 423,\n\n  /**\n   * The request failed due to failure of a previous request (e.g., a PROPPATCH).\n   */\n  FailedDependency = 424,\n\n  /**\n   * The client should switch to a different protocol such as TLS/1.0, given in the Upgrade header field.\n   */\n  UpgradeRequired = 426,\n\n  /**\n   * The origin server requires the request to be conditional.\n   * Intended to prevent \"the 'lost update' problem, where a client\n   * GETs a resource's state, modifies it, and PUTs it back to the server,\n   * when meanwhile a third party has modified the state on the server, leading to a conflict.\"\n   */\n  PreconditionRequired = 428,\n\n  /**\n   * The user has sent too many requests in a given amount of time. Intended for use with rate-limiting schemes.\n   */\n  TooManyRequests = 429,\n\n  /**\n   * The server is unwilling to process the request because either an individual header field,\n   * or all the header fields collectively, are too large.\n   */\n  RequestHeaderFieldsTooLarge = 431,\n\n  /**\n   * A server operator has received a legal demand to deny access to a resource or to a set of resources\n   * that includes the requested resource. The code 451 was chosen as a reference to the novel Fahrenheit 451.\n   */\n  UnavailableForLegalReasons = 451,\n\n  // **********************************************************************************************************\n  // 500s - Server messed up\n  // **********************************************************************************************************\n\n  /**\n   * A generic error message, given when an unexpected condition was encountered and no more specific message is suitable.\n   */\n  InternalServerError = 500,\n\n  /**\n   * The server either does not recognize the request method, or it lacks the ability to fulfill the request.\n   * Usually this implies future availability (e.g., a new feature of a web-service API).\n   */\n  NotImplemented = 501,\n\n  /**\n   * The server was acting as a gateway or proxy and received an invalid response from the upstream server.\n   */\n  BadGateway = 502,\n\n  /**\n   * The server is currently unavailable (because it is overloaded or down for maintenance).\n   * Generally, this is a temporary state.\n   */\n  ServiceUnavailable = 503,\n\n  /**\n   * The server was acting as a gateway or proxy and did not receive a timely response from the upstream server.\n   */\n  GatewayTimeout = 504,\n\n  /**\n   * The server does not support the HTTP protocol version used in the request\n   */\n  HttpVersionNotSupported = 505,\n\n  /**\n   * Transparent content negotiation for the request results in a circular reference.\n   */\n  VariantAlsoNegotiates = 506,\n\n  /**\n   * The server is unable to store the representation needed to complete the request.\n   */\n  InsufficientStorage = 507,\n\n  /**\n   * The server detected an infinite loop while processing the request.\n   */\n  LoopDetected = 508,\n\n  /**\n   * Further extensions to the request are required for the server to fulfill it.\n   */\n  NotExtended = 510,\n\n  /**\n   * The client needs to authenticate to gain network access.\n   * Intended for use by intercepting proxies used to control access to the network (e.g., \"captive portals\" used\n   * to require agreement to Terms of Service before granting full Internet access via a Wi-Fi hotspot).\n   */\n  NetworkAuthenticationRequired = 511,\n}\n","export enum NativeMessagingVersion {\n  One = 1, // Original implementation\n  Latest = One,\n}\n","export enum NotificationType {\n  SyncCipherUpdate = 0,\n  SyncCipherCreate = 1,\n  SyncLoginDelete = 2,\n  SyncFolderDelete = 3,\n  SyncCiphers = 4,\n\n  SyncVault = 5,\n  SyncOrgKeys = 6,\n  SyncFolderCreate = 7,\n  SyncFolderUpdate = 8,\n  SyncCipherDelete = 9,\n  SyncSettings = 10,\n\n  LogOut = 11,\n\n  SyncSendCreate = 12,\n  SyncSendUpdate = 13,\n  SyncSendDelete = 14,\n\n  AuthRequest = 15,\n  AuthRequestResponse = 16,\n\n  SyncOrganizations = 17,\n}\n","export enum ProductType {\n  Free = 0,\n  Families = 1,\n  Teams = 2,\n  Enterprise = 3,\n  TeamsStarter = 4,\n}\n","export enum InitializerKey {\n  Cipher = 0,\n  CipherView = 1,\n}\n","export enum CipherRepromptType {\n  None = 0,\n  Password = 1,\n}\n","export enum CipherType {\n  Login = 1,\n  SecureNote = 2,\n  Card = 3,\n  Identity = 4,\n}\n","export enum FieldType {\n  Text = 0,\n  Hidden = 1,\n  Boolean = 2,\n  Linked = 3,\n}\n","export type LinkedIdType = LoginLinkedId | CardLinkedId | IdentityLinkedId;\n\n// LoginView\nexport enum LoginLinkedId {\n  Username = 100,\n  Password = 101,\n}\n\n// CardView\nexport enum CardLinkedId {\n  CardholderName = 300,\n  ExpMonth = 301,\n  ExpYear = 302,\n  Code = 303,\n  Brand = 304,\n  Number = 305,\n}\n\n// IdentityView\nexport enum IdentityLinkedId {\n  Title = 400,\n  MiddleName = 401,\n  Address1 = 402,\n  Address2 = 403,\n  Address3 = 404,\n  City = 405,\n  State = 406,\n  PostalCode = 407,\n  Country = 408,\n  Company = 409,\n  Email = 410,\n  Phone = 411,\n  Ssn = 412,\n  Username = 413,\n  PassportNumber = 414,\n  LicenseNumber = 415,\n  FirstName = 416,\n  LastName = 417,\n  FullName = 418,\n}\n","export enum SecureNoteType {\n  Generic = 0,\n}\n","export enum UriMatchType {\n  Domain = 0,\n  Host = 1,\n  StartsWith = 2,\n  Exact = 3,\n  RegularExpression = 4,\n  Never = 5,\n}\n","export class KeysRequest {\n  publicKey: string;\n  encryptedPrivateKey: string;\n\n  constructor(publicKey: string, encryptedPrivateKey: string) {\n    this.publicKey = publicKey;\n    this.encryptedPrivateKey = encryptedPrivateKey;\n  }\n}\n","import { Utils } from \"../../../platform/misc/utils\";\n\n// TODO: Tech Debt: potentially create a type Storage shape vs using a class here in the future\n// type StorageShape {\n//   id: string;\n//   privateKey: string;\n// }\n// so we can get rid of the any type passed into fromJSON and coming out of ToJSON\nexport class AdminAuthRequestStorable {\n  id: string;\n  privateKey: Uint8Array;\n\n  constructor(init?: Partial<AdminAuthRequestStorable>) {\n    if (init) {\n      Object.assign(this, init);\n    }\n  }\n\n  toJSON() {\n    return {\n      id: this.id,\n      privateKey: Utils.fromBufferToByteString(this.privateKey),\n    };\n  }\n\n  static fromJSON(obj: any): AdminAuthRequestStorable {\n    if (obj == null) {\n      return null;\n    }\n\n    let privateKeyBuffer = null;\n    if (obj.privateKey) {\n      privateKeyBuffer = Utils.fromByteStringToArray(obj.privateKey);\n    }\n\n    return new AdminAuthRequestStorable({\n      id: obj.id,\n      privateKey: privateKeyBuffer,\n    });\n  }\n}\n","export class KeyConnectorUserDecryptionOption {\n  constructor(public keyConnectorUrl: string) {}\n}\n","export class TrustedDeviceUserDecryptionOption {\n  constructor(\n    public hasAdminApproval: boolean,\n    public hasLoginApprovingDevice: boolean,\n    public hasManageResetPasswordPermission: boolean,\n  ) {}\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { EncryptionType } from \"../../enums\";\n\nexport class SymmetricCryptoKey {\n  key: Uint8Array;\n  encKey?: Uint8Array;\n  macKey?: Uint8Array;\n  encType: EncryptionType;\n\n  keyB64: string;\n  encKeyB64: string;\n  macKeyB64: string;\n\n  meta: any;\n\n  constructor(key: Uint8Array, encType?: EncryptionType) {\n    if (key == null) {\n      throw new Error(\"Must provide key\");\n    }\n\n    if (encType == null) {\n      if (key.byteLength === 32) {\n        encType = EncryptionType.AesCbc256_B64;\n      } else if (key.byteLength === 64) {\n        encType = EncryptionType.AesCbc256_HmacSha256_B64;\n      } else {\n        throw new Error(\"Unable to determine encType.\");\n      }\n    }\n\n    this.key = key;\n    this.encType = encType;\n\n    if (encType === EncryptionType.AesCbc256_B64 && key.byteLength === 32) {\n      this.encKey = key;\n      this.macKey = null;\n    } else if (encType === EncryptionType.AesCbc128_HmacSha256_B64 && key.byteLength === 32) {\n      this.encKey = key.slice(0, 16);\n      this.macKey = key.slice(16, 32);\n    } else if (encType === EncryptionType.AesCbc256_HmacSha256_B64 && key.byteLength === 64) {\n      this.encKey = key.slice(0, 32);\n      this.macKey = key.slice(32, 64);\n    } else {\n      throw new Error(\"Unsupported encType/key length.\");\n    }\n\n    if (this.key != null) {\n      this.keyB64 = Utils.fromBufferToB64(this.key);\n    }\n    if (this.encKey != null) {\n      this.encKeyB64 = Utils.fromBufferToB64(this.encKey);\n    }\n    if (this.macKey != null) {\n      this.macKeyB64 = Utils.fromBufferToB64(this.macKey);\n    }\n  }\n\n  toJSON() {\n    // The whole object is constructed from the initial key, so just store the B64 key\n    return { keyB64: this.keyB64 };\n  }\n\n  static fromString(s: string): SymmetricCryptoKey {\n    if (s == null) {\n      return null;\n    }\n\n    const arrayBuffer = Utils.fromB64ToArray(s);\n    return new SymmetricCryptoKey(arrayBuffer);\n  }\n\n  static fromJSON(obj: Jsonify<SymmetricCryptoKey>): SymmetricCryptoKey {\n    return SymmetricCryptoKey.fromString(obj?.keyB64);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { View } from \"../../../models/view/view\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { Attachment } from \"../domain/attachment\";\n\nexport class AttachmentView implements View {\n  id: string = null;\n  url: string = null;\n  size: string = null;\n  sizeName: string = null;\n  fileName: string = null;\n  key: SymmetricCryptoKey = null;\n\n  constructor(a?: Attachment) {\n    if (!a) {\n      return;\n    }\n\n    this.id = a.id;\n    this.url = a.url;\n    this.size = a.size;\n    this.sizeName = a.sizeName;\n  }\n\n  get fileSize(): number {\n    try {\n      if (this.size != null) {\n        return parseInt(this.size, null);\n      }\n    } catch {\n      // Invalid file size.\n    }\n    return 0;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<AttachmentView>>): AttachmentView {\n    const key = obj.key == null ? null : SymmetricCryptoKey.fromJSON(obj.key);\n    return Object.assign(new AttachmentView(), obj, { key: key });\n  }\n}\n","import { LinkedIdType } from \"./enums\";\nimport { ItemView } from \"./models/view/item.view\";\n\nexport class LinkedMetadata {\n  constructor(\n    readonly propertyKey: string,\n    private readonly _i18nKey?: string,\n  ) {}\n\n  get i18nKey() {\n    return this._i18nKey ?? this.propertyKey;\n  }\n}\n\n/**\n * A decorator used to set metadata used by Linked custom fields. Apply it to a class property or getter to make it\n *    available as a Linked custom field option.\n * @param id - A unique value that is saved in the Field model. It is used to look up the decorated class property.\n * @param i18nKey - The i18n key used to describe the decorated class property in the UI. If it is null, then the name\n *    of the class property will be used as the i18n key.\n */\nexport function linkedFieldOption(id: LinkedIdType, i18nKey?: string) {\n  return (prototype: ItemView, propertyKey: string) => {\n    if (prototype.linkedFieldOptions == null) {\n      prototype.linkedFieldOptions = new Map<LinkedIdType, LinkedMetadata>();\n    }\n\n    prototype.linkedFieldOptions.set(id, new LinkedMetadata(propertyKey, i18nKey));\n  };\n}\n","import { View } from \"../../../models/view/view\";\nimport { LinkedMetadata } from \"../../linked-field-option.decorator\";\n\nexport abstract class ItemView implements View {\n  linkedFieldOptions: Map<number, LinkedMetadata>;\n  abstract get subTitle(): string;\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { CardLinkedId as LinkedId } from \"../../enums\";\nimport { linkedFieldOption } from \"../../linked-field-option.decorator\";\n\nimport { ItemView } from \"./item.view\";\n\nexport class CardView extends ItemView {\n  @linkedFieldOption(LinkedId.CardholderName)\n  cardholderName: string = null;\n  @linkedFieldOption(LinkedId.ExpMonth, \"expirationMonth\")\n  expMonth: string = null;\n  @linkedFieldOption(LinkedId.ExpYear, \"expirationYear\")\n  expYear: string = null;\n  @linkedFieldOption(LinkedId.Code, \"securityCode\")\n  code: string = null;\n\n  private _brand: string = null;\n  private _number: string = null;\n  private _subTitle: string = null;\n\n  get maskedCode(): string {\n    return this.code != null ? \"•\".repeat(this.code.length) : null;\n  }\n\n  get maskedNumber(): string {\n    return this.number != null ? \"•\".repeat(this.number.length) : null;\n  }\n\n  @linkedFieldOption(LinkedId.Brand)\n  get brand(): string {\n    return this._brand;\n  }\n  set brand(value: string) {\n    this._brand = value;\n    this._subTitle = null;\n  }\n\n  @linkedFieldOption(LinkedId.Number)\n  get number(): string {\n    return this._number;\n  }\n  set number(value: string) {\n    this._number = value;\n    this._subTitle = null;\n  }\n\n  get subTitle(): string {\n    if (this._subTitle == null) {\n      this._subTitle = this.brand;\n      if (this.number != null && this.number.length >= 4) {\n        if (this._subTitle != null && this._subTitle !== \"\") {\n          this._subTitle += \", \";\n        } else {\n          this._subTitle = \"\";\n        }\n\n        // Show last 5 on amex, last 4 for all others\n        const count =\n          this.number.length >= 5 && this.number.match(new RegExp(\"^3[47]\")) != null ? 5 : 4;\n        this._subTitle += \"*\" + this.number.substr(this.number.length - count);\n      }\n    }\n    return this._subTitle;\n  }\n\n  get expiration(): string {\n    if (!this.expMonth && !this.expYear) {\n      return null;\n    }\n\n    let exp = this.expMonth != null ? (\"0\" + this.expMonth).slice(-2) : \"__\";\n    exp += \" / \" + (this.expYear != null ? this.formatYear(this.expYear) : \"____\");\n    return exp;\n  }\n\n  private formatYear(year: string): string {\n    return year.length === 2 ? \"20\" + year : year;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<CardView>>): CardView {\n    return Object.assign(new CardView(), obj);\n  }\n\n  // ref https://stackoverflow.com/a/5911300\n  static getCardBrandByPatterns(cardNum: string): string {\n    if (cardNum == null || typeof cardNum !== \"string\" || cardNum.trim() === \"\") {\n      return null;\n    }\n\n    // Visa\n    let re = new RegExp(\"^4\");\n    if (cardNum.match(re) != null) {\n      return \"Visa\";\n    }\n\n    // Mastercard\n    // Updated for Mastercard 2017 BINs expansion\n    if (\n      /^(5[1-5][0-9]{14}|2(22[1-9][0-9]{12}|2[3-9][0-9]{13}|[3-6][0-9]{14}|7[0-1][0-9]{13}|720[0-9]{12}))$/.test(\n        cardNum,\n      )\n    ) {\n      return \"Mastercard\";\n    }\n\n    // AMEX\n    re = new RegExp(\"^3[47]\");\n    if (cardNum.match(re) != null) {\n      return \"Amex\";\n    }\n\n    // Discover\n    re = new RegExp(\n      \"^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)\",\n    );\n    if (cardNum.match(re) != null) {\n      return \"Discover\";\n    }\n\n    // Diners\n    re = new RegExp(\"^36\");\n    if (cardNum.match(re) != null) {\n      return \"Diners Club\";\n    }\n\n    // Diners - Carte Blanche\n    re = new RegExp(\"^30[0-5]\");\n    if (cardNum.match(re) != null) {\n      return \"Diners Club\";\n    }\n\n    // JCB\n    re = new RegExp(\"^35(2[89]|[3-8][0-9])\");\n    if (cardNum.match(re) != null) {\n      return \"JCB\";\n    }\n\n    // Visa Electron\n    re = new RegExp(\"^(4026|417500|4508|4844|491(3|7))\");\n    if (cardNum.match(re) != null) {\n      return \"Visa\";\n    }\n\n    return null;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { View } from \"../../../models/view/view\";\nimport { FieldType, LinkedIdType } from \"../../enums\";\nimport { Field } from \"../domain/field\";\n\nexport class FieldView implements View {\n  name: string = null;\n  value: string = null;\n  type: FieldType = null;\n  newField = false; // Marks if the field is new and hasn't been saved\n  showValue = false;\n  showCount = false;\n  linkedId: LinkedIdType = null;\n\n  constructor(f?: Field) {\n    if (!f) {\n      return;\n    }\n\n    this.type = f.type;\n    this.linkedId = f.linkedId;\n  }\n\n  get maskedValue(): string {\n    return this.value != null ? \"••••••••\" : null;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<FieldView>>): FieldView {\n    return Object.assign(new FieldView(), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { IdentityLinkedId as LinkedId } from \"../../enums\";\nimport { linkedFieldOption } from \"../../linked-field-option.decorator\";\n\nimport { ItemView } from \"./item.view\";\n\nexport class IdentityView extends ItemView {\n  @linkedFieldOption(LinkedId.Title)\n  title: string = null;\n  @linkedFieldOption(LinkedId.MiddleName)\n  middleName: string = null;\n  @linkedFieldOption(LinkedId.Address1)\n  address1: string = null;\n  @linkedFieldOption(LinkedId.Address2)\n  address2: string = null;\n  @linkedFieldOption(LinkedId.Address3)\n  address3: string = null;\n  @linkedFieldOption(LinkedId.City, \"cityTown\")\n  city: string = null;\n  @linkedFieldOption(LinkedId.State, \"stateProvince\")\n  state: string = null;\n  @linkedFieldOption(LinkedId.PostalCode, \"zipPostalCode\")\n  postalCode: string = null;\n  @linkedFieldOption(LinkedId.Country)\n  country: string = null;\n  @linkedFieldOption(LinkedId.Company)\n  company: string = null;\n  @linkedFieldOption(LinkedId.Email)\n  email: string = null;\n  @linkedFieldOption(LinkedId.Phone)\n  phone: string = null;\n  @linkedFieldOption(LinkedId.Ssn)\n  ssn: string = null;\n  @linkedFieldOption(LinkedId.Username)\n  username: string = null;\n  @linkedFieldOption(LinkedId.PassportNumber)\n  passportNumber: string = null;\n  @linkedFieldOption(LinkedId.LicenseNumber)\n  licenseNumber: string = null;\n\n  private _firstName: string = null;\n  private _lastName: string = null;\n  private _subTitle: string = null;\n\n  constructor() {\n    super();\n  }\n\n  @linkedFieldOption(LinkedId.FirstName)\n  get firstName(): string {\n    return this._firstName;\n  }\n  set firstName(value: string) {\n    this._firstName = value;\n    this._subTitle = null;\n  }\n\n  @linkedFieldOption(LinkedId.LastName)\n  get lastName(): string {\n    return this._lastName;\n  }\n  set lastName(value: string) {\n    this._lastName = value;\n    this._subTitle = null;\n  }\n\n  get subTitle(): string {\n    if (this._subTitle == null && (this.firstName != null || this.lastName != null)) {\n      this._subTitle = \"\";\n      if (this.firstName != null) {\n        this._subTitle = this.firstName;\n      }\n      if (this.lastName != null) {\n        if (this._subTitle !== \"\") {\n          this._subTitle += \" \";\n        }\n        this._subTitle += this.lastName;\n      }\n    }\n\n    return this._subTitle;\n  }\n\n  @linkedFieldOption(LinkedId.FullName)\n  get fullName(): string {\n    if (\n      this.title != null ||\n      this.firstName != null ||\n      this.middleName != null ||\n      this.lastName != null\n    ) {\n      let name = \"\";\n      if (this.title != null) {\n        name += this.title + \" \";\n      }\n      if (this.firstName != null) {\n        name += this.firstName + \" \";\n      }\n      if (this.middleName != null) {\n        name += this.middleName + \" \";\n      }\n      if (this.lastName != null) {\n        name += this.lastName;\n      }\n      return name.trim();\n    }\n\n    return null;\n  }\n\n  get fullAddress(): string {\n    let address = this.address1;\n    if (!Utils.isNullOrWhitespace(this.address2)) {\n      if (!Utils.isNullOrWhitespace(address)) {\n        address += \", \";\n      }\n      address += this.address2;\n    }\n    if (!Utils.isNullOrWhitespace(this.address3)) {\n      if (!Utils.isNullOrWhitespace(address)) {\n        address += \", \";\n      }\n      address += this.address3;\n    }\n    return address;\n  }\n\n  get fullAddressPart2(): string {\n    if (this.city == null && this.state == null && this.postalCode == null) {\n      return null;\n    }\n    const city = this.city || \"-\";\n    const state = this.state;\n    const postalCode = this.postalCode || \"-\";\n    let addressPart2 = city;\n    if (!Utils.isNullOrWhitespace(state)) {\n      addressPart2 += \", \" + state;\n    }\n    addressPart2 += \", \" + postalCode;\n    return addressPart2;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<IdentityView>>): IdentityView {\n    return Object.assign(new IdentityView(), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { ItemView } from \"./item.view\";\n\nexport class Fido2CredentialView extends ItemView {\n  credentialId: string;\n  keyType: \"public-key\";\n  keyAlgorithm: \"ECDSA\";\n  keyCurve: \"P-256\";\n  keyValue: string;\n  rpId: string;\n  userHandle: string;\n  userName: string;\n  counter: number;\n  rpName: string;\n  userDisplayName: string;\n  discoverable: boolean;\n  creationDate: Date = null;\n\n  get subTitle(): string {\n    return this.userDisplayName;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Fido2CredentialView>>): Fido2CredentialView {\n    const creationDate = obj.creationDate != null ? new Date(obj.creationDate) : null;\n    return Object.assign(new Fido2CredentialView(), obj, {\n      creationDate,\n    });\n  }\n}\n","import { Utils } from \"./utils\";\n\nconst CanLaunchWhitelist = [\n  \"https://\",\n  \"http://\",\n  \"ssh://\",\n  \"ftp://\",\n  \"sftp://\",\n  \"irc://\",\n  \"vnc://\",\n  // https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/clients/remote-desktop-uri\n  \"rdp://\", // Legacy RDP URI scheme\n  \"ms-rd:\", // Preferred RDP URI scheme\n  \"chrome://\",\n  \"iosapp://\",\n  \"androidapp://\",\n];\n\nexport class SafeUrls {\n  static canLaunch(uri: string): boolean {\n    if (Utils.isNullOrWhitespace(uri)) {\n      return false;\n    }\n\n    for (let i = 0; i < CanLaunchWhitelist.length; i++) {\n      if (uri.indexOf(CanLaunchWhitelist[i]) === 0) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { View } from \"../../../models/view/view\";\nimport { SafeUrls } from \"../../../platform/misc/safe-urls\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { UriMatchType } from \"../../enums\";\nimport { LoginUri } from \"../domain/login-uri\";\n\nexport class LoginUriView implements View {\n  match: UriMatchType = null;\n\n  private _uri: string = null;\n  private _domain: string = null;\n  private _hostname: string = null;\n  private _host: string = null;\n  private _canLaunch: boolean = null;\n\n  constructor(u?: LoginUri) {\n    if (!u) {\n      return;\n    }\n\n    this.match = u.match;\n  }\n\n  get uri(): string {\n    return this._uri;\n  }\n  set uri(value: string) {\n    this._uri = value;\n    this._domain = null;\n    this._canLaunch = null;\n  }\n\n  get domain(): string {\n    if (this._domain == null && this.uri != null) {\n      this._domain = Utils.getDomain(this.uri);\n      if (this._domain === \"\") {\n        this._domain = null;\n      }\n    }\n\n    return this._domain;\n  }\n\n  get hostname(): string {\n    if (this.match === UriMatchType.RegularExpression) {\n      return null;\n    }\n    if (this._hostname == null && this.uri != null) {\n      this._hostname = Utils.getHostname(this.uri);\n      if (this._hostname === \"\") {\n        this._hostname = null;\n      }\n    }\n\n    return this._hostname;\n  }\n\n  get host(): string {\n    if (this.match === UriMatchType.RegularExpression) {\n      return null;\n    }\n    if (this._host == null && this.uri != null) {\n      this._host = Utils.getHost(this.uri);\n      if (this._host === \"\") {\n        this._host = null;\n      }\n    }\n\n    return this._host;\n  }\n\n  get hostnameOrUri(): string {\n    return this.hostname != null ? this.hostname : this.uri;\n  }\n\n  get hostOrUri(): string {\n    return this.host != null ? this.host : this.uri;\n  }\n\n  get isWebsite(): boolean {\n    return (\n      this.uri != null &&\n      (this.uri.indexOf(\"http://\") === 0 ||\n        this.uri.indexOf(\"https://\") === 0 ||\n        (this.uri.indexOf(\"://\") < 0 && !Utils.isNullOrWhitespace(Utils.getDomain(this.uri))))\n    );\n  }\n\n  get canLaunch(): boolean {\n    if (this._canLaunch != null) {\n      return this._canLaunch;\n    }\n    if (this.uri != null && this.match !== UriMatchType.RegularExpression) {\n      this._canLaunch = SafeUrls.canLaunch(this.launchUri);\n    } else {\n      this._canLaunch = false;\n    }\n    return this._canLaunch;\n  }\n\n  get launchUri(): string {\n    return this.uri.indexOf(\"://\") < 0 && !Utils.isNullOrWhitespace(Utils.getDomain(this.uri))\n      ? \"http://\" + this.uri\n      : this.uri;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<LoginUriView>>): LoginUriView {\n    return Object.assign(new LoginUriView(), obj);\n  }\n\n  matchesUri(\n    targetUri: string,\n    equivalentDomains: Set<string>,\n    defaultUriMatch: UriMatchType = null,\n  ): boolean {\n    if (!this.uri || !targetUri) {\n      return false;\n    }\n\n    let matchType = this.match ?? defaultUriMatch;\n    matchType ??= UriMatchType.Domain;\n\n    const targetDomain = Utils.getDomain(targetUri);\n    const matchDomains = equivalentDomains.add(targetDomain);\n\n    switch (matchType) {\n      case UriMatchType.Domain:\n        return this.matchesDomain(targetUri, matchDomains);\n      case UriMatchType.Host: {\n        const urlHost = Utils.getHost(targetUri);\n        return urlHost != null && urlHost === Utils.getHost(this.uri);\n      }\n      case UriMatchType.Exact:\n        return targetUri === this.uri;\n      case UriMatchType.StartsWith:\n        return targetUri.startsWith(this.uri);\n      case UriMatchType.RegularExpression:\n        try {\n          const regex = new RegExp(this.uri, \"i\");\n          return regex.test(targetUri);\n        } catch (e) {\n          // Invalid regex\n          return false;\n        }\n      case UriMatchType.Never:\n        return false;\n      default:\n        break;\n    }\n\n    return false;\n  }\n\n  private matchesDomain(targetUri: string, matchDomains: Set<string>) {\n    if (targetUri == null || this.domain == null || !matchDomains.has(this.domain)) {\n      return false;\n    }\n\n    if (Utils.DomainMatchBlacklist.has(this.domain)) {\n      const domainUrlHost = Utils.getHost(targetUri);\n      return !Utils.DomainMatchBlacklist.get(this.domain).has(domainUrlHost);\n    }\n\n    return true;\n  }\n}\n","import { Utils } from \"../../../platform/misc/utils\";\nimport { DeepJsonify } from \"../../../types/deep-jsonify\";\nimport { LoginLinkedId as LinkedId, UriMatchType } from \"../../enums\";\nimport { linkedFieldOption } from \"../../linked-field-option.decorator\";\nimport { Login } from \"../domain/login\";\n\nimport { Fido2CredentialView } from \"./fido2-credential.view\";\nimport { ItemView } from \"./item.view\";\nimport { LoginUriView } from \"./login-uri.view\";\n\nexport class LoginView extends ItemView {\n  @linkedFieldOption(LinkedId.Username)\n  username: string = null;\n  @linkedFieldOption(LinkedId.Password)\n  password: string = null;\n\n  passwordRevisionDate?: Date = null;\n  totp: string = null;\n  uris: LoginUriView[] = [];\n  autofillOnPageLoad: boolean = null;\n  fido2Credentials: Fido2CredentialView[] = null;\n\n  constructor(l?: Login) {\n    super();\n    if (!l) {\n      return;\n    }\n\n    this.passwordRevisionDate = l.passwordRevisionDate;\n    this.autofillOnPageLoad = l.autofillOnPageLoad;\n  }\n\n  get uri(): string {\n    return this.hasUris ? this.uris[0].uri : null;\n  }\n\n  get maskedPassword(): string {\n    return this.password != null ? \"••••••••\" : null;\n  }\n\n  get subTitle(): string {\n    return this.username;\n  }\n\n  get canLaunch(): boolean {\n    return this.hasUris && this.uris.some((u) => u.canLaunch);\n  }\n\n  get hasTotp(): boolean {\n    return !Utils.isNullOrWhitespace(this.totp);\n  }\n\n  get launchUri(): string {\n    if (this.hasUris) {\n      const uri = this.uris.find((u) => u.canLaunch);\n      if (uri != null) {\n        return uri.launchUri;\n      }\n    }\n    return null;\n  }\n\n  get hasUris(): boolean {\n    return this.uris != null && this.uris.length > 0;\n  }\n\n  get hasFido2Credentials(): boolean {\n    return this.fido2Credentials != null && this.fido2Credentials.length > 0;\n  }\n\n  matchesUri(\n    targetUri: string,\n    equivalentDomains: Set<string>,\n    defaultUriMatch: UriMatchType = null,\n  ): boolean {\n    if (this.uris == null) {\n      return false;\n    }\n\n    return this.uris.some((uri) => uri.matchesUri(targetUri, equivalentDomains, defaultUriMatch));\n  }\n\n  static fromJSON(obj: Partial<DeepJsonify<LoginView>>): LoginView {\n    const passwordRevisionDate =\n      obj.passwordRevisionDate == null ? null : new Date(obj.passwordRevisionDate);\n    const uris = obj.uris.map((uri) => LoginUriView.fromJSON(uri));\n    const fido2Credentials = obj.fido2Credentials?.map((key) => Fido2CredentialView.fromJSON(key));\n\n    return Object.assign(new LoginView(), obj, {\n      passwordRevisionDate,\n      uris,\n      fido2Credentials,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { View } from \"../../../models/view/view\";\nimport { Password } from \"../domain/password\";\n\nexport class PasswordHistoryView implements View {\n  password: string = null;\n  lastUsedDate: Date = null;\n\n  constructor(ph?: Password) {\n    if (!ph) {\n      return;\n    }\n\n    this.lastUsedDate = ph.lastUsedDate;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<PasswordHistoryView>>): PasswordHistoryView {\n    const lastUsedDate = obj.lastUsedDate == null ? null : new Date(obj.lastUsedDate);\n\n    return Object.assign(new PasswordHistoryView(), obj, {\n      lastUsedDate: lastUsedDate,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { SecureNoteType } from \"../../enums\";\nimport { SecureNote } from \"../domain/secure-note\";\n\nimport { ItemView } from \"./item.view\";\n\nexport class SecureNoteView extends ItemView {\n  type: SecureNoteType = null;\n\n  constructor(n?: SecureNote) {\n    super();\n    if (!n) {\n      return;\n    }\n\n    this.type = n.type;\n  }\n\n  get subTitle(): string {\n    return null;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<SecureNoteView>>): SecureNoteView {\n    return Object.assign(new SecureNoteView(), obj);\n  }\n}\n","import { View } from \"../../../models/view/view\";\nimport { InitializerMetadata } from \"../../../platform/interfaces/initializer-metadata.interface\";\nimport { InitializerKey } from \"../../../platform/services/cryptography/initializer-key\";\nimport { DeepJsonify } from \"../../../types/deep-jsonify\";\nimport { LinkedIdType } from \"../../enums\";\nimport { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../enums/cipher-type\";\nimport { LocalData } from \"../data/local.data\";\nimport { Cipher } from \"../domain/cipher\";\n\nimport { AttachmentView } from \"./attachment.view\";\nimport { CardView } from \"./card.view\";\nimport { FieldView } from \"./field.view\";\nimport { IdentityView } from \"./identity.view\";\nimport { LoginView } from \"./login.view\";\nimport { PasswordHistoryView } from \"./password-history.view\";\nimport { SecureNoteView } from \"./secure-note.view\";\n\nexport class CipherView implements View, InitializerMetadata {\n  readonly initializerKey = InitializerKey.CipherView;\n\n  id: string = null;\n  organizationId: string = null;\n  folderId: string = null;\n  name: string = null;\n  notes: string = null;\n  type: CipherType = null;\n  favorite = false;\n  organizationUseTotp = false;\n  edit = false;\n  viewPassword = true;\n  localData: LocalData;\n  login = new LoginView();\n  identity = new IdentityView();\n  card = new CardView();\n  secureNote = new SecureNoteView();\n  attachments: AttachmentView[] = null;\n  fields: FieldView[] = null;\n  passwordHistory: PasswordHistoryView[] = null;\n  collectionIds: string[] = null;\n  revisionDate: Date = null;\n  creationDate: Date = null;\n  deletedDate: Date = null;\n  reprompt: CipherRepromptType = CipherRepromptType.None;\n\n  constructor(c?: Cipher) {\n    if (!c) {\n      return;\n    }\n\n    this.id = c.id;\n    this.organizationId = c.organizationId;\n    this.folderId = c.folderId;\n    this.favorite = c.favorite;\n    this.organizationUseTotp = c.organizationUseTotp;\n    this.edit = c.edit;\n    this.viewPassword = c.viewPassword;\n    this.type = c.type;\n    this.localData = c.localData;\n    this.collectionIds = c.collectionIds;\n    this.revisionDate = c.revisionDate;\n    this.creationDate = c.creationDate;\n    this.deletedDate = c.deletedDate;\n    // Old locally stored ciphers might have reprompt == null. If so set it to None.\n    this.reprompt = c.reprompt ?? CipherRepromptType.None;\n  }\n\n  private get item() {\n    switch (this.type) {\n      case CipherType.Login:\n        return this.login;\n      case CipherType.SecureNote:\n        return this.secureNote;\n      case CipherType.Card:\n        return this.card;\n      case CipherType.Identity:\n        return this.identity;\n      default:\n        break;\n    }\n\n    return null;\n  }\n\n  get subTitle(): string {\n    return this.item?.subTitle;\n  }\n\n  get hasPasswordHistory(): boolean {\n    return this.passwordHistory && this.passwordHistory.length > 0;\n  }\n\n  get hasAttachments(): boolean {\n    return this.attachments && this.attachments.length > 0;\n  }\n\n  get hasOldAttachments(): boolean {\n    if (this.hasAttachments) {\n      for (let i = 0; i < this.attachments.length; i++) {\n        if (this.attachments[i].key == null) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  get hasFields(): boolean {\n    return this.fields && this.fields.length > 0;\n  }\n\n  get passwordRevisionDisplayDate(): Date {\n    if (this.type !== CipherType.Login || this.login == null) {\n      return null;\n    } else if (this.login.password == null || this.login.password === \"\") {\n      return null;\n    }\n    return this.login.passwordRevisionDate;\n  }\n\n  get isDeleted(): boolean {\n    return this.deletedDate != null;\n  }\n\n  get linkedFieldOptions() {\n    return this.item?.linkedFieldOptions;\n  }\n\n  linkedFieldValue(id: LinkedIdType) {\n    const linkedFieldOption = this.linkedFieldOptions?.get(id);\n    if (linkedFieldOption == null) {\n      return null;\n    }\n\n    const item = this.item;\n    return this.item[linkedFieldOption.propertyKey as keyof typeof item];\n  }\n\n  linkedFieldI18nKey(id: LinkedIdType): string {\n    return this.linkedFieldOptions.get(id)?.i18nKey;\n  }\n\n  // This is used as a marker to indicate that the cipher view object still has its prototype\n  toJSON() {\n    return this;\n  }\n\n  static fromJSON(obj: Partial<DeepJsonify<CipherView>>): CipherView {\n    if (obj == null) {\n      return null;\n    }\n\n    const view = new CipherView();\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    const deletedDate = obj.deletedDate == null ? null : new Date(obj.deletedDate);\n    const attachments = obj.attachments?.map((a: any) => AttachmentView.fromJSON(a));\n    const fields = obj.fields?.map((f: any) => FieldView.fromJSON(f));\n    const passwordHistory = obj.passwordHistory?.map((ph: any) => PasswordHistoryView.fromJSON(ph));\n\n    Object.assign(view, obj, {\n      revisionDate: revisionDate,\n      deletedDate: deletedDate,\n      attachments: attachments,\n      fields: fields,\n      passwordHistory: passwordHistory,\n    });\n\n    switch (obj.type) {\n      case CipherType.Card:\n        view.card = CardView.fromJSON(obj.card);\n        break;\n      case CipherType.Identity:\n        view.identity = IdentityView.fromJSON(obj.identity);\n        break;\n      case CipherType.Login:\n        view.login = LoginView.fromJSON(obj.login);\n        break;\n      case CipherType.SecureNote:\n        view.secureNote = SecureNoteView.fromJSON(obj.secureNote);\n        break;\n      default:\n        break;\n    }\n\n    return view;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Region } from \"../../abstractions/environment.service\";\nimport {\n  ServerConfigResponse,\n  ThirdPartyServerConfigResponse,\n  EnvironmentServerConfigResponse,\n} from \"../response/server-config.response\";\n\nexport class ServerConfigData {\n  version: string;\n  gitHash: string;\n  server?: ThirdPartyServerConfigData;\n  environment?: EnvironmentServerConfigData;\n  utcDate: string;\n  featureStates: { [key: string]: string } = {};\n\n  constructor(serverConfigResponse: Partial<ServerConfigResponse>) {\n    this.version = serverConfigResponse?.version;\n    this.gitHash = serverConfigResponse?.gitHash;\n    this.server = serverConfigResponse?.server\n      ? new ThirdPartyServerConfigData(serverConfigResponse.server)\n      : null;\n    this.utcDate = new Date().toISOString();\n    this.environment = serverConfigResponse?.environment\n      ? new EnvironmentServerConfigData(serverConfigResponse.environment)\n      : null;\n    this.featureStates = serverConfigResponse?.featureStates;\n  }\n\n  static fromJSON(obj: Jsonify<ServerConfigData>): ServerConfigData {\n    return Object.assign(new ServerConfigData({}), obj, {\n      server: obj?.server ? ThirdPartyServerConfigData.fromJSON(obj.server) : null,\n      environment: obj?.environment ? EnvironmentServerConfigData.fromJSON(obj.environment) : null,\n    });\n  }\n}\n\nexport class ThirdPartyServerConfigData {\n  name: string;\n  url: string;\n\n  constructor(response: Partial<ThirdPartyServerConfigResponse>) {\n    this.name = response.name;\n    this.url = response.url;\n  }\n\n  static fromJSON(obj: Jsonify<ThirdPartyServerConfigData>): ThirdPartyServerConfigData {\n    return Object.assign(new ThirdPartyServerConfigData({}), obj);\n  }\n}\n\nexport class EnvironmentServerConfigData {\n  cloudRegion: Region;\n  vault: string;\n  api: string;\n  identity: string;\n  notifications: string;\n  sso: string;\n\n  constructor(response: Partial<EnvironmentServerConfigResponse>) {\n    this.cloudRegion = response.cloudRegion;\n    this.vault = response.vault;\n    this.api = response.api;\n    this.identity = response.identity;\n    this.notifications = response.notifications;\n    this.sso = response.sso;\n  }\n\n  static fromJSON(obj: Jsonify<EnvironmentServerConfigData>): EnvironmentServerConfigData {\n    return Object.assign(new EnvironmentServerConfigData({}), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { OrganizationData } from \"../../../admin-console/models/data/organization.data\";\nimport { PolicyData } from \"../../../admin-console/models/data/policy.data\";\nimport { ProviderData } from \"../../../admin-console/models/data/provider.data\";\nimport { Policy } from \"../../../admin-console/models/domain/policy\";\nimport { AdminAuthRequestStorable } from \"../../../auth/models/domain/admin-auth-req-storable\";\nimport { ForceSetPasswordReason } from \"../../../auth/models/domain/force-set-password-reason\";\nimport { KeyConnectorUserDecryptionOption } from \"../../../auth/models/domain/user-decryption-options/key-connector-user-decryption-option\";\nimport { TrustedDeviceUserDecryptionOption } from \"../../../auth/models/domain/user-decryption-options/trusted-device-user-decryption-option\";\nimport { IdentityTokenResponse } from \"../../../auth/models/response/identity-token.response\";\nimport { EventData } from \"../../../models/data/event.data\";\nimport { GeneratorOptions } from \"../../../tools/generator/generator-options\";\nimport {\n  GeneratedPasswordHistory,\n  PasswordGeneratorOptions,\n} from \"../../../tools/generator/password\";\nimport { UsernameGeneratorOptions } from \"../../../tools/generator/username/username-generation-options\";\nimport { SendData } from \"../../../tools/send/models/data/send.data\";\nimport { SendView } from \"../../../tools/send/models/view/send.view\";\nimport { DeepJsonify } from \"../../../types/deep-jsonify\";\nimport { MasterKey } from \"../../../types/key\";\nimport { UriMatchType } from \"../../../vault/enums\";\nimport { CipherData } from \"../../../vault/models/data/cipher.data\";\nimport { CipherView } from \"../../../vault/models/view/cipher.view\";\nimport { AddEditCipherInfo } from \"../../../vault/types/add-edit-cipher-info\";\nimport { KdfType } from \"../../enums\";\nimport { Utils } from \"../../misc/utils\";\nimport { ServerConfigData } from \"../../models/data/server-config.data\";\n\nimport { EncryptedString, EncString } from \"./enc-string\";\nimport { SymmetricCryptoKey } from \"./symmetric-crypto-key\";\n\nexport class EncryptionPair<TEncrypted, TDecrypted> {\n  encrypted?: TEncrypted;\n  decrypted?: TDecrypted;\n\n  toJSON() {\n    return {\n      encrypted: this.encrypted,\n      decrypted:\n        this.decrypted instanceof ArrayBuffer\n          ? Utils.fromBufferToByteString(this.decrypted)\n          : this.decrypted,\n    };\n  }\n\n  static fromJSON<TEncrypted, TDecrypted>(\n    obj: { encrypted?: Jsonify<TEncrypted>; decrypted?: string | Jsonify<TDecrypted> },\n    decryptedFromJson?: (decObj: Jsonify<TDecrypted> | string) => TDecrypted,\n    encryptedFromJson?: (encObj: Jsonify<TEncrypted>) => TEncrypted,\n  ) {\n    if (obj == null) {\n      return null;\n    }\n\n    const pair = new EncryptionPair<TEncrypted, TDecrypted>();\n    if (obj?.encrypted != null) {\n      pair.encrypted = encryptedFromJson\n        ? encryptedFromJson(obj.encrypted)\n        : (obj.encrypted as TEncrypted);\n    }\n    if (obj?.decrypted != null) {\n      pair.decrypted = decryptedFromJson\n        ? decryptedFromJson(obj.decrypted)\n        : (obj.decrypted as TDecrypted);\n    }\n    return pair;\n  }\n}\n\nexport class DataEncryptionPair<TEncrypted, TDecrypted> {\n  encrypted?: Record<string, TEncrypted>;\n  decrypted?: TDecrypted[];\n}\n\n// This is a temporary structure to handle migrated `DataEncryptionPair` to\n//  avoid needing a data migration at this stage. It should be replaced with\n//  proper data migrations when `DataEncryptionPair` is deprecated.\nexport class TemporaryDataEncryption<TEncrypted> {\n  encrypted?: { [id: string]: TEncrypted };\n}\n\nexport class AccountData {\n  ciphers?: DataEncryptionPair<CipherData, CipherView> = new DataEncryptionPair<\n    CipherData,\n    CipherView\n  >();\n  localData?: any;\n  sends?: DataEncryptionPair<SendData, SendView> = new DataEncryptionPair<SendData, SendView>();\n  policies?: DataEncryptionPair<PolicyData, Policy> = new DataEncryptionPair<PolicyData, Policy>();\n  passwordGenerationHistory?: EncryptionPair<\n    GeneratedPasswordHistory[],\n    GeneratedPasswordHistory[]\n  > = new EncryptionPair<GeneratedPasswordHistory[], GeneratedPasswordHistory[]>();\n  addEditCipherInfo?: AddEditCipherInfo;\n  eventCollection?: EventData[];\n  organizations?: { [id: string]: OrganizationData };\n  providers?: { [id: string]: ProviderData };\n\n  static fromJSON(obj: DeepJsonify<AccountData>): AccountData {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new AccountData(), obj, {\n      addEditCipherInfo: {\n        cipher: CipherView.fromJSON(obj?.addEditCipherInfo?.cipher),\n        collectionIds: obj?.addEditCipherInfo?.collectionIds,\n      },\n    });\n  }\n}\n\nexport class AccountKeys {\n  masterKey?: MasterKey;\n  masterKeyEncryptedUserKey?: string;\n  deviceKey?: ReturnType<SymmetricCryptoKey[\"toJSON\"]>;\n  publicKey?: Uint8Array;\n  apiKeyClientSecret?: string;\n\n  /** @deprecated July 2023, left for migration purposes*/\n  cryptoMasterKey?: SymmetricCryptoKey;\n  /** @deprecated July 2023, left for migration purposes*/\n  cryptoMasterKeyAuto?: string;\n  /** @deprecated July 2023, left for migration purposes*/\n  cryptoMasterKeyBiometric?: string;\n  /** @deprecated July 2023, left for migration purposes*/\n  cryptoSymmetricKey?: EncryptionPair<string, SymmetricCryptoKey> = new EncryptionPair<\n    string,\n    SymmetricCryptoKey\n  >();\n\n  toJSON() {\n    // If you pass undefined into fromBufferToByteString, you will get an empty string back\n    // which will cause all sorts of headaches down the line when you try to getPublicKey\n    // and expect a Uint8Array and get an empty string instead.\n    return Utils.merge(this, {\n      publicKey: this.publicKey ? Utils.fromBufferToByteString(this.publicKey) : undefined,\n    });\n  }\n\n  static fromJSON(obj: DeepJsonify<AccountKeys>): AccountKeys {\n    if (obj == null) {\n      return null;\n    }\n    return Object.assign(new AccountKeys(), obj, {\n      masterKey: SymmetricCryptoKey.fromJSON(obj?.masterKey),\n      deviceKey: obj?.deviceKey,\n      cryptoMasterKey: SymmetricCryptoKey.fromJSON(obj?.cryptoMasterKey),\n      cryptoSymmetricKey: EncryptionPair.fromJSON(\n        obj?.cryptoSymmetricKey,\n        SymmetricCryptoKey.fromJSON,\n      ),\n      publicKey: Utils.fromByteStringToArray(obj?.publicKey),\n    });\n  }\n\n  static initRecordEncryptionPairsFromJSON(obj: any) {\n    return EncryptionPair.fromJSON(obj, (decObj: any) => {\n      if (obj == null) {\n        return null;\n      }\n\n      const record: Record<string, SymmetricCryptoKey> = {};\n      for (const id in decObj) {\n        record[id] = SymmetricCryptoKey.fromJSON(decObj[id]);\n      }\n      return record;\n    });\n  }\n}\n\nexport class AccountProfile {\n  apiKeyClientId?: string;\n  convertAccountToKeyConnector?: boolean;\n  name?: string;\n  email?: string;\n  emailVerified?: boolean;\n  everBeenUnlocked?: boolean;\n  forceSetPasswordReason?: ForceSetPasswordReason;\n  hasPremiumPersonally?: boolean;\n  hasPremiumFromOrganization?: boolean;\n  lastSync?: string;\n  userId?: string;\n  usesKeyConnector?: boolean;\n  keyHash?: string;\n  kdfIterations?: number;\n  kdfMemory?: number;\n  kdfParallelism?: number;\n  kdfType?: KdfType;\n\n  static fromJSON(obj: Jsonify<AccountProfile>): AccountProfile {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new AccountProfile(), obj);\n  }\n}\n\nexport class AccountSettings {\n  autoConfirmFingerPrints?: boolean;\n  biometricUnlock?: boolean;\n  defaultUriMatch?: UriMatchType;\n  disableBadgeCounter?: boolean;\n  disableGa?: boolean;\n  dontShowCardsCurrentTab?: boolean;\n  dontShowIdentitiesCurrentTab?: boolean;\n  enableAlwaysOnTop?: boolean;\n  enableBiometric?: boolean;\n  equivalentDomains?: any;\n  minimizeOnCopyToClipboard?: boolean;\n  passwordGenerationOptions?: PasswordGeneratorOptions;\n  usernameGenerationOptions?: UsernameGeneratorOptions;\n  generatorOptions?: GeneratorOptions;\n  pinKeyEncryptedUserKey?: EncryptedString;\n  pinKeyEncryptedUserKeyEphemeral?: EncryptedString;\n  protectedPin?: string;\n  settings?: AccountSettingsSettings; // TODO: Merge whatever is going on here into the AccountSettings model properly\n  vaultTimeout?: number;\n  vaultTimeoutAction?: string = \"lock\";\n  serverConfig?: ServerConfigData;\n  approveLoginRequests?: boolean;\n  avatarColor?: string;\n  trustDeviceChoiceForDecryption?: boolean;\n\n  /** @deprecated July 2023, left for migration purposes*/\n  pinProtected?: EncryptionPair<string, EncString> = new EncryptionPair<string, EncString>();\n\n  static fromJSON(obj: Jsonify<AccountSettings>): AccountSettings {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new AccountSettings(), obj, {\n      pinProtected: EncryptionPair.fromJSON<string, EncString>(\n        obj?.pinProtected,\n        EncString.fromJSON,\n      ),\n      serverConfig: ServerConfigData.fromJSON(obj?.serverConfig),\n    });\n  }\n}\n\nexport type AccountSettingsSettings = {\n  equivalentDomains?: string[][];\n};\n\nexport class AccountTokens {\n  accessToken?: string;\n  refreshToken?: string;\n  securityStamp?: string;\n\n  static fromJSON(obj: Jsonify<AccountTokens>): AccountTokens {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new AccountTokens(), obj);\n  }\n}\n\nexport class AccountDecryptionOptions {\n  hasMasterPassword: boolean;\n  trustedDeviceOption?: TrustedDeviceUserDecryptionOption;\n  keyConnectorOption?: KeyConnectorUserDecryptionOption;\n\n  constructor(init?: Partial<AccountDecryptionOptions>) {\n    if (init) {\n      Object.assign(this, init);\n    }\n  }\n\n  // TODO: these nice getters don't work because the Account object is not properly being deserialized out of\n  // JSON (the Account static fromJSON method is not running) so these getters don't exist on the\n  // account decryptions options object when pulled out of state.  This is a bug that needs to be fixed later on\n  // get hasTrustedDeviceOption(): boolean {\n  //   return this.trustedDeviceOption !== null && this.trustedDeviceOption !== undefined;\n  // }\n\n  // get hasKeyConnectorOption(): boolean {\n  //   return this.keyConnectorOption !== null && this.keyConnectorOption !== undefined;\n  // }\n\n  static fromResponse(response: IdentityTokenResponse): AccountDecryptionOptions {\n    if (response == null) {\n      return null;\n    }\n\n    const accountDecryptionOptions = new AccountDecryptionOptions();\n\n    if (response.userDecryptionOptions) {\n      // If the response has userDecryptionOptions, this means it's on a post-TDE server version and can interrogate\n      // the new decryption options.\n      const responseOptions = response.userDecryptionOptions;\n      accountDecryptionOptions.hasMasterPassword = responseOptions.hasMasterPassword;\n\n      if (responseOptions.trustedDeviceOption) {\n        accountDecryptionOptions.trustedDeviceOption = new TrustedDeviceUserDecryptionOption(\n          responseOptions.trustedDeviceOption.hasAdminApproval,\n          responseOptions.trustedDeviceOption.hasLoginApprovingDevice,\n          responseOptions.trustedDeviceOption.hasManageResetPasswordPermission,\n        );\n      }\n\n      if (responseOptions.keyConnectorOption) {\n        accountDecryptionOptions.keyConnectorOption = new KeyConnectorUserDecryptionOption(\n          responseOptions.keyConnectorOption.keyConnectorUrl,\n        );\n      }\n    } else {\n      // If the response does not have userDecryptionOptions, this means it's on a pre-TDE server version and so\n      // we must base our decryption options on the presence of the keyConnectorUrl.\n      // Note that the presence of keyConnectorUrl implies that the user does not have a master password, as in pre-TDE\n      // server versions, a master password short-circuited the addition of the keyConnectorUrl to the response.\n      // TODO: remove this check after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3537)\n      const usingKeyConnector = response.keyConnectorUrl != null;\n      accountDecryptionOptions.hasMasterPassword = !usingKeyConnector;\n      if (usingKeyConnector) {\n        accountDecryptionOptions.keyConnectorOption = new KeyConnectorUserDecryptionOption(\n          response.keyConnectorUrl,\n        );\n      }\n    }\n    return accountDecryptionOptions;\n  }\n\n  static fromJSON(obj: Jsonify<AccountDecryptionOptions>): AccountDecryptionOptions {\n    if (obj == null) {\n      return null;\n    }\n\n    const accountDecryptionOptions = Object.assign(new AccountDecryptionOptions(), obj);\n\n    if (obj.trustedDeviceOption) {\n      accountDecryptionOptions.trustedDeviceOption = new TrustedDeviceUserDecryptionOption(\n        obj.trustedDeviceOption.hasAdminApproval,\n        obj.trustedDeviceOption.hasLoginApprovingDevice,\n        obj.trustedDeviceOption.hasManageResetPasswordPermission,\n      );\n    }\n\n    if (obj.keyConnectorOption) {\n      accountDecryptionOptions.keyConnectorOption = new KeyConnectorUserDecryptionOption(\n        obj.keyConnectorOption.keyConnectorUrl,\n      );\n    }\n\n    return accountDecryptionOptions;\n  }\n}\n\nexport class Account {\n  data?: AccountData = new AccountData();\n  keys?: AccountKeys = new AccountKeys();\n  profile?: AccountProfile = new AccountProfile();\n  settings?: AccountSettings = new AccountSettings();\n  tokens?: AccountTokens = new AccountTokens();\n  decryptionOptions?: AccountDecryptionOptions = new AccountDecryptionOptions();\n  adminAuthRequest?: Jsonify<AdminAuthRequestStorable> = null;\n\n  constructor(init: Partial<Account>) {\n    Object.assign(this, {\n      data: {\n        ...new AccountData(),\n        ...init?.data,\n      },\n      keys: {\n        ...new AccountKeys(),\n        ...init?.keys,\n      },\n      profile: {\n        ...new AccountProfile(),\n        ...init?.profile,\n      },\n      settings: {\n        ...new AccountSettings(),\n        ...init?.settings,\n      },\n      tokens: {\n        ...new AccountTokens(),\n        ...init?.tokens,\n      },\n      decryptionOptions: {\n        ...new AccountDecryptionOptions(),\n        ...init?.decryptionOptions,\n      },\n      adminAuthRequest: init?.adminAuthRequest,\n    });\n  }\n\n  static fromJSON(json: Jsonify<Account>): Account {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new Account({}), json, {\n      keys: AccountKeys.fromJSON(json?.keys),\n      data: AccountData.fromJSON(json?.data),\n      profile: AccountProfile.fromJSON(json?.profile),\n      settings: AccountSettings.fromJSON(json?.settings),\n      tokens: AccountTokens.fromJSON(json?.tokens),\n      decryptionOptions: AccountDecryptionOptions.fromJSON(json?.decryptionOptions),\n      adminAuthRequest: AdminAuthRequestStorable.fromJSON(json?.adminAuthRequest),\n    });\n  }\n}\n","import { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { TokenService } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { TwoFactorService } from \"@bitwarden/common/auth/abstractions/two-factor.service\";\nimport { TwoFactorProviderType } from \"@bitwarden/common/auth/enums/two-factor-provider-type\";\nimport { AuthResult } from \"@bitwarden/common/auth/models/domain/auth-result\";\nimport { ForceSetPasswordReason } from \"@bitwarden/common/auth/models/domain/force-set-password-reason\";\nimport { DeviceRequest } from \"@bitwarden/common/auth/models/request/identity-token/device.request\";\nimport { PasswordTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/password-token.request\";\nimport { SsoTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/sso-token.request\";\nimport { TokenTwoFactorRequest } from \"@bitwarden/common/auth/models/request/identity-token/token-two-factor.request\";\nimport { UserApiTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/user-api-token.request\";\nimport { WebAuthnLoginTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/webauthn-login-token.request\";\nimport { IdentityCaptchaResponse } from \"@bitwarden/common/auth/models/response/identity-captcha.response\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { IdentityTwoFactorResponse } from \"@bitwarden/common/auth/models/response/identity-two-factor.response\";\nimport { ClientType } from \"@bitwarden/common/enums\";\nimport { KeysRequest } from \"@bitwarden/common/models/request/keys.request\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport {\n  AccountKeys,\n  Account,\n  AccountProfile,\n  AccountTokens,\n  AccountDecryptionOptions,\n} from \"@bitwarden/common/platform/models/domain/account\";\n\nimport {\n  UserApiLoginCredentials,\n  PasswordLoginCredentials,\n  SsoLoginCredentials,\n  AuthRequestLoginCredentials,\n  WebAuthnLoginCredentials,\n} from \"../models/domain/login-credentials\";\n\ntype IdentityResponse = IdentityTokenResponse | IdentityTwoFactorResponse | IdentityCaptchaResponse;\n\nexport abstract class LoginStrategy {\n  protected abstract tokenRequest:\n    | UserApiTokenRequest\n    | PasswordTokenRequest\n    | SsoTokenRequest\n    | WebAuthnLoginTokenRequest;\n  protected captchaBypassToken: string = null;\n\n  constructor(\n    protected cryptoService: CryptoService,\n    protected apiService: ApiService,\n    protected tokenService: TokenService,\n    protected appIdService: AppIdService,\n    protected platformUtilsService: PlatformUtilsService,\n    protected messagingService: MessagingService,\n    protected logService: LogService,\n    protected stateService: StateService,\n    protected twoFactorService: TwoFactorService,\n  ) {}\n\n  abstract logIn(\n    credentials:\n      | UserApiLoginCredentials\n      | PasswordLoginCredentials\n      | SsoLoginCredentials\n      | AuthRequestLoginCredentials\n      | WebAuthnLoginCredentials,\n  ): Promise<AuthResult>;\n\n  async logInTwoFactor(\n    twoFactor: TokenTwoFactorRequest,\n    captchaResponse: string = null,\n  ): Promise<AuthResult> {\n    this.tokenRequest.setTwoFactor(twoFactor);\n    const [authResult] = await this.startLogIn();\n    return authResult;\n  }\n\n  protected async startLogIn(): Promise<[AuthResult, IdentityResponse]> {\n    this.twoFactorService.clearSelectedProvider();\n\n    const response = await this.apiService.postIdentityToken(this.tokenRequest);\n\n    if (response instanceof IdentityTwoFactorResponse) {\n      return [await this.processTwoFactorResponse(response), response];\n    } else if (response instanceof IdentityCaptchaResponse) {\n      return [await this.processCaptchaResponse(response), response];\n    } else if (response instanceof IdentityTokenResponse) {\n      return [await this.processTokenResponse(response), response];\n    }\n\n    throw new Error(\"Invalid response object.\");\n  }\n\n  protected async buildDeviceRequest() {\n    const appId = await this.appIdService.getAppId();\n    return new DeviceRequest(appId, this.platformUtilsService);\n  }\n\n  protected async buildTwoFactor(userProvidedTwoFactor?: TokenTwoFactorRequest) {\n    if (userProvidedTwoFactor != null) {\n      return userProvidedTwoFactor;\n    }\n\n    const storedTwoFactorToken = await this.tokenService.getTwoFactorToken();\n    if (storedTwoFactorToken != null) {\n      return new TokenTwoFactorRequest(TwoFactorProviderType.Remember, storedTwoFactorToken, false);\n    }\n\n    return new TokenTwoFactorRequest();\n  }\n\n  protected async saveAccountInformation(tokenResponse: IdentityTokenResponse) {\n    const accountInformation = await this.tokenService.decodeToken(tokenResponse.accessToken);\n\n    // Must persist existing device key if it exists for trusted device decryption to work\n    // However, we must provide a user id so that the device key can be retrieved\n    // as the state service won't have an active account at this point in time\n    // even though the data exists in local storage.\n    const userId = accountInformation.sub;\n\n    const deviceKey = await this.stateService.getDeviceKey({ userId });\n    const accountKeys = new AccountKeys();\n    if (deviceKey) {\n      accountKeys.deviceKey = deviceKey;\n    }\n\n    // If you don't persist existing admin auth requests on login, they will get deleted.\n    const adminAuthRequest = await this.stateService.getAdminAuthRequest({ userId });\n\n    await this.stateService.addAccount(\n      new Account({\n        profile: {\n          ...new AccountProfile(),\n          ...{\n            userId,\n            name: accountInformation.name,\n            email: accountInformation.email,\n            hasPremiumPersonally: accountInformation.premium,\n            kdfIterations: tokenResponse.kdfIterations,\n            kdfMemory: tokenResponse.kdfMemory,\n            kdfParallelism: tokenResponse.kdfParallelism,\n            kdfType: tokenResponse.kdf,\n          },\n        },\n        tokens: {\n          ...new AccountTokens(),\n          ...{\n            accessToken: tokenResponse.accessToken,\n            refreshToken: tokenResponse.refreshToken,\n          },\n        },\n        keys: accountKeys,\n        decryptionOptions: AccountDecryptionOptions.fromResponse(tokenResponse),\n        adminAuthRequest: adminAuthRequest?.toJSON(),\n      }),\n    );\n  }\n\n  protected async processTokenResponse(response: IdentityTokenResponse): Promise<AuthResult> {\n    const result = new AuthResult();\n\n    // Old encryption keys must be migrated, but is currently only available on web.\n    // Other clients shouldn't continue the login process.\n    if (this.encryptionKeyMigrationRequired(response)) {\n      result.requiresEncryptionKeyMigration = true;\n      if (this.platformUtilsService.getClientType() !== ClientType.Web) {\n        return result;\n      }\n    }\n\n    result.resetMasterPassword = response.resetMasterPassword;\n\n    // Convert boolean to enum\n    if (response.forcePasswordReset) {\n      result.forcePasswordReset = ForceSetPasswordReason.AdminForcePasswordReset;\n    }\n\n    // Must come before setting keys, user key needs email to update additional keys\n    await this.saveAccountInformation(response);\n\n    if (response.twoFactorToken != null) {\n      await this.tokenService.setTwoFactorToken(response);\n    }\n\n    await this.setMasterKey(response);\n    await this.setUserKey(response);\n    await this.setPrivateKey(response);\n\n    this.messagingService.send(\"loggedIn\");\n\n    return result;\n  }\n\n  // The keys comes from different sources depending on the login strategy\n  protected abstract setMasterKey(response: IdentityTokenResponse): Promise<void>;\n\n  protected abstract setUserKey(response: IdentityTokenResponse): Promise<void>;\n\n  protected abstract setPrivateKey(response: IdentityTokenResponse): Promise<void>;\n\n  // Old accounts used master key for encryption. We are forcing migrations but only need to\n  // check on password logins\n  protected encryptionKeyMigrationRequired(response: IdentityTokenResponse): boolean {\n    return false;\n  }\n\n  protected async createKeyPairForOldAccount() {\n    try {\n      const [publicKey, privateKey] = await this.cryptoService.makeKeyPair();\n      await this.apiService.postAccountKeys(new KeysRequest(publicKey, privateKey.encryptedString));\n      return privateKey.encryptedString;\n    } catch (e) {\n      this.logService.error(e);\n    }\n  }\n\n  private async processTwoFactorResponse(response: IdentityTwoFactorResponse): Promise<AuthResult> {\n    const result = new AuthResult();\n    result.twoFactorProviders = response.twoFactorProviders2;\n\n    this.twoFactorService.setProviders(response);\n    this.captchaBypassToken = response.captchaToken ?? null;\n    result.ssoEmail2FaSessionToken = response.ssoEmail2faSessionToken;\n    result.email = response.email;\n    return result;\n  }\n\n  private async processCaptchaResponse(response: IdentityCaptchaResponse): Promise<AuthResult> {\n    const result = new AuthResult();\n    result.captchaSiteKey = response.siteKey;\n    return result;\n  }\n}\n","import { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { DeviceTrustCryptoServiceAbstraction } from \"@bitwarden/common/auth/abstractions/device-trust-crypto.service.abstraction\";\nimport { TokenService } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { TwoFactorService } from \"@bitwarden/common/auth/abstractions/two-factor.service\";\nimport { AuthResult } from \"@bitwarden/common/auth/models/domain/auth-result\";\nimport { PasswordTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/password-token.request\";\nimport { TokenTwoFactorRequest } from \"@bitwarden/common/auth/models/request/identity-token/token-two-factor.request\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\n\nimport { AuthRequestLoginCredentials } from \"../models/domain/login-credentials\";\n\nimport { LoginStrategy } from \"./login.strategy\";\n\nexport class AuthRequestLoginStrategy extends LoginStrategy {\n  get email() {\n    return this.tokenRequest.email;\n  }\n\n  get accessCode() {\n    return this.authRequestCredentials.accessCode;\n  }\n\n  get authRequestId() {\n    return this.authRequestCredentials.authRequestId;\n  }\n\n  tokenRequest: PasswordTokenRequest;\n  private authRequestCredentials: AuthRequestLoginCredentials;\n\n  constructor(\n    cryptoService: CryptoService,\n    apiService: ApiService,\n    tokenService: TokenService,\n    appIdService: AppIdService,\n    platformUtilsService: PlatformUtilsService,\n    messagingService: MessagingService,\n    logService: LogService,\n    stateService: StateService,\n    twoFactorService: TwoFactorService,\n    private deviceTrustCryptoService: DeviceTrustCryptoServiceAbstraction,\n  ) {\n    super(\n      cryptoService,\n      apiService,\n      tokenService,\n      appIdService,\n      platformUtilsService,\n      messagingService,\n      logService,\n      stateService,\n      twoFactorService,\n    );\n  }\n\n  override async logIn(credentials: AuthRequestLoginCredentials) {\n    // NOTE: To avoid DeadObject references on Firefox, do not set the credentials object directly\n    // Use deep copy in future if objects are added that were created in popup\n    this.authRequestCredentials = { ...credentials };\n\n    this.tokenRequest = new PasswordTokenRequest(\n      credentials.email,\n      credentials.accessCode,\n      null,\n      await this.buildTwoFactor(credentials.twoFactor),\n      await this.buildDeviceRequest(),\n    );\n\n    this.tokenRequest.setAuthRequestAccessCode(credentials.authRequestId);\n    const [authResult] = await this.startLogIn();\n    return authResult;\n  }\n\n  override async logInTwoFactor(\n    twoFactor: TokenTwoFactorRequest,\n    captchaResponse: string,\n  ): Promise<AuthResult> {\n    this.tokenRequest.captchaResponse = captchaResponse ?? this.captchaBypassToken;\n    return super.logInTwoFactor(twoFactor);\n  }\n\n  protected override async setMasterKey(response: IdentityTokenResponse) {\n    if (\n      this.authRequestCredentials.decryptedMasterKey &&\n      this.authRequestCredentials.decryptedMasterKeyHash\n    ) {\n      await this.cryptoService.setMasterKey(this.authRequestCredentials.decryptedMasterKey);\n      await this.cryptoService.setMasterKeyHash(this.authRequestCredentials.decryptedMasterKeyHash);\n    }\n  }\n\n  protected override async setUserKey(response: IdentityTokenResponse): Promise<void> {\n    // User now may or may not have a master password\n    // but set the master key encrypted user key if it exists regardless\n    await this.cryptoService.setMasterKeyEncryptedUserKey(response.key);\n\n    if (this.authRequestCredentials.decryptedUserKey) {\n      await this.cryptoService.setUserKey(this.authRequestCredentials.decryptedUserKey);\n    } else {\n      await this.trySetUserKeyWithMasterKey();\n      // Establish trust if required after setting user key\n      await this.deviceTrustCryptoService.trustDeviceIfRequired();\n    }\n  }\n\n  private async trySetUserKeyWithMasterKey(): Promise<void> {\n    const masterKey = await this.cryptoService.getMasterKey();\n    if (masterKey) {\n      const userKey = await this.cryptoService.decryptUserKeyWithMasterKey(masterKey);\n      await this.cryptoService.setUserKey(userKey);\n    }\n  }\n\n  protected override async setPrivateKey(response: IdentityTokenResponse): Promise<void> {\n    await this.cryptoService.setPrivateKey(\n      response.privateKey ?? (await this.createKeyPairForOldAccount()),\n    );\n  }\n}\n","import { View } from \"../../../models/view/view\";\n\nimport { EncString } from \"./enc-string\";\nimport { SymmetricCryptoKey } from \"./symmetric-crypto-key\";\n\n// https://contributing.bitwarden.com/architecture/clients/data-model#domain\nexport default class Domain {\n  protected buildDomainModel<D extends Domain>(\n    domain: D,\n    dataObj: any,\n    map: any,\n    notEncList: any[] = [],\n  ) {\n    for (const prop in map) {\n      // eslint-disable-next-line\n      if (!map.hasOwnProperty(prop)) {\n        continue;\n      }\n\n      const objProp = dataObj[map[prop] || prop];\n      if (notEncList.indexOf(prop) > -1) {\n        (domain as any)[prop] = objProp ? objProp : null;\n      } else {\n        (domain as any)[prop] = objProp ? new EncString(objProp) : null;\n      }\n    }\n  }\n  protected buildDataModel<D extends Domain>(\n    domain: D,\n    dataObj: any,\n    map: any,\n    notEncStringList: any[] = [],\n  ) {\n    for (const prop in map) {\n      // eslint-disable-next-line\n      if (!map.hasOwnProperty(prop)) {\n        continue;\n      }\n\n      const objProp = (domain as any)[map[prop] || prop];\n      if (notEncStringList.indexOf(prop) > -1) {\n        (dataObj as any)[prop] = objProp != null ? objProp : null;\n      } else {\n        (dataObj as any)[prop] = objProp != null ? (objProp as EncString).encryptedString : null;\n      }\n    }\n  }\n\n  protected async decryptObj<T extends View>(\n    viewModel: T,\n    map: any,\n    orgId: string,\n    key: SymmetricCryptoKey = null,\n  ): Promise<T> {\n    const promises = [];\n    const self: any = this;\n\n    for (const prop in map) {\n      // eslint-disable-next-line\n      if (!map.hasOwnProperty(prop)) {\n        continue;\n      }\n\n      (function (theProp) {\n        const p = Promise.resolve()\n          .then(() => {\n            const mapProp = map[theProp] || theProp;\n            if (self[mapProp]) {\n              return self[mapProp].decrypt(orgId, key);\n            }\n            return null;\n          })\n          .then((val: any) => {\n            (viewModel as any)[theProp] = val;\n          });\n        promises.push(p);\n      })(prop);\n    }\n\n    await Promise.all(promises);\n    return viewModel;\n  }\n}\n","import { MasterPasswordPolicyResponse } from \"../../../auth/models/response/master-password-policy.response\";\nimport Domain from \"../../../platform/models/domain/domain-base\";\n\nexport class MasterPasswordPolicyOptions extends Domain {\n  minComplexity = 0;\n  minLength = 0;\n  requireUpper = false;\n  requireLower = false;\n  requireNumbers = false;\n  requireSpecial = false;\n\n  /**\n   * Flag to indicate if the policy should be enforced on login.\n   * If true, and the user's password does not meet the policy requirements,\n   * the user will be forced to update their password.\n   */\n  enforceOnLogin = false;\n\n  static fromResponse(policy: MasterPasswordPolicyResponse): MasterPasswordPolicyOptions {\n    if (policy == null) {\n      return null;\n    }\n    const options = new MasterPasswordPolicyOptions();\n    options.minComplexity = policy.minComplexity;\n    options.minLength = policy.minLength;\n    options.requireUpper = policy.requireUpper;\n    options.requireLower = policy.requireLower;\n    options.requireNumbers = policy.requireNumbers;\n    options.requireSpecial = policy.requireSpecial;\n    options.enforceOnLogin = policy.enforceOnLogin;\n    return options;\n  }\n}\n","import { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { MasterPasswordPolicyOptions } from \"@bitwarden/common/admin-console/models/domain/master-password-policy-options\";\nimport { TokenService } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { TwoFactorService } from \"@bitwarden/common/auth/abstractions/two-factor.service\";\nimport { AuthResult } from \"@bitwarden/common/auth/models/domain/auth-result\";\nimport { ForceSetPasswordReason } from \"@bitwarden/common/auth/models/domain/force-set-password-reason\";\nimport { PasswordTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/password-token.request\";\nimport { TokenTwoFactorRequest } from \"@bitwarden/common/auth/models/request/identity-token/token-two-factor.request\";\nimport { IdentityCaptchaResponse } from \"@bitwarden/common/auth/models/response/identity-captcha.response\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { IdentityTwoFactorResponse } from \"@bitwarden/common/auth/models/response/identity-two-factor.response\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { HashPurpose } from \"@bitwarden/common/platform/enums\";\nimport { PasswordStrengthServiceAbstraction } from \"@bitwarden/common/tools/password-strength\";\nimport { MasterKey } from \"@bitwarden/common/types/key\";\n\nimport { LoginStrategyServiceAbstraction } from \"../abstractions\";\nimport { PasswordLoginCredentials } from \"../models/domain/login-credentials\";\n\nimport { LoginStrategy } from \"./login.strategy\";\n\nexport class PasswordLoginStrategy extends LoginStrategy {\n  get email() {\n    return this.tokenRequest.email;\n  }\n\n  get masterPasswordHash() {\n    return this.tokenRequest.masterPasswordHash;\n  }\n\n  tokenRequest: PasswordTokenRequest;\n\n  private localMasterKeyHash: string;\n  private masterKey: MasterKey;\n\n  /**\n   * Options to track if the user needs to update their password due to a password that does not meet an organization's\n   * master password policy.\n   */\n  private forcePasswordResetReason: ForceSetPasswordReason = ForceSetPasswordReason.None;\n\n  constructor(\n    cryptoService: CryptoService,\n    apiService: ApiService,\n    tokenService: TokenService,\n    appIdService: AppIdService,\n    platformUtilsService: PlatformUtilsService,\n    messagingService: MessagingService,\n    logService: LogService,\n    protected stateService: StateService,\n    twoFactorService: TwoFactorService,\n    private passwordStrengthService: PasswordStrengthServiceAbstraction,\n    private policyService: PolicyService,\n    private loginStrategyService: LoginStrategyServiceAbstraction,\n  ) {\n    super(\n      cryptoService,\n      apiService,\n      tokenService,\n      appIdService,\n      platformUtilsService,\n      messagingService,\n      logService,\n      stateService,\n      twoFactorService,\n    );\n  }\n\n  override async logInTwoFactor(\n    twoFactor: TokenTwoFactorRequest,\n    captchaResponse: string,\n  ): Promise<AuthResult> {\n    this.tokenRequest.captchaResponse = captchaResponse ?? this.captchaBypassToken;\n    const result = await super.logInTwoFactor(twoFactor);\n\n    // 2FA was successful, save the force update password options with the state service if defined\n    if (\n      !result.requiresTwoFactor &&\n      !result.requiresCaptcha &&\n      this.forcePasswordResetReason != ForceSetPasswordReason.None\n    ) {\n      await this.stateService.setForceSetPasswordReason(this.forcePasswordResetReason);\n      result.forcePasswordReset = this.forcePasswordResetReason;\n    }\n\n    return result;\n  }\n\n  override async logIn(credentials: PasswordLoginCredentials) {\n    const { email, masterPassword, captchaToken, twoFactor } = credentials;\n\n    this.masterKey = await this.loginStrategyService.makePreloginKey(masterPassword, email);\n\n    // Hash the password early (before authentication) so we don't persist it in memory in plaintext\n    this.localMasterKeyHash = await this.cryptoService.hashMasterKey(\n      masterPassword,\n      this.masterKey,\n      HashPurpose.LocalAuthorization,\n    );\n    const masterKeyHash = await this.cryptoService.hashMasterKey(masterPassword, this.masterKey);\n\n    this.tokenRequest = new PasswordTokenRequest(\n      email,\n      masterKeyHash,\n      captchaToken,\n      await this.buildTwoFactor(twoFactor),\n      await this.buildDeviceRequest(),\n    );\n\n    const [authResult, identityResponse] = await this.startLogIn();\n\n    const masterPasswordPolicyOptions =\n      this.getMasterPasswordPolicyOptionsFromResponse(identityResponse);\n\n    // The identity result can contain master password policies for the user's organizations\n    if (masterPasswordPolicyOptions?.enforceOnLogin) {\n      // If there is a policy active, evaluate the supplied password before its no longer in memory\n      const meetsRequirements = this.evaluateMasterPassword(\n        credentials,\n        masterPasswordPolicyOptions,\n      );\n\n      if (!meetsRequirements) {\n        if (authResult.requiresCaptcha || authResult.requiresTwoFactor) {\n          // Save the flag to this strategy for later use as the master password is about to pass out of scope\n          this.forcePasswordResetReason = ForceSetPasswordReason.WeakMasterPassword;\n        } else {\n          // Authentication was successful, save the force update password options with the state service\n          await this.stateService.setForceSetPasswordReason(\n            ForceSetPasswordReason.WeakMasterPassword,\n          );\n          authResult.forcePasswordReset = ForceSetPasswordReason.WeakMasterPassword;\n        }\n      }\n    }\n    return authResult;\n  }\n\n  protected override async setMasterKey(response: IdentityTokenResponse) {\n    await this.cryptoService.setMasterKey(this.masterKey);\n    await this.cryptoService.setMasterKeyHash(this.localMasterKeyHash);\n  }\n\n  protected override async setUserKey(response: IdentityTokenResponse): Promise<void> {\n    // If migration is required, we won't have a user key to set yet.\n    if (this.encryptionKeyMigrationRequired(response)) {\n      return;\n    }\n    await this.cryptoService.setMasterKeyEncryptedUserKey(response.key);\n\n    const masterKey = await this.cryptoService.getMasterKey();\n    if (masterKey) {\n      const userKey = await this.cryptoService.decryptUserKeyWithMasterKey(masterKey);\n      await this.cryptoService.setUserKey(userKey);\n    }\n  }\n\n  protected override async setPrivateKey(response: IdentityTokenResponse): Promise<void> {\n    await this.cryptoService.setPrivateKey(\n      response.privateKey ?? (await this.createKeyPairForOldAccount()),\n    );\n  }\n\n  protected override encryptionKeyMigrationRequired(response: IdentityTokenResponse): boolean {\n    return !response.key;\n  }\n\n  private getMasterPasswordPolicyOptionsFromResponse(\n    response: IdentityTokenResponse | IdentityTwoFactorResponse | IdentityCaptchaResponse,\n  ): MasterPasswordPolicyOptions {\n    if (response == null || response instanceof IdentityCaptchaResponse) {\n      return null;\n    }\n    return MasterPasswordPolicyOptions.fromResponse(response.masterPasswordPolicy);\n  }\n\n  private evaluateMasterPassword(\n    { masterPassword, email }: PasswordLoginCredentials,\n    options: MasterPasswordPolicyOptions,\n  ): boolean {\n    const passwordStrength = this.passwordStrengthService.getPasswordStrength(\n      masterPassword,\n      email,\n    )?.score;\n\n    return this.policyService.evaluateMasterPassword(passwordStrength, masterPassword, options);\n  }\n}\n","import { DeviceRequest } from \"./device.request\";\nimport { TokenTwoFactorRequest } from \"./token-two-factor.request\";\nimport { TokenRequest } from \"./token.request\";\n\nexport class SsoTokenRequest extends TokenRequest {\n  constructor(\n    public code: string,\n    public codeVerifier: string,\n    public redirectUri: string,\n    protected twoFactor: TokenTwoFactorRequest,\n    device?: DeviceRequest,\n  ) {\n    super(twoFactor, device);\n  }\n\n  toIdentityToken(clientId: string) {\n    const obj = super.toIdentityToken(clientId);\n\n    obj.grant_type = \"authorization_code\";\n    obj.code = this.code;\n    obj.code_verifier = this.codeVerifier;\n    obj.redirect_uri = this.redirectUri;\n\n    return obj;\n  }\n}\n","import { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { DeviceTrustCryptoServiceAbstraction } from \"@bitwarden/common/auth/abstractions/device-trust-crypto.service.abstraction\";\nimport { KeyConnectorService } from \"@bitwarden/common/auth/abstractions/key-connector.service\";\nimport { TokenService } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { TwoFactorService } from \"@bitwarden/common/auth/abstractions/two-factor.service\";\nimport { ForceSetPasswordReason } from \"@bitwarden/common/auth/models/domain/force-set-password-reason\";\nimport { SsoTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/sso-token.request\";\nimport { AuthRequestResponse } from \"@bitwarden/common/auth/models/response/auth-request.response\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { HttpStatusCode } from \"@bitwarden/common/enums\";\nimport { ErrorResponse } from \"@bitwarden/common/models/response/error.response\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\n\nimport { AuthRequestServiceAbstraction } from \"../abstractions\";\nimport { SsoLoginCredentials } from \"../models/domain/login-credentials\";\n\nimport { LoginStrategy } from \"./login.strategy\";\n\nexport class SsoLoginStrategy extends LoginStrategy {\n  tokenRequest: SsoTokenRequest;\n  orgId: string;\n\n  // A session token server side to serve as an authentication factor for the user\n  // in order to send email OTPs to the user's configured 2FA email address\n  // as we don't have a master password hash or other verifiable secret when using SSO.\n  ssoEmail2FaSessionToken?: string;\n  email?: string; // email not preserved through SSO process so get from server\n\n  constructor(\n    cryptoService: CryptoService,\n    apiService: ApiService,\n    tokenService: TokenService,\n    appIdService: AppIdService,\n    platformUtilsService: PlatformUtilsService,\n    messagingService: MessagingService,\n    logService: LogService,\n    stateService: StateService,\n    twoFactorService: TwoFactorService,\n    private keyConnectorService: KeyConnectorService,\n    private deviceTrustCryptoService: DeviceTrustCryptoServiceAbstraction,\n    private authRequestService: AuthRequestServiceAbstraction,\n    private i18nService: I18nService,\n  ) {\n    super(\n      cryptoService,\n      apiService,\n      tokenService,\n      appIdService,\n      platformUtilsService,\n      messagingService,\n      logService,\n      stateService,\n      twoFactorService,\n    );\n  }\n\n  async logIn(credentials: SsoLoginCredentials) {\n    this.orgId = credentials.orgId;\n    this.tokenRequest = new SsoTokenRequest(\n      credentials.code,\n      credentials.codeVerifier,\n      credentials.redirectUrl,\n      await this.buildTwoFactor(credentials.twoFactor),\n      await this.buildDeviceRequest(),\n    );\n\n    const [ssoAuthResult] = await this.startLogIn();\n\n    this.email = ssoAuthResult.email;\n    this.ssoEmail2FaSessionToken = ssoAuthResult.ssoEmail2FaSessionToken;\n\n    // Auth guard currently handles redirects for this.\n    if (ssoAuthResult.forcePasswordReset == ForceSetPasswordReason.AdminForcePasswordReset) {\n      await this.stateService.setForceSetPasswordReason(ssoAuthResult.forcePasswordReset);\n    }\n\n    return ssoAuthResult;\n  }\n\n  protected override async setMasterKey(tokenResponse: IdentityTokenResponse) {\n    // The only way we can be setting a master key at this point is if we are using Key Connector.\n    // First, check to make sure that we should do so based on the token response.\n    if (this.shouldSetMasterKeyFromKeyConnector(tokenResponse)) {\n      // If we're here, we know that the user should use Key Connector (they have a KeyConnectorUrl) and does not have a master password.\n      // We can now check the key on the token response to see whether they are a brand new user or an existing user.\n      // The presence of a masterKeyEncryptedUserKey indicates that the user has already been provisioned in Key Connector.\n      const newSsoUser = tokenResponse.key == null;\n      if (newSsoUser) {\n        await this.keyConnectorService.convertNewSsoUserToKeyConnector(tokenResponse, this.orgId);\n      } else {\n        const keyConnectorUrl = this.getKeyConnectorUrl(tokenResponse);\n        await this.keyConnectorService.setMasterKeyFromUrl(keyConnectorUrl);\n      }\n    }\n  }\n\n  /**\n   * Determines if it is possible set the `masterKey` from Key Connector.\n   * @param tokenResponse\n   * @returns `true` if the master key can be set from Key Connector, `false` otherwise\n   */\n  private shouldSetMasterKeyFromKeyConnector(tokenResponse: IdentityTokenResponse): boolean {\n    const userDecryptionOptions = tokenResponse?.userDecryptionOptions;\n\n    if (userDecryptionOptions != null) {\n      const userHasMasterPassword = userDecryptionOptions.hasMasterPassword;\n      const userHasKeyConnectorUrl =\n        userDecryptionOptions.keyConnectorOption?.keyConnectorUrl != null;\n\n      // In order for us to set the master key from Key Connector, we need to have a Key Connector URL\n      // and the user must not have a master password.\n      return userHasKeyConnectorUrl && !userHasMasterPassword;\n    } else {\n      // In pre-TDE versions of the server, the userDecryptionOptions will not be present.\n      // In this case, we can determine if the user has a master password and has a Key Connector URL by\n      // just checking the keyConnectorUrl property. This is because the server short-circuits on the response\n      // and will not pass back the URL in the response if the user has a master password.\n      // TODO: remove compatibility check after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3537)\n      return tokenResponse.keyConnectorUrl != null;\n    }\n  }\n\n  private getKeyConnectorUrl(tokenResponse: IdentityTokenResponse): string {\n    // TODO: remove tokenResponse.keyConnectorUrl reference after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3537)\n    const userDecryptionOptions = tokenResponse?.userDecryptionOptions;\n    return (\n      tokenResponse.keyConnectorUrl ?? userDecryptionOptions?.keyConnectorOption?.keyConnectorUrl\n    );\n  }\n\n  // TODO: future passkey login strategy will need to support setting user key (decrypting via TDE or admin approval request)\n  // so might be worth moving this logic to a common place (base login strategy or a separate service?)\n  protected override async setUserKey(tokenResponse: IdentityTokenResponse): Promise<void> {\n    const masterKeyEncryptedUserKey = tokenResponse.key;\n\n    // Note: masterKeyEncryptedUserKey is undefined for SSO JIT provisioned users\n    // on account creation and subsequent logins (confirmed or unconfirmed)\n    // but that is fine for TDE so we cannot return if it is undefined\n\n    if (masterKeyEncryptedUserKey) {\n      // set the master key encrypted user key if it exists\n      await this.cryptoService.setMasterKeyEncryptedUserKey(masterKeyEncryptedUserKey);\n    }\n\n    const userDecryptionOptions = tokenResponse?.userDecryptionOptions;\n\n    // Note: TDE and key connector are mutually exclusive\n    if (userDecryptionOptions?.trustedDeviceOption) {\n      await this.trySetUserKeyWithApprovedAdminRequestIfExists();\n\n      const hasUserKey = await this.cryptoService.hasUserKey();\n\n      // Only try to set user key with device key if admin approval request was not successful\n      if (!hasUserKey) {\n        await this.trySetUserKeyWithDeviceKey(tokenResponse);\n      }\n    } else if (\n      masterKeyEncryptedUserKey != null &&\n      this.getKeyConnectorUrl(tokenResponse) != null\n    ) {\n      // Key connector enabled for user\n      await this.trySetUserKeyWithMasterKey();\n    }\n\n    // Note: In the traditional SSO flow with MP without key connector, the lock component\n    // is responsible for deriving master key from MP entry and then decrypting the user key\n  }\n\n  private async trySetUserKeyWithApprovedAdminRequestIfExists(): Promise<void> {\n    // At this point a user could have an admin auth request that has been approved\n    const adminAuthReqStorable = await this.stateService.getAdminAuthRequest();\n\n    if (!adminAuthReqStorable) {\n      return;\n    }\n\n    // Call server to see if admin auth request has been approved\n    let adminAuthReqResponse: AuthRequestResponse;\n\n    try {\n      adminAuthReqResponse = await this.apiService.getAuthRequest(adminAuthReqStorable.id);\n    } catch (error) {\n      if (error instanceof ErrorResponse && error.statusCode === HttpStatusCode.NotFound) {\n        // if we get a 404, it means the auth request has been deleted so clear it from storage\n        await this.stateService.setAdminAuthRequest(null);\n      }\n\n      // Always return on an error here as we don't want to block the user from logging in\n      return;\n    }\n\n    if (adminAuthReqResponse?.requestApproved) {\n      // if masterPasswordHash has a value, we will always receive authReqResponse.key\n      // as authRequestPublicKey(masterKey) + authRequestPublicKey(masterPasswordHash)\n      if (adminAuthReqResponse.masterPasswordHash) {\n        await this.authRequestService.setKeysAfterDecryptingSharedMasterKeyAndHash(\n          adminAuthReqResponse,\n          adminAuthReqStorable.privateKey,\n        );\n      } else {\n        // if masterPasswordHash is null, we will always receive authReqResponse.key\n        // as authRequestPublicKey(userKey)\n        await this.authRequestService.setUserKeyAfterDecryptingSharedUserKey(\n          adminAuthReqResponse,\n          adminAuthReqStorable.privateKey,\n        );\n      }\n\n      if (await this.cryptoService.hasUserKey()) {\n        // Now that we have a decrypted user key in memory, we can check if we\n        // need to establish trust on the current device\n        await this.deviceTrustCryptoService.trustDeviceIfRequired();\n\n        // if we successfully decrypted the user key, we can delete the admin auth request out of state\n        // TODO: eventually we post and clean up DB as well once consumed on client\n        await this.stateService.setAdminAuthRequest(null);\n\n        this.platformUtilsService.showToast(\"success\", null, this.i18nService.t(\"loginApproved\"));\n      }\n    }\n  }\n\n  private async trySetUserKeyWithDeviceKey(tokenResponse: IdentityTokenResponse): Promise<void> {\n    const trustedDeviceOption = tokenResponse.userDecryptionOptions?.trustedDeviceOption;\n\n    const deviceKey = await this.deviceTrustCryptoService.getDeviceKey();\n    const encDevicePrivateKey = trustedDeviceOption?.encryptedPrivateKey;\n    const encUserKey = trustedDeviceOption?.encryptedUserKey;\n\n    if (!deviceKey || !encDevicePrivateKey || !encUserKey) {\n      return;\n    }\n\n    const userKey = await this.deviceTrustCryptoService.decryptUserKeyWithDeviceKey(\n      encDevicePrivateKey,\n      encUserKey,\n      deviceKey,\n    );\n\n    if (userKey) {\n      await this.cryptoService.setUserKey(userKey);\n    }\n  }\n\n  private async trySetUserKeyWithMasterKey(): Promise<void> {\n    const masterKey = await this.cryptoService.getMasterKey();\n\n    // There is a scenario in which the master key is not set here. That will occur if the user\n    // has a master password and is using Key Connector. In that case, we cannot set the master key\n    // because the user hasn't entered their master password yet.\n    // Instead, we'll return here and let the migration to Key Connector handle setting the master key.\n    if (!masterKey) {\n      return;\n    }\n\n    const userKey = await this.cryptoService.decryptUserKeyWithMasterKey(masterKey);\n    await this.cryptoService.setUserKey(userKey);\n  }\n\n  protected override async setPrivateKey(tokenResponse: IdentityTokenResponse): Promise<void> {\n    const newSsoUser = tokenResponse.key == null;\n\n    if (!newSsoUser) {\n      await this.cryptoService.setPrivateKey(\n        tokenResponse.privateKey ?? (await this.createKeyPairForOldAccount()),\n      );\n    }\n  }\n}\n","import { DeviceRequest } from \"./device.request\";\nimport { TokenTwoFactorRequest } from \"./token-two-factor.request\";\nimport { TokenRequest } from \"./token.request\";\n\nexport class UserApiTokenRequest extends TokenRequest {\n  constructor(\n    public clientId: string,\n    public clientSecret: string,\n    protected twoFactor: TokenTwoFactorRequest,\n    device?: DeviceRequest,\n  ) {\n    super(twoFactor, device);\n  }\n\n  toIdentityToken() {\n    const obj = super.toIdentityToken(this.clientId);\n\n    obj.scope = this.clientId.startsWith(\"organization\") ? \"api.organization\" : \"api\";\n    obj.grant_type = \"client_credentials\";\n    obj.client_secret = this.clientSecret;\n\n    return obj;\n  }\n}\n","import { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { KeyConnectorService } from \"@bitwarden/common/auth/abstractions/key-connector.service\";\nimport { TokenService } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { TwoFactorService } from \"@bitwarden/common/auth/abstractions/two-factor.service\";\nimport { UserApiTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/user-api-token.request\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\n\nimport { UserApiLoginCredentials } from \"../models/domain/login-credentials\";\n\nimport { LoginStrategy } from \"./login.strategy\";\n\nexport class UserApiLoginStrategy extends LoginStrategy {\n  tokenRequest: UserApiTokenRequest;\n\n  constructor(\n    cryptoService: CryptoService,\n    apiService: ApiService,\n    tokenService: TokenService,\n    appIdService: AppIdService,\n    platformUtilsService: PlatformUtilsService,\n    messagingService: MessagingService,\n    logService: LogService,\n    stateService: StateService,\n    twoFactorService: TwoFactorService,\n    private environmentService: EnvironmentService,\n    private keyConnectorService: KeyConnectorService,\n  ) {\n    super(\n      cryptoService,\n      apiService,\n      tokenService,\n      appIdService,\n      platformUtilsService,\n      messagingService,\n      logService,\n      stateService,\n      twoFactorService,\n    );\n  }\n\n  override async logIn(credentials: UserApiLoginCredentials) {\n    this.tokenRequest = new UserApiTokenRequest(\n      credentials.clientId,\n      credentials.clientSecret,\n      await this.buildTwoFactor(),\n      await this.buildDeviceRequest(),\n    );\n\n    const [authResult] = await this.startLogIn();\n    return authResult;\n  }\n\n  protected override async setMasterKey(response: IdentityTokenResponse) {\n    if (response.apiUseKeyConnector) {\n      const keyConnectorUrl = this.environmentService.getKeyConnectorUrl();\n      await this.keyConnectorService.setMasterKeyFromUrl(keyConnectorUrl);\n    }\n  }\n\n  protected override async setUserKey(response: IdentityTokenResponse): Promise<void> {\n    await this.cryptoService.setMasterKeyEncryptedUserKey(response.key);\n\n    if (response.apiUseKeyConnector) {\n      const masterKey = await this.cryptoService.getMasterKey();\n      if (masterKey) {\n        const userKey = await this.cryptoService.decryptUserKeyWithMasterKey(masterKey);\n        await this.cryptoService.setUserKey(userKey);\n      }\n    }\n  }\n\n  protected override async setPrivateKey(response: IdentityTokenResponse): Promise<void> {\n    await this.cryptoService.setPrivateKey(\n      response.privateKey ?? (await this.createKeyPairForOldAccount()),\n    );\n  }\n\n  protected async saveAccountInformation(tokenResponse: IdentityTokenResponse) {\n    await super.saveAccountInformation(tokenResponse);\n    await this.stateService.setApiKeyClientId(this.tokenRequest.clientId);\n    await this.stateService.setApiKeyClientSecret(this.tokenRequest.clientSecret);\n  }\n}\n","import { WebAuthnLoginAssertionResponseRequest } from \"../../../services/webauthn-login/request/webauthn-login-assertion-response.request\";\n\nimport { DeviceRequest } from \"./device.request\";\nimport { TokenRequest } from \"./token.request\";\n\nexport class WebAuthnLoginTokenRequest extends TokenRequest {\n  constructor(\n    public token: string,\n    public deviceResponse: WebAuthnLoginAssertionResponseRequest,\n    device?: DeviceRequest,\n  ) {\n    super(undefined, device);\n  }\n\n  toIdentityToken(clientId: string) {\n    const obj = super.toIdentityToken(clientId);\n\n    obj.grant_type = \"webauthn\";\n    obj.token = this.token;\n    // must be a string b/c sending as form encoded data\n    obj.deviceResponse = JSON.stringify(this.deviceResponse);\n\n    return obj;\n  }\n}\n","import { AuthResult } from \"@bitwarden/common/auth/models/domain/auth-result\";\nimport { WebAuthnLoginTokenRequest } from \"@bitwarden/common/auth/models/request/identity-token/webauthn-login-token.request\";\nimport { IdentityTokenResponse } from \"@bitwarden/common/auth/models/response/identity-token.response\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { UserKey } from \"@bitwarden/common/types/key\";\n\nimport { WebAuthnLoginCredentials } from \"../models/domain/login-credentials\";\n\nimport { LoginStrategy } from \"./login.strategy\";\n\nexport class WebAuthnLoginStrategy extends LoginStrategy {\n  tokenRequest: WebAuthnLoginTokenRequest;\n  private credentials: WebAuthnLoginCredentials;\n\n  protected override async setMasterKey() {\n    return Promise.resolve();\n  }\n\n  protected override async setUserKey(idTokenResponse: IdentityTokenResponse) {\n    const masterKeyEncryptedUserKey = idTokenResponse.key;\n\n    if (masterKeyEncryptedUserKey) {\n      // set the master key encrypted user key if it exists\n      await this.cryptoService.setMasterKeyEncryptedUserKey(masterKeyEncryptedUserKey);\n    }\n\n    const userDecryptionOptions = idTokenResponse?.userDecryptionOptions;\n\n    if (userDecryptionOptions?.webAuthnPrfOption) {\n      const webAuthnPrfOption = idTokenResponse.userDecryptionOptions?.webAuthnPrfOption;\n\n      // confirm we still have the prf key\n      if (!this.credentials.prfKey) {\n        return;\n      }\n\n      // decrypt prf encrypted private key\n      const privateKey = await this.cryptoService.decryptToBytes(\n        webAuthnPrfOption.encryptedPrivateKey,\n        this.credentials.prfKey,\n      );\n\n      // decrypt user key with private key\n      const userKey = await this.cryptoService.rsaDecrypt(\n        webAuthnPrfOption.encryptedUserKey.encryptedString,\n        privateKey,\n      );\n\n      if (userKey) {\n        await this.cryptoService.setUserKey(new SymmetricCryptoKey(userKey) as UserKey);\n      }\n    }\n  }\n\n  protected override async setPrivateKey(response: IdentityTokenResponse): Promise<void> {\n    await this.cryptoService.setPrivateKey(\n      response.privateKey ?? (await this.createKeyPairForOldAccount()),\n    );\n  }\n\n  async logInTwoFactor(): Promise<AuthResult> {\n    throw new Error(\"2FA not supported yet for WebAuthn Login.\");\n  }\n\n  async logIn(credentials: WebAuthnLoginCredentials) {\n    // NOTE: To avoid DeadObject references on Firefox, do not set the credentials object directly\n    // Use deep copy in future if objects are added that were created in popup\n    this.credentials = { ...credentials };\n\n    this.tokenRequest = new WebAuthnLoginTokenRequest(\n      credentials.token,\n      credentials.deviceResponse,\n      await this.buildDeviceRequest(),\n    );\n\n    const [authResult] = await this.startLogIn();\n    return authResult;\n  }\n}\n","import { Observable, Subject } from \"rxjs\";\n\nimport { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { DeviceTrustCryptoServiceAbstraction } from \"@bitwarden/common/auth/abstractions/device-trust-crypto.service.abstraction\";\nimport { KeyConnectorService } from \"@bitwarden/common/auth/abstractions/key-connector.service\";\nimport { TokenService } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { TwoFactorService } from \"@bitwarden/common/auth/abstractions/two-factor.service\";\nimport { AuthenticationType } from \"@bitwarden/common/auth/enums/authentication-type\";\nimport { AuthResult } from \"@bitwarden/common/auth/models/domain/auth-result\";\nimport { KdfConfig } from \"@bitwarden/common/auth/models/domain/kdf-config\";\nimport { TokenTwoFactorRequest } from \"@bitwarden/common/auth/models/request/identity-token/token-two-factor.request\";\nimport { PreloginRequest } from \"@bitwarden/common/models/request/prelogin.request\";\nimport { ErrorResponse } from \"@bitwarden/common/models/response/error.response\";\nimport { AuthRequestPushNotification } from \"@bitwarden/common/models/response/notification.response\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { EncryptService } from \"@bitwarden/common/platform/abstractions/encrypt.service\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { KdfType } from \"@bitwarden/common/platform/enums\";\nimport { PasswordStrengthServiceAbstraction } from \"@bitwarden/common/tools/password-strength\";\nimport { MasterKey } from \"@bitwarden/common/types/key\";\n\nimport { AuthRequestServiceAbstraction, LoginStrategyServiceAbstraction } from \"../../abstractions\";\nimport { AuthRequestLoginStrategy } from \"../../login-strategies/auth-request-login.strategy\";\nimport { PasswordLoginStrategy } from \"../../login-strategies/password-login.strategy\";\nimport { SsoLoginStrategy } from \"../../login-strategies/sso-login.strategy\";\nimport { UserApiLoginStrategy } from \"../../login-strategies/user-api-login.strategy\";\nimport { WebAuthnLoginStrategy } from \"../../login-strategies/webauthn-login.strategy\";\nimport {\n  UserApiLoginCredentials,\n  PasswordLoginCredentials,\n  SsoLoginCredentials,\n  AuthRequestLoginCredentials,\n  WebAuthnLoginCredentials,\n} from \"../../models\";\n\nconst sessionTimeoutLength = 2 * 60 * 1000; // 2 minutes\n\nexport class LoginStrategyService implements LoginStrategyServiceAbstraction {\n  get email(): string {\n    if (\n      this.logInStrategy instanceof PasswordLoginStrategy ||\n      this.logInStrategy instanceof AuthRequestLoginStrategy ||\n      this.logInStrategy instanceof SsoLoginStrategy\n    ) {\n      return this.logInStrategy.email;\n    }\n\n    return null;\n  }\n\n  get masterPasswordHash(): string {\n    return this.logInStrategy instanceof PasswordLoginStrategy\n      ? this.logInStrategy.masterPasswordHash\n      : null;\n  }\n\n  get accessCode(): string {\n    return this.logInStrategy instanceof AuthRequestLoginStrategy\n      ? this.logInStrategy.accessCode\n      : null;\n  }\n\n  get authRequestId(): string {\n    return this.logInStrategy instanceof AuthRequestLoginStrategy\n      ? this.logInStrategy.authRequestId\n      : null;\n  }\n\n  get ssoEmail2FaSessionToken(): string {\n    return this.logInStrategy instanceof SsoLoginStrategy\n      ? this.logInStrategy.ssoEmail2FaSessionToken\n      : null;\n  }\n\n  private logInStrategy:\n    | UserApiLoginStrategy\n    | PasswordLoginStrategy\n    | SsoLoginStrategy\n    | AuthRequestLoginStrategy\n    | WebAuthnLoginStrategy;\n  private sessionTimeout: any;\n\n  private pushNotificationSubject = new Subject<string>();\n\n  constructor(\n    protected cryptoService: CryptoService,\n    protected apiService: ApiService,\n    protected tokenService: TokenService,\n    protected appIdService: AppIdService,\n    protected platformUtilsService: PlatformUtilsService,\n    protected messagingService: MessagingService,\n    protected logService: LogService,\n    protected keyConnectorService: KeyConnectorService,\n    protected environmentService: EnvironmentService,\n    protected stateService: StateService,\n    protected twoFactorService: TwoFactorService,\n    protected i18nService: I18nService,\n    protected encryptService: EncryptService,\n    protected passwordStrengthService: PasswordStrengthServiceAbstraction,\n    protected policyService: PolicyService,\n    protected deviceTrustCryptoService: DeviceTrustCryptoServiceAbstraction,\n    protected authRequestService: AuthRequestServiceAbstraction,\n  ) {}\n\n  async logIn(\n    credentials:\n      | UserApiLoginCredentials\n      | PasswordLoginCredentials\n      | SsoLoginCredentials\n      | AuthRequestLoginCredentials\n      | WebAuthnLoginCredentials,\n  ): Promise<AuthResult> {\n    this.clearState();\n\n    let strategy:\n      | UserApiLoginStrategy\n      | PasswordLoginStrategy\n      | SsoLoginStrategy\n      | AuthRequestLoginStrategy\n      | WebAuthnLoginStrategy;\n\n    switch (credentials.type) {\n      case AuthenticationType.Password:\n        strategy = new PasswordLoginStrategy(\n          this.cryptoService,\n          this.apiService,\n          this.tokenService,\n          this.appIdService,\n          this.platformUtilsService,\n          this.messagingService,\n          this.logService,\n          this.stateService,\n          this.twoFactorService,\n          this.passwordStrengthService,\n          this.policyService,\n          this,\n        );\n        break;\n      case AuthenticationType.Sso:\n        strategy = new SsoLoginStrategy(\n          this.cryptoService,\n          this.apiService,\n          this.tokenService,\n          this.appIdService,\n          this.platformUtilsService,\n          this.messagingService,\n          this.logService,\n          this.stateService,\n          this.twoFactorService,\n          this.keyConnectorService,\n          this.deviceTrustCryptoService,\n          this.authRequestService,\n          this.i18nService,\n        );\n        break;\n      case AuthenticationType.UserApi:\n        strategy = new UserApiLoginStrategy(\n          this.cryptoService,\n          this.apiService,\n          this.tokenService,\n          this.appIdService,\n          this.platformUtilsService,\n          this.messagingService,\n          this.logService,\n          this.stateService,\n          this.twoFactorService,\n          this.environmentService,\n          this.keyConnectorService,\n        );\n        break;\n      case AuthenticationType.AuthRequest:\n        strategy = new AuthRequestLoginStrategy(\n          this.cryptoService,\n          this.apiService,\n          this.tokenService,\n          this.appIdService,\n          this.platformUtilsService,\n          this.messagingService,\n          this.logService,\n          this.stateService,\n          this.twoFactorService,\n          this.deviceTrustCryptoService,\n        );\n        break;\n      case AuthenticationType.WebAuthn:\n        strategy = new WebAuthnLoginStrategy(\n          this.cryptoService,\n          this.apiService,\n          this.tokenService,\n          this.appIdService,\n          this.platformUtilsService,\n          this.messagingService,\n          this.logService,\n          this.stateService,\n          this.twoFactorService,\n        );\n        break;\n    }\n\n    // Note: Do not set the credentials object directly on the strategy. They are\n    // created in the popup and can cause DeadObject references on Firefox.\n    const result = await strategy.logIn(credentials as any);\n\n    if (result?.requiresTwoFactor) {\n      this.saveState(strategy);\n    }\n\n    return result;\n  }\n\n  async logInTwoFactor(\n    twoFactor: TokenTwoFactorRequest,\n    captchaResponse: string,\n  ): Promise<AuthResult> {\n    if (this.logInStrategy == null) {\n      throw new Error(this.i18nService.t(\"sessionTimeout\"));\n    }\n\n    try {\n      const result = await this.logInStrategy.logInTwoFactor(twoFactor, captchaResponse);\n\n      // Only clear state if 2FA token has been accepted, otherwise we need to be able to try again\n      if (!result.requiresTwoFactor && !result.requiresCaptcha) {\n        this.clearState();\n      }\n      return result;\n    } catch (e) {\n      // API exceptions are okay, but if there are any unhandled client-side errors then clear state to be safe\n      if (!(e instanceof ErrorResponse)) {\n        this.clearState();\n      }\n      throw e;\n    }\n  }\n\n  authingWithUserApiKey(): boolean {\n    return this.logInStrategy instanceof UserApiLoginStrategy;\n  }\n\n  authingWithSso(): boolean {\n    return this.logInStrategy instanceof SsoLoginStrategy;\n  }\n\n  authingWithPassword(): boolean {\n    return this.logInStrategy instanceof PasswordLoginStrategy;\n  }\n\n  authingWithPasswordless(): boolean {\n    return this.logInStrategy instanceof AuthRequestLoginStrategy;\n  }\n\n  async makePreloginKey(masterPassword: string, email: string): Promise<MasterKey> {\n    email = email.trim().toLowerCase();\n    let kdf: KdfType = null;\n    let kdfConfig: KdfConfig = null;\n    try {\n      const preloginResponse = await this.apiService.postPrelogin(new PreloginRequest(email));\n      if (preloginResponse != null) {\n        kdf = preloginResponse.kdf;\n        kdfConfig = new KdfConfig(\n          preloginResponse.kdfIterations,\n          preloginResponse.kdfMemory,\n          preloginResponse.kdfParallelism,\n        );\n      }\n    } catch (e) {\n      if (e == null || e.statusCode !== 404) {\n        throw e;\n      }\n    }\n    return await this.cryptoService.makeMasterKey(masterPassword, email, kdf, kdfConfig);\n  }\n\n  async authResponsePushNotification(notification: AuthRequestPushNotification): Promise<any> {\n    this.pushNotificationSubject.next(notification.id);\n  }\n\n  getPushNotificationObs$(): Observable<any> {\n    return this.pushNotificationSubject.asObservable();\n  }\n\n  private saveState(\n    strategy:\n      | UserApiLoginStrategy\n      | PasswordLoginStrategy\n      | SsoLoginStrategy\n      | AuthRequestLoginStrategy\n      | WebAuthnLoginStrategy,\n  ) {\n    this.logInStrategy = strategy;\n    this.startSessionTimeout();\n  }\n\n  private clearState() {\n    this.logInStrategy = null;\n    this.clearSessionTimeout();\n  }\n\n  private startSessionTimeout() {\n    this.clearSessionTimeout();\n    this.sessionTimeout = setTimeout(() => this.clearState(), sessionTimeoutLength);\n  }\n\n  private clearSessionTimeout() {\n    if (this.sessionTimeout != null) {\n      clearTimeout(this.sessionTimeout);\n    }\n  }\n}\n","export class PasswordlessAuthRequest {\n  constructor(\n    readonly key: string,\n    readonly masterPasswordHash: string,\n    readonly deviceIdentifier: string,\n    readonly requestApproved: boolean,\n  ) {}\n}\n","import { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { PasswordlessAuthRequest } from \"@bitwarden/common/auth/models/request/passwordless-auth.request\";\nimport { AuthRequestResponse } from \"@bitwarden/common/auth/models/response/auth-request.response\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { MasterKey, UserKey } from \"@bitwarden/common/types/key\";\n\nimport { AuthRequestServiceAbstraction } from \"../../abstractions/auth-request.service.abstraction\";\n\nexport class AuthRequestService implements AuthRequestServiceAbstraction {\n  constructor(\n    private appIdService: AppIdService,\n    private cryptoService: CryptoService,\n    private apiService: ApiService,\n    private stateService: StateService,\n  ) {}\n\n  async approveOrDenyAuthRequest(\n    approve: boolean,\n    authRequest: AuthRequestResponse,\n  ): Promise<AuthRequestResponse> {\n    if (!authRequest.id) {\n      throw new Error(\"Auth request has no id\");\n    }\n    if (!authRequest.publicKey) {\n      throw new Error(\"Auth request has no public key\");\n    }\n    const pubKey = Utils.fromB64ToArray(authRequest.publicKey);\n\n    const masterKey = await this.cryptoService.getMasterKey();\n    const masterKeyHash = await this.stateService.getKeyHash();\n    let encryptedMasterKeyHash;\n    let keyToEncrypt;\n\n    if (masterKey && masterKeyHash) {\n      // Only encrypt the master password hash if masterKey exists as\n      // we won't have a masterKeyHash without a masterKey\n      encryptedMasterKeyHash = await this.cryptoService.rsaEncrypt(\n        Utils.fromUtf8ToArray(masterKeyHash),\n        pubKey,\n      );\n      keyToEncrypt = masterKey.encKey;\n    } else {\n      const userKey = await this.cryptoService.getUserKey();\n      keyToEncrypt = userKey.key;\n    }\n\n    const encryptedKey = await this.cryptoService.rsaEncrypt(keyToEncrypt, pubKey);\n\n    const response = new PasswordlessAuthRequest(\n      encryptedKey.encryptedString,\n      encryptedMasterKeyHash?.encryptedString,\n      await this.appIdService.getAppId(),\n      approve,\n    );\n    return await this.apiService.putAuthRequest(authRequest.id, response);\n  }\n\n  async setUserKeyAfterDecryptingSharedUserKey(\n    authReqResponse: AuthRequestResponse,\n    authReqPrivateKey: Uint8Array,\n  ) {\n    const userKey = await this.decryptPubKeyEncryptedUserKey(\n      authReqResponse.key,\n      authReqPrivateKey,\n    );\n    await this.cryptoService.setUserKey(userKey);\n  }\n\n  async setKeysAfterDecryptingSharedMasterKeyAndHash(\n    authReqResponse: AuthRequestResponse,\n    authReqPrivateKey: Uint8Array,\n  ) {\n    const { masterKey, masterKeyHash } = await this.decryptPubKeyEncryptedMasterKeyAndHash(\n      authReqResponse.key,\n      authReqResponse.masterPasswordHash,\n      authReqPrivateKey,\n    );\n\n    // Decrypt and set user key in state\n    const userKey = await this.cryptoService.decryptUserKeyWithMasterKey(masterKey);\n\n    // Set masterKey + masterKeyHash in state after decryption (in case decryption fails)\n    await this.cryptoService.setMasterKey(masterKey);\n    await this.cryptoService.setMasterKeyHash(masterKeyHash);\n\n    await this.cryptoService.setUserKey(userKey);\n  }\n\n  // Decryption helpers\n  async decryptPubKeyEncryptedUserKey(\n    pubKeyEncryptedUserKey: string,\n    privateKey: Uint8Array,\n  ): Promise<UserKey> {\n    const decryptedUserKeyBytes = await this.cryptoService.rsaDecrypt(\n      pubKeyEncryptedUserKey,\n      privateKey,\n    );\n\n    return new SymmetricCryptoKey(decryptedUserKeyBytes) as UserKey;\n  }\n\n  async decryptPubKeyEncryptedMasterKeyAndHash(\n    pubKeyEncryptedMasterKey: string,\n    pubKeyEncryptedMasterKeyHash: string,\n    privateKey: Uint8Array,\n  ): Promise<{ masterKey: MasterKey; masterKeyHash: string }> {\n    const decryptedMasterKeyArrayBuffer = await this.cryptoService.rsaDecrypt(\n      pubKeyEncryptedMasterKey,\n      privateKey,\n    );\n\n    const decryptedMasterKeyHashArrayBuffer = await this.cryptoService.rsaDecrypt(\n      pubKeyEncryptedMasterKeyHash,\n      privateKey,\n    );\n\n    const masterKey = new SymmetricCryptoKey(decryptedMasterKeyArrayBuffer) as MasterKey;\n    const masterKeyHash = Utils.fromBufferToUtf8(decryptedMasterKeyHashArrayBuffer);\n\n    return {\n      masterKey,\n      masterKeyHash,\n    };\n  }\n}\n","import { BaseResponse } from \"./base.response\";\n\nexport class ListResponse<T> extends BaseResponse {\n  data: T[];\n  continuationToken: string;\n\n  constructor(response: any, t: new (dataResponse: any) => T) {\n    super(response);\n    const data = this.getResponseProperty(\"Data\");\n    this.data = data == null ? [] : data.map((dr: any) => new t(dr));\n    this.continuationToken = this.getResponseProperty(\"ContinuationToken\");\n  }\n}\n","import { PolicyType } from \"../../enums\";\nimport { PolicyResponse } from \"../response/policy.response\";\n\nexport class PolicyData {\n  id: string;\n  organizationId: string;\n  type: PolicyType;\n  data: any;\n  enabled: boolean;\n\n  constructor(response: PolicyResponse) {\n    this.id = response.id;\n    this.organizationId = response.organizationId;\n    this.type = response.type;\n    this.data = response.data;\n    this.enabled = response.enabled;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { PolicyType } from \"../../enums\";\n\nexport class PolicyResponse extends BaseResponse {\n  id: string;\n  organizationId: string;\n  type: PolicyType;\n  data: any;\n  enabled: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.data = this.getResponseProperty(\"Data\");\n    this.enabled = this.getResponseProperty(\"Enabled\");\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { ApiService } from \"../../../abstractions/api.service\";\nimport { HttpStatusCode } from \"../../../enums\";\nimport { ErrorResponse } from \"../../../models/response/error.response\";\nimport { ListResponse } from \"../../../models/response/list.response\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { PolicyApiServiceAbstraction } from \"../../abstractions/policy/policy-api.service.abstraction\";\nimport { InternalPolicyService } from \"../../abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"../../enums\";\nimport { PolicyData } from \"../../models/data/policy.data\";\nimport { MasterPasswordPolicyOptions } from \"../../models/domain/master-password-policy-options\";\nimport { PolicyRequest } from \"../../models/request/policy.request\";\nimport { PolicyResponse } from \"../../models/response/policy.response\";\n\nexport class PolicyApiService implements PolicyApiServiceAbstraction {\n  constructor(\n    private policyService: InternalPolicyService,\n    private apiService: ApiService,\n    private stateService: StateService,\n  ) {}\n\n  async getPolicy(organizationId: string, type: PolicyType): Promise<PolicyResponse> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/policies/\" + type,\n      null,\n      true,\n      true,\n    );\n    return new PolicyResponse(r);\n  }\n\n  async getPolicies(organizationId: string): Promise<ListResponse<PolicyResponse>> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/policies\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, PolicyResponse);\n  }\n\n  async getPoliciesByToken(\n    organizationId: string,\n    token: string,\n    email: string,\n    organizationUserId: string,\n  ): Promise<ListResponse<PolicyResponse>> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/organizations/\" +\n        organizationId +\n        \"/policies/token?\" +\n        \"token=\" +\n        encodeURIComponent(token) +\n        \"&email=\" +\n        Utils.encodeRFC3986URIComponent(email) +\n        \"&organizationUserId=\" +\n        organizationUserId,\n      null,\n      false,\n      true,\n    );\n    return new ListResponse(r, PolicyResponse);\n  }\n\n  private async getMasterPasswordPolicyResponseForOrgUser(\n    organizationId: string,\n  ): Promise<PolicyResponse> {\n    const response = await this.apiService.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/policies/master-password\",\n      null,\n      true,\n      true,\n    );\n\n    return new PolicyResponse(response);\n  }\n\n  async getMasterPasswordPolicyOptsForOrgUser(\n    orgId: string,\n  ): Promise<MasterPasswordPolicyOptions | null> {\n    try {\n      const masterPasswordPolicyResponse =\n        await this.getMasterPasswordPolicyResponseForOrgUser(orgId);\n\n      const masterPasswordPolicy = this.policyService.mapPolicyFromResponse(\n        masterPasswordPolicyResponse,\n      );\n\n      if (!masterPasswordPolicy) {\n        return null;\n      }\n\n      return await firstValueFrom(\n        this.policyService.masterPasswordPolicyOptions$([masterPasswordPolicy]),\n      );\n    } catch (error) {\n      // If policy not found, return null\n      if (error instanceof ErrorResponse && error.statusCode === HttpStatusCode.NotFound) {\n        return null;\n      }\n      // otherwise rethrow error\n      throw error;\n    }\n  }\n\n  async putPolicy(organizationId: string, type: PolicyType, request: PolicyRequest): Promise<any> {\n    const r = await this.apiService.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/policies/\" + type,\n      request,\n      true,\n      true,\n    );\n    const response = new PolicyResponse(r);\n    const data = new PolicyData(response);\n    await this.policyService.upsert(data);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { UserId } from \"../../types/guid\";\nimport { DerivedStateDependencies, StorageKey } from \"../../types/state\";\n\nimport { KeyDefinition } from \"./key-definition\";\nimport { StateDefinition } from \"./state-definition\";\n\ndeclare const depShapeMarker: unique symbol;\n/**\n * A set of options for customizing the behavior of a {@link DeriveDefinition}\n */\ntype DeriveDefinitionOptions<TFrom, TTo, TDeps extends DerivedStateDependencies = never> = {\n  /**\n   * A function to use to convert values from TFrom to TTo. This is called on each emit of the parent state observable\n   * and the resulting value will be emitted from the derived state observable.\n   *\n   * @param from Populated with the latest emission from the parent state observable.\n   * @param deps Populated with the dependencies passed into the constructor of the derived state.\n   * These are constant for the lifetime of the derived state.\n   * @returns  The derived state value or a Promise that resolves to the derived state value.\n   */\n  derive: (from: TFrom, deps: TDeps) => TTo | Promise<TTo>;\n  /**\n   * A function to use to safely convert your type from json to your expected type.\n   *\n   * **Important:** Your data may be serialized/deserialized at any time and this\n   *  callback needs to be able to faithfully re-initialize from the JSON object representation of your type.\n   *\n   * @param jsonValue The JSON object representation of your state.\n   * @returns The fully typed version of your state.\n   */\n  deserializer: (serialized: Jsonify<TTo>) => TTo;\n  /**\n   * An object defining the dependencies of the derive function. The keys of the object are the names of the dependencies\n   * and the values are the types of the dependencies.\n   *\n   * for example:\n   * ```\n   * {\n   *   myService: MyService,\n   *   myOtherService: MyOtherService,\n   * }\n   * ```\n   */\n  [depShapeMarker]?: TDeps;\n  /**\n   * The number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   * Defaults to 1000ms.\n   */\n  cleanupDelayMs?: number;\n  /**\n   * Whether or not to clear the derived state when cleanup occurs. Defaults to true.\n   */\n  clearOnCleanup?: boolean;\n};\n\n/**\n * DeriveDefinitions describe state derived from another observable, the value type of which is given by `TFrom`.\n *\n * The StateDefinition is used to describe the domain of the state, and the DeriveDefinition\n * sub-divides that domain into specific keys. These keys are used to cache data in memory and enables derived state to\n * be calculated once regardless of multiple execution contexts.\n */\n\nexport class DeriveDefinition<TFrom, TTo, TDeps extends DerivedStateDependencies> {\n  /**\n   * Creates a new instance of a DeriveDefinition. Derived state is always stored in memory, so the storage location\n   * defined in @link{StateDefinition} is ignored.\n   *\n   * @param stateDefinition The state definition for which this key belongs to.\n   * @param uniqueDerivationName The name of the key, this should be unique per domain.\n   * @param options A set of options to customize the behavior of {@link DeriveDefinition}.\n   * @param options.derive A function to use to convert values from TFrom to TTo. This is called on each emit of the parent state observable\n   * and the resulting value will be emitted from the derived state observable.\n   * @param options.cleanupDelayMs The number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   * Defaults to 1000ms.\n   * @param options.dependencyShape An object defining the dependencies of the derive function. The keys of the object are the names of the dependencies\n   * and the values are the types of the dependencies.\n   * for example:\n   * ```\n   * {\n   *   myService: MyService,\n   *   myOtherService: MyOtherService,\n   * }\n   * ```\n   *\n   * @param options.deserializer A function to use to safely convert your type from json to your expected type.\n   *   Your data may be serialized/deserialized at any time and this needs callback needs to be able to faithfully re-initialize\n   *   from the JSON object representation of your type.\n   */\n  constructor(\n    readonly stateDefinition: StateDefinition,\n    readonly uniqueDerivationName: string,\n    readonly options: DeriveDefinitionOptions<TFrom, TTo, TDeps>,\n  ) {}\n\n  /**\n   * Factory that produces a {@link DeriveDefinition} from a {@link KeyDefinition} or {@link DeriveDefinition} and new name.\n   *\n   * If a `KeyDefinition` is passed in, the returned definition will have the same key as the given key definition, but\n   * will not collide with it in storage, even if they both reside in memory.\n   *\n   * If a `DeriveDefinition` is passed in, the returned definition will instead use the name given in the second position\n   * of the tuple. It is up to you to ensure this is unique within the domain of derived state.\n   *\n   * @param options A set of options to customize the behavior of {@link DeriveDefinition}.\n   * @param options.derive A function to use to convert values from TFrom to TTo. This is called on each emit of the parent state observable\n   * and the resulting value will be emitted from the derived state observable.\n   * @param options.cleanupDelayMs The number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   * Defaults to 1000ms.\n   * @param options.dependencyShape An object defining the dependencies of the derive function. The keys of the object are the names of the dependencies\n   * and the values are the types of the dependencies.\n   * for example:\n   * ```\n   * {\n   *   myService: MyService,\n   *   myOtherService: MyOtherService,\n   * }\n   * ```\n   *\n   * @param options.deserializer A function to use to safely convert your type from json to your expected type.\n   *   Your data may be serialized/deserialized at any time and this needs callback needs to be able to faithfully re-initialize\n   *   from the JSON object representation of your type.\n   * @param definition\n   * @param options\n   * @returns\n   */\n  static from<TFrom, TTo, TDeps extends DerivedStateDependencies = never>(\n    definition:\n      | KeyDefinition<TFrom>\n      | [DeriveDefinition<unknown, TFrom, DerivedStateDependencies>, string],\n    options: DeriveDefinitionOptions<TFrom, TTo, TDeps>,\n  ) {\n    if (isKeyDefinition(definition)) {\n      return new DeriveDefinition(definition.stateDefinition, definition.key, options);\n    } else {\n      return new DeriveDefinition(definition[0].stateDefinition, definition[1], options);\n    }\n  }\n\n  static fromWithUserId<TKeyDef, TTo, TDeps extends DerivedStateDependencies = never>(\n    definition:\n      | KeyDefinition<TKeyDef>\n      | [DeriveDefinition<unknown, TKeyDef, DerivedStateDependencies>, string],\n    options: DeriveDefinitionOptions<[UserId, TKeyDef], TTo, TDeps>,\n  ) {\n    if (isKeyDefinition(definition)) {\n      return new DeriveDefinition(definition.stateDefinition, definition.key, options);\n    } else {\n      return new DeriveDefinition(definition[0].stateDefinition, definition[1], options);\n    }\n  }\n\n  get derive() {\n    return this.options.derive;\n  }\n\n  deserialize(serialized: Jsonify<TTo>): TTo {\n    return this.options.deserializer(serialized);\n  }\n\n  get cleanupDelayMs() {\n    return this.options.cleanupDelayMs < 0 ? 0 : this.options.cleanupDelayMs ?? 1000;\n  }\n\n  get clearOnCleanup() {\n    return this.options.clearOnCleanup ?? true;\n  }\n\n  buildCacheKey(): string {\n    return `derived_${this.stateDefinition.name}_${this.uniqueDerivationName}`;\n  }\n\n  /**\n   * Creates a {@link StorageKey} that points to the data for the given derived definition.\n   * @returns A key that is ready to be used in a storage service to get data.\n   */\n  get storageKey(): StorageKey {\n    return `derived_${this.stateDefinition.name}_${this.uniqueDerivationName}` as StorageKey;\n  }\n}\n\nfunction isKeyDefinition(\n  definition:\n    | KeyDefinition<unknown>\n    | [DeriveDefinition<unknown, unknown, DerivedStateDependencies>, string],\n): definition is KeyDefinition<unknown> {\n  return Object.prototype.hasOwnProperty.call(definition, \"key\");\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\nimport { DerivedStateDependencies } from \"../../types/state\";\n\nimport { DeriveDefinition } from \"./derive-definition\";\nimport { DerivedState } from \"./derived-state\";\nimport { GlobalState } from \"./global-state\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars -- used in docs\nimport { GlobalStateProvider } from \"./global-state.provider\";\nimport { KeyDefinition } from \"./key-definition\";\nimport { UserKeyDefinition } from \"./user-key-definition\";\nimport { ActiveUserState, SingleUserState } from \"./user-state\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars -- used in docs\nimport { ActiveUserStateProvider, SingleUserStateProvider } from \"./user-state.provider\";\n\n/** Convenience wrapper class for {@link ActiveUserStateProvider}, {@link SingleUserStateProvider},\n * and {@link GlobalStateProvider}.\n */\nexport abstract class StateProvider {\n  /** @see{@link ActiveUserState.activeUserId$} */\n  activeUserId$: Observable<UserId | undefined>;\n  /**\n   * Gets a state observable for a given key and userId.\n   *\n   * @remarks If userId is falsy the observable returned will point to the currently active user _and not update if the active user changes_.\n   * This is different to how `getActive` works and more similar to `getUser` for whatever user happens to be active at the time of the call.\n   *\n   * @param keyDefinition - The key definition for the state you want to get.\n   * @param userId - The userId for which you want the state for. If not provided, the state for the currently active user will be returned.\n   */\n  getUserState$: <T>(keyDefinition: KeyDefinition<T>, userId?: UserId) => Observable<T>;\n\n  /**\n   * Sets the state for a given key and userId.\n   *\n   * @overload\n   * @param keyDefinition - The key definition for the state you want to set.\n   * @param value - The value to set the state to.\n   * @param userId - The userId for which you want to set the state for. If not provided, the state for the currently active user will be set.\n   */\n  abstract setUserState<T>(\n    keyDefinition: UserKeyDefinition<T>,\n    value: T,\n    userId?: UserId,\n  ): Promise<[UserId, T]>;\n\n  /**\n   * Sets the state for a given key and userId.\n   *\n   * **NOTE** Consider converting your {@link KeyDefinition} to a {@link UserKeyDefinition} for additional features.\n   *\n   * @overload\n   * @param keyDefinition - The key definition for the state you want to set.\n   * @param value - The value to set the state to.\n   * @param userId - The userId for which you want to set the state for. If not provided, the state for the currently active user will be set.\n   */\n  abstract setUserState<T>(\n    keyDefinition: KeyDefinition<T>,\n    value: T,\n    userId?: UserId,\n  ): Promise<[UserId, T]>;\n\n  abstract setUserState<T>(\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n    value: T,\n    userId?: UserId,\n  ): Promise<[UserId, T]>;\n\n  /** @see{@link ActiveUserStateProvider.get} */\n  abstract getActive<T>(keyDefinition: UserKeyDefinition<T>): ActiveUserState<T>;\n\n  /**\n   * @see{@link ActiveUserStateProvider.get}\n   *\n   * **NOTE** Consider converting your {@link KeyDefinition} to a {@link UserKeyDefinition} for additional features.\n   */\n  abstract getActive<T>(keyDefinition: KeyDefinition<T>): ActiveUserState<T>;\n\n  /** @see{@link ActiveUserStateProvider.get} */\n  abstract getActive<T>(keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>): ActiveUserState<T>;\n\n  /** @see{@link SingleUserStateProvider.get} */\n  abstract getUser<T>(userId: UserId, keyDefinition: UserKeyDefinition<T>): SingleUserState<T>;\n\n  /**\n   * @see{@link SingleUserStateProvider.get}\n   *\n   * **NOTE** Consider converting your {@link KeyDefinition} to a {@link UserKeyDefinition} for additional features.\n   */\n  abstract getUser<T>(userId: UserId, keyDefinition: KeyDefinition<T>): SingleUserState<T>;\n\n  /** @see{@link SingleUserStateProvider.get} */\n  abstract getUser<T>(\n    userId: UserId,\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n  ): SingleUserState<T>;\n\n  /** @see{@link GlobalStateProvider.get} */\n  getGlobal: <T>(keyDefinition: KeyDefinition<T>) => GlobalState<T>;\n  getDerived: <TFrom, TTo, TDeps extends DerivedStateDependencies>(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<TFrom, TTo, TDeps>,\n    dependencies: TDeps,\n  ) => DerivedState<TTo>;\n}\n","import { Jsonify } from \"type-fest\";\n\n/**\n *\n * @param elementDeserializer\n * @returns\n */\nexport function array<T>(\n  elementDeserializer: (element: Jsonify<T>) => T,\n): (array: Jsonify<T[]>) => T[] {\n  return (array) => {\n    if (array == null) {\n      return null;\n    }\n\n    return array.map((element) => elementDeserializer(element));\n  };\n}\n\n/**\n *\n * @param valueDeserializer\n */\nexport function record<T, TKey extends string = string>(\n  valueDeserializer: (value: Jsonify<T>) => T,\n): (record: Jsonify<Record<TKey, T>>) => Record<TKey, T> {\n  return (jsonValue: Jsonify<Record<TKey, T> | null>) => {\n    if (jsonValue == null) {\n      return null;\n    }\n\n    const output: Record<string, T> = {};\n    for (const key in jsonValue) {\n      output[key] = valueDeserializer((jsonValue as Record<string, Jsonify<T>>)[key]);\n    }\n    return output;\n  };\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { StorageKey } from \"../../types/state\";\n\nimport { array, record } from \"./deserialization-helpers\";\nimport { StateDefinition } from \"./state-definition\";\n\n/**\n * A set of options for customizing the behavior of a {@link KeyDefinition}\n */\nexport type KeyDefinitionOptions<T> = {\n  /**\n   * A function to use to safely convert your type from json to your expected type.\n   *\n   * **Important:** Your data may be serialized/deserialized at any time and this\n   *  callback needs to be able to faithfully re-initialize from the JSON object representation of your type.\n   *\n   * @param jsonValue The JSON object representation of your state.\n   * @returns The fully typed version of your state.\n   */\n  readonly deserializer: (jsonValue: Jsonify<T>) => T;\n  /**\n   * The number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   * Defaults to 1000ms.\n   */\n  readonly cleanupDelayMs?: number;\n};\n\n/**\n * KeyDefinitions describe the precise location to store data for a given piece of state.\n * The StateDefinition is used to describe the domain of the state, and the KeyDefinition\n * sub-divides that domain into specific keys.\n */\nexport class KeyDefinition<T> {\n  /**\n   * Creates a new instance of a KeyDefinition\n   * @param stateDefinition The state definition for which this key belongs to.\n   * @param key The name of the key, this should be unique per domain.\n   * @param options A set of options to customize the behavior of {@link KeyDefinition}. All options are required.\n   * @param options.deserializer A function to use to safely convert your type from json to your expected type.\n   *   Your data may be serialized/deserialized at any time and this needs callback needs to be able to faithfully re-initialize\n   *   from the JSON object representation of your type.\n   */\n  constructor(\n    readonly stateDefinition: StateDefinition,\n    readonly key: string,\n    private readonly options: KeyDefinitionOptions<T>,\n  ) {\n    if (options.deserializer == null) {\n      throw new Error(`'deserializer' is a required property on key ${this.errorKeyName}`);\n    }\n\n    if (options.cleanupDelayMs <= 0) {\n      throw new Error(\n        `'cleanupDelayMs' must be greater than 0. Value of ${options.cleanupDelayMs} passed to key ${this.errorKeyName} `,\n      );\n    }\n  }\n\n  /**\n   * Gets the deserializer configured for this {@link KeyDefinition}\n   */\n  get deserializer() {\n    return this.options.deserializer;\n  }\n\n  /**\n   * Gets the number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   */\n  get cleanupDelayMs() {\n    return this.options.cleanupDelayMs < 0 ? 0 : this.options.cleanupDelayMs ?? 1000;\n  }\n\n  /**\n   * Creates a {@link KeyDefinition} for state that is an array.\n   * @param stateDefinition The state definition to be added to the KeyDefinition\n   * @param key The key to be added to the KeyDefinition\n   * @param options The options to customize the final {@link KeyDefinition}.\n   * @returns A {@link KeyDefinition} initialized for arrays, the options run\n   * the deserializer on the provided options for each element of an array.\n   *\n   * @example\n   * ```typescript\n   * const MY_KEY = KeyDefinition.array<MyArrayElement>(MY_STATE, \"key\", {\n   *   deserializer: (myJsonElement) => convertToElement(myJsonElement),\n   * });\n   * ```\n   */\n  static array<T>(\n    stateDefinition: StateDefinition,\n    key: string,\n    // We have them provide options for the element of the array, depending on future options we add, this could get a little weird.\n    options: KeyDefinitionOptions<T>, // The array helper forces  an initialValue of an empty array\n  ) {\n    return new KeyDefinition<T[]>(stateDefinition, key, {\n      ...options,\n      deserializer: array((e) => options.deserializer(e)),\n    });\n  }\n\n  /**\n   * Creates a {@link KeyDefinition} for state that is a record.\n   * @param stateDefinition The state definition to be added to the KeyDefinition\n   * @param key The key to be added to the KeyDefinition\n   * @param options The options to customize the final {@link KeyDefinition}.\n   * @returns A {@link KeyDefinition} that contains a serializer that will run the provided deserializer for each\n   * value in a record and returns every key as a string.\n   *\n   * @example\n   * ```typescript\n   * const MY_KEY = KeyDefinition.record<MyRecordValue>(MY_STATE, \"key\", {\n   *   deserializer: (myJsonValue) => convertToValue(myJsonValue),\n   * });\n   * ```\n   */\n  static record<T, TKey extends string = string>(\n    stateDefinition: StateDefinition,\n    key: string,\n    // We have them provide options for the value of the record, depending on future options we add, this could get a little weird.\n    options: KeyDefinitionOptions<T>, // The array helper forces an initialValue of an empty record\n  ) {\n    return new KeyDefinition<Record<TKey, T>>(stateDefinition, key, {\n      ...options,\n      deserializer: record((v) => options.deserializer(v)),\n    });\n  }\n\n  get fullName() {\n    return `${this.stateDefinition.name}_${this.key}`;\n  }\n\n  protected get errorKeyName() {\n    return `${this.stateDefinition.name} > ${this.key}`;\n  }\n}\n\n/**\n * Creates a {@link StorageKey}\n * @param keyDefinition The key definition of which data the key should point to.\n * @returns A key that is ready to be used in a storage service to get data.\n */\nexport function globalKeyBuilder(keyDefinition: KeyDefinition<unknown>): StorageKey {\n  return `global_${keyDefinition.stateDefinition.name}_${keyDefinition.key}` as StorageKey;\n}\n","import { UserId } from \"../../types/guid\";\nimport { StorageKey } from \"../../types/state\";\nimport { Utils } from \"../misc/utils\";\n\nimport { array, record } from \"./deserialization-helpers\";\nimport { KeyDefinition, KeyDefinitionOptions } from \"./key-definition\";\nimport { StateDefinition } from \"./state-definition\";\n\ntype ClearEvent = \"lock\" | \"logout\";\n\ntype UserKeyDefinitionOptions<T> = KeyDefinitionOptions<T> & {\n  clearOn: ClearEvent[];\n};\n\nconst USER_KEY_DEFINITION_MARKER: unique symbol = Symbol(\"UserKeyDefinition\");\n\nexport function isUserKeyDefinition<T>(\n  keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n): keyDefinition is UserKeyDefinition<T> {\n  return (\n    USER_KEY_DEFINITION_MARKER in keyDefinition &&\n    keyDefinition[USER_KEY_DEFINITION_MARKER] === true\n  );\n}\n\nexport class UserKeyDefinition<T> {\n  readonly [USER_KEY_DEFINITION_MARKER] = true;\n  /**\n   * A unique array of events that the state stored at this key should be cleared on.\n   */\n  readonly clearOn: ClearEvent[];\n\n  constructor(\n    readonly stateDefinition: StateDefinition,\n    readonly key: string,\n    private readonly options: UserKeyDefinitionOptions<T>,\n  ) {\n    if (options.deserializer == null) {\n      throw new Error(`'deserializer' is a required property on key ${this.errorKeyName}`);\n    }\n\n    if (options.cleanupDelayMs <= 0) {\n      throw new Error(\n        `'cleanupDelayMs' must be greater than 0. Value of ${options.cleanupDelayMs} passed to key ${this.errorKeyName} `,\n      );\n    }\n\n    // Filter out repeat values\n    this.clearOn = Array.from(new Set(options.clearOn));\n  }\n\n  /**\n   * Gets the deserializer configured for this {@link KeyDefinition}\n   */\n  get deserializer() {\n    return this.options.deserializer;\n  }\n\n  /**\n   * Gets the number of milliseconds to wait before cleaning up the state after the last subscriber has unsubscribed.\n   */\n  get cleanupDelayMs() {\n    return this.options.cleanupDelayMs < 0 ? 0 : this.options.cleanupDelayMs ?? 1000;\n  }\n\n  /**\n   *\n   * @param keyDefinition\n   * @returns\n   *\n   * @deprecated You should not use this to convert, just create a {@link UserKeyDefinition}\n   */\n  static fromBaseKeyDefinition<T>(keyDefinition: KeyDefinition<T>) {\n    return new UserKeyDefinition<T>(keyDefinition.stateDefinition, keyDefinition.key, {\n      ...keyDefinition[\"options\"],\n      clearOn: [], // Default to not clearing\n    });\n  }\n\n  /**\n   * Creates a {@link UserKeyDefinition} for state that is an array.\n   * @param stateDefinition The state definition to be added to the UserKeyDefinition\n   * @param key The key to be added to the KeyDefinition\n   * @param options The options to customize the final {@link UserKeyDefinition}.\n   * @returns A {@link UserKeyDefinition} initialized for arrays, the options run\n   * the deserializer on the provided options for each element of an array\n   * **unless that array is null, in which case it will return an empty list.**\n   *\n   * @example\n   * ```typescript\n   * const MY_KEY = UserKeyDefinition.array<MyArrayElement>(MY_STATE, \"key\", {\n   *   deserializer: (myJsonElement) => convertToElement(myJsonElement),\n   * });\n   * ```\n   */\n  static array<T>(\n    stateDefinition: StateDefinition,\n    key: string,\n    // We have them provide options for the element of the array, depending on future options we add, this could get a little weird.\n    options: UserKeyDefinitionOptions<T>,\n  ) {\n    return new UserKeyDefinition<T[]>(stateDefinition, key, {\n      ...options,\n      deserializer: array((e) => options.deserializer(e)),\n    });\n  }\n\n  /**\n   * Creates a {@link UserKeyDefinition} for state that is a record.\n   * @param stateDefinition The state definition to be added to the UserKeyDefinition\n   * @param key The key to be added to the KeyDefinition\n   * @param options The options to customize the final {@link UserKeyDefinition}.\n   * @returns A {@link UserKeyDefinition} that contains a serializer that will run the provided deserializer for each\n   * value in a record and returns every key as a string **unless that record is null, in which case it will return an record.**\n   *\n   * @example\n   * ```typescript\n   * const MY_KEY = UserKeyDefinition.record<MyRecordValue>(MY_STATE, \"key\", {\n   *   deserializer: (myJsonValue) => convertToValue(myJsonValue),\n   * });\n   * ```\n   */\n  static record<T, TKey extends string = string>(\n    stateDefinition: StateDefinition,\n    key: string,\n    // We have them provide options for the value of the record, depending on future options we add, this could get a little weird.\n    options: UserKeyDefinitionOptions<T>, // The array helper forces an initialValue of an empty record\n  ) {\n    return new UserKeyDefinition<Record<TKey, T>>(stateDefinition, key, {\n      ...options,\n      deserializer: record((v) => options.deserializer(v)),\n    });\n  }\n\n  get fullName() {\n    return `${this.stateDefinition.name}_${this.key}`;\n  }\n\n  buildKey(userId: UserId) {\n    if (!Utils.isGuid(userId)) {\n      throw new Error(\"You cannot build a user key without a valid UserId\");\n    }\n    return `user_${userId}_${this.stateDefinition.name}_${this.key}` as StorageKey;\n  }\n\n  private get errorKeyName() {\n    return `${this.stateDefinition.name} > ${this.key}`;\n  }\n}\n","/**\n * Default storage location options.\n *\n * `disk` generally means state that is accessible between restarts of the application,\n * with the exception of the web client. In web this means `sessionStorage`. The data is\n * through refreshes of the page but not available once that tab is closed or from any\n * other tabs.\n *\n * `memory` means that the information stored there goes away during application\n * restarts.\n */\nexport type StorageLocation = \"disk\" | \"memory\";\n\n/**\n * *Note*: The property names of this object should match exactly with the string values of the {@link ClientType} enum\n */\nexport type ClientLocations = {\n  /**\n   * Overriding storage location for the web client.\n   *\n   * Includes an extra storage location to store data in `localStorage`\n   * that is available from different tabs and after a tab has closed.\n   */\n  web: StorageLocation | \"disk-local\";\n  /**\n   * Overriding storage location for browser clients.\n   */\n  //browser: StorageLocation;\n  /**\n   * Overriding storage location for desktop clients.\n   */\n  //desktop: StorageLocation;\n  /**\n   * Overriding storage location for CLI clients.\n   */\n  //cli: StorageLocation;\n};\n\n/**\n * Defines the base location and instruction of where this state is expected to be located.\n */\nexport class StateDefinition {\n  readonly storageLocationOverrides: Partial<ClientLocations>;\n\n  /**\n   * Creates a new instance of {@link StateDefinition}, the creation of which is owned by the platform team.\n   * @param name The name of the state, this needs to be unique from all other {@link StateDefinition}'s.\n   * @param defaultStorageLocation The location of where this state should be stored.\n   */\n  constructor(\n    readonly name: string,\n    readonly defaultStorageLocation: StorageLocation,\n    storageLocationOverrides?: Partial<ClientLocations>,\n  ) {\n    this.storageLocationOverrides = storageLocationOverrides ?? {};\n  }\n}\n","import { StateDefinition } from \"./state-definition\";\n\n/**\n * `StateDefinition`s comes with some rules, to facilitate a quick review from\n * platform of this file, ensure you follow these rules, the ones marked with (tested)\n * have unit tests that you can run locally.\n *\n * 1. (tested) Names should not be null or undefined\n * 2. (tested) Name and storage location should be unique\n * 3. (tested) Name and storage location can't differ from another export by only casing\n * 4. (tested) Name should be longer than 3 characters. It should be descriptive, but brief.\n * 5. (tested) Name should not contain spaces or underscores\n * 6. Name should be human readable\n * 7. Name should be in camelCase format (unit tests ensure the first character is lowercase)\n * 8. Teams should only use state definitions they have created\n * 9. StateDefinitions should only be used for keys relating to the state name they chose\n *\n */\n\nexport const ACCOUNT_MEMORY = new StateDefinition(\"account\", \"memory\");\n\nexport const BILLING_BANNERS_DISK = new StateDefinition(\"billingBanners\", \"disk\");\n\nexport const CRYPTO_DISK = new StateDefinition(\"crypto\", \"disk\");\nexport const CRYPTO_MEMORY = new StateDefinition(\"crypto\", \"memory\");\n\nexport const SSO_DISK = new StateDefinition(\"ssoLogin\", \"disk\");\n\nexport const ENVIRONMENT_DISK = new StateDefinition(\"environment\", \"disk\");\n\nexport const VAULT_ONBOARDING = new StateDefinition(\"vaultOnboarding\", \"disk\", {\n  web: \"disk-local\",\n});\n\nexport const GENERATOR_DISK = new StateDefinition(\"generator\", \"disk\");\nexport const GENERATOR_MEMORY = new StateDefinition(\"generator\", \"memory\");\n\nexport const BIOMETRIC_SETTINGS_DISK = new StateDefinition(\"biometricSettings\", \"disk\");\n\n// Admin Console\nexport const ORGANIZATIONS_DISK = new StateDefinition(\"organizations\", \"disk\");\nexport const POLICIES_DISK = new StateDefinition(\"policies\", \"disk\");\nexport const POLICIES_MEMORY = new StateDefinition(\"policies\", \"memory\");\nexport const PROVIDERS_DISK = new StateDefinition(\"providers\", \"disk\");\n\nexport const FOLDER_DISK = new StateDefinition(\"folder\", \"disk\", { web: \"memory\" });\n\nexport const VAULT_SETTINGS_DISK = new StateDefinition(\"vaultSettings\", \"disk\", {\n  web: \"disk-local\",\n});\n\nexport const COLLECTION_DATA = new StateDefinition(\"collection\", \"disk\", {\n  web: \"memory\",\n});\nexport const AUTOFILL_SETTINGS_DISK = new StateDefinition(\"autofillSettings\", \"disk\");\nexport const AUTOFILL_SETTINGS_DISK_LOCAL = new StateDefinition(\"autofillSettingsLocal\", \"disk\", {\n  web: \"disk-local\",\n});\n\nexport const VAULT_FILTER_DISK = new StateDefinition(\"vaultFilter\", \"disk\", {\n  web: \"disk-local\",\n});\n\nexport const NEW_WEB_LAYOUT_BANNER_DISK = new StateDefinition(\"newWebLayoutBanner\", \"disk\", {\n  web: \"disk-local\",\n});\n\n// Secrets Manager\nexport const SM_ONBOARDING_DISK = new StateDefinition(\"smOnboarding\", \"disk\", {\n  web: \"disk-local\",\n});\n","export enum OrganizationApiKeyType {\n  Default = 0,\n  BillingSync = 1,\n  Scim = 2,\n}\n","export enum OrganizationConnectionType {\n  CloudBillingSync = 1,\n  Scim = 2,\n}\n","export enum OrganizationUserStatusType {\n  Invited = 0,\n  Accepted = 1,\n  Confirmed = 2,\n  Revoked = -1,\n}\n","export enum OrganizationUserType {\n  Owner = 0,\n  Admin = 1,\n  User = 2,\n  /**\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   */\n  Manager = 3,\n  Custom = 4,\n}\n","export enum PolicyType {\n  TwoFactorAuthentication = 0, // Requires users to have 2fa enabled\n  MasterPassword = 1, // Sets minimum requirements for master password complexity\n  PasswordGenerator = 2, // Sets minimum requirements/default type for generated passwords/passphrases\n  SingleOrg = 3, // Allows users to only be apart of one organization\n  RequireSso = 4, // Requires users to authenticate with SSO\n  PersonalOwnership = 5, // Disables personal vault ownership for adding/cloning items\n  DisableSend = 6, // Disables the ability to create and edit Bitwarden Sends\n  SendOptions = 7, // Sets restrictions or defaults for Bitwarden Sends\n  ResetPassword = 8, // Allows orgs to use reset password : also can enable auto-enrollment during invite flow\n  MaximumVaultTimeout = 9, // Sets the maximum allowed vault timeout\n  DisablePersonalVaultExport = 10, // Disable personal vault export\n  ActivateAutofill = 11, // Activates autofill with page load on the browser extension\n}\n","export enum ProviderType {\n  Msp = 0,\n  Reseller = 1,\n}\n","export enum ProviderUserStatusType {\n  Invited = 0,\n  Accepted = 1,\n  Confirmed = 2,\n  Revoked = -1, // Not used, compile-time support only\n}\n","export enum ProviderUserType {\n  ProviderAdmin = 0,\n  ServiceUser = 1,\n}\n","export enum ScimProviderType {\n  Default = 0,\n  AzureAd = 1,\n  Okta = 2,\n  OneLogin = 3,\n  JumpCloud = 4,\n  GoogleWorkspace = 5,\n  Rippling = 6,\n}\n","import { ProviderUserStatusType, ProviderUserType } from \"../../enums\";\nimport { ProviderData } from \"../data/provider.data\";\n\nexport class Provider {\n  id: string;\n  name: string;\n  status: ProviderUserStatusType;\n  type: ProviderUserType;\n  enabled: boolean;\n  userId: string;\n  useEvents: boolean;\n\n  constructor(obj?: ProviderData) {\n    if (obj == null) {\n      return;\n    }\n\n    this.id = obj.id;\n    this.name = obj.name;\n    this.status = obj.status;\n    this.type = obj.type;\n    this.enabled = obj.enabled;\n    this.userId = obj.userId;\n    this.useEvents = obj.useEvents;\n  }\n\n  get canAccess() {\n    if (this.isProviderAdmin) {\n      return true;\n    }\n    return this.enabled && this.status === ProviderUserStatusType.Confirmed;\n  }\n\n  get canCreateOrganizations() {\n    return this.enabled && this.isProviderAdmin;\n  }\n\n  get canManageUsers() {\n    return this.isProviderAdmin;\n  }\n\n  get canAccessEventLogs() {\n    return this.isProviderAdmin;\n  }\n\n  get isProviderAdmin() {\n    return this.type === ProviderUserType.ProviderAdmin;\n  }\n}\n","import { StateService } from \"../../platform/abstractions/state.service\";\nimport { KeyDefinition, PROVIDERS_DISK } from \"../../platform/state\";\nimport { ProviderService as ProviderServiceAbstraction } from \"../abstractions/provider.service\";\nimport { ProviderData } from \"../models/data/provider.data\";\nimport { Provider } from \"../models/domain/provider\";\n\nexport const PROVIDERS = KeyDefinition.record<ProviderData>(PROVIDERS_DISK, \"providers\", {\n  deserializer: (obj: ProviderData) => obj,\n});\n\nexport class ProviderService implements ProviderServiceAbstraction {\n  constructor(private stateService: StateService) {}\n\n  async get(id: string): Promise<Provider> {\n    const providers = await this.stateService.getProviders();\n    // eslint-disable-next-line\n    if (providers == null || !providers.hasOwnProperty(id)) {\n      return null;\n    }\n\n    return new Provider(providers[id]);\n  }\n\n  async getAll(): Promise<Provider[]> {\n    const providers = await this.stateService.getProviders();\n    const response: Provider[] = [];\n    for (const id in providers) {\n      // eslint-disable-next-line\n      if (providers.hasOwnProperty(id)) {\n        response.push(new Provider(providers[id]));\n      }\n    }\n    return response;\n  }\n\n  async save(providers: { [id: string]: ProviderData }) {\n    await this.stateService.setProviders(providers);\n  }\n}\n","export enum AuthenticationStatus {\n  LoggedOut = 0,\n  Locked = 1,\n  Unlocked = 2,\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\nimport { AuthenticationStatus } from \"../enums/authentication-status\";\n\n/**\n * Holds information about an account for use in the AccountService\n * if more information is added, be sure to update the equality method.\n */\nexport type AccountInfo = {\n  status: AuthenticationStatus;\n  email: string;\n  name: string | undefined;\n};\n\nexport function accountInfoEqual(a: AccountInfo, b: AccountInfo) {\n  return a?.status === b?.status && a?.email === b?.email && a?.name === b?.name;\n}\n\nexport abstract class AccountService {\n  accounts$: Observable<Record<UserId, AccountInfo>>;\n  activeAccount$: Observable<{ id: UserId | undefined } & AccountInfo>;\n  accountLock$: Observable<UserId>;\n  accountLogout$: Observable<UserId>;\n  /**\n   * Updates the `accounts$` observable with the new account data.\n   * @param userId\n   * @param accountData\n   */\n  abstract addAccount(userId: UserId, accountData: AccountInfo): Promise<void>;\n  /**\n   * updates the `accounts$` observable with the new preferred name for the account.\n   * @param userId\n   * @param name\n   */\n  abstract setAccountName(userId: UserId, name: string): Promise<void>;\n  /**\n   * updates the `accounts$` observable with the new email for the account.\n   * @param userId\n   * @param email\n   */\n  abstract setAccountEmail(userId: UserId, email: string): Promise<void>;\n  /**\n   * Updates the `accounts$` observable with the new account status.\n   * Also emits the `accountLock$` or `accountLogout$` observable if the status is `Locked` or `LoggedOut` respectively.\n   * @param userId\n   * @param status\n   */\n  abstract setAccountStatus(userId: UserId, status: AuthenticationStatus): Promise<void>;\n  /**\n   * Updates the `accounts$` observable with the new account status if the current status is higher than the `maxStatus`.\n   *\n   * This method only downgrades status to the maximum value sent in, it will not increase authentication status.\n   *\n   * @example An account is transitioning from unlocked to logged out. If callbacks that set the status to locked occur\n   * after it is updated to logged out, the account will be in the incorrect state.\n   * @param userId The user id of the account to be updated.\n   * @param maxStatus The new status of the account.\n   */\n  abstract setMaxAccountStatus(userId: UserId, maxStatus: AuthenticationStatus): Promise<void>;\n  /**\n   * Updates the `activeAccount$` observable with the new active account.\n   * @param userId\n   */\n  abstract switchAccount(userId: UserId): Promise<void>;\n}\n\nexport abstract class InternalAccountService extends AccountService {\n  abstract delete(): void;\n}\n","import { Subject, combineLatestWith, map, distinctUntilChanged, shareReplay } from \"rxjs\";\n\nimport {\n  AccountInfo,\n  InternalAccountService,\n  accountInfoEqual,\n} from \"../../auth/abstractions/account.service\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { MessagingService } from \"../../platform/abstractions/messaging.service\";\nimport {\n  ACCOUNT_MEMORY,\n  GlobalState,\n  GlobalStateProvider,\n  KeyDefinition,\n} from \"../../platform/state\";\nimport { UserId } from \"../../types/guid\";\nimport { AuthenticationStatus } from \"../enums/authentication-status\";\n\nexport const ACCOUNT_ACCOUNTS = KeyDefinition.record<AccountInfo, UserId>(\n  ACCOUNT_MEMORY,\n  \"accounts\",\n  {\n    deserializer: (accountInfo) => accountInfo,\n  },\n);\n\nexport const ACCOUNT_ACTIVE_ACCOUNT_ID = new KeyDefinition(ACCOUNT_MEMORY, \"activeAccountId\", {\n  deserializer: (id: UserId) => id,\n});\n\nexport class AccountServiceImplementation implements InternalAccountService {\n  private lock = new Subject<UserId>();\n  private logout = new Subject<UserId>();\n  private accountsState: GlobalState<Record<UserId, AccountInfo>>;\n  private activeAccountIdState: GlobalState<UserId | undefined>;\n\n  accounts$;\n  activeAccount$;\n  accountLock$ = this.lock.asObservable();\n  accountLogout$ = this.logout.asObservable();\n\n  constructor(\n    private messagingService: MessagingService,\n    private logService: LogService,\n    private globalStateProvider: GlobalStateProvider,\n  ) {\n    this.accountsState = this.globalStateProvider.get(ACCOUNT_ACCOUNTS);\n    this.activeAccountIdState = this.globalStateProvider.get(ACCOUNT_ACTIVE_ACCOUNT_ID);\n\n    this.accounts$ = this.accountsState.state$.pipe(\n      map((accounts) => (accounts == null ? {} : accounts)),\n    );\n    this.activeAccount$ = this.activeAccountIdState.state$.pipe(\n      combineLatestWith(this.accounts$),\n      map(([id, accounts]) => (id ? { id, ...accounts[id] } : undefined)),\n      distinctUntilChanged((a, b) => a?.id === b?.id && accountInfoEqual(a, b)),\n      shareReplay({ bufferSize: 1, refCount: false }),\n    );\n  }\n\n  async addAccount(userId: UserId, accountData: AccountInfo): Promise<void> {\n    await this.accountsState.update((accounts) => {\n      accounts ||= {};\n      accounts[userId] = accountData;\n      return accounts;\n    });\n  }\n\n  async setAccountName(userId: UserId, name: string): Promise<void> {\n    await this.setAccountInfo(userId, { name });\n  }\n\n  async setAccountEmail(userId: UserId, email: string): Promise<void> {\n    await this.setAccountInfo(userId, { email });\n  }\n\n  async setAccountStatus(userId: UserId, status: AuthenticationStatus): Promise<void> {\n    await this.setAccountInfo(userId, { status });\n\n    if (status === AuthenticationStatus.LoggedOut) {\n      this.logout.next(userId);\n    } else if (status === AuthenticationStatus.Locked) {\n      this.lock.next(userId);\n    }\n  }\n\n  async setMaxAccountStatus(userId: UserId, maxStatus: AuthenticationStatus): Promise<void> {\n    await this.accountsState.update(\n      (accounts) => {\n        accounts[userId].status = maxStatus;\n        return accounts;\n      },\n      {\n        shouldUpdate: (accounts) => {\n          if (accounts?.[userId] == null) {\n            throw new Error(\"Account does not exist\");\n          }\n\n          return accounts[userId].status > maxStatus;\n        },\n      },\n    );\n  }\n\n  async switchAccount(userId: UserId): Promise<void> {\n    await this.activeAccountIdState.update(\n      (_, accounts) => {\n        if (userId == null) {\n          // indicates no account is active\n          return null;\n        }\n\n        if (accounts?.[userId] == null) {\n          throw new Error(\"Account does not exist\");\n        }\n        return userId;\n      },\n      {\n        combineLatestWith: this.accounts$,\n        shouldUpdate: (id) => {\n          // update only if userId changes\n          return id !== userId;\n        },\n      },\n    );\n  }\n\n  // TODO: update to use our own account status settings. Requires inverting direction of state service accounts flow\n  async delete(): Promise<void> {\n    try {\n      this.messagingService?.send(\"logout\");\n    } catch (e) {\n      this.logService.error(e);\n      throw e;\n    }\n  }\n\n  private async setAccountInfo(userId: UserId, update: Partial<AccountInfo>): Promise<void> {\n    function newAccountInfo(oldAccountInfo: AccountInfo): AccountInfo {\n      return { ...oldAccountInfo, ...update };\n    }\n    await this.accountsState.update(\n      (accounts) => {\n        accounts[userId] = newAccountInfo(accounts[userId]);\n        return accounts;\n      },\n      {\n        // Avoid unnecessary updates\n        // TODO: Faster comparison, maybe include a hash on the objects?\n        shouldUpdate: (accounts) => {\n          if (accounts?.[userId] == null) {\n            throw new Error(\"Account does not exist\");\n          }\n\n          return !accountInfoEqual(accounts[userId], newAccountInfo(accounts[userId]));\n        },\n      },\n    );\n  }\n}\n","import { ApiService } from \"../../abstractions/api.service\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { MessagingService } from \"../../platform/abstractions/messaging.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\nimport { KeySuffixOptions } from \"../../platform/enums\";\nimport { AuthService as AuthServiceAbstraction } from \"../abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../enums/authentication-status\";\n\nexport class AuthService implements AuthServiceAbstraction {\n  constructor(\n    protected messagingService: MessagingService,\n    protected cryptoService: CryptoService,\n    protected apiService: ApiService,\n    protected stateService: StateService,\n  ) {}\n\n  async getAuthStatus(userId?: string): Promise<AuthenticationStatus> {\n    // If we don't have an access token or userId, we're logged out\n    const isAuthenticated = await this.stateService.getIsAuthenticated({ userId: userId });\n    if (!isAuthenticated) {\n      return AuthenticationStatus.LoggedOut;\n    }\n\n    // If we don't have a user key in memory, we're locked\n    if (!(await this.cryptoService.hasUserKeyInMemory(userId))) {\n      // Check if the user has vault timeout set to never and verify that\n      // they've never unlocked their vault\n      const neverLock =\n        (await this.cryptoService.hasUserKeyStored(KeySuffixOptions.Auto, userId)) &&\n        !(await this.stateService.getEverBeenUnlocked({ userId: userId }));\n\n      if (neverLock) {\n        // Attempt to get the key from storage and set it in memory\n        const userKey = await this.cryptoService.getUserKeyFromStorage(\n          KeySuffixOptions.Auto,\n          userId,\n        );\n        await this.cryptoService.setUserKey(userKey, userId);\n      }\n    }\n\n    // We do another check here in case setting the auto key failed\n    const hasKeyInMemory = await this.cryptoService.hasUserKeyInMemory(userId);\n    if (!hasKeyInMemory) {\n      return AuthenticationStatus.Locked;\n    }\n\n    return AuthenticationStatus.Unlocked;\n  }\n\n  logOut(callback: () => void) {\n    callback();\n    this.messagingService.send(\"loggedOut\");\n  }\n}\n","export class SecretVerificationRequest {\n  masterPasswordHash: string;\n  otp: string;\n  authRequestAccessCode: string;\n}\n","import { SecretVerificationRequest } from \"./secret-verification.request\";\n\nexport class UpdateDevicesTrustRequest extends SecretVerificationRequest {\n  currentDevice: DeviceKeysUpdateRequest;\n  otherDevices: OtherDeviceKeysUpdateRequest[];\n}\n\nexport class DeviceKeysUpdateRequest {\n  encryptedPublicKey: string;\n  encryptedUserKey: string;\n}\n\nexport class OtherDeviceKeysUpdateRequest extends DeviceKeysUpdateRequest {\n  id: string;\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { AppIdService } from \"../../platform/abstractions/app-id.service\";\nimport { CryptoFunctionService } from \"../../platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../platform/abstractions/i18n.service\";\nimport { KeyGenerationService } from \"../../platform/abstractions/key-generation.service\";\nimport { PlatformUtilsService } from \"../../platform/abstractions/platform-utils.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\nimport { EncString } from \"../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../platform/models/domain/symmetric-crypto-key\";\nimport { UserKey, DeviceKey } from \"../../types/key\";\nimport { DeviceTrustCryptoServiceAbstraction } from \"../abstractions/device-trust-crypto.service.abstraction\";\nimport { DeviceResponse } from \"../abstractions/devices/responses/device.response\";\nimport { DevicesApiServiceAbstraction } from \"../abstractions/devices-api.service.abstraction\";\nimport { SecretVerificationRequest } from \"../models/request/secret-verification.request\";\nimport {\n  DeviceKeysUpdateRequest,\n  UpdateDevicesTrustRequest,\n} from \"../models/request/update-devices-trust.request\";\n\nexport class DeviceTrustCryptoService implements DeviceTrustCryptoServiceAbstraction {\n  constructor(\n    private keyGenerationService: KeyGenerationService,\n    private cryptoFunctionService: CryptoFunctionService,\n    private cryptoService: CryptoService,\n    private encryptService: EncryptService,\n    private stateService: StateService,\n    private appIdService: AppIdService,\n    private devicesApiService: DevicesApiServiceAbstraction,\n    private i18nService: I18nService,\n    private platformUtilsService: PlatformUtilsService,\n  ) {}\n\n  /**\n   * @description Retrieves the users choice to trust the device which can only happen after decryption\n   * Note: this value should only be used once and then reset\n   */\n  async getShouldTrustDevice(): Promise<boolean> {\n    return await this.stateService.getShouldTrustDevice();\n  }\n\n  async setShouldTrustDevice(value: boolean): Promise<void> {\n    await this.stateService.setShouldTrustDevice(value);\n  }\n\n  async trustDeviceIfRequired(): Promise<void> {\n    const shouldTrustDevice = await this.getShouldTrustDevice();\n    if (shouldTrustDevice) {\n      await this.trustDevice();\n      // reset the trust choice\n      await this.setShouldTrustDevice(false);\n    }\n  }\n\n  async trustDevice(): Promise<DeviceResponse> {\n    // Attempt to get user key\n    const userKey: UserKey = await this.cryptoService.getUserKey();\n\n    // If user key is not found, throw error\n    if (!userKey) {\n      throw new Error(\"User symmetric key not found\");\n    }\n\n    // Generate deviceKey\n    const deviceKey = await this.makeDeviceKey();\n\n    // Generate asymmetric RSA key pair: devicePrivateKey, devicePublicKey\n    const [devicePublicKey, devicePrivateKey] =\n      await this.cryptoFunctionService.rsaGenerateKeyPair(2048);\n\n    const [\n      devicePublicKeyEncryptedUserKey,\n      userKeyEncryptedDevicePublicKey,\n      deviceKeyEncryptedDevicePrivateKey,\n    ] = await Promise.all([\n      // Encrypt user key with the DevicePublicKey\n      this.cryptoService.rsaEncrypt(userKey.key, devicePublicKey),\n\n      // Encrypt devicePublicKey with user key\n      this.encryptService.encrypt(devicePublicKey, userKey),\n\n      // Encrypt devicePrivateKey with deviceKey\n      this.encryptService.encrypt(devicePrivateKey, deviceKey),\n    ]);\n\n    // Send encrypted keys to server\n    const deviceIdentifier = await this.appIdService.getAppId();\n    const deviceResponse = await this.devicesApiService.updateTrustedDeviceKeys(\n      deviceIdentifier,\n      devicePublicKeyEncryptedUserKey.encryptedString,\n      userKeyEncryptedDevicePublicKey.encryptedString,\n      deviceKeyEncryptedDevicePrivateKey.encryptedString,\n    );\n\n    // store device key in local/secure storage if enc keys posted to server successfully\n    await this.setDeviceKey(deviceKey);\n\n    this.platformUtilsService.showToast(\"success\", null, this.i18nService.t(\"deviceTrusted\"));\n\n    return deviceResponse;\n  }\n\n  async rotateDevicesTrust(newUserKey: UserKey, masterPasswordHash: string): Promise<void> {\n    const currentDeviceKey = await this.getDeviceKey();\n    if (currentDeviceKey == null) {\n      // If the current device doesn't have a device key available to it, then we can't\n      // rotate any trust at all, so early return.\n      return;\n    }\n\n    // At this point of rotating their keys, they should still have their old user key in state\n    const oldUserKey = await firstValueFrom(this.cryptoService.activeUserKey$);\n\n    const deviceIdentifier = await this.appIdService.getAppId();\n    const secretVerificationRequest = new SecretVerificationRequest();\n    secretVerificationRequest.masterPasswordHash = masterPasswordHash;\n\n    // Get the keys that are used in rotating a devices keys from the server\n    const currentDeviceKeys = await this.devicesApiService.getDeviceKeys(\n      deviceIdentifier,\n      secretVerificationRequest,\n    );\n\n    // Decrypt the existing device public key with the old user key\n    const decryptedDevicePublicKey = await this.encryptService.decryptToBytes(\n      currentDeviceKeys.encryptedPublicKey,\n      oldUserKey,\n    );\n\n    // Encrypt the brand new user key with the now-decrypted public key for the device\n    const encryptedNewUserKey = await this.cryptoService.rsaEncrypt(\n      newUserKey.key,\n      decryptedDevicePublicKey,\n    );\n\n    // Re-encrypt the device public key with the new user key\n    const encryptedDevicePublicKey = await this.encryptService.encrypt(\n      decryptedDevicePublicKey,\n      newUserKey,\n    );\n\n    const currentDeviceUpdateRequest = new DeviceKeysUpdateRequest();\n    currentDeviceUpdateRequest.encryptedUserKey = encryptedNewUserKey.encryptedString;\n    currentDeviceUpdateRequest.encryptedPublicKey = encryptedDevicePublicKey.encryptedString;\n\n    // TODO: For device management, allow this method to take an array of device ids that can be looped over and individually rotated\n    // then it can be added to trustRequest.otherDevices.\n\n    const trustRequest = new UpdateDevicesTrustRequest();\n    trustRequest.masterPasswordHash = masterPasswordHash;\n    trustRequest.currentDevice = currentDeviceUpdateRequest;\n    trustRequest.otherDevices = [];\n\n    await this.devicesApiService.updateTrust(trustRequest, deviceIdentifier);\n  }\n\n  async getDeviceKey(): Promise<DeviceKey> {\n    return await this.stateService.getDeviceKey();\n  }\n\n  private async setDeviceKey(deviceKey: DeviceKey | null): Promise<void> {\n    await this.stateService.setDeviceKey(deviceKey);\n  }\n\n  private async makeDeviceKey(): Promise<DeviceKey> {\n    // Create 512-bit device key\n    return (await this.keyGenerationService.createKey(512)) as DeviceKey;\n  }\n\n  async decryptUserKeyWithDeviceKey(\n    encryptedDevicePrivateKey: EncString,\n    encryptedUserKey: EncString,\n    deviceKey?: DeviceKey,\n  ): Promise<UserKey | null> {\n    // If device key provided use it, otherwise try to retrieve from storage\n    deviceKey ||= await this.getDeviceKey();\n\n    if (!deviceKey) {\n      // User doesn't have a device key anymore so device is untrusted\n      return null;\n    }\n\n    try {\n      // attempt to decrypt encryptedDevicePrivateKey with device key\n      const devicePrivateKey = await this.encryptService.decryptToBytes(\n        encryptedDevicePrivateKey,\n        deviceKey,\n      );\n\n      // Attempt to decrypt encryptedUserDataKey with devicePrivateKey\n      const userKey = await this.cryptoService.rsaDecrypt(\n        encryptedUserKey.encryptedString,\n        devicePrivateKey,\n      );\n\n      return new SymmetricCryptoKey(userKey) as UserKey;\n    } catch (e) {\n      // If either decryption effort fails, we want to remove the device key\n      await this.setDeviceKey(null);\n\n      return null;\n    }\n  }\n\n  async supportsDeviceTrust(): Promise<boolean> {\n    const decryptionOptions = await this.stateService.getAccountDecryptionOptions();\n    return decryptionOptions?.trustedDeviceOption != null;\n  }\n}\n","import { DeviceType } from \"../../../../enums\";\nimport { View } from \"../../../../models/view/view\";\nimport { DeviceResponse } from \"../responses/device.response\";\n\nexport class DeviceView implements View {\n  id: string;\n  userId: string;\n  name: string;\n  identifier: string;\n  type: DeviceType;\n  creationDate: string;\n  revisionDate: string;\n\n  constructor(deviceResponse: DeviceResponse) {\n    Object.assign(this, deviceResponse);\n  }\n}\n","import { Observable, defer, map } from \"rxjs\";\n\nimport { ListResponse } from \"../../../models/response/list.response\";\nimport { DevicesServiceAbstraction } from \"../../abstractions/devices/devices.service.abstraction\";\nimport { DeviceResponse } from \"../../abstractions/devices/responses/device.response\";\nimport { DeviceView } from \"../../abstractions/devices/views/device.view\";\nimport { DevicesApiServiceAbstraction } from \"../../abstractions/devices-api.service.abstraction\";\n\n/**\n * @class DevicesServiceImplementation\n * @implements {DevicesServiceAbstraction}\n * @description Observable based data store service for Devices.\n * note: defer is used to convert the promises to observables and to ensure\n * that observables are created for each subscription\n * (i.e., promsise --> observables are cold until subscribed to)\n */\nexport class DevicesServiceImplementation implements DevicesServiceAbstraction {\n  constructor(private devicesApiService: DevicesApiServiceAbstraction) {}\n\n  /**\n   * @description Gets the list of all devices.\n   */\n  getDevices$(): Observable<Array<DeviceView>> {\n    return defer(() => this.devicesApiService.getDevices()).pipe(\n      map((deviceResponses: ListResponse<DeviceResponse>) => {\n        return deviceResponses.data.map((deviceResponse: DeviceResponse) => {\n          return new DeviceView(deviceResponse);\n        });\n      }),\n    );\n  }\n\n  /**\n   * @description Gets the device with the specified identifier.\n   */\n  getDeviceByIdentifier$(deviceIdentifier: string): Observable<DeviceView> {\n    return defer(() => this.devicesApiService.getDeviceByIdentifier(deviceIdentifier)).pipe(\n      map((deviceResponse: DeviceResponse) => new DeviceView(deviceResponse)),\n    );\n  }\n\n  /**\n   * @description Checks if a device is known for a user by user's email and device's identifier.\n   */\n  isDeviceKnownForUser$(email: string, deviceIdentifier: string): Observable<boolean> {\n    return defer(() => this.devicesApiService.getKnownDevice(email, deviceIdentifier));\n  }\n\n  /**\n   * @description Updates the keys for the specified device.\n   */\n\n  updateTrustedDeviceKeys$(\n    deviceIdentifier: string,\n    devicePublicKeyEncryptedUserKey: string,\n    userKeyEncryptedDevicePublicKey: string,\n    deviceKeyEncryptedDevicePrivateKey: string,\n  ): Observable<DeviceView> {\n    return defer(() =>\n      this.devicesApiService.updateTrustedDeviceKeys(\n        deviceIdentifier,\n        devicePublicKeyEncryptedUserKey,\n        userKeyEncryptedDevicePublicKey,\n        deviceKeyEncryptedDevicePrivateKey,\n      ),\n    ).pipe(map((deviceResponse: DeviceResponse) => new DeviceView(deviceResponse)));\n  }\n}\n","import { DeviceType } from \"../../../../enums\";\nimport { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class DeviceResponse extends BaseResponse {\n  id: string;\n  userId: string;\n  name: string;\n  identifier: string;\n  type: DeviceType;\n  creationDate: string;\n  revisionDate: string;\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.identifier = this.getResponseProperty(\"Identifier\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { DeviceType } from \"../../../enums\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\n\nexport class ProtectedDeviceResponse extends BaseResponse {\n  constructor(response: Jsonify<ProtectedDeviceResponse>) {\n    super(response);\n    this.id = this.getResponseProperty(\"id\");\n    this.name = this.getResponseProperty(\"name\");\n    this.identifier = this.getResponseProperty(\"identifier\");\n    this.type = this.getResponseProperty(\"type\");\n    this.creationDate = new Date(this.getResponseProperty(\"creationDate\"));\n    if (response.encryptedUserKey) {\n      this.encryptedUserKey = new EncString(this.getResponseProperty(\"encryptedUserKey\"));\n    }\n    if (response.encryptedPublicKey) {\n      this.encryptedPublicKey = new EncString(this.getResponseProperty(\"encryptedPublicKey\"));\n    }\n  }\n\n  id: string;\n  name: string;\n  type: DeviceType;\n  identifier: string;\n  creationDate: Date;\n  /**\n   * Intended to be the users symmetric key that is encrypted in some form, the current way to encrypt this is with\n   * the devices public key.\n   */\n  encryptedUserKey: EncString;\n  /**\n   * Intended to be the public key that was generated for a device upon trust and encrypted. Currenly encrypted using\n   * a users symmetric key so that when trusted and unlocked a user can decrypt the public key for all their devices.\n   * This enabled a user to rotate the keys for all of their devices.\n   */\n  encryptedPublicKey: EncString;\n}\n","export class TrustedDeviceKeysRequest {\n  constructor(\n    public encryptedUserKey: string,\n    public encryptedPublicKey: string,\n    public encryptedPrivateKey: string,\n  ) {}\n}\n","import { ApiService } from \"../../abstractions/api.service\";\nimport { ListResponse } from \"../../models/response/list.response\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { DeviceResponse } from \"../abstractions/devices/responses/device.response\";\nimport { DevicesApiServiceAbstraction } from \"../abstractions/devices-api.service.abstraction\";\nimport { SecretVerificationRequest } from \"../models/request/secret-verification.request\";\nimport { UpdateDevicesTrustRequest } from \"../models/request/update-devices-trust.request\";\nimport { ProtectedDeviceResponse } from \"../models/response/protected-device.response\";\n\nimport { TrustedDeviceKeysRequest } from \"./devices/requests/trusted-device-keys.request\";\n\nexport class DevicesApiServiceImplementation implements DevicesApiServiceAbstraction {\n  constructor(private apiService: ApiService) {}\n\n  async getKnownDevice(email: string, deviceIdentifier: string): Promise<boolean> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/devices/knowndevice\",\n      null,\n      false,\n      true,\n      null,\n      (headers) => {\n        headers.set(\"X-Device-Identifier\", deviceIdentifier);\n        headers.set(\"X-Request-Email\", Utils.fromUtf8ToUrlB64(email));\n      },\n    );\n    return r as boolean;\n  }\n\n  /**\n   * Get device by identifier\n   * @param deviceIdentifier - client generated id (not device id in DB)\n   */\n  async getDeviceByIdentifier(deviceIdentifier: string): Promise<DeviceResponse> {\n    const r = await this.apiService.send(\n      \"GET\",\n      `/devices/identifier/${deviceIdentifier}`,\n      null,\n      true,\n      true,\n    );\n    return new DeviceResponse(r);\n  }\n\n  async getDevices(): Promise<ListResponse<DeviceResponse>> {\n    const r = await this.apiService.send(\"GET\", \"/devices\", null, true, true, null);\n    return new ListResponse(r, DeviceResponse);\n  }\n\n  async updateTrustedDeviceKeys(\n    deviceIdentifier: string,\n    devicePublicKeyEncryptedUserKey: string,\n    userKeyEncryptedDevicePublicKey: string,\n    deviceKeyEncryptedDevicePrivateKey: string,\n  ): Promise<DeviceResponse> {\n    const request = new TrustedDeviceKeysRequest(\n      devicePublicKeyEncryptedUserKey,\n      userKeyEncryptedDevicePublicKey,\n      deviceKeyEncryptedDevicePrivateKey,\n    );\n\n    const result = await this.apiService.send(\n      \"PUT\",\n      `/devices/${deviceIdentifier}/keys`,\n      request,\n      true,\n      true,\n    );\n\n    return new DeviceResponse(result);\n  }\n\n  async updateTrust(\n    updateDevicesTrustRequestModel: UpdateDevicesTrustRequest,\n    deviceIdentifier: string,\n  ): Promise<void> {\n    await this.apiService.send(\n      \"POST\",\n      \"/devices/update-trust\",\n      updateDevicesTrustRequestModel,\n      true,\n      false,\n      null,\n      (headers) => {\n        headers.set(\"Device-Identifier\", deviceIdentifier);\n      },\n    );\n  }\n\n  async getDeviceKeys(\n    deviceIdentifier: string,\n    secretVerificationRequest: SecretVerificationRequest,\n  ): Promise<ProtectedDeviceResponse> {\n    const result = await this.apiService.send(\n      \"POST\",\n      `/devices/${deviceIdentifier}/retrieve-keys`,\n      secretVerificationRequest,\n      true,\n      true,\n    );\n    return new ProtectedDeviceResponse(result);\n  }\n}\n","export class KeyConnectorUserKeyRequest {\n  key: string;\n\n  constructor(key: string) {\n    this.key = key;\n  }\n}\n","import { KeysRequest } from \"../../../models/request/keys.request\";\nimport { KdfType } from \"../../../platform/enums\";\nimport { KdfConfig } from \"../domain/kdf-config\";\n\nexport class SetKeyConnectorKeyRequest {\n  key: string;\n  keys: KeysRequest;\n  kdf: KdfType;\n  kdfIterations: number;\n  kdfMemory?: number;\n  kdfParallelism?: number;\n  orgIdentifier: string;\n\n  constructor(\n    key: string,\n    kdf: KdfType,\n    kdfConfig: KdfConfig,\n    orgIdentifier: string,\n    keys: KeysRequest,\n  ) {\n    this.key = key;\n    this.kdf = kdf;\n    this.kdfIterations = kdfConfig.iterations;\n    this.kdfMemory = kdfConfig.memory;\n    this.kdfParallelism = kdfConfig.parallelism;\n    this.orgIdentifier = orgIdentifier;\n    this.keys = keys;\n  }\n}\n","import { ApiService } from \"../../abstractions/api.service\";\nimport { OrganizationService } from \"../../admin-console/abstractions/organization/organization.service.abstraction\";\nimport { OrganizationUserType } from \"../../admin-console/enums\";\nimport { KeysRequest } from \"../../models/request/keys.request\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { KeyGenerationService } from \"../../platform/abstractions/key-generation.service\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { SymmetricCryptoKey } from \"../../platform/models/domain/symmetric-crypto-key\";\nimport { MasterKey } from \"../../types/key\";\nimport { KeyConnectorService as KeyConnectorServiceAbstraction } from \"../abstractions/key-connector.service\";\nimport { TokenService } from \"../abstractions/token.service\";\nimport { KdfConfig } from \"../models/domain/kdf-config\";\nimport { KeyConnectorUserKeyRequest } from \"../models/request/key-connector-user-key.request\";\nimport { SetKeyConnectorKeyRequest } from \"../models/request/set-key-connector-key.request\";\nimport { IdentityTokenResponse } from \"../models/response/identity-token.response\";\n\nexport class KeyConnectorService implements KeyConnectorServiceAbstraction {\n  constructor(\n    private stateService: StateService,\n    private cryptoService: CryptoService,\n    private apiService: ApiService,\n    private tokenService: TokenService,\n    private logService: LogService,\n    private organizationService: OrganizationService,\n    private keyGenerationService: KeyGenerationService,\n    private logoutCallback: (expired: boolean, userId?: string) => Promise<void>,\n  ) {}\n\n  setUsesKeyConnector(usesKeyConnector: boolean) {\n    return this.stateService.setUsesKeyConnector(usesKeyConnector);\n  }\n\n  async getUsesKeyConnector(): Promise<boolean> {\n    return await this.stateService.getUsesKeyConnector();\n  }\n\n  async userNeedsMigration() {\n    const loggedInUsingSso = await this.tokenService.getIsExternal();\n    const requiredByOrganization = (await this.getManagingOrganization()) != null;\n    const userIsNotUsingKeyConnector = !(await this.getUsesKeyConnector());\n\n    return loggedInUsingSso && requiredByOrganization && userIsNotUsingKeyConnector;\n  }\n\n  async migrateUser() {\n    const organization = await this.getManagingOrganization();\n    const masterKey = await this.cryptoService.getMasterKey();\n    const keyConnectorRequest = new KeyConnectorUserKeyRequest(masterKey.encKeyB64);\n\n    try {\n      await this.apiService.postUserKeyToKeyConnector(\n        organization.keyConnectorUrl,\n        keyConnectorRequest,\n      );\n    } catch (e) {\n      this.handleKeyConnectorError(e);\n    }\n\n    await this.apiService.postConvertToKeyConnector();\n  }\n\n  // TODO: UserKey should be renamed to MasterKey and typed accordingly\n  async setMasterKeyFromUrl(url: string) {\n    try {\n      const masterKeyResponse = await this.apiService.getMasterKeyFromKeyConnector(url);\n      const keyArr = Utils.fromB64ToArray(masterKeyResponse.key);\n      const masterKey = new SymmetricCryptoKey(keyArr) as MasterKey;\n      await this.cryptoService.setMasterKey(masterKey);\n    } catch (e) {\n      this.handleKeyConnectorError(e);\n    }\n  }\n\n  async getManagingOrganization() {\n    const orgs = await this.organizationService.getAll();\n    return orgs.find(\n      (o) =>\n        o.keyConnectorEnabled &&\n        o.type !== OrganizationUserType.Admin &&\n        o.type !== OrganizationUserType.Owner &&\n        !o.isProviderUser,\n    );\n  }\n\n  async convertNewSsoUserToKeyConnector(tokenResponse: IdentityTokenResponse, orgId: string) {\n    // TODO: Remove after tokenResponse.keyConnectorUrl is deprecated in 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3537)\n    const {\n      kdf,\n      kdfIterations,\n      kdfMemory,\n      kdfParallelism,\n      keyConnectorUrl: legacyKeyConnectorUrl,\n      userDecryptionOptions,\n    } = tokenResponse;\n    const password = await this.keyGenerationService.createKey(512);\n    const kdfConfig = new KdfConfig(kdfIterations, kdfMemory, kdfParallelism);\n\n    const masterKey = await this.cryptoService.makeMasterKey(\n      password.keyB64,\n      await this.tokenService.getEmail(),\n      kdf,\n      kdfConfig,\n    );\n    const keyConnectorRequest = new KeyConnectorUserKeyRequest(masterKey.encKeyB64);\n    await this.cryptoService.setMasterKey(masterKey);\n\n    const userKey = await this.cryptoService.makeUserKey(masterKey);\n    await this.cryptoService.setUserKey(userKey[0]);\n    await this.cryptoService.setMasterKeyEncryptedUserKey(userKey[1].encryptedString);\n\n    const [pubKey, privKey] = await this.cryptoService.makeKeyPair();\n\n    try {\n      const keyConnectorUrl =\n        legacyKeyConnectorUrl ?? userDecryptionOptions?.keyConnectorOption?.keyConnectorUrl;\n      await this.apiService.postUserKeyToKeyConnector(keyConnectorUrl, keyConnectorRequest);\n    } catch (e) {\n      this.handleKeyConnectorError(e);\n    }\n\n    const keys = new KeysRequest(pubKey, privKey.encryptedString);\n    const setPasswordRequest = new SetKeyConnectorKeyRequest(\n      userKey[1].encryptedString,\n      kdf,\n      kdfConfig,\n      orgId,\n      keys,\n    );\n    await this.apiService.postSetKeyConnectorKey(setPasswordRequest);\n  }\n\n  async setConvertAccountRequired(status: boolean) {\n    await this.stateService.setConvertAccountToKeyConnector(status);\n  }\n\n  async getConvertAccountRequired(): Promise<boolean> {\n    return await this.stateService.getConvertAccountToKeyConnector();\n  }\n\n  async removeConvertAccountRequired() {\n    await this.stateService.setConvertAccountToKeyConnector(null);\n  }\n\n  async clear() {\n    await this.removeConvertAccountRequired();\n  }\n\n  private handleKeyConnectorError(e: any) {\n    this.logService.error(e);\n    if (this.logoutCallback != null) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.logoutCallback(false);\n    }\n    throw new Error(\"Key Connector error\");\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport {\n  ActiveUserState,\n  GlobalState,\n  KeyDefinition,\n  SSO_DISK,\n  StateProvider,\n} from \"../../platform/state\";\n\n/**\n * Uses disk storage so that the code verifier can be persisted across sso redirects.\n */\nconst CODE_VERIFIER = new KeyDefinition<string>(SSO_DISK, \"ssoCodeVerifier\", {\n  deserializer: (codeVerifier) => codeVerifier,\n});\n\n/**\n * Uses disk storage so that the sso state can be persisted across sso redirects.\n */\nconst SSO_STATE = new KeyDefinition<string>(SSO_DISK, \"ssoState\", {\n  deserializer: (state) => state,\n});\n\n/**\n * Uses disk storage so that the organization sso identifier can be persisted across sso redirects.\n */\nconst ORGANIZATION_SSO_IDENTIFIER = new KeyDefinition<string>(\n  SSO_DISK,\n  \"organizationSsoIdentifier\",\n  {\n    deserializer: (organizationIdentifier) => organizationIdentifier,\n  },\n);\n\nexport class SsoLoginService {\n  private codeVerifierState: GlobalState<string>;\n  private ssoState: GlobalState<string>;\n  private orgSsoIdentifierState: GlobalState<string>;\n  private activeUserOrgSsoIdentifierState: ActiveUserState<string>;\n\n  constructor(private stateProvider: StateProvider) {\n    this.codeVerifierState = this.stateProvider.getGlobal(CODE_VERIFIER);\n    this.ssoState = this.stateProvider.getGlobal(SSO_STATE);\n    this.orgSsoIdentifierState = this.stateProvider.getGlobal(ORGANIZATION_SSO_IDENTIFIER);\n    this.activeUserOrgSsoIdentifierState = this.stateProvider.getActive(\n      ORGANIZATION_SSO_IDENTIFIER,\n    );\n  }\n\n  getCodeVerifier(): Promise<string> {\n    return firstValueFrom(this.codeVerifierState.state$);\n  }\n\n  async setCodeVerifier(codeVerifier: string): Promise<void> {\n    await this.codeVerifierState.update((_) => codeVerifier);\n  }\n\n  getSsoState(): Promise<string> {\n    return firstValueFrom(this.ssoState.state$);\n  }\n\n  async setSsoState(ssoState: string): Promise<void> {\n    await this.ssoState.update((_) => ssoState);\n  }\n\n  getOrganizationSsoIdentifier(): Promise<string> {\n    return firstValueFrom(this.orgSsoIdentifierState.state$);\n  }\n\n  async setOrganizationSsoIdentifier(organizationIdentifier: string): Promise<void> {\n    await this.orgSsoIdentifierState.update((_) => organizationIdentifier);\n  }\n\n  getActiveUserOrganizationSsoIdentifier(): Promise<string> {\n    return firstValueFrom(this.activeUserOrgSsoIdentifierState.state$);\n  }\n\n  async setActiveUserOrganizationSsoIdentifier(organizationIdentifier: string): Promise<void> {\n    await this.activeUserOrgSsoIdentifierState.update((_) => organizationIdentifier);\n  }\n}\n","import { StateService } from \"../../platform/abstractions/state.service\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { TokenService as TokenServiceAbstraction } from \"../abstractions/token.service\";\nimport { IdentityTokenResponse } from \"../models/response/identity-token.response\";\n\nexport class TokenService implements TokenServiceAbstraction {\n  static decodeToken(token: string): Promise<any> {\n    if (token == null) {\n      throw new Error(\"Token not provided.\");\n    }\n\n    const parts = token.split(\".\");\n    if (parts.length !== 3) {\n      throw new Error(\"JWT must have 3 parts\");\n    }\n\n    const decoded = Utils.fromUrlB64ToUtf8(parts[1]);\n    if (decoded == null) {\n      throw new Error(\"Cannot decode the token\");\n    }\n\n    const decodedToken = JSON.parse(decoded);\n    return decodedToken;\n  }\n\n  constructor(private stateService: StateService) {}\n\n  async setTokens(\n    accessToken: string,\n    refreshToken: string,\n    clientIdClientSecret: [string, string],\n  ): Promise<any> {\n    await this.setToken(accessToken);\n    await this.setRefreshToken(refreshToken);\n    if (clientIdClientSecret != null) {\n      await this.setClientId(clientIdClientSecret[0]);\n      await this.setClientSecret(clientIdClientSecret[1]);\n    }\n  }\n\n  async setClientId(clientId: string): Promise<any> {\n    return await this.stateService.setApiKeyClientId(clientId);\n  }\n\n  async getClientId(): Promise<string> {\n    return await this.stateService.getApiKeyClientId();\n  }\n\n  async setClientSecret(clientSecret: string): Promise<any> {\n    return await this.stateService.setApiKeyClientSecret(clientSecret);\n  }\n\n  async getClientSecret(): Promise<string> {\n    return await this.stateService.getApiKeyClientSecret();\n  }\n\n  async setToken(token: string): Promise<void> {\n    await this.stateService.setAccessToken(token);\n  }\n\n  async getToken(): Promise<string> {\n    return await this.stateService.getAccessToken();\n  }\n\n  async setRefreshToken(refreshToken: string): Promise<any> {\n    return await this.stateService.setRefreshToken(refreshToken);\n  }\n\n  async getRefreshToken(): Promise<string> {\n    return await this.stateService.getRefreshToken();\n  }\n\n  async setTwoFactorToken(tokenResponse: IdentityTokenResponse): Promise<any> {\n    return await this.stateService.setTwoFactorToken(tokenResponse.twoFactorToken);\n  }\n\n  async getTwoFactorToken(): Promise<string> {\n    return await this.stateService.getTwoFactorToken();\n  }\n\n  async clearTwoFactorToken(): Promise<any> {\n    return await this.stateService.setTwoFactorToken(null);\n  }\n\n  async clearToken(userId?: string): Promise<any> {\n    await this.stateService.setAccessToken(null, { userId: userId });\n    await this.stateService.setRefreshToken(null, { userId: userId });\n    await this.stateService.setApiKeyClientId(null, { userId: userId });\n    await this.stateService.setApiKeyClientSecret(null, { userId: userId });\n  }\n\n  // jwthelper methods\n  // ref https://github.com/auth0/angular-jwt/blob/master/src/angularJwt/services/jwt.js\n\n  async decodeToken(token?: string): Promise<any> {\n    token = token ?? (await this.stateService.getAccessToken());\n\n    if (token == null) {\n      throw new Error(\"Token not found.\");\n    }\n\n    return TokenService.decodeToken(token);\n  }\n\n  async getTokenExpirationDate(): Promise<Date> {\n    const decoded = await this.decodeToken();\n    if (typeof decoded.exp === \"undefined\") {\n      return null;\n    }\n\n    const d = new Date(0); // The 0 here is the key, which sets the date to the epoch\n    d.setUTCSeconds(decoded.exp);\n    return d;\n  }\n\n  async tokenSecondsRemaining(offsetSeconds = 0): Promise<number> {\n    const d = await this.getTokenExpirationDate();\n    if (d == null) {\n      return 0;\n    }\n\n    const msRemaining = d.valueOf() - (new Date().valueOf() + offsetSeconds * 1000);\n    return Math.round(msRemaining / 1000);\n  }\n\n  async tokenNeedsRefresh(minutes = 5): Promise<boolean> {\n    const sRemaining = await this.tokenSecondsRemaining();\n    return sRemaining < 60 * minutes;\n  }\n\n  async getUserId(): Promise<string> {\n    const decoded = await this.decodeToken();\n    if (typeof decoded.sub === \"undefined\") {\n      throw new Error(\"No user id found\");\n    }\n\n    return decoded.sub as string;\n  }\n\n  async getEmail(): Promise<string> {\n    const decoded = await this.decodeToken();\n    if (typeof decoded.email === \"undefined\") {\n      throw new Error(\"No email found\");\n    }\n\n    return decoded.email as string;\n  }\n\n  async getEmailVerified(): Promise<boolean> {\n    const decoded = await this.decodeToken();\n    if (typeof decoded.email_verified === \"undefined\") {\n      throw new Error(\"No email verification found\");\n    }\n\n    return decoded.email_verified as boolean;\n  }\n\n  async getName(): Promise<string> {\n    const decoded = await this.decodeToken();\n    if (typeof decoded.name === \"undefined\") {\n      return null;\n    }\n\n    return decoded.name as string;\n  }\n\n  async getIssuer(): Promise<string> {\n    const decoded = await this.decodeToken();\n    if (typeof decoded.iss === \"undefined\") {\n      throw new Error(\"No issuer found\");\n    }\n\n    return decoded.iss as string;\n  }\n\n  async getIsExternal(): Promise<boolean> {\n    const decoded = await this.decodeToken();\n\n    return Array.isArray(decoded.amr) && decoded.amr.includes(\"external\");\n  }\n}\n","import { I18nService } from \"../../platform/abstractions/i18n.service\";\nimport { PlatformUtilsService } from \"../../platform/abstractions/platform-utils.service\";\nimport {\n  TwoFactorProviderDetails,\n  TwoFactorService as TwoFactorServiceAbstraction,\n} from \"../abstractions/two-factor.service\";\nimport { TwoFactorProviderType } from \"../enums/two-factor-provider-type\";\nimport { IdentityTwoFactorResponse } from \"../models/response/identity-two-factor.response\";\n\nexport const TwoFactorProviders: Partial<Record<TwoFactorProviderType, TwoFactorProviderDetails>> =\n  {\n    [TwoFactorProviderType.Authenticator]: {\n      type: TwoFactorProviderType.Authenticator,\n      name: null as string,\n      description: null as string,\n      priority: 1,\n      sort: 1,\n      premium: false,\n    },\n    [TwoFactorProviderType.Yubikey]: {\n      type: TwoFactorProviderType.Yubikey,\n      name: null as string,\n      description: null as string,\n      priority: 3,\n      sort: 2,\n      premium: true,\n    },\n    [TwoFactorProviderType.Duo]: {\n      type: TwoFactorProviderType.Duo,\n      name: \"Duo\",\n      description: null as string,\n      priority: 2,\n      sort: 3,\n      premium: true,\n    },\n    [TwoFactorProviderType.OrganizationDuo]: {\n      type: TwoFactorProviderType.OrganizationDuo,\n      name: \"Duo (Organization)\",\n      description: null as string,\n      priority: 10,\n      sort: 4,\n      premium: false,\n    },\n    [TwoFactorProviderType.Email]: {\n      type: TwoFactorProviderType.Email,\n      name: null as string,\n      description: null as string,\n      priority: 0,\n      sort: 6,\n      premium: false,\n    },\n    [TwoFactorProviderType.WebAuthn]: {\n      type: TwoFactorProviderType.WebAuthn,\n      name: null as string,\n      description: null as string,\n      priority: 4,\n      sort: 5,\n      premium: false,\n    },\n  };\n\nexport class TwoFactorService implements TwoFactorServiceAbstraction {\n  private twoFactorProvidersData: Map<TwoFactorProviderType, { [key: string]: string }>;\n  private selectedTwoFactorProviderType: TwoFactorProviderType = null;\n\n  constructor(\n    private i18nService: I18nService,\n    private platformUtilsService: PlatformUtilsService,\n  ) {}\n\n  init() {\n    TwoFactorProviders[TwoFactorProviderType.Email].name = this.i18nService.t(\"emailTitle\");\n    TwoFactorProviders[TwoFactorProviderType.Email].description = this.i18nService.t(\"emailDesc\");\n\n    TwoFactorProviders[TwoFactorProviderType.Authenticator].name =\n      this.i18nService.t(\"authenticatorAppTitle\");\n    TwoFactorProviders[TwoFactorProviderType.Authenticator].description =\n      this.i18nService.t(\"authenticatorAppDesc\");\n\n    TwoFactorProviders[TwoFactorProviderType.Duo].description = this.i18nService.t(\"duoDesc\");\n\n    TwoFactorProviders[TwoFactorProviderType.OrganizationDuo].name =\n      \"Duo (\" + this.i18nService.t(\"organization\") + \")\";\n    TwoFactorProviders[TwoFactorProviderType.OrganizationDuo].description =\n      this.i18nService.t(\"duoOrganizationDesc\");\n\n    TwoFactorProviders[TwoFactorProviderType.WebAuthn].name = this.i18nService.t(\"webAuthnTitle\");\n    TwoFactorProviders[TwoFactorProviderType.WebAuthn].description =\n      this.i18nService.t(\"webAuthnDesc\");\n\n    TwoFactorProviders[TwoFactorProviderType.Yubikey].name = this.i18nService.t(\"yubiKeyTitle\");\n    TwoFactorProviders[TwoFactorProviderType.Yubikey].description =\n      this.i18nService.t(\"yubiKeyDesc\");\n  }\n\n  getSupportedProviders(win: Window): TwoFactorProviderDetails[] {\n    const providers: any[] = [];\n    if (this.twoFactorProvidersData == null) {\n      return providers;\n    }\n\n    if (\n      this.twoFactorProvidersData.has(TwoFactorProviderType.OrganizationDuo) &&\n      this.platformUtilsService.supportsDuo()\n    ) {\n      providers.push(TwoFactorProviders[TwoFactorProviderType.OrganizationDuo]);\n    }\n\n    if (this.twoFactorProvidersData.has(TwoFactorProviderType.Authenticator)) {\n      providers.push(TwoFactorProviders[TwoFactorProviderType.Authenticator]);\n    }\n\n    if (this.twoFactorProvidersData.has(TwoFactorProviderType.Yubikey)) {\n      providers.push(TwoFactorProviders[TwoFactorProviderType.Yubikey]);\n    }\n\n    if (\n      this.twoFactorProvidersData.has(TwoFactorProviderType.Duo) &&\n      this.platformUtilsService.supportsDuo()\n    ) {\n      providers.push(TwoFactorProviders[TwoFactorProviderType.Duo]);\n    }\n\n    if (\n      this.twoFactorProvidersData.has(TwoFactorProviderType.WebAuthn) &&\n      this.platformUtilsService.supportsWebAuthn(win)\n    ) {\n      providers.push(TwoFactorProviders[TwoFactorProviderType.WebAuthn]);\n    }\n\n    if (this.twoFactorProvidersData.has(TwoFactorProviderType.Email)) {\n      providers.push(TwoFactorProviders[TwoFactorProviderType.Email]);\n    }\n\n    return providers;\n  }\n\n  getDefaultProvider(webAuthnSupported: boolean): TwoFactorProviderType {\n    if (this.twoFactorProvidersData == null) {\n      return null;\n    }\n\n    if (\n      this.selectedTwoFactorProviderType != null &&\n      this.twoFactorProvidersData.has(this.selectedTwoFactorProviderType)\n    ) {\n      return this.selectedTwoFactorProviderType;\n    }\n\n    let providerType: TwoFactorProviderType = null;\n    let providerPriority = -1;\n    this.twoFactorProvidersData.forEach((_value, type) => {\n      const provider = (TwoFactorProviders as any)[type];\n      if (provider != null && provider.priority > providerPriority) {\n        if (type === TwoFactorProviderType.WebAuthn && !webAuthnSupported) {\n          return;\n        }\n\n        providerType = type;\n        providerPriority = provider.priority;\n      }\n    });\n\n    return providerType;\n  }\n\n  setSelectedProvider(type: TwoFactorProviderType) {\n    this.selectedTwoFactorProviderType = type;\n  }\n\n  clearSelectedProvider() {\n    this.selectedTwoFactorProviderType = null;\n  }\n\n  setProviders(response: IdentityTwoFactorResponse) {\n    this.twoFactorProvidersData = response.twoFactorProviders2;\n  }\n\n  clearProviders() {\n    this.twoFactorProvidersData = null;\n  }\n\n  getProviders() {\n    return this.twoFactorProvidersData;\n  }\n}\n","export enum VerificationType {\n  MasterPassword = 0,\n  OTP = 1,\n  PIN = 2,\n  Biometrics = 3,\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { UserVerificationApiServiceAbstraction } from \"../../abstractions/user-verification/user-verification-api.service.abstraction\";\nimport { VerifyOTPRequest } from \"../../models/request/verify-otp.request\";\n\nexport class UserVerificationApiService implements UserVerificationApiServiceAbstraction {\n  constructor(private apiService: ApiService) {}\n\n  postAccountVerifyOTP(request: VerifyOTPRequest): Promise<void> {\n    return this.apiService.send(\"POST\", \"/accounts/verify-otp\", request, true, false);\n  }\n  async postAccountRequestOTP(): Promise<void> {\n    return this.apiService.send(\"POST\", \"/accounts/request-otp\", null, true, false);\n  }\n}\n","export class VerifyOTPRequest {\n  OTP: string;\n\n  constructor(OTP: string) {\n    this.OTP = OTP;\n  }\n}\n","import { PinCryptoServiceAbstraction } from \"../../../../../auth/src/common/abstractions/pin-crypto.service.abstraction\";\nimport { VaultTimeoutSettingsService as VaultTimeoutSettingsServiceAbstraction } from \"../../../abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { I18nService } from \"../../../platform/abstractions/i18n.service\";\nimport { LogService } from \"../../../platform/abstractions/log.service\";\nimport { PlatformUtilsService } from \"../../../platform/abstractions/platform-utils.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { KeySuffixOptions } from \"../../../platform/enums/key-suffix-options.enum\";\nimport { UserKey } from \"../../../types/key\";\nimport { UserVerificationApiServiceAbstraction } from \"../../abstractions/user-verification/user-verification-api.service.abstraction\";\nimport { UserVerificationService as UserVerificationServiceAbstraction } from \"../../abstractions/user-verification/user-verification.service.abstraction\";\nimport { VerificationType } from \"../../enums/verification-type\";\nimport { SecretVerificationRequest } from \"../../models/request/secret-verification.request\";\nimport { VerifyOTPRequest } from \"../../models/request/verify-otp.request\";\nimport { UserVerificationOptions } from \"../../types/user-verification-options\";\nimport {\n  MasterPasswordVerification,\n  OtpVerification,\n  PinVerification,\n  ServerSideVerification,\n  Verification,\n  VerificationWithSecret,\n  verificationHasSecret,\n} from \"../../types/verification\";\n\n/**\n * Used for general-purpose user verification throughout the app.\n * Use it to verify the input collected by UserVerificationComponent.\n */\nexport class UserVerificationService implements UserVerificationServiceAbstraction {\n  constructor(\n    private stateService: StateService,\n    private cryptoService: CryptoService,\n    private i18nService: I18nService,\n    private userVerificationApiService: UserVerificationApiServiceAbstraction,\n    private pinCryptoService: PinCryptoServiceAbstraction,\n    private logService: LogService,\n    private vaultTimeoutSettingsService: VaultTimeoutSettingsServiceAbstraction,\n    private platformUtilsService: PlatformUtilsService,\n  ) {}\n\n  async getAvailableVerificationOptions(\n    verificationType: keyof UserVerificationOptions,\n  ): Promise<UserVerificationOptions> {\n    if (verificationType === \"client\") {\n      const [userHasMasterPassword, pinLockType, biometricsLockSet, biometricsUserKeyStored] =\n        await Promise.all([\n          this.hasMasterPasswordAndMasterKeyHash(),\n          this.vaultTimeoutSettingsService.isPinLockSet(),\n          this.vaultTimeoutSettingsService.isBiometricLockSet(),\n          this.cryptoService.hasUserKeyStored(KeySuffixOptions.Biometric),\n        ]);\n\n      // note: we do not need to check this.platformUtilsService.supportsBiometric() because\n      // we can just use the logic below which works for both desktop & the browser extension.\n\n      return {\n        client: {\n          masterPassword: userHasMasterPassword,\n          pin: pinLockType !== \"DISABLED\",\n          biometrics:\n            biometricsLockSet &&\n            (biometricsUserKeyStored || !this.platformUtilsService.supportsSecureStorage()),\n        },\n        server: {\n          masterPassword: false,\n          otp: false,\n        },\n      };\n    } else {\n      // server\n      // Don't check if have MP hash locally, because we are going to send the secret to the server to be verified.\n      const userHasMasterPassword = await this.hasMasterPassword();\n\n      return {\n        client: {\n          masterPassword: false,\n          pin: false,\n          biometrics: false,\n        },\n        server: { masterPassword: userHasMasterPassword, otp: !userHasMasterPassword },\n      };\n    }\n  }\n\n  /**\n   * Create a new request model to be used for server-side verification\n   * @param verification User-supplied verification data (Master Password or OTP)\n   * @param requestClass The request model to create\n   * @param alreadyHashed Whether the master password is already hashed\n   */\n  async buildRequest<T extends SecretVerificationRequest>(\n    verification: ServerSideVerification,\n    requestClass?: new () => T,\n    alreadyHashed?: boolean,\n  ) {\n    this.validateSecretInput(verification);\n\n    const request =\n      requestClass != null ? new requestClass() : (new SecretVerificationRequest() as T);\n\n    if (verification.type === VerificationType.OTP) {\n      request.otp = verification.secret;\n    } else {\n      let masterKey = await this.cryptoService.getMasterKey();\n      if (!masterKey && !alreadyHashed) {\n        masterKey = await this.cryptoService.makeMasterKey(\n          verification.secret,\n          await this.stateService.getEmail(),\n          await this.stateService.getKdfType(),\n          await this.stateService.getKdfConfig(),\n        );\n      }\n      request.masterPasswordHash = alreadyHashed\n        ? verification.secret\n        : await this.cryptoService.hashMasterKey(verification.secret, masterKey);\n    }\n\n    return request;\n  }\n\n  /**\n   * Used to verify Master Password, PIN, or biometrics client-side, or send the OTP to the server for verification (with no other data)\n   * Generally used for client-side verification only.\n   * @param verification User-supplied verification data (OTP, MP, PIN, or biometrics)\n   */\n  async verifyUser(verification: Verification): Promise<boolean> {\n    if (verificationHasSecret(verification)) {\n      this.validateSecretInput(verification);\n    }\n\n    switch (verification.type) {\n      case VerificationType.OTP:\n        return this.verifyUserByOTP(verification);\n      case VerificationType.MasterPassword:\n        return this.verifyUserByMasterPassword(verification);\n      case VerificationType.PIN:\n        return this.verifyUserByPIN(verification);\n        break;\n      case VerificationType.Biometrics:\n        return this.verifyUserByBiometrics();\n      default: {\n        // Compile-time check for exhaustive switch\n        const _exhaustiveCheck: never = verification;\n        return _exhaustiveCheck;\n      }\n    }\n  }\n\n  private async verifyUserByOTP(verification: OtpVerification): Promise<boolean> {\n    const request = new VerifyOTPRequest(verification.secret);\n    try {\n      await this.userVerificationApiService.postAccountVerifyOTP(request);\n    } catch (e) {\n      throw new Error(this.i18nService.t(\"invalidVerificationCode\"));\n    }\n    return true;\n  }\n\n  private async verifyUserByMasterPassword(\n    verification: MasterPasswordVerification,\n  ): Promise<boolean> {\n    let masterKey = await this.cryptoService.getMasterKey();\n    if (!masterKey) {\n      masterKey = await this.cryptoService.makeMasterKey(\n        verification.secret,\n        await this.stateService.getEmail(),\n        await this.stateService.getKdfType(),\n        await this.stateService.getKdfConfig(),\n      );\n    }\n    const passwordValid = await this.cryptoService.compareAndUpdateKeyHash(\n      verification.secret,\n      masterKey,\n    );\n    if (!passwordValid) {\n      throw new Error(this.i18nService.t(\"invalidMasterPassword\"));\n    }\n    // TODO: we should re-evaluate later on if user verification should have the side effect of modifying state. Probably not.\n    await this.cryptoService.setMasterKey(masterKey);\n    return true;\n  }\n\n  private async verifyUserByPIN(verification: PinVerification): Promise<boolean> {\n    const userKey = await this.pinCryptoService.decryptUserKeyWithPin(verification.secret);\n\n    return userKey != null;\n  }\n\n  private async verifyUserByBiometrics(): Promise<boolean> {\n    let userKey: UserKey;\n    // Biometrics crashes and doesn't return a value if the user cancels the prompt\n    try {\n      userKey = await this.cryptoService.getUserKeyFromStorage(KeySuffixOptions.Biometric);\n    } catch (e) {\n      this.logService.error(`Biometrics User Verification failed: ${e.message}`);\n      // So, any failures should be treated as a failed verification\n      return false;\n    }\n\n    return userKey != null;\n  }\n\n  async requestOTP() {\n    await this.userVerificationApiService.postAccountRequestOTP();\n  }\n\n  /**\n   * Check if user has master password or can only use passwordless technologies to log in\n   * Note: This only checks the server, not the local state\n   * @param userId The user id to check. If not provided, the current user is used\n   * @returns True if the user has a master password\n   */\n  async hasMasterPassword(userId?: string): Promise<boolean> {\n    const decryptionOptions = await this.stateService.getAccountDecryptionOptions({ userId });\n\n    if (decryptionOptions?.hasMasterPassword != undefined) {\n      return decryptionOptions.hasMasterPassword;\n    }\n\n    // TODO: PM-3518 - Left for backwards compatibility, remove after 2023.12.0\n    return !(await this.stateService.getUsesKeyConnector({ userId }));\n  }\n\n  async hasMasterPasswordAndMasterKeyHash(userId?: string): Promise<boolean> {\n    return (\n      (await this.hasMasterPassword(userId)) &&\n      (await this.cryptoService.getMasterKeyHash()) != null\n    );\n  }\n\n  private validateSecretInput(verification: VerificationWithSecret) {\n    if (verification?.secret == null || verification.secret === \"\") {\n      switch (verification.type) {\n        case VerificationType.OTP:\n          throw new Error(this.i18nService.t(\"verificationCodeRequired\"));\n        case VerificationType.MasterPassword:\n          throw new Error(this.i18nService.t(\"masterPasswordRequired\"));\n        case VerificationType.PIN:\n          throw new Error(this.i18nService.t(\"pinRequired\"));\n      }\n    }\n  }\n}\n","import { VerificationType } from \"../enums/verification-type\";\n\nexport type OtpVerification = { type: VerificationType.OTP; secret: string };\nexport type MasterPasswordVerification = { type: VerificationType.MasterPassword; secret: string };\nexport type PinVerification = { type: VerificationType.PIN; secret: string };\nexport type BiometricsVerification = { type: VerificationType.Biometrics };\n\nexport type VerificationWithSecret = OtpVerification | MasterPasswordVerification | PinVerification;\nexport type VerificationWithoutSecret = BiometricsVerification;\n\nexport type Verification = VerificationWithSecret | VerificationWithoutSecret;\n\nexport function verificationHasSecret(\n  verification: Verification,\n): verification is VerificationWithSecret {\n  return \"secret\" in verification;\n}\n\nexport type ServerSideVerification = OtpVerification | MasterPasswordVerification;\n","export const TYPE_CHECK = {\n  FUNCTION: \"function\",\n  NUMBER: \"number\",\n  STRING: \"string\",\n} as const;\n\nexport const EVENTS = {\n  CHANGE: \"change\",\n  INPUT: \"input\",\n  KEYDOWN: \"keydown\",\n  KEYPRESS: \"keypress\",\n  KEYUP: \"keyup\",\n  BLUR: \"blur\",\n  CLICK: \"click\",\n  FOCUS: \"focus\",\n  SCROLL: \"scroll\",\n  RESIZE: \"resize\",\n  DOMCONTENTLOADED: \"DOMContentLoaded\",\n  LOAD: \"load\",\n  MESSAGE: \"message\",\n  VISIBILITYCHANGE: \"visibilitychange\",\n  FOCUSOUT: \"focusout\",\n} as const;\n\nexport const ClearClipboardDelay = {\n  Never: null as null,\n  TenSeconds: 10,\n  TwentySeconds: 20,\n  ThirtySeconds: 30,\n  OneMinute: 60,\n  TwoMinutes: 120,\n  FiveMinutes: 300,\n} as const;\n\nexport type ClearClipboardDelaySetting =\n  (typeof ClearClipboardDelay)[keyof typeof ClearClipboardDelay];\n\n/* Context Menu item Ids */\nexport const AUTOFILL_CARD_ID = \"autofill-card\";\nexport const AUTOFILL_ID = \"autofill\";\nexport const SHOW_AUTOFILL_BUTTON = \"show-autofill-button\";\nexport const AUTOFILL_IDENTITY_ID = \"autofill-identity\";\nexport const COPY_IDENTIFIER_ID = \"copy-identifier\";\nexport const COPY_PASSWORD_ID = \"copy-password\";\nexport const COPY_USERNAME_ID = \"copy-username\";\nexport const COPY_VERIFICATION_CODE_ID = \"copy-totp\";\nexport const CREATE_CARD_ID = \"create-card\";\nexport const CREATE_IDENTITY_ID = \"create-identity\";\nexport const CREATE_LOGIN_ID = \"create-login\";\nexport const GENERATE_PASSWORD_ID = \"generate-password\";\nexport const NOOP_COMMAND_SUFFIX = \"noop\";\nexport const ROOT_ID = \"root\";\nexport const SEPARATOR_ID = \"separator\";\n\nexport const NOTIFICATION_BAR_LIFESPAN_MS = 150000; // 150 seconds\n","const AutofillOverlayElement = {\n  Button: \"autofill-overlay-button\",\n  List: \"autofill-overlay-list\",\n} as const;\n\nconst AutofillOverlayPort = {\n  Button: \"autofill-overlay-button-port\",\n  List: \"autofill-overlay-list-port\",\n} as const;\n\nconst RedirectFocusDirection = {\n  Current: \"current\",\n  Previous: \"previous\",\n  Next: \"next\",\n} as const;\n\nconst AutofillOverlayVisibility = {\n  Off: 0,\n  OnButtonClick: 1,\n  OnFieldFocus: 2,\n} as const;\n\ntype InlineMenuVisibilitySetting =\n  (typeof AutofillOverlayVisibility)[keyof typeof AutofillOverlayVisibility];\n\nexport {\n  AutofillOverlayElement,\n  AutofillOverlayPort,\n  RedirectFocusDirection,\n  AutofillOverlayVisibility,\n  InlineMenuVisibilitySetting,\n};\n","import { filter, switchMap, tap, firstValueFrom, map, Observable } from \"rxjs\";\n\nimport {\n  ClearClipboardDelaySetting,\n  ClearClipboardDelay,\n} from \"../../../../../apps/browser/src/autofill/constants\";\nimport {\n  AutofillOverlayVisibility,\n  InlineMenuVisibilitySetting,\n} from \"../../../../../apps/browser/src/autofill/utils/autofill-overlay.enum\";\nimport { PolicyService } from \"../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"../../admin-console/enums/index\";\nimport { Policy } from \"../../admin-console/models/domain/policy\";\nimport {\n  AUTOFILL_SETTINGS_DISK,\n  AUTOFILL_SETTINGS_DISK_LOCAL,\n  ActiveUserState,\n  GlobalState,\n  KeyDefinition,\n  StateProvider,\n} from \"../../platform/state\";\n\nconst AUTOFILL_ON_PAGE_LOAD = new KeyDefinition(AUTOFILL_SETTINGS_DISK, \"autofillOnPageLoad\", {\n  deserializer: (value: boolean) => value ?? false,\n});\n\nconst AUTOFILL_ON_PAGE_LOAD_DEFAULT = new KeyDefinition(\n  AUTOFILL_SETTINGS_DISK,\n  \"autofillOnPageLoadDefault\",\n  {\n    deserializer: (value: boolean) => value ?? false,\n  },\n);\n\nconst AUTO_COPY_TOTP = new KeyDefinition(AUTOFILL_SETTINGS_DISK, \"autoCopyTotp\", {\n  deserializer: (value: boolean) => value ?? false,\n});\n\nconst AUTOFILL_ON_PAGE_LOAD_CALLOUT_DISMISSED = new KeyDefinition(\n  AUTOFILL_SETTINGS_DISK,\n  \"autofillOnPageLoadCalloutIsDismissed\",\n  {\n    deserializer: (value: boolean) => value ?? false,\n  },\n);\n\nconst ACTIVATE_AUTOFILL_ON_PAGE_LOAD_FROM_POLICY = new KeyDefinition(\n  AUTOFILL_SETTINGS_DISK_LOCAL,\n  \"activateAutofillOnPageLoadFromPolicy\",\n  {\n    deserializer: (value: boolean) => value ?? false,\n  },\n);\n\nconst INLINE_MENU_VISIBILITY = new KeyDefinition(\n  AUTOFILL_SETTINGS_DISK_LOCAL,\n  \"inlineMenuVisibility\",\n  {\n    deserializer: (value: InlineMenuVisibilitySetting) => value ?? AutofillOverlayVisibility.Off,\n  },\n);\n\nconst CLEAR_CLIPBOARD_DELAY = new KeyDefinition(\n  AUTOFILL_SETTINGS_DISK_LOCAL,\n  \"clearClipboardDelay\",\n  {\n    deserializer: (value: ClearClipboardDelaySetting) => value ?? ClearClipboardDelay.Never,\n  },\n);\n\nexport abstract class AutofillSettingsServiceAbstraction {\n  autofillOnPageLoad$: Observable<boolean>;\n  setAutofillOnPageLoad: (newValue: boolean) => Promise<void>;\n  autofillOnPageLoadDefault$: Observable<boolean>;\n  setAutofillOnPageLoadDefault: (newValue: boolean) => Promise<void>;\n  autoCopyTotp$: Observable<boolean>;\n  setAutoCopyTotp: (newValue: boolean) => Promise<void>;\n  autofillOnPageLoadCalloutIsDismissed$: Observable<boolean>;\n  setAutofillOnPageLoadCalloutIsDismissed: (newValue: boolean) => Promise<void>;\n  activateAutofillOnPageLoadFromPolicy$: Observable<boolean>;\n  setActivateAutofillOnPageLoadFromPolicy: (newValue: boolean) => Promise<void>;\n  inlineMenuVisibility$: Observable<InlineMenuVisibilitySetting>;\n  setInlineMenuVisibility: (newValue: InlineMenuVisibilitySetting) => Promise<void>;\n  clearClipboardDelay$: Observable<ClearClipboardDelaySetting>;\n  setClearClipboardDelay: (newValue: ClearClipboardDelaySetting) => Promise<void>;\n  handleActivateAutofillPolicy: (policies: Observable<Policy[]>) => Observable<boolean[]>;\n}\n\nexport class AutofillSettingsService implements AutofillSettingsServiceAbstraction {\n  private autofillOnPageLoadState: ActiveUserState<boolean>;\n  readonly autofillOnPageLoad$: Observable<boolean>;\n\n  private autofillOnPageLoadDefaultState: ActiveUserState<boolean>;\n  readonly autofillOnPageLoadDefault$: Observable<boolean>;\n\n  private autoCopyTotpState: ActiveUserState<boolean>;\n  readonly autoCopyTotp$: Observable<boolean>;\n\n  private autofillOnPageLoadCalloutIsDismissedState: ActiveUserState<boolean>;\n  readonly autofillOnPageLoadCalloutIsDismissed$: Observable<boolean>;\n\n  private activateAutofillOnPageLoadFromPolicyState: ActiveUserState<boolean>;\n  readonly activateAutofillOnPageLoadFromPolicy$: Observable<boolean>;\n\n  private inlineMenuVisibilityState: GlobalState<InlineMenuVisibilitySetting>;\n  readonly inlineMenuVisibility$: Observable<InlineMenuVisibilitySetting>;\n\n  private clearClipboardDelayState: ActiveUserState<ClearClipboardDelaySetting>;\n  readonly clearClipboardDelay$: Observable<ClearClipboardDelaySetting>;\n\n  constructor(\n    private stateProvider: StateProvider,\n    policyService: PolicyService,\n  ) {\n    this.autofillOnPageLoadState = this.stateProvider.getActive(AUTOFILL_ON_PAGE_LOAD);\n    this.autofillOnPageLoad$ = this.autofillOnPageLoadState.state$.pipe(map((x) => x ?? false));\n\n    this.autofillOnPageLoadDefaultState = this.stateProvider.getActive(\n      AUTOFILL_ON_PAGE_LOAD_DEFAULT,\n    );\n    this.autofillOnPageLoadDefault$ = this.autofillOnPageLoadDefaultState.state$.pipe(\n      map((x) => x ?? true),\n    );\n\n    this.autoCopyTotpState = this.stateProvider.getActive(AUTO_COPY_TOTP);\n    this.autoCopyTotp$ = this.autoCopyTotpState.state$.pipe(map((x) => x ?? false));\n\n    this.autofillOnPageLoadCalloutIsDismissedState = this.stateProvider.getActive(\n      AUTOFILL_ON_PAGE_LOAD_CALLOUT_DISMISSED,\n    );\n    this.autofillOnPageLoadCalloutIsDismissed$ =\n      this.autofillOnPageLoadCalloutIsDismissedState.state$.pipe(map((x) => x ?? false));\n\n    this.activateAutofillOnPageLoadFromPolicyState = this.stateProvider.getActive(\n      ACTIVATE_AUTOFILL_ON_PAGE_LOAD_FROM_POLICY,\n    );\n    this.activateAutofillOnPageLoadFromPolicy$ =\n      this.activateAutofillOnPageLoadFromPolicyState.state$.pipe(map((x) => x ?? false));\n\n    this.inlineMenuVisibilityState = this.stateProvider.getGlobal(INLINE_MENU_VISIBILITY);\n    this.inlineMenuVisibility$ = this.inlineMenuVisibilityState.state$.pipe(\n      map((x) => x ?? AutofillOverlayVisibility.Off),\n    );\n\n    this.clearClipboardDelayState = this.stateProvider.getActive(CLEAR_CLIPBOARD_DELAY);\n    this.clearClipboardDelay$ = this.clearClipboardDelayState.state$.pipe(\n      map((x) => x ?? ClearClipboardDelay.Never),\n    );\n\n    policyService.policies$.pipe(this.handleActivateAutofillPolicy.bind(this)).subscribe();\n  }\n\n  async setAutofillOnPageLoad(newValue: boolean): Promise<void> {\n    await this.autofillOnPageLoadState.update(() => newValue);\n  }\n\n  async setAutofillOnPageLoadDefault(newValue: boolean): Promise<void> {\n    await this.autofillOnPageLoadDefaultState.update(() => newValue);\n  }\n\n  async setAutoCopyTotp(newValue: boolean): Promise<void> {\n    await this.autoCopyTotpState.update(() => newValue);\n  }\n\n  async setAutofillOnPageLoadCalloutIsDismissed(newValue: boolean): Promise<void> {\n    await this.autofillOnPageLoadCalloutIsDismissedState.update(() => newValue);\n  }\n\n  async setActivateAutofillOnPageLoadFromPolicy(newValue: boolean): Promise<void> {\n    await this.activateAutofillOnPageLoadFromPolicyState.update(() => newValue);\n  }\n\n  async setInlineMenuVisibility(newValue: InlineMenuVisibilitySetting): Promise<void> {\n    await this.inlineMenuVisibilityState.update(() => newValue);\n  }\n\n  async setClearClipboardDelay(newValue: ClearClipboardDelaySetting): Promise<void> {\n    await this.clearClipboardDelayState.update(() => newValue);\n  }\n\n  /**\n   * If the ActivateAutofill policy is enabled, save a flag indicating if we need to\n   * enable Autofill on page load.\n   */\n  handleActivateAutofillPolicy(policies$: Observable<Policy[]>): Observable<boolean[]> {\n    return policies$.pipe(\n      map((policies) => policies.find((p) => p.type == PolicyType.ActivateAutofill && p.enabled)),\n      filter((p) => p != null),\n      switchMap(async (_) => [\n        await firstValueFrom(this.activateAutofillOnPageLoadFromPolicy$),\n        await firstValueFrom(this.autofillOnPageLoad$),\n      ]),\n      tap(([activated, autofillEnabled]) => {\n        if (activated === undefined) {\n          void this.setActivateAutofillOnPageLoadFromPolicy(!autofillEnabled);\n        }\n      }),\n    );\n  }\n}\n","export abstract class MessagingService {\n  send: (subscriber: string, arg?: any) => void;\n}\n","import { EncryptedString } from \"../models/domain/enc-string\";\nimport { KeyDefinition, BIOMETRIC_SETTINGS_DISK } from \"../state\";\n\n/**\n * Boolean indicating the user has elected to require a password to use their biometric key upon starting the application.\n *\n * A true setting controls whether {@link ENCRYPTED_CLIENT_KEY_HALF} is set.\n */\nexport const REQUIRE_PASSWORD_ON_START = new KeyDefinition<boolean>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"requirePasswordOnStart\",\n  {\n    deserializer: (value) => value,\n  },\n);\n\n/**\n * If the user has elected to require a password on first unlock of an application instance, this key will store the\n * encrypted client key half used to unlock the vault.\n *\n * For operating systems without application-level key storage, this key half is concatenated with a signature\n * provided by the OS and used to encrypt the biometric key prior to storage.\n */\nexport const ENCRYPTED_CLIENT_KEY_HALF = new KeyDefinition<EncryptedString>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"clientKeyHalf\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n\n/**\n * Indicates the user has been warned about the security implications of using biometrics and, depending on the OS,\n * recommended to require a password on first unlock of an application instance.\n */\nexport const DISMISSED_REQUIRE_PASSWORD_ON_START_CALLOUT = new KeyDefinition<boolean>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"dismissedBiometricRequirePasswordOnStartCallout\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n\n/**\n * Stores whether the user has elected to cancel the biometric prompt. This is stored on disk due to process-reload\n * wiping memory state. We don't want to prompt the user again if they've elected to cancel.\n */\nexport const PROMPT_CANCELLED = new KeyDefinition<boolean>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"promptCancelled\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n\n/**\n * Stores whether the user has elected to automatically prompt for biometric unlock on application start.\n */\nexport const PROMPT_AUTOMATICALLY = new KeyDefinition<boolean>(\n  BIOMETRIC_SETTINGS_DISK,\n  \"promptAutomatically\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n","import { Observable, firstValueFrom, map } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\nimport { EncryptedString, EncString } from \"../models/domain/enc-string\";\nimport { ActiveUserState, StateProvider } from \"../state\";\n\nimport {\n  ENCRYPTED_CLIENT_KEY_HALF,\n  REQUIRE_PASSWORD_ON_START,\n  DISMISSED_REQUIRE_PASSWORD_ON_START_CALLOUT,\n  PROMPT_AUTOMATICALLY,\n  PROMPT_CANCELLED,\n} from \"./biometric.state\";\n\nexport abstract class BiometricStateService {\n  /**\n   * If the user has elected to require a password on first unlock of an application instance, this key will store the\n   * encrypted client key half used to unlock the vault.\n   *\n   * Tracks the currently active user\n   */\n  encryptedClientKeyHalf$: Observable<EncString | undefined>;\n  /**\n   * whether or not a password is required on first unlock after opening the application\n   *\n   * tracks the currently active user\n   */\n  requirePasswordOnStart$: Observable<boolean>;\n  /**\n   * Indicates the user has been warned about the security implications of using biometrics and, depending on the OS,\n   *\n   * tracks the currently active user.\n   */\n  dismissedRequirePasswordOnStartCallout$: Observable<boolean>;\n  /**\n   * Whether the user has cancelled the biometric prompt.\n   *\n   * tracks the currently active user\n   */\n  promptCancelled$: Observable<boolean>;\n  /**\n   * Whether the user has elected to automatically prompt for biometrics.\n   *\n   * tracks the currently active user\n   */\n  promptAutomatically$: Observable<boolean>;\n\n  /**\n   * Updates the require password on start state for the currently active user.\n   *\n   * If false, the encrypted client key half will be removed.\n   * @param value whether or not a password is required on first unlock after opening the application\n   */\n  abstract setRequirePasswordOnStart(value: boolean): Promise<void>;\n  abstract setEncryptedClientKeyHalf(encryptedKeyHalf: EncString, userId?: UserId): Promise<void>;\n  abstract getEncryptedClientKeyHalf(userId: UserId): Promise<EncString>;\n  abstract getRequirePasswordOnStart(userId: UserId): Promise<boolean>;\n  abstract removeEncryptedClientKeyHalf(userId: UserId): Promise<void>;\n  /**\n   * Updates the active user's state to reflect that they've been warned about requiring password on start.\n   */\n  abstract setDismissedRequirePasswordOnStartCallout(): Promise<void>;\n  /**\n   * Updates the active user's state to reflect that they've cancelled the biometric prompt this lock.\n   */\n  abstract setPromptCancelled(): Promise<void>;\n  /**\n   * Resets the active user's state to reflect that they haven't cancelled the biometric prompt this lock.\n   */\n  abstract resetPromptCancelled(): Promise<void>;\n  /**\n   * Updates the currently active user's setting for auto prompting for biometrics on application start and lock\n   * @param prompt Whether or not to prompt for biometrics on application start.\n   */\n  abstract setPromptAutomatically(prompt: boolean): Promise<void>;\n\n  abstract logout(userId: UserId): Promise<void>;\n}\n\nexport class DefaultBiometricStateService implements BiometricStateService {\n  private requirePasswordOnStartState: ActiveUserState<boolean>;\n  private encryptedClientKeyHalfState: ActiveUserState<EncryptedString | undefined>;\n  private dismissedRequirePasswordOnStartCalloutState: ActiveUserState<boolean>;\n  private promptCancelledState: ActiveUserState<boolean>;\n  private promptAutomaticallyState: ActiveUserState<boolean>;\n  encryptedClientKeyHalf$: Observable<EncString | undefined>;\n  requirePasswordOnStart$: Observable<boolean>;\n  dismissedRequirePasswordOnStartCallout$: Observable<boolean>;\n  promptCancelled$: Observable<boolean>;\n  promptAutomatically$: Observable<boolean>;\n\n  constructor(private stateProvider: StateProvider) {\n    this.requirePasswordOnStartState = this.stateProvider.getActive(REQUIRE_PASSWORD_ON_START);\n    this.requirePasswordOnStart$ = this.requirePasswordOnStartState.state$.pipe(\n      map((value) => !!value),\n    );\n\n    this.encryptedClientKeyHalfState = this.stateProvider.getActive(ENCRYPTED_CLIENT_KEY_HALF);\n    this.encryptedClientKeyHalf$ = this.encryptedClientKeyHalfState.state$.pipe(\n      map(encryptedClientKeyHalfToEncString),\n    );\n\n    this.dismissedRequirePasswordOnStartCalloutState = this.stateProvider.getActive(\n      DISMISSED_REQUIRE_PASSWORD_ON_START_CALLOUT,\n    );\n    this.dismissedRequirePasswordOnStartCallout$ =\n      this.dismissedRequirePasswordOnStartCalloutState.state$.pipe(map((v) => !!v));\n\n    this.promptCancelledState = this.stateProvider.getActive(PROMPT_CANCELLED);\n    this.promptCancelled$ = this.promptCancelledState.state$.pipe(map((v) => !!v));\n    this.promptAutomaticallyState = this.stateProvider.getActive(PROMPT_AUTOMATICALLY);\n    this.promptAutomatically$ = this.promptAutomaticallyState.state$.pipe(map((v) => !!v));\n  }\n\n  async setRequirePasswordOnStart(value: boolean): Promise<void> {\n    let currentActiveId: UserId;\n    await this.requirePasswordOnStartState.update(\n      (_, [userId]) => {\n        currentActiveId = userId;\n        return value;\n      },\n      {\n        combineLatestWith: this.requirePasswordOnStartState.combinedState$,\n      },\n    );\n    if (!value) {\n      await this.removeEncryptedClientKeyHalf(currentActiveId);\n    }\n  }\n\n  async setEncryptedClientKeyHalf(encryptedKeyHalf: EncString, userId?: UserId): Promise<void> {\n    const value = encryptedKeyHalf?.encryptedString ?? null;\n    if (userId) {\n      await this.stateProvider.getUser(userId, ENCRYPTED_CLIENT_KEY_HALF).update(() => value);\n    } else {\n      await this.encryptedClientKeyHalfState.update(() => value);\n    }\n  }\n\n  async removeEncryptedClientKeyHalf(userId: UserId): Promise<void> {\n    await this.stateProvider.getUser(userId, ENCRYPTED_CLIENT_KEY_HALF).update(() => null);\n  }\n\n  async getRequirePasswordOnStart(userId: UserId): Promise<boolean> {\n    return !!(await firstValueFrom(\n      this.stateProvider.getUser(userId, REQUIRE_PASSWORD_ON_START).state$,\n    ));\n  }\n\n  async getEncryptedClientKeyHalf(userId: UserId): Promise<EncString> {\n    return await firstValueFrom(\n      this.stateProvider\n        .getUser(userId, ENCRYPTED_CLIENT_KEY_HALF)\n        .state$.pipe(map(encryptedClientKeyHalfToEncString)),\n    );\n  }\n\n  async logout(userId: UserId): Promise<void> {\n    await this.stateProvider.getUser(userId, ENCRYPTED_CLIENT_KEY_HALF).update(() => null);\n    await this.stateProvider.getUser(userId, PROMPT_CANCELLED).update(() => null);\n    // Persist auto prompt setting through logout\n    // Persist dismissed require password on start callout through logout\n  }\n\n  async setDismissedRequirePasswordOnStartCallout(): Promise<void> {\n    await this.dismissedRequirePasswordOnStartCalloutState.update(() => true);\n  }\n\n  async setPromptCancelled(): Promise<void> {\n    await this.promptCancelledState.update(() => true);\n  }\n\n  async resetPromptCancelled(): Promise<void> {\n    await this.promptCancelledState.update(() => null);\n  }\n\n  async setPromptAutomatically(prompt: boolean): Promise<void> {\n    await this.promptAutomaticallyState.update(() => prompt);\n  }\n}\n\nfunction encryptedClientKeyHalfToEncString(\n  encryptedKeyHalf: EncryptedString | undefined,\n): EncString {\n  return encryptedKeyHalf == null ? null : new EncString(encryptedKeyHalf);\n}\n","import { Account } from \"../models/domain/account\";\n\nexport class AccountFactory<T extends Account = Account> {\n  private accountConstructor: new (init: Partial<T>) => T;\n\n  constructor(accountConstructor: new (init: Partial<T>) => T) {\n    this.accountConstructor = accountConstructor;\n  }\n\n  create(args: Partial<T>) {\n    return new this.accountConstructor(args);\n  }\n}\n","import { GlobalState } from \"../models/domain/global-state\";\n\nexport class GlobalStateFactory<T extends GlobalState = GlobalState> {\n  private globalStateConstructor: new (init: Partial<T>) => T;\n\n  constructor(globalStateConstructor: new (init: Partial<T>) => T) {\n    this.globalStateConstructor = globalStateConstructor;\n  }\n\n  create(args?: Partial<T>) {\n    return new this.globalStateConstructor(args);\n  }\n}\n","import { Account } from \"../models/domain/account\";\nimport { GlobalState } from \"../models/domain/global-state\";\n\nimport { AccountFactory } from \"./account-factory\";\nimport { GlobalStateFactory } from \"./global-state-factory\";\n\nexport class StateFactory<\n  TGlobal extends GlobalState = GlobalState,\n  TAccount extends Account = Account,\n> {\n  private globalStateFactory: GlobalStateFactory<TGlobal>;\n  private accountFactory: AccountFactory<TAccount>;\n\n  constructor(\n    globalStateConstructor: new (init: Partial<TGlobal>) => TGlobal,\n    accountConstructor: new (init: Partial<TAccount>) => TAccount,\n  ) {\n    this.globalStateFactory = new GlobalStateFactory(globalStateConstructor);\n    this.accountFactory = new AccountFactory(accountConstructor);\n  }\n\n  createGlobal(args: Partial<TGlobal>): TGlobal {\n    return this.globalStateFactory.create(args);\n  }\n\n  createAccount(args: Partial<TAccount>): TAccount {\n    return this.accountFactory.create(args);\n  }\n}\n","export class WindowState {\n  width?: number;\n  height?: number;\n  isMaximized?: boolean;\n  // TODO: displayBounds is an Electron.Rectangle.\n  // We need to establish some kind of client-specific global state, similar to the way we already extend a base Account.\n  displayBounds: any;\n  x?: number;\n  y?: number;\n  zoomFactor?: number;\n}\n","import { WindowState } from \"../../../models/domain/window-state\";\nimport { ThemeType } from \"../../enums\";\n\nexport class GlobalState {\n  enableAlwaysOnTop?: boolean;\n  installedVersion?: string;\n  locale?: string;\n  organizationInvitation?: any;\n  rememberedEmail?: string;\n  theme?: ThemeType = ThemeType.System;\n  window?: WindowState = new WindowState();\n  twoFactorToken?: string;\n  disableFavicon?: boolean;\n  biometricFingerprintValidated?: boolean;\n  vaultTimeout?: number;\n  vaultTimeoutAction?: string;\n  loginRedirect?: any;\n  mainWindowSize?: number;\n  enableTray?: boolean;\n  enableMinimizeToTray?: boolean;\n  enableCloseToTray?: boolean;\n  enableStartToTray?: boolean;\n  openAtLogin?: boolean;\n  alwaysShowDock?: boolean;\n  enableBrowserIntegration?: boolean;\n  enableBrowserIntegrationFingerprint?: boolean;\n  enableDuckDuckGoBrowserIntegration?: boolean;\n  neverDomains?: { [id: string]: unknown };\n  disableAddLoginNotification?: boolean;\n  disableChangedPasswordNotification?: boolean;\n  disableContextMenuItem?: boolean;\n  deepLinkRedirectUrl?: string;\n}\n","import { AppIdService as AppIdServiceAbstraction } from \"../abstractions/app-id.service\";\nimport { AbstractStorageService } from \"../abstractions/storage.service\";\nimport { HtmlStorageLocation } from \"../enums\";\nimport { Utils } from \"../misc/utils\";\n\nexport class AppIdService implements AppIdServiceAbstraction {\n  constructor(private storageService: AbstractStorageService) {}\n\n  getAppId(): Promise<string> {\n    return this.makeAndGetAppId(\"appId\");\n  }\n\n  getAnonymousAppId(): Promise<string> {\n    return this.makeAndGetAppId(\"anonymousAppId\");\n  }\n\n  private async makeAndGetAppId(key: string) {\n    const existingId = await this.storageService.get<string>(key, {\n      htmlStorageLocation: HtmlStorageLocation.Local,\n    });\n    if (existingId != null) {\n      return existingId;\n    }\n\n    const guid = Utils.newGuid();\n    await this.storageService.save(key, guid, {\n      htmlStorageLocation: HtmlStorageLocation.Local,\n    });\n    return guid;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { Region } from \"../../abstractions/environment.service\";\n\nexport class ServerConfigResponse extends BaseResponse {\n  version: string;\n  gitHash: string;\n  server: ThirdPartyServerConfigResponse;\n  environment: EnvironmentServerConfigResponse;\n  featureStates: { [key: string]: string } = {};\n\n  constructor(response: any) {\n    super(response);\n\n    if (response == null) {\n      return;\n    }\n\n    this.version = this.getResponseProperty(\"Version\");\n    this.gitHash = this.getResponseProperty(\"GitHash\");\n    this.server = new ThirdPartyServerConfigResponse(this.getResponseProperty(\"Server\"));\n    this.environment = new EnvironmentServerConfigResponse(this.getResponseProperty(\"Environment\"));\n    this.featureStates = this.getResponseProperty(\"FeatureStates\");\n  }\n}\n\nexport class EnvironmentServerConfigResponse extends BaseResponse {\n  cloudRegion: Region;\n  vault: string;\n  api: string;\n  identity: string;\n  notifications: string;\n  sso: string;\n\n  constructor(data: any = null) {\n    super(data);\n\n    if (data == null) {\n      return;\n    }\n\n    this.cloudRegion = this.getResponseProperty(\"CloudRegion\");\n    this.vault = this.getResponseProperty(\"Vault\");\n    this.api = this.getResponseProperty(\"Api\");\n    this.identity = this.getResponseProperty(\"Identity\");\n    this.notifications = this.getResponseProperty(\"Notifications\");\n    this.sso = this.getResponseProperty(\"Sso\");\n  }\n}\n\nexport class ThirdPartyServerConfigResponse extends BaseResponse {\n  name: string;\n  url: string;\n\n  constructor(data: any = null) {\n    super(data);\n\n    if (data == null) {\n      return;\n    }\n\n    this.name = this.getResponseProperty(\"Name\");\n    this.url = this.getResponseProperty(\"Url\");\n  }\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { AuthService } from \"../../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../../auth/enums/authentication-status\";\nimport { ConfigApiServiceAbstraction } from \"../../abstractions/config/config-api.service.abstraction\";\nimport { ServerConfigResponse } from \"../../models/response/server-config.response\";\n\nexport class ConfigApiService implements ConfigApiServiceAbstraction {\n  constructor(\n    private apiService: ApiService,\n    private authService: AuthService,\n  ) {}\n\n  async get(): Promise<ServerConfigResponse> {\n    const authed: boolean =\n      (await this.authService.getAuthStatus()) !== AuthenticationStatus.LoggedOut;\n\n    const r = await this.apiService.send(\"GET\", \"/config\", null, authed, true);\n    return new ServerConfigResponse(r);\n  }\n}\n","import { LogService as LogServiceAbstraction } from \"../abstractions/log.service\";\nimport { LogLevelType } from \"../enums/log-level-type.enum\";\n\nexport class ConsoleLogService implements LogServiceAbstraction {\n  protected timersMap: Map<string, [number, number]> = new Map();\n\n  constructor(\n    protected isDev: boolean,\n    protected filter: (level: LogLevelType) => boolean = null,\n  ) {}\n\n  debug(message: string) {\n    if (!this.isDev) {\n      return;\n    }\n    this.write(LogLevelType.Debug, message);\n  }\n\n  info(message: string) {\n    this.write(LogLevelType.Info, message);\n  }\n\n  warning(message: string) {\n    this.write(LogLevelType.Warning, message);\n  }\n\n  error(message: string) {\n    this.write(LogLevelType.Error, message);\n  }\n\n  write(level: LogLevelType, message: string) {\n    if (this.filter != null && this.filter(level)) {\n      return;\n    }\n\n    switch (level) {\n      case LogLevelType.Debug:\n        // eslint-disable-next-line\n        console.log(message);\n        break;\n      case LogLevelType.Info:\n        // eslint-disable-next-line\n        console.log(message);\n        break;\n      case LogLevelType.Warning:\n        // eslint-disable-next-line\n        console.warn(message);\n        break;\n      case LogLevelType.Error:\n        // eslint-disable-next-line\n        console.error(message);\n        break;\n      default:\n        break;\n    }\n  }\n}\n","import { CryptoService } from \"../abstractions/crypto.service\";\nimport { EncryptService } from \"../abstractions/encrypt.service\";\n\nexport class ContainerService {\n  constructor(\n    private cryptoService: CryptoService,\n    private encryptService: EncryptService,\n  ) {}\n\n  attachToGlobal(global: any) {\n    if (!global.bitwardenContainerService) {\n      global.bitwardenContainerService = this;\n    }\n  }\n\n  /**\n   * @throws Will throw if CryptoService was not instantiated and provided to the ContainerService constructor\n   */\n  getCryptoService(): CryptoService {\n    if (this.cryptoService == null) {\n      throw new Error(\"ContainerService.cryptoService not initialized.\");\n    }\n    return this.cryptoService;\n  }\n\n  /**\n   * @throws Will throw if EncryptService was not instantiated and provided to the ContainerService constructor\n   */\n  getEncryptService(): EncryptService {\n    if (this.encryptService == null) {\n      throw new Error(\"ContainerService.encryptService not initialized.\");\n    }\n    return this.encryptService;\n  }\n}\n","import { Utils } from \"../../../platform/misc/utils\";\nimport { EncryptionType } from \"../../enums\";\nimport { Encrypted } from \"../../interfaces/encrypted\";\n\nconst ENC_TYPE_LENGTH = 1;\nconst IV_LENGTH = 16;\nconst MAC_LENGTH = 32;\nconst MIN_DATA_LENGTH = 1;\n\nexport class EncArrayBuffer implements Encrypted {\n  readonly encryptionType: EncryptionType = null;\n  readonly dataBytes: Uint8Array = null;\n  readonly ivBytes: Uint8Array = null;\n  readonly macBytes: Uint8Array = null;\n\n  constructor(readonly buffer: Uint8Array) {\n    const encBytes = buffer;\n    const encType = encBytes[0];\n\n    switch (encType) {\n      case EncryptionType.AesCbc128_HmacSha256_B64:\n      case EncryptionType.AesCbc256_HmacSha256_B64: {\n        const minimumLength = ENC_TYPE_LENGTH + IV_LENGTH + MAC_LENGTH + MIN_DATA_LENGTH;\n        if (encBytes.length < minimumLength) {\n          this.throwDecryptionError();\n        }\n\n        this.ivBytes = encBytes.slice(ENC_TYPE_LENGTH, ENC_TYPE_LENGTH + IV_LENGTH);\n        this.macBytes = encBytes.slice(\n          ENC_TYPE_LENGTH + IV_LENGTH,\n          ENC_TYPE_LENGTH + IV_LENGTH + MAC_LENGTH,\n        );\n        this.dataBytes = encBytes.slice(ENC_TYPE_LENGTH + IV_LENGTH + MAC_LENGTH);\n        break;\n      }\n      case EncryptionType.AesCbc256_B64: {\n        const minimumLength = ENC_TYPE_LENGTH + IV_LENGTH + MIN_DATA_LENGTH;\n        if (encBytes.length < minimumLength) {\n          this.throwDecryptionError();\n        }\n\n        this.ivBytes = encBytes.slice(ENC_TYPE_LENGTH, ENC_TYPE_LENGTH + IV_LENGTH);\n        this.dataBytes = encBytes.slice(ENC_TYPE_LENGTH + IV_LENGTH);\n        break;\n      }\n      default:\n        this.throwDecryptionError();\n    }\n\n    this.encryptionType = encType;\n  }\n\n  private throwDecryptionError() {\n    throw new Error(\n      \"Error parsing encrypted ArrayBuffer: data is corrupted or has an invalid format.\",\n    );\n  }\n\n  static async fromResponse(response: {\n    arrayBuffer: () => Promise<ArrayBuffer>;\n  }): Promise<EncArrayBuffer> {\n    const buffer = await response.arrayBuffer();\n    if (buffer == null) {\n      throw new Error(\"Cannot create EncArrayBuffer from Response - Response is empty\");\n    }\n    return new EncArrayBuffer(new Uint8Array(buffer));\n  }\n\n  static fromB64(b64: string) {\n    const buffer = Utils.fromB64ToArray(b64);\n    return new EncArrayBuffer(buffer);\n  }\n}\n","import { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\n\nexport class EncryptedObject {\n  iv: Uint8Array;\n  data: Uint8Array;\n  mac: Uint8Array;\n  key: SymmetricCryptoKey;\n}\n","import { Utils } from \"../../../platform/misc/utils\";\nimport { CryptoFunctionService } from \"../../abstractions/crypto-function.service\";\nimport { EncryptService } from \"../../abstractions/encrypt.service\";\nimport { LogService } from \"../../abstractions/log.service\";\nimport { EncryptionType } from \"../../enums\";\nimport { Decryptable } from \"../../interfaces/decryptable.interface\";\nimport { Encrypted } from \"../../interfaces/encrypted\";\nimport { InitializerMetadata } from \"../../interfaces/initializer-metadata.interface\";\nimport { EncArrayBuffer } from \"../../models/domain/enc-array-buffer\";\nimport { EncString } from \"../../models/domain/enc-string\";\nimport { EncryptedObject } from \"../../models/domain/encrypted-object\";\nimport { SymmetricCryptoKey } from \"../../models/domain/symmetric-crypto-key\";\n\nexport class EncryptServiceImplementation implements EncryptService {\n  constructor(\n    protected cryptoFunctionService: CryptoFunctionService,\n    protected logService: LogService,\n    protected logMacFailures: boolean,\n  ) {}\n\n  async encrypt(plainValue: string | Uint8Array, key: SymmetricCryptoKey): Promise<EncString> {\n    if (key == null) {\n      throw new Error(\"No encryption key provided.\");\n    }\n\n    if (plainValue == null) {\n      return Promise.resolve(null);\n    }\n\n    let plainBuf: Uint8Array;\n    if (typeof plainValue === \"string\") {\n      plainBuf = Utils.fromUtf8ToArray(plainValue);\n    } else {\n      plainBuf = plainValue;\n    }\n\n    const encObj = await this.aesEncrypt(plainBuf, key);\n    const iv = Utils.fromBufferToB64(encObj.iv);\n    const data = Utils.fromBufferToB64(encObj.data);\n    const mac = encObj.mac != null ? Utils.fromBufferToB64(encObj.mac) : null;\n    return new EncString(encObj.key.encType, data, iv, mac);\n  }\n\n  async encryptToBytes(plainValue: Uint8Array, key: SymmetricCryptoKey): Promise<EncArrayBuffer> {\n    if (key == null) {\n      throw new Error(\"No encryption key provided.\");\n    }\n\n    const encValue = await this.aesEncrypt(plainValue, key);\n    let macLen = 0;\n    if (encValue.mac != null) {\n      macLen = encValue.mac.byteLength;\n    }\n\n    const encBytes = new Uint8Array(1 + encValue.iv.byteLength + macLen + encValue.data.byteLength);\n    encBytes.set([encValue.key.encType]);\n    encBytes.set(new Uint8Array(encValue.iv), 1);\n    if (encValue.mac != null) {\n      encBytes.set(new Uint8Array(encValue.mac), 1 + encValue.iv.byteLength);\n    }\n\n    encBytes.set(new Uint8Array(encValue.data), 1 + encValue.iv.byteLength + macLen);\n    return new EncArrayBuffer(encBytes);\n  }\n\n  async decryptToUtf8(encString: EncString, key: SymmetricCryptoKey): Promise<string> {\n    if (key == null) {\n      throw new Error(\"No key provided for decryption.\");\n    }\n\n    key = this.resolveLegacyKey(key, encString);\n\n    if (key.macKey != null && encString?.mac == null) {\n      this.logService.error(\"mac required.\");\n      return null;\n    }\n\n    if (key.encType !== encString.encryptionType) {\n      this.logService.error(\"encType unavailable.\");\n      return null;\n    }\n\n    const fastParams = this.cryptoFunctionService.aesDecryptFastParameters(\n      encString.data,\n      encString.iv,\n      encString.mac,\n      key,\n    );\n    if (fastParams.macKey != null && fastParams.mac != null) {\n      const computedMac = await this.cryptoFunctionService.hmacFast(\n        fastParams.macData,\n        fastParams.macKey,\n        \"sha256\",\n      );\n      const macsEqual = await this.cryptoFunctionService.compareFast(fastParams.mac, computedMac);\n      if (!macsEqual) {\n        this.logMacFailed(\"mac failed.\");\n        return null;\n      }\n    }\n\n    return await this.cryptoFunctionService.aesDecryptFast(fastParams, \"cbc\");\n  }\n\n  async decryptToBytes(encThing: Encrypted, key: SymmetricCryptoKey): Promise<Uint8Array> {\n    if (key == null) {\n      throw new Error(\"No encryption key provided.\");\n    }\n\n    if (encThing == null) {\n      throw new Error(\"Nothing provided for decryption.\");\n    }\n\n    key = this.resolveLegacyKey(key, encThing);\n\n    if (key.macKey != null && encThing.macBytes == null) {\n      return null;\n    }\n\n    if (key.encType !== encThing.encryptionType) {\n      return null;\n    }\n\n    if (key.macKey != null && encThing.macBytes != null) {\n      const macData = new Uint8Array(encThing.ivBytes.byteLength + encThing.dataBytes.byteLength);\n      macData.set(new Uint8Array(encThing.ivBytes), 0);\n      macData.set(new Uint8Array(encThing.dataBytes), encThing.ivBytes.byteLength);\n      const computedMac = await this.cryptoFunctionService.hmac(macData, key.macKey, \"sha256\");\n      if (computedMac === null) {\n        return null;\n      }\n\n      const macsMatch = await this.cryptoFunctionService.compare(encThing.macBytes, computedMac);\n      if (!macsMatch) {\n        this.logMacFailed(\"mac failed.\");\n        return null;\n      }\n    }\n\n    const result = await this.cryptoFunctionService.aesDecrypt(\n      encThing.dataBytes,\n      encThing.ivBytes,\n      key.encKey,\n      \"cbc\",\n    );\n\n    return result ?? null;\n  }\n\n  async rsaEncrypt(data: Uint8Array, publicKey: Uint8Array): Promise<EncString> {\n    if (data == null) {\n      throw new Error(\"No data provided for encryption.\");\n    }\n\n    if (publicKey == null) {\n      throw new Error(\"No public key provided for encryption.\");\n    }\n    const encrypted = await this.cryptoFunctionService.rsaEncrypt(data, publicKey, \"sha1\");\n    return new EncString(EncryptionType.Rsa2048_OaepSha1_B64, Utils.fromBufferToB64(encrypted));\n  }\n\n  async rsaDecrypt(data: EncString, privateKey: Uint8Array): Promise<Uint8Array> {\n    if (data == null) {\n      throw new Error(\"No data provided for decryption.\");\n    }\n\n    let algorithm: \"sha1\" | \"sha256\";\n    switch (data.encryptionType) {\n      case EncryptionType.Rsa2048_OaepSha1_B64:\n      case EncryptionType.Rsa2048_OaepSha1_HmacSha256_B64:\n        algorithm = \"sha1\";\n        break;\n      case EncryptionType.Rsa2048_OaepSha256_B64:\n      case EncryptionType.Rsa2048_OaepSha256_HmacSha256_B64:\n        algorithm = \"sha256\";\n        break;\n      default:\n        throw new Error(\"Invalid encryption type.\");\n    }\n\n    if (privateKey == null) {\n      throw new Error(\"No private key provided for decryption.\");\n    }\n\n    return this.cryptoFunctionService.rsaDecrypt(data.dataBytes, privateKey, algorithm);\n  }\n\n  async decryptItems<T extends InitializerMetadata>(\n    items: Decryptable<T>[],\n    key: SymmetricCryptoKey,\n  ): Promise<T[]> {\n    if (items == null || items.length < 1) {\n      return [];\n    }\n\n    // don't use promise.all because this task is not io bound\n    const results = [];\n    for (let i = 0; i < items.length; i++) {\n      results.push(await items[i].decrypt(key));\n    }\n    return results;\n  }\n\n  async hash(value: string | Uint8Array, algorithm: \"sha1\" | \"sha256\" | \"sha512\"): Promise<string> {\n    const hashArray = await this.cryptoFunctionService.hash(value, algorithm);\n    return Utils.fromBufferToB64(hashArray);\n  }\n\n  private async aesEncrypt(data: Uint8Array, key: SymmetricCryptoKey): Promise<EncryptedObject> {\n    const obj = new EncryptedObject();\n    obj.key = key;\n    obj.iv = await this.cryptoFunctionService.randomBytes(16);\n    obj.data = await this.cryptoFunctionService.aesEncrypt(data, obj.iv, obj.key.encKey);\n\n    if (obj.key.macKey != null) {\n      const macData = new Uint8Array(obj.iv.byteLength + obj.data.byteLength);\n      macData.set(new Uint8Array(obj.iv), 0);\n      macData.set(new Uint8Array(obj.data), obj.iv.byteLength);\n      obj.mac = await this.cryptoFunctionService.hmac(macData, obj.key.macKey, \"sha256\");\n    }\n\n    return obj;\n  }\n\n  private logMacFailed(msg: string) {\n    if (this.logMacFailures) {\n      this.logService.error(msg);\n    }\n  }\n\n  /**\n   * Transform into new key for the old encrypt-then-mac scheme if required, otherwise return the current key unchanged\n   * @param encThing The encrypted object (e.g. encString or encArrayBuffer) that you want to decrypt\n   */\n  resolveLegacyKey(key: SymmetricCryptoKey, encThing: Encrypted): SymmetricCryptoKey {\n    if (\n      encThing.encryptionType === EncryptionType.AesCbc128_HmacSha256_B64 &&\n      key.encType === EncryptionType.AesCbc256_B64\n    ) {\n      return new SymmetricCryptoKey(key.key, EncryptionType.AesCbc128_HmacSha256_B64);\n    }\n\n    return key;\n  }\n}\n","import { AttachmentResponse } from \"../response/attachment.response\";\n\nexport class AttachmentData {\n  id: string;\n  url: string;\n  fileName: string;\n  key: string;\n  size: string;\n  sizeName: string;\n\n  constructor(response?: AttachmentResponse) {\n    if (response == null) {\n      return;\n    }\n    this.id = response.id;\n    this.url = response.url;\n    this.fileName = response.fileName;\n    this.key = response.key;\n    this.size = response.size;\n    this.sizeName = response.sizeName;\n  }\n}\n","import { CardApi } from \"../api/card.api\";\n\nexport class CardData {\n  cardholderName: string;\n  brand: string;\n  number: string;\n  expMonth: string;\n  expYear: string;\n  code: string;\n\n  constructor(data?: CardApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.cardholderName = data.cardholderName;\n    this.brand = data.brand;\n    this.number = data.number;\n    this.expMonth = data.expMonth;\n    this.expYear = data.expYear;\n    this.code = data.code;\n  }\n}\n","import { FieldType, LinkedIdType } from \"../../enums\";\nimport { FieldApi } from \"../api/field.api\";\n\nexport class FieldData {\n  type: FieldType;\n  name: string;\n  value: string;\n  linkedId: LinkedIdType;\n\n  constructor(response?: FieldApi) {\n    if (response == null) {\n      return;\n    }\n    this.type = response.type;\n    this.name = response.name;\n    this.value = response.value;\n    this.linkedId = response.linkedId;\n  }\n}\n","import { IdentityApi } from \"../api/identity.api\";\n\nexport class IdentityData {\n  title: string;\n  firstName: string;\n  middleName: string;\n  lastName: string;\n  address1: string;\n  address2: string;\n  address3: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n  company: string;\n  email: string;\n  phone: string;\n  ssn: string;\n  username: string;\n  passportNumber: string;\n  licenseNumber: string;\n\n  constructor(data?: IdentityApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.title = data.title;\n    this.firstName = data.firstName;\n    this.middleName = data.middleName;\n    this.lastName = data.lastName;\n    this.address1 = data.address1;\n    this.address2 = data.address2;\n    this.address3 = data.address3;\n    this.city = data.city;\n    this.state = data.state;\n    this.postalCode = data.postalCode;\n    this.country = data.country;\n    this.company = data.company;\n    this.email = data.email;\n    this.phone = data.phone;\n    this.ssn = data.ssn;\n    this.username = data.username;\n    this.passportNumber = data.passportNumber;\n    this.licenseNumber = data.licenseNumber;\n  }\n}\n","import { Fido2CredentialApi } from \"../api/fido2-credential.api\";\n\nexport class Fido2CredentialData {\n  credentialId: string;\n  keyType: \"public-key\";\n  keyAlgorithm: \"ECDSA\";\n  keyCurve: \"P-256\";\n  keyValue: string;\n  rpId: string;\n  userHandle: string;\n  userName: string;\n  counter: string;\n  rpName: string;\n  userDisplayName: string;\n  discoverable: string;\n  creationDate: string;\n\n  constructor(data?: Fido2CredentialApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.credentialId = data.credentialId;\n    this.keyType = data.keyType;\n    this.keyAlgorithm = data.keyAlgorithm;\n    this.keyCurve = data.keyCurve;\n    this.keyValue = data.keyValue;\n    this.rpId = data.rpId;\n    this.userHandle = data.userHandle;\n    this.userName = data.userName;\n    this.counter = data.counter;\n    this.rpName = data.rpName;\n    this.userDisplayName = data.userDisplayName;\n    this.discoverable = data.discoverable;\n    this.creationDate = data.creationDate;\n  }\n}\n","import { UriMatchType } from \"../../enums\";\nimport { LoginUriApi } from \"../api/login-uri.api\";\n\nexport class LoginUriData {\n  uri: string;\n  uriChecksum: string;\n  match: UriMatchType = null;\n\n  constructor(data?: LoginUriApi) {\n    if (data == null) {\n      return;\n    }\n    this.uri = data.uri;\n    this.uriChecksum = data.uriChecksum;\n    this.match = data.match;\n  }\n}\n","import { LoginApi } from \"../api/login.api\";\n\nimport { Fido2CredentialData } from \"./fido2-credential.data\";\nimport { LoginUriData } from \"./login-uri.data\";\n\nexport class LoginData {\n  uris: LoginUriData[];\n  username: string;\n  password: string;\n  passwordRevisionDate: string;\n  totp: string;\n  autofillOnPageLoad: boolean;\n  fido2Credentials?: Fido2CredentialData[];\n\n  constructor(data?: LoginApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.username = data.username;\n    this.password = data.password;\n    this.passwordRevisionDate = data.passwordRevisionDate;\n    this.totp = data.totp;\n    this.autofillOnPageLoad = data.autofillOnPageLoad;\n\n    if (data.uris) {\n      this.uris = data.uris.map((u) => new LoginUriData(u));\n    }\n\n    if (data.fido2Credentials) {\n      this.fido2Credentials = data.fido2Credentials?.map((key) => new Fido2CredentialData(key));\n    }\n  }\n}\n","import { PasswordHistoryResponse } from \"../response/password-history.response\";\n\nexport class PasswordHistoryData {\n  password: string;\n  lastUsedDate: string;\n\n  constructor(response?: PasswordHistoryResponse) {\n    if (response == null) {\n      return;\n    }\n\n    this.password = response.password;\n    this.lastUsedDate = response.lastUsedDate;\n  }\n}\n","import { SecureNoteType } from \"../../enums\";\nimport { SecureNoteApi } from \"../api/secure-note.api\";\n\nexport class SecureNoteData {\n  type: SecureNoteType;\n\n  constructor(data?: SecureNoteApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.type = data.type;\n  }\n}\n","import { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../enums/cipher-type\";\nimport { CipherResponse } from \"../response/cipher.response\";\n\nimport { AttachmentData } from \"./attachment.data\";\nimport { CardData } from \"./card.data\";\nimport { FieldData } from \"./field.data\";\nimport { IdentityData } from \"./identity.data\";\nimport { LoginData } from \"./login.data\";\nimport { PasswordHistoryData } from \"./password-history.data\";\nimport { SecureNoteData } from \"./secure-note.data\";\n\nexport class CipherData {\n  id: string;\n  organizationId: string;\n  folderId: string;\n  edit: boolean;\n  viewPassword: boolean;\n  organizationUseTotp: boolean;\n  favorite: boolean;\n  revisionDate: string;\n  type: CipherType;\n  name: string;\n  notes: string;\n  login?: LoginData;\n  secureNote?: SecureNoteData;\n  card?: CardData;\n  identity?: IdentityData;\n  fields?: FieldData[];\n  attachments?: AttachmentData[];\n  passwordHistory?: PasswordHistoryData[];\n  collectionIds?: string[];\n  creationDate: string;\n  deletedDate: string;\n  reprompt: CipherRepromptType;\n  key: string;\n\n  constructor(response?: CipherResponse, collectionIds?: string[]) {\n    if (response == null) {\n      return;\n    }\n\n    this.id = response.id;\n    this.organizationId = response.organizationId;\n    this.folderId = response.folderId;\n    this.edit = response.edit;\n    this.viewPassword = response.viewPassword;\n    this.organizationUseTotp = response.organizationUseTotp;\n    this.favorite = response.favorite;\n    this.revisionDate = response.revisionDate;\n    this.type = response.type;\n    this.name = response.name;\n    this.notes = response.notes;\n    this.collectionIds = collectionIds != null ? collectionIds : response.collectionIds;\n    this.creationDate = response.creationDate;\n    this.deletedDate = response.deletedDate;\n    this.reprompt = response.reprompt;\n    this.key = response.key;\n\n    switch (this.type) {\n      case CipherType.Login:\n        this.login = new LoginData(response.login);\n        break;\n      case CipherType.SecureNote:\n        this.secureNote = new SecureNoteData(response.secureNote);\n        break;\n      case CipherType.Card:\n        this.card = new CardData(response.card);\n        break;\n      case CipherType.Identity:\n        this.identity = new IdentityData(response.identity);\n        break;\n      default:\n        break;\n    }\n\n    if (response.fields != null) {\n      this.fields = response.fields.map((f) => new FieldData(f));\n    }\n    if (response.attachments != null) {\n      this.attachments = response.attachments.map((a) => new AttachmentData(a));\n    }\n    if (response.passwordHistory != null) {\n      this.passwordHistory = response.passwordHistory.map((ph) => new PasswordHistoryData(ph));\n    }\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { AttachmentData } from \"../data/attachment.data\";\nimport { AttachmentView } from \"../view/attachment.view\";\n\nexport class Attachment extends Domain {\n  id: string;\n  url: string;\n  size: string;\n  sizeName: string; // Readable size, ex: \"4.2 KB\" or \"1.43 GB\"\n  key: EncString;\n  fileName: EncString;\n\n  constructor(obj?: AttachmentData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.size = obj.size;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        url: null,\n        sizeName: null,\n        fileName: null,\n        key: null,\n      },\n      [\"id\", \"url\", \"sizeName\"],\n    );\n  }\n\n  async decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<AttachmentView> {\n    const view = await this.decryptObj(\n      new AttachmentView(this),\n      {\n        fileName: null,\n      },\n      orgId,\n      encKey,\n    );\n\n    if (this.key != null) {\n      view.key = await this.decryptAttachmentKey(orgId, encKey);\n    }\n\n    return view;\n  }\n\n  private async decryptAttachmentKey(orgId: string, encKey?: SymmetricCryptoKey) {\n    try {\n      if (encKey == null) {\n        encKey = await this.getKeyForDecryption(orgId);\n      }\n\n      const encryptService = Utils.getContainerService().getEncryptService();\n      const decValue = await encryptService.decryptToBytes(this.key, encKey);\n      return new SymmetricCryptoKey(decValue);\n    } catch (e) {\n      // TODO: error?\n    }\n  }\n\n  private async getKeyForDecryption(orgId: string) {\n    const cryptoService = Utils.getContainerService().getCryptoService();\n    return orgId != null\n      ? await cryptoService.getOrgKey(orgId)\n      : await cryptoService.getUserKeyWithLegacySupport();\n  }\n\n  toAttachmentData(): AttachmentData {\n    const a = new AttachmentData();\n    a.size = this.size;\n    this.buildDataModel(\n      this,\n      a,\n      {\n        id: null,\n        url: null,\n        sizeName: null,\n        fileName: null,\n        key: null,\n      },\n      [\"id\", \"url\", \"sizeName\"],\n    );\n    return a;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Attachment>>): Attachment {\n    if (obj == null) {\n      return null;\n    }\n\n    const key = EncString.fromJSON(obj.key);\n    const fileName = EncString.fromJSON(obj.fileName);\n\n    return Object.assign(new Attachment(), obj, {\n      key,\n      fileName,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { CardData } from \"../data/card.data\";\nimport { CardView } from \"../view/card.view\";\n\nexport class Card extends Domain {\n  cardholderName: EncString;\n  brand: EncString;\n  number: EncString;\n  expMonth: EncString;\n  expYear: EncString;\n  code: EncString;\n\n  constructor(obj?: CardData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        cardholderName: null,\n        brand: null,\n        number: null,\n        expMonth: null,\n        expYear: null,\n        code: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<CardView> {\n    return this.decryptObj(\n      new CardView(),\n      {\n        cardholderName: null,\n        brand: null,\n        number: null,\n        expMonth: null,\n        expYear: null,\n        code: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  toCardData(): CardData {\n    const c = new CardData();\n    this.buildDataModel(this, c, {\n      cardholderName: null,\n      brand: null,\n      number: null,\n      expMonth: null,\n      expYear: null,\n      code: null,\n    });\n    return c;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Card>>): Card {\n    if (obj == null) {\n      return null;\n    }\n\n    const cardholderName = EncString.fromJSON(obj.cardholderName);\n    const brand = EncString.fromJSON(obj.brand);\n    const number = EncString.fromJSON(obj.number);\n    const expMonth = EncString.fromJSON(obj.expMonth);\n    const expYear = EncString.fromJSON(obj.expYear);\n    const code = EncString.fromJSON(obj.code);\n    return Object.assign(new Card(), obj, {\n      cardholderName,\n      brand,\n      number,\n      expMonth,\n      expYear,\n      code,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { FieldType, LinkedIdType } from \"../../enums\";\nimport { FieldData } from \"../data/field.data\";\nimport { FieldView } from \"../view/field.view\";\n\nexport class Field extends Domain {\n  name: EncString;\n  value: EncString;\n  type: FieldType;\n  linkedId: LinkedIdType;\n\n  constructor(obj?: FieldData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.type = obj.type;\n    this.linkedId = obj.linkedId;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        name: null,\n        value: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<FieldView> {\n    return this.decryptObj(\n      new FieldView(this),\n      {\n        name: null,\n        value: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  toFieldData(): FieldData {\n    const f = new FieldData();\n    this.buildDataModel(\n      this,\n      f,\n      {\n        name: null,\n        value: null,\n        type: null,\n        linkedId: null,\n      },\n      [\"type\", \"linkedId\"],\n    );\n    return f;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Field>>): Field {\n    if (obj == null) {\n      return null;\n    }\n\n    const name = EncString.fromJSON(obj.name);\n    const value = EncString.fromJSON(obj.value);\n\n    return Object.assign(new Field(), obj, {\n      name,\n      value,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { IdentityData } from \"../data/identity.data\";\nimport { IdentityView } from \"../view/identity.view\";\n\nexport class Identity extends Domain {\n  title: EncString;\n  firstName: EncString;\n  middleName: EncString;\n  lastName: EncString;\n  address1: EncString;\n  address2: EncString;\n  address3: EncString;\n  city: EncString;\n  state: EncString;\n  postalCode: EncString;\n  country: EncString;\n  company: EncString;\n  email: EncString;\n  phone: EncString;\n  ssn: EncString;\n  username: EncString;\n  passportNumber: EncString;\n  licenseNumber: EncString;\n\n  constructor(obj?: IdentityData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        title: null,\n        firstName: null,\n        middleName: null,\n        lastName: null,\n        address1: null,\n        address2: null,\n        address3: null,\n        city: null,\n        state: null,\n        postalCode: null,\n        country: null,\n        company: null,\n        email: null,\n        phone: null,\n        ssn: null,\n        username: null,\n        passportNumber: null,\n        licenseNumber: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<IdentityView> {\n    return this.decryptObj(\n      new IdentityView(),\n      {\n        title: null,\n        firstName: null,\n        middleName: null,\n        lastName: null,\n        address1: null,\n        address2: null,\n        address3: null,\n        city: null,\n        state: null,\n        postalCode: null,\n        country: null,\n        company: null,\n        email: null,\n        phone: null,\n        ssn: null,\n        username: null,\n        passportNumber: null,\n        licenseNumber: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  toIdentityData(): IdentityData {\n    const i = new IdentityData();\n    this.buildDataModel(this, i, {\n      title: null,\n      firstName: null,\n      middleName: null,\n      lastName: null,\n      address1: null,\n      address2: null,\n      address3: null,\n      city: null,\n      state: null,\n      postalCode: null,\n      country: null,\n      company: null,\n      email: null,\n      phone: null,\n      ssn: null,\n      username: null,\n      passportNumber: null,\n      licenseNumber: null,\n    });\n    return i;\n  }\n\n  static fromJSON(obj: Jsonify<Identity>): Identity {\n    if (obj == null) {\n      return null;\n    }\n\n    const title = EncString.fromJSON(obj.title);\n    const firstName = EncString.fromJSON(obj.firstName);\n    const middleName = EncString.fromJSON(obj.middleName);\n    const lastName = EncString.fromJSON(obj.lastName);\n    const address1 = EncString.fromJSON(obj.address1);\n    const address2 = EncString.fromJSON(obj.address2);\n    const address3 = EncString.fromJSON(obj.address3);\n    const city = EncString.fromJSON(obj.city);\n    const state = EncString.fromJSON(obj.state);\n    const postalCode = EncString.fromJSON(obj.postalCode);\n    const country = EncString.fromJSON(obj.country);\n    const company = EncString.fromJSON(obj.company);\n    const email = EncString.fromJSON(obj.email);\n    const phone = EncString.fromJSON(obj.phone);\n    const ssn = EncString.fromJSON(obj.ssn);\n    const username = EncString.fromJSON(obj.username);\n    const passportNumber = EncString.fromJSON(obj.passportNumber);\n    const licenseNumber = EncString.fromJSON(obj.licenseNumber);\n\n    return Object.assign(new Identity(), obj, {\n      title,\n      firstName,\n      middleName,\n      lastName,\n      address1,\n      address2,\n      address3,\n      city,\n      state,\n      postalCode,\n      country,\n      company,\n      email,\n      phone,\n      ssn,\n      username,\n      passportNumber,\n      licenseNumber,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { Fido2CredentialData } from \"../data/fido2-credential.data\";\nimport { Fido2CredentialView } from \"../view/fido2-credential.view\";\n\nexport class Fido2Credential extends Domain {\n  credentialId: EncString | null = null;\n  keyType: EncString;\n  keyAlgorithm: EncString;\n  keyCurve: EncString;\n  keyValue: EncString;\n  rpId: EncString;\n  userHandle: EncString;\n  userName: EncString;\n  counter: EncString;\n  rpName: EncString;\n  userDisplayName: EncString;\n  discoverable: EncString;\n  creationDate: Date;\n\n  constructor(obj?: Fido2CredentialData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        credentialId: null,\n        keyType: null,\n        keyAlgorithm: null,\n        keyCurve: null,\n        keyValue: null,\n        rpId: null,\n        userHandle: null,\n        userName: null,\n        counter: null,\n        rpName: null,\n        userDisplayName: null,\n        discoverable: null,\n      },\n      [],\n    );\n    this.creationDate = obj.creationDate != null ? new Date(obj.creationDate) : null;\n  }\n\n  async decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<Fido2CredentialView> {\n    const view = await this.decryptObj(\n      new Fido2CredentialView(),\n      {\n        credentialId: null,\n        keyType: null,\n        keyAlgorithm: null,\n        keyCurve: null,\n        keyValue: null,\n        rpId: null,\n        userHandle: null,\n        userName: null,\n        rpName: null,\n        userDisplayName: null,\n        discoverable: null,\n      },\n      orgId,\n      encKey,\n    );\n\n    const { counter } = await this.decryptObj(\n      { counter: \"\" },\n      {\n        counter: null,\n      },\n      orgId,\n      encKey,\n    );\n    // Counter will end up as NaN if this fails\n    view.counter = parseInt(counter);\n\n    const { discoverable } = await this.decryptObj(\n      { discoverable: \"\" },\n      {\n        discoverable: null,\n      },\n      orgId,\n      encKey,\n    );\n    view.discoverable = discoverable === \"true\";\n    view.creationDate = this.creationDate;\n\n    return view;\n  }\n\n  toFido2CredentialData(): Fido2CredentialData {\n    const i = new Fido2CredentialData();\n    i.creationDate = this.creationDate.toISOString();\n    this.buildDataModel(this, i, {\n      credentialId: null,\n      keyType: null,\n      keyAlgorithm: null,\n      keyCurve: null,\n      keyValue: null,\n      rpId: null,\n      userHandle: null,\n      userName: null,\n      counter: null,\n      rpName: null,\n      userDisplayName: null,\n      discoverable: null,\n    });\n    return i;\n  }\n\n  static fromJSON(obj: Jsonify<Fido2Credential>): Fido2Credential {\n    if (obj == null) {\n      return null;\n    }\n\n    const credentialId = EncString.fromJSON(obj.credentialId);\n    const keyType = EncString.fromJSON(obj.keyType);\n    const keyAlgorithm = EncString.fromJSON(obj.keyAlgorithm);\n    const keyCurve = EncString.fromJSON(obj.keyCurve);\n    const keyValue = EncString.fromJSON(obj.keyValue);\n    const rpId = EncString.fromJSON(obj.rpId);\n    const userHandle = EncString.fromJSON(obj.userHandle);\n    const userName = EncString.fromJSON(obj.userName);\n    const counter = EncString.fromJSON(obj.counter);\n    const rpName = EncString.fromJSON(obj.rpName);\n    const userDisplayName = EncString.fromJSON(obj.userDisplayName);\n    const discoverable = EncString.fromJSON(obj.discoverable);\n    const creationDate = obj.creationDate != null ? new Date(obj.creationDate) : null;\n\n    return Object.assign(new Fido2Credential(), obj, {\n      credentialId,\n      keyType,\n      keyAlgorithm,\n      keyCurve,\n      keyValue,\n      rpId,\n      userHandle,\n      userName,\n      counter,\n      rpName,\n      userDisplayName,\n      discoverable,\n      creationDate,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { UriMatchType } from \"../../enums\";\nimport { LoginUriData } from \"../data/login-uri.data\";\nimport { LoginUriView } from \"../view/login-uri.view\";\n\nexport class LoginUri extends Domain {\n  uri: EncString;\n  uriChecksum: EncString | undefined;\n  match: UriMatchType;\n\n  constructor(obj?: LoginUriData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.match = obj.match;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        uri: null,\n        uriChecksum: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<LoginUriView> {\n    return this.decryptObj(\n      new LoginUriView(this),\n      {\n        uri: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  async validateChecksum(clearTextUri: string, orgId: string, encKey: SymmetricCryptoKey) {\n    if (this.uriChecksum == null) {\n      return false;\n    }\n\n    const cryptoService = Utils.getContainerService().getEncryptService();\n    const localChecksum = await cryptoService.hash(clearTextUri, \"sha256\");\n\n    const remoteChecksum = await this.uriChecksum.decrypt(orgId, encKey);\n    return remoteChecksum === localChecksum;\n  }\n\n  toLoginUriData(): LoginUriData {\n    const u = new LoginUriData();\n    this.buildDataModel(\n      this,\n      u,\n      {\n        uri: null,\n        uriChecksum: null,\n        match: null,\n      },\n      [\"match\"],\n    );\n    return u;\n  }\n\n  static fromJSON(obj: Jsonify<LoginUri>): LoginUri {\n    if (obj == null) {\n      return null;\n    }\n\n    const uri = EncString.fromJSON(obj.uri);\n    const uriChecksum = EncString.fromJSON(obj.uriChecksum);\n    return Object.assign(new LoginUri(), obj, {\n      uri,\n      uriChecksum,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { LoginData } from \"../data/login.data\";\nimport { LoginView } from \"../view/login.view\";\n\nimport { Fido2Credential } from \"./fido2-credential\";\nimport { LoginUri } from \"./login-uri\";\n\nexport class Login extends Domain {\n  uris: LoginUri[];\n  username: EncString;\n  password: EncString;\n  passwordRevisionDate?: Date;\n  totp: EncString;\n  autofillOnPageLoad: boolean;\n  fido2Credentials: Fido2Credential[];\n\n  constructor(obj?: LoginData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.passwordRevisionDate =\n      obj.passwordRevisionDate != null ? new Date(obj.passwordRevisionDate) : null;\n    this.autofillOnPageLoad = obj.autofillOnPageLoad;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        username: null,\n        password: null,\n        totp: null,\n      },\n      [],\n    );\n\n    if (obj.uris) {\n      this.uris = [];\n      obj.uris.forEach((u) => {\n        this.uris.push(new LoginUri(u));\n      });\n    }\n\n    if (obj.fido2Credentials) {\n      this.fido2Credentials = obj.fido2Credentials.map((key) => new Fido2Credential(key));\n    }\n  }\n\n  async decrypt(\n    orgId: string,\n    bypassValidation: boolean,\n    encKey?: SymmetricCryptoKey,\n  ): Promise<LoginView> {\n    const view = await this.decryptObj(\n      new LoginView(this),\n      {\n        username: null,\n        password: null,\n        totp: null,\n      },\n      orgId,\n      encKey,\n    );\n\n    if (this.uris != null) {\n      view.uris = [];\n      for (let i = 0; i < this.uris.length; i++) {\n        const uri = await this.uris[i].decrypt(orgId, encKey);\n        // URIs are shared remotely after decryption\n        // we need to validate that the string hasn't been changed by a compromised server\n        // This validation is tied to the existence of cypher.key for backwards compatibility\n        // So we bypass the validation if there's no cipher.key or procceed with the validation and\n        // Skip the value if it's been tampered with.\n        if (bypassValidation || (await this.uris[i].validateChecksum(uri.uri, orgId, encKey))) {\n          view.uris.push(uri);\n        }\n      }\n    }\n\n    if (this.fido2Credentials != null) {\n      view.fido2Credentials = await Promise.all(\n        this.fido2Credentials.map((key) => key.decrypt(orgId, encKey)),\n      );\n    }\n\n    return view;\n  }\n\n  toLoginData(): LoginData {\n    const l = new LoginData();\n    l.passwordRevisionDate =\n      this.passwordRevisionDate != null ? this.passwordRevisionDate.toISOString() : null;\n    l.autofillOnPageLoad = this.autofillOnPageLoad;\n    this.buildDataModel(this, l, {\n      username: null,\n      password: null,\n      totp: null,\n    });\n\n    if (this.uris != null && this.uris.length > 0) {\n      l.uris = [];\n      this.uris.forEach((u) => {\n        l.uris.push(u.toLoginUriData());\n      });\n    }\n\n    if (this.fido2Credentials != null && this.fido2Credentials.length > 0) {\n      l.fido2Credentials = this.fido2Credentials.map((key) => key.toFido2CredentialData());\n    }\n\n    return l;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Login>>): Login {\n    if (obj == null) {\n      return null;\n    }\n\n    const username = EncString.fromJSON(obj.username);\n    const password = EncString.fromJSON(obj.password);\n    const totp = EncString.fromJSON(obj.totp);\n    const passwordRevisionDate =\n      obj.passwordRevisionDate == null ? null : new Date(obj.passwordRevisionDate);\n    const uris = obj.uris?.map((uri: any) => LoginUri.fromJSON(uri));\n    const fido2Credentials =\n      obj.fido2Credentials?.map((key) => Fido2Credential.fromJSON(key)) ?? [];\n\n    return Object.assign(new Login(), obj, {\n      username,\n      password,\n      totp,\n      passwordRevisionDate,\n      uris,\n      fido2Credentials,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { PasswordHistoryData } from \"../data/password-history.data\";\nimport { PasswordHistoryView } from \"../view/password-history.view\";\n\nexport class Password extends Domain {\n  password: EncString;\n  lastUsedDate: Date;\n\n  constructor(obj?: PasswordHistoryData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(this, obj, {\n      password: null,\n    });\n    this.lastUsedDate = new Date(obj.lastUsedDate);\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<PasswordHistoryView> {\n    return this.decryptObj(\n      new PasswordHistoryView(this),\n      {\n        password: null,\n      },\n      orgId,\n      encKey,\n    );\n  }\n\n  toPasswordHistoryData(): PasswordHistoryData {\n    const ph = new PasswordHistoryData();\n    ph.lastUsedDate = this.lastUsedDate.toISOString();\n    this.buildDataModel(this, ph, {\n      password: null,\n    });\n    return ph;\n  }\n\n  static fromJSON(obj: Partial<Jsonify<Password>>): Password {\n    if (obj == null) {\n      return null;\n    }\n\n    const password = EncString.fromJSON(obj.password);\n    const lastUsedDate = obj.lastUsedDate == null ? null : new Date(obj.lastUsedDate);\n\n    return Object.assign(new Password(), obj, {\n      password,\n      lastUsedDate,\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { SecureNoteType } from \"../../enums\";\nimport { SecureNoteData } from \"../data/secure-note.data\";\nimport { SecureNoteView } from \"../view/secure-note.view\";\n\nexport class SecureNote extends Domain {\n  type: SecureNoteType;\n\n  constructor(obj?: SecureNoteData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.type = obj.type;\n  }\n\n  decrypt(orgId: string, encKey?: SymmetricCryptoKey): Promise<SecureNoteView> {\n    return Promise.resolve(new SecureNoteView(this));\n  }\n\n  toSecureNoteData(): SecureNoteData {\n    const n = new SecureNoteData();\n    n.type = this.type;\n    return n;\n  }\n\n  static fromJSON(obj: Jsonify<SecureNote>): SecureNote {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new SecureNote(), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Decryptable } from \"../../../platform/interfaces/decryptable.interface\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { InitializerKey } from \"../../../platform/services/cryptography/initializer-key\";\nimport { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../enums/cipher-type\";\nimport { CipherData } from \"../data/cipher.data\";\nimport { LocalData } from \"../data/local.data\";\nimport { CipherView } from \"../view/cipher.view\";\n\nimport { Attachment } from \"./attachment\";\nimport { Card } from \"./card\";\nimport { Field } from \"./field\";\nimport { Identity } from \"./identity\";\nimport { Login } from \"./login\";\nimport { Password } from \"./password\";\nimport { SecureNote } from \"./secure-note\";\n\nexport class Cipher extends Domain implements Decryptable<CipherView> {\n  readonly initializerKey = InitializerKey.Cipher;\n\n  id: string;\n  organizationId: string;\n  folderId: string;\n  name: EncString;\n  notes: EncString;\n  type: CipherType;\n  favorite: boolean;\n  organizationUseTotp: boolean;\n  edit: boolean;\n  viewPassword: boolean;\n  revisionDate: Date;\n  localData: LocalData;\n  login: Login;\n  identity: Identity;\n  card: Card;\n  secureNote: SecureNote;\n  attachments: Attachment[];\n  fields: Field[];\n  passwordHistory: Password[];\n  collectionIds: string[];\n  creationDate: Date;\n  deletedDate: Date;\n  reprompt: CipherRepromptType;\n  key: EncString;\n\n  constructor(obj?: CipherData, localData: LocalData = null) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        organizationId: null,\n        folderId: null,\n        name: null,\n        notes: null,\n        key: null,\n      },\n      [\"id\", \"organizationId\", \"folderId\"],\n    );\n\n    this.type = obj.type;\n    this.favorite = obj.favorite;\n    this.organizationUseTotp = obj.organizationUseTotp;\n    this.edit = obj.edit;\n    if (obj.viewPassword != null) {\n      this.viewPassword = obj.viewPassword;\n    } else {\n      this.viewPassword = true; // Default for already synced Ciphers without viewPassword\n    }\n    this.revisionDate = obj.revisionDate != null ? new Date(obj.revisionDate) : null;\n    this.collectionIds = obj.collectionIds;\n    this.localData = localData;\n    this.creationDate = obj.creationDate != null ? new Date(obj.creationDate) : null;\n    this.deletedDate = obj.deletedDate != null ? new Date(obj.deletedDate) : null;\n    this.reprompt = obj.reprompt;\n\n    switch (this.type) {\n      case CipherType.Login:\n        this.login = new Login(obj.login);\n        break;\n      case CipherType.SecureNote:\n        this.secureNote = new SecureNote(obj.secureNote);\n        break;\n      case CipherType.Card:\n        this.card = new Card(obj.card);\n        break;\n      case CipherType.Identity:\n        this.identity = new Identity(obj.identity);\n        break;\n      default:\n        break;\n    }\n\n    if (obj.attachments != null) {\n      this.attachments = obj.attachments.map((a) => new Attachment(a));\n    } else {\n      this.attachments = null;\n    }\n\n    if (obj.fields != null) {\n      this.fields = obj.fields.map((f) => new Field(f));\n    } else {\n      this.fields = null;\n    }\n\n    if (obj.passwordHistory != null) {\n      this.passwordHistory = obj.passwordHistory.map((ph) => new Password(ph));\n    } else {\n      this.passwordHistory = null;\n    }\n  }\n\n  // We are passing the organizationId into the EncString.decrypt() method here, but because the encKey will always be\n  // present and so the organizationId will not be used.\n  // We will refactor the EncString.decrypt() in https://bitwarden.atlassian.net/browse/PM-3762 to remove the dependency on the organizationId.\n  async decrypt(encKey: SymmetricCryptoKey): Promise<CipherView> {\n    const model = new CipherView(this);\n    let bypassValidation = true;\n\n    if (this.key != null) {\n      const encryptService = Utils.getContainerService().getEncryptService();\n      encKey = new SymmetricCryptoKey(await encryptService.decryptToBytes(this.key, encKey));\n      bypassValidation = false;\n    }\n\n    await this.decryptObj(\n      model,\n      {\n        name: null,\n        notes: null,\n      },\n      this.organizationId,\n      encKey,\n    );\n\n    switch (this.type) {\n      case CipherType.Login:\n        model.login = await this.login.decrypt(this.organizationId, bypassValidation, encKey);\n        break;\n      case CipherType.SecureNote:\n        model.secureNote = await this.secureNote.decrypt(this.organizationId, encKey);\n        break;\n      case CipherType.Card:\n        model.card = await this.card.decrypt(this.organizationId, encKey);\n        break;\n      case CipherType.Identity:\n        model.identity = await this.identity.decrypt(this.organizationId, encKey);\n        break;\n      default:\n        break;\n    }\n\n    if (this.attachments != null && this.attachments.length > 0) {\n      const attachments: any[] = [];\n      await this.attachments.reduce((promise, attachment) => {\n        return promise\n          .then(() => {\n            return attachment.decrypt(this.organizationId, encKey);\n          })\n          .then((decAttachment) => {\n            attachments.push(decAttachment);\n          });\n      }, Promise.resolve());\n      model.attachments = attachments;\n    }\n\n    if (this.fields != null && this.fields.length > 0) {\n      const fields: any[] = [];\n      await this.fields.reduce((promise, field) => {\n        return promise\n          .then(() => {\n            return field.decrypt(this.organizationId, encKey);\n          })\n          .then((decField) => {\n            fields.push(decField);\n          });\n      }, Promise.resolve());\n      model.fields = fields;\n    }\n\n    if (this.passwordHistory != null && this.passwordHistory.length > 0) {\n      const passwordHistory: any[] = [];\n      await this.passwordHistory.reduce((promise, ph) => {\n        return promise\n          .then(() => {\n            return ph.decrypt(this.organizationId, encKey);\n          })\n          .then((decPh) => {\n            passwordHistory.push(decPh);\n          });\n      }, Promise.resolve());\n      model.passwordHistory = passwordHistory;\n    }\n\n    return model;\n  }\n\n  toCipherData(): CipherData {\n    const c = new CipherData();\n    c.id = this.id;\n    c.organizationId = this.organizationId;\n    c.folderId = this.folderId;\n    c.edit = this.edit;\n    c.viewPassword = this.viewPassword;\n    c.organizationUseTotp = this.organizationUseTotp;\n    c.favorite = this.favorite;\n    c.revisionDate = this.revisionDate != null ? this.revisionDate.toISOString() : null;\n    c.type = this.type;\n    c.collectionIds = this.collectionIds;\n    c.creationDate = this.creationDate != null ? this.creationDate.toISOString() : null;\n    c.deletedDate = this.deletedDate != null ? this.deletedDate.toISOString() : null;\n    c.reprompt = this.reprompt;\n    c.key = this.key?.encryptedString;\n\n    this.buildDataModel(this, c, {\n      name: null,\n      notes: null,\n    });\n\n    switch (c.type) {\n      case CipherType.Login:\n        c.login = this.login.toLoginData();\n        break;\n      case CipherType.SecureNote:\n        c.secureNote = this.secureNote.toSecureNoteData();\n        break;\n      case CipherType.Card:\n        c.card = this.card.toCardData();\n        break;\n      case CipherType.Identity:\n        c.identity = this.identity.toIdentityData();\n        break;\n      default:\n        break;\n    }\n\n    if (this.fields != null) {\n      c.fields = this.fields.map((f) => f.toFieldData());\n    }\n    if (this.attachments != null) {\n      c.attachments = this.attachments.map((a) => a.toAttachmentData());\n    }\n    if (this.passwordHistory != null) {\n      c.passwordHistory = this.passwordHistory.map((ph) => ph.toPasswordHistoryData());\n    }\n    return c;\n  }\n\n  static fromJSON(obj: Jsonify<Cipher>) {\n    if (obj == null) {\n      return null;\n    }\n\n    const domain = new Cipher();\n    const name = EncString.fromJSON(obj.name);\n    const notes = EncString.fromJSON(obj.notes);\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    const deletedDate = obj.deletedDate == null ? null : new Date(obj.deletedDate);\n    const attachments = obj.attachments?.map((a: any) => Attachment.fromJSON(a));\n    const fields = obj.fields?.map((f: any) => Field.fromJSON(f));\n    const passwordHistory = obj.passwordHistory?.map((ph: any) => Password.fromJSON(ph));\n    const key = EncString.fromJSON(obj.key);\n\n    Object.assign(domain, obj, {\n      name,\n      notes,\n      revisionDate,\n      deletedDate,\n      attachments,\n      fields,\n      passwordHistory,\n      key,\n    });\n\n    switch (obj.type) {\n      case CipherType.Card:\n        domain.card = Card.fromJSON(obj.card);\n        break;\n      case CipherType.Identity:\n        domain.identity = Identity.fromJSON(obj.identity);\n        break;\n      case CipherType.Login:\n        domain.login = Login.fromJSON(obj.login);\n        break;\n      case CipherType.SecureNote:\n        domain.secureNote = SecureNote.fromJSON(obj.secureNote);\n        break;\n      default:\n        break;\n    }\n\n    return domain;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Cipher } from \"../../../vault/models/domain/cipher\";\nimport { CipherView } from \"../../../vault/models/view/cipher.view\";\nimport { InitializerMetadata } from \"../../interfaces/initializer-metadata.interface\";\n\nimport { InitializerKey } from \"./initializer-key\";\n\n/**\n * Internal reference of classes so we can reconstruct objects properly.\n * Each entry should be keyed using the Decryptable.initializerKey property\n */\nconst classInitializers: Record<InitializerKey, (obj: any) => any> = {\n  [InitializerKey.Cipher]: Cipher.fromJSON,\n  [InitializerKey.CipherView]: CipherView.fromJSON,\n};\n\nexport function getClassInitializer<T extends InitializerMetadata>(\n  className: InitializerKey,\n): (obj: Jsonify<T>) => T {\n  return classInitializers[className];\n}\n","import { defaultIfEmpty, filter, firstValueFrom, fromEvent, map, Subject, takeUntil } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { Decryptable } from \"../../interfaces/decryptable.interface\";\nimport { InitializerMetadata } from \"../../interfaces/initializer-metadata.interface\";\nimport { SymmetricCryptoKey } from \"../../models/domain/symmetric-crypto-key\";\n\nimport { EncryptServiceImplementation } from \"./encrypt.service.implementation\";\nimport { getClassInitializer } from \"./get-class-initializer\";\n\n// TTL (time to live) is not strictly required but avoids tying up memory resources if inactive\nconst workerTTL = 3 * 60000; // 3 minutes\n\nexport class MultithreadEncryptServiceImplementation extends EncryptServiceImplementation {\n  private worker: Worker;\n  private timeout: any;\n\n  private clear$ = new Subject<void>();\n\n  /**\n   * Sends items to a web worker to decrypt them.\n   * This utilises multithreading to decrypt items faster without interrupting other operations (e.g. updating UI).\n   */\n  async decryptItems<T extends InitializerMetadata>(\n    items: Decryptable<T>[],\n    key: SymmetricCryptoKey,\n  ): Promise<T[]> {\n    if (items == null || items.length < 1) {\n      return [];\n    }\n\n    this.logService.info(\"Starting decryption using multithreading\");\n\n    this.worker ??= new Worker(\n      new URL(\n        /* webpackChunkName: 'encrypt-worker' */\n        \"@bitwarden/common/platform/services/cryptography/encrypt.worker.ts\",\n        import.meta.url,\n      ),\n    );\n\n    this.restartTimeout();\n\n    const request = {\n      id: Utils.newGuid(),\n      items: items,\n      key: key,\n    };\n\n    this.worker.postMessage(JSON.stringify(request));\n\n    return await firstValueFrom(\n      fromEvent(this.worker, \"message\").pipe(\n        filter((response: MessageEvent) => response.data?.id === request.id),\n        map((response) => JSON.parse(response.data.items)),\n        map((items) =>\n          items.map((jsonItem: Jsonify<T>) => {\n            const initializer = getClassInitializer<T>(jsonItem.initializerKey);\n            return initializer(jsonItem);\n          }),\n        ),\n        takeUntil(this.clear$),\n        defaultIfEmpty([]),\n      ),\n    );\n  }\n\n  private clear() {\n    this.clear$.next();\n    this.worker?.terminate();\n    this.worker = null;\n    this.clearTimeout();\n  }\n\n  private restartTimeout() {\n    this.clearTimeout();\n    this.timeout = setTimeout(() => this.clear(), workerTTL);\n  }\n\n  private clearTimeout() {\n    if (this.timeout != null) {\n      clearTimeout(this.timeout);\n    }\n  }\n}\n","import { LogService } from \"../../abstractions/log.service\";\nimport { Utils } from \"../../misc/utils\";\nimport { EncArrayBuffer } from \"../../models/domain/enc-array-buffer\";\n\nconst MAX_SINGLE_BLOB_UPLOAD_SIZE = 256 * 1024 * 1024; // 256 MiB\nconst MAX_BLOCKS_PER_BLOB = 50000;\n\nexport class AzureFileUploadService {\n  constructor(private logService: LogService) {}\n\n  async upload(url: string, data: EncArrayBuffer, renewalCallback: () => Promise<string>) {\n    if (data.buffer.byteLength <= MAX_SINGLE_BLOB_UPLOAD_SIZE) {\n      return await this.azureUploadBlob(url, data);\n    } else {\n      return await this.azureUploadBlocks(url, data, renewalCallback);\n    }\n  }\n  private async azureUploadBlob(url: string, data: EncArrayBuffer) {\n    const urlObject = Utils.getUrl(url);\n    const headers = new Headers({\n      \"x-ms-date\": new Date().toUTCString(),\n      \"x-ms-version\": urlObject.searchParams.get(\"sv\"),\n      \"Content-Length\": data.buffer.byteLength.toString(),\n      \"x-ms-blob-type\": \"BlockBlob\",\n    });\n\n    const request = new Request(url, {\n      body: data.buffer,\n      cache: \"no-store\",\n      method: \"PUT\",\n      headers: headers,\n    });\n\n    const blobResponse = await fetch(request);\n\n    if (blobResponse.status !== 201) {\n      throw new Error(`Failed to create Azure blob: ${blobResponse.status}`);\n    }\n  }\n  private async azureUploadBlocks(\n    url: string,\n    data: EncArrayBuffer,\n    renewalCallback: () => Promise<string>,\n  ) {\n    const baseUrl = Utils.getUrl(url);\n    const blockSize = this.getMaxBlockSize(baseUrl.searchParams.get(\"sv\"));\n    let blockIndex = 0;\n    const numBlocks = Math.ceil(data.buffer.byteLength / blockSize);\n    const blocksStaged: string[] = [];\n\n    if (numBlocks > MAX_BLOCKS_PER_BLOB) {\n      throw new Error(\n        `Cannot upload file, exceeds maximum size of ${blockSize * MAX_BLOCKS_PER_BLOB}`,\n      );\n    }\n\n    // eslint-disable-next-line\n    try {\n      while (blockIndex < numBlocks) {\n        url = await this.renewUrlIfNecessary(url, renewalCallback);\n        const blockUrl = Utils.getUrl(url);\n        const blockId = this.encodedBlockId(blockIndex);\n        blockUrl.searchParams.append(\"comp\", \"block\");\n        blockUrl.searchParams.append(\"blockid\", blockId);\n        const start = blockIndex * blockSize;\n        const blockData = data.buffer.slice(start, start + blockSize);\n        const blockHeaders = new Headers({\n          \"x-ms-date\": new Date().toUTCString(),\n          \"x-ms-version\": blockUrl.searchParams.get(\"sv\"),\n          \"Content-Length\": blockData.byteLength.toString(),\n        });\n\n        const blockRequest = new Request(blockUrl.toString(), {\n          body: blockData,\n          cache: \"no-store\",\n          method: \"PUT\",\n          headers: blockHeaders,\n        });\n\n        const blockResponse = await fetch(blockRequest);\n\n        if (blockResponse.status !== 201) {\n          const message = `Unsuccessful block PUT. Received status ${blockResponse.status}`;\n          this.logService.error(message + \"\\n\" + (await blockResponse.json()));\n          throw new Error(message);\n        }\n\n        blocksStaged.push(blockId);\n        blockIndex++;\n      }\n\n      url = await this.renewUrlIfNecessary(url, renewalCallback);\n      const blockListUrl = Utils.getUrl(url);\n      const blockListXml = this.blockListXml(blocksStaged);\n      blockListUrl.searchParams.append(\"comp\", \"blocklist\");\n      const headers = new Headers({\n        \"x-ms-date\": new Date().toUTCString(),\n        \"x-ms-version\": blockListUrl.searchParams.get(\"sv\"),\n        \"Content-Length\": blockListXml.length.toString(),\n      });\n\n      const request = new Request(blockListUrl.toString(), {\n        body: blockListXml,\n        cache: \"no-store\",\n        method: \"PUT\",\n        headers: headers,\n      });\n\n      const response = await fetch(request);\n\n      if (response.status !== 201) {\n        const message = `Unsuccessful block list PUT. Received status ${response.status}`;\n        this.logService.error(message + \"\\n\" + (await response.json()));\n        throw new Error(message);\n      }\n    } catch (e) {\n      throw e;\n    }\n  }\n\n  private async renewUrlIfNecessary(\n    url: string,\n    renewalCallback: () => Promise<string>,\n  ): Promise<string> {\n    const urlObject = Utils.getUrl(url);\n    const expiry = new Date(urlObject.searchParams.get(\"se\") ?? \"\");\n\n    if (isNaN(expiry.getTime())) {\n      expiry.setTime(Date.now() + 3600000);\n    }\n\n    if (expiry.getTime() < Date.now() + 1000) {\n      return await renewalCallback();\n    }\n    return url;\n  }\n\n  private encodedBlockId(blockIndex: number) {\n    // Encoded blockId max size is 64, so pre-encoding max size is 48\n    const utfBlockId = (\n      \"000000000000000000000000000000000000000000000000\" + blockIndex.toString()\n    ).slice(-48);\n    return Utils.fromUtf8ToB64(utfBlockId);\n  }\n\n  private blockListXml(blockIdList: string[]) {\n    let xml = '<?xml version=\"1.0\" encoding=\"utf-8\"?><BlockList>';\n    blockIdList.forEach((blockId) => {\n      xml += `<Latest>${blockId}</Latest>`;\n    });\n    xml += \"</BlockList>\";\n    return xml;\n  }\n\n  private getMaxBlockSize(version: string) {\n    if (Version.compare(version, \"2019-12-12\") >= 0) {\n      return 4000 * 1024 * 1024; // 4000 MiB\n    } else if (Version.compare(version, \"2016-05-31\") >= 0) {\n      return 100 * 1024 * 1024; // 100 MiB\n    } else {\n      return 4 * 1024 * 1024; // 4 MiB\n    }\n  }\n}\n\nclass Version {\n  /**\n   * Compares two Azure Versions against each other\n   * @param a Version to compare\n   * @param b Version to compare\n   * @returns a number less than zero if b is newer than a, 0 if equal,\n   * and greater than zero if a is newer than b\n   */\n  static compare(a: Required<Version> | string, b: Required<Version> | string) {\n    if (typeof a === \"string\") {\n      a = new Version(a);\n    }\n\n    if (typeof b === \"string\") {\n      b = new Version(b);\n    }\n\n    return a.year !== b.year\n      ? a.year - b.year\n      : a.month !== b.month\n        ? a.month - b.month\n        : a.day !== b.day\n          ? a.day - b.day\n          : 0;\n  }\n  year = 0;\n  month = 0;\n  day = 0;\n\n  constructor(version: string) {\n    try {\n      const parts = version.split(\"-\").map((v) => Number.parseInt(v, 10));\n      this.year = parts[0];\n      this.month = parts[1];\n      this.day = parts[2];\n    } catch {\n      // Ignore error\n    }\n  }\n  /**\n   * Compares two Azure Versions against each other\n   * @param compareTo Version to compare against\n   * @returns a number less than zero if compareTo is newer, 0 if equal,\n   * and greater than zero if this is greater than compareTo\n   */\n  compare(compareTo: Required<Version> | string) {\n    return Version.compare(this, compareTo);\n  }\n}\n","import { Utils } from \"../../misc/utils\";\nimport { EncArrayBuffer } from \"../../models/domain/enc-array-buffer\";\n\nexport class BitwardenFileUploadService {\n  async upload(\n    encryptedFileName: string,\n    encryptedFileData: EncArrayBuffer,\n    apiCall: (fd: FormData) => Promise<any>,\n  ) {\n    const fd = new FormData();\n    try {\n      const blob = new Blob([encryptedFileData.buffer], { type: \"application/octet-stream\" });\n      fd.append(\"data\", blob, encryptedFileName);\n    } catch (e) {\n      if (Utils.isNode && !Utils.isBrowser) {\n        fd.append(\n          \"data\",\n          Buffer.from(encryptedFileData.buffer) as any,\n          {\n            filepath: encryptedFileName,\n            contentType: \"application/octet-stream\",\n          } as any,\n        );\n      } else {\n        throw e;\n      }\n    }\n\n    await apiCall(fd);\n  }\n}\n","import {\n  FileUploadApiMethods,\n  FileUploadService as FileUploadServiceAbstraction,\n} from \"../../abstractions/file-upload/file-upload.service\";\nimport { LogService } from \"../../abstractions/log.service\";\nimport { FileUploadType } from \"../../enums\";\nimport { EncArrayBuffer } from \"../../models/domain/enc-array-buffer\";\nimport { EncString } from \"../../models/domain/enc-string\";\n\nimport { AzureFileUploadService } from \"./azure-file-upload.service\";\nimport { BitwardenFileUploadService } from \"./bitwarden-file-upload.service\";\n\nexport class FileUploadService implements FileUploadServiceAbstraction {\n  private azureFileUploadService: AzureFileUploadService;\n  private bitwardenFileUploadService: BitwardenFileUploadService;\n\n  constructor(protected logService: LogService) {\n    this.azureFileUploadService = new AzureFileUploadService(logService);\n    this.bitwardenFileUploadService = new BitwardenFileUploadService();\n  }\n\n  async upload(\n    uploadData: { url: string; fileUploadType: FileUploadType },\n    fileName: EncString,\n    encryptedFileData: EncArrayBuffer,\n    fileUploadMethods: FileUploadApiMethods,\n  ) {\n    try {\n      switch (uploadData.fileUploadType) {\n        case FileUploadType.Direct:\n          await this.bitwardenFileUploadService.upload(\n            fileName.encryptedString,\n            encryptedFileData,\n            (fd) => fileUploadMethods.postDirect(fd),\n          );\n          break;\n        case FileUploadType.Azure: {\n          await this.azureFileUploadService.upload(\n            uploadData.url,\n            encryptedFileData,\n            fileUploadMethods.renewFileUploadUrl,\n          );\n          break;\n        }\n        default:\n          throw new Error(\"Unknown file upload type\");\n      }\n    } catch (e) {\n      await fileUploadMethods.rollback();\n      throw e;\n    }\n  }\n}\n","import { KdfConfig } from \"../../auth/models/domain/kdf-config\";\nimport { CsprngArray } from \"../../types/csprng\";\nimport { CryptoFunctionService } from \"../abstractions/crypto-function.service\";\nimport { KeyGenerationService as KeyGenerationServiceAbstraction } from \"../abstractions/key-generation.service\";\nimport {\n  ARGON2_ITERATIONS,\n  ARGON2_MEMORY,\n  ARGON2_PARALLELISM,\n  KdfType,\n  PBKDF2_ITERATIONS,\n} from \"../enums\";\nimport { Utils } from \"../misc/utils\";\nimport { SymmetricCryptoKey } from \"../models/domain/symmetric-crypto-key\";\n\nexport class KeyGenerationService implements KeyGenerationServiceAbstraction {\n  constructor(private cryptoFunctionService: CryptoFunctionService) {}\n\n  async createKey(bitLength: 256 | 512): Promise<SymmetricCryptoKey> {\n    const key = await this.cryptoFunctionService.aesGenerateKey(bitLength);\n    return new SymmetricCryptoKey(key);\n  }\n\n  async createKeyWithPurpose(\n    bitLength: 128 | 192 | 256 | 512,\n    purpose: string,\n    salt?: string,\n  ): Promise<{ salt: string; material: CsprngArray; derivedKey: SymmetricCryptoKey }> {\n    if (salt == null) {\n      const bytes = await this.cryptoFunctionService.randomBytes(32);\n      salt = Utils.fromBufferToUtf8(bytes);\n    }\n    const material = await this.cryptoFunctionService.aesGenerateKey(bitLength);\n    const key = await this.cryptoFunctionService.hkdf(material, salt, purpose, 64, \"sha256\");\n    return { salt, material, derivedKey: new SymmetricCryptoKey(key) };\n  }\n\n  async deriveKeyFromMaterial(\n    material: CsprngArray,\n    salt: string,\n    purpose: string,\n  ): Promise<SymmetricCryptoKey> {\n    const key = await this.cryptoFunctionService.hkdf(material, salt, purpose, 64, \"sha256\");\n    return new SymmetricCryptoKey(key);\n  }\n\n  async deriveKeyFromPassword(\n    password: string | Uint8Array,\n    salt: string | Uint8Array,\n    kdf: KdfType,\n    kdfConfig: KdfConfig,\n  ): Promise<SymmetricCryptoKey> {\n    let key: Uint8Array = null;\n    if (kdf == null || kdf === KdfType.PBKDF2_SHA256) {\n      if (kdfConfig.iterations == null) {\n        kdfConfig.iterations = PBKDF2_ITERATIONS.defaultValue;\n      }\n\n      key = await this.cryptoFunctionService.pbkdf2(password, salt, \"sha256\", kdfConfig.iterations);\n    } else if (kdf == KdfType.Argon2id) {\n      if (kdfConfig.iterations == null) {\n        kdfConfig.iterations = ARGON2_ITERATIONS.defaultValue;\n      }\n\n      if (kdfConfig.memory == null) {\n        kdfConfig.memory = ARGON2_MEMORY.defaultValue;\n      }\n\n      if (kdfConfig.parallelism == null) {\n        kdfConfig.parallelism = ARGON2_PARALLELISM.defaultValue;\n      }\n\n      const saltHash = await this.cryptoFunctionService.hash(salt, \"sha256\");\n      key = await this.cryptoFunctionService.argon2(\n        password,\n        saltHash,\n        kdfConfig.iterations,\n        kdfConfig.memory * 1024, // convert to KiB from MiB\n        kdfConfig.parallelism,\n      );\n    } else {\n      throw new Error(\"Unknown Kdf.\");\n    }\n    return new SymmetricCryptoKey(key);\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { MemoryStorageOptions, StorageOptions } from \"../models/domain/storage-options\";\n\nexport type StorageUpdateType = \"save\" | \"remove\";\nexport type StorageUpdate = {\n  key: string;\n  updateType: StorageUpdateType;\n};\n\nexport interface ObservableStorageService {\n  /**\n   * Provides an {@link Observable} that represents a stream of updates that\n   * have happened in this storage service or in the storage this service provides\n   * an interface to.\n   */\n  get updates$(): Observable<StorageUpdate>;\n}\n\nexport abstract class AbstractStorageService {\n  abstract get valuesRequireDeserialization(): boolean;\n  abstract get<T>(key: string, options?: StorageOptions): Promise<T>;\n  abstract has(key: string, options?: StorageOptions): Promise<boolean>;\n  abstract save<T>(key: string, obj: T, options?: StorageOptions): Promise<void>;\n  abstract remove(key: string, options?: StorageOptions): Promise<void>;\n}\n\nexport abstract class AbstractMemoryStorageService extends AbstractStorageService {\n  // Used to identify the service in the session sync decorator framework\n  static readonly TYPE = \"MemoryStorageService\";\n  readonly type = AbstractMemoryStorageService.TYPE;\n\n  abstract get<T>(key: string, options?: MemoryStorageOptions<T>): Promise<T>;\n  abstract getBypassCache<T>(key: string, options?: MemoryStorageOptions<T>): Promise<T>;\n}\n","import { Subject } from \"rxjs\";\n\nimport { AbstractMemoryStorageService, StorageUpdate } from \"../abstractions/storage.service\";\n\nexport class MemoryStorageService extends AbstractMemoryStorageService {\n  protected store = new Map<string, unknown>();\n  private updatesSubject = new Subject<StorageUpdate>();\n\n  get valuesRequireDeserialization(): boolean {\n    return false;\n  }\n  get updates$() {\n    return this.updatesSubject.asObservable();\n  }\n\n  get<T>(key: string): Promise<T> {\n    if (this.store.has(key)) {\n      const obj = this.store.get(key);\n      return Promise.resolve(obj as T);\n    }\n    return Promise.resolve(null);\n  }\n\n  async has(key: string): Promise<boolean> {\n    return (await this.get(key)) != null;\n  }\n\n  save<T>(key: string, obj: T): Promise<void> {\n    if (obj == null) {\n      return this.remove(key);\n    }\n    // TODO: Remove once foreground/background contexts are separated in browser\n    // Needed to ensure ownership of all memory by the context running the storage service\n    const toStore = structuredClone(obj);\n    this.store.set(key, toStore);\n    this.updatesSubject.next({ key, updateType: \"save\" });\n    return Promise.resolve();\n  }\n\n  remove(key: string): Promise<void> {\n    this.store.delete(key);\n    this.updatesSubject.next({ key, updateType: \"remove\" });\n    return Promise.resolve();\n  }\n\n  getBypassCache<T>(key: string): Promise<T> {\n    return this.get<T>(key);\n  }\n}\n","import { MigrationHelper } from \"./migration-helper\";\nimport { Direction, Migrator, VersionFrom, VersionTo } from \"./migrator\";\n\nexport class MigrationBuilder<TCurrent extends number = 0> {\n  /** Create a new MigrationBuilder with an empty buffer of migrations to perform.\n   *\n   * Add migrations to the buffer with {@link with} and {@link rollback}.\n   * @returns A new MigrationBuilder.\n   */\n  static create(): MigrationBuilder<0> {\n    return new MigrationBuilder([]);\n  }\n\n  private constructor(\n    private migrations: readonly { migrator: Migrator<number, number>; direction: Direction }[],\n  ) {}\n\n  /** Add a migrator to the MigrationBuilder. Types are updated such that the chained MigrationBuilder must currently be\n   * at state version equal to the from version of the migrator. Return as MigrationBuilder<TTo> where TTo is the to\n   * version of the migrator, so that the next migrator can be chained.\n   *\n   * @param migrate A migrator class or a tuple of a migrator class, the from version, and the to version. A tuple is\n   * required to instantiate version numbers unless a default constructor is defined.\n   * @returns A new MigrationBuilder with the to version of the migrator as the current version.\n   */\n  with<\n    TMigrator extends Migrator<number, number>,\n    TFrom extends VersionFrom<TMigrator> & TCurrent,\n    TTo extends VersionTo<TMigrator>,\n  >(\n    ...migrate: [new () => TMigrator] | [new (from: TFrom, to: TTo) => TMigrator, TFrom, TTo]\n  ): MigrationBuilder<TTo> {\n    return this.addMigrator(migrate, \"up\");\n  }\n\n  /** Add a migrator to rollback on the MigrationBuilder's list of migrations. As with {@link with}, types of\n   * MigrationBuilder and Migrator must align. However, this time the migration is reversed so TCurrent of the\n   * MigrationBuilder must be equal to the to version of the migrator. Return as MigrationBuilder<TFrom> where TFrom\n   * is the from version of the migrator, so that the next migrator can be chained.\n   *\n   * @param migrate A migrator class or a tuple of a migrator class, the from version, and the to version. A tuple is\n   * required to instantiate version numbers unless a default constructor is defined.\n   * @returns A new MigrationBuilder with the from version of the migrator as the current version.\n   */\n  rollback<\n    TMigrator extends Migrator<number, number>,\n    TFrom extends VersionFrom<TMigrator>,\n    TTo extends VersionTo<TMigrator> & TCurrent,\n  >(\n    ...migrate: [new () => TMigrator] | [new (from: TFrom, to: TTo) => TMigrator, TTo, TFrom]\n  ): MigrationBuilder<TFrom> {\n    if (migrate.length === 3) {\n      migrate = [migrate[0], migrate[2], migrate[1]];\n    }\n    return this.addMigrator(migrate, \"down\");\n  }\n\n  /** Execute the migrations as defined in the MigrationBuilder's migrator buffer */\n  migrate(helper: MigrationHelper): Promise<void> {\n    return this.migrations.reduce(\n      (promise, migrator) =>\n        promise.then(async () => {\n          await this.runMigrator(migrator.migrator, helper, migrator.direction);\n        }),\n      Promise.resolve(),\n    );\n  }\n\n  private addMigrator<\n    TMigrator extends Migrator<number, number>,\n    TFrom extends VersionFrom<TMigrator> & TCurrent,\n    TTo extends VersionTo<TMigrator>,\n  >(\n    migrate: [new () => TMigrator] | [new (from: TFrom, to: TTo) => TMigrator, TFrom, TTo],\n    direction: Direction = \"up\",\n  ) {\n    const newMigration =\n      migrate.length === 1\n        ? { migrator: new migrate[0](), direction }\n        : { migrator: new migrate[0](migrate[1], migrate[2]), direction };\n\n    return new MigrationBuilder<TTo>([...this.migrations, newMigration]);\n  }\n\n  private async runMigrator(\n    migrator: Migrator<number, number>,\n    helper: MigrationHelper,\n    direction: Direction,\n  ): Promise<void> {\n    const shouldMigrate = await migrator.shouldMigrate(helper, direction);\n    helper.info(\n      `Migrator ${migrator.constructor.name} (to version ${migrator.toVersion}) should migrate: ${shouldMigrate} - ${direction}`,\n    );\n    if (shouldMigrate) {\n      const method = direction === \"up\" ? migrator.migrate : migrator.rollback;\n      await method.bind(migrator)(helper);\n      helper.info(\n        `Migrator ${migrator.constructor.name} (to version ${migrator.toVersion}) migrated - ${direction}`,\n      );\n      await migrator.updateVersion(helper, direction);\n      helper.info(\n        `Migrator ${migrator.constructor.name} (to version ${migrator.toVersion}) updated version - ${direction}`,\n      );\n    }\n  }\n}\n","import { NonNegativeInteger } from \"type-fest\";\n\nimport { MigrationHelper } from \"./migration-helper\";\n\nexport const IRREVERSIBLE = new Error(\"Irreversible migration\");\n\nexport type VersionFrom<T> =\n  T extends Migrator<infer TFrom, number>\n    ? TFrom extends NonNegativeInteger<TFrom>\n      ? TFrom\n      : never\n    : never;\nexport type VersionTo<T> =\n  T extends Migrator<number, infer TTo>\n    ? TTo extends NonNegativeInteger<TTo>\n      ? TTo\n      : never\n    : never;\nexport type Direction = \"up\" | \"down\";\n\nexport abstract class Migrator<TFrom extends number, TTo extends number> {\n  constructor(\n    public fromVersion: TFrom,\n    public toVersion: TTo,\n  ) {\n    if (fromVersion == null || toVersion == null) {\n      throw new Error(\"Invalid migration\");\n    }\n    if (fromVersion > toVersion) {\n      throw new Error(\"Invalid migration\");\n    }\n  }\n\n  shouldMigrate(helper: MigrationHelper, direction: Direction): Promise<boolean> {\n    const startVersion = direction === \"up\" ? this.fromVersion : this.toVersion;\n    return Promise.resolve(helper.currentVersion === startVersion);\n  }\n  abstract migrate(helper: MigrationHelper): Promise<void>;\n  abstract rollback(helper: MigrationHelper): Promise<void>;\n  async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    await helper.set(\"stateVersion\", endVersion);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  profile?: {\n    everHadUserKey?: boolean;\n  };\n};\n\nconst USER_EVER_HAD_USER_KEY: KeyDefinitionLike = {\n  key: \"everHadUserKey\",\n  stateDefinition: {\n    name: \"crypto\",\n  },\n};\n\nexport class EverHadUserKeyMigrator extends Migrator<9, 10> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.profile?.everHadUserKey;\n      await helper.setToUser(userId, USER_EVER_HAD_USER_KEY, value ?? false);\n      if (value != null) {\n        delete account.profile.everHadUserKey;\n      }\n      await helper.set(userId, account);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, USER_EVER_HAD_USER_KEY);\n      if (account) {\n        account.profile = Object.assign(account.profile ?? {}, {\n          everHadUserKey: value,\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_EVER_HAD_USER_KEY, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype OrgKeyDataType = {\n  type: \"organization\" | \"provider\";\n  key: string;\n  providerId?: string;\n};\n\ntype ExpectedAccountType = {\n  keys?: {\n    organizationKeys?: {\n      encrypted?: Record<string, OrgKeyDataType>;\n    };\n  };\n};\n\nconst USER_ENCRYPTED_ORGANIZATION_KEYS: KeyDefinitionLike = {\n  key: \"organizationKeys\",\n  stateDefinition: {\n    name: \"crypto\",\n  },\n};\n\nexport class OrganizationKeyMigrator extends Migrator<10, 11> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.keys?.organizationKeys?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_ORGANIZATION_KEYS, value);\n        delete account.keys.organizationKeys;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser<Record<string, OrgKeyDataType>>(\n        userId,\n        USER_ENCRYPTED_ORGANIZATION_KEYS,\n      );\n      if (account && value) {\n        account.keys = Object.assign(account.keys ?? {}, {\n          organizationKeys: {\n            encrypted: value,\n          },\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_ORGANIZATION_KEYS, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper, StateDefinitionLike } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype EnvironmentUrls = Record<string, string>;\n\ntype ExpectedAccountType = {\n  settings?: { region?: string; environmentUrls?: EnvironmentUrls };\n};\n\ntype ExpectedGlobalType = { region?: string; environmentUrls?: EnvironmentUrls };\n\nconst ENVIRONMENT_STATE: StateDefinitionLike = { name: \"environment\" };\n\nconst REGION_KEY: KeyDefinitionLike = { key: \"region\", stateDefinition: ENVIRONMENT_STATE };\nconst URLS_KEY: KeyDefinitionLike = { key: \"urls\", stateDefinition: ENVIRONMENT_STATE };\n\nexport class MoveEnvironmentStateToProviders extends Migrator<11, 12> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyGlobal = await helper.get<ExpectedGlobalType>(\"global\");\n\n    // Move global data\n    if (legacyGlobal?.region != null) {\n      await helper.setToGlobal(REGION_KEY, legacyGlobal.region);\n    }\n\n    if (legacyGlobal?.environmentUrls != null) {\n      await helper.setToGlobal(URLS_KEY, legacyGlobal.environmentUrls);\n    }\n\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        // Move account data\n        if (account?.settings?.region != null) {\n          await helper.setToUser(userId, REGION_KEY, account.settings.region);\n        }\n\n        if (account?.settings?.environmentUrls != null) {\n          await helper.setToUser(userId, URLS_KEY, account.settings.environmentUrls);\n        }\n\n        // Delete old account data\n        delete account?.settings?.region;\n        delete account?.settings?.environmentUrls;\n        await helper.set(userId, account);\n      }),\n    );\n\n    // Delete legacy global data\n    delete legacyGlobal?.region;\n    delete legacyGlobal?.environmentUrls;\n    await helper.set(\"global\", legacyGlobal);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    let legacyGlobal = await helper.get<ExpectedGlobalType>(\"global\");\n\n    let updatedLegacyGlobal = false;\n\n    const globalRegion = await helper.getFromGlobal<string>(REGION_KEY);\n\n    if (globalRegion) {\n      if (!legacyGlobal) {\n        legacyGlobal = {};\n      }\n\n      updatedLegacyGlobal = true;\n      legacyGlobal.region = globalRegion;\n      await helper.setToGlobal(REGION_KEY, null);\n    }\n\n    const globalUrls = await helper.getFromGlobal<EnvironmentUrls>(URLS_KEY);\n\n    if (globalUrls) {\n      if (!legacyGlobal) {\n        legacyGlobal = {};\n      }\n\n      updatedLegacyGlobal = true;\n      legacyGlobal.environmentUrls = globalUrls;\n      await helper.setToGlobal(URLS_KEY, null);\n    }\n\n    if (updatedLegacyGlobal) {\n      await helper.set(\"global\", legacyGlobal);\n    }\n\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      let updatedAccount = false;\n      const userRegion = await helper.getFromUser<string>(userId, REGION_KEY);\n\n      if (userRegion) {\n        if (!account) {\n          account = {};\n        }\n\n        if (!account.settings) {\n          account.settings = {};\n        }\n\n        updatedAccount = true;\n        account.settings.region = userRegion;\n        await helper.setToUser(userId, REGION_KEY, null);\n      }\n\n      const userUrls = await helper.getFromUser<EnvironmentUrls>(userId, URLS_KEY);\n\n      if (userUrls) {\n        if (!account) {\n          account = {};\n        }\n\n        if (!account.settings) {\n          account.settings = {};\n        }\n\n        updatedAccount = true;\n        account.settings.environmentUrls = userUrls;\n        await helper.setToUser(userId, URLS_KEY, null);\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  keys?: {\n    providerKeys?: {\n      encrypted?: Record<string, string>; // Record<ProviderId, EncryptedString> where EncryptedString is the ProviderKey encrypted by the UserKey.\n    };\n  };\n};\n\nconst USER_ENCRYPTED_PROVIDER_KEYS: KeyDefinitionLike = {\n  key: \"providerKeys\",\n  stateDefinition: {\n    name: \"crypto\",\n  },\n};\n\nexport class ProviderKeyMigrator extends Migrator<12, 13> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.keys?.providerKeys?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_PROVIDER_KEYS, value);\n        delete account.keys.providerKeys;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser<Record<string, string>>(\n        userId,\n        USER_ENCRYPTED_PROVIDER_KEYS,\n      );\n      if (account && value) {\n        account.keys = Object.assign(account.keys ?? {}, {\n          providerKeys: {\n            encrypted: value,\n          },\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_PROVIDER_KEYS, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    disableAutoBiometricsPrompt?: boolean;\n    biometricUnlock?: boolean;\n    dismissedBiometricRequirePasswordOnStartCallout?: boolean;\n  };\n  keys?: { biometricEncryptionClientKeyHalf?: string };\n};\n\n// Biometric text, no auto prompt text, fingerprint validated, and prompt cancelled are refreshed on every app start, so we don't need to migrate them\nexport const CLIENT_KEY_HALF: KeyDefinitionLike = {\n  key: \"clientKeyHalf\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport class MoveBiometricClientKeyHalfToStateProviders extends Migrator<13, 14> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        // Move account data\n        if (account?.keys?.biometricEncryptionClientKeyHalf != null) {\n          await helper.setToUser(\n            userId,\n            CLIENT_KEY_HALF,\n            account.keys.biometricEncryptionClientKeyHalf,\n          );\n\n          // Delete old account data\n          delete account?.keys?.biometricEncryptionClientKeyHalf;\n          await helper.set(userId, account);\n        }\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      let updatedAccount = false;\n\n      const userKeyHalf = await helper.getFromUser<string>(userId, CLIENT_KEY_HALF);\n\n      if (userKeyHalf) {\n        account ??= {};\n        account.keys ??= {};\n\n        updatedAccount = true;\n        account.keys.biometricEncryptionClientKeyHalf = userKeyHalf;\n        await helper.setToUser(userId, CLIENT_KEY_HALF, null);\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype FolderDataType = {\n  id: string;\n  name: string;\n  revisionDate: string;\n};\n\ntype ExpectedAccountType = {\n  data?: {\n    folders?: {\n      encrypted?: Record<string, FolderDataType>;\n    };\n  };\n};\n\nconst USER_ENCRYPTED_FOLDERS: KeyDefinitionLike = {\n  key: \"folders\",\n  stateDefinition: {\n    name: \"folder\",\n  },\n};\n\nexport class FolderMigrator extends Migrator<14, 15> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.data?.folders?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_FOLDERS, value);\n        delete account.data.folders;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, USER_ENCRYPTED_FOLDERS);\n      if (account) {\n        account.data = Object.assign(account.data ?? {}, {\n          folders: {\n            encrypted: value,\n          },\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_FOLDERS, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  profile?: {\n    lastSync?: string;\n  };\n};\n\nconst LAST_SYNC_KEY: KeyDefinitionLike = {\n  key: \"lastSync\",\n  stateDefinition: {\n    name: \"sync\",\n  },\n};\n\nexport class LastSyncMigrator extends Migrator<15, 16> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.profile?.lastSync;\n      await helper.setToUser(userId, LAST_SYNC_KEY, value ?? null);\n      if (value != null) {\n        delete account.profile.lastSync;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, LAST_SYNC_KEY);\n      if (account) {\n        account.profile = Object.assign(account.profile ?? {}, {\n          lastSync: value,\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, LAST_SYNC_KEY, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedGlobalType = {\n  enablePasskeys?: boolean;\n};\n\nconst USER_ENABLE_PASSKEYS: KeyDefinitionLike = {\n  key: \"enablePasskeys\",\n  stateDefinition: {\n    name: \"vaultSettings\",\n  },\n};\n\nexport class EnablePasskeysMigrator extends Migrator<16, 17> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const global = await helper.get<ExpectedGlobalType>(\"global\");\n\n    if (global?.enablePasskeys != null) {\n      await helper.setToGlobal(USER_ENABLE_PASSKEYS, global.enablePasskeys);\n      delete global?.enablePasskeys;\n      await helper.set(\"global\", global);\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    let global = await helper.get<ExpectedGlobalType>(\"global\");\n    const globalEnablePasskeys = await helper.getFromGlobal<boolean>(USER_ENABLE_PASSKEYS);\n\n    if (globalEnablePasskeys != null) {\n      global = Object.assign(global ?? {}, { enablePasskeys: globalEnablePasskeys });\n      await helper.set(\"global\", global);\n      await helper.setToGlobal(USER_ENABLE_PASSKEYS, undefined);\n    }\n  }\n}\n","import { InlineMenuVisibilitySetting } from \"../../../../../apps/browser/src/autofill/utils/autofill-overlay.enum\";\nimport { StateDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountState = {\n  settings?: {\n    autoFillOnPageLoadDefault?: boolean;\n    enableAutoFillOnPageLoad?: boolean;\n    dismissedAutoFillOnPageLoadCallout?: boolean;\n    disableAutoTotpCopy?: boolean;\n    activateAutoFillOnPageLoadFromPolicy?: InlineMenuVisibilitySetting;\n  };\n};\n\ntype ExpectedGlobalState = { autoFillOverlayVisibility?: InlineMenuVisibilitySetting };\n\nconst autofillSettingsStateDefinition: {\n  stateDefinition: StateDefinitionLike;\n} = {\n  stateDefinition: {\n    name: \"autofillSettings\",\n  },\n};\n\nexport class AutofillSettingsKeyMigrator extends Migrator<17, 18> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    // global state (e.g. \"autoFillOverlayVisibility -> inlineMenuVisibility\")\n    const globalState = await helper.get<ExpectedGlobalState>(\"global\");\n\n    if (globalState?.autoFillOverlayVisibility != null) {\n      await helper.setToGlobal(\n        {\n          stateDefinition: {\n            name: \"autofillSettingsLocal\",\n          },\n          key: \"inlineMenuVisibility\",\n        },\n        globalState.autoFillOverlayVisibility,\n      );\n\n      // delete `autoFillOverlayVisibility` from state global\n      delete globalState.autoFillOverlayVisibility;\n\n      await helper.set<ExpectedGlobalState>(\"global\", globalState);\n    }\n\n    // account state (e.g. account settings -> state provider framework keys)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n\n    // migrate account state\n    async function migrateAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let updateAccount = false;\n      const accountSettings = account?.settings;\n\n      if (accountSettings?.autoFillOnPageLoadDefault != null) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoadDefault\" },\n          accountSettings.autoFillOnPageLoadDefault,\n        );\n        delete account.settings.autoFillOnPageLoadDefault;\n        updateAccount = true;\n      }\n\n      if (accountSettings?.enableAutoFillOnPageLoad != null) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoad\" },\n          accountSettings?.enableAutoFillOnPageLoad,\n        );\n        delete account.settings.enableAutoFillOnPageLoad;\n        updateAccount = true;\n      }\n\n      if (accountSettings?.dismissedAutoFillOnPageLoadCallout != null) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoadCalloutIsDismissed\" },\n          accountSettings?.dismissedAutoFillOnPageLoadCallout,\n        );\n        delete account.settings.dismissedAutoFillOnPageLoadCallout;\n        updateAccount = true;\n      }\n\n      if (accountSettings?.disableAutoTotpCopy != null) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autoCopyTotp\" },\n          // invert the value to match the new naming convention\n          !accountSettings?.disableAutoTotpCopy,\n        );\n        delete account.settings.disableAutoTotpCopy;\n        updateAccount = true;\n      }\n\n      if (accountSettings?.activateAutoFillOnPageLoadFromPolicy != null) {\n        await helper.setToUser(\n          userId,\n          {\n            stateDefinition: {\n              name: \"autofillSettingsLocal\",\n            },\n            key: \"activateAutofillOnPageLoadFromPolicy\",\n          },\n          accountSettings?.activateAutoFillOnPageLoadFromPolicy,\n        );\n        delete account.settings.activateAutoFillOnPageLoadFromPolicy;\n        updateAccount = true;\n      }\n\n      if (updateAccount) {\n        // update the state account settings with the migrated values deleted\n        await helper.set(userId, account);\n      }\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // global state (e.g. \"inlineMenuVisibility -> autoFillOverlayVisibility\")\n    const globalState = (await helper.get<ExpectedGlobalState>(\"global\")) || {};\n    const inlineMenuVisibility: InlineMenuVisibilitySetting = await helper.getFromGlobal({\n      stateDefinition: {\n        name: \"autofillSettingsLocal\",\n      },\n      key: \"inlineMenuVisibility\",\n    });\n\n    if (inlineMenuVisibility) {\n      await helper.set<ExpectedGlobalState>(\"global\", {\n        ...globalState,\n        autoFillOverlayVisibility: inlineMenuVisibility,\n      });\n\n      // remove the global state provider framework key for `inlineMenuVisibility`\n      await helper.setToGlobal(\n        {\n          stateDefinition: {\n            name: \"autofillSettingsLocal\",\n          },\n          key: \"inlineMenuVisibility\",\n        },\n        null,\n      );\n    }\n\n    // account state (e.g. state provider framework keys -> account settings)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n\n    // rollback account state\n    async function rollbackAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let updateAccount = false;\n      let settings = account?.settings || {};\n\n      const autoFillOnPageLoadDefault: boolean = await helper.getFromUser(userId, {\n        ...autofillSettingsStateDefinition,\n        key: \"autofillOnPageLoadDefault\",\n      });\n\n      const enableAutoFillOnPageLoad: boolean = await helper.getFromUser(userId, {\n        ...autofillSettingsStateDefinition,\n        key: \"autofillOnPageLoad\",\n      });\n\n      const dismissedAutoFillOnPageLoadCallout: boolean = await helper.getFromUser(userId, {\n        ...autofillSettingsStateDefinition,\n        key: \"autofillOnPageLoadCalloutIsDismissed\",\n      });\n\n      const autoCopyTotp: boolean = await helper.getFromUser(userId, {\n        ...autofillSettingsStateDefinition,\n        key: \"autoCopyTotp\",\n      });\n\n      const activateAutoFillOnPageLoadFromPolicy: InlineMenuVisibilitySetting =\n        await helper.getFromUser(userId, {\n          stateDefinition: {\n            name: \"autofillSettingsLocal\",\n          },\n          key: \"activateAutofillOnPageLoadFromPolicy\",\n        });\n\n      // update new settings and remove the account state provider framework keys for the rolled back values\n      if (autoFillOnPageLoadDefault != null) {\n        settings = { ...settings, autoFillOnPageLoadDefault };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoadDefault\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (enableAutoFillOnPageLoad != null) {\n        settings = { ...settings, enableAutoFillOnPageLoad };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoad\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (dismissedAutoFillOnPageLoadCallout != null) {\n        settings = { ...settings, dismissedAutoFillOnPageLoadCallout };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autofillOnPageLoadCalloutIsDismissed\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (autoCopyTotp != null) {\n        // invert the value to match the new naming convention\n        settings = { ...settings, disableAutoTotpCopy: !autoCopyTotp };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsStateDefinition, key: \"autoCopyTotp\" },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (activateAutoFillOnPageLoadFromPolicy != null) {\n        settings = { ...settings, activateAutoFillOnPageLoadFromPolicy };\n\n        await helper.setToUser(\n          userId,\n          {\n            stateDefinition: {\n              name: \"autofillSettingsLocal\",\n            },\n            key: \"activateAutofillOnPageLoadFromPolicy\",\n          },\n          null,\n        );\n\n        updateAccount = true;\n      }\n\n      if (updateAccount) {\n        // commit updated settings to state\n        await helper.set(userId, {\n          ...account,\n          settings,\n        });\n      }\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    requirePasswordOnStart?: boolean;\n  };\n};\n\n// Biometric text, no auto prompt text, fingerprint validated, and prompt cancelled are refreshed on every app start, so we don't need to migrate them\nexport const REQUIRE_PASSWORD_ON_START: KeyDefinitionLike = {\n  key: \"requirePasswordOnStart\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport class RequirePasswordOnStartMigrator extends Migrator<18, 19> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        // Move account data\n        if (account?.settings?.requirePasswordOnStart != null) {\n          await helper.setToUser(\n            userId,\n            REQUIRE_PASSWORD_ON_START,\n            account.settings.requirePasswordOnStart,\n          );\n\n          // Delete old account data\n          delete account.settings.requirePasswordOnStart;\n          await helper.set(userId, account);\n        }\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      const requirePassword = await helper.getFromUser<boolean>(userId, REQUIRE_PASSWORD_ON_START);\n\n      if (requirePassword) {\n        account ??= {};\n        account.settings ??= {};\n\n        account.settings.requirePasswordOnStart = requirePassword;\n        await helper.setToUser(userId, REQUIRE_PASSWORD_ON_START, null);\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  keys?: {\n    privateKey?: {\n      encrypted?: string; // EncryptedString\n    };\n  };\n};\n\nconst USER_ENCRYPTED_PRIVATE_KEY: KeyDefinitionLike = {\n  key: \"privateKey\",\n  stateDefinition: {\n    name: \"crypto\",\n  },\n};\n\nexport class PrivateKeyMigrator extends Migrator<19, 20> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.keys?.privateKey?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_PRIVATE_KEY, value);\n        delete account.keys.privateKey;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser<Record<string, string>>(\n        userId,\n        USER_ENCRYPTED_PRIVATE_KEY,\n      );\n      if (account && value) {\n        account.keys = Object.assign(account.keys ?? {}, {\n          privateKey: {\n            encrypted: value,\n          },\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_PRIVATE_KEY, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype CollectionDataType = {\n  id: string;\n  organizationId: string;\n  name: string;\n  externalId: string;\n  readOnly: boolean;\n  manage: boolean;\n  hidePasswords: boolean;\n};\n\ntype ExpectedAccountType = {\n  data?: {\n    collections?: {\n      encrypted?: Record<string, CollectionDataType>;\n    };\n  };\n};\n\nconst USER_ENCRYPTED_COLLECTIONS: KeyDefinitionLike = {\n  key: \"collections\",\n  stateDefinition: {\n    name: \"collection\",\n  },\n};\n\nexport class CollectionMigrator extends Migrator<20, 21> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.data?.collections?.encrypted;\n      if (value != null) {\n        await helper.setToUser(userId, USER_ENCRYPTED_COLLECTIONS, value);\n        delete account.data.collections;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, USER_ENCRYPTED_COLLECTIONS);\n      if (account) {\n        account.data = Object.assign(account.data ?? {}, {\n          collections: {\n            encrypted: value,\n          },\n        });\n\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, USER_ENCRYPTED_COLLECTIONS, null);\n    }\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    collapsedGroupings?: string[];\n  };\n};\n\nconst COLLAPSED_GROUPINGS: KeyDefinitionLike = {\n  key: \"collapsedGroupings\",\n  stateDefinition: {\n    name: \"vaultFilter\",\n  },\n};\n\nexport class CollapsedGroupingsMigrator extends Migrator<21, 22> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.settings?.collapsedGroupings;\n      if (value != null) {\n        await helper.setToUser(userId, COLLAPSED_GROUPINGS, value);\n        delete account.settings.collapsedGroupings;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, COLLAPSED_GROUPINGS);\n      if (account) {\n        account.settings = Object.assign(account.settings ?? {}, {\n          collapsedGroupings: value,\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, COLLAPSED_GROUPINGS, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    disableAutoBiometricsPrompt?: boolean;\n    dismissedBiometricRequirePasswordOnStartCallout?: boolean;\n  };\n};\n\n// prompt cancelled is refreshed on every app start/quit/unlock, so we don't need to migrate it\n\nexport const DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT: KeyDefinitionLike = {\n  key: \"dismissedBiometricRequirePasswordOnStartCallout\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport const PROMPT_AUTOMATICALLY: KeyDefinitionLike = {\n  key: \"promptAutomatically\",\n  stateDefinition: { name: \"biometricSettings\" },\n};\n\nexport class MoveBiometricPromptsToStateProviders extends Migrator<22, 23> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        if (account == null) {\n          return;\n        }\n        // Move account data\n\n        if (account?.settings?.dismissedBiometricRequirePasswordOnStartCallout != null) {\n          await helper.setToUser(\n            userId,\n            DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT,\n            account.settings.dismissedBiometricRequirePasswordOnStartCallout,\n          );\n        }\n\n        if (account?.settings?.disableAutoBiometricsPrompt != null) {\n          await helper.setToUser(\n            userId,\n            PROMPT_AUTOMATICALLY,\n            !account.settings.disableAutoBiometricsPrompt,\n          );\n        }\n\n        // Delete old account data\n        delete account?.settings?.dismissedBiometricRequirePasswordOnStartCallout;\n        delete account?.settings?.disableAutoBiometricsPrompt;\n        await helper.set(userId, account);\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      let updatedAccount = false;\n\n      const userDismissed = await helper.getFromUser<boolean>(\n        userId,\n        DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT,\n      );\n\n      if (userDismissed) {\n        account ??= {};\n        account.settings ??= {};\n\n        updatedAccount = true;\n        account.settings.dismissedBiometricRequirePasswordOnStartCallout = userDismissed;\n        await helper.setToUser(userId, DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT, null);\n      }\n\n      const userPromptAutomatically = await helper.getFromUser<boolean>(\n        userId,\n        PROMPT_AUTOMATICALLY,\n      );\n\n      if (userPromptAutomatically != null) {\n        account ??= {};\n        account.settings ??= {};\n\n        updatedAccount = true;\n        account.settings.disableAutoBiometricsPrompt = !userPromptAutomatically;\n        await helper.setToUser(userId, PROMPT_AUTOMATICALLY, null);\n      }\n\n      if (updatedAccount) {\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  settings?: {\n    smOnboardingTasks?: Record<string, Record<string, boolean>>;\n  };\n};\n\nexport const SM_ONBOARDING_TASKS: KeyDefinitionLike = {\n  key: \"tasks\",\n  stateDefinition: { name: \"smOnboarding\" },\n};\n\nexport class SmOnboardingTasksMigrator extends Migrator<23, 24> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const legacyAccounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(\n      legacyAccounts.map(async ({ userId, account }) => {\n        // Move account data\n        if (account?.settings?.smOnboardingTasks != null) {\n          await helper.setToUser(userId, SM_ONBOARDING_TASKS, account.settings.smOnboardingTasks);\n\n          // Delete old account data\n          delete account.settings.smOnboardingTasks;\n          await helper.set(userId, account);\n        }\n      }),\n    );\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    async function rollbackUser(userId: string, account: ExpectedAccountType) {\n      const smOnboardingTasks = await helper.getFromUser<Record<string, Record<string, boolean>>>(\n        userId,\n        SM_ONBOARDING_TASKS,\n      );\n      if (smOnboardingTasks) {\n        account ??= {};\n        account.settings ??= {};\n\n        account.settings.smOnboardingTasks = smOnboardingTasks;\n        await helper.setToUser(userId, SM_ONBOARDING_TASKS, null);\n        await helper.set(userId, account);\n      }\n    }\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    await Promise.all(accounts.map(({ userId, account }) => rollbackUser(userId, account)));\n  }\n}\n","import { ClearClipboardDelaySetting } from \"../../../../../apps/browser/src/autofill/constants\";\nimport { StateDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountState = {\n  settings?: {\n    clearClipboard?: ClearClipboardDelaySetting;\n  };\n};\n\nconst autofillSettingsLocalStateDefinition: {\n  stateDefinition: StateDefinitionLike;\n} = {\n  stateDefinition: {\n    name: \"autofillSettingsLocal\",\n  },\n};\n\nexport class ClearClipboardDelayMigrator extends Migrator<24, 25> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    // account state (e.g. account settings -> state provider framework keys)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n\n    // migrate account state\n    async function migrateAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      const accountSettings = account?.settings;\n\n      if (accountSettings?.clearClipboard !== undefined) {\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsLocalStateDefinition, key: \"clearClipboardDelay\" },\n          accountSettings.clearClipboard,\n        );\n        delete account.settings.clearClipboard;\n\n        // update the state account settings with the migrated values deleted\n        await helper.set(userId, account);\n      }\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    // account state (e.g. state provider framework keys -> account settings)\n    const accounts = await helper.getAccounts<ExpectedAccountState>();\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n\n    // rollback account state\n    async function rollbackAccount(userId: string, account: ExpectedAccountState): Promise<void> {\n      let settings = account?.settings || {};\n\n      const clearClipboardDelay: ClearClipboardDelaySetting = await helper.getFromUser(userId, {\n        ...autofillSettingsLocalStateDefinition,\n        key: \"clearClipboardDelay\",\n      });\n\n      // update new settings and remove the account state provider framework keys for the rolled back values\n      if (clearClipboardDelay !== undefined) {\n        settings = { ...settings, clearClipboard: clearClipboardDelay };\n\n        await helper.setToUser(\n          userId,\n          { ...autofillSettingsLocalStateDefinition, key: \"clearClipboardDelay\" },\n          null,\n        );\n\n        // commit updated settings to state\n        await helper.set(userId, {\n          ...account,\n          settings,\n        });\n      }\n    }\n  }\n}\n","import { KeyDefinitionLike, MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  profile?: {\n    lastSync?: string;\n  };\n};\n\nconst LAST_SYNC_KEY: KeyDefinitionLike = {\n  key: \"lastSync\",\n  stateDefinition: {\n    name: \"sync\",\n  },\n};\n\nexport class RevertLastSyncMigrator extends Migrator<25, 26> {\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function rollbackAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = account?.profile?.lastSync;\n      await helper.setToUser(userId, LAST_SYNC_KEY, value ?? null);\n      if (value != null) {\n        delete account.profile.lastSync;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => rollbackAccount(userId, account))]);\n  }\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function migrateAccount(userId: string, account: ExpectedAccountType): Promise<void> {\n      const value = await helper.getFromUser(userId, LAST_SYNC_KEY);\n      if (account) {\n        account.profile = Object.assign(account.profile ?? {}, {\n          lastSync: value,\n        });\n        await helper.set(userId, account);\n      }\n      await helper.setToUser(userId, LAST_SYNC_KEY, null);\n    }\n\n    await Promise.all([...accounts.map(({ userId, account }) => migrateAccount(userId, account))]);\n  }\n}\n","// eslint-disable-next-line import/no-restricted-paths -- Used for token decoding, which are valid for days. We want the latest\nimport { TokenService } from \"../../auth/services/token.service\";\nimport { MigrationHelper } from \"../migration-helper\";\nimport { Migrator, IRREVERSIBLE, Direction } from \"../migrator\";\n\ntype ExpectedAccountType = {\n  profile?: { hasPremiumPersonally?: boolean };\n  tokens?: { accessToken?: string };\n};\n\nexport class FixPremiumMigrator extends Migrator<2, 3> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function fixPremium(userId: string, account: ExpectedAccountType) {\n      if (account?.profile?.hasPremiumPersonally === null && account.tokens?.accessToken != null) {\n        let decodedToken: { premium: boolean };\n        try {\n          decodedToken = await TokenService.decodeToken(account.tokens.accessToken);\n        } catch {\n          return;\n        }\n\n        if (decodedToken?.premium == null) {\n          return;\n        }\n\n        account.profile.hasPremiumPersonally = decodedToken?.premium;\n        return helper.set(userId, account);\n      }\n    }\n\n    await Promise.all(accounts.map(({ userId, account }) => fixPremium(userId, account)));\n  }\n\n  rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but for this version\n  // it is nested inside a global object.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    const global: Record<string, unknown> = (await helper.get(\"global\")) || {};\n    await helper.set(\"global\", { ...global, stateVersion: endVersion });\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Direction, IRREVERSIBLE, Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = { profile?: { everBeenUnlocked?: boolean } };\n\nexport class RemoveEverBeenUnlockedMigrator extends Migrator<3, 4> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function removeEverBeenUnlocked(userId: string, account: ExpectedAccountType) {\n      if (account?.profile?.everBeenUnlocked != null) {\n        delete account.profile.everBeenUnlocked;\n        return helper.set(userId, account);\n      }\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    Promise.all(accounts.map(({ userId, account }) => removeEverBeenUnlocked(userId, account)));\n  }\n\n  rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but for this version\n  // it is nested inside a global object.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n    await helper.set(\"global\", { ...global, stateVersion: endVersion });\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Direction, Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = { keys?: { organizationKeys?: { encrypted: Record<string, string> } } };\ntype NewAccountType = {\n  keys?: {\n    organizationKeys?: { encrypted: Record<string, { type: \"organization\"; key: string }> };\n  };\n};\n\nexport class AddKeyTypeToOrgKeysMigrator extends Migrator<4, 5> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts();\n\n    async function updateOrgKey(userId: string, account: ExpectedAccountType) {\n      const encryptedOrgKeys = account?.keys?.organizationKeys?.encrypted;\n      if (encryptedOrgKeys == null) {\n        return;\n      }\n\n      const newOrgKeys: Record<string, { type: \"organization\"; key: string }> = {};\n\n      Object.entries(encryptedOrgKeys).forEach(([orgId, encKey]) => {\n        newOrgKeys[orgId] = {\n          type: \"organization\",\n          key: encKey,\n        };\n      });\n      (account as any).keys.organizationKeys.encrypted = newOrgKeys;\n\n      await helper.set(userId, account);\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    Promise.all(accounts.map(({ userId, account }) => updateOrgKey(userId, account)));\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts();\n\n    async function updateOrgKey(userId: string, account: NewAccountType) {\n      const encryptedOrgKeys = account?.keys?.organizationKeys?.encrypted;\n      if (encryptedOrgKeys == null) {\n        return;\n      }\n\n      const newOrgKeys: Record<string, string> = {};\n\n      Object.entries(encryptedOrgKeys).forEach(([orgId, encKey]) => {\n        newOrgKeys[orgId] = encKey.key;\n      });\n      (account as any).keys.organizationKeys.encrypted = newOrgKeys;\n\n      await helper.set(userId, account);\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    Promise.all(accounts.map(async ({ userId, account }) => updateOrgKey(userId, account)));\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but for this version\n  // it is nested inside a global object.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n    await helper.set(\"global\", { ...global, stateVersion: endVersion });\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Direction, IRREVERSIBLE, Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = { keys?: { legacyEtmKey?: string } };\n\nexport class RemoveLegacyEtmKeyMigrator extends Migrator<5, 6> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    async function updateAccount(userId: string, account: ExpectedAccountType) {\n      if (account?.keys?.legacyEtmKey) {\n        delete account.keys.legacyEtmKey;\n        await helper.set(userId, account);\n      }\n    }\n\n    await Promise.all(accounts.map(({ userId, account }) => updateAccount(userId, account)));\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but for this version\n  // it is nested inside a global object.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n    await helper.set(\"global\", { ...global, stateVersion: endVersion });\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Direction, IRREVERSIBLE, Migrator } from \"../migrator\";\n\ntype ExpectedAccountType = { settings?: { disableAutoBiometricsPrompt?: boolean } };\n\nexport class MoveBiometricAutoPromptToAccount extends Migrator<6, 7> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const global = await helper.get<{ noAutoPromptBiometrics?: boolean }>(\"global\");\n    const noAutoPromptBiometrics = global?.noAutoPromptBiometrics ?? false;\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n    async function updateAccount(userId: string, account: ExpectedAccountType) {\n      if (account == null) {\n        return;\n      }\n\n      if (noAutoPromptBiometrics) {\n        account.settings = Object.assign(account?.settings ?? {}, {\n          disableAutoBiometricsPrompt: true,\n        });\n        await helper.set(userId, account);\n      }\n    }\n\n    delete global.noAutoPromptBiometrics;\n\n    await Promise.all([\n      ...accounts.map(({ userId, account }) => updateAccount(userId, account)),\n      helper.set(\"global\", global),\n    ]);\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but for this version\n  // it is nested inside a global object.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n    await helper.set(\"global\", { ...global, stateVersion: endVersion });\n  }\n}\n","import { JsonObject } from \"type-fest\";\n\nimport { MigrationHelper } from \"../migration-helper\";\nimport { Direction, Migrator } from \"../migrator\";\n\nexport class MoveStateVersionMigrator extends Migrator<7, 8> {\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const global = await helper.get<{ stateVersion: number }>(\"global\");\n    if (global.stateVersion) {\n      await helper.set(\"stateVersion\", global.stateVersion);\n      delete global.stateVersion;\n      await helper.set(\"global\", global);\n    } else {\n      throw new Error(\"Migration failed, state version not found\");\n    }\n  }\n\n  async rollback(helper: MigrationHelper): Promise<void> {\n    const version = await helper.get<number>(\"stateVersion\");\n    const global = await helper.get<JsonObject>(\"global\");\n    await helper.set(\"global\", { ...global, stateVersion: version });\n    await helper.set(\"stateVersion\", undefined);\n  }\n\n  // Override is necessary because default implementation assumes `stateVersion` at the root, but this migration moves\n  // it from a `global` object to root.This makes for unique rollback versioning.\n  override async updateVersion(helper: MigrationHelper, direction: Direction): Promise<void> {\n    const endVersion = direction === \"up\" ? this.toVersion : this.fromVersion;\n    helper.currentVersion = endVersion;\n    if (direction === \"up\") {\n      await helper.set(\"stateVersion\", endVersion);\n    } else {\n      const global: { stateVersion: number } = (await helper.get(\"global\")) || ({} as any);\n      await helper.set(\"global\", { ...global, stateVersion: endVersion });\n    }\n  }\n}\n","import { MigrationHelper } from \"../migration-helper\";\nimport { Migrator } from \"../migrator\";\n\ntype NeverDomains = { [id: string]: unknown };\n\ntype ExpectedAccountType = {\n  settings?: {\n    neverDomains?: NeverDomains;\n    disableAddLoginNotification?: boolean;\n    disableChangedPasswordNotification?: boolean;\n    disableContextMenuItem?: boolean;\n  };\n};\n\ntype TargetGlobalState = {\n  neverDomains?: NeverDomains;\n  disableAddLoginNotification?: boolean;\n  disableChangedPasswordNotification?: boolean;\n  disableContextMenuItem?: boolean;\n};\n\nexport class MoveBrowserSettingsToGlobal extends Migrator<8, 9> {\n  // Will first check if any of the accounts have a value from the given accountSelector\n  // if they do have a value it will set that value into global state but if multiple\n  // users have differing values it will prefer the false setting,\n  // if all users have true then it will take true.\n  tryAddSetting(\n    accounts: { userId: string; account: ExpectedAccountType }[],\n    accountSelector: (account: ExpectedAccountType) => boolean | undefined,\n    globalSetter: (value: boolean | undefined) => void,\n  ): void {\n    const hasValue = accounts.some(({ account }) => {\n      return accountSelector(account) !== undefined;\n    });\n\n    if (hasValue) {\n      const value = !accounts.some(({ account }) => {\n        return (accountSelector(account) ?? false) === false;\n      });\n\n      globalSetter(value);\n    }\n  }\n\n  async migrate(helper: MigrationHelper): Promise<void> {\n    const global = await helper.get<object>(\"global\");\n\n    const accounts = await helper.getAccounts<ExpectedAccountType>();\n\n    const globalNeverDomainsValue = accounts.reduce((accumulator, { account }) => {\n      const normalizedNeverDomains = account.settings?.neverDomains ?? {};\n      for (const [id, value] of Object.entries(normalizedNeverDomains)) {\n        accumulator ??= {};\n        accumulator[id] = value;\n      }\n      return accumulator;\n    }, undefined as NeverDomains);\n\n    const targetGlobalState: TargetGlobalState = {};\n\n    if (globalNeverDomainsValue != null) {\n      targetGlobalState.neverDomains = globalNeverDomainsValue;\n    }\n\n    this.tryAddSetting(\n      accounts,\n      (a) => a.settings?.disableAddLoginNotification,\n      (v) => (targetGlobalState.disableAddLoginNotification = v),\n    );\n\n    this.tryAddSetting(\n      accounts,\n      (a) => a.settings?.disableChangedPasswordNotification,\n      (v) => (targetGlobalState.disableChangedPasswordNotification = v),\n    );\n\n    this.tryAddSetting(\n      accounts,\n      (a) => a.settings?.disableContextMenuItem,\n      (v) => (targetGlobalState.disableContextMenuItem = v),\n    );\n\n    await helper.set<TargetGlobalState>(\"global\", {\n      ...global,\n      ...targetGlobalState,\n    });\n\n    await Promise.all(\n      accounts.map(async ({ userId, account }) => {\n        delete account.settings?.disableAddLoginNotification;\n        delete account.settings?.disableChangedPasswordNotification;\n        delete account.settings?.disableContextMenuItem;\n        delete account.settings?.neverDomains;\n        await helper.set(userId, account);\n      }),\n    );\n  }\n\n  rollback(helper: MigrationHelper): Promise<void> {\n    throw new Error(\"Method not implemented.\");\n  }\n}\n","import { MinVersion, MIN_VERSION } from \"../migrate\";\nimport { MigrationHelper } from \"../migration-helper\";\nimport { IRREVERSIBLE, Migrator } from \"../migrator\";\n\nexport function minVersionError(current: number) {\n  return `Your local data is too old to be migrated. Your current state version is ${current}, but minimum version is ${MIN_VERSION}.`;\n}\n\nexport class MinVersionMigrator extends Migrator<0, MinVersion> {\n  constructor() {\n    super(0, MIN_VERSION);\n  }\n\n  // Overrides the default implementation to catch any version that may be passed in.\n  override shouldMigrate(helper: MigrationHelper): Promise<boolean> {\n    return Promise.resolve(helper.currentVersion < MIN_VERSION);\n  }\n  async migrate(helper: MigrationHelper): Promise<void> {\n    if (helper.currentVersion < MIN_VERSION) {\n      throw new Error(minVersionError(helper.currentVersion));\n    }\n  }\n  async rollback(helper: MigrationHelper): Promise<void> {\n    throw IRREVERSIBLE;\n  }\n}\n","// eslint-disable-next-line import/no-restricted-paths -- Needed to print log messages\nimport { LogService } from \"../platform/abstractions/log.service\";\n// eslint-disable-next-line import/no-restricted-paths -- Needed to interface with storage locations\nimport { AbstractStorageService } from \"../platform/abstractions/storage.service\";\n\nimport { MigrationBuilder } from \"./migration-builder\";\nimport { EverHadUserKeyMigrator } from \"./migrations/10-move-ever-had-user-key-to-state-providers\";\nimport { OrganizationKeyMigrator } from \"./migrations/11-move-org-keys-to-state-providers\";\nimport { MoveEnvironmentStateToProviders } from \"./migrations/12-move-environment-state-to-providers\";\nimport { ProviderKeyMigrator } from \"./migrations/13-move-provider-keys-to-state-providers\";\nimport { MoveBiometricClientKeyHalfToStateProviders } from \"./migrations/14-move-biometric-client-key-half-state-to-providers\";\nimport { FolderMigrator } from \"./migrations/15-move-folder-state-to-state-provider\";\nimport { LastSyncMigrator } from \"./migrations/16-move-last-sync-to-state-provider\";\nimport { EnablePasskeysMigrator } from \"./migrations/17-move-enable-passkeys-to-state-providers\";\nimport { AutofillSettingsKeyMigrator } from \"./migrations/18-move-autofill-settings-to-state-providers\";\nimport { RequirePasswordOnStartMigrator } from \"./migrations/19-migrate-require-password-on-start\";\nimport { PrivateKeyMigrator } from \"./migrations/20-move-private-key-to-state-providers\";\nimport { CollectionMigrator } from \"./migrations/21-move-collections-state-to-state-provider\";\nimport { CollapsedGroupingsMigrator } from \"./migrations/22-move-collapsed-groupings-to-state-provider\";\nimport { MoveBiometricPromptsToStateProviders } from \"./migrations/23-move-biometric-prompts-to-state-providers\";\nimport { SmOnboardingTasksMigrator } from \"./migrations/24-move-sm-onboarding-key-to-state-providers\";\nimport { ClearClipboardDelayMigrator } from \"./migrations/25-move-clear-clipboard-to-autofill-settings-state-provider\";\nimport { RevertLastSyncMigrator } from \"./migrations/26-revert-move-last-sync-to-state-provider\";\nimport { FixPremiumMigrator } from \"./migrations/3-fix-premium\";\nimport { RemoveEverBeenUnlockedMigrator } from \"./migrations/4-remove-ever-been-unlocked\";\nimport { AddKeyTypeToOrgKeysMigrator } from \"./migrations/5-add-key-type-to-org-keys\";\nimport { RemoveLegacyEtmKeyMigrator } from \"./migrations/6-remove-legacy-etm-key\";\nimport { MoveBiometricAutoPromptToAccount } from \"./migrations/7-move-biometric-auto-prompt-to-account\";\nimport { MoveStateVersionMigrator } from \"./migrations/8-move-state-version\";\nimport { MoveBrowserSettingsToGlobal } from \"./migrations/9-move-browser-settings-to-global\";\nimport { MinVersionMigrator } from \"./migrations/min-version\";\n\nexport const MIN_VERSION = 2;\nexport const CURRENT_VERSION = 26;\nexport type MinVersion = typeof MIN_VERSION;\n\nexport function createMigrationBuilder() {\n  return MigrationBuilder.create()\n    .with(MinVersionMigrator)\n    .with(FixPremiumMigrator, 2, 3)\n    .with(RemoveEverBeenUnlockedMigrator, 3, 4)\n    .with(AddKeyTypeToOrgKeysMigrator, 4, 5)\n    .with(RemoveLegacyEtmKeyMigrator, 5, 6)\n    .with(MoveBiometricAutoPromptToAccount, 6, 7)\n    .with(MoveStateVersionMigrator, 7, 8)\n    .with(MoveBrowserSettingsToGlobal, 8, 9)\n    .with(EverHadUserKeyMigrator, 9, 10)\n    .with(OrganizationKeyMigrator, 10, 11)\n    .with(MoveEnvironmentStateToProviders, 11, 12)\n    .with(ProviderKeyMigrator, 12, 13)\n    .with(MoveBiometricClientKeyHalfToStateProviders, 13, 14)\n    .with(FolderMigrator, 14, 15)\n    .with(LastSyncMigrator, 15, 16)\n    .with(EnablePasskeysMigrator, 16, 17)\n    .with(AutofillSettingsKeyMigrator, 17, 18)\n    .with(RequirePasswordOnStartMigrator, 18, 19)\n    .with(PrivateKeyMigrator, 19, 20)\n    .with(CollectionMigrator, 20, 21)\n    .with(CollapsedGroupingsMigrator, 21, 22)\n    .with(MoveBiometricPromptsToStateProviders, 22, 23)\n    .with(SmOnboardingTasksMigrator, 23, 24)\n    .with(ClearClipboardDelayMigrator, 24, 25)\n    .with(RevertLastSyncMigrator, 25, 26);\n}\n\nexport async function currentVersion(\n  storageService: AbstractStorageService,\n  logService: LogService,\n) {\n  let state = await storageService.get<number>(\"stateVersion\");\n  if (state == null) {\n    // Pre v8\n    state = (await storageService.get<{ stateVersion: number }>(\"global\"))?.stateVersion;\n  }\n  if (state == null) {\n    logService.info(\"No state version found, assuming empty state.\");\n    return -1;\n  }\n  logService.info(`State version: ${state}`);\n  return state;\n}\n\n/**\n * Waits for migrations to have a chance to run and will resolve the promise once they are.\n *\n * @param storageService Disk storage where the `stateVersion` will or is already saved in.\n * @param logService Log service\n */\nexport async function waitForMigrations(\n  storageService: AbstractStorageService,\n  logService: LogService,\n) {\n  const isReady = async () => {\n    const version = await currentVersion(storageService, logService);\n    // The saved version is what we consider the latest\n    // migrations should be complete\n    return version === CURRENT_VERSION;\n  };\n\n  const wait = async (time: number) => {\n    // Wait exponentially\n    const nextTime = time * 2;\n    if (nextTime > 8192) {\n      // Don't wait longer than ~8 seconds in a single wait,\n      // if the migrations still haven't happened. They aren't\n      // likely to.\n      return;\n    }\n    return new Promise<void>((resolve) => {\n      setTimeout(async () => {\n        if (!(await isReady())) {\n          logService.info(`Waiting for migrations to finish, waiting for ${nextTime}ms`);\n          await wait(nextTime);\n        }\n        resolve();\n      }, time);\n    });\n  };\n\n  if (!(await isReady())) {\n    // Wait for 2ms to start with\n    await wait(2);\n  }\n}\n","import { createMigrationBuilder } from \"../../state-migrations\";\nimport { MigrationBuilder } from \"../../state-migrations/migration-builder\";\n\nexport class MigrationBuilderService {\n  private migrationBuilderCache: MigrationBuilder;\n\n  build() {\n    return (this.migrationBuilderCache ??= createMigrationBuilder());\n  }\n}\n","// eslint-disable-next-line import/no-restricted-paths -- Needed to print log messages\nimport { LogService } from \"../platform/abstractions/log.service\";\n// eslint-disable-next-line import/no-restricted-paths -- Needed to interface with storage locations\nimport { AbstractStorageService } from \"../platform/abstractions/storage.service\";\n\nexport type StateDefinitionLike = { name: string };\nexport type KeyDefinitionLike = {\n  stateDefinition: StateDefinitionLike;\n  key: string;\n};\n\nexport class MigrationHelper {\n  constructor(\n    public currentVersion: number,\n    private storageService: AbstractStorageService,\n    public logService: LogService,\n  ) {}\n\n  /**\n   * Gets a value from the storage service at the given key.\n   *\n   * This is a brute force method to just get a value from the storage service. If you can use {@link getFromGlobal} or {@link getFromUser}, you should.\n   * @param key location\n   * @returns the value at the location\n   */\n  get<T>(key: string): Promise<T> {\n    return this.storageService.get<T>(key);\n  }\n\n  /**\n   * Sets a value in the storage service at the given key.\n   *\n   * This is a brute force method to just set a value in the storage service. If you can use {@link setToGlobal} or {@link setToUser}, you should.\n   * @param key location\n   * @param value the value to set\n   * @returns\n   */\n  set<T>(key: string, value: T): Promise<void> {\n    this.logService.info(`Setting ${key}`);\n    return this.storageService.save(key, value);\n  }\n\n  /**\n   * Remove a value in the storage service at the given key.\n   *\n   * This is a brute force method to just remove a value in the storage service. If you can use {@link removeFromGlobal} or {@link removeFromUser}, you should.\n   * @param key location\n   * @returns void\n   */\n  remove(key: string): Promise<void> {\n    this.logService.info(`Removing ${key}`);\n    return this.storageService.remove(key);\n  }\n\n  /**\n   * Gets a globally scoped value from a location derived through the key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link get} for those.\n   * @param keyDefinition unique key definition\n   * @returns value from store\n   */\n  getFromGlobal<T>(keyDefinition: KeyDefinitionLike): Promise<T> {\n    return this.get<T>(this.getGlobalKey(keyDefinition));\n  }\n\n  /**\n   * Sets a globally scoped value to a location derived through the key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link set} for those.\n   * @param keyDefinition unique key definition\n   * @param value value to store\n   * @returns void\n   */\n  setToGlobal<T>(keyDefinition: KeyDefinitionLike, value: T): Promise<void> {\n    return this.set(this.getGlobalKey(keyDefinition), value);\n  }\n\n  /**\n   * Remove a globally scoped location derived through the key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link remove} for those.\n   * @param keyDefinition unique key definition\n   * @returns void\n   */\n  removeFromGlobal(keyDefinition: KeyDefinitionLike): Promise<void> {\n    return this.remove(this.getGlobalKey(keyDefinition));\n  }\n\n  /**\n   * Gets a user scoped value from a location derived through the user id and key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link get} for those.\n   * @param userId userId to use in the key\n   * @param keyDefinition unique key definition\n   * @returns value from store\n   */\n  getFromUser<T>(userId: string, keyDefinition: KeyDefinitionLike): Promise<T> {\n    return this.get<T>(this.getUserKey(userId, keyDefinition));\n  }\n\n  /**\n   * Sets a user scoped value to a location derived through the user id and key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link set} for those.\n   * @param userId userId to use in the key\n   * @param keyDefinition unique key definition\n   * @param value value to store\n   * @returns void\n   */\n  setToUser<T>(userId: string, keyDefinition: KeyDefinitionLike, value: T): Promise<void> {\n    return this.set(this.getUserKey(userId, keyDefinition), value);\n  }\n\n  /**\n   * Remove a user scoped location derived through the key definition\n   *\n   * This is for use with the state providers framework, DO NOT use for values stored with {@link StateService},\n   * use {@link remove} for those.\n   * @param keyDefinition unique key definition\n   * @returns void\n   */\n  removeFromUser(userId: string, keyDefinition: KeyDefinitionLike): Promise<void> {\n    return this.remove(this.getUserKey(userId, keyDefinition));\n  }\n\n  info(message: string): void {\n    this.logService.info(message);\n  }\n\n  /**\n   * Helper method to read all Account objects stored by the State Service.\n   *\n   * This is useful from creating migrations off of this paradigm, but should not be used once a value is migrated to a state provider.\n   *\n   * @returns a list of all accounts that have been authenticated with state service, cast the the expected type.\n   */\n  async getAccounts<ExpectedAccountType>(): Promise<\n    { userId: string; account: ExpectedAccountType }[]\n  > {\n    const userIds = (await this.get<string[]>(\"authenticatedAccounts\")) ?? [];\n    return Promise.all(\n      userIds.map(async (userId) => ({\n        userId,\n        account: await this.get<ExpectedAccountType>(userId),\n      })),\n    );\n  }\n\n  /**\n   * Builds a user storage key appropriate for the current version.\n   *\n   * @param userId userId to use in the key\n   * @param keyDefinition state and key to use in the key\n   * @returns\n   */\n  private getUserKey(userId: string, keyDefinition: KeyDefinitionLike): string {\n    if (this.currentVersion < 9) {\n      return userKeyBuilderPre9();\n    } else {\n      return userKeyBuilder(userId, keyDefinition);\n    }\n  }\n\n  /**\n   * Builds a global storage key appropriate for the current version.\n   *\n   * @param keyDefinition state and key to use in the key\n   * @returns\n   */\n  private getGlobalKey(keyDefinition: KeyDefinitionLike): string {\n    if (this.currentVersion < 9) {\n      return globalKeyBuilderPre9();\n    } else {\n      return globalKeyBuilder(keyDefinition);\n    }\n  }\n}\n\n/**\n * When this is updated, rename this function to `userKeyBuilderXToY` where `X` is the version number it\n * became relevant, and `Y` prior to the version it was updated.\n *\n * Be sure to update the map in `MigrationHelper` to point to the appropriate function for the current version.\n * @param userId The userId of the user you want the key to be for.\n * @param keyDefinition the key definition of which data the key should point to.\n * @returns\n */\nfunction userKeyBuilder(userId: string, keyDefinition: KeyDefinitionLike): string {\n  return `user_${userId}_${keyDefinition.stateDefinition.name}_${keyDefinition.key}`;\n}\n\nfunction userKeyBuilderPre9(): string {\n  throw Error(\"No key builder should be used for versions prior to 9.\");\n}\n\n/**\n * When this is updated, rename this function to `globalKeyBuilderXToY` where `X` is the version number\n * it became relevant, and `Y` prior to the version it was updated.\n *\n * Be sure to update the map in `MigrationHelper` to point to the appropriate function for the current version.\n * @param keyDefinition the key definition of which data the key should point to.\n * @returns\n */\nfunction globalKeyBuilder(keyDefinition: KeyDefinitionLike): string {\n  return `global_${keyDefinition.stateDefinition.name}_${keyDefinition.key}`;\n}\n\nfunction globalKeyBuilderPre9(): string {\n  throw Error(\"No key builder should be used for versions prior to 9.\");\n}\n","import { waitForMigrations } from \"../../state-migrations\";\nimport { CURRENT_VERSION, currentVersion } from \"../../state-migrations/migrate\";\nimport { MigrationHelper } from \"../../state-migrations/migration-helper\";\nimport { LogService } from \"../abstractions/log.service\";\nimport { AbstractStorageService } from \"../abstractions/storage.service\";\n\nimport { MigrationBuilderService } from \"./migration-builder.service\";\n\nexport class MigrationRunner {\n  constructor(\n    protected diskStorage: AbstractStorageService,\n    protected logService: LogService,\n    protected migrationBuilderService: MigrationBuilderService,\n  ) {}\n\n  async run(): Promise<void> {\n    const migrationHelper = new MigrationHelper(\n      await currentVersion(this.diskStorage, this.logService),\n      this.diskStorage,\n      this.logService,\n    );\n\n    if (migrationHelper.currentVersion < 0) {\n      // Cannot determine state, assuming empty so we don't repeatedly apply a migration.\n      await this.diskStorage.save(\"stateVersion\", CURRENT_VERSION);\n      return;\n    }\n\n    const migrationBuilder = this.migrationBuilderService.build();\n\n    await migrationBuilder.migrate(migrationHelper);\n  }\n\n  async waitForCompletion(): Promise<void> {\n    await waitForMigrations(this.diskStorage, this.logService);\n  }\n}\n","export enum VaultTimeoutAction {\n  Lock = \"lock\",\n  LogOut = \"logOut\",\n}\n","import { firstValueFrom, timeout } from \"rxjs\";\n\nimport { VaultTimeoutSettingsService } from \"../../abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { AuthService } from \"../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../auth/enums/authentication-status\";\nimport { AutofillSettingsServiceAbstraction } from \"../../autofill/services/autofill-settings.service\";\nimport { VaultTimeoutAction } from \"../../enums/vault-timeout-action.enum\";\nimport { MessagingService } from \"../abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"../abstractions/platform-utils.service\";\nimport { StateService } from \"../abstractions/state.service\";\nimport { SystemService as SystemServiceAbstraction } from \"../abstractions/system.service\";\nimport { Utils } from \"../misc/utils\";\n\nexport class SystemService implements SystemServiceAbstraction {\n  private reloadInterval: any = null;\n  private clearClipboardTimeout: any = null;\n  private clearClipboardTimeoutFunction: () => Promise<any> = null;\n\n  constructor(\n    private messagingService: MessagingService,\n    private platformUtilsService: PlatformUtilsService,\n    private reloadCallback: () => Promise<void> = null,\n    private stateService: StateService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private vaultTimeoutSettingsService: VaultTimeoutSettingsService,\n  ) {}\n\n  async startProcessReload(authService: AuthService): Promise<void> {\n    const accounts = await firstValueFrom(this.stateService.accounts$);\n    if (accounts != null) {\n      const keys = Object.keys(accounts);\n      if (keys.length > 0) {\n        for (const userId of keys) {\n          if ((await authService.getAuthStatus(userId)) === AuthenticationStatus.Unlocked) {\n            return;\n          }\n        }\n      }\n    }\n\n    // A reloadInterval has already been set and is executing\n    if (this.reloadInterval != null) {\n      return;\n    }\n\n    // User has set a PIN, with ask for master password on restart, to protect their vault\n    const ephemeralPin = await this.stateService.getPinKeyEncryptedUserKeyEphemeral();\n    if (ephemeralPin != null) {\n      return;\n    }\n\n    this.cancelProcessReload();\n    await this.executeProcessReload();\n  }\n\n  private async executeProcessReload() {\n    const biometricLockedFingerprintValidated =\n      await this.stateService.getBiometricFingerprintValidated();\n    if (!biometricLockedFingerprintValidated) {\n      clearInterval(this.reloadInterval);\n      this.reloadInterval = null;\n\n      const currentUser = await firstValueFrom(this.stateService.activeAccount$.pipe(timeout(500)));\n      // Replace current active user if they will be logged out on reload\n      if (currentUser != null) {\n        const timeoutAction = await firstValueFrom(\n          this.vaultTimeoutSettingsService.vaultTimeoutAction$().pipe(timeout(500)),\n        );\n        if (timeoutAction === VaultTimeoutAction.LogOut) {\n          const nextUser = await this.stateService.nextUpActiveUser();\n          await this.stateService.setActiveUser(nextUser);\n        }\n      }\n\n      this.messagingService.send(\"reloadProcess\");\n      if (this.reloadCallback != null) {\n        await this.reloadCallback();\n      }\n      return;\n    }\n    if (this.reloadInterval == null) {\n      this.reloadInterval = setInterval(async () => await this.executeProcessReload(), 1000);\n    }\n  }\n\n  cancelProcessReload(): void {\n    if (this.reloadInterval != null) {\n      clearInterval(this.reloadInterval);\n      this.reloadInterval = null;\n    }\n  }\n\n  async clearClipboard(clipboardValue: string, timeoutMs: number = null): Promise<void> {\n    if (this.clearClipboardTimeout != null) {\n      clearTimeout(this.clearClipboardTimeout);\n      this.clearClipboardTimeout = null;\n    }\n\n    if (Utils.isNullOrWhitespace(clipboardValue)) {\n      return;\n    }\n\n    const clearClipboardDelay = await firstValueFrom(\n      this.autofillSettingsService.clearClipboardDelay$,\n    );\n\n    if (clearClipboardDelay == null) {\n      return;\n    }\n\n    if (timeoutMs == null) {\n      timeoutMs = clearClipboardDelay * 1000;\n    }\n\n    this.clearClipboardTimeoutFunction = async () => {\n      const clipboardValueNow = await this.platformUtilsService.readFromClipboard();\n      if (clipboardValue === clipboardValueNow) {\n        this.platformUtilsService.copyToClipboard(\"\", { clearing: true });\n      }\n    };\n\n    this.clearClipboardTimeout = setTimeout(async () => {\n      await this.clearPendingClipboard();\n    }, timeoutMs);\n  }\n\n  async clearPendingClipboard() {\n    if (this.clearClipboardTimeoutFunction != null) {\n      await this.clearClipboardTimeoutFunction();\n      this.clearClipboardTimeoutFunction = null;\n    }\n  }\n}\n","export class DecryptParameters<T> {\n  encKey: T;\n  data: T;\n  iv: T;\n  macKey: T;\n  mac: T;\n  macData: T;\n}\n","import * as argon2 from \"argon2-browser\";\nimport * as forge from \"node-forge\";\n\nimport { Utils } from \"../../platform/misc/utils\";\nimport { CsprngArray } from \"../../types/csprng\";\nimport { CryptoFunctionService } from \"../abstractions/crypto-function.service\";\nimport { DecryptParameters } from \"../models/domain/decrypt-parameters\";\nimport { SymmetricCryptoKey } from \"../models/domain/symmetric-crypto-key\";\n\nexport class WebCryptoFunctionService implements CryptoFunctionService {\n  private crypto: Crypto;\n  private subtle: SubtleCrypto;\n  private wasmSupported: boolean;\n\n  constructor(globalContext: Window | typeof global) {\n    this.crypto = typeof globalContext.crypto !== \"undefined\" ? globalContext.crypto : null;\n    this.subtle =\n      !!this.crypto && typeof this.crypto.subtle !== \"undefined\" ? this.crypto.subtle : null;\n    this.wasmSupported = this.checkIfWasmSupported();\n  }\n\n  async pbkdf2(\n    password: string | Uint8Array,\n    salt: string | Uint8Array,\n    algorithm: \"sha256\" | \"sha512\",\n    iterations: number,\n  ): Promise<Uint8Array> {\n    const wcLen = algorithm === \"sha256\" ? 256 : 512;\n    const passwordBuf = this.toBuf(password);\n    const saltBuf = this.toBuf(salt);\n\n    const pbkdf2Params: Pbkdf2Params = {\n      name: \"PBKDF2\",\n      salt: saltBuf,\n      iterations: iterations,\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n\n    const impKey = await this.subtle.importKey(\n      \"raw\",\n      passwordBuf,\n      { name: \"PBKDF2\" } as any,\n      false,\n      [\"deriveBits\"],\n    );\n    const buffer = await this.subtle.deriveBits(pbkdf2Params as any, impKey, wcLen);\n    return new Uint8Array(buffer);\n  }\n\n  async argon2(\n    password: string | Uint8Array,\n    salt: string | Uint8Array,\n    iterations: number,\n    memory: number,\n    parallelism: number,\n  ): Promise<Uint8Array> {\n    if (!this.wasmSupported) {\n      throw \"Webassembly support is required for the Argon2 KDF feature.\";\n    }\n\n    const passwordArr = new Uint8Array(this.toBuf(password));\n    const saltArr = new Uint8Array(this.toBuf(salt));\n\n    const result = await argon2.hash({\n      pass: passwordArr,\n      salt: saltArr,\n      time: iterations,\n      mem: memory,\n      parallelism: parallelism,\n      hashLen: 32,\n      type: argon2.ArgonType.Argon2id,\n    });\n    argon2.unloadRuntime();\n    return result.hash;\n  }\n\n  async hkdf(\n    ikm: Uint8Array,\n    salt: string | Uint8Array,\n    info: string | Uint8Array,\n    outputByteSize: number,\n    algorithm: \"sha256\" | \"sha512\",\n  ): Promise<Uint8Array> {\n    const saltBuf = this.toBuf(salt);\n    const infoBuf = this.toBuf(info);\n\n    const hkdfParams: HkdfParams = {\n      name: \"HKDF\",\n      salt: saltBuf,\n      info: infoBuf,\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n\n    const impKey = await this.subtle.importKey(\"raw\", ikm, { name: \"HKDF\" } as any, false, [\n      \"deriveBits\",\n    ]);\n    const buffer = await this.subtle.deriveBits(hkdfParams as any, impKey, outputByteSize * 8);\n    return new Uint8Array(buffer);\n  }\n\n  // ref: https://tools.ietf.org/html/rfc5869\n  async hkdfExpand(\n    prk: Uint8Array,\n    info: string | Uint8Array,\n    outputByteSize: number,\n    algorithm: \"sha256\" | \"sha512\",\n  ): Promise<Uint8Array> {\n    const hashLen = algorithm === \"sha256\" ? 32 : 64;\n    if (outputByteSize > 255 * hashLen) {\n      throw new Error(\"outputByteSize is too large.\");\n    }\n    const prkArr = new Uint8Array(prk);\n    if (prkArr.length < hashLen) {\n      throw new Error(\"prk is too small.\");\n    }\n    const infoBuf = this.toBuf(info);\n    const infoArr = new Uint8Array(infoBuf);\n    let runningOkmLength = 0;\n    let previousT = new Uint8Array(0);\n    const n = Math.ceil(outputByteSize / hashLen);\n    const okm = new Uint8Array(n * hashLen);\n    for (let i = 0; i < n; i++) {\n      const t = new Uint8Array(previousT.length + infoArr.length + 1);\n      t.set(previousT);\n      t.set(infoArr, previousT.length);\n      t.set([i + 1], t.length - 1);\n      previousT = new Uint8Array(await this.hmac(t, prk, algorithm));\n      okm.set(previousT, runningOkmLength);\n      runningOkmLength += previousT.length;\n      if (runningOkmLength >= outputByteSize) {\n        break;\n      }\n    }\n    return okm.slice(0, outputByteSize);\n  }\n\n  async hash(\n    value: string | Uint8Array,\n    algorithm: \"sha1\" | \"sha256\" | \"sha512\" | \"md5\",\n  ): Promise<Uint8Array> {\n    if (algorithm === \"md5\") {\n      const md = forge.md.md5.create();\n      const valueBytes = this.toByteString(value);\n      md.update(valueBytes, \"raw\");\n      return Utils.fromByteStringToArray(md.digest().data);\n    }\n\n    const valueBuf = this.toBuf(value);\n    const buffer = await this.subtle.digest(\n      { name: this.toWebCryptoAlgorithm(algorithm) },\n      valueBuf,\n    );\n    return new Uint8Array(buffer);\n  }\n\n  async hmac(\n    value: Uint8Array,\n    key: Uint8Array,\n    algorithm: \"sha1\" | \"sha256\" | \"sha512\",\n  ): Promise<Uint8Array> {\n    const signingAlgorithm = {\n      name: \"HMAC\",\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n\n    const impKey = await this.subtle.importKey(\"raw\", key, signingAlgorithm, false, [\"sign\"]);\n    const buffer = await this.subtle.sign(signingAlgorithm, impKey, value);\n    return new Uint8Array(buffer);\n  }\n\n  // Safely compare two values in a way that protects against timing attacks (Double HMAC Verification).\n  // ref: https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2011/february/double-hmac-verification/\n  // ref: https://paragonie.com/blog/2015/11/preventing-timing-attacks-on-string-comparison-with-double-hmac-strategy\n  async compare(a: Uint8Array, b: Uint8Array): Promise<boolean> {\n    const macKey = await this.randomBytes(32);\n    const signingAlgorithm = {\n      name: \"HMAC\",\n      hash: { name: \"SHA-256\" },\n    };\n    const impKey = await this.subtle.importKey(\"raw\", macKey, signingAlgorithm, false, [\"sign\"]);\n    const mac1 = await this.subtle.sign(signingAlgorithm, impKey, a);\n    const mac2 = await this.subtle.sign(signingAlgorithm, impKey, b);\n\n    if (mac1.byteLength !== mac2.byteLength) {\n      return false;\n    }\n\n    const arr1 = new Uint8Array(mac1);\n    const arr2 = new Uint8Array(mac2);\n    for (let i = 0; i < arr2.length; i++) {\n      if (arr1[i] !== arr2[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  hmacFast(value: string, key: string, algorithm: \"sha1\" | \"sha256\" | \"sha512\"): Promise<string> {\n    const hmac = forge.hmac.create();\n    hmac.start(algorithm, key);\n    hmac.update(value);\n    const bytes = hmac.digest().getBytes();\n    return Promise.resolve(bytes);\n  }\n\n  async compareFast(a: string, b: string): Promise<boolean> {\n    const rand = await this.randomBytes(32);\n    const bytes = new Uint32Array(rand);\n    const buffer = forge.util.createBuffer();\n    for (let i = 0; i < bytes.length; i++) {\n      buffer.putInt32(bytes[i]);\n    }\n    const macKey = buffer.getBytes();\n\n    const hmac = forge.hmac.create();\n    hmac.start(\"sha256\", macKey);\n    hmac.update(a);\n    const mac1 = hmac.digest().getBytes();\n\n    hmac.start(null, null);\n    hmac.update(b);\n    const mac2 = hmac.digest().getBytes();\n\n    const equals = mac1 === mac2;\n    return equals;\n  }\n\n  async aesEncrypt(data: Uint8Array, iv: Uint8Array, key: Uint8Array): Promise<Uint8Array> {\n    const impKey = await this.subtle.importKey(\"raw\", key, { name: \"AES-CBC\" } as any, false, [\n      \"encrypt\",\n    ]);\n    const buffer = await this.subtle.encrypt({ name: \"AES-CBC\", iv: iv }, impKey, data);\n    return new Uint8Array(buffer);\n  }\n\n  aesDecryptFastParameters(\n    data: string,\n    iv: string,\n    mac: string,\n    key: SymmetricCryptoKey,\n  ): DecryptParameters<string> {\n    const p = new DecryptParameters<string>();\n    if (key.meta != null) {\n      p.encKey = key.meta.encKeyByteString;\n      p.macKey = key.meta.macKeyByteString;\n    }\n\n    if (p.encKey == null) {\n      p.encKey = forge.util.decode64(key.encKeyB64);\n    }\n    p.data = forge.util.decode64(data);\n    p.iv = forge.util.decode64(iv);\n    p.macData = p.iv + p.data;\n    if (p.macKey == null && key.macKeyB64 != null) {\n      p.macKey = forge.util.decode64(key.macKeyB64);\n    }\n    if (mac != null) {\n      p.mac = forge.util.decode64(mac);\n    }\n\n    // cache byte string keys for later\n    if (key.meta == null) {\n      key.meta = {};\n    }\n    if (key.meta.encKeyByteString == null) {\n      key.meta.encKeyByteString = p.encKey;\n    }\n    if (p.macKey != null && key.meta.macKeyByteString == null) {\n      key.meta.macKeyByteString = p.macKey;\n    }\n\n    return p;\n  }\n\n  aesDecryptFast(parameters: DecryptParameters<string>, mode: \"cbc\" | \"ecb\"): Promise<string> {\n    const decipher = (forge as any).cipher.createDecipher(\n      this.toWebCryptoAesMode(mode),\n      parameters.encKey,\n    );\n    const options = {} as any;\n    if (mode === \"cbc\") {\n      options.iv = parameters.iv;\n    }\n    const dataBuffer = (forge as any).util.createBuffer(parameters.data);\n    decipher.start(options);\n    decipher.update(dataBuffer);\n    decipher.finish();\n    const val = decipher.output.toString();\n    return Promise.resolve(val);\n  }\n\n  async aesDecrypt(\n    data: Uint8Array,\n    iv: Uint8Array,\n    key: Uint8Array,\n    mode: \"cbc\" | \"ecb\",\n  ): Promise<Uint8Array> {\n    if (mode === \"ecb\") {\n      // Web crypto does not support AES-ECB mode, so we need to do this in forge.\n      const params = new DecryptParameters<string>();\n      params.data = this.toByteString(data);\n      params.encKey = this.toByteString(key);\n      const result = await this.aesDecryptFast(params, \"ecb\");\n      return Utils.fromByteStringToArray(result);\n    }\n    const impKey = await this.subtle.importKey(\"raw\", key, { name: \"AES-CBC\" } as any, false, [\n      \"decrypt\",\n    ]);\n    const buffer = await this.subtle.decrypt({ name: \"AES-CBC\", iv: iv }, impKey, data);\n    return new Uint8Array(buffer);\n  }\n\n  async rsaEncrypt(\n    data: Uint8Array,\n    publicKey: Uint8Array,\n    algorithm: \"sha1\" | \"sha256\",\n  ): Promise<Uint8Array> {\n    // Note: Edge browser requires that we specify name and hash for both key import and decrypt.\n    // We cannot use the proper types here.\n    const rsaParams = {\n      name: \"RSA-OAEP\",\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n    const impKey = await this.subtle.importKey(\"spki\", publicKey, rsaParams, false, [\"encrypt\"]);\n    const buffer = await this.subtle.encrypt(rsaParams, impKey, data);\n    return new Uint8Array(buffer);\n  }\n\n  async rsaDecrypt(\n    data: Uint8Array,\n    privateKey: Uint8Array,\n    algorithm: \"sha1\" | \"sha256\",\n  ): Promise<Uint8Array> {\n    // Note: Edge browser requires that we specify name and hash for both key import and decrypt.\n    // We cannot use the proper types here.\n    const rsaParams = {\n      name: \"RSA-OAEP\",\n      hash: { name: this.toWebCryptoAlgorithm(algorithm) },\n    };\n    const impKey = await this.subtle.importKey(\"pkcs8\", privateKey, rsaParams, false, [\"decrypt\"]);\n    const buffer = await this.subtle.decrypt(rsaParams, impKey, data);\n    return new Uint8Array(buffer);\n  }\n\n  async rsaExtractPublicKey(privateKey: Uint8Array): Promise<Uint8Array> {\n    const rsaParams = {\n      name: \"RSA-OAEP\",\n      // Have to specify some algorithm\n      hash: { name: this.toWebCryptoAlgorithm(\"sha1\") },\n    };\n    const impPrivateKey = await this.subtle.importKey(\"pkcs8\", privateKey, rsaParams, true, [\n      \"decrypt\",\n    ]);\n    const jwkPrivateKey = await this.subtle.exportKey(\"jwk\", impPrivateKey);\n    const jwkPublicKeyParams = {\n      kty: \"RSA\",\n      e: jwkPrivateKey.e,\n      n: jwkPrivateKey.n,\n      alg: \"RSA-OAEP\",\n      ext: true,\n    };\n    const impPublicKey = await this.subtle.importKey(\"jwk\", jwkPublicKeyParams, rsaParams, true, [\n      \"encrypt\",\n    ]);\n    const buffer = await this.subtle.exportKey(\"spki\", impPublicKey);\n    return new Uint8Array(buffer);\n  }\n\n  async aesGenerateKey(bitLength = 128 | 192 | 256 | 512): Promise<CsprngArray> {\n    if (bitLength === 512) {\n      // 512 bit keys are not supported in WebCrypto, so we concat two 256 bit keys\n      const key1 = await this.aesGenerateKey(256);\n      const key2 = await this.aesGenerateKey(256);\n      return new Uint8Array([...key1, ...key2]) as CsprngArray;\n    }\n    const aesParams = {\n      name: \"AES-CBC\",\n      length: bitLength,\n    };\n\n    const key = await this.subtle.generateKey(aesParams, true, [\"encrypt\", \"decrypt\"]);\n    const rawKey = await this.subtle.exportKey(\"raw\", key);\n    return new Uint8Array(rawKey) as CsprngArray;\n  }\n\n  async rsaGenerateKeyPair(length: 1024 | 2048 | 4096): Promise<[Uint8Array, Uint8Array]> {\n    const rsaParams = {\n      name: \"RSA-OAEP\",\n      modulusLength: length,\n      publicExponent: new Uint8Array([0x01, 0x00, 0x01]), // 65537\n      // Have to specify some algorithm\n      hash: { name: this.toWebCryptoAlgorithm(\"sha1\") },\n    };\n    const keyPair = await this.subtle.generateKey(rsaParams, true, [\"encrypt\", \"decrypt\"]);\n    const publicKey = await this.subtle.exportKey(\"spki\", keyPair.publicKey);\n    const privateKey = await this.subtle.exportKey(\"pkcs8\", keyPair.privateKey);\n    return [new Uint8Array(publicKey), new Uint8Array(privateKey)];\n  }\n\n  randomBytes(length: number): Promise<CsprngArray> {\n    const arr = new Uint8Array(length);\n    this.crypto.getRandomValues(arr);\n    return Promise.resolve(arr as CsprngArray);\n  }\n\n  private toBuf(value: string | Uint8Array): Uint8Array {\n    let buf: Uint8Array;\n    if (typeof value === \"string\") {\n      buf = Utils.fromUtf8ToArray(value);\n    } else {\n      buf = value;\n    }\n    return buf;\n  }\n\n  private toByteString(value: string | Uint8Array): string {\n    let bytes: string;\n    if (typeof value === \"string\") {\n      bytes = forge.util.encodeUtf8(value);\n    } else {\n      bytes = Utils.fromBufferToByteString(value);\n    }\n    return bytes;\n  }\n\n  private toWebCryptoAlgorithm(algorithm: \"sha1\" | \"sha256\" | \"sha512\" | \"md5\"): string {\n    if (algorithm === \"md5\") {\n      throw new Error(\"MD5 is not supported in WebCrypto.\");\n    }\n    return algorithm === \"sha1\" ? \"SHA-1\" : algorithm === \"sha256\" ? \"SHA-256\" : \"SHA-512\";\n  }\n\n  private toWebCryptoAesMode(mode: \"cbc\" | \"ecb\"): string {\n    return mode === \"cbc\" ? \"AES-CBC\" : \"AES-ECB\";\n  }\n\n  // ref: https://stackoverflow.com/a/47880734/1090359\n  private checkIfWasmSupported(): boolean {\n    try {\n      if (typeof WebAssembly === \"object\" && typeof WebAssembly.instantiate === \"function\") {\n        const module = new WebAssembly.Module(\n          Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00),\n        );\n        if (module instanceof WebAssembly.Module) {\n          return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;\n        }\n      }\n    } catch {\n      return false;\n    }\n    return false;\n  }\n}\n","import { Observable } from \"rxjs\";\n\nexport const DEFAULT_OPTIONS = {\n  shouldUpdate: () => true,\n  combineLatestWith: null as Observable<unknown>,\n  msTimeout: 1000,\n};\n\ntype DefinitelyTypedDefault<T, TCombine> = Omit<\n  typeof DEFAULT_OPTIONS,\n  \"shouldUpdate\" | \"combineLatestWith\"\n> & {\n  shouldUpdate: (state: T, dependency: TCombine) => boolean;\n  combineLatestWith?: Observable<TCombine>;\n};\n\nexport type StateUpdateOptions<T, TCombine> = Partial<DefinitelyTypedDefault<T, TCombine>>;\n\nexport function populateOptionsWithDefault<T, TCombine>(\n  options: StateUpdateOptions<T, TCombine>,\n): StateUpdateOptions<T, TCombine> {\n  return {\n    ...(DEFAULT_OPTIONS as StateUpdateOptions<T, TCombine>),\n    ...options,\n  };\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\n\nimport { StateUpdateOptions } from \"./state-update-options\";\n\nexport type CombinedState<T> = readonly [userId: UserId, state: T];\n\n/**\n * A helper object for interacting with state that is scoped to a specific user.\n */\nexport interface UserState<T> {\n  /**\n   * Emits a stream of data.\n   */\n  readonly state$: Observable<T>;\n\n  /**\n   * Emits a stream of data alongside the user id the data corresponds to.\n   */\n  readonly combinedState$: Observable<CombinedState<T>>;\n}\n\nexport const activeMarker: unique symbol = Symbol(\"active\");\nexport interface ActiveUserState<T> extends UserState<T> {\n  readonly [activeMarker]: true;\n  /**\n   * Updates backing stores for the active user.\n   * @param configureState function that takes the current state and returns the new state\n   * @param options Defaults to @see {module:state-update-options#DEFAULT_OPTIONS}\n   * @param options.shouldUpdate A callback for determining if you want to update state. Defaults to () => true\n   * @param options.combineLatestWith An observable that you want to combine with the current state for callbacks. Defaults to null\n   * @param options.msTimeout A timeout for how long you are willing to wait for a `combineLatestWith` option to complete. Defaults to 1000ms. Only applies if `combineLatestWith` is set.\n\n   * @returns The new state\n   */\n  readonly update: <TCombine>(\n    configureState: (state: T, dependencies: TCombine) => T,\n    options?: StateUpdateOptions<T, TCombine>,\n  ) => Promise<[UserId, T]>;\n}\nexport interface SingleUserState<T> extends UserState<T> {\n  readonly userId: UserId;\n\n  /**\n   * Updates backing stores for the active user.\n   * @param configureState function that takes the current state and returns the new state\n   * @param options Defaults to @see {module:state-update-options#DEFAULT_OPTIONS}\n   * @param options.shouldUpdate A callback for determining if you want to update state. Defaults to () => true\n   * @param options.combineLatestWith An observable that you want to combine with the current state for callbacks. Defaults to null\n   * @param options.msTimeout A timeout for how long you are willing to wait for a `combineLatestWith` option to complete. Defaults to 1000ms. Only applies if `combineLatestWith` is set.\n\n   * @returns The new state\n   */\n  readonly update: <TCombine>(\n    configureState: (state: T, dependencies: TCombine) => T,\n    options?: StateUpdateOptions<T, TCombine>,\n  ) => Promise<T>;\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { AbstractStorageService } from \"../../abstractions/storage.service\";\n\nexport async function getStoredValue<T>(\n  key: string,\n  storage: AbstractStorageService,\n  deserializer: (jsonValue: Jsonify<T>) => T,\n) {\n  if (storage.valuesRequireDeserialization) {\n    const jsonValue = await storage.get<Jsonify<T>>(key);\n    const value = deserializer(jsonValue);\n    return value;\n  } else {\n    const value = await storage.get<T>(key);\n    return value ?? null;\n  }\n}\n","import {\n  Observable,\n  map,\n  switchMap,\n  firstValueFrom,\n  filter,\n  timeout,\n  merge,\n  share,\n  ReplaySubject,\n  timer,\n  tap,\n  throwError,\n  distinctUntilChanged,\n  withLatestFrom,\n} from \"rxjs\";\n\nimport { AccountService } from \"../../../auth/abstractions/account.service\";\nimport { UserId } from \"../../../types/guid\";\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { StateUpdateOptions, populateOptionsWithDefault } from \"../state-update-options\";\nimport { UserKeyDefinition } from \"../user-key-definition\";\nimport { ActiveUserState, CombinedState, activeMarker } from \"../user-state\";\n\nimport { getStoredValue } from \"./util\";\n\nconst FAKE = Symbol(\"fake\");\n\nexport class DefaultActiveUserState<T> implements ActiveUserState<T> {\n  [activeMarker]: true;\n  private updatePromise: Promise<[UserId, T]> | null = null;\n\n  private activeUserId$: Observable<UserId | null>;\n\n  combinedState$: Observable<CombinedState<T>>;\n  state$: Observable<T>;\n\n  constructor(\n    protected keyDefinition: UserKeyDefinition<T>,\n    private accountService: AccountService,\n    private chosenStorageLocation: AbstractStorageService & ObservableStorageService,\n  ) {\n    this.activeUserId$ = this.accountService.activeAccount$.pipe(\n      // We only care about the UserId but we do want to know about no user as well.\n      map((a) => a?.id),\n      // To avoid going to storage when we don't need to, only get updates when there is a true change.\n      distinctUntilChanged((a, b) => (a == null || b == null ? a == b : a === b)), // Treat null and undefined as equal\n    );\n\n    const userChangeAndInitial$ = this.activeUserId$.pipe(\n      // If the user has changed, we no longer need to lock an update call\n      // since that call will be for a user that is no longer active.\n      tap(() => (this.updatePromise = null)),\n      switchMap(async (userId) => {\n        // We've switched or started off with no active user. So,\n        // emit a fake value so that we can fill our share buffer.\n        if (userId == null) {\n          return FAKE;\n        }\n\n        const fullKey = this.keyDefinition.buildKey(userId);\n        const data = await getStoredValue(\n          fullKey,\n          this.chosenStorageLocation,\n          this.keyDefinition.deserializer,\n        );\n        return [userId, data] as CombinedState<T>;\n      }),\n    );\n\n    const latestStorage$ = this.chosenStorageLocation.updates$.pipe(\n      // Use withLatestFrom so that we do NOT emit when activeUserId changes because that\n      // is taken care of above, but we do want to have the latest user id\n      // when we get a storage update so we can filter the full key\n      withLatestFrom(\n        this.activeUserId$.pipe(\n          // Null userId is already taken care of through the userChange observable above\n          filter((u) => u != null),\n          // Take the userId and build the fullKey that we can now create\n          map((userId) => [userId, this.keyDefinition.buildKey(userId)] as const),\n        ),\n      ),\n      // Filter to only storage updates that pertain to our key\n      filter(([storageUpdate, [_userId, fullKey]]) => storageUpdate.key === fullKey),\n      switchMap(async ([storageUpdate, [userId, fullKey]]) => {\n        // We can shortcut on updateType of \"remove\"\n        // and just emit null.\n        if (storageUpdate.updateType === \"remove\") {\n          return [userId, null] as CombinedState<T>;\n        }\n\n        return [\n          userId,\n          await getStoredValue(\n            fullKey,\n            this.chosenStorageLocation,\n            this.keyDefinition.deserializer,\n          ),\n        ] as CombinedState<T>;\n      }),\n    );\n\n    this.combinedState$ = merge(userChangeAndInitial$, latestStorage$).pipe(\n      share({\n        connector: () => new ReplaySubject<CombinedState<T> | typeof FAKE>(1),\n        resetOnRefCountZero: () => timer(this.keyDefinition.cleanupDelayMs),\n      }),\n      // Filter out FAKE AFTER the share so that we can fill the ReplaySubjects\n      // buffer with something and avoid emitting when there is no active user.\n      filter<CombinedState<T>>((d) => d !== (FAKE as unknown)),\n    );\n\n    // State should just be combined state without the user id\n    this.state$ = this.combinedState$.pipe(map(([_userId, state]) => state));\n  }\n\n  async update<TCombine>(\n    configureState: (state: T, dependency: TCombine) => T,\n    options: StateUpdateOptions<T, TCombine> = {},\n  ): Promise<[UserId, T]> {\n    options = populateOptionsWithDefault(options);\n    try {\n      if (this.updatePromise != null) {\n        await this.updatePromise;\n      }\n      this.updatePromise = this.internalUpdate(configureState, options);\n      const [userId, newState] = await this.updatePromise;\n      return [userId, newState];\n    } finally {\n      this.updatePromise = null;\n    }\n  }\n\n  private async internalUpdate<TCombine>(\n    configureState: (state: T, dependency: TCombine) => T,\n    options: StateUpdateOptions<T, TCombine>,\n  ): Promise<[UserId, T]> {\n    const [userId, key, currentState] = await this.getStateForUpdate();\n    const combinedDependencies =\n      options.combineLatestWith != null\n        ? await firstValueFrom(options.combineLatestWith.pipe(timeout(options.msTimeout)))\n        : null;\n\n    if (!options.shouldUpdate(currentState, combinedDependencies)) {\n      return [userId, currentState];\n    }\n\n    const newState = configureState(currentState, combinedDependencies);\n    await this.saveToStorage(key, newState);\n    return [userId, newState];\n  }\n\n  /** For use in update methods, does not wait for update to complete before yielding state.\n   * The expectation is that that await is already done\n   */\n  protected async getStateForUpdate() {\n    const userId = await firstValueFrom(\n      this.activeUserId$.pipe(\n        timeout({\n          first: 1000,\n          with: () => throwError(() => new Error(\"Timeout while retrieving active user.\")),\n        }),\n      ),\n    );\n    if (userId == null) {\n      throw new Error(\"No active user at this time.\");\n    }\n    const fullKey = this.keyDefinition.buildKey(userId);\n    return [\n      userId,\n      fullKey,\n      await getStoredValue(fullKey, this.chosenStorageLocation, this.keyDefinition.deserializer),\n    ] as const;\n  }\n\n  protected saveToStorage(key: string, data: T): Promise<void> {\n    return this.chosenStorageLocation.save(key, data);\n  }\n}\n","import { Observable, map } from \"rxjs\";\n\nimport { AccountService } from \"../../../auth/abstractions/account.service\";\nimport { UserId } from \"../../../types/guid\";\nimport {\n  AbstractMemoryStorageService,\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { KeyDefinition } from \"../key-definition\";\nimport { StateDefinition } from \"../state-definition\";\nimport { UserKeyDefinition, isUserKeyDefinition } from \"../user-key-definition\";\nimport { ActiveUserState } from \"../user-state\";\nimport { ActiveUserStateProvider } from \"../user-state.provider\";\n\nimport { DefaultActiveUserState } from \"./default-active-user-state\";\n\nexport class DefaultActiveUserStateProvider implements ActiveUserStateProvider {\n  private cache: Record<string, ActiveUserState<unknown>> = {};\n\n  activeUserId$: Observable<UserId | undefined>;\n\n  constructor(\n    protected readonly accountService: AccountService,\n    protected readonly memoryStorage: AbstractMemoryStorageService & ObservableStorageService,\n    protected readonly diskStorage: AbstractStorageService & ObservableStorageService,\n  ) {\n    this.activeUserId$ = this.accountService.activeAccount$.pipe(map((account) => account?.id));\n  }\n\n  get<T>(keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>): ActiveUserState<T> {\n    if (!isUserKeyDefinition(keyDefinition)) {\n      keyDefinition = UserKeyDefinition.fromBaseKeyDefinition(keyDefinition);\n    }\n    const cacheKey = this.buildCacheKey(keyDefinition);\n    const existingUserState = this.cache[cacheKey];\n    if (existingUserState != null) {\n      // I have to cast out of the unknown generic but this should be safe if rules\n      // around domain token are made\n      return existingUserState as ActiveUserState<T>;\n    }\n\n    const newUserState = this.buildActiveUserState(keyDefinition);\n    this.cache[cacheKey] = newUserState;\n    return newUserState;\n  }\n\n  private buildCacheKey(keyDefinition: UserKeyDefinition<unknown>) {\n    return `${this.getLocationString(keyDefinition)}_${keyDefinition.fullName}`;\n  }\n\n  protected buildActiveUserState<T>(keyDefinition: UserKeyDefinition<T>): ActiveUserState<T> {\n    return new DefaultActiveUserState<T>(\n      keyDefinition,\n      this.accountService,\n      this.getLocation(keyDefinition.stateDefinition),\n    );\n  }\n\n  protected getLocationString(keyDefinition: UserKeyDefinition<unknown>): string {\n    return keyDefinition.stateDefinition.defaultStorageLocation;\n  }\n\n  protected getLocation(stateDefinition: StateDefinition) {\n    // The default implementations don't support the client overrides\n    // it is up to the client to extend this class and add that support\n    const location = stateDefinition.defaultStorageLocation;\n    switch (location) {\n      case \"disk\":\n        return this.diskStorage;\n      case \"memory\":\n        return this.memoryStorage;\n    }\n  }\n}\n","import {\n  Observable,\n  ReplaySubject,\n  defer,\n  filter,\n  firstValueFrom,\n  merge,\n  share,\n  switchMap,\n  timeout,\n  timer,\n} from \"rxjs\";\n\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { GlobalState } from \"../global-state\";\nimport { KeyDefinition, globalKeyBuilder } from \"../key-definition\";\nimport { StateUpdateOptions, populateOptionsWithDefault } from \"../state-update-options\";\n\nimport { getStoredValue } from \"./util\";\n\nexport class DefaultGlobalState<T> implements GlobalState<T> {\n  private storageKey: string;\n  private updatePromise: Promise<T> | null = null;\n\n  readonly state$: Observable<T>;\n\n  constructor(\n    private keyDefinition: KeyDefinition<T>,\n    private chosenLocation: AbstractStorageService & ObservableStorageService,\n  ) {\n    this.storageKey = globalKeyBuilder(this.keyDefinition);\n    const initialStorageGet$ = defer(() => {\n      return getStoredValue(this.storageKey, this.chosenLocation, this.keyDefinition.deserializer);\n    });\n\n    const latestStorage$ = this.chosenLocation.updates$.pipe(\n      filter((s) => s.key === this.storageKey),\n      switchMap(async (storageUpdate) => {\n        if (storageUpdate.updateType === \"remove\") {\n          return null;\n        }\n\n        return await getStoredValue(\n          this.storageKey,\n          this.chosenLocation,\n          this.keyDefinition.deserializer,\n        );\n      }),\n    );\n\n    this.state$ = merge(initialStorageGet$, latestStorage$).pipe(\n      share({\n        connector: () => new ReplaySubject<T>(1),\n        resetOnRefCountZero: () => timer(this.keyDefinition.cleanupDelayMs),\n      }),\n    );\n  }\n\n  async update<TCombine>(\n    configureState: (state: T, dependency: TCombine) => T,\n    options: StateUpdateOptions<T, TCombine> = {},\n  ): Promise<T> {\n    options = populateOptionsWithDefault(options);\n    if (this.updatePromise != null) {\n      await this.updatePromise;\n    }\n\n    try {\n      this.updatePromise = this.internalUpdate(configureState, options);\n      const newState = await this.updatePromise;\n      return newState;\n    } finally {\n      this.updatePromise = null;\n    }\n  }\n\n  private async internalUpdate<TCombine>(\n    configureState: (state: T, dependency: TCombine) => T,\n    options: StateUpdateOptions<T, TCombine>,\n  ): Promise<T> {\n    const currentState = await this.getStateForUpdate();\n    const combinedDependencies =\n      options.combineLatestWith != null\n        ? await firstValueFrom(options.combineLatestWith.pipe(timeout(options.msTimeout)))\n        : null;\n\n    if (!options.shouldUpdate(currentState, combinedDependencies)) {\n      return currentState;\n    }\n\n    const newState = configureState(currentState, combinedDependencies);\n    await this.chosenLocation.save(this.storageKey, newState);\n    return newState;\n  }\n\n  /** For use in update methods, does not wait for update to complete before yielding state.\n   * The expectation is that that await is already done\n   */\n  private async getStateForUpdate() {\n    return await getStoredValue(\n      this.storageKey,\n      this.chosenLocation,\n      this.keyDefinition.deserializer,\n    );\n  }\n\n  async getFromState(): Promise<T> {\n    if (this.updatePromise != null) {\n      return await this.updatePromise;\n    }\n    return await getStoredValue(\n      this.storageKey,\n      this.chosenLocation,\n      this.keyDefinition.deserializer,\n    );\n  }\n}\n","import {\n  AbstractMemoryStorageService,\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { GlobalState } from \"../global-state\";\nimport { GlobalStateProvider } from \"../global-state.provider\";\nimport { KeyDefinition } from \"../key-definition\";\nimport { StateDefinition } from \"../state-definition\";\n\nimport { DefaultGlobalState } from \"./default-global-state\";\n\nexport class DefaultGlobalStateProvider implements GlobalStateProvider {\n  private globalStateCache: Record<string, GlobalState<unknown>> = {};\n\n  constructor(\n    protected readonly memoryStorage: AbstractMemoryStorageService & ObservableStorageService,\n    protected readonly diskStorage: AbstractStorageService & ObservableStorageService,\n  ) {}\n\n  get<T>(keyDefinition: KeyDefinition<T>): GlobalState<T> {\n    const cacheKey = this.buildCacheKey(keyDefinition);\n    const existingGlobalState = this.globalStateCache[cacheKey];\n    if (existingGlobalState != null) {\n      // The cast into the actual generic is safe because of rules around key definitions\n      // being unique.\n      return existingGlobalState as DefaultGlobalState<T>;\n    }\n\n    const newGlobalState = new DefaultGlobalState<T>(\n      keyDefinition,\n      this.getLocation(keyDefinition.stateDefinition),\n    );\n\n    this.globalStateCache[cacheKey] = newGlobalState;\n    return newGlobalState;\n  }\n\n  private buildCacheKey(keyDefinition: KeyDefinition<unknown>) {\n    return `${this.getLocationString(keyDefinition)}_${keyDefinition.fullName}`;\n  }\n\n  protected getLocationString(keyDefinition: KeyDefinition<unknown>): string {\n    return keyDefinition.stateDefinition.defaultStorageLocation;\n  }\n\n  protected getLocation(stateDefinition: StateDefinition) {\n    const location = stateDefinition.defaultStorageLocation;\n    switch (location) {\n      case \"disk\":\n        return this.diskStorage;\n      case \"memory\":\n        return this.memoryStorage;\n    }\n  }\n}\n","import {\n  Observable,\n  ReplaySubject,\n  combineLatest,\n  defer,\n  filter,\n  firstValueFrom,\n  merge,\n  of,\n  share,\n  switchMap,\n  timeout,\n  timer,\n} from \"rxjs\";\n\nimport { UserId } from \"../../../types/guid\";\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { StateUpdateOptions, populateOptionsWithDefault } from \"../state-update-options\";\nimport { UserKeyDefinition } from \"../user-key-definition\";\nimport { CombinedState, SingleUserState } from \"../user-state\";\n\nimport { getStoredValue } from \"./util\";\n\nexport class DefaultSingleUserState<T> implements SingleUserState<T> {\n  private storageKey: string;\n  private updatePromise: Promise<T> | null = null;\n\n  readonly state$: Observable<T>;\n  readonly combinedState$: Observable<CombinedState<T>>;\n\n  constructor(\n    readonly userId: UserId,\n    private keyDefinition: UserKeyDefinition<T>,\n    private chosenLocation: AbstractStorageService & ObservableStorageService,\n  ) {\n    this.storageKey = this.keyDefinition.buildKey(this.userId);\n    const initialStorageGet$ = defer(() => {\n      return getStoredValue(this.storageKey, this.chosenLocation, this.keyDefinition.deserializer);\n    });\n\n    const latestStorage$ = chosenLocation.updates$.pipe(\n      filter((s) => s.key === this.storageKey),\n      switchMap(async (storageUpdate) => {\n        if (storageUpdate.updateType === \"remove\") {\n          return null;\n        }\n\n        return await getStoredValue(\n          this.storageKey,\n          this.chosenLocation,\n          this.keyDefinition.deserializer,\n        );\n      }),\n    );\n\n    this.state$ = merge(initialStorageGet$, latestStorage$).pipe(\n      share({\n        connector: () => new ReplaySubject<T>(1),\n        resetOnRefCountZero: () => timer(this.keyDefinition.cleanupDelayMs),\n      }),\n    );\n\n    this.combinedState$ = combineLatest([of(userId), this.state$]);\n  }\n\n  async update<TCombine>(\n    configureState: (state: T, dependency: TCombine) => T,\n    options: StateUpdateOptions<T, TCombine> = {},\n  ): Promise<T> {\n    options = populateOptionsWithDefault(options);\n    if (this.updatePromise != null) {\n      await this.updatePromise;\n    }\n\n    try {\n      this.updatePromise = this.internalUpdate(configureState, options);\n      const newState = await this.updatePromise;\n      return newState;\n    } finally {\n      this.updatePromise = null;\n    }\n  }\n\n  private async internalUpdate<TCombine>(\n    configureState: (state: T, dependency: TCombine) => T,\n    options: StateUpdateOptions<T, TCombine>,\n  ): Promise<T> {\n    const currentState = await this.getStateForUpdate();\n    const combinedDependencies =\n      options.combineLatestWith != null\n        ? await firstValueFrom(options.combineLatestWith.pipe(timeout(options.msTimeout)))\n        : null;\n\n    if (!options.shouldUpdate(currentState, combinedDependencies)) {\n      return currentState;\n    }\n\n    const newState = configureState(currentState, combinedDependencies);\n    await this.chosenLocation.save(this.storageKey, newState);\n    return newState;\n  }\n\n  /** For use in update methods, does not wait for update to complete before yielding state.\n   * The expectation is that that await is already done\n   */\n  private async getStateForUpdate() {\n    return await getStoredValue(\n      this.storageKey,\n      this.chosenLocation,\n      this.keyDefinition.deserializer,\n    );\n  }\n}\n","import { UserId } from \"../../../types/guid\";\nimport {\n  AbstractMemoryStorageService,\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { KeyDefinition } from \"../key-definition\";\nimport { StateDefinition } from \"../state-definition\";\nimport { UserKeyDefinition, isUserKeyDefinition } from \"../user-key-definition\";\nimport { SingleUserState } from \"../user-state\";\nimport { SingleUserStateProvider } from \"../user-state.provider\";\n\nimport { DefaultSingleUserState } from \"./default-single-user-state\";\n\nexport class DefaultSingleUserStateProvider implements SingleUserStateProvider {\n  private cache: Record<string, SingleUserState<unknown>> = {};\n\n  constructor(\n    protected readonly memoryStorage: AbstractMemoryStorageService & ObservableStorageService,\n    protected readonly diskStorage: AbstractStorageService & ObservableStorageService,\n  ) {}\n\n  get<T>(\n    userId: UserId,\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n  ): SingleUserState<T> {\n    if (!isUserKeyDefinition(keyDefinition)) {\n      keyDefinition = UserKeyDefinition.fromBaseKeyDefinition(keyDefinition);\n    }\n    const cacheKey = this.buildCacheKey(userId, keyDefinition);\n    const existingUserState = this.cache[cacheKey];\n    if (existingUserState != null) {\n      // I have to cast out of the unknown generic but this should be safe if rules\n      // around domain token are made\n      return existingUserState as SingleUserState<T>;\n    }\n\n    const newUserState = this.buildSingleUserState(userId, keyDefinition);\n    this.cache[cacheKey] = newUserState;\n    return newUserState;\n  }\n\n  private buildCacheKey(userId: UserId, keyDefinition: UserKeyDefinition<unknown>) {\n    return `${this.getLocationString(keyDefinition)}_${keyDefinition.fullName}_${userId}`;\n  }\n\n  protected buildSingleUserState<T>(\n    userId: UserId,\n    keyDefinition: UserKeyDefinition<T>,\n  ): SingleUserState<T> {\n    return new DefaultSingleUserState<T>(\n      userId,\n      keyDefinition,\n      this.getLocation(keyDefinition.stateDefinition),\n    );\n  }\n\n  protected getLocationString(keyDefinition: UserKeyDefinition<unknown>): string {\n    return keyDefinition.stateDefinition.defaultStorageLocation;\n  }\n\n  protected getLocation(stateDefinition: StateDefinition) {\n    // The default implementations don't support the client overrides\n    // it is up to the client to extend this class and add that support\n    switch (stateDefinition.defaultStorageLocation) {\n      case \"disk\":\n        return this.diskStorage;\n      case \"memory\":\n        return this.memoryStorage;\n    }\n  }\n}\n","import { Observable, switchMap, take } from \"rxjs\";\n\nimport { UserId } from \"../../../types/guid\";\nimport { DerivedStateDependencies } from \"../../../types/state\";\nimport { DeriveDefinition } from \"../derive-definition\";\nimport { DerivedState } from \"../derived-state\";\nimport { DerivedStateProvider } from \"../derived-state.provider\";\nimport { GlobalStateProvider } from \"../global-state.provider\";\nimport { KeyDefinition } from \"../key-definition\";\nimport { StateProvider } from \"../state.provider\";\nimport { UserKeyDefinition } from \"../user-key-definition\";\nimport { ActiveUserStateProvider, SingleUserStateProvider } from \"../user-state.provider\";\n\nexport class DefaultStateProvider implements StateProvider {\n  activeUserId$: Observable<UserId>;\n  constructor(\n    private readonly activeUserStateProvider: ActiveUserStateProvider,\n    private readonly singleUserStateProvider: SingleUserStateProvider,\n    private readonly globalStateProvider: GlobalStateProvider,\n    private readonly derivedStateProvider: DerivedStateProvider,\n  ) {\n    this.activeUserId$ = this.activeUserStateProvider.activeUserId$;\n  }\n\n  getUserState$<T>(\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n    userId?: UserId,\n  ): Observable<T> {\n    if (userId) {\n      return this.getUser<T>(userId, keyDefinition).state$;\n    } else {\n      return this.activeUserId$.pipe(\n        take(1),\n        switchMap((userId) => this.getUser<T>(userId, keyDefinition).state$),\n      );\n    }\n  }\n\n  async setUserState<T>(\n    keyDefinition: KeyDefinition<T> | UserKeyDefinition<T>,\n    value: T,\n    userId?: UserId,\n  ): Promise<[UserId, T]> {\n    if (userId) {\n      return [userId, await this.getUser<T>(userId, keyDefinition).update(() => value)];\n    } else {\n      return await this.getActive<T>(keyDefinition).update(() => value);\n    }\n  }\n\n  getActive: InstanceType<typeof ActiveUserStateProvider>[\"get\"] =\n    this.activeUserStateProvider.get.bind(this.activeUserStateProvider);\n  getUser: InstanceType<typeof SingleUserStateProvider>[\"get\"] =\n    this.singleUserStateProvider.get.bind(this.singleUserStateProvider);\n  getGlobal: InstanceType<typeof GlobalStateProvider>[\"get\"] = this.globalStateProvider.get.bind(\n    this.globalStateProvider,\n  );\n  getDerived: <TFrom, TTo, TDeps extends DerivedStateDependencies>(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<unknown, TTo, TDeps>,\n    dependencies: TDeps,\n  ) => DerivedState<TTo> = this.derivedStateProvider.get.bind(this.derivedStateProvider);\n}\n","export class UpdateAvatarRequest {\n  avatarColor: string;\n\n  constructor(avatarColor: string) {\n    this.avatarColor = avatarColor;\n  }\n}\n","import { BehaviorSubject, Observable } from \"rxjs\";\n\nimport { AvatarUpdateService as AvatarUpdateServiceAbstraction } from \"../../abstractions/account/avatar-update.service\";\nimport { ApiService } from \"../../abstractions/api.service\";\nimport { UpdateAvatarRequest } from \"../../models/request/update-avatar.request\";\nimport { ProfileResponse } from \"../../models/response/profile.response\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\n\nexport class AvatarUpdateService implements AvatarUpdateServiceAbstraction {\n  private _avatarUpdate$ = new BehaviorSubject<string | null>(null);\n  avatarUpdate$: Observable<string | null> = this._avatarUpdate$.asObservable();\n\n  constructor(\n    private apiService: ApiService,\n    private stateService: StateService,\n  ) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.loadColorFromState();\n  }\n\n  loadColorFromState(): Promise<string | null> {\n    return this.stateService.getAvatarColor().then((color) => {\n      this._avatarUpdate$.next(color);\n      return color;\n    });\n  }\n\n  pushUpdate(color: string | null): Promise<ProfileResponse | void> {\n    return this.apiService.putAvatar(new UpdateAvatarRequest(color)).then((response) => {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.stateService.setAvatarColor(response.avatarColor);\n      this._avatarUpdate$.next(response.avatarColor);\n    });\n  }\n}\n","import { BillingSyncConfigApi } from \"../../../billing/models/api/billing-sync-config.api\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { OrganizationConnectionType } from \"../../enums\";\nimport { ScimConfigApi } from \"../api/scim-config.api\";\n\n/**API response config types for OrganizationConnectionResponse */\nexport type OrganizationConnectionConfigApis = BillingSyncConfigApi | ScimConfigApi;\n\nexport class OrganizationConnectionResponse<\n  TConfig extends OrganizationConnectionConfigApis,\n> extends BaseResponse {\n  id: string;\n  type: OrganizationConnectionType;\n  organizationId: string;\n  enabled: boolean;\n  config: TConfig;\n\n  constructor(response: any, configType: { new (response: any): TConfig }) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    const rawConfig = this.getResponseProperty(\"Config\");\n    this.config = rawConfig == null ? null : new configType(rawConfig);\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class CardApi extends BaseResponse {\n  cardholderName: string;\n  brand: string;\n  number: string;\n  expMonth: string;\n  expYear: string;\n  code: string;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.cardholderName = this.getResponseProperty(\"CardholderName\");\n    this.brand = this.getResponseProperty(\"Brand\");\n    this.number = this.getResponseProperty(\"Number\");\n    this.expMonth = this.getResponseProperty(\"ExpMonth\");\n    this.expYear = this.getResponseProperty(\"ExpYear\");\n    this.code = this.getResponseProperty(\"Code\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { FieldType, LinkedIdType } from \"../../enums\";\n\nexport class FieldApi extends BaseResponse {\n  name: string;\n  value: string;\n  type: FieldType;\n  linkedId: LinkedIdType;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.type = this.getResponseProperty(\"Type\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.value = this.getResponseProperty(\"Value\");\n    this.linkedId = this.getResponseProperty(\"linkedId\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class IdentityApi extends BaseResponse {\n  title: string;\n  firstName: string;\n  middleName: string;\n  lastName: string;\n  address1: string;\n  address2: string;\n  address3: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n  company: string;\n  email: string;\n  phone: string;\n  ssn: string;\n  username: string;\n  passportNumber: string;\n  licenseNumber: string;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.title = this.getResponseProperty(\"Title\");\n    this.firstName = this.getResponseProperty(\"FirstName\");\n    this.middleName = this.getResponseProperty(\"MiddleName\");\n    this.lastName = this.getResponseProperty(\"LastName\");\n    this.address1 = this.getResponseProperty(\"Address1\");\n    this.address2 = this.getResponseProperty(\"Address2\");\n    this.address3 = this.getResponseProperty(\"Address3\");\n    this.city = this.getResponseProperty(\"City\");\n    this.state = this.getResponseProperty(\"State\");\n    this.postalCode = this.getResponseProperty(\"PostalCode\");\n    this.country = this.getResponseProperty(\"Country\");\n    this.company = this.getResponseProperty(\"Company\");\n    this.email = this.getResponseProperty(\"Email\");\n    this.phone = this.getResponseProperty(\"Phone\");\n    this.ssn = this.getResponseProperty(\"SSN\");\n    this.username = this.getResponseProperty(\"Username\");\n    this.passportNumber = this.getResponseProperty(\"PassportNumber\");\n    this.licenseNumber = this.getResponseProperty(\"LicenseNumber\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class Fido2CredentialApi extends BaseResponse {\n  credentialId: string;\n  keyType: \"public-key\";\n  keyAlgorithm: \"ECDSA\";\n  keyCurve: \"P-256\";\n  keyValue: string;\n  rpId: string;\n  userHandle: string;\n  userName: string;\n  counter: string;\n  rpName: string;\n  userDisplayName: string;\n  discoverable: string;\n  creationDate: string;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n\n    this.credentialId = this.getResponseProperty(\"CredentialId\");\n    this.keyType = this.getResponseProperty(\"KeyType\");\n    this.keyAlgorithm = this.getResponseProperty(\"KeyAlgorithm\");\n    this.keyCurve = this.getResponseProperty(\"KeyCurve\");\n    this.keyValue = this.getResponseProperty(\"keyValue\");\n    this.rpId = this.getResponseProperty(\"RpId\");\n    this.userHandle = this.getResponseProperty(\"UserHandle\");\n    this.userName = this.getResponseProperty(\"UserName\");\n    this.counter = this.getResponseProperty(\"Counter\");\n    this.rpName = this.getResponseProperty(\"RpName\");\n    this.userDisplayName = this.getResponseProperty(\"UserDisplayName\");\n    this.discoverable = this.getResponseProperty(\"Discoverable\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { UriMatchType } from \"../../enums\";\n\nexport class LoginUriApi extends BaseResponse {\n  uri: string;\n  uriChecksum: string;\n  match: UriMatchType = null;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.uri = this.getResponseProperty(\"Uri\");\n    this.uriChecksum = this.getResponseProperty(\"UriChecksum\");\n    const match = this.getResponseProperty(\"Match\");\n    this.match = match != null ? match : null;\n  }\n}\n","import { JsonObject } from \"type-fest\";\n\nimport { BaseResponse } from \"../../../models/response/base.response\";\n\nimport { Fido2CredentialApi } from \"./fido2-credential.api\";\nimport { LoginUriApi } from \"./login-uri.api\";\n\nexport class LoginApi extends BaseResponse {\n  uris: LoginUriApi[];\n  username: string;\n  password: string;\n  passwordRevisionDate: string;\n  totp: string;\n  autofillOnPageLoad: boolean;\n  fido2Credentials?: Fido2CredentialApi[];\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.username = this.getResponseProperty(\"Username\");\n    this.password = this.getResponseProperty(\"Password\");\n    this.passwordRevisionDate = this.getResponseProperty(\"PasswordRevisionDate\");\n    this.totp = this.getResponseProperty(\"Totp\");\n    this.autofillOnPageLoad = this.getResponseProperty(\"AutofillOnPageLoad\");\n\n    const uris = this.getResponseProperty(\"Uris\");\n    if (uris != null) {\n      this.uris = uris.map((u: any) => new LoginUriApi(u));\n    }\n\n    const fido2Credentials = this.getResponseProperty(\"Fido2Credentials\");\n    if (fido2Credentials != null) {\n      this.fido2Credentials = fido2Credentials.map(\n        (key: JsonObject) => new Fido2CredentialApi(key),\n      );\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { SecureNoteType } from \"../../enums\";\n\nexport class SecureNoteApi extends BaseResponse {\n  type: SecureNoteType;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.type = this.getResponseProperty(\"Type\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class AttachmentResponse extends BaseResponse {\n  id: string;\n  url: string;\n  fileName: string;\n  key: string;\n  size: string;\n  sizeName: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.url = this.getResponseProperty(\"Url\");\n    this.fileName = this.getResponseProperty(\"FileName\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.size = this.getResponseProperty(\"Size\");\n    this.sizeName = this.getResponseProperty(\"SizeName\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class PasswordHistoryResponse extends BaseResponse {\n  password: string;\n  lastUsedDate: string;\n\n  constructor(response: any) {\n    super(response);\n    this.password = this.getResponseProperty(\"Password\");\n    this.lastUsedDate = this.getResponseProperty(\"LastUsedDate\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CardApi } from \"../api/card.api\";\nimport { FieldApi } from \"../api/field.api\";\nimport { IdentityApi } from \"../api/identity.api\";\nimport { LoginApi } from \"../api/login.api\";\nimport { SecureNoteApi } from \"../api/secure-note.api\";\n\nimport { AttachmentResponse } from \"./attachment.response\";\nimport { PasswordHistoryResponse } from \"./password-history.response\";\n\nexport class CipherResponse extends BaseResponse {\n  id: string;\n  organizationId: string;\n  folderId: string;\n  type: number;\n  name: string;\n  notes: string;\n  fields: FieldApi[];\n  login: LoginApi;\n  card: CardApi;\n  identity: IdentityApi;\n  secureNote: SecureNoteApi;\n  favorite: boolean;\n  edit: boolean;\n  viewPassword: boolean;\n  organizationUseTotp: boolean;\n  revisionDate: string;\n  attachments: AttachmentResponse[];\n  passwordHistory: PasswordHistoryResponse[];\n  collectionIds: string[];\n  creationDate: string;\n  deletedDate: string;\n  reprompt: CipherRepromptType;\n  key: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.folderId = this.getResponseProperty(\"FolderId\") || null;\n    this.type = this.getResponseProperty(\"Type\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.notes = this.getResponseProperty(\"Notes\");\n    this.favorite = this.getResponseProperty(\"Favorite\") || false;\n    this.edit = !!this.getResponseProperty(\"Edit\");\n    if (this.getResponseProperty(\"ViewPassword\") == null) {\n      this.viewPassword = true;\n    } else {\n      this.viewPassword = this.getResponseProperty(\"ViewPassword\");\n    }\n    this.organizationUseTotp = this.getResponseProperty(\"OrganizationUseTotp\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n    this.collectionIds = this.getResponseProperty(\"CollectionIds\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.deletedDate = this.getResponseProperty(\"DeletedDate\");\n\n    const login = this.getResponseProperty(\"Login\");\n    if (login != null) {\n      this.login = new LoginApi(login);\n    }\n\n    const card = this.getResponseProperty(\"Card\");\n    if (card != null) {\n      this.card = new CardApi(card);\n    }\n\n    const identity = this.getResponseProperty(\"Identity\");\n    if (identity != null) {\n      this.identity = new IdentityApi(identity);\n    }\n\n    const secureNote = this.getResponseProperty(\"SecureNote\");\n    if (secureNote != null) {\n      this.secureNote = new SecureNoteApi(secureNote);\n    }\n\n    const fields = this.getResponseProperty(\"Fields\");\n    if (fields != null) {\n      this.fields = fields.map((f: any) => new FieldApi(f));\n    }\n\n    const attachments = this.getResponseProperty(\"Attachments\");\n    if (attachments != null) {\n      this.attachments = attachments.map((a: any) => new AttachmentResponse(a));\n    }\n\n    const passwordHistory = this.getResponseProperty(\"PasswordHistory\");\n    if (passwordHistory != null) {\n      this.passwordHistory = passwordHistory.map((h: any) => new PasswordHistoryResponse(h));\n    }\n\n    this.reprompt = this.getResponseProperty(\"Reprompt\") || CipherRepromptType.None;\n    this.key = this.getResponseProperty(\"Key\") || null;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class SelectionReadOnlyResponse extends BaseResponse {\n  id: string;\n  readOnly: boolean;\n  hidePasswords: boolean;\n  manage: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.readOnly = this.getResponseProperty(\"ReadOnly\");\n    this.hidePasswords = this.getResponseProperty(\"HidePasswords\");\n    this.manage = this.getResponseProperty(\"Manage\");\n  }\n}\n","import { SelectionReadOnlyResponse } from \"../../../admin-console/models/response/selection-read-only.response\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { CollectionId, OrganizationId } from \"../../../types/guid\";\n\nexport class CollectionResponse extends BaseResponse {\n  id: CollectionId;\n  organizationId: OrganizationId;\n  name: string;\n  externalId: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.externalId = this.getResponseProperty(\"ExternalId\");\n  }\n}\n\nexport class CollectionDetailsResponse extends CollectionResponse {\n  readOnly: boolean;\n  manage: boolean;\n  hidePasswords: boolean;\n  assigned: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.readOnly = this.getResponseProperty(\"ReadOnly\") || false;\n    this.manage = this.getResponseProperty(\"Manage\") || false;\n    this.hidePasswords = this.getResponseProperty(\"HidePasswords\") || false;\n\n    // Temporary until the API is updated to return this property in AC-2084\n    // For now, we can assume that if the object is 'collectionDetails' then the user is assigned\n    this.assigned = this.getResponseProperty(\"object\") == \"collectionDetails\";\n  }\n}\n\nexport class CollectionAccessDetailsResponse extends CollectionResponse {\n  groups: SelectionReadOnlyResponse[] = [];\n  users: SelectionReadOnlyResponse[] = [];\n\n  /**\n   * Flag indicating the user has been explicitly assigned to this Collection\n   */\n  assigned: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.assigned = this.getResponseProperty(\"Assigned\") || false;\n\n    const groups = this.getResponseProperty(\"Groups\");\n    if (groups != null) {\n      this.groups = groups.map((g: any) => new SelectionReadOnlyResponse(g));\n    }\n\n    const users = this.getResponseProperty(\"Users\");\n    if (users != null) {\n      this.users = users.map((g: any) => new SelectionReadOnlyResponse(g));\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { CipherResponse } from \"../../../vault/models/response/cipher.response\";\nimport { CollectionResponse } from \"../../../vault/models/response/collection.response\";\n\nexport class OrganizationExportResponse extends BaseResponse {\n  collections: CollectionResponse[];\n  ciphers: CipherResponse[];\n\n  constructor(response: any) {\n    super(response);\n    const collections = this.getResponseProperty(\"Collections\");\n    if (collections != null) {\n      this.collections = collections.map((c: any) => new CollectionResponse(c));\n    }\n    const ciphers = this.getResponseProperty(\"Ciphers\");\n    if (ciphers != null) {\n      this.ciphers = ciphers.map((c: any) => new CipherResponse(c));\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class OrganizationSponsorshipSyncStatusResponse extends BaseResponse {\n  lastSyncDate?: Date;\n\n  constructor(response: any) {\n    super(response);\n    const lastSyncDate = this.getResponseProperty(\"LastSyncDate\");\n    if (lastSyncDate) {\n      this.lastSyncDate = new Date(lastSyncDate);\n    }\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class ProviderOrganizationResponse extends BaseResponse {\n  id: string;\n  providerId: string;\n  organizationId: string;\n  key: string;\n  settings: string;\n  creationDate: string;\n  revisionDate: string;\n  userCount: number;\n  seats?: number;\n  plan?: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.providerId = this.getResponseProperty(\"ProviderId\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.settings = this.getResponseProperty(\"Settings\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n    this.userCount = this.getResponseProperty(\"UserCount\");\n    this.seats = this.getResponseProperty(\"Seats\");\n    this.plan = this.getResponseProperty(\"Plan\");\n  }\n}\n\nexport class ProviderOrganizationOrganizationDetailsResponse extends ProviderOrganizationResponse {\n  organizationName: string;\n\n  constructor(response: any) {\n    super(response);\n    this.organizationName = this.getResponseProperty(\"OrganizationName\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class OrganizationUserBulkPublicKeyResponse extends BaseResponse {\n  id: string;\n  userId: string;\n  key: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.key = this.getResponseProperty(\"Key\");\n  }\n}\n","import { OrganizationUserBulkPublicKeyResponse } from \"../../../abstractions/organization-user/responses\";\n\nexport class ProviderUserBulkPublicKeyResponse extends OrganizationUserBulkPublicKeyResponse {}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class ProviderUserBulkResponse extends BaseResponse {\n  id: string;\n  error: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.error = this.getResponseProperty(\"Error\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class PermissionsApi extends BaseResponse {\n  accessEventLogs: boolean;\n  accessImportExport: boolean;\n  accessReports: boolean;\n  createNewCollections: boolean;\n  editAnyCollection: boolean;\n  deleteAnyCollection: boolean;\n  editAssignedCollections: boolean;\n  deleteAssignedCollections: boolean;\n  manageCiphers: boolean;\n  manageGroups: boolean;\n  manageSso: boolean;\n  managePolicies: boolean;\n  manageUsers: boolean;\n  manageResetPassword: boolean;\n  manageScim: boolean;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return this;\n    }\n    this.accessEventLogs = this.getResponseProperty(\"AccessEventLogs\");\n    this.accessImportExport = this.getResponseProperty(\"AccessImportExport\");\n    this.accessReports = this.getResponseProperty(\"AccessReports\");\n\n    this.createNewCollections = this.getResponseProperty(\"CreateNewCollections\");\n    this.editAnyCollection = this.getResponseProperty(\"EditAnyCollection\");\n    this.deleteAnyCollection = this.getResponseProperty(\"DeleteAnyCollection\");\n    this.editAssignedCollections = this.getResponseProperty(\"EditAssignedCollections\");\n    this.deleteAssignedCollections = this.getResponseProperty(\"DeleteAssignedCollections\");\n\n    this.manageCiphers = this.getResponseProperty(\"ManageCiphers\");\n    this.manageGroups = this.getResponseProperty(\"ManageGroups\");\n    this.manageSso = this.getResponseProperty(\"ManageSso\");\n    this.managePolicies = this.getResponseProperty(\"ManagePolicies\");\n    this.manageUsers = this.getResponseProperty(\"ManageUsers\");\n    this.manageResetPassword = this.getResponseProperty(\"ManageResetPassword\");\n    this.manageScim = this.getResponseProperty(\"ManageScim\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { ProviderUserStatusType, ProviderUserType } from \"../../../enums\";\nimport { PermissionsApi } from \"../../api/permissions.api\";\n\nexport class ProviderUserResponse extends BaseResponse {\n  id: string;\n  userId: string;\n  type: ProviderUserType;\n  status: ProviderUserStatusType;\n  permissions: PermissionsApi;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.status = this.getResponseProperty(\"Status\");\n    this.permissions = new PermissionsApi(this.getResponseProperty(\"Permissions\"));\n  }\n}\n\nexport class ProviderUserUserDetailsResponse extends ProviderUserResponse {\n  name: string;\n  email: string;\n\n  constructor(response: any) {\n    super(response);\n    this.name = this.getResponseProperty(\"Name\");\n    this.email = this.getResponseProperty(\"Email\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class ProviderResponse extends BaseResponse {\n  id: string;\n  name: string;\n  businessName: string;\n  billingEmail: string;\n  creationDate: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.businessName = this.getResponseProperty(\"BusinessName\");\n    this.billingEmail = this.getResponseProperty(\"BillingEmail\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class ApiKeyResponse extends BaseResponse {\n  apiKey: string;\n  revisionDate: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.apiKey = this.getResponseProperty(\"ApiKey\");\n    this.revisionDate = new Date(this.getResponseProperty(\"RevisionDate\"));\n  }\n}\n","import { DeviceType } from \"../../../enums\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\n\nconst RequestTimeOut = 60000 * 15; //15 Minutes\n\nexport class AuthRequestResponse extends BaseResponse {\n  id: string;\n  publicKey: string;\n  requestDeviceType: DeviceType;\n  requestIpAddress: string;\n  key: string;\n  masterPasswordHash: string;\n  creationDate: string;\n  requestApproved?: boolean;\n  responseDate?: string;\n  isAnswered: boolean;\n  isExpired: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.publicKey = this.getResponseProperty(\"PublicKey\");\n    this.requestDeviceType = this.getResponseProperty(\"RequestDeviceType\");\n    this.requestIpAddress = this.getResponseProperty(\"RequestIpAddress\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.masterPasswordHash = this.getResponseProperty(\"MasterPasswordHash\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.requestApproved = this.getResponseProperty(\"RequestApproved\");\n    this.responseDate = this.getResponseProperty(\"ResponseDate\");\n\n    const requestDate = new Date(this.creationDate);\n    const requestDateUTC = Date.UTC(\n      requestDate.getUTCFullYear(),\n      requestDate.getUTCMonth(),\n      requestDate.getDate(),\n      requestDate.getUTCHours(),\n      requestDate.getUTCMinutes(),\n      requestDate.getUTCSeconds(),\n      requestDate.getUTCMilliseconds(),\n    );\n\n    const dateNow = new Date(Date.now());\n    const dateNowUTC = Date.UTC(\n      dateNow.getUTCFullYear(),\n      dateNow.getUTCMonth(),\n      dateNow.getDate(),\n      dateNow.getUTCHours(),\n      dateNow.getUTCMinutes(),\n      dateNow.getUTCSeconds(),\n      dateNow.getUTCMilliseconds(),\n    );\n\n    this.isExpired = dateNowUTC - requestDateUTC >= RequestTimeOut;\n    this.isAnswered = this.requestApproved != null && this.responseDate != null;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class DeviceVerificationResponse extends BaseResponse {\n  isDeviceVerificationSectionEnabled: boolean;\n  unknownDeviceVerificationEnabled: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.isDeviceVerificationSectionEnabled = this.getResponseProperty(\n      \"IsDeviceVerificationSectionEnabled\",\n    );\n    this.unknownDeviceVerificationEnabled = this.getResponseProperty(\n      \"UnknownDeviceVerificationEnabled\",\n    );\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class KeyConnectorUserKeyResponse extends BaseResponse {\n  key: string;\n\n  constructor(response: any) {\n    super(response);\n    this.key = this.getResponseProperty(\"Key\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { KdfType } from \"../../../platform/enums\";\n\nexport class PreloginResponse extends BaseResponse {\n  kdf: KdfType;\n  kdfIterations: number;\n  kdfMemory?: number;\n  kdfParallelism?: number;\n\n  constructor(response: any) {\n    super(response);\n    this.kdf = this.getResponseProperty(\"Kdf\");\n    this.kdfIterations = this.getResponseProperty(\"KdfIterations\");\n    this.kdfMemory = this.getResponseProperty(\"KdfMemory\");\n    this.kdfParallelism = this.getResponseProperty(\"KdfParallelism\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nimport { ICaptchaProtectedResponse } from \"./captcha-protected.response\";\n\nexport class RegisterResponse extends BaseResponse implements ICaptchaProtectedResponse {\n  captchaBypassToken: string;\n\n  constructor(response: any) {\n    super(response);\n    this.captchaBypassToken = this.getResponseProperty(\"CaptchaBypassToken\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class SsoPreValidateResponse extends BaseResponse {\n  token: string;\n\n  constructor(response: any) {\n    super(response);\n    this.token = this.getResponseProperty(\"Token\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorAuthenticatorResponse extends BaseResponse {\n  enabled: boolean;\n  key: string;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.key = this.getResponseProperty(\"Key\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorDuoResponse extends BaseResponse {\n  enabled: boolean;\n  host: string;\n  secretKey: string;\n  integrationKey: string;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.host = this.getResponseProperty(\"Host\");\n    this.secretKey = this.getResponseProperty(\"SecretKey\");\n    this.integrationKey = this.getResponseProperty(\"IntegrationKey\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorEmailResponse extends BaseResponse {\n  enabled: boolean;\n  email: string;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.email = this.getResponseProperty(\"Email\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { TwoFactorProviderType } from \"../../enums/two-factor-provider-type\";\n\nexport class TwoFactorProviderResponse extends BaseResponse {\n  enabled: boolean;\n  type: TwoFactorProviderType;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.type = this.getResponseProperty(\"Type\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorRecoverResponse extends BaseResponse {\n  code: string;\n\n  constructor(response: any) {\n    super(response);\n    this.code = this.getResponseProperty(\"Code\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { Utils } from \"../../../platform/misc/utils\";\n\nexport class TwoFactorWebAuthnResponse extends BaseResponse {\n  enabled: boolean;\n  keys: KeyResponse[];\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    const keys = this.getResponseProperty(\"Keys\");\n    this.keys = keys == null ? null : keys.map((k: any) => new KeyResponse(k));\n  }\n}\n\nexport class KeyResponse extends BaseResponse {\n  name: string;\n  id: number;\n  migrated: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.name = this.getResponseProperty(\"Name\");\n    this.id = this.getResponseProperty(\"Id\");\n    this.migrated = this.getResponseProperty(\"Migrated\");\n  }\n}\n\nexport class ChallengeResponse extends BaseResponse implements PublicKeyCredentialCreationOptions {\n  attestation?: AttestationConveyancePreference;\n  authenticatorSelection?: AuthenticatorSelectionCriteria;\n  challenge: BufferSource;\n  excludeCredentials?: PublicKeyCredentialDescriptor[];\n  extensions?: AuthenticationExtensionsClientInputs;\n  pubKeyCredParams: PublicKeyCredentialParameters[];\n  rp: PublicKeyCredentialRpEntity;\n  timeout?: number;\n  user: PublicKeyCredentialUserEntity;\n\n  constructor(response: any) {\n    super(response);\n    this.attestation = this.getResponseProperty(\"attestation\");\n    this.authenticatorSelection = this.getResponseProperty(\"authenticatorSelection\");\n    this.challenge = Utils.fromUrlB64ToArray(this.getResponseProperty(\"challenge\"));\n    this.excludeCredentials = this.getResponseProperty(\"excludeCredentials\").map((c: any) => {\n      c.id = Utils.fromUrlB64ToArray(c.id).buffer;\n      return c;\n    });\n    this.extensions = this.getResponseProperty(\"extensions\");\n    this.pubKeyCredParams = this.getResponseProperty(\"pubKeyCredParams\");\n    this.rp = this.getResponseProperty(\"rp\");\n    this.timeout = this.getResponseProperty(\"timeout\");\n\n    const user = this.getResponseProperty(\"user\");\n    user.id = Utils.fromUrlB64ToArray(user.id);\n\n    this.user = user;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TwoFactorYubiKeyResponse extends BaseResponse {\n  enabled: boolean;\n  key1: string;\n  key2: string;\n  key3: string;\n  key4: string;\n  key5: string;\n  nfc: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.key1 = this.getResponseProperty(\"Key1\");\n    this.key2 = this.getResponseProperty(\"Key2\");\n    this.key3 = this.getResponseProperty(\"Key3\");\n    this.key4 = this.getResponseProperty(\"Key4\");\n    this.key5 = this.getResponseProperty(\"Key5\");\n    this.nfc = this.getResponseProperty(\"Nfc\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { PaymentMethodType, TransactionType } from \"../../enums\";\n\nexport class BillingResponse extends BaseResponse {\n  balance: number;\n  paymentSource: BillingSourceResponse;\n  invoices: BillingInvoiceResponse[] = [];\n  transactions: BillingTransactionResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n    this.balance = this.getResponseProperty(\"Balance\");\n    const paymentSource = this.getResponseProperty(\"PaymentSource\");\n    const transactions = this.getResponseProperty(\"Transactions\");\n    const invoices = this.getResponseProperty(\"Invoices\");\n    this.paymentSource = paymentSource == null ? null : new BillingSourceResponse(paymentSource);\n    if (transactions != null) {\n      this.transactions = transactions.map((t: any) => new BillingTransactionResponse(t));\n    }\n    if (invoices != null) {\n      this.invoices = invoices.map((i: any) => new BillingInvoiceResponse(i));\n    }\n  }\n\n  get hasNoHistory() {\n    return this.invoices.length == 0 && this.transactions.length == 0;\n  }\n}\n\nexport class BillingSourceResponse extends BaseResponse {\n  type: PaymentMethodType;\n  cardBrand: string;\n  description: string;\n  needsVerification: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.type = this.getResponseProperty(\"Type\");\n    this.cardBrand = this.getResponseProperty(\"CardBrand\");\n    this.description = this.getResponseProperty(\"Description\");\n    this.needsVerification = this.getResponseProperty(\"NeedsVerification\");\n  }\n}\n\nexport class BillingInvoiceResponse extends BaseResponse {\n  url: string;\n  pdfUrl: string;\n  number: string;\n  paid: boolean;\n  date: string;\n  amount: number;\n\n  constructor(response: any) {\n    super(response);\n    this.url = this.getResponseProperty(\"Url\");\n    this.pdfUrl = this.getResponseProperty(\"PdfUrl\");\n    this.number = this.getResponseProperty(\"Number\");\n    this.paid = this.getResponseProperty(\"Paid\");\n    this.date = this.getResponseProperty(\"Date\");\n    this.amount = this.getResponseProperty(\"Amount\");\n  }\n}\n\nexport class BillingTransactionResponse extends BaseResponse {\n  createdDate: string;\n  amount: number;\n  refunded: boolean;\n  partiallyRefunded: boolean;\n  refundedAmount: number;\n  type: TransactionType;\n  paymentMethodType: PaymentMethodType;\n  details: string;\n\n  constructor(response: any) {\n    super(response);\n    this.createdDate = this.getResponseProperty(\"CreatedDate\");\n    this.amount = this.getResponseProperty(\"Amount\");\n    this.refunded = this.getResponseProperty(\"Refunded\");\n    this.partiallyRefunded = this.getResponseProperty(\"PartiallyRefunded\");\n    this.refundedAmount = this.getResponseProperty(\"RefundedAmount\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.paymentMethodType = this.getResponseProperty(\"PaymentMethodType\");\n    this.details = this.getResponseProperty(\"Details\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nimport { BillingInvoiceResponse, BillingTransactionResponse } from \"./billing.response\";\n\nexport class BillingHistoryResponse extends BaseResponse {\n  invoices: BillingInvoiceResponse[] = [];\n  transactions: BillingTransactionResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n    const transactions = this.getResponseProperty(\"Transactions\");\n    const invoices = this.getResponseProperty(\"Invoices\");\n    if (transactions != null) {\n      this.transactions = transactions.map((t: any) => new BillingTransactionResponse(t));\n    }\n    if (invoices != null) {\n      this.invoices = invoices.map((i: any) => new BillingInvoiceResponse(i));\n    }\n  }\n\n  get hasNoHistory() {\n    return this.invoices.length == 0 && this.transactions.length == 0;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nimport { BillingSourceResponse } from \"./billing.response\";\n\nexport class BillingPaymentResponse extends BaseResponse {\n  balance: number;\n  paymentSource: BillingSourceResponse;\n\n  constructor(response: any) {\n    super(response);\n    this.balance = this.getResponseProperty(\"Balance\");\n    const paymentSource = this.getResponseProperty(\"PaymentSource\");\n    this.paymentSource = paymentSource == null ? null : new BillingSourceResponse(paymentSource);\n  }\n}\n","import { ProductType } from \"../../../enums\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { OrganizationUserStatusType, OrganizationUserType, ProviderType } from \"../../enums\";\nimport { PermissionsApi } from \"../api/permissions.api\";\n\nexport class ProfileOrganizationResponse extends BaseResponse {\n  id: string;\n  name: string;\n  usePolicies: boolean;\n  useGroups: boolean;\n  useDirectory: boolean;\n  useEvents: boolean;\n  useTotp: boolean;\n  use2fa: boolean;\n  useApi: boolean;\n  useSso: boolean;\n  useKeyConnector: boolean;\n  useScim: boolean;\n  useCustomPermissions: boolean;\n  useResetPassword: boolean;\n  useSecretsManager: boolean;\n  usePasswordManager: boolean;\n  useActivateAutofillPolicy: boolean;\n  selfHost: boolean;\n  usersGetPremium: boolean;\n  seats: number;\n  maxCollections: number;\n  maxStorageGb?: number;\n  key: string;\n  hasPublicAndPrivateKeys: boolean;\n  status: OrganizationUserStatusType;\n  type: OrganizationUserType;\n  enabled: boolean;\n  ssoBound: boolean;\n  identifier: string;\n  permissions: PermissionsApi;\n  resetPasswordEnrolled: boolean;\n  userId: string;\n  providerId: string;\n  providerName: string;\n  providerType?: ProviderType;\n  familySponsorshipFriendlyName: string;\n  familySponsorshipAvailable: boolean;\n  planProductType: ProductType;\n  keyConnectorEnabled: boolean;\n  keyConnectorUrl: string;\n  familySponsorshipLastSyncDate?: Date;\n  familySponsorshipValidUntil?: Date;\n  familySponsorshipToDelete?: boolean;\n  accessSecretsManager: boolean;\n  limitCollectionCreationDeletion: boolean;\n  allowAdminAccessToAllCollectionItems: boolean;\n  flexibleCollections: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.usePolicies = this.getResponseProperty(\"UsePolicies\");\n    this.useGroups = this.getResponseProperty(\"UseGroups\");\n    this.useDirectory = this.getResponseProperty(\"UseDirectory\");\n    this.useEvents = this.getResponseProperty(\"UseEvents\");\n    this.useTotp = this.getResponseProperty(\"UseTotp\");\n    this.use2fa = this.getResponseProperty(\"Use2fa\");\n    this.useApi = this.getResponseProperty(\"UseApi\");\n    this.useSso = this.getResponseProperty(\"UseSso\");\n    this.useKeyConnector = this.getResponseProperty(\"UseKeyConnector\") ?? false;\n    this.useScim = this.getResponseProperty(\"UseScim\") ?? false;\n    this.useCustomPermissions = this.getResponseProperty(\"UseCustomPermissions\") ?? false;\n    this.useResetPassword = this.getResponseProperty(\"UseResetPassword\");\n    this.useSecretsManager = this.getResponseProperty(\"UseSecretsManager\");\n    this.usePasswordManager = this.getResponseProperty(\"UsePasswordManager\");\n    this.useActivateAutofillPolicy = this.getResponseProperty(\"UseActivateAutofillPolicy\");\n    this.selfHost = this.getResponseProperty(\"SelfHost\");\n    this.usersGetPremium = this.getResponseProperty(\"UsersGetPremium\");\n    this.seats = this.getResponseProperty(\"Seats\");\n    this.maxCollections = this.getResponseProperty(\"MaxCollections\");\n    this.maxStorageGb = this.getResponseProperty(\"MaxStorageGb\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.hasPublicAndPrivateKeys = this.getResponseProperty(\"HasPublicAndPrivateKeys\");\n    this.status = this.getResponseProperty(\"Status\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.ssoBound = this.getResponseProperty(\"SsoBound\");\n    this.identifier = this.getResponseProperty(\"Identifier\");\n    this.permissions = new PermissionsApi(this.getResponseProperty(\"permissions\"));\n    this.resetPasswordEnrolled = this.getResponseProperty(\"ResetPasswordEnrolled\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.providerId = this.getResponseProperty(\"ProviderId\");\n    this.providerName = this.getResponseProperty(\"ProviderName\");\n    this.providerType = this.getResponseProperty(\"ProviderType\");\n    this.familySponsorshipFriendlyName = this.getResponseProperty(\"FamilySponsorshipFriendlyName\");\n    this.familySponsorshipAvailable = this.getResponseProperty(\"FamilySponsorshipAvailable\");\n    this.planProductType = this.getResponseProperty(\"PlanProductType\");\n    this.keyConnectorEnabled = this.getResponseProperty(\"KeyConnectorEnabled\") ?? false;\n    this.keyConnectorUrl = this.getResponseProperty(\"KeyConnectorUrl\");\n    const familySponsorshipLastSyncDateString = this.getResponseProperty(\n      \"FamilySponsorshipLastSyncDate\",\n    );\n    if (familySponsorshipLastSyncDateString) {\n      this.familySponsorshipLastSyncDate = new Date(familySponsorshipLastSyncDateString);\n    }\n    const familySponsorshipValidUntilString = this.getResponseProperty(\n      \"FamilySponsorshipValidUntil\",\n    );\n    if (familySponsorshipValidUntilString) {\n      this.familySponsorshipValidUntil = new Date(familySponsorshipValidUntilString);\n    }\n    this.familySponsorshipToDelete = this.getResponseProperty(\"FamilySponsorshipToDelete\");\n    this.accessSecretsManager = this.getResponseProperty(\"AccessSecretsManager\");\n    this.limitCollectionCreationDeletion = this.getResponseProperty(\n      \"LimitCollectionCreationDeletion\",\n    );\n    this.allowAdminAccessToAllCollectionItems = this.getResponseProperty(\n      \"AllowAdminAccessToAllCollectionItems\",\n    );\n    this.flexibleCollections = this.getResponseProperty(\"FlexibleCollections\");\n  }\n}\n","import { ProfileOrganizationResponse } from \"./profile-organization.response\";\n\nexport class ProfileProviderOrganizationResponse extends ProfileOrganizationResponse {\n  constructor(response: any) {\n    super(response);\n    this.keyConnectorEnabled = false;\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { ProviderUserStatusType, ProviderUserType } from \"../../enums\";\nimport { PermissionsApi } from \"../api/permissions.api\";\n\nexport class ProfileProviderResponse extends BaseResponse {\n  id: string;\n  name: string;\n  key: string;\n  status: ProviderUserStatusType;\n  type: ProviderUserType;\n  enabled: boolean;\n  permissions: PermissionsApi;\n  userId: string;\n  useEvents: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.status = this.getResponseProperty(\"Status\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.enabled = this.getResponseProperty(\"Enabled\");\n    this.permissions = new PermissionsApi(this.getResponseProperty(\"permissions\"));\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.useEvents = this.getResponseProperty(\"UseEvents\");\n  }\n}\n","import { ProfileOrganizationResponse } from \"../../admin-console/models/response/profile-organization.response\";\nimport { ProfileProviderOrganizationResponse } from \"../../admin-console/models/response/profile-provider-organization.response\";\nimport { ProfileProviderResponse } from \"../../admin-console/models/response/profile-provider.response\";\n\nimport { BaseResponse } from \"./base.response\";\n\nexport class ProfileResponse extends BaseResponse {\n  id: string;\n  name: string;\n  email: string;\n  emailVerified: boolean;\n  masterPasswordHint: string;\n  premiumPersonally: boolean;\n  premiumFromOrganization: boolean;\n  culture: string;\n  twoFactorEnabled: boolean;\n  key: string;\n  avatarColor: string;\n  creationDate: string;\n  privateKey: string;\n  securityStamp: string;\n  forcePasswordReset: boolean;\n  usesKeyConnector: boolean;\n  organizations: ProfileOrganizationResponse[] = [];\n  providers: ProfileProviderResponse[] = [];\n  providerOrganizations: ProfileProviderOrganizationResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.email = this.getResponseProperty(\"Email\");\n    this.emailVerified = this.getResponseProperty(\"EmailVerified\");\n    this.masterPasswordHint = this.getResponseProperty(\"MasterPasswordHint\");\n    this.premiumPersonally = this.getResponseProperty(\"Premium\");\n    this.premiumFromOrganization = this.getResponseProperty(\"PremiumFromOrganization\");\n    this.culture = this.getResponseProperty(\"Culture\");\n    this.twoFactorEnabled = this.getResponseProperty(\"TwoFactorEnabled\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.avatarColor = this.getResponseProperty(\"AvatarColor\");\n    this.creationDate = this.getResponseProperty(\"CreationDate\");\n    this.privateKey = this.getResponseProperty(\"PrivateKey\");\n    this.securityStamp = this.getResponseProperty(\"SecurityStamp\");\n    this.forcePasswordReset = this.getResponseProperty(\"ForcePasswordReset\") ?? false;\n    this.usesKeyConnector = this.getResponseProperty(\"UsesKeyConnector\") ?? false;\n\n    const organizations = this.getResponseProperty(\"Organizations\");\n    if (organizations != null) {\n      this.organizations = organizations.map((o: any) => new ProfileOrganizationResponse(o));\n    }\n    const providers = this.getResponseProperty(\"Providers\");\n    if (providers != null) {\n      this.providers = providers.map((o: any) => new ProfileProviderResponse(o));\n    }\n    const providerOrganizations = this.getResponseProperty(\"ProviderOrganizations\");\n    if (providerOrganizations != null) {\n      this.providerOrganizations = providerOrganizations.map(\n        (o: any) => new ProfileProviderOrganizationResponse(o),\n      );\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { ProfileResponse } from \"../../../models/response/profile.response\";\n\nexport class PaymentResponse extends BaseResponse {\n  userProfile: ProfileResponse;\n  paymentIntentClientSecret: string;\n  success: boolean;\n\n  constructor(response: any) {\n    super(response);\n    const userProfile = this.getResponseProperty(\"UserProfile\");\n    if (userProfile != null) {\n      this.userProfile = new ProfileResponse(userProfile);\n    }\n    this.paymentIntentClientSecret = this.getResponseProperty(\"PaymentIntentClientSecret\");\n    this.success = this.getResponseProperty(\"Success\");\n  }\n}\n","import { ProductType } from \"../../../enums\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { PlanType } from \"../../enums\";\n\nexport class PlanResponse extends BaseResponse {\n  type: PlanType;\n  product: ProductType;\n  name: string;\n  isAnnual: boolean;\n  nameLocalizationKey: string;\n  descriptionLocalizationKey: string;\n  canBeUsedByBusiness: boolean;\n  trialPeriodDays: number;\n  hasSelfHost: boolean;\n  hasPolicies: boolean;\n  hasGroups: boolean;\n  hasDirectory: boolean;\n  hasEvents: boolean;\n  hasTotp: boolean;\n  has2fa: boolean;\n  hasApi: boolean;\n  hasSso: boolean;\n  hasResetPassword: boolean;\n  usersGetPremium: boolean;\n  upgradeSortOrder: number;\n  displaySortOrder: number;\n  legacyYear: number;\n  disabled: boolean;\n  PasswordManager: PasswordManagerPlanFeaturesResponse;\n  SecretsManager: SecretsManagerPlanFeaturesResponse;\n\n  constructor(response: any) {\n    super(response);\n    this.type = this.getResponseProperty(\"Type\");\n    this.product = this.getResponseProperty(\"Product\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.isAnnual = this.getResponseProperty(\"IsAnnual\");\n    this.nameLocalizationKey = this.getResponseProperty(\"NameLocalizationKey\");\n    this.descriptionLocalizationKey = this.getResponseProperty(\"DescriptionLocalizationKey\");\n    this.canBeUsedByBusiness = this.getResponseProperty(\"CanBeUsedByBusiness\");\n    this.trialPeriodDays = this.getResponseProperty(\"TrialPeriodDays\");\n    this.hasSelfHost = this.getResponseProperty(\"HasSelfHost\");\n    this.hasPolicies = this.getResponseProperty(\"HasPolicies\");\n    this.hasGroups = this.getResponseProperty(\"HasGroups\");\n    this.hasDirectory = this.getResponseProperty(\"HasDirectory\");\n    this.hasEvents = this.getResponseProperty(\"HasEvents\");\n    this.hasTotp = this.getResponseProperty(\"HasTotp\");\n    this.has2fa = this.getResponseProperty(\"Has2fa\");\n    this.hasApi = this.getResponseProperty(\"HasApi\");\n    this.hasSso = this.getResponseProperty(\"HasSso\");\n    this.hasResetPassword = this.getResponseProperty(\"HasResetPassword\");\n    this.usersGetPremium = this.getResponseProperty(\"UsersGetPremium\");\n    this.upgradeSortOrder = this.getResponseProperty(\"UpgradeSortOrder\");\n    this.displaySortOrder = this.getResponseProperty(\"DisplaySortOrder\");\n    this.legacyYear = this.getResponseProperty(\"LegacyYear\");\n    this.disabled = this.getResponseProperty(\"Disabled\");\n    const passwordManager = this.getResponseProperty(\"PasswordManager\");\n    const secretsManager = this.getResponseProperty(\"SecretsManager\");\n    this.PasswordManager =\n      passwordManager == null ? null : new PasswordManagerPlanFeaturesResponse(passwordManager);\n    this.SecretsManager =\n      secretsManager == null ? null : new SecretsManagerPlanFeaturesResponse(secretsManager);\n  }\n}\n\nexport class SecretsManagerPlanFeaturesResponse extends BaseResponse {\n  // Seats\n  stripeSeatPlanId: string;\n  baseSeats: number;\n  basePrice: number;\n  seatPrice: number;\n  hasAdditionalSeatsOption: boolean;\n  maxAdditionalSeats: number;\n  maxSeats: number;\n\n  // Service accounts\n  stripeServiceAccountPlanId: string;\n  additionalPricePerServiceAccount: number;\n  baseServiceAccount: number;\n  maxServiceAccount: number;\n  hasAdditionalServiceAccountOption: boolean;\n  maxAdditionalServiceAccounts: number;\n\n  // Features\n  maxProjects: number;\n\n  constructor(response: any) {\n    super(response);\n    this.stripeSeatPlanId = this.getResponseProperty(\"StripeSeatPlanId\");\n    this.baseSeats = this.getResponseProperty(\"BaseSeats\");\n    this.basePrice = this.getResponseProperty(\"BasePrice\");\n    this.seatPrice = this.getResponseProperty(\"SeatPrice\");\n    this.hasAdditionalSeatsOption = this.getResponseProperty(\"HasAdditionalSeatsOption\");\n    this.maxAdditionalSeats = this.getResponseProperty(\"MaxAdditionalSeats\");\n    this.maxSeats = this.getResponseProperty(\"MaxSeats\");\n    this.stripeServiceAccountPlanId = this.getResponseProperty(\"StripeServiceAccountPlanId\");\n    this.additionalPricePerServiceAccount = this.getResponseProperty(\n      \"AdditionalPricePerServiceAccount\",\n    );\n    this.baseServiceAccount = this.getResponseProperty(\"BaseServiceAccount\");\n    this.maxServiceAccount = this.getResponseProperty(\"MaxServiceAccount\");\n    this.hasAdditionalServiceAccountOption = this.getResponseProperty(\n      \"HasAdditionalServiceAccountOption\",\n    );\n    this.maxAdditionalServiceAccounts = this.getResponseProperty(\"MaxAdditionalServiceAccounts\");\n    this.maxProjects = this.getResponseProperty(\"MaxProjects\");\n  }\n}\n\nexport class PasswordManagerPlanFeaturesResponse extends BaseResponse {\n  // Seats\n  stripePlanId: string;\n  stripeSeatPlanId: string;\n  stripePremiumAccessPlanId: string;\n  basePrice: number;\n  seatPrice: number;\n  premiumAccessOptionPrice: number;\n  baseSeats: number;\n  maxAdditionalSeats: number;\n  maxSeats: number;\n  hasPremiumAccessOption: boolean;\n\n  // Storage\n  additionalStoragePricePerGb: number;\n  stripeStoragePlanId: string;\n  baseStorageGb: number;\n  hasAdditionalStorageOption: boolean;\n  maxAdditionalStorage: number;\n  hasAdditionalSeatsOption: boolean;\n\n  // Feature\n  maxCollections: number;\n\n  constructor(response: any) {\n    super(response);\n    this.stripePlanId = this.getResponseProperty(\"StripePlanId\");\n    this.stripeSeatPlanId = this.getResponseProperty(\"StripeSeatPlanId\");\n    this.stripeStoragePlanId = this.getResponseProperty(\"StripeStoragePlanId\");\n    this.stripePremiumAccessPlanId = this.getResponseProperty(\"StripePremiumAccessPlanId\");\n    this.basePrice = this.getResponseProperty(\"BasePrice\");\n    this.seatPrice = this.getResponseProperty(\"SeatPrice\");\n    this.baseSeats = this.getResponseProperty(\"BaseSeats\");\n    this.maxAdditionalSeats = this.getResponseProperty(\"MaxAdditionalSeats\");\n    this.premiumAccessOptionPrice = this.getResponseProperty(\"PremiumAccessOptionPrice\");\n    this.maxSeats = this.getResponseProperty(\"MaxSeats\");\n    this.additionalStoragePricePerGb = this.getResponseProperty(\"AdditionalStoragePricePerGb\");\n    this.hasAdditionalSeatsOption = this.getResponseProperty(\"HasAdditionalSeatsOption\");\n    this.baseStorageGb = this.getResponseProperty(\"BaseStorageGb\");\n    this.maxCollections = this.getResponseProperty(\"MaxCollections\");\n    this.hasAdditionalStorageOption = this.getResponseProperty(\"HasAdditionalStorageOption\");\n    this.maxAdditionalStorage = this.getResponseProperty(\"MaxAdditionalStorage\");\n    this.hasPremiumAccessOption = this.getResponseProperty(\"HasPremiumAccessOption\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class SubscriptionResponse extends BaseResponse {\n  storageName: string;\n  storageGb: number;\n  maxStorageGb: number;\n  subscription: BillingSubscriptionResponse;\n  upcomingInvoice: BillingSubscriptionUpcomingInvoiceResponse;\n  license: any;\n  expiration: string;\n\n  constructor(response: any) {\n    super(response);\n    this.storageName = this.getResponseProperty(\"StorageName\");\n    this.storageGb = this.getResponseProperty(\"StorageGb\");\n    this.maxStorageGb = this.getResponseProperty(\"MaxStorageGb\");\n    this.license = this.getResponseProperty(\"License\");\n    this.expiration = this.getResponseProperty(\"Expiration\");\n    const subscription = this.getResponseProperty(\"Subscription\");\n    const upcomingInvoice = this.getResponseProperty(\"UpcomingInvoice\");\n    this.subscription = subscription == null ? null : new BillingSubscriptionResponse(subscription);\n    this.upcomingInvoice =\n      upcomingInvoice == null\n        ? null\n        : new BillingSubscriptionUpcomingInvoiceResponse(upcomingInvoice);\n  }\n}\n\nexport class BillingSubscriptionResponse extends BaseResponse {\n  trialStartDate: string;\n  trialEndDate: string;\n  periodStartDate: string;\n  periodEndDate: string;\n  cancelledDate: string;\n  cancelAtEndDate: boolean;\n  status: string;\n  cancelled: boolean;\n  items: BillingSubscriptionItemResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n    this.trialStartDate = this.getResponseProperty(\"TrialStartDate\");\n    this.trialEndDate = this.getResponseProperty(\"TrialEndDate\");\n    this.periodStartDate = this.getResponseProperty(\"PeriodStartDate\");\n    this.periodEndDate = this.getResponseProperty(\"PeriodEndDate\");\n    this.cancelledDate = this.getResponseProperty(\"CancelledDate\");\n    this.cancelAtEndDate = this.getResponseProperty(\"CancelAtEndDate\");\n    this.status = this.getResponseProperty(\"Status\");\n    this.cancelled = this.getResponseProperty(\"Cancelled\");\n    const items = this.getResponseProperty(\"Items\");\n    if (items != null) {\n      this.items = items.map((i: any) => new BillingSubscriptionItemResponse(i));\n    }\n  }\n}\n\nexport class BillingSubscriptionItemResponse extends BaseResponse {\n  productId: string;\n  name: string;\n  amount: number;\n  quantity: number;\n  interval: string;\n  sponsoredSubscriptionItem: boolean;\n  addonSubscriptionItem: boolean;\n  productName: string;\n\n  constructor(response: any) {\n    super(response);\n    this.productId = this.getResponseProperty(\"ProductId\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.amount = this.getResponseProperty(\"Amount\");\n    this.quantity = this.getResponseProperty(\"Quantity\");\n    this.interval = this.getResponseProperty(\"Interval\");\n    this.sponsoredSubscriptionItem = this.getResponseProperty(\"SponsoredSubscriptionItem\");\n    this.addonSubscriptionItem = this.getResponseProperty(\"AddonSubscriptionItem\");\n  }\n}\n\nexport class BillingSubscriptionUpcomingInvoiceResponse extends BaseResponse {\n  date: string;\n  amount?: number;\n\n  constructor(response: any) {\n    super(response);\n    this.date = this.getResponseProperty(\"Date\");\n    this.amount = this.getResponseProperty(\"Amount\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TaxInfoResponse extends BaseResponse {\n  taxId: string;\n  taxIdType: string;\n  line1: string;\n  line2: string;\n  city: string;\n  state: string;\n  country: string;\n  postalCode: string;\n\n  constructor(response: any) {\n    super(response);\n    this.taxId = this.getResponseProperty(\"TaxIdNumber\");\n    this.taxIdType = this.getResponseProperty(\"TaxIdType\");\n    this.line1 = this.getResponseProperty(\"Line1\");\n    this.line2 = this.getResponseProperty(\"Line2\");\n    this.city = this.getResponseProperty(\"City\");\n    this.state = this.getResponseProperty(\"State\");\n    this.postalCode = this.getResponseProperty(\"PostalCode\");\n    this.country = this.getResponseProperty(\"Country\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class TaxRateResponse extends BaseResponse {\n  id: string;\n  country: string;\n  state: string;\n  postalCode: string;\n  rate: number;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.country = this.getResponseProperty(\"Country\");\n    this.state = this.getResponseProperty(\"State\");\n    this.postalCode = this.getResponseProperty(\"PostalCode\");\n    this.rate = this.getResponseProperty(\"Rate\");\n  }\n}\n","export class CollectionBulkDeleteRequest {\n  ids: string[];\n\n  constructor(ids: string[]) {\n    this.ids = ids == null ? [] : ids;\n  }\n}\n","import { BaseResponse } from \"./base.response\";\n\nexport class BreachAccountResponse extends BaseResponse {\n  addedDate: string;\n  breachDate: string;\n  dataClasses: string[];\n  description: string;\n  domain: string;\n  isActive: boolean;\n  isVerified: boolean;\n  logoPath: string;\n  modifiedDate: string;\n  name: string;\n  pwnCount: number;\n  title: string;\n\n  constructor(response: any) {\n    super(response);\n    this.addedDate = this.getResponseProperty(\"AddedDate\");\n    this.breachDate = this.getResponseProperty(\"BreachDate\");\n    this.dataClasses = this.getResponseProperty(\"DataClasses\");\n    this.description = this.getResponseProperty(\"Description\");\n    this.domain = this.getResponseProperty(\"Domain\");\n    this.isActive = this.getResponseProperty(\"IsActive\");\n    this.isVerified = this.getResponseProperty(\"IsVerified\");\n    this.logoPath = this.getResponseProperty(\"LogoPath\");\n    this.modifiedDate = this.getResponseProperty(\"ModifiedDate\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.pwnCount = this.getResponseProperty(\"PwnCount\");\n    this.title = this.getResponseProperty(\"Title\");\n  }\n}\n","import { BaseResponse } from \"./base.response\";\n\nexport class GlobalDomainResponse extends BaseResponse {\n  type: number;\n  domains: string[];\n  excluded: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.type = this.getResponseProperty(\"Type\");\n    this.domains = this.getResponseProperty(\"Domains\");\n    this.excluded = this.getResponseProperty(\"Excluded\");\n  }\n}\n","import { BaseResponse } from \"./base.response\";\nimport { GlobalDomainResponse } from \"./global-domain.response\";\n\nexport class DomainsResponse extends BaseResponse {\n  equivalentDomains: string[][];\n  globalEquivalentDomains: GlobalDomainResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n    this.equivalentDomains = this.getResponseProperty(\"EquivalentDomains\");\n    const globalEquivalentDomains = this.getResponseProperty(\"GlobalEquivalentDomains\");\n    if (globalEquivalentDomains != null) {\n      this.globalEquivalentDomains = globalEquivalentDomains.map(\n        (d: any) => new GlobalDomainResponse(d),\n      );\n    } else {\n      this.globalEquivalentDomains = [];\n    }\n  }\n}\n","import { DeviceType, EventSystemUser, EventType } from \"../../enums\";\n\nimport { BaseResponse } from \"./base.response\";\n\nexport class EventResponse extends BaseResponse {\n  type: EventType;\n  userId: string;\n  organizationId: string;\n  providerId: string;\n  cipherId: string;\n  collectionId: string;\n  groupId: string;\n  policyId: string;\n  organizationUserId: string;\n  providerUserId: string;\n  providerOrganizationId: string;\n  actingUserId: string;\n  date: string;\n  deviceType: DeviceType;\n  ipAddress: string;\n  installationId: string;\n  systemUser: EventSystemUser;\n  domainName: string;\n  secretId: string;\n  serviceAccountId: string;\n\n  constructor(response: any) {\n    super(response);\n    this.type = this.getResponseProperty(\"Type\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.providerId = this.getResponseProperty(\"ProviderId\");\n    this.cipherId = this.getResponseProperty(\"CipherId\");\n    this.collectionId = this.getResponseProperty(\"CollectionId\");\n    this.groupId = this.getResponseProperty(\"GroupId\");\n    this.policyId = this.getResponseProperty(\"PolicyId\");\n    this.organizationUserId = this.getResponseProperty(\"OrganizationUserId\");\n    this.providerUserId = this.getResponseProperty(\"ProviderUserId\");\n    this.providerOrganizationId = this.getResponseProperty(\"ProviderOrganizationId\");\n    this.actingUserId = this.getResponseProperty(\"ActingUserId\");\n    this.date = this.getResponseProperty(\"Date\");\n    this.deviceType = this.getResponseProperty(\"DeviceType\");\n    this.ipAddress = this.getResponseProperty(\"IpAddress\");\n    this.installationId = this.getResponseProperty(\"InstallationId\");\n    this.systemUser = this.getResponseProperty(\"SystemUser\");\n    this.domainName = this.getResponseProperty(\"DomainName\");\n    this.secretId = this.getResponseProperty(\"SecretId\");\n    this.serviceAccountId = this.getResponseProperty(\"ServiceAccountId\");\n  }\n}\n","import { BaseResponse } from \"./base.response\";\n\nexport class UserKeyResponse extends BaseResponse {\n  userId: string;\n  publicKey: string;\n\n  constructor(response: any) {\n    super(response);\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.publicKey = this.getResponseProperty(\"PublicKey\");\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\nimport { FileUploadType } from \"../../../platform/enums\";\n\nimport { CipherResponse } from \"./cipher.response\";\n\nexport class AttachmentUploadDataResponse extends BaseResponse {\n  attachmentId: string;\n  fileUploadType: FileUploadType;\n  cipherResponse: CipherResponse;\n  cipherMiniResponse: CipherResponse;\n  url: string = null;\n  constructor(response: any) {\n    super(response);\n    this.attachmentId = this.getResponseProperty(\"AttachmentId\");\n    this.fileUploadType = this.getResponseProperty(\"FileUploadType\");\n    const cipherResponse = this.getResponseProperty(\"CipherResponse\");\n    const cipherMiniResponse = this.getResponseProperty(\"CipherMiniResponse\");\n    this.cipherResponse = cipherResponse == null ? null : new CipherResponse(cipherResponse);\n    this.cipherMiniResponse =\n      cipherMiniResponse == null ? null : new CipherResponse(cipherMiniResponse);\n    this.url = this.getResponseProperty(\"Url\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class SendFileApi extends BaseResponse {\n  id: string;\n  fileName: string;\n  size: string;\n  sizeName: string;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.id = this.getResponseProperty(\"Id\");\n    this.fileName = this.getResponseProperty(\"FileName\");\n    this.size = this.getResponseProperty(\"Size\");\n    this.sizeName = this.getResponseProperty(\"SizeName\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class SendTextApi extends BaseResponse {\n  text: string;\n  hidden: boolean;\n\n  constructor(data: any = null) {\n    super(data);\n    if (data == null) {\n      return;\n    }\n    this.text = this.getResponseProperty(\"Text\");\n    this.hidden = this.getResponseProperty(\"Hidden\") || false;\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { SendType } from \"../../enums/send-type\";\nimport { SendFileApi } from \"../api/send-file.api\";\nimport { SendTextApi } from \"../api/send-text.api\";\n\nexport class SendResponse extends BaseResponse {\n  id: string;\n  accessId: string;\n  type: SendType;\n  name: string;\n  notes: string;\n  file: SendFileApi;\n  text: SendTextApi;\n  key: string;\n  maxAccessCount?: number;\n  accessCount: number;\n  revisionDate: string;\n  expirationDate: string;\n  deletionDate: string;\n  password: string;\n  disable: boolean;\n  hideEmail: boolean;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.accessId = this.getResponseProperty(\"AccessId\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.notes = this.getResponseProperty(\"Notes\");\n    this.key = this.getResponseProperty(\"Key\");\n    this.maxAccessCount = this.getResponseProperty(\"MaxAccessCount\");\n    this.accessCount = this.getResponseProperty(\"AccessCount\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n    this.expirationDate = this.getResponseProperty(\"ExpirationDate\");\n    this.deletionDate = this.getResponseProperty(\"DeletionDate\");\n    this.password = this.getResponseProperty(\"Password\");\n    this.disable = this.getResponseProperty(\"Disabled\") || false;\n    this.hideEmail = this.getResponseProperty(\"HideEmail\") || false;\n\n    const text = this.getResponseProperty(\"Text\");\n    if (text != null) {\n      this.text = new SendTextApi(text);\n    }\n\n    const file = this.getResponseProperty(\"File\");\n    if (file != null) {\n      this.file = new SendFileApi(file);\n    }\n  }\n}\n","import { BaseResponse } from \"../../../models/response/base.response\";\n\nexport class FolderResponse extends BaseResponse {\n  id: string;\n  name: string;\n  revisionDate: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.name = this.getResponseProperty(\"Name\");\n    this.revisionDate = this.getResponseProperty(\"RevisionDate\");\n  }\n}\n","import { PolicyResponse } from \"../../../admin-console/models/response/policy.response\";\nimport { BaseResponse } from \"../../../models/response/base.response\";\nimport { DomainsResponse } from \"../../../models/response/domains.response\";\nimport { ProfileResponse } from \"../../../models/response/profile.response\";\nimport { SendResponse } from \"../../../tools/send/models/response/send.response\";\n\nimport { CipherResponse } from \"./cipher.response\";\nimport { CollectionDetailsResponse } from \"./collection.response\";\nimport { FolderResponse } from \"./folder.response\";\n\nexport class SyncResponse extends BaseResponse {\n  profile?: ProfileResponse;\n  folders: FolderResponse[] = [];\n  collections: CollectionDetailsResponse[] = [];\n  ciphers: CipherResponse[] = [];\n  domains?: DomainsResponse;\n  policies?: PolicyResponse[] = [];\n  sends: SendResponse[] = [];\n\n  constructor(response: any) {\n    super(response);\n\n    const profile = this.getResponseProperty(\"Profile\");\n    if (profile != null) {\n      this.profile = new ProfileResponse(profile);\n    }\n\n    const folders = this.getResponseProperty(\"Folders\");\n    if (folders != null) {\n      this.folders = folders.map((f: any) => new FolderResponse(f));\n    }\n\n    const collections = this.getResponseProperty(\"Collections\");\n    if (collections != null) {\n      this.collections = collections.map((c: any) => new CollectionDetailsResponse(c));\n    }\n\n    const ciphers = this.getResponseProperty(\"Ciphers\");\n    if (ciphers != null) {\n      this.ciphers = ciphers.map((c: any) => new CipherResponse(c));\n    }\n\n    const domains = this.getResponseProperty(\"Domains\");\n    if (domains != null) {\n      this.domains = new DomainsResponse(domains);\n    }\n\n    const policies = this.getResponseProperty(\"Policies\");\n    if (policies != null) {\n      this.policies = policies.map((p: any) => new PolicyResponse(p));\n    }\n\n    const sends = this.getResponseProperty(\"Sends\");\n    if (sends != null) {\n      this.sends = sends.map((s: any) => new SendResponse(s));\n    }\n  }\n}\n","import { ApiService as ApiServiceAbstraction } from \"../abstractions/api.service\";\nimport { OrganizationConnectionType } from \"../admin-console/enums\";\nimport { OrganizationSponsorshipCreateRequest } from \"../admin-console/models/request/organization/organization-sponsorship-create.request\";\nimport { OrganizationSponsorshipRedeemRequest } from \"../admin-console/models/request/organization/organization-sponsorship-redeem.request\";\nimport { OrganizationConnectionRequest } from \"../admin-console/models/request/organization-connection.request\";\nimport { ProviderAddOrganizationRequest } from \"../admin-console/models/request/provider/provider-add-organization.request\";\nimport { ProviderOrganizationCreateRequest } from \"../admin-console/models/request/provider/provider-organization-create.request\";\nimport { ProviderSetupRequest } from \"../admin-console/models/request/provider/provider-setup.request\";\nimport { ProviderUpdateRequest } from \"../admin-console/models/request/provider/provider-update.request\";\nimport { ProviderUserAcceptRequest } from \"../admin-console/models/request/provider/provider-user-accept.request\";\nimport { ProviderUserBulkConfirmRequest } from \"../admin-console/models/request/provider/provider-user-bulk-confirm.request\";\nimport { ProviderUserBulkRequest } from \"../admin-console/models/request/provider/provider-user-bulk.request\";\nimport { ProviderUserConfirmRequest } from \"../admin-console/models/request/provider/provider-user-confirm.request\";\nimport { ProviderUserInviteRequest } from \"../admin-console/models/request/provider/provider-user-invite.request\";\nimport { ProviderUserUpdateRequest } from \"../admin-console/models/request/provider/provider-user-update.request\";\nimport { SelectionReadOnlyRequest } from \"../admin-console/models/request/selection-read-only.request\";\nimport {\n  OrganizationConnectionConfigApis,\n  OrganizationConnectionResponse,\n} from \"../admin-console/models/response/organization-connection.response\";\nimport { OrganizationExportResponse } from \"../admin-console/models/response/organization-export.response\";\nimport { OrganizationSponsorshipSyncStatusResponse } from \"../admin-console/models/response/organization-sponsorship-sync-status.response\";\nimport {\n  ProviderOrganizationOrganizationDetailsResponse,\n  ProviderOrganizationResponse,\n} from \"../admin-console/models/response/provider/provider-organization.response\";\nimport { ProviderUserBulkPublicKeyResponse } from \"../admin-console/models/response/provider/provider-user-bulk-public-key.response\";\nimport { ProviderUserBulkResponse } from \"../admin-console/models/response/provider/provider-user-bulk.response\";\nimport {\n  ProviderUserResponse,\n  ProviderUserUserDetailsResponse,\n} from \"../admin-console/models/response/provider/provider-user.response\";\nimport { ProviderResponse } from \"../admin-console/models/response/provider/provider.response\";\nimport { SelectionReadOnlyResponse } from \"../admin-console/models/response/selection-read-only.response\";\nimport { TokenService } from \"../auth/abstractions/token.service\";\nimport { CreateAuthRequest } from \"../auth/models/request/create-auth.request\";\nimport { DeviceVerificationRequest } from \"../auth/models/request/device-verification.request\";\nimport { EmailTokenRequest } from \"../auth/models/request/email-token.request\";\nimport { EmailRequest } from \"../auth/models/request/email.request\";\nimport { DeviceRequest } from \"../auth/models/request/identity-token/device.request\";\nimport { PasswordTokenRequest } from \"../auth/models/request/identity-token/password-token.request\";\nimport { SsoTokenRequest } from \"../auth/models/request/identity-token/sso-token.request\";\nimport { TokenTwoFactorRequest } from \"../auth/models/request/identity-token/token-two-factor.request\";\nimport { UserApiTokenRequest } from \"../auth/models/request/identity-token/user-api-token.request\";\nimport { WebAuthnLoginTokenRequest } from \"../auth/models/request/identity-token/webauthn-login-token.request\";\nimport { KeyConnectorUserKeyRequest } from \"../auth/models/request/key-connector-user-key.request\";\nimport { PasswordHintRequest } from \"../auth/models/request/password-hint.request\";\nimport { PasswordRequest } from \"../auth/models/request/password.request\";\nimport { PasswordlessAuthRequest } from \"../auth/models/request/passwordless-auth.request\";\nimport { SecretVerificationRequest } from \"../auth/models/request/secret-verification.request\";\nimport { SetKeyConnectorKeyRequest } from \"../auth/models/request/set-key-connector-key.request\";\nimport { SetPasswordRequest } from \"../auth/models/request/set-password.request\";\nimport { TwoFactorEmailRequest } from \"../auth/models/request/two-factor-email.request\";\nimport { TwoFactorProviderRequest } from \"../auth/models/request/two-factor-provider.request\";\nimport { TwoFactorRecoveryRequest } from \"../auth/models/request/two-factor-recovery.request\";\nimport { UpdateProfileRequest } from \"../auth/models/request/update-profile.request\";\nimport { UpdateTempPasswordRequest } from \"../auth/models/request/update-temp-password.request\";\nimport { UpdateTwoFactorAuthenticatorRequest } from \"../auth/models/request/update-two-factor-authenticator.request\";\nimport { UpdateTwoFactorDuoRequest } from \"../auth/models/request/update-two-factor-duo.request\";\nimport { UpdateTwoFactorEmailRequest } from \"../auth/models/request/update-two-factor-email.request\";\nimport { UpdateTwoFactorWebAuthnDeleteRequest } from \"../auth/models/request/update-two-factor-web-authn-delete.request\";\nimport { UpdateTwoFactorWebAuthnRequest } from \"../auth/models/request/update-two-factor-web-authn.request\";\nimport { UpdateTwoFactorYubioOtpRequest } from \"../auth/models/request/update-two-factor-yubio-otp.request\";\nimport { ApiKeyResponse } from \"../auth/models/response/api-key.response\";\nimport { AuthRequestResponse } from \"../auth/models/response/auth-request.response\";\nimport { DeviceVerificationResponse } from \"../auth/models/response/device-verification.response\";\nimport { IdentityCaptchaResponse } from \"../auth/models/response/identity-captcha.response\";\nimport { IdentityTokenResponse } from \"../auth/models/response/identity-token.response\";\nimport { IdentityTwoFactorResponse } from \"../auth/models/response/identity-two-factor.response\";\nimport { KeyConnectorUserKeyResponse } from \"../auth/models/response/key-connector-user-key.response\";\nimport { MasterPasswordPolicyResponse } from \"../auth/models/response/master-password-policy.response\";\nimport { PreloginResponse } from \"../auth/models/response/prelogin.response\";\nimport { RegisterResponse } from \"../auth/models/response/register.response\";\nimport { SsoPreValidateResponse } from \"../auth/models/response/sso-pre-validate.response\";\nimport { TwoFactorAuthenticatorResponse } from \"../auth/models/response/two-factor-authenticator.response\";\nimport { TwoFactorDuoResponse } from \"../auth/models/response/two-factor-duo.response\";\nimport { TwoFactorEmailResponse } from \"../auth/models/response/two-factor-email.response\";\nimport { TwoFactorProviderResponse } from \"../auth/models/response/two-factor-provider.response\";\nimport { TwoFactorRecoverResponse } from \"../auth/models/response/two-factor-recover.response\";\nimport {\n  ChallengeResponse,\n  TwoFactorWebAuthnResponse,\n} from \"../auth/models/response/two-factor-web-authn.response\";\nimport { TwoFactorYubiKeyResponse } from \"../auth/models/response/two-factor-yubi-key.response\";\nimport { BitPayInvoiceRequest } from \"../billing/models/request/bit-pay-invoice.request\";\nimport { PaymentRequest } from \"../billing/models/request/payment.request\";\nimport { TaxInfoUpdateRequest } from \"../billing/models/request/tax-info-update.request\";\nimport { BillingHistoryResponse } from \"../billing/models/response/billing-history.response\";\nimport { BillingPaymentResponse } from \"../billing/models/response/billing-payment.response\";\nimport { PaymentResponse } from \"../billing/models/response/payment.response\";\nimport { PlanResponse } from \"../billing/models/response/plan.response\";\nimport { SubscriptionResponse } from \"../billing/models/response/subscription.response\";\nimport { TaxInfoResponse } from \"../billing/models/response/tax-info.response\";\nimport { TaxRateResponse } from \"../billing/models/response/tax-rate.response\";\nimport { DeviceType } from \"../enums\";\nimport { CollectionBulkDeleteRequest } from \"../models/request/collection-bulk-delete.request\";\nimport { DeleteRecoverRequest } from \"../models/request/delete-recover.request\";\nimport { EventRequest } from \"../models/request/event.request\";\nimport { KdfRequest } from \"../models/request/kdf.request\";\nimport { KeysRequest } from \"../models/request/keys.request\";\nimport { OrganizationImportRequest } from \"../models/request/organization-import.request\";\nimport { PreloginRequest } from \"../models/request/prelogin.request\";\nimport { RegisterRequest } from \"../models/request/register.request\";\nimport { StorageRequest } from \"../models/request/storage.request\";\nimport { UpdateAvatarRequest } from \"../models/request/update-avatar.request\";\nimport { UpdateDomainsRequest } from \"../models/request/update-domains.request\";\nimport { VerifyDeleteRecoverRequest } from \"../models/request/verify-delete-recover.request\";\nimport { VerifyEmailRequest } from \"../models/request/verify-email.request\";\nimport { BreachAccountResponse } from \"../models/response/breach-account.response\";\nimport { DomainsResponse } from \"../models/response/domains.response\";\nimport { ErrorResponse } from \"../models/response/error.response\";\nimport { EventResponse } from \"../models/response/event.response\";\nimport { ListResponse } from \"../models/response/list.response\";\nimport { ProfileResponse } from \"../models/response/profile.response\";\nimport { UserKeyResponse } from \"../models/response/user-key.response\";\nimport { AppIdService } from \"../platform/abstractions/app-id.service\";\nimport { EnvironmentService } from \"../platform/abstractions/environment.service\";\nimport { PlatformUtilsService } from \"../platform/abstractions/platform-utils.service\";\nimport { Utils } from \"../platform/misc/utils\";\nimport { AttachmentRequest } from \"../vault/models/request/attachment.request\";\nimport { CipherBulkDeleteRequest } from \"../vault/models/request/cipher-bulk-delete.request\";\nimport { CipherBulkMoveRequest } from \"../vault/models/request/cipher-bulk-move.request\";\nimport { CipherBulkRestoreRequest } from \"../vault/models/request/cipher-bulk-restore.request\";\nimport { CipherBulkShareRequest } from \"../vault/models/request/cipher-bulk-share.request\";\nimport { CipherCollectionsRequest } from \"../vault/models/request/cipher-collections.request\";\nimport { CipherCreateRequest } from \"../vault/models/request/cipher-create.request\";\nimport { CipherPartialRequest } from \"../vault/models/request/cipher-partial.request\";\nimport { CipherShareRequest } from \"../vault/models/request/cipher-share.request\";\nimport { CipherRequest } from \"../vault/models/request/cipher.request\";\nimport { CollectionRequest } from \"../vault/models/request/collection.request\";\nimport { AttachmentUploadDataResponse } from \"../vault/models/response/attachment-upload-data.response\";\nimport { AttachmentResponse } from \"../vault/models/response/attachment.response\";\nimport { CipherResponse } from \"../vault/models/response/cipher.response\";\nimport {\n  CollectionAccessDetailsResponse,\n  CollectionDetailsResponse,\n  CollectionResponse,\n} from \"../vault/models/response/collection.response\";\nimport { SyncResponse } from \"../vault/models/response/sync.response\";\n\n/**\n * @deprecated The `ApiService` class is deprecated and calls should be extracted into individual\n * api services. The `send` method is still allowed to be used within api services. For background\n * of this decision please read https://contributing.bitwarden.com/architecture/adr/refactor-api-service.\n */\nexport class ApiService implements ApiServiceAbstraction {\n  private device: DeviceType;\n  private deviceType: string;\n  private isWebClient = false;\n  private isDesktopClient = false;\n\n  constructor(\n    private tokenService: TokenService,\n    private platformUtilsService: PlatformUtilsService,\n    private environmentService: EnvironmentService,\n    private appIdService: AppIdService,\n    private logoutCallback: (expired: boolean) => Promise<void>,\n    private customUserAgent: string = null,\n  ) {\n    this.device = platformUtilsService.getDevice();\n    this.deviceType = this.device.toString();\n    this.isWebClient =\n      this.device === DeviceType.IEBrowser ||\n      this.device === DeviceType.ChromeBrowser ||\n      this.device === DeviceType.EdgeBrowser ||\n      this.device === DeviceType.FirefoxBrowser ||\n      this.device === DeviceType.OperaBrowser ||\n      this.device === DeviceType.SafariBrowser ||\n      this.device === DeviceType.UnknownBrowser ||\n      this.device === DeviceType.VivaldiBrowser;\n    this.isDesktopClient =\n      this.device === DeviceType.WindowsDesktop ||\n      this.device === DeviceType.MacOsDesktop ||\n      this.device === DeviceType.LinuxDesktop ||\n      this.device === DeviceType.WindowsCLI ||\n      this.device === DeviceType.MacOsCLI ||\n      this.device === DeviceType.LinuxCLI;\n  }\n\n  // Auth APIs\n\n  async postIdentityToken(\n    request:\n      | UserApiTokenRequest\n      | PasswordTokenRequest\n      | SsoTokenRequest\n      | WebAuthnLoginTokenRequest,\n  ): Promise<IdentityTokenResponse | IdentityTwoFactorResponse | IdentityCaptchaResponse> {\n    const headers = new Headers({\n      \"Content-Type\": \"application/x-www-form-urlencoded; charset=utf-8\",\n      Accept: \"application/json\",\n      \"Device-Type\": this.deviceType,\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n    request.alterIdentityTokenHeaders(headers);\n\n    const identityToken =\n      request instanceof UserApiTokenRequest\n        ? request.toIdentityToken()\n        : request.toIdentityToken(this.platformUtilsService.getClientType());\n\n    const response = await this.fetch(\n      new Request(this.environmentService.getIdentityUrl() + \"/connect/token\", {\n        body: this.qsStringify(identityToken),\n        credentials: this.getCredentials(),\n        cache: \"no-store\",\n        headers: headers,\n        method: \"POST\",\n      }),\n    );\n\n    let responseJson: any = null;\n    if (this.isJsonResponse(response)) {\n      responseJson = await response.json();\n    }\n\n    if (responseJson != null) {\n      if (response.status === 200) {\n        return new IdentityTokenResponse(responseJson);\n      } else if (\n        response.status === 400 &&\n        responseJson.TwoFactorProviders2 &&\n        Object.keys(responseJson.TwoFactorProviders2).length\n      ) {\n        await this.tokenService.clearTwoFactorToken();\n        return new IdentityTwoFactorResponse(responseJson);\n      } else if (\n        response.status === 400 &&\n        responseJson.HCaptcha_SiteKey &&\n        Object.keys(responseJson.HCaptcha_SiteKey).length\n      ) {\n        return new IdentityCaptchaResponse(responseJson);\n      }\n    }\n\n    return Promise.reject(new ErrorResponse(responseJson, response.status, true));\n  }\n\n  async refreshIdentityToken(): Promise<any> {\n    try {\n      await this.doAuthRefresh();\n    } catch (e) {\n      return Promise.reject(null);\n    }\n  }\n\n  // TODO: PM-3519: Create and move to AuthRequest Api service\n  async postAuthRequest(request: CreateAuthRequest): Promise<AuthRequestResponse> {\n    const r = await this.send(\"POST\", \"/auth-requests/\", request, false, true);\n    return new AuthRequestResponse(r);\n  }\n  async postAdminAuthRequest(request: CreateAuthRequest): Promise<AuthRequestResponse> {\n    const r = await this.send(\"POST\", \"/auth-requests/admin-request\", request, true, true);\n    return new AuthRequestResponse(r);\n  }\n\n  async getAuthResponse(id: string, accessCode: string): Promise<AuthRequestResponse> {\n    const path = `/auth-requests/${id}/response?code=${accessCode}`;\n    const r = await this.send(\"GET\", path, null, false, true);\n    return new AuthRequestResponse(r);\n  }\n\n  async getAuthRequest(id: string): Promise<AuthRequestResponse> {\n    const path = `/auth-requests/${id}`;\n    const r = await this.send(\"GET\", path, null, true, true);\n    return new AuthRequestResponse(r);\n  }\n\n  async putAuthRequest(id: string, request: PasswordlessAuthRequest): Promise<AuthRequestResponse> {\n    const path = `/auth-requests/${id}`;\n    const r = await this.send(\"PUT\", path, request, true, true);\n    return new AuthRequestResponse(r);\n  }\n\n  async getAuthRequests(): Promise<ListResponse<AuthRequestResponse>> {\n    const path = `/auth-requests/`;\n    const r = await this.send(\"GET\", path, null, true, true);\n    return new ListResponse(r, AuthRequestResponse);\n  }\n\n  async getLastAuthRequest(): Promise<AuthRequestResponse> {\n    const requests = await this.getAuthRequests();\n    const activeRequests = requests.data.filter((m) => !m.isAnswered && !m.isExpired);\n    const lastRequest = activeRequests.sort((a: AuthRequestResponse, b: AuthRequestResponse) =>\n      a.creationDate.localeCompare(b.creationDate),\n    )[activeRequests.length - 1];\n    return lastRequest;\n  }\n\n  // Account APIs\n\n  async getProfile(): Promise<ProfileResponse> {\n    const r = await this.send(\"GET\", \"/accounts/profile\", null, true, true);\n    return new ProfileResponse(r);\n  }\n\n  async getUserSubscription(): Promise<SubscriptionResponse> {\n    const r = await this.send(\"GET\", \"/accounts/subscription\", null, true, true);\n    return new SubscriptionResponse(r);\n  }\n\n  async getTaxInfo(): Promise<TaxInfoResponse> {\n    const r = await this.send(\"GET\", \"/accounts/tax\", null, true, true);\n    return new TaxInfoResponse(r);\n  }\n\n  async putProfile(request: UpdateProfileRequest): Promise<ProfileResponse> {\n    const r = await this.send(\"PUT\", \"/accounts/profile\", request, true, true);\n    return new ProfileResponse(r);\n  }\n\n  async putAvatar(request: UpdateAvatarRequest): Promise<ProfileResponse> {\n    const r = await this.send(\"PUT\", \"/accounts/avatar\", request, true, true);\n    return new ProfileResponse(r);\n  }\n\n  putTaxInfo(request: TaxInfoUpdateRequest): Promise<any> {\n    return this.send(\"PUT\", \"/accounts/tax\", request, true, false);\n  }\n\n  async postPrelogin(request: PreloginRequest): Promise<PreloginResponse> {\n    const r = await this.send(\n      \"POST\",\n      \"/accounts/prelogin\",\n      request,\n      false,\n      true,\n      this.environmentService.getIdentityUrl(),\n    );\n    return new PreloginResponse(r);\n  }\n\n  postEmailToken(request: EmailTokenRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/email-token\", request, true, false);\n  }\n\n  postEmail(request: EmailRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/email\", request, true, false);\n  }\n\n  postPassword(request: PasswordRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/password\", request, true, false);\n  }\n\n  setPassword(request: SetPasswordRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/set-password\", request, true, false);\n  }\n\n  postSetKeyConnectorKey(request: SetKeyConnectorKeyRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/set-key-connector-key\", request, true, false);\n  }\n\n  postSecurityStamp(request: SecretVerificationRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/security-stamp\", request, true, false);\n  }\n\n  async getAccountRevisionDate(): Promise<number> {\n    const r = await this.send(\"GET\", \"/accounts/revision-date\", null, true, true);\n    return r as number;\n  }\n\n  postPasswordHint(request: PasswordHintRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/password-hint\", request, false, false);\n  }\n\n  async postRegister(request: RegisterRequest): Promise<RegisterResponse> {\n    const r = await this.send(\n      \"POST\",\n      \"/accounts/register\",\n      request,\n      false,\n      true,\n      this.environmentService.getIdentityUrl(),\n    );\n    return new RegisterResponse(r);\n  }\n\n  async postPremium(data: FormData): Promise<PaymentResponse> {\n    const r = await this.send(\"POST\", \"/accounts/premium\", data, true, true);\n    return new PaymentResponse(r);\n  }\n\n  postReinstatePremium(): Promise<any> {\n    return this.send(\"POST\", \"/accounts/reinstate-premium\", null, true, false);\n  }\n\n  postCancelPremium(): Promise<any> {\n    return this.send(\"POST\", \"/accounts/cancel-premium\", null, true, false);\n  }\n\n  async postAccountStorage(request: StorageRequest): Promise<PaymentResponse> {\n    const r = await this.send(\"POST\", \"/accounts/storage\", request, true, true);\n    return new PaymentResponse(r);\n  }\n\n  postAccountPayment(request: PaymentRequest): Promise<void> {\n    return this.send(\"POST\", \"/accounts/payment\", request, true, false);\n  }\n\n  postAccountLicense(data: FormData): Promise<any> {\n    return this.send(\"POST\", \"/accounts/license\", data, true, false);\n  }\n\n  postAccountKeys(request: KeysRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/keys\", request, true, false);\n  }\n\n  postAccountVerifyEmail(): Promise<any> {\n    return this.send(\"POST\", \"/accounts/verify-email\", null, true, false);\n  }\n\n  postAccountVerifyEmailToken(request: VerifyEmailRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/verify-email-token\", request, false, false);\n  }\n\n  postAccountVerifyPassword(\n    request: SecretVerificationRequest,\n  ): Promise<MasterPasswordPolicyResponse> {\n    return this.send(\"POST\", \"/accounts/verify-password\", request, true, true);\n  }\n\n  postAccountRecoverDelete(request: DeleteRecoverRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/delete-recover\", request, false, false);\n  }\n\n  postAccountRecoverDeleteToken(request: VerifyDeleteRecoverRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/delete-recover-token\", request, false, false);\n  }\n\n  postAccountKdf(request: KdfRequest): Promise<any> {\n    return this.send(\"POST\", \"/accounts/kdf\", request, true, false);\n  }\n\n  async deleteSsoUser(organizationId: string): Promise<void> {\n    return this.send(\"DELETE\", \"/accounts/sso/\" + organizationId, null, true, false);\n  }\n\n  async getSsoUserIdentifier(): Promise<string> {\n    return this.send(\"GET\", \"/accounts/sso/user-identifier\", null, true, true);\n  }\n\n  async postUserApiKey(id: string, request: SecretVerificationRequest): Promise<ApiKeyResponse> {\n    const r = await this.send(\"POST\", \"/accounts/api-key\", request, true, true);\n    return new ApiKeyResponse(r);\n  }\n\n  async postUserRotateApiKey(\n    id: string,\n    request: SecretVerificationRequest,\n  ): Promise<ApiKeyResponse> {\n    const r = await this.send(\"POST\", \"/accounts/rotate-api-key\", request, true, true);\n    return new ApiKeyResponse(r);\n  }\n\n  putUpdateTempPassword(request: UpdateTempPasswordRequest): Promise<any> {\n    return this.send(\"PUT\", \"/accounts/update-temp-password\", request, true, false);\n  }\n\n  postConvertToKeyConnector(): Promise<void> {\n    return this.send(\"POST\", \"/accounts/convert-to-key-connector\", null, true, false);\n  }\n\n  // Account Billing APIs\n\n  async getUserBillingHistory(): Promise<BillingHistoryResponse> {\n    const r = await this.send(\"GET\", \"/accounts/billing/history\", null, true, true);\n    return new BillingHistoryResponse(r);\n  }\n\n  async getUserBillingPayment(): Promise<BillingPaymentResponse> {\n    const r = await this.send(\"GET\", \"/accounts/billing/payment-method\", null, true, true);\n    return new BillingPaymentResponse(r);\n  }\n\n  // Cipher APIs\n\n  async getCipher(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"GET\", \"/ciphers/\" + id, null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async getFullCipherDetails(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"GET\", \"/ciphers/\" + id + \"/details\", null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async getCipherAdmin(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"GET\", \"/ciphers/\" + id + \"/admin\", null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async getCiphersOrganization(organizationId: string): Promise<ListResponse<CipherResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/ciphers/organization-details?organizationId=\" + organizationId,\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, CipherResponse);\n  }\n\n  async postCipher(request: CipherRequest): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async postCipherCreate(request: CipherCreateRequest): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/create\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async postCipherAdmin(request: CipherCreateRequest): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/admin\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putCipher(id: string, request: CipherRequest): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id, request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putPartialCipher(id: string, request: CipherPartialRequest): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/partial\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putCipherAdmin(id: string, request: CipherRequest): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/admin\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  deleteCipher(id: string): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers/\" + id, null, true, false);\n  }\n\n  deleteCipherAdmin(id: string): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers/\" + id + \"/admin\", null, true, false);\n  }\n\n  deleteManyCiphers(request: CipherBulkDeleteRequest): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers\", request, true, false);\n  }\n\n  deleteManyCiphersAdmin(request: CipherBulkDeleteRequest): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers/admin\", request, true, false);\n  }\n\n  putMoveCiphers(request: CipherBulkMoveRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/move\", request, true, false);\n  }\n\n  async putShareCipher(id: string, request: CipherShareRequest): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/share\", request, true, true);\n    return new CipherResponse(r);\n  }\n\n  putShareCiphers(request: CipherBulkShareRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/share\", request, true, false);\n  }\n\n  putCipherCollections(id: string, request: CipherCollectionsRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/\" + id + \"/collections\", request, true, false);\n  }\n\n  putCipherCollectionsAdmin(id: string, request: CipherCollectionsRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/\" + id + \"/collections-admin\", request, true, false);\n  }\n\n  postPurgeCiphers(\n    request: SecretVerificationRequest,\n    organizationId: string = null,\n  ): Promise<any> {\n    let path = \"/ciphers/purge\";\n    if (organizationId != null) {\n      path += \"?organizationId=\" + organizationId;\n    }\n    return this.send(\"POST\", path, request, true, false);\n  }\n\n  putDeleteCipher(id: string): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/\" + id + \"/delete\", null, true, false);\n  }\n\n  putDeleteCipherAdmin(id: string): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/\" + id + \"/delete-admin\", null, true, false);\n  }\n\n  putDeleteManyCiphers(request: CipherBulkDeleteRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/delete\", request, true, false);\n  }\n\n  putDeleteManyCiphersAdmin(request: CipherBulkDeleteRequest): Promise<any> {\n    return this.send(\"PUT\", \"/ciphers/delete-admin\", request, true, false);\n  }\n\n  async putRestoreCipher(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/restore\", null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putRestoreCipherAdmin(id: string): Promise<CipherResponse> {\n    const r = await this.send(\"PUT\", \"/ciphers/\" + id + \"/restore-admin\", null, true, true);\n    return new CipherResponse(r);\n  }\n\n  async putRestoreManyCiphers(\n    request: CipherBulkRestoreRequest,\n  ): Promise<ListResponse<CipherResponse>> {\n    const r = await this.send(\"PUT\", \"/ciphers/restore\", request, true, true);\n    return new ListResponse<CipherResponse>(r, CipherResponse);\n  }\n\n  async putRestoreManyCiphersAdmin(\n    request: CipherBulkRestoreRequest,\n  ): Promise<ListResponse<CipherResponse>> {\n    const r = await this.send(\"PUT\", \"/ciphers/restore-admin\", request, true, true);\n    return new ListResponse<CipherResponse>(r, CipherResponse);\n  }\n\n  // Attachments APIs\n\n  async getAttachmentData(\n    cipherId: string,\n    attachmentId: string,\n    emergencyAccessId?: string,\n  ): Promise<AttachmentResponse> {\n    const path =\n      (emergencyAccessId != null ? \"/emergency-access/\" + emergencyAccessId + \"/\" : \"/ciphers/\") +\n      cipherId +\n      \"/attachment/\" +\n      attachmentId;\n    const r = await this.send(\"GET\", path, null, true, true);\n    return new AttachmentResponse(r);\n  }\n\n  async postCipherAttachment(\n    id: string,\n    request: AttachmentRequest,\n  ): Promise<AttachmentUploadDataResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/\" + id + \"/attachment/v2\", request, true, true);\n    return new AttachmentUploadDataResponse(r);\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async postCipherAttachmentLegacy(id: string, data: FormData): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/\" + id + \"/attachment\", data, true, true);\n    return new CipherResponse(r);\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async postCipherAttachmentAdminLegacy(id: string, data: FormData): Promise<CipherResponse> {\n    const r = await this.send(\"POST\", \"/ciphers/\" + id + \"/attachment-admin\", data, true, true);\n    return new CipherResponse(r);\n  }\n\n  deleteCipherAttachment(id: string, attachmentId: string): Promise<any> {\n    return this.send(\"DELETE\", \"/ciphers/\" + id + \"/attachment/\" + attachmentId, null, true, false);\n  }\n\n  deleteCipherAttachmentAdmin(id: string, attachmentId: string): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/ciphers/\" + id + \"/attachment/\" + attachmentId + \"/admin\",\n      null,\n      true,\n      false,\n    );\n  }\n\n  postShareCipherAttachment(\n    id: string,\n    attachmentId: string,\n    data: FormData,\n    organizationId: string,\n  ): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/ciphers/\" + id + \"/attachment/\" + attachmentId + \"/share?organizationId=\" + organizationId,\n      data,\n      true,\n      false,\n    );\n  }\n\n  async renewAttachmentUploadUrl(\n    id: string,\n    attachmentId: string,\n  ): Promise<AttachmentUploadDataResponse> {\n    const r = await this.send(\n      \"GET\",\n      \"/ciphers/\" + id + \"/attachment/\" + attachmentId + \"/renew\",\n      null,\n      true,\n      true,\n    );\n    return new AttachmentUploadDataResponse(r);\n  }\n\n  postAttachmentFile(id: string, attachmentId: string, data: FormData): Promise<any> {\n    return this.send(\"POST\", \"/ciphers/\" + id + \"/attachment/\" + attachmentId, data, true, false);\n  }\n\n  // Collections APIs\n\n  async getCollectionAccessDetails(\n    organizationId: string,\n    id: string,\n  ): Promise<CollectionAccessDetailsResponse> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id + \"/details\",\n      null,\n      true,\n      true,\n    );\n    return new CollectionAccessDetailsResponse(r);\n  }\n\n  async getUserCollections(): Promise<ListResponse<CollectionResponse>> {\n    const r = await this.send(\"GET\", \"/collections\", null, true, true);\n    return new ListResponse(r, CollectionResponse);\n  }\n\n  async getCollections(organizationId: string): Promise<ListResponse<CollectionResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/collections\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, CollectionResponse);\n  }\n\n  async getManyCollectionsWithAccessDetails(\n    organizationId: string,\n  ): Promise<ListResponse<CollectionAccessDetailsResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/collections/details\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, CollectionAccessDetailsResponse);\n  }\n\n  async getCollectionUsers(\n    organizationId: string,\n    id: string,\n  ): Promise<SelectionReadOnlyResponse[]> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id + \"/users\",\n      null,\n      true,\n      true,\n    );\n    return r.map((dr: any) => new SelectionReadOnlyResponse(dr));\n  }\n\n  async postCollection(\n    organizationId: string,\n    request: CollectionRequest,\n  ): Promise<CollectionDetailsResponse> {\n    const r = await this.send(\n      \"POST\",\n      \"/organizations/\" + organizationId + \"/collections\",\n      request,\n      true,\n      true,\n    );\n    return new CollectionDetailsResponse(r);\n  }\n\n  async putCollection(\n    organizationId: string,\n    id: string,\n    request: CollectionRequest,\n  ): Promise<CollectionDetailsResponse> {\n    const r = await this.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id,\n      request,\n      true,\n      true,\n    );\n    return new CollectionDetailsResponse(r);\n  }\n\n  async putCollectionUsers(\n    organizationId: string,\n    id: string,\n    request: SelectionReadOnlyRequest[],\n  ): Promise<any> {\n    await this.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id + \"/users\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  deleteCollection(organizationId: string, id: string): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id,\n      null,\n      true,\n      false,\n    );\n  }\n\n  deleteManyCollections(organizationId: string, collectionIds: string[]): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/organizations/\" + organizationId + \"/collections\",\n      new CollectionBulkDeleteRequest(collectionIds),\n      true,\n      false,\n    );\n  }\n\n  deleteCollectionUser(\n    organizationId: string,\n    id: string,\n    organizationUserId: string,\n  ): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/organizations/\" + organizationId + \"/collections/\" + id + \"/user/\" + organizationUserId,\n      null,\n      true,\n      false,\n    );\n  }\n\n  // Groups APIs\n\n  async getGroupUsers(organizationId: string, id: string): Promise<string[]> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/groups/\" + id + \"/users\",\n      null,\n      true,\n      true,\n    );\n    return r;\n  }\n\n  async putGroupUsers(organizationId: string, id: string, request: string[]): Promise<any> {\n    await this.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/groups/\" + id + \"/users\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  deleteGroupUser(organizationId: string, id: string, organizationUserId: string): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/organizations/\" + organizationId + \"/groups/\" + id + \"/user/\" + organizationUserId,\n      null,\n      true,\n      false,\n    );\n  }\n\n  // Plan APIs\n\n  async getPlans(): Promise<ListResponse<PlanResponse>> {\n    const r = await this.send(\"GET\", \"/plans\", null, false, true);\n    return new ListResponse(r, PlanResponse);\n  }\n\n  async postPublicImportDirectory(request: OrganizationImportRequest): Promise<any> {\n    return this.send(\"POST\", \"/public/organization/import\", request, true, false);\n  }\n\n  async getTaxRates(): Promise<ListResponse<TaxRateResponse>> {\n    const r = await this.send(\"GET\", \"/plans/sales-tax-rates/\", null, true, true);\n    return new ListResponse(r, TaxRateResponse);\n  }\n\n  // Settings APIs\n\n  async getSettingsDomains(): Promise<DomainsResponse> {\n    const r = await this.send(\"GET\", \"/settings/domains\", null, true, true);\n    return new DomainsResponse(r);\n  }\n\n  async putSettingsDomains(request: UpdateDomainsRequest): Promise<DomainsResponse> {\n    const r = await this.send(\"PUT\", \"/settings/domains\", request, true, true);\n    return new DomainsResponse(r);\n  }\n\n  // Sync APIs\n\n  async getSync(): Promise<SyncResponse> {\n    const path = this.isDesktopClient || this.isWebClient ? \"/sync?excludeDomains=true\" : \"/sync\";\n    const r = await this.send(\"GET\", path, null, true, true);\n    return new SyncResponse(r);\n  }\n\n  // Two-factor APIs\n\n  async getTwoFactorProviders(): Promise<ListResponse<TwoFactorProviderResponse>> {\n    const r = await this.send(\"GET\", \"/two-factor\", null, true, true);\n    return new ListResponse(r, TwoFactorProviderResponse);\n  }\n\n  async getTwoFactorOrganizationProviders(\n    organizationId: string,\n  ): Promise<ListResponse<TwoFactorProviderResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/two-factor\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, TwoFactorProviderResponse);\n  }\n\n  async getTwoFactorAuthenticator(\n    request: SecretVerificationRequest,\n  ): Promise<TwoFactorAuthenticatorResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-authenticator\", request, true, true);\n    return new TwoFactorAuthenticatorResponse(r);\n  }\n\n  async getTwoFactorEmail(request: SecretVerificationRequest): Promise<TwoFactorEmailResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-email\", request, true, true);\n    return new TwoFactorEmailResponse(r);\n  }\n\n  async getTwoFactorDuo(request: SecretVerificationRequest): Promise<TwoFactorDuoResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-duo\", request, true, true);\n    return new TwoFactorDuoResponse(r);\n  }\n\n  async getTwoFactorOrganizationDuo(\n    organizationId: string,\n    request: SecretVerificationRequest,\n  ): Promise<TwoFactorDuoResponse> {\n    const r = await this.send(\n      \"POST\",\n      \"/organizations/\" + organizationId + \"/two-factor/get-duo\",\n      request,\n      true,\n      true,\n    );\n    return new TwoFactorDuoResponse(r);\n  }\n\n  async getTwoFactorYubiKey(request: SecretVerificationRequest): Promise<TwoFactorYubiKeyResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-yubikey\", request, true, true);\n    return new TwoFactorYubiKeyResponse(r);\n  }\n\n  async getTwoFactorWebAuthn(\n    request: SecretVerificationRequest,\n  ): Promise<TwoFactorWebAuthnResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-webauthn\", request, true, true);\n    return new TwoFactorWebAuthnResponse(r);\n  }\n\n  async getTwoFactorWebAuthnChallenge(\n    request: SecretVerificationRequest,\n  ): Promise<ChallengeResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-webauthn-challenge\", request, true, true);\n    return new ChallengeResponse(r);\n  }\n\n  async getTwoFactorRecover(request: SecretVerificationRequest): Promise<TwoFactorRecoverResponse> {\n    const r = await this.send(\"POST\", \"/two-factor/get-recover\", request, true, true);\n    return new TwoFactorRecoverResponse(r);\n  }\n\n  async putTwoFactorAuthenticator(\n    request: UpdateTwoFactorAuthenticatorRequest,\n  ): Promise<TwoFactorAuthenticatorResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/authenticator\", request, true, true);\n    return new TwoFactorAuthenticatorResponse(r);\n  }\n\n  async putTwoFactorEmail(request: UpdateTwoFactorEmailRequest): Promise<TwoFactorEmailResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/email\", request, true, true);\n    return new TwoFactorEmailResponse(r);\n  }\n\n  async putTwoFactorDuo(request: UpdateTwoFactorDuoRequest): Promise<TwoFactorDuoResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/duo\", request, true, true);\n    return new TwoFactorDuoResponse(r);\n  }\n\n  async putTwoFactorOrganizationDuo(\n    organizationId: string,\n    request: UpdateTwoFactorDuoRequest,\n  ): Promise<TwoFactorDuoResponse> {\n    const r = await this.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/two-factor/duo\",\n      request,\n      true,\n      true,\n    );\n    return new TwoFactorDuoResponse(r);\n  }\n\n  async putTwoFactorYubiKey(\n    request: UpdateTwoFactorYubioOtpRequest,\n  ): Promise<TwoFactorYubiKeyResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/yubikey\", request, true, true);\n    return new TwoFactorYubiKeyResponse(r);\n  }\n\n  async putTwoFactorWebAuthn(\n    request: UpdateTwoFactorWebAuthnRequest,\n  ): Promise<TwoFactorWebAuthnResponse> {\n    const response = request.deviceResponse.response as AuthenticatorAttestationResponse;\n    const data: any = Object.assign({}, request);\n\n    data.deviceResponse = {\n      id: request.deviceResponse.id,\n      rawId: btoa(request.deviceResponse.id),\n      type: request.deviceResponse.type,\n      extensions: request.deviceResponse.getClientExtensionResults(),\n      response: {\n        AttestationObject: Utils.fromBufferToB64(response.attestationObject),\n        clientDataJson: Utils.fromBufferToB64(response.clientDataJSON),\n      },\n    };\n\n    const r = await this.send(\"PUT\", \"/two-factor/webauthn\", data, true, true);\n    return new TwoFactorWebAuthnResponse(r);\n  }\n\n  async deleteTwoFactorWebAuthn(\n    request: UpdateTwoFactorWebAuthnDeleteRequest,\n  ): Promise<TwoFactorWebAuthnResponse> {\n    const r = await this.send(\"DELETE\", \"/two-factor/webauthn\", request, true, true);\n    return new TwoFactorWebAuthnResponse(r);\n  }\n\n  async putTwoFactorDisable(request: TwoFactorProviderRequest): Promise<TwoFactorProviderResponse> {\n    const r = await this.send(\"PUT\", \"/two-factor/disable\", request, true, true);\n    return new TwoFactorProviderResponse(r);\n  }\n\n  async putTwoFactorOrganizationDisable(\n    organizationId: string,\n    request: TwoFactorProviderRequest,\n  ): Promise<TwoFactorProviderResponse> {\n    const r = await this.send(\n      \"PUT\",\n      \"/organizations/\" + organizationId + \"/two-factor/disable\",\n      request,\n      true,\n      true,\n    );\n    return new TwoFactorProviderResponse(r);\n  }\n\n  postTwoFactorRecover(request: TwoFactorRecoveryRequest): Promise<any> {\n    return this.send(\"POST\", \"/two-factor/recover\", request, false, false);\n  }\n\n  postTwoFactorEmailSetup(request: TwoFactorEmailRequest): Promise<any> {\n    return this.send(\"POST\", \"/two-factor/send-email\", request, true, false);\n  }\n\n  postTwoFactorEmail(request: TwoFactorEmailRequest): Promise<any> {\n    return this.send(\"POST\", \"/two-factor/send-email-login\", request, false, false);\n  }\n\n  async getDeviceVerificationSettings(): Promise<DeviceVerificationResponse> {\n    const r = await this.send(\n      \"GET\",\n      \"/two-factor/get-device-verification-settings\",\n      null,\n      true,\n      true,\n    );\n    return new DeviceVerificationResponse(r);\n  }\n\n  async putDeviceVerificationSettings(\n    request: DeviceVerificationRequest,\n  ): Promise<DeviceVerificationResponse> {\n    const r = await this.send(\n      \"PUT\",\n      \"/two-factor/device-verification-settings\",\n      request,\n      true,\n      true,\n    );\n    return new DeviceVerificationResponse(r);\n  }\n\n  // Organization APIs\n\n  async getCloudCommunicationsEnabled(): Promise<boolean> {\n    const r = await this.send(\"GET\", \"/organizations/connections/enabled\", null, true, true);\n    return r as boolean;\n  }\n\n  async getOrganizationConnection<TConfig extends OrganizationConnectionConfigApis>(\n    id: string,\n    type: OrganizationConnectionType,\n    configType: { new (response: any): TConfig },\n  ): Promise<OrganizationConnectionResponse<TConfig>> {\n    const r = await this.send(\"GET\", `/organizations/connections/${id}/${type}`, null, true, true);\n    return new OrganizationConnectionResponse(r, configType);\n  }\n\n  async createOrganizationConnection<TConfig extends OrganizationConnectionConfigApis>(\n    request: OrganizationConnectionRequest,\n    configType: { new (response: any): TConfig },\n  ): Promise<OrganizationConnectionResponse<TConfig>> {\n    const r = await this.send(\"POST\", \"/organizations/connections/\", request, true, true);\n    return new OrganizationConnectionResponse(r, configType);\n  }\n\n  async updateOrganizationConnection<TConfig extends OrganizationConnectionConfigApis>(\n    request: OrganizationConnectionRequest,\n    configType: { new (response: any): TConfig },\n    organizationConnectionId?: string,\n  ): Promise<OrganizationConnectionResponse<TConfig>> {\n    const r = await this.send(\n      \"PUT\",\n      \"/organizations/connections/\" + organizationConnectionId,\n      request,\n      true,\n      true,\n    );\n    return new OrganizationConnectionResponse(r, configType);\n  }\n\n  async deleteOrganizationConnection(id: string): Promise<void> {\n    return this.send(\"DELETE\", \"/organizations/connections/\" + id, null, true, false);\n  }\n\n  // Provider APIs\n\n  async postProviderSetup(id: string, request: ProviderSetupRequest) {\n    const r = await this.send(\"POST\", \"/providers/\" + id + \"/setup\", request, true, true);\n    return new ProviderResponse(r);\n  }\n\n  async getProvider(id: string) {\n    const r = await this.send(\"GET\", \"/providers/\" + id, null, true, true);\n    return new ProviderResponse(r);\n  }\n\n  async putProvider(id: string, request: ProviderUpdateRequest) {\n    const r = await this.send(\"PUT\", \"/providers/\" + id, request, true, true);\n    return new ProviderResponse(r);\n  }\n\n  // Provider User APIs\n\n  async getProviderUsers(\n    providerId: string,\n  ): Promise<ListResponse<ProviderUserUserDetailsResponse>> {\n    const r = await this.send(\"GET\", \"/providers/\" + providerId + \"/users\", null, true, true);\n    return new ListResponse(r, ProviderUserUserDetailsResponse);\n  }\n\n  async getProviderUser(providerId: string, id: string): Promise<ProviderUserResponse> {\n    const r = await this.send(\"GET\", \"/providers/\" + providerId + \"/users/\" + id, null, true, true);\n    return new ProviderUserResponse(r);\n  }\n\n  postProviderUserInvite(providerId: string, request: ProviderUserInviteRequest): Promise<any> {\n    return this.send(\"POST\", \"/providers/\" + providerId + \"/users/invite\", request, true, false);\n  }\n\n  postProviderUserReinvite(providerId: string, id: string): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/\" + id + \"/reinvite\",\n      null,\n      true,\n      false,\n    );\n  }\n\n  async postManyProviderUserReinvite(\n    providerId: string,\n    request: ProviderUserBulkRequest,\n  ): Promise<ListResponse<ProviderUserBulkResponse>> {\n    const r = await this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/reinvite\",\n      request,\n      true,\n      true,\n    );\n    return new ListResponse(r, ProviderUserBulkResponse);\n  }\n\n  async postProviderUserBulkConfirm(\n    providerId: string,\n    request: ProviderUserBulkConfirmRequest,\n  ): Promise<ListResponse<ProviderUserBulkResponse>> {\n    const r = await this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/confirm\",\n      request,\n      true,\n      true,\n    );\n    return new ListResponse(r, ProviderUserBulkResponse);\n  }\n\n  async deleteManyProviderUsers(\n    providerId: string,\n    request: ProviderUserBulkRequest,\n  ): Promise<ListResponse<ProviderUserBulkResponse>> {\n    const r = await this.send(\"DELETE\", \"/providers/\" + providerId + \"/users\", request, true, true);\n    return new ListResponse(r, ProviderUserBulkResponse);\n  }\n\n  postProviderUserAccept(\n    providerId: string,\n    id: string,\n    request: ProviderUserAcceptRequest,\n  ): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/\" + id + \"/accept\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  postProviderUserConfirm(\n    providerId: string,\n    id: string,\n    request: ProviderUserConfirmRequest,\n  ): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/\" + id + \"/confirm\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  async postProviderUsersPublicKey(\n    providerId: string,\n    request: ProviderUserBulkRequest,\n  ): Promise<ListResponse<ProviderUserBulkPublicKeyResponse>> {\n    const r = await this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/users/public-keys\",\n      request,\n      true,\n      true,\n    );\n    return new ListResponse(r, ProviderUserBulkPublicKeyResponse);\n  }\n\n  putProviderUser(\n    providerId: string,\n    id: string,\n    request: ProviderUserUpdateRequest,\n  ): Promise<any> {\n    return this.send(\"PUT\", \"/providers/\" + providerId + \"/users/\" + id, request, true, false);\n  }\n\n  deleteProviderUser(providerId: string, id: string): Promise<any> {\n    return this.send(\"DELETE\", \"/providers/\" + providerId + \"/users/\" + id, null, true, false);\n  }\n\n  // Provider Organization APIs\n\n  async getProviderClients(\n    providerId: string,\n  ): Promise<ListResponse<ProviderOrganizationOrganizationDetailsResponse>> {\n    const r = await this.send(\n      \"GET\",\n      \"/providers/\" + providerId + \"/organizations\",\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, ProviderOrganizationOrganizationDetailsResponse);\n  }\n\n  postProviderAddOrganization(\n    providerId: string,\n    request: ProviderAddOrganizationRequest,\n  ): Promise<any> {\n    return this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/organizations/add\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  async postProviderCreateOrganization(\n    providerId: string,\n    request: ProviderOrganizationCreateRequest,\n  ): Promise<ProviderOrganizationResponse> {\n    const r = await this.send(\n      \"POST\",\n      \"/providers/\" + providerId + \"/organizations\",\n      request,\n      true,\n      true,\n    );\n    return new ProviderOrganizationResponse(r);\n  }\n\n  deleteProviderOrganization(providerId: string, id: string): Promise<any> {\n    return this.send(\n      \"DELETE\",\n      \"/providers/\" + providerId + \"/organizations/\" + id,\n      null,\n      true,\n      false,\n    );\n  }\n\n  // Event APIs\n\n  async getEvents(start: string, end: string, token: string): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\"/events\", start, end, token),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsCipher(\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\"/ciphers/\" + id + \"/events\", start, end, token),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsOrganization(\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\"/organizations/\" + id + \"/events\", start, end, token),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsOrganizationUser(\n    organizationId: string,\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\n        \"/organizations/\" + organizationId + \"/users/\" + id + \"/events\",\n        start,\n        end,\n        token,\n      ),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsProvider(\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\"/providers/\" + id + \"/events\", start, end, token),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async getEventsProviderUser(\n    providerId: string,\n    id: string,\n    start: string,\n    end: string,\n    token: string,\n  ): Promise<ListResponse<EventResponse>> {\n    const r = await this.send(\n      \"GET\",\n      this.addEventParameters(\n        \"/providers/\" + providerId + \"/users/\" + id + \"/events\",\n        start,\n        end,\n        token,\n      ),\n      null,\n      true,\n      true,\n    );\n    return new ListResponse(r, EventResponse);\n  }\n\n  async postEventsCollect(request: EventRequest[]): Promise<any> {\n    const authHeader = await this.getActiveBearerToken();\n    const headers = new Headers({\n      \"Device-Type\": this.deviceType,\n      Authorization: \"Bearer \" + authHeader,\n      \"Content-Type\": \"application/json; charset=utf-8\",\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n    const response = await this.fetch(\n      new Request(this.environmentService.getEventsUrl() + \"/collect\", {\n        cache: \"no-store\",\n        credentials: this.getCredentials(),\n        method: \"POST\",\n        body: JSON.stringify(request),\n        headers: headers,\n      }),\n    );\n    if (response.status !== 200) {\n      return Promise.reject(\"Event post failed.\");\n    }\n  }\n\n  // User APIs\n\n  async getUserPublicKey(id: string): Promise<UserKeyResponse> {\n    const r = await this.send(\"GET\", \"/users/\" + id + \"/public-key\", null, true, true);\n    return new UserKeyResponse(r);\n  }\n\n  // HIBP APIs\n\n  async getHibpBreach(username: string): Promise<BreachAccountResponse[]> {\n    const r = await this.send(\"GET\", \"/hibp/breach?username=\" + username, null, true, true);\n    return r.map((a: any) => new BreachAccountResponse(a));\n  }\n\n  // Misc\n\n  async postBitPayInvoice(request: BitPayInvoiceRequest): Promise<string> {\n    const r = await this.send(\"POST\", \"/bitpay-invoice\", request, true, true);\n    return r as string;\n  }\n\n  async postSetupPayment(): Promise<string> {\n    const r = await this.send(\"POST\", \"/setup-payment\", null, true, true);\n    return r as string;\n  }\n\n  // Key Connector\n\n  async getMasterKeyFromKeyConnector(\n    keyConnectorUrl: string,\n  ): Promise<KeyConnectorUserKeyResponse> {\n    const authHeader = await this.getActiveBearerToken();\n\n    const response = await this.fetch(\n      new Request(keyConnectorUrl + \"/user-keys\", {\n        cache: \"no-store\",\n        method: \"GET\",\n        headers: new Headers({\n          Accept: \"application/json\",\n          Authorization: \"Bearer \" + authHeader,\n        }),\n      }),\n    );\n\n    if (response.status !== 200) {\n      const error = await this.handleError(response, false, true);\n      return Promise.reject(error);\n    }\n\n    return new KeyConnectorUserKeyResponse(await response.json());\n  }\n\n  async postUserKeyToKeyConnector(\n    keyConnectorUrl: string,\n    request: KeyConnectorUserKeyRequest,\n  ): Promise<void> {\n    const authHeader = await this.getActiveBearerToken();\n\n    const response = await this.fetch(\n      new Request(keyConnectorUrl + \"/user-keys\", {\n        cache: \"no-store\",\n        method: \"POST\",\n        headers: new Headers({\n          Accept: \"application/json\",\n          Authorization: \"Bearer \" + authHeader,\n          \"Content-Type\": \"application/json; charset=utf-8\",\n        }),\n        body: JSON.stringify(request),\n      }),\n    );\n\n    if (response.status !== 200) {\n      const error = await this.handleError(response, false, true);\n      return Promise.reject(error);\n    }\n  }\n\n  async getKeyConnectorAlive(keyConnectorUrl: string) {\n    const response = await this.fetch(\n      new Request(keyConnectorUrl + \"/alive\", {\n        cache: \"no-store\",\n        method: \"GET\",\n        headers: new Headers({\n          Accept: \"application/json\",\n          \"Content-Type\": \"application/json; charset=utf-8\",\n        }),\n      }),\n    );\n\n    if (response.status !== 200) {\n      const error = await this.handleError(response, false, true);\n      return Promise.reject(error);\n    }\n  }\n\n  async getOrganizationExport(organizationId: string): Promise<OrganizationExportResponse> {\n    const r = await this.send(\n      \"GET\",\n      \"/organizations/\" + organizationId + \"/export\",\n      null,\n      true,\n      true,\n    );\n    return new OrganizationExportResponse(r);\n  }\n\n  // Helpers\n\n  async getActiveBearerToken(): Promise<string> {\n    let accessToken = await this.tokenService.getToken();\n    if (await this.tokenService.tokenNeedsRefresh()) {\n      await this.doAuthRefresh();\n      accessToken = await this.tokenService.getToken();\n    }\n    return accessToken;\n  }\n\n  async fetch(request: Request): Promise<Response> {\n    if (request.method === \"GET\") {\n      request.headers.set(\"Cache-Control\", \"no-store\");\n      request.headers.set(\"Pragma\", \"no-cache\");\n    }\n    request.headers.set(\"Bitwarden-Client-Name\", this.platformUtilsService.getClientType());\n    request.headers.set(\n      \"Bitwarden-Client-Version\",\n      await this.platformUtilsService.getApplicationVersionNumber(),\n    );\n    return this.nativeFetch(request);\n  }\n\n  nativeFetch(request: Request): Promise<Response> {\n    return fetch(request);\n  }\n\n  async preValidateSso(identifier: string): Promise<SsoPreValidateResponse> {\n    if (identifier == null || identifier === \"\") {\n      throw new Error(\"Organization Identifier was not provided.\");\n    }\n    const headers = new Headers({\n      Accept: \"application/json\",\n      \"Device-Type\": this.deviceType,\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n\n    const path = `/sso/prevalidate?domainHint=${encodeURIComponent(identifier)}`;\n    const response = await this.fetch(\n      new Request(this.environmentService.getIdentityUrl() + path, {\n        cache: \"no-store\",\n        credentials: this.getCredentials(),\n        headers: headers,\n        method: \"GET\",\n      }),\n    );\n\n    if (response.status === 200) {\n      const body = await response.json();\n      return new SsoPreValidateResponse(body);\n    } else {\n      const error = await this.handleError(response, false, true);\n      return Promise.reject(error);\n    }\n  }\n\n  async postCreateSponsorship(\n    sponsoredOrgId: string,\n    request: OrganizationSponsorshipCreateRequest,\n  ): Promise<void> {\n    return await this.send(\n      \"POST\",\n      \"/organization/sponsorship/\" +\n        (this.platformUtilsService.isSelfHost() ? \"self-hosted/\" : \"\") +\n        sponsoredOrgId +\n        \"/families-for-enterprise\",\n      request,\n      true,\n      false,\n    );\n  }\n\n  async getSponsorshipSyncStatus(\n    sponsoredOrgId: string,\n  ): Promise<OrganizationSponsorshipSyncStatusResponse> {\n    const response = await this.send(\n      \"GET\",\n      \"/organization/sponsorship/\" + sponsoredOrgId + \"/sync-status\",\n      null,\n      true,\n      true,\n    );\n    return new OrganizationSponsorshipSyncStatusResponse(response);\n  }\n\n  async deleteRevokeSponsorship(sponsoringOrganizationId: string): Promise<void> {\n    return await this.send(\n      \"DELETE\",\n      \"/organization/sponsorship/\" +\n        (this.platformUtilsService.isSelfHost() ? \"self-hosted/\" : \"\") +\n        sponsoringOrganizationId,\n      null,\n      true,\n      false,\n    );\n  }\n\n  async deleteRemoveSponsorship(sponsoringOrgId: string): Promise<void> {\n    return await this.send(\n      \"DELETE\",\n      \"/organization/sponsorship/sponsored/\" + sponsoringOrgId,\n      null,\n      true,\n      false,\n    );\n  }\n\n  async postPreValidateSponsorshipToken(sponsorshipToken: string): Promise<boolean> {\n    const r = await this.send(\n      \"POST\",\n      \"/organization/sponsorship/validate-token?sponsorshipToken=\" +\n        encodeURIComponent(sponsorshipToken),\n      null,\n      true,\n      true,\n    );\n    return r as boolean;\n  }\n\n  async postRedeemSponsorship(\n    sponsorshipToken: string,\n    request: OrganizationSponsorshipRedeemRequest,\n  ): Promise<void> {\n    return await this.send(\n      \"POST\",\n      \"/organization/sponsorship/redeem?sponsorshipToken=\" + encodeURIComponent(sponsorshipToken),\n      request,\n      true,\n      false,\n    );\n  }\n\n  async postResendSponsorshipOffer(sponsoringOrgId: string): Promise<void> {\n    return await this.send(\n      \"POST\",\n      \"/organization/sponsorship/\" + sponsoringOrgId + \"/families-for-enterprise/resend\",\n      null,\n      true,\n      false,\n    );\n  }\n\n  protected async doAuthRefresh(): Promise<void> {\n    const refreshToken = await this.tokenService.getRefreshToken();\n    if (refreshToken != null && refreshToken !== \"\") {\n      return this.doRefreshToken();\n    }\n\n    const clientId = await this.tokenService.getClientId();\n    const clientSecret = await this.tokenService.getClientSecret();\n    if (!Utils.isNullOrWhitespace(clientId) && !Utils.isNullOrWhitespace(clientSecret)) {\n      return this.doApiTokenRefresh();\n    }\n\n    throw new Error(\"Cannot refresh token, no refresh token or api keys are stored\");\n  }\n\n  protected async doRefreshToken(): Promise<void> {\n    const refreshToken = await this.tokenService.getRefreshToken();\n    if (refreshToken == null || refreshToken === \"\") {\n      throw new Error();\n    }\n    const headers = new Headers({\n      \"Content-Type\": \"application/x-www-form-urlencoded; charset=utf-8\",\n      Accept: \"application/json\",\n      \"Device-Type\": this.deviceType,\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n\n    const decodedToken = await this.tokenService.decodeToken();\n    const response = await this.fetch(\n      new Request(this.environmentService.getIdentityUrl() + \"/connect/token\", {\n        body: this.qsStringify({\n          grant_type: \"refresh_token\",\n          client_id: decodedToken.client_id,\n          refresh_token: refreshToken,\n        }),\n        cache: \"no-store\",\n        credentials: this.getCredentials(),\n        headers: headers,\n        method: \"POST\",\n      }),\n    );\n\n    if (response.status === 200) {\n      const responseJson = await response.json();\n      const tokenResponse = new IdentityTokenResponse(responseJson);\n      await this.tokenService.setTokens(\n        tokenResponse.accessToken,\n        tokenResponse.refreshToken,\n        null,\n      );\n    } else {\n      const error = await this.handleError(response, true, true);\n      return Promise.reject(error);\n    }\n  }\n\n  protected async doApiTokenRefresh(): Promise<void> {\n    const clientId = await this.tokenService.getClientId();\n    const clientSecret = await this.tokenService.getClientSecret();\n\n    const appId = await this.appIdService.getAppId();\n    const deviceRequest = new DeviceRequest(appId, this.platformUtilsService);\n    const tokenRequest = new UserApiTokenRequest(\n      clientId,\n      clientSecret,\n      new TokenTwoFactorRequest(),\n      deviceRequest,\n    );\n\n    const response = await this.postIdentityToken(tokenRequest);\n    if (!(response instanceof IdentityTokenResponse)) {\n      throw new Error(\"Invalid response received when refreshing api token\");\n    }\n\n    await this.tokenService.setToken(response.accessToken);\n  }\n\n  async send(\n    method: \"GET\" | \"POST\" | \"PUT\" | \"DELETE\",\n    path: string,\n    body: any,\n    authed: boolean,\n    hasResponse: boolean,\n    apiUrl?: string,\n    alterHeaders?: (headers: Headers) => void,\n  ): Promise<any> {\n    apiUrl = Utils.isNullOrWhitespace(apiUrl) ? this.environmentService.getApiUrl() : apiUrl;\n\n    // Prevent directory traversal from malicious paths\n    const pathParts = path.split(\"?\");\n    const requestUrl =\n      apiUrl + Utils.normalizePath(pathParts[0]) + (pathParts.length > 1 ? `?${pathParts[1]}` : \"\");\n\n    const headers = new Headers({\n      \"Device-Type\": this.deviceType,\n    });\n    if (this.customUserAgent != null) {\n      headers.set(\"User-Agent\", this.customUserAgent);\n    }\n\n    const requestInit: RequestInit = {\n      cache: \"no-store\",\n      credentials: this.getCredentials(),\n      method: method,\n    };\n\n    if (authed) {\n      const authHeader = await this.getActiveBearerToken();\n      headers.set(\"Authorization\", \"Bearer \" + authHeader);\n    }\n    if (body != null) {\n      if (typeof body === \"string\") {\n        requestInit.body = body;\n        headers.set(\"Content-Type\", \"application/x-www-form-urlencoded; charset=utf-8\");\n      } else if (typeof body === \"object\") {\n        if (body instanceof FormData) {\n          requestInit.body = body;\n        } else {\n          headers.set(\"Content-Type\", \"application/json; charset=utf-8\");\n          requestInit.body = JSON.stringify(body);\n        }\n      }\n    }\n    if (hasResponse) {\n      headers.set(\"Accept\", \"application/json\");\n    }\n    if (alterHeaders != null) {\n      alterHeaders(headers);\n    }\n\n    requestInit.headers = headers;\n    const response = await this.fetch(new Request(requestUrl, requestInit));\n\n    const responseType = response.headers.get(\"content-type\");\n    const responseIsJson = responseType != null && responseType.indexOf(\"application/json\") !== -1;\n    if (hasResponse && response.status === 200 && responseIsJson) {\n      const responseJson = await response.json();\n      return responseJson;\n    } else if (response.status !== 200) {\n      const error = await this.handleError(response, false, authed);\n      return Promise.reject(error);\n    }\n  }\n\n  private async handleError(\n    response: Response,\n    tokenError: boolean,\n    authed: boolean,\n  ): Promise<ErrorResponse> {\n    let responseJson: any = null;\n    if (this.isJsonResponse(response)) {\n      responseJson = await response.json();\n    } else if (this.isTextResponse(response)) {\n      responseJson = { Message: await response.text() };\n    }\n\n    if (authed) {\n      if (\n        response.status === 401 ||\n        response.status === 403 ||\n        (tokenError &&\n          response.status === 400 &&\n          responseJson != null &&\n          responseJson.error === \"invalid_grant\")\n      ) {\n        await this.logoutCallback(true);\n        return null;\n      }\n    }\n\n    return new ErrorResponse(responseJson, response.status, tokenError);\n  }\n\n  private qsStringify(params: any): string {\n    return Object.keys(params)\n      .map((key) => {\n        return encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key]);\n      })\n      .join(\"&\");\n  }\n\n  private getCredentials(): RequestCredentials {\n    if (!this.isWebClient || this.environmentService.hasBaseUrl()) {\n      return \"include\";\n    }\n    return undefined;\n  }\n\n  private addEventParameters(base: string, start: string, end: string, token: string) {\n    if (start != null) {\n      base += \"?start=\" + start;\n    }\n    if (end != null) {\n      base += base.indexOf(\"?\") > -1 ? \"&\" : \"?\";\n      base += \"end=\" + end;\n    }\n    if (token != null) {\n      base += base.indexOf(\"?\") > -1 ? \"&\" : \"?\";\n      base += \"continuationToken=\" + token;\n    }\n    return base;\n  }\n\n  private isJsonResponse(response: Response): boolean {\n    const typeHeader = response.headers.get(\"content-type\");\n    return typeHeader != null && typeHeader.indexOf(\"application/json\") > -1;\n  }\n\n  private isTextResponse(response: Response): boolean {\n    const typeHeader = response.headers.get(\"content-type\");\n    return typeHeader != null && typeHeader.indexOf(\"text\") > -1;\n  }\n}\n","import { ApiService } from \"../abstractions/api.service\";\nimport { AuditService as AuditServiceAbstraction } from \"../abstractions/audit.service\";\nimport { BreachAccountResponse } from \"../models/response/breach-account.response\";\nimport { ErrorResponse } from \"../models/response/error.response\";\nimport { CryptoFunctionService } from \"../platform/abstractions/crypto-function.service\";\nimport { throttle } from \"../platform/misc/throttle\";\nimport { Utils } from \"../platform/misc/utils\";\n\nconst PwnedPasswordsApi = \"https://api.pwnedpasswords.com/range/\";\n\nexport class AuditService implements AuditServiceAbstraction {\n  constructor(\n    private cryptoFunctionService: CryptoFunctionService,\n    private apiService: ApiService,\n  ) {}\n\n  @throttle(100, () => \"passwordLeaked\")\n  async passwordLeaked(password: string): Promise<number> {\n    const hashBytes = await this.cryptoFunctionService.hash(password, \"sha1\");\n    const hash = Utils.fromBufferToHex(hashBytes).toUpperCase();\n    const hashStart = hash.substr(0, 5);\n    const hashEnding = hash.substr(5);\n\n    const response = await this.apiService.nativeFetch(new Request(PwnedPasswordsApi + hashStart));\n    const leakedHashes = await response.text();\n    const match = leakedHashes.split(/\\r?\\n/).find((v) => {\n      return v.split(\":\")[0] === hashEnding;\n    });\n\n    return match != null ? parseInt(match.split(\":\")[1], 10) : 0;\n  }\n\n  async breachedAccounts(username: string): Promise<BreachAccountResponse[]> {\n    try {\n      return await this.apiService.getHibpBreach(username);\n    } catch (e) {\n      const error = e as ErrorResponse;\n      if (error.statusCode === 404) {\n        return [];\n      }\n      throw new Error();\n    }\n  }\n}\n","/**\n * Use as a Decorator on async functions, it will limit how many times the function can be\n * in-flight at a time.\n *\n * Calls beyond the limit will be queued, and run when one of the active calls finishes\n */\nexport function throttle(limit: number, throttleKey: (args: any[]) => string) {\n  return <T>(\n    target: any,\n    propertyKey: string | symbol,\n    descriptor: TypedPropertyDescriptor<(...args: any[]) => Promise<T>>,\n  ) => {\n    const originalMethod: () => Promise<T> = descriptor.value;\n    const allThrottles = new Map<any, Map<string, (() => void)[]>>();\n\n    const getThrottles = (obj: any) => {\n      let throttles = allThrottles.get(obj);\n      if (throttles != null) {\n        return throttles;\n      }\n      throttles = new Map<string, (() => void)[]>();\n      allThrottles.set(obj, throttles);\n      return throttles;\n    };\n\n    return {\n      value: function (...args: any[]) {\n        const throttles = getThrottles(this);\n        const argsThrottleKey = throttleKey(args);\n        let queue = throttles.get(argsThrottleKey);\n        if (queue == null) {\n          queue = [];\n          throttles.set(argsThrottleKey, queue);\n        }\n\n        return new Promise<T>((resolve, reject) => {\n          const exec = () => {\n            const onFinally = () => {\n              queue.splice(queue.indexOf(exec), 1);\n              if (queue.length >= limit) {\n                queue[limit - 1]();\n              } else if (queue.length === 0) {\n                throttles.delete(argsThrottleKey);\n                if (throttles.size === 0) {\n                  allThrottles.delete(this);\n                }\n              }\n            };\n            originalMethod\n              .apply(this, args)\n              .then((val: any) => {\n                onFinally();\n                return val;\n              })\n              .catch((err: any) => {\n                onFinally();\n                throw err;\n              })\n              .then(resolve, reject);\n          };\n          queue.push(exec);\n          if (queue.length <= limit) {\n            exec();\n          }\n        });\n      },\n    };\n  };\n}\n","import { EventType } from \"../../enums\";\n\nexport class EventData {\n  type: EventType;\n  cipherId: string;\n  date: string;\n  organizationId: string;\n}\n","import { EventCollectionService as EventCollectionServiceAbstraction } from \"../../abstractions/event/event-collection.service\";\nimport { EventUploadService } from \"../../abstractions/event/event-upload.service\";\nimport { OrganizationService } from \"../../admin-console/abstractions/organization/organization.service.abstraction\";\nimport { EventType } from \"../../enums\";\nimport { EventData } from \"../../models/data/event.data\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\nimport { CipherService } from \"../../vault/abstractions/cipher.service\";\n\nexport class EventCollectionService implements EventCollectionServiceAbstraction {\n  constructor(\n    private cipherService: CipherService,\n    private stateService: StateService,\n    private organizationService: OrganizationService,\n    private eventUploadService: EventUploadService,\n  ) {}\n\n  async collect(\n    eventType: EventType,\n    cipherId: string = null,\n    uploadImmediately = false,\n    organizationId: string = null,\n  ): Promise<any> {\n    const authed = await this.stateService.getIsAuthenticated();\n    if (!authed) {\n      return;\n    }\n    const organizations = await this.organizationService.getAll();\n    if (organizations == null) {\n      return;\n    }\n    const orgIds = new Set<string>(organizations.filter((o) => o.useEvents).map((o) => o.id));\n    if (orgIds.size === 0) {\n      return;\n    }\n    if (cipherId != null) {\n      const cipher = await this.cipherService.get(cipherId);\n      if (cipher == null || cipher.organizationId == null || !orgIds.has(cipher.organizationId)) {\n        return;\n      }\n    }\n    if (organizationId != null) {\n      if (!orgIds.has(organizationId)) {\n        return;\n      }\n    }\n    let eventCollection = await this.stateService.getEventCollection();\n    if (eventCollection == null) {\n      eventCollection = [];\n    }\n    const event = new EventData();\n    event.type = eventType;\n    event.cipherId = cipherId;\n    event.date = new Date().toISOString();\n    event.organizationId = organizationId;\n    eventCollection.push(event);\n    await this.stateService.setEventCollection(eventCollection);\n    if (uploadImmediately) {\n      await this.eventUploadService.uploadEvents();\n    }\n  }\n}\n","import { EventType } from \"../../enums\";\n\nexport class EventRequest {\n  type: EventType;\n  cipherId: string;\n  date: string;\n  organizationId: string;\n}\n","import { ApiService } from \"../../abstractions/api.service\";\nimport { EventUploadService as EventUploadServiceAbstraction } from \"../../abstractions/event/event-upload.service\";\nimport { EventRequest } from \"../../models/request/event.request\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\n\nexport class EventUploadService implements EventUploadServiceAbstraction {\n  private inited = false;\n  constructor(\n    private apiService: ApiService,\n    private stateService: StateService,\n    private logService: LogService,\n  ) {}\n\n  init(checkOnInterval: boolean) {\n    if (this.inited) {\n      return;\n    }\n\n    this.inited = true;\n    if (checkOnInterval) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.uploadEvents();\n      setInterval(() => this.uploadEvents(), 60 * 1000); // check every 60 seconds\n    }\n  }\n\n  async uploadEvents(userId?: string): Promise<void> {\n    const authed = await this.stateService.getIsAuthenticated({ userId: userId });\n    if (!authed) {\n      return;\n    }\n    const eventCollection = await this.stateService.getEventCollection({ userId: userId });\n    if (eventCollection == null || eventCollection.length === 0) {\n      return;\n    }\n    const request = eventCollection.map((e) => {\n      const req = new EventRequest();\n      req.type = e.type;\n      req.cipherId = e.cipherId;\n      req.date = e.date;\n      req.organizationId = e.organizationId;\n      return req;\n    });\n    try {\n      await this.apiService.postEventsCollect(request);\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.clearEvents(userId);\n    } catch (e) {\n      this.logService.error(e);\n    }\n  }\n\n  private async clearEvents(userId?: string): Promise<any> {\n    await this.stateService.setEventCollection(null, { userId: userId });\n  }\n}\n","import { NotificationType } from \"../../enums\";\n\nimport { BaseResponse } from \"./base.response\";\n\nexport class NotificationResponse extends BaseResponse {\n  contextId: string;\n  type: NotificationType;\n  payload: any;\n\n  constructor(response: any) {\n    super(response);\n    this.contextId = this.getResponseProperty(\"ContextId\");\n    this.type = this.getResponseProperty(\"Type\");\n\n    const payload = this.getResponseProperty(\"Payload\");\n    switch (this.type) {\n      case NotificationType.SyncCipherCreate:\n      case NotificationType.SyncCipherDelete:\n      case NotificationType.SyncCipherUpdate:\n      case NotificationType.SyncLoginDelete:\n        this.payload = new SyncCipherNotification(payload);\n        break;\n      case NotificationType.SyncFolderCreate:\n      case NotificationType.SyncFolderDelete:\n      case NotificationType.SyncFolderUpdate:\n        this.payload = new SyncFolderNotification(payload);\n        break;\n      case NotificationType.SyncVault:\n      case NotificationType.SyncCiphers:\n      case NotificationType.SyncOrganizations:\n      case NotificationType.SyncOrgKeys:\n      case NotificationType.SyncSettings:\n      case NotificationType.LogOut:\n        this.payload = new UserNotification(payload);\n        break;\n      case NotificationType.SyncSendCreate:\n      case NotificationType.SyncSendUpdate:\n      case NotificationType.SyncSendDelete:\n        this.payload = new SyncSendNotification(payload);\n        break;\n      case NotificationType.AuthRequest:\n      case NotificationType.AuthRequestResponse:\n        this.payload = new AuthRequestPushNotification(payload);\n        break;\n      default:\n        break;\n    }\n  }\n}\n\nexport class SyncCipherNotification extends BaseResponse {\n  id: string;\n  userId: string;\n  organizationId: string;\n  collectionIds: string[];\n  revisionDate: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.organizationId = this.getResponseProperty(\"OrganizationId\");\n    this.collectionIds = this.getResponseProperty(\"CollectionIds\");\n    this.revisionDate = new Date(this.getResponseProperty(\"RevisionDate\"));\n  }\n}\n\nexport class SyncFolderNotification extends BaseResponse {\n  id: string;\n  userId: string;\n  revisionDate: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.revisionDate = new Date(this.getResponseProperty(\"RevisionDate\"));\n  }\n}\n\nexport class UserNotification extends BaseResponse {\n  userId: string;\n  date: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.date = new Date(this.getResponseProperty(\"Date\"));\n  }\n}\n\nexport class SyncSendNotification extends BaseResponse {\n  id: string;\n  userId: string;\n  revisionDate: Date;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n    this.revisionDate = new Date(this.getResponseProperty(\"RevisionDate\"));\n  }\n}\n\nexport class AuthRequestPushNotification extends BaseResponse {\n  id: string;\n  userId: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.userId = this.getResponseProperty(\"UserId\");\n  }\n}\n","import * as signalR from \"@microsoft/signalr\";\nimport * as signalRMsgPack from \"@microsoft/signalr-protocol-msgpack\";\n\nimport { ApiService } from \"../abstractions/api.service\";\nimport { NotificationsService as NotificationsServiceAbstraction } from \"../abstractions/notifications.service\";\nimport { AuthService } from \"../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../auth/enums/authentication-status\";\nimport { NotificationType } from \"../enums\";\nimport {\n  NotificationResponse,\n  SyncCipherNotification,\n  SyncFolderNotification,\n  SyncSendNotification,\n} from \"../models/response/notification.response\";\nimport { AppIdService } from \"../platform/abstractions/app-id.service\";\nimport { EnvironmentService } from \"../platform/abstractions/environment.service\";\nimport { LogService } from \"../platform/abstractions/log.service\";\nimport { MessagingService } from \"../platform/abstractions/messaging.service\";\nimport { StateService } from \"../platform/abstractions/state.service\";\nimport { SyncService } from \"../vault/abstractions/sync/sync.service.abstraction\";\n\nexport class NotificationsService implements NotificationsServiceAbstraction {\n  private signalrConnection: signalR.HubConnection;\n  private url: string;\n  private connected = false;\n  private inited = false;\n  private inactive = false;\n  private reconnectTimer: any = null;\n\n  constructor(\n    private logService: LogService,\n    private syncService: SyncService,\n    private appIdService: AppIdService,\n    private apiService: ApiService,\n    private environmentService: EnvironmentService,\n    private logoutCallback: (expired: boolean) => Promise<void>,\n    private stateService: StateService,\n    private authService: AuthService,\n    private messagingService: MessagingService,\n  ) {\n    this.environmentService.urls.subscribe(() => {\n      if (!this.inited) {\n        return;\n      }\n\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.init();\n    });\n  }\n\n  async init(): Promise<void> {\n    this.inited = false;\n    this.url = this.environmentService.getNotificationsUrl();\n\n    // Set notifications server URL to `https://-` to effectively disable communication\n    // with the notifications server from the client app\n    if (this.url === \"https://-\") {\n      return;\n    }\n\n    if (this.signalrConnection != null) {\n      this.signalrConnection.off(\"ReceiveMessage\");\n      this.signalrConnection.off(\"Heartbeat\");\n      await this.signalrConnection.stop();\n      this.connected = false;\n      this.signalrConnection = null;\n    }\n\n    this.signalrConnection = new signalR.HubConnectionBuilder()\n      .withUrl(this.url + \"/hub\", {\n        accessTokenFactory: () => this.apiService.getActiveBearerToken(),\n        skipNegotiation: true,\n        transport: signalR.HttpTransportType.WebSockets,\n      })\n      .withHubProtocol(new signalRMsgPack.MessagePackHubProtocol() as signalR.IHubProtocol)\n      // .configureLogging(signalR.LogLevel.Trace)\n      .build();\n\n    this.signalrConnection.on(\"ReceiveMessage\", (data: any) =>\n      this.processNotification(new NotificationResponse(data)),\n    );\n    // eslint-disable-next-line\n    this.signalrConnection.on(\"Heartbeat\", (data: any) => {\n      /*console.log('Heartbeat!');*/\n    });\n    this.signalrConnection.onclose(() => {\n      this.connected = false;\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.reconnect(true);\n    });\n    this.inited = true;\n    if (await this.isAuthedAndUnlocked()) {\n      await this.reconnect(false);\n    }\n  }\n\n  async updateConnection(sync = false): Promise<void> {\n    if (!this.inited) {\n      return;\n    }\n    try {\n      if (await this.isAuthedAndUnlocked()) {\n        await this.reconnect(sync);\n      } else {\n        await this.signalrConnection.stop();\n      }\n    } catch (e) {\n      this.logService.error(e.toString());\n    }\n  }\n\n  async reconnectFromActivity(): Promise<void> {\n    this.inactive = false;\n    if (this.inited && !this.connected) {\n      await this.reconnect(true);\n    }\n  }\n\n  async disconnectFromInactivity(): Promise<void> {\n    this.inactive = true;\n    if (this.inited && this.connected) {\n      await this.signalrConnection.stop();\n    }\n  }\n\n  private async processNotification(notification: NotificationResponse) {\n    const appId = await this.appIdService.getAppId();\n    if (notification == null || notification.contextId === appId) {\n      return;\n    }\n\n    const isAuthenticated = await this.stateService.getIsAuthenticated();\n    const payloadUserId = notification.payload.userId || notification.payload.UserId;\n    const myUserId = await this.stateService.getUserId();\n    if (isAuthenticated && payloadUserId != null && payloadUserId !== myUserId) {\n      return;\n    }\n\n    switch (notification.type) {\n      case NotificationType.SyncCipherCreate:\n      case NotificationType.SyncCipherUpdate:\n        await this.syncService.syncUpsertCipher(\n          notification.payload as SyncCipherNotification,\n          notification.type === NotificationType.SyncCipherUpdate,\n        );\n        break;\n      case NotificationType.SyncCipherDelete:\n      case NotificationType.SyncLoginDelete:\n        await this.syncService.syncDeleteCipher(notification.payload as SyncCipherNotification);\n        break;\n      case NotificationType.SyncFolderCreate:\n      case NotificationType.SyncFolderUpdate:\n        await this.syncService.syncUpsertFolder(\n          notification.payload as SyncFolderNotification,\n          notification.type === NotificationType.SyncFolderUpdate,\n        );\n        break;\n      case NotificationType.SyncFolderDelete:\n        await this.syncService.syncDeleteFolder(notification.payload as SyncFolderNotification);\n        break;\n      case NotificationType.SyncVault:\n      case NotificationType.SyncCiphers:\n      case NotificationType.SyncSettings:\n        if (isAuthenticated) {\n          await this.syncService.fullSync(false);\n        }\n        break;\n      case NotificationType.SyncOrganizations:\n        if (isAuthenticated) {\n          // An organization update may not have bumped the user's account revision date, so force a sync\n          await this.syncService.fullSync(true);\n        }\n        break;\n      case NotificationType.SyncOrgKeys:\n        if (isAuthenticated) {\n          await this.syncService.fullSync(true);\n          // Stop so a reconnect can be made\n          await this.signalrConnection.stop();\n        }\n        break;\n      case NotificationType.LogOut:\n        if (isAuthenticated) {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.logoutCallback(true);\n        }\n        break;\n      case NotificationType.SyncSendCreate:\n      case NotificationType.SyncSendUpdate:\n        await this.syncService.syncUpsertSend(\n          notification.payload as SyncSendNotification,\n          notification.type === NotificationType.SyncSendUpdate,\n        );\n        break;\n      case NotificationType.SyncSendDelete:\n        await this.syncService.syncDeleteSend(notification.payload as SyncSendNotification);\n        break;\n      case NotificationType.AuthRequest:\n        if (await this.stateService.getApproveLoginRequests()) {\n          this.messagingService.send(\"openLoginApproval\", {\n            notificationId: notification.payload.id,\n          });\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  private async reconnect(sync: boolean) {\n    if (this.reconnectTimer != null) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n    if (this.connected || !this.inited || this.inactive) {\n      return;\n    }\n    const authedAndUnlocked = await this.isAuthedAndUnlocked();\n    if (!authedAndUnlocked) {\n      return;\n    }\n\n    try {\n      await this.signalrConnection.start();\n      this.connected = true;\n      if (sync) {\n        await this.syncService.fullSync(false);\n      }\n    } catch (e) {\n      this.logService.error(e);\n    }\n\n    if (!this.connected) {\n      this.reconnectTimer = setTimeout(() => this.reconnect(sync), this.random(120000, 300000));\n    }\n  }\n\n  private async isAuthedAndUnlocked() {\n    const authStatus = await this.authService.getAuthStatus();\n    return authStatus >= AuthenticationStatus.Unlocked;\n  }\n\n  private random(min: number, max: number) {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n  }\n}\n","import * as lunr from \"lunr\";\n\nimport { SearchService as SearchServiceAbstraction } from \"../abstractions/search.service\";\nimport { I18nService } from \"../platform/abstractions/i18n.service\";\nimport { LogService } from \"../platform/abstractions/log.service\";\nimport { SendView } from \"../tools/send/models/view/send.view\";\nimport { FieldType, UriMatchType } from \"../vault/enums\";\nimport { CipherType } from \"../vault/enums/cipher-type\";\nimport { CipherView } from \"../vault/models/view/cipher.view\";\n\nexport class SearchService implements SearchServiceAbstraction {\n  private static registeredPipeline = false;\n\n  indexedEntityId?: string = null;\n  private indexing = false;\n  private index: lunr.Index = null;\n  private readonly immediateSearchLocales: string[] = [\"zh-CN\", \"zh-TW\", \"ja\", \"ko\", \"vi\"];\n  private readonly defaultSearchableMinLength: number = 2;\n  private searchableMinLength: number = this.defaultSearchableMinLength;\n\n  constructor(\n    private logService: LogService,\n    private i18nService: I18nService,\n  ) {\n    this.i18nService.locale$.subscribe((locale) => {\n      if (this.immediateSearchLocales.indexOf(locale) !== -1) {\n        this.searchableMinLength = 1;\n      } else {\n        this.searchableMinLength = this.defaultSearchableMinLength;\n      }\n    });\n\n    // Currently have to ensure this is only done a single time. Lunr allows you to register a function\n    // multiple times but they will add a warning message to the console. The way they do that breaks when ran on a service worker.\n    if (!SearchService.registeredPipeline) {\n      SearchService.registeredPipeline = true;\n      //register lunr pipeline function\n      lunr.Pipeline.registerFunction(this.normalizeAccentsPipelineFunction, \"normalizeAccents\");\n    }\n  }\n\n  clearIndex(): void {\n    this.indexedEntityId = null;\n    this.index = null;\n  }\n\n  isSearchable(query: string): boolean {\n    query = SearchService.normalizeSearchQuery(query);\n    const notSearchable =\n      query == null ||\n      (this.index == null && query.length < this.searchableMinLength) ||\n      (this.index != null && query.length < this.searchableMinLength && query.indexOf(\">\") !== 0);\n    return !notSearchable;\n  }\n\n  indexCiphers(ciphers: CipherView[], indexedEntityId?: string): void {\n    if (this.indexing) {\n      return;\n    }\n\n    this.indexing = true;\n    this.indexedEntityId = indexedEntityId;\n    this.index = null;\n    const builder = new lunr.Builder();\n    builder.pipeline.add(this.normalizeAccentsPipelineFunction);\n    builder.ref(\"id\");\n    builder.field(\"shortid\", { boost: 100, extractor: (c: CipherView) => c.id.substr(0, 8) });\n    builder.field(\"name\", {\n      boost: 10,\n    });\n    builder.field(\"subtitle\", {\n      boost: 5,\n      extractor: (c: CipherView) => {\n        if (c.subTitle != null && c.type === CipherType.Card) {\n          return c.subTitle.replace(/\\*/g, \"\");\n        }\n        return c.subTitle;\n      },\n    });\n    builder.field(\"notes\");\n    builder.field(\"login.username\", {\n      extractor: (c: CipherView) =>\n        c.type === CipherType.Login && c.login != null ? c.login.username : null,\n    });\n    builder.field(\"login.uris\", { boost: 2, extractor: (c: CipherView) => this.uriExtractor(c) });\n    builder.field(\"fields\", { extractor: (c: CipherView) => this.fieldExtractor(c, false) });\n    builder.field(\"fields_joined\", { extractor: (c: CipherView) => this.fieldExtractor(c, true) });\n    builder.field(\"attachments\", {\n      extractor: (c: CipherView) => this.attachmentExtractor(c, false),\n    });\n    builder.field(\"attachments_joined\", {\n      extractor: (c: CipherView) => this.attachmentExtractor(c, true),\n    });\n    builder.field(\"organizationid\", { extractor: (c: CipherView) => c.organizationId });\n    ciphers = ciphers || [];\n    ciphers.forEach((c) => builder.add(c));\n    this.index = builder.build();\n\n    this.indexing = false;\n\n    this.logService.info(\"Finished search indexing\");\n  }\n\n  async searchCiphers(\n    query: string,\n    filter: ((cipher: CipherView) => boolean) | ((cipher: CipherView) => boolean)[] = null,\n    ciphers: CipherView[],\n  ): Promise<CipherView[]> {\n    const results: CipherView[] = [];\n    if (query != null) {\n      query = SearchService.normalizeSearchQuery(query.trim().toLowerCase());\n    }\n    if (query === \"\") {\n      query = null;\n    }\n\n    if (ciphers == null) {\n      ciphers = [];\n    }\n\n    if (filter != null && Array.isArray(filter) && filter.length > 0) {\n      ciphers = ciphers.filter((c) => filter.every((f) => f == null || f(c)));\n    } else if (filter != null) {\n      ciphers = ciphers.filter(filter as (cipher: CipherView) => boolean);\n    }\n\n    if (!this.isSearchable(query)) {\n      return ciphers;\n    }\n\n    if (this.indexing) {\n      await new Promise((r) => setTimeout(r, 250));\n      if (this.indexing) {\n        await new Promise((r) => setTimeout(r, 500));\n      }\n    }\n\n    const index = this.getIndexForSearch();\n    if (index == null) {\n      // Fall back to basic search if index is not available\n      return this.searchCiphersBasic(ciphers, query);\n    }\n\n    const ciphersMap = new Map<string, CipherView>();\n    ciphers.forEach((c) => ciphersMap.set(c.id, c));\n\n    let searchResults: lunr.Index.Result[] = null;\n    const isQueryString = query != null && query.length > 1 && query.indexOf(\">\") === 0;\n    if (isQueryString) {\n      try {\n        searchResults = index.search(query.substr(1).trim());\n      } catch (e) {\n        this.logService.error(e);\n      }\n    } else {\n      const soWild = lunr.Query.wildcard.LEADING | lunr.Query.wildcard.TRAILING;\n      searchResults = index.query((q) => {\n        lunr.tokenizer(query).forEach((token) => {\n          const t = token.toString();\n          q.term(t, { fields: [\"name\"], wildcard: soWild });\n          q.term(t, { fields: [\"subtitle\"], wildcard: soWild });\n          q.term(t, { fields: [\"login.uris\"], wildcard: soWild });\n          q.term(t, {});\n        });\n      });\n    }\n\n    if (searchResults != null) {\n      searchResults.forEach((r) => {\n        if (ciphersMap.has(r.ref)) {\n          results.push(ciphersMap.get(r.ref));\n        }\n      });\n    }\n    return results;\n  }\n\n  searchCiphersBasic(ciphers: CipherView[], query: string, deleted = false) {\n    query = SearchService.normalizeSearchQuery(query.trim().toLowerCase());\n    return ciphers.filter((c) => {\n      if (deleted !== c.isDeleted) {\n        return false;\n      }\n      if (c.name != null && c.name.toLowerCase().indexOf(query) > -1) {\n        return true;\n      }\n      if (query.length >= 8 && c.id.startsWith(query)) {\n        return true;\n      }\n      if (c.subTitle != null && c.subTitle.toLowerCase().indexOf(query) > -1) {\n        return true;\n      }\n      if (\n        c.login &&\n        c.login.hasUris &&\n        c.login.uris.some((loginUri) => loginUri?.uri?.toLowerCase().indexOf(query) > -1)\n      ) {\n        return true;\n      }\n      return false;\n    });\n  }\n\n  searchSends(sends: SendView[], query: string) {\n    query = SearchService.normalizeSearchQuery(query.trim().toLocaleLowerCase());\n    if (query === null) {\n      return sends;\n    }\n    const sendsMatched: SendView[] = [];\n    const lowPriorityMatched: SendView[] = [];\n    sends.forEach((s) => {\n      if (s.name != null && s.name.toLowerCase().indexOf(query) > -1) {\n        sendsMatched.push(s);\n      } else if (\n        query.length >= 8 &&\n        (s.id.startsWith(query) ||\n          s.accessId.toLocaleLowerCase().startsWith(query) ||\n          (s.file?.id != null && s.file.id.startsWith(query)))\n      ) {\n        lowPriorityMatched.push(s);\n      } else if (s.notes != null && s.notes.toLowerCase().indexOf(query) > -1) {\n        lowPriorityMatched.push(s);\n      } else if (s.text?.text != null && s.text.text.toLowerCase().indexOf(query) > -1) {\n        lowPriorityMatched.push(s);\n      } else if (s.file?.fileName != null && s.file.fileName.toLowerCase().indexOf(query) > -1) {\n        lowPriorityMatched.push(s);\n      }\n    });\n    return sendsMatched.concat(lowPriorityMatched);\n  }\n\n  getIndexForSearch(): lunr.Index {\n    return this.index;\n  }\n\n  private fieldExtractor(c: CipherView, joined: boolean) {\n    if (!c.hasFields) {\n      return null;\n    }\n    let fields: string[] = [];\n    c.fields.forEach((f) => {\n      if (f.name != null) {\n        fields.push(f.name);\n      }\n      if (f.type === FieldType.Text && f.value != null) {\n        fields.push(f.value);\n      }\n    });\n    fields = fields.filter((f) => f.trim() !== \"\");\n    if (fields.length === 0) {\n      return null;\n    }\n    return joined ? fields.join(\" \") : fields;\n  }\n\n  private attachmentExtractor(c: CipherView, joined: boolean) {\n    if (!c.hasAttachments) {\n      return null;\n    }\n    let attachments: string[] = [];\n    c.attachments.forEach((a) => {\n      if (a != null && a.fileName != null) {\n        if (joined && a.fileName.indexOf(\".\") > -1) {\n          attachments.push(a.fileName.substr(0, a.fileName.lastIndexOf(\".\")));\n        } else {\n          attachments.push(a.fileName);\n        }\n      }\n    });\n    attachments = attachments.filter((f) => f.trim() !== \"\");\n    if (attachments.length === 0) {\n      return null;\n    }\n    return joined ? attachments.join(\" \") : attachments;\n  }\n\n  private uriExtractor(c: CipherView) {\n    if (c.type !== CipherType.Login || c.login == null || !c.login.hasUris) {\n      return null;\n    }\n    const uris: string[] = [];\n    c.login.uris.forEach((u) => {\n      if (u.uri == null || u.uri === \"\") {\n        return;\n      }\n      if (u.hostname != null) {\n        uris.push(u.hostname);\n        return;\n      }\n      let uri = u.uri;\n      if (u.match !== UriMatchType.RegularExpression) {\n        const protocolIndex = uri.indexOf(\"://\");\n        if (protocolIndex > -1) {\n          uri = uri.substr(protocolIndex + 3);\n        }\n        const queryIndex = uri.search(/\\?|&|#/);\n        if (queryIndex > -1) {\n          uri = uri.substring(0, queryIndex);\n        }\n      }\n      uris.push(uri);\n    });\n    return uris.length > 0 ? uris : null;\n  }\n\n  private normalizeAccentsPipelineFunction(token: lunr.Token): any {\n    const searchableFields = [\"name\", \"login.username\", \"subtitle\", \"notes\"];\n    const fields = (token as any).metadata[\"fields\"];\n    const checkFields = fields.every((i: any) => searchableFields.includes(i));\n\n    if (checkFields) {\n      return SearchService.normalizeSearchQuery(token.toString());\n    }\n\n    return token;\n  }\n\n  // Remove accents/diacritics characters from text. This regex is equivalent to the Diacritic unicode property escape, i.e. it will match all diacritic characters.\n  static normalizeSearchQuery(query: string): string {\n    return query?.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\n  }\n}\n","import { defer } from \"rxjs\";\n\nimport { VaultTimeoutSettingsService as VaultTimeoutSettingsServiceAbstraction } from \"../../abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { PolicyService } from \"../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"../../admin-console/enums\";\nimport { TokenService } from \"../../auth/abstractions/token.service\";\nimport { VaultTimeoutAction } from \"../../enums/vault-timeout-action.enum\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\n\n/**\n * - DISABLED: No Pin set\n * - PERSISTENT: Pin is set and survives client reset\n * - TRANSIENT: Pin is set and requires password unlock after client reset\n */\nexport type PinLockType = \"DISABLED\" | \"PERSISTANT\" | \"TRANSIENT\";\n\nexport class VaultTimeoutSettingsService implements VaultTimeoutSettingsServiceAbstraction {\n  constructor(\n    private cryptoService: CryptoService,\n    private tokenService: TokenService,\n    private policyService: PolicyService,\n    private stateService: StateService,\n  ) {}\n\n  async setVaultTimeoutOptions(timeout: number, action: VaultTimeoutAction): Promise<void> {\n    // We swap these tokens from being on disk for lock actions, and in memory for logout actions\n    // Get them here to set them to their new location after changing the timeout action and clearing if needed\n    const token = await this.tokenService.getToken();\n    const refreshToken = await this.tokenService.getRefreshToken();\n    const clientId = await this.tokenService.getClientId();\n    const clientSecret = await this.tokenService.getClientSecret();\n\n    await this.stateService.setVaultTimeout(timeout);\n\n    const currentAction = await this.stateService.getVaultTimeoutAction();\n    if (\n      (timeout != null || timeout === 0) &&\n      action === VaultTimeoutAction.LogOut &&\n      action !== currentAction\n    ) {\n      // if we have a vault timeout and the action is log out, reset tokens\n      await this.tokenService.clearToken();\n    }\n\n    await this.stateService.setVaultTimeoutAction(action);\n\n    await this.tokenService.setToken(token);\n    await this.tokenService.setRefreshToken(refreshToken);\n    await this.tokenService.setClientId(clientId);\n    await this.tokenService.setClientSecret(clientSecret);\n\n    await this.cryptoService.refreshAdditionalKeys();\n  }\n\n  availableVaultTimeoutActions$(userId?: string) {\n    return defer(() => this.getAvailableVaultTimeoutActions(userId));\n  }\n\n  async isPinLockSet(userId?: string): Promise<PinLockType> {\n    // we can't check the protected pin for both because old accounts only\n    // used it for MP on Restart\n    const pinIsEnabled = !!(await this.stateService.getProtectedPin({ userId }));\n    const aUserKeyPinIsSet = !!(await this.stateService.getPinKeyEncryptedUserKey({ userId }));\n    const anOldUserKeyPinIsSet = !!(await this.stateService.getEncryptedPinProtected({ userId }));\n\n    if (aUserKeyPinIsSet || anOldUserKeyPinIsSet) {\n      return \"PERSISTANT\";\n    } else if (pinIsEnabled && !aUserKeyPinIsSet && !anOldUserKeyPinIsSet) {\n      return \"TRANSIENT\";\n    } else {\n      return \"DISABLED\";\n    }\n  }\n\n  async isBiometricLockSet(userId?: string): Promise<boolean> {\n    return await this.stateService.getBiometricUnlock({ userId });\n  }\n\n  async getVaultTimeout(userId?: string): Promise<number> {\n    const vaultTimeout = await this.stateService.getVaultTimeout({ userId });\n\n    if (\n      await this.policyService.policyAppliesToUser(PolicyType.MaximumVaultTimeout, null, userId)\n    ) {\n      const policy = await this.policyService.getAll(PolicyType.MaximumVaultTimeout, userId);\n      // Remove negative values, and ensure it's smaller than maximum allowed value according to policy\n      let timeout = Math.min(vaultTimeout, policy[0].data.minutes);\n\n      if (vaultTimeout == null || timeout < 0) {\n        timeout = policy[0].data.minutes;\n      }\n\n      // TODO @jlf0dev: Can we move this somwhere else? Maybe add it to the initialization process?\n      // ( Apparently I'm the one that reviewed the original PR that added this :) )\n      // We really shouldn't need to set the value here, but multiple services relies on this value being correct.\n      if (vaultTimeout !== timeout) {\n        await this.stateService.setVaultTimeout(timeout, { userId });\n      }\n\n      return timeout;\n    }\n\n    return vaultTimeout;\n  }\n\n  vaultTimeoutAction$(userId?: string) {\n    return defer(() => this.getVaultTimeoutAction(userId));\n  }\n\n  async getVaultTimeoutAction(userId?: string): Promise<VaultTimeoutAction> {\n    const availableActions = await this.getAvailableVaultTimeoutActions();\n    if (availableActions.length === 1) {\n      return availableActions[0];\n    }\n\n    const vaultTimeoutAction = await this.stateService.getVaultTimeoutAction({ userId: userId });\n\n    if (\n      await this.policyService.policyAppliesToUser(PolicyType.MaximumVaultTimeout, null, userId)\n    ) {\n      const policy = await this.policyService.getAll(PolicyType.MaximumVaultTimeout, userId);\n      const action = policy[0].data.action;\n      // We really shouldn't need to set the value here, but multiple services relies on this value being correct.\n      if (action && vaultTimeoutAction !== action) {\n        await this.stateService.setVaultTimeoutAction(action, { userId: userId });\n      }\n      if (action && availableActions.includes(action)) {\n        return action;\n      }\n    }\n\n    if (vaultTimeoutAction == null) {\n      // Depends on whether or not the user has a master password\n      const defaultValue = (await this.userHasMasterPassword(userId))\n        ? VaultTimeoutAction.Lock\n        : VaultTimeoutAction.LogOut;\n      // We really shouldn't need to set the value here, but multiple services relies on this value being correct.\n      await this.stateService.setVaultTimeoutAction(defaultValue, { userId: userId });\n      return defaultValue;\n    }\n\n    return vaultTimeoutAction === VaultTimeoutAction.LogOut\n      ? VaultTimeoutAction.LogOut\n      : VaultTimeoutAction.Lock;\n  }\n\n  private async getAvailableVaultTimeoutActions(userId?: string): Promise<VaultTimeoutAction[]> {\n    const availableActions = [VaultTimeoutAction.LogOut];\n\n    const canLock =\n      (await this.userHasMasterPassword(userId)) ||\n      (await this.isPinLockSet(userId)) !== \"DISABLED\" ||\n      (await this.isBiometricLockSet(userId));\n\n    if (canLock) {\n      availableActions.push(VaultTimeoutAction.Lock);\n    }\n\n    return availableActions;\n  }\n\n  async clear(userId?: string): Promise<void> {\n    await this.stateService.setEverBeenUnlocked(false, { userId: userId });\n    await this.cryptoService.clearPinKeys(userId);\n  }\n\n  private async userHasMasterPassword(userId: string): Promise<boolean> {\n    const acctDecryptionOpts = await this.stateService.getAccountDecryptionOptions({\n      userId: userId,\n    });\n\n    if (acctDecryptionOpts?.hasMasterPassword != undefined) {\n      return acctDecryptionOpts.hasMasterPassword;\n    }\n  }\n}\n","import { PolicyEvaluator } from \"../abstractions/policy-evaluator.abstraction\";\n\nimport { PasswordGenerationOptions } from \"./password-generation-options\";\nimport { PasswordGeneratorPolicy } from \"./password-generator-policy\";\n\nfunction initializeBoundaries() {\n  const length = Object.freeze({\n    min: 5,\n    max: 128,\n  });\n\n  const minDigits = Object.freeze({\n    min: 0,\n    max: 9,\n  });\n\n  const minSpecialCharacters = Object.freeze({\n    min: 0,\n    max: 9,\n  });\n\n  return Object.freeze({\n    length,\n    minDigits,\n    minSpecialCharacters,\n  });\n}\n\n/** Immutable default boundaries for password generation.\n * These are used when the policy does not override a value.\n */\nexport const DefaultBoundaries = initializeBoundaries();\n\ntype Boundary = {\n  readonly min: number;\n  readonly max: number;\n};\n\n/** Enforces policy for password generation.\n */\nexport class PasswordGeneratorOptionsEvaluator\n  implements PolicyEvaluator<PasswordGeneratorPolicy, PasswordGenerationOptions>\n{\n  // This design is not ideal, but it is a step towards a more robust password\n  // generator. Ideally, `sanitize` would be implemented on an options class,\n  // and `applyPolicy` would be implemented on a policy class, \"mise en place\".\n  //\n  // The current design of the password generator, unfortunately, would require\n  // a substantial rewrite to make this feasible. Hopefully this change can be\n  // applied when the password generator is ported to rust.\n\n  /** Boundaries for the password length. This is always large enough\n   * to accommodate the minimum number of digits and special characters.\n   */\n  readonly length: Boundary;\n\n  /** Boundaries for the minimum number of digits allowed in the password.\n   */\n  readonly minDigits: Boundary;\n\n  /** Boundaries for the minimum number of special characters allowed\n   *  in the password.\n   */\n  readonly minSpecialCharacters: Boundary;\n\n  /** Policy applied by the evaluator.\n   */\n  readonly policy: PasswordGeneratorPolicy;\n\n  /** Instantiates the evaluator.\n   * @param policy The policy applied by the evaluator. When this conflicts with\n   *               the defaults, the policy takes precedence.\n   */\n  constructor(policy: PasswordGeneratorPolicy) {\n    function createBoundary(value: number, defaultBoundary: Boundary): Boundary {\n      const boundary = {\n        min: Math.max(defaultBoundary.min, value),\n        max: Math.max(defaultBoundary.max, value),\n      };\n\n      return boundary;\n    }\n\n    this.policy = structuredClone(policy);\n    this.minDigits = createBoundary(policy.numberCount, DefaultBoundaries.minDigits);\n    this.minSpecialCharacters = createBoundary(\n      policy.specialCount,\n      DefaultBoundaries.minSpecialCharacters,\n    );\n\n    // the overall length should be at least as long as the sum of the minimums\n    const minConsistentLength = this.minDigits.min + this.minSpecialCharacters.min;\n    const minPolicyLength = policy.minLength > 0 ? policy.minLength : DefaultBoundaries.length.min;\n    const minLength = Math.max(minPolicyLength, minConsistentLength, DefaultBoundaries.length.min);\n\n    this.length = {\n      min: minLength,\n      max: Math.max(DefaultBoundaries.length.max, minLength),\n    };\n  }\n\n  /** {@link PolicyEvaluator.policyInEffect} */\n  get policyInEffect(): boolean {\n    const policies = [\n      this.policy.useUppercase,\n      this.policy.useLowercase,\n      this.policy.useNumbers,\n      this.policy.useSpecial,\n      this.policy.minLength > DefaultBoundaries.length.min,\n      this.policy.numberCount > DefaultBoundaries.minDigits.min,\n      this.policy.specialCount > DefaultBoundaries.minSpecialCharacters.min,\n    ];\n\n    return policies.includes(true);\n  }\n\n  /** {@link PolicyEvaluator.applyPolicy} */\n  applyPolicy(options: PasswordGenerationOptions): PasswordGenerationOptions {\n    function fitToBounds(value: number, boundaries: Boundary) {\n      const { min, max } = boundaries;\n\n      const withUpperBound = Math.min(value || 0, max);\n      const withLowerBound = Math.max(withUpperBound, min);\n\n      return withLowerBound;\n    }\n\n    // apply policy overrides\n    const uppercase = this.policy.useUppercase || options.uppercase || false;\n    const lowercase = this.policy.useLowercase || options.lowercase || false;\n\n    // these overrides can cascade numeric fields to boolean fields\n    const number = this.policy.useNumbers || options.number || options.minNumber > 0;\n    const special = this.policy.useSpecial || options.special || options.minSpecial > 0;\n\n    // apply boundaries; the boundaries can cascade boolean fields to numeric fields\n    const length = fitToBounds(options.length, this.length);\n    const minNumber = fitToBounds(options.minNumber, this.minDigits);\n    const minSpecial = fitToBounds(options.minSpecial, this.minSpecialCharacters);\n\n    return {\n      ...options,\n      length,\n      uppercase,\n      lowercase,\n      number,\n      minNumber,\n      special,\n      minSpecial,\n    };\n  }\n\n  /** {@link PolicyEvaluator.sanitize} */\n  sanitize(options: PasswordGenerationOptions): PasswordGenerationOptions {\n    function cascade(enabled: boolean, value: number): [boolean, number] {\n      const enabledResult = enabled ?? value > 0;\n      const valueResult = enabledResult ? value || 1 : 0;\n\n      return [enabledResult, valueResult];\n    }\n\n    const [lowercase, minLowercase] = cascade(options.lowercase, options.minLowercase);\n    const [uppercase, minUppercase] = cascade(options.uppercase, options.minUppercase);\n    const [number, minNumber] = cascade(options.number, options.minNumber);\n    const [special, minSpecial] = cascade(options.special, options.minSpecial);\n\n    // minimums can only increase the length\n    const minConsistentLength = minLowercase + minUppercase + minNumber + minSpecial;\n    const minLength = Math.max(minConsistentLength, this.length.min);\n    const length = Math.max(options.length ?? minLength, minLength);\n\n    return {\n      ...options,\n      length,\n      minLength,\n      lowercase,\n      minLowercase,\n      uppercase,\n      minUppercase,\n      number,\n      minNumber,\n      special,\n      minSpecial,\n    };\n  }\n}\n","import { DefaultBoundaries } from \"./password-generator-options-evaluator\";\n\n/** Request format for password credential generation.\n *  All members of this type may be `undefined` when the user is\n *  generating a passphrase.\n *\n * @remarks The name of this type is a bit of a misnomer. This type\n *          it is used with the \"password generator\" types. The name\n *          `PasswordGeneratorOptions` is already in use by legacy code.\n */\nexport type PasswordGenerationOptions = {\n  /** The length of the password selected by the user */\n  length?: number;\n\n  /** The minimum length of the password. This defaults to 5, and increases\n   * to ensure `minLength` is at least as large as the sum of the other minimums.\n   */\n  minLength?: number;\n\n  /** `true` when ambiguous characters may be included in the output.\n   *  `false` when ambiguous characters should not be included in the output.\n   */\n  ambiguous?: boolean;\n\n  /** `true` when uppercase ASCII characters should be included in the output\n   * This value defaults to `false.\n   */\n  uppercase?: boolean;\n\n  /** The minimum number of uppercase characters to include in the output.\n   *  The value is ignored when `uppercase` is `false`.\n   *  The value defaults to 1 when `uppercase` is `true`.\n   */\n  minUppercase?: number;\n\n  /** `true` when lowercase ASCII characters should be included in the output.\n   * This value defaults to `false`.\n   */\n  lowercase?: boolean;\n\n  /** The minimum number of lowercase characters to include in the output.\n   * The value defaults to 1 when `lowercase` is `true`.\n   * The value defaults to 0 when `lowercase` is `false`.\n   */\n  minLowercase?: number;\n\n  /** Whether or not to include ASCII digits in the output\n   * This value defaults to `true` when `minNumber` is at least 1.\n   * This value defaults to `false` when `minNumber` is less than 1.\n   */\n  number?: boolean;\n\n  /** The minimum number of digits to include in the output.\n   * The value defaults to 1 when `number` is `true`.\n   * The value defaults to 0 when `number` is `false`.\n   */\n  minNumber?: number;\n\n  /** Whether or not to include special characters in the output.\n   * This value defaults to `true` when `minSpecial` is at least 1.\n   * This value defaults to `false` when `minSpecial` is less than 1.\n   */\n  special?: boolean;\n\n  /** The minimum number of special characters to include in the output.\n   * This value defaults to 1 when `special` is `true`.\n   * This value defaults to 0 when `special` is `false`.\n   */\n  minSpecial?: number;\n};\n\n/** The default options for password generation. */\nexport const DefaultPasswordGenerationOptions: Partial<PasswordGenerationOptions> = Object.freeze({\n  length: 14,\n  minLength: DefaultBoundaries.length.min,\n  ambiguous: true,\n  uppercase: true,\n  lowercase: true,\n  number: true,\n  minNumber: 1,\n  special: true,\n  minSpecial: 1,\n});\n","import { GENERATOR_DISK, KeyDefinition } from \"../../platform/state\";\n\nimport { PassphraseGenerationOptions } from \"./passphrase/passphrase-generation-options\";\nimport { GeneratedPasswordHistory } from \"./password/generated-password-history\";\nimport { PasswordGenerationOptions } from \"./password/password-generation-options\";\nimport { CatchallGenerationOptions } from \"./username/catchall-generator-options\";\nimport { EffUsernameGenerationOptions } from \"./username/eff-username-generator-options\";\nimport { SubaddressGenerationOptions } from \"./username/subaddress-generator-options\";\n\n/** plaintext password generation options */\nexport const PASSWORD_SETTINGS = new KeyDefinition<PasswordGenerationOptions>(\n  GENERATOR_DISK,\n  \"passwordGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n  },\n);\n\n/** plaintext passphrase generation options */\nexport const PASSPHRASE_SETTINGS = new KeyDefinition<PassphraseGenerationOptions>(\n  GENERATOR_DISK,\n  \"passphraseGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n  },\n);\n\n/** plaintext username generation options */\nexport const EFF_USERNAME_SETTINGS = new KeyDefinition<EffUsernameGenerationOptions>(\n  GENERATOR_DISK,\n  \"effUsernameGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n  },\n);\n\n/** catchall email generation options */\nexport const CATCHALL_SETTINGS = new KeyDefinition<CatchallGenerationOptions>(\n  GENERATOR_DISK,\n  \"catchallGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n  },\n);\n\n/** email subaddress generation options */\nexport const SUBADDRESS_SETTINGS = new KeyDefinition<SubaddressGenerationOptions>(\n  GENERATOR_DISK,\n  \"subaddressGeneratorSettings\",\n  {\n    deserializer: (value) => value,\n  },\n);\n\n/** encrypted password generation history */\nexport const ENCRYPTED_HISTORY = new KeyDefinition<GeneratedPasswordHistory>(\n  GENERATOR_DISK,\n  \"passwordGeneratorHistory\",\n  {\n    deserializer: (value) => value,\n  },\n);\n","import Domain from \"../../../platform/models/domain/domain-base\";\n\n/** Enterprise policy for the password generator.\n * @see PolicyType.PasswordGenerator\n */\nexport class PasswordGeneratorPolicyOptions extends Domain {\n  /** The default kind of credential to generate */\n  defaultType: \"password\" | \"passphrase\" | \"\" = \"\";\n\n  /** The minimum length of generated passwords.\n   *  When this is less than or equal to zero, it is ignored.\n   *  If this is less than the total number of characters required by\n   *  the policy's other settings, then it is ignored.\n   *  This field is not used for passphrases.\n   */\n  minLength = 0;\n\n  /** When this is true, an uppercase character must be part of\n   *  the generated password.\n   *  This field is not used for passphrases.\n   */\n  useUppercase = false;\n\n  /** When this is true, a lowercase character must be part of\n   *  the generated password. This field is not used for passphrases.\n   */\n  useLowercase = false;\n\n  /** When this is true, at least one digit must be part of the generated\n   *  password. This field is not used for passphrases.\n   */\n  useNumbers = false;\n\n  /** The quantity of digits to include in the generated password.\n   *  When this is less than or equal to zero, it is ignored.\n   *  This field is not used for passphrases.\n   */\n  numberCount = 0;\n\n  /** When this is true, at least one digit must be part of the generated\n   *  password. This field is not used for passphrases.\n   */\n  useSpecial = false;\n\n  /** The quantity of special characters to include in the generated\n   *  password. When this is less than or equal to zero, it is ignored.\n   *  This field is not used for passphrases.\n   */\n  specialCount = 0;\n\n  /** The minimum number of words required by generated passphrases.\n   *  This field is not used for passwords.\n   */\n  minNumberWords = 0;\n\n  /** When this is true, the first letter of each word in the passphrase\n   *  is capitalized. This field is not used for passwords.\n   */\n  capitalize = false;\n\n  /** When this is true, a number is included within the passphrase.\n   *  This field is not used for passwords.\n   */\n  includeNumber = false;\n\n  /** Checks whether the policy affects the password generator.\n   * @returns True if at least one password or passphrase requirement has been set.\n   * If it returns False, then no requirements have been set and the policy should\n   * not be enforced.\n   */\n  inEffect() {\n    return (\n      this.defaultType !== \"\" ||\n      this.minLength > 0 ||\n      this.numberCount > 0 ||\n      this.specialCount > 0 ||\n      this.useUppercase ||\n      this.useLowercase ||\n      this.useNumbers ||\n      this.useSpecial ||\n      this.minNumberWords > 0 ||\n      this.capitalize ||\n      this.includeNumber\n    );\n  }\n\n  /** Creates a copy of the policy.\n   */\n  clone() {\n    const policy = new PasswordGeneratorPolicyOptions();\n    Object.assign(policy, this);\n    return policy;\n  }\n}\n","// EFF's Long Wordlist from https://www.eff.org/dice\nexport const EFFLongWordList = [\n  \"abacus\",\n  \"abdomen\",\n  \"abdominal\",\n  \"abide\",\n  \"abiding\",\n  \"ability\",\n  \"ablaze\",\n  \"able\",\n  \"abnormal\",\n  \"abrasion\",\n  \"abrasive\",\n  \"abreast\",\n  \"abridge\",\n  \"abroad\",\n  \"abruptly\",\n  \"absence\",\n  \"absentee\",\n  \"absently\",\n  \"absinthe\",\n  \"absolute\",\n  \"absolve\",\n  \"abstain\",\n  \"abstract\",\n  \"absurd\",\n  \"accent\",\n  \"acclaim\",\n  \"acclimate\",\n  \"accompany\",\n  \"account\",\n  \"accuracy\",\n  \"accurate\",\n  \"accustom\",\n  \"acetone\",\n  \"achiness\",\n  \"aching\",\n  \"acid\",\n  \"acorn\",\n  \"acquaint\",\n  \"acquire\",\n  \"acre\",\n  \"acrobat\",\n  \"acronym\",\n  \"acting\",\n  \"action\",\n  \"activate\",\n  \"activator\",\n  \"active\",\n  \"activism\",\n  \"activist\",\n  \"activity\",\n  \"actress\",\n  \"acts\",\n  \"acutely\",\n  \"acuteness\",\n  \"aeration\",\n  \"aerobics\",\n  \"aerosol\",\n  \"aerospace\",\n  \"afar\",\n  \"affair\",\n  \"affected\",\n  \"affecting\",\n  \"affection\",\n  \"affidavit\",\n  \"affiliate\",\n  \"affirm\",\n  \"affix\",\n  \"afflicted\",\n  \"affluent\",\n  \"afford\",\n  \"affront\",\n  \"aflame\",\n  \"afloat\",\n  \"aflutter\",\n  \"afoot\",\n  \"afraid\",\n  \"afterglow\",\n  \"afterlife\",\n  \"aftermath\",\n  \"aftermost\",\n  \"afternoon\",\n  \"aged\",\n  \"ageless\",\n  \"agency\",\n  \"agenda\",\n  \"agent\",\n  \"aggregate\",\n  \"aghast\",\n  \"agile\",\n  \"agility\",\n  \"aging\",\n  \"agnostic\",\n  \"agonize\",\n  \"agonizing\",\n  \"agony\",\n  \"agreeable\",\n  \"agreeably\",\n  \"agreed\",\n  \"agreeing\",\n  \"agreement\",\n  \"aground\",\n  \"ahead\",\n  \"ahoy\",\n  \"aide\",\n  \"aids\",\n  \"aim\",\n  \"ajar\",\n  \"alabaster\",\n  \"alarm\",\n  \"albatross\",\n  \"album\",\n  \"alfalfa\",\n  \"algebra\",\n  \"algorithm\",\n  \"alias\",\n  \"alibi\",\n  \"alienable\",\n  \"alienate\",\n  \"aliens\",\n  \"alike\",\n  \"alive\",\n  \"alkaline\",\n  \"alkalize\",\n  \"almanac\",\n  \"almighty\",\n  \"almost\",\n  \"aloe\",\n  \"aloft\",\n  \"aloha\",\n  \"alone\",\n  \"alongside\",\n  \"aloof\",\n  \"alphabet\",\n  \"alright\",\n  \"although\",\n  \"altitude\",\n  \"alto\",\n  \"aluminum\",\n  \"alumni\",\n  \"always\",\n  \"amaretto\",\n  \"amaze\",\n  \"amazingly\",\n  \"amber\",\n  \"ambiance\",\n  \"ambiguity\",\n  \"ambiguous\",\n  \"ambition\",\n  \"ambitious\",\n  \"ambulance\",\n  \"ambush\",\n  \"amendable\",\n  \"amendment\",\n  \"amends\",\n  \"amenity\",\n  \"amiable\",\n  \"amicably\",\n  \"amid\",\n  \"amigo\",\n  \"amino\",\n  \"amiss\",\n  \"ammonia\",\n  \"ammonium\",\n  \"amnesty\",\n  \"amniotic\",\n  \"among\",\n  \"amount\",\n  \"amperage\",\n  \"ample\",\n  \"amplifier\",\n  \"amplify\",\n  \"amply\",\n  \"amuck\",\n  \"amulet\",\n  \"amusable\",\n  \"amused\",\n  \"amusement\",\n  \"amuser\",\n  \"amusing\",\n  \"anaconda\",\n  \"anaerobic\",\n  \"anagram\",\n  \"anatomist\",\n  \"anatomy\",\n  \"anchor\",\n  \"anchovy\",\n  \"ancient\",\n  \"android\",\n  \"anemia\",\n  \"anemic\",\n  \"aneurism\",\n  \"anew\",\n  \"angelfish\",\n  \"angelic\",\n  \"anger\",\n  \"angled\",\n  \"angler\",\n  \"angles\",\n  \"angling\",\n  \"angrily\",\n  \"angriness\",\n  \"anguished\",\n  \"angular\",\n  \"animal\",\n  \"animate\",\n  \"animating\",\n  \"animation\",\n  \"animator\",\n  \"anime\",\n  \"animosity\",\n  \"ankle\",\n  \"annex\",\n  \"annotate\",\n  \"announcer\",\n  \"annoying\",\n  \"annually\",\n  \"annuity\",\n  \"anointer\",\n  \"another\",\n  \"answering\",\n  \"antacid\",\n  \"antarctic\",\n  \"anteater\",\n  \"antelope\",\n  \"antennae\",\n  \"anthem\",\n  \"anthill\",\n  \"anthology\",\n  \"antibody\",\n  \"antics\",\n  \"antidote\",\n  \"antihero\",\n  \"antiquely\",\n  \"antiques\",\n  \"antiquity\",\n  \"antirust\",\n  \"antitoxic\",\n  \"antitrust\",\n  \"antiviral\",\n  \"antivirus\",\n  \"antler\",\n  \"antonym\",\n  \"antsy\",\n  \"anvil\",\n  \"anybody\",\n  \"anyhow\",\n  \"anymore\",\n  \"anyone\",\n  \"anyplace\",\n  \"anything\",\n  \"anytime\",\n  \"anyway\",\n  \"anywhere\",\n  \"aorta\",\n  \"apache\",\n  \"apostle\",\n  \"appealing\",\n  \"appear\",\n  \"appease\",\n  \"appeasing\",\n  \"appendage\",\n  \"appendix\",\n  \"appetite\",\n  \"appetizer\",\n  \"applaud\",\n  \"applause\",\n  \"apple\",\n  \"appliance\",\n  \"applicant\",\n  \"applied\",\n  \"apply\",\n  \"appointee\",\n  \"appraisal\",\n  \"appraiser\",\n  \"apprehend\",\n  \"approach\",\n  \"approval\",\n  \"approve\",\n  \"apricot\",\n  \"april\",\n  \"apron\",\n  \"aptitude\",\n  \"aptly\",\n  \"aqua\",\n  \"aqueduct\",\n  \"arbitrary\",\n  \"arbitrate\",\n  \"ardently\",\n  \"area\",\n  \"arena\",\n  \"arguable\",\n  \"arguably\",\n  \"argue\",\n  \"arise\",\n  \"armadillo\",\n  \"armband\",\n  \"armchair\",\n  \"armed\",\n  \"armful\",\n  \"armhole\",\n  \"arming\",\n  \"armless\",\n  \"armoire\",\n  \"armored\",\n  \"armory\",\n  \"armrest\",\n  \"army\",\n  \"aroma\",\n  \"arose\",\n  \"around\",\n  \"arousal\",\n  \"arrange\",\n  \"array\",\n  \"arrest\",\n  \"arrival\",\n  \"arrive\",\n  \"arrogance\",\n  \"arrogant\",\n  \"arson\",\n  \"art\",\n  \"ascend\",\n  \"ascension\",\n  \"ascent\",\n  \"ascertain\",\n  \"ashamed\",\n  \"ashen\",\n  \"ashes\",\n  \"ashy\",\n  \"aside\",\n  \"askew\",\n  \"asleep\",\n  \"asparagus\",\n  \"aspect\",\n  \"aspirate\",\n  \"aspire\",\n  \"aspirin\",\n  \"astonish\",\n  \"astound\",\n  \"astride\",\n  \"astrology\",\n  \"astronaut\",\n  \"astronomy\",\n  \"astute\",\n  \"atlantic\",\n  \"atlas\",\n  \"atom\",\n  \"atonable\",\n  \"atop\",\n  \"atrium\",\n  \"atrocious\",\n  \"atrophy\",\n  \"attach\",\n  \"attain\",\n  \"attempt\",\n  \"attendant\",\n  \"attendee\",\n  \"attention\",\n  \"attentive\",\n  \"attest\",\n  \"attic\",\n  \"attire\",\n  \"attitude\",\n  \"attractor\",\n  \"attribute\",\n  \"atypical\",\n  \"auction\",\n  \"audacious\",\n  \"audacity\",\n  \"audible\",\n  \"audibly\",\n  \"audience\",\n  \"audio\",\n  \"audition\",\n  \"augmented\",\n  \"august\",\n  \"authentic\",\n  \"author\",\n  \"autism\",\n  \"autistic\",\n  \"autograph\",\n  \"automaker\",\n  \"automated\",\n  \"automatic\",\n  \"autopilot\",\n  \"available\",\n  \"avalanche\",\n  \"avatar\",\n  \"avenge\",\n  \"avenging\",\n  \"avenue\",\n  \"average\",\n  \"aversion\",\n  \"avert\",\n  \"aviation\",\n  \"aviator\",\n  \"avid\",\n  \"avoid\",\n  \"await\",\n  \"awaken\",\n  \"award\",\n  \"aware\",\n  \"awhile\",\n  \"awkward\",\n  \"awning\",\n  \"awoke\",\n  \"awry\",\n  \"axis\",\n  \"babble\",\n  \"babbling\",\n  \"babied\",\n  \"baboon\",\n  \"backache\",\n  \"backboard\",\n  \"backboned\",\n  \"backdrop\",\n  \"backed\",\n  \"backer\",\n  \"backfield\",\n  \"backfire\",\n  \"backhand\",\n  \"backing\",\n  \"backlands\",\n  \"backlash\",\n  \"backless\",\n  \"backlight\",\n  \"backlit\",\n  \"backlog\",\n  \"backpack\",\n  \"backpedal\",\n  \"backrest\",\n  \"backroom\",\n  \"backshift\",\n  \"backside\",\n  \"backslid\",\n  \"backspace\",\n  \"backspin\",\n  \"backstab\",\n  \"backstage\",\n  \"backtalk\",\n  \"backtrack\",\n  \"backup\",\n  \"backward\",\n  \"backwash\",\n  \"backwater\",\n  \"backyard\",\n  \"bacon\",\n  \"bacteria\",\n  \"bacterium\",\n  \"badass\",\n  \"badge\",\n  \"badland\",\n  \"badly\",\n  \"badness\",\n  \"baffle\",\n  \"baffling\",\n  \"bagel\",\n  \"bagful\",\n  \"baggage\",\n  \"bagged\",\n  \"baggie\",\n  \"bagginess\",\n  \"bagging\",\n  \"baggy\",\n  \"bagpipe\",\n  \"baguette\",\n  \"baked\",\n  \"bakery\",\n  \"bakeshop\",\n  \"baking\",\n  \"balance\",\n  \"balancing\",\n  \"balcony\",\n  \"balmy\",\n  \"balsamic\",\n  \"bamboo\",\n  \"banana\",\n  \"banish\",\n  \"banister\",\n  \"banjo\",\n  \"bankable\",\n  \"bankbook\",\n  \"banked\",\n  \"banker\",\n  \"banking\",\n  \"banknote\",\n  \"bankroll\",\n  \"banner\",\n  \"bannister\",\n  \"banshee\",\n  \"banter\",\n  \"barbecue\",\n  \"barbed\",\n  \"barbell\",\n  \"barber\",\n  \"barcode\",\n  \"barge\",\n  \"bargraph\",\n  \"barista\",\n  \"baritone\",\n  \"barley\",\n  \"barmaid\",\n  \"barman\",\n  \"barn\",\n  \"barometer\",\n  \"barrack\",\n  \"barracuda\",\n  \"barrel\",\n  \"barrette\",\n  \"barricade\",\n  \"barrier\",\n  \"barstool\",\n  \"bartender\",\n  \"barterer\",\n  \"bash\",\n  \"basically\",\n  \"basics\",\n  \"basil\",\n  \"basin\",\n  \"basis\",\n  \"basket\",\n  \"batboy\",\n  \"batch\",\n  \"bath\",\n  \"baton\",\n  \"bats\",\n  \"battalion\",\n  \"battered\",\n  \"battering\",\n  \"battery\",\n  \"batting\",\n  \"battle\",\n  \"bauble\",\n  \"bazooka\",\n  \"blabber\",\n  \"bladder\",\n  \"blade\",\n  \"blah\",\n  \"blame\",\n  \"blaming\",\n  \"blanching\",\n  \"blandness\",\n  \"blank\",\n  \"blaspheme\",\n  \"blasphemy\",\n  \"blast\",\n  \"blatancy\",\n  \"blatantly\",\n  \"blazer\",\n  \"blazing\",\n  \"bleach\",\n  \"bleak\",\n  \"bleep\",\n  \"blemish\",\n  \"blend\",\n  \"bless\",\n  \"blighted\",\n  \"blimp\",\n  \"bling\",\n  \"blinked\",\n  \"blinker\",\n  \"blinking\",\n  \"blinks\",\n  \"blip\",\n  \"blissful\",\n  \"blitz\",\n  \"blizzard\",\n  \"bloated\",\n  \"bloating\",\n  \"blob\",\n  \"blog\",\n  \"bloomers\",\n  \"blooming\",\n  \"blooper\",\n  \"blot\",\n  \"blouse\",\n  \"blubber\",\n  \"bluff\",\n  \"bluish\",\n  \"blunderer\",\n  \"blunt\",\n  \"blurb\",\n  \"blurred\",\n  \"blurry\",\n  \"blurt\",\n  \"blush\",\n  \"blustery\",\n  \"boaster\",\n  \"boastful\",\n  \"boasting\",\n  \"boat\",\n  \"bobbed\",\n  \"bobbing\",\n  \"bobble\",\n  \"bobcat\",\n  \"bobsled\",\n  \"bobtail\",\n  \"bodacious\",\n  \"body\",\n  \"bogged\",\n  \"boggle\",\n  \"bogus\",\n  \"boil\",\n  \"bok\",\n  \"bolster\",\n  \"bolt\",\n  \"bonanza\",\n  \"bonded\",\n  \"bonding\",\n  \"bondless\",\n  \"boned\",\n  \"bonehead\",\n  \"boneless\",\n  \"bonelike\",\n  \"boney\",\n  \"bonfire\",\n  \"bonnet\",\n  \"bonsai\",\n  \"bonus\",\n  \"bony\",\n  \"boogeyman\",\n  \"boogieman\",\n  \"book\",\n  \"boondocks\",\n  \"booted\",\n  \"booth\",\n  \"bootie\",\n  \"booting\",\n  \"bootlace\",\n  \"bootleg\",\n  \"boots\",\n  \"boozy\",\n  \"borax\",\n  \"boring\",\n  \"borough\",\n  \"borrower\",\n  \"borrowing\",\n  \"boss\",\n  \"botanical\",\n  \"botanist\",\n  \"botany\",\n  \"botch\",\n  \"both\",\n  \"bottle\",\n  \"bottling\",\n  \"bottom\",\n  \"bounce\",\n  \"bouncing\",\n  \"bouncy\",\n  \"bounding\",\n  \"boundless\",\n  \"bountiful\",\n  \"bovine\",\n  \"boxcar\",\n  \"boxer\",\n  \"boxing\",\n  \"boxlike\",\n  \"boxy\",\n  \"breach\",\n  \"breath\",\n  \"breeches\",\n  \"breeching\",\n  \"breeder\",\n  \"breeding\",\n  \"breeze\",\n  \"breezy\",\n  \"brethren\",\n  \"brewery\",\n  \"brewing\",\n  \"briar\",\n  \"bribe\",\n  \"brick\",\n  \"bride\",\n  \"bridged\",\n  \"brigade\",\n  \"bright\",\n  \"brilliant\",\n  \"brim\",\n  \"bring\",\n  \"brink\",\n  \"brisket\",\n  \"briskly\",\n  \"briskness\",\n  \"bristle\",\n  \"brittle\",\n  \"broadband\",\n  \"broadcast\",\n  \"broaden\",\n  \"broadly\",\n  \"broadness\",\n  \"broadside\",\n  \"broadways\",\n  \"broiler\",\n  \"broiling\",\n  \"broken\",\n  \"broker\",\n  \"bronchial\",\n  \"bronco\",\n  \"bronze\",\n  \"bronzing\",\n  \"brook\",\n  \"broom\",\n  \"brought\",\n  \"browbeat\",\n  \"brownnose\",\n  \"browse\",\n  \"browsing\",\n  \"bruising\",\n  \"brunch\",\n  \"brunette\",\n  \"brunt\",\n  \"brush\",\n  \"brussels\",\n  \"brute\",\n  \"brutishly\",\n  \"bubble\",\n  \"bubbling\",\n  \"bubbly\",\n  \"buccaneer\",\n  \"bucked\",\n  \"bucket\",\n  \"buckle\",\n  \"buckshot\",\n  \"buckskin\",\n  \"bucktooth\",\n  \"buckwheat\",\n  \"buddhism\",\n  \"buddhist\",\n  \"budding\",\n  \"buddy\",\n  \"budget\",\n  \"buffalo\",\n  \"buffed\",\n  \"buffer\",\n  \"buffing\",\n  \"buffoon\",\n  \"buggy\",\n  \"bulb\",\n  \"bulge\",\n  \"bulginess\",\n  \"bulgur\",\n  \"bulk\",\n  \"bulldog\",\n  \"bulldozer\",\n  \"bullfight\",\n  \"bullfrog\",\n  \"bullhorn\",\n  \"bullion\",\n  \"bullish\",\n  \"bullpen\",\n  \"bullring\",\n  \"bullseye\",\n  \"bullwhip\",\n  \"bully\",\n  \"bunch\",\n  \"bundle\",\n  \"bungee\",\n  \"bunion\",\n  \"bunkbed\",\n  \"bunkhouse\",\n  \"bunkmate\",\n  \"bunny\",\n  \"bunt\",\n  \"busboy\",\n  \"bush\",\n  \"busily\",\n  \"busload\",\n  \"bust\",\n  \"busybody\",\n  \"buzz\",\n  \"cabana\",\n  \"cabbage\",\n  \"cabbie\",\n  \"cabdriver\",\n  \"cable\",\n  \"caboose\",\n  \"cache\",\n  \"cackle\",\n  \"cacti\",\n  \"cactus\",\n  \"caddie\",\n  \"caddy\",\n  \"cadet\",\n  \"cadillac\",\n  \"cadmium\",\n  \"cage\",\n  \"cahoots\",\n  \"cake\",\n  \"calamari\",\n  \"calamity\",\n  \"calcium\",\n  \"calculate\",\n  \"calculus\",\n  \"caliber\",\n  \"calibrate\",\n  \"calm\",\n  \"caloric\",\n  \"calorie\",\n  \"calzone\",\n  \"camcorder\",\n  \"cameo\",\n  \"camera\",\n  \"camisole\",\n  \"camper\",\n  \"campfire\",\n  \"camping\",\n  \"campsite\",\n  \"campus\",\n  \"canal\",\n  \"canary\",\n  \"cancel\",\n  \"candied\",\n  \"candle\",\n  \"candy\",\n  \"cane\",\n  \"canine\",\n  \"canister\",\n  \"cannabis\",\n  \"canned\",\n  \"canning\",\n  \"cannon\",\n  \"cannot\",\n  \"canola\",\n  \"canon\",\n  \"canopener\",\n  \"canopy\",\n  \"canteen\",\n  \"canyon\",\n  \"capable\",\n  \"capably\",\n  \"capacity\",\n  \"cape\",\n  \"capillary\",\n  \"capital\",\n  \"capitol\",\n  \"capped\",\n  \"capricorn\",\n  \"capsize\",\n  \"capsule\",\n  \"caption\",\n  \"captivate\",\n  \"captive\",\n  \"captivity\",\n  \"capture\",\n  \"caramel\",\n  \"carat\",\n  \"caravan\",\n  \"carbon\",\n  \"cardboard\",\n  \"carded\",\n  \"cardiac\",\n  \"cardigan\",\n  \"cardinal\",\n  \"cardstock\",\n  \"carefully\",\n  \"caregiver\",\n  \"careless\",\n  \"caress\",\n  \"caretaker\",\n  \"cargo\",\n  \"caring\",\n  \"carless\",\n  \"carload\",\n  \"carmaker\",\n  \"carnage\",\n  \"carnation\",\n  \"carnival\",\n  \"carnivore\",\n  \"carol\",\n  \"carpenter\",\n  \"carpentry\",\n  \"carpool\",\n  \"carport\",\n  \"carried\",\n  \"carrot\",\n  \"carrousel\",\n  \"carry\",\n  \"cartel\",\n  \"cartload\",\n  \"carton\",\n  \"cartoon\",\n  \"cartridge\",\n  \"cartwheel\",\n  \"carve\",\n  \"carving\",\n  \"carwash\",\n  \"cascade\",\n  \"case\",\n  \"cash\",\n  \"casing\",\n  \"casino\",\n  \"casket\",\n  \"cassette\",\n  \"casually\",\n  \"casualty\",\n  \"catacomb\",\n  \"catalog\",\n  \"catalyst\",\n  \"catalyze\",\n  \"catapult\",\n  \"cataract\",\n  \"catatonic\",\n  \"catcall\",\n  \"catchable\",\n  \"catcher\",\n  \"catching\",\n  \"catchy\",\n  \"caterer\",\n  \"catering\",\n  \"catfight\",\n  \"catfish\",\n  \"cathedral\",\n  \"cathouse\",\n  \"catlike\",\n  \"catnap\",\n  \"catnip\",\n  \"catsup\",\n  \"cattail\",\n  \"cattishly\",\n  \"cattle\",\n  \"catty\",\n  \"catwalk\",\n  \"caucasian\",\n  \"caucus\",\n  \"causal\",\n  \"causation\",\n  \"cause\",\n  \"causing\",\n  \"cauterize\",\n  \"caution\",\n  \"cautious\",\n  \"cavalier\",\n  \"cavalry\",\n  \"caviar\",\n  \"cavity\",\n  \"cedar\",\n  \"celery\",\n  \"celestial\",\n  \"celibacy\",\n  \"celibate\",\n  \"celtic\",\n  \"cement\",\n  \"census\",\n  \"ceramics\",\n  \"ceremony\",\n  \"certainly\",\n  \"certainty\",\n  \"certified\",\n  \"certify\",\n  \"cesarean\",\n  \"cesspool\",\n  \"chafe\",\n  \"chaffing\",\n  \"chain\",\n  \"chair\",\n  \"chalice\",\n  \"challenge\",\n  \"chamber\",\n  \"chamomile\",\n  \"champion\",\n  \"chance\",\n  \"change\",\n  \"channel\",\n  \"chant\",\n  \"chaos\",\n  \"chaperone\",\n  \"chaplain\",\n  \"chapped\",\n  \"chaps\",\n  \"chapter\",\n  \"character\",\n  \"charbroil\",\n  \"charcoal\",\n  \"charger\",\n  \"charging\",\n  \"chariot\",\n  \"charity\",\n  \"charm\",\n  \"charred\",\n  \"charter\",\n  \"charting\",\n  \"chase\",\n  \"chasing\",\n  \"chaste\",\n  \"chastise\",\n  \"chastity\",\n  \"chatroom\",\n  \"chatter\",\n  \"chatting\",\n  \"chatty\",\n  \"cheating\",\n  \"cheddar\",\n  \"cheek\",\n  \"cheer\",\n  \"cheese\",\n  \"cheesy\",\n  \"chef\",\n  \"chemicals\",\n  \"chemist\",\n  \"chemo\",\n  \"cherisher\",\n  \"cherub\",\n  \"chess\",\n  \"chest\",\n  \"chevron\",\n  \"chevy\",\n  \"chewable\",\n  \"chewer\",\n  \"chewing\",\n  \"chewy\",\n  \"chief\",\n  \"chihuahua\",\n  \"childcare\",\n  \"childhood\",\n  \"childish\",\n  \"childless\",\n  \"childlike\",\n  \"chili\",\n  \"chill\",\n  \"chimp\",\n  \"chip\",\n  \"chirping\",\n  \"chirpy\",\n  \"chitchat\",\n  \"chivalry\",\n  \"chive\",\n  \"chloride\",\n  \"chlorine\",\n  \"choice\",\n  \"chokehold\",\n  \"choking\",\n  \"chomp\",\n  \"chooser\",\n  \"choosing\",\n  \"choosy\",\n  \"chop\",\n  \"chosen\",\n  \"chowder\",\n  \"chowtime\",\n  \"chrome\",\n  \"chubby\",\n  \"chuck\",\n  \"chug\",\n  \"chummy\",\n  \"chump\",\n  \"chunk\",\n  \"churn\",\n  \"chute\",\n  \"cider\",\n  \"cilantro\",\n  \"cinch\",\n  \"cinema\",\n  \"cinnamon\",\n  \"circle\",\n  \"circling\",\n  \"circular\",\n  \"circulate\",\n  \"circus\",\n  \"citable\",\n  \"citadel\",\n  \"citation\",\n  \"citizen\",\n  \"citric\",\n  \"citrus\",\n  \"city\",\n  \"civic\",\n  \"civil\",\n  \"clad\",\n  \"claim\",\n  \"clambake\",\n  \"clammy\",\n  \"clamor\",\n  \"clamp\",\n  \"clamshell\",\n  \"clang\",\n  \"clanking\",\n  \"clapped\",\n  \"clapper\",\n  \"clapping\",\n  \"clarify\",\n  \"clarinet\",\n  \"clarity\",\n  \"clash\",\n  \"clasp\",\n  \"class\",\n  \"clatter\",\n  \"clause\",\n  \"clavicle\",\n  \"claw\",\n  \"clay\",\n  \"clean\",\n  \"clear\",\n  \"cleat\",\n  \"cleaver\",\n  \"cleft\",\n  \"clench\",\n  \"clergyman\",\n  \"clerical\",\n  \"clerk\",\n  \"clever\",\n  \"clicker\",\n  \"client\",\n  \"climate\",\n  \"climatic\",\n  \"cling\",\n  \"clinic\",\n  \"clinking\",\n  \"clip\",\n  \"clique\",\n  \"cloak\",\n  \"clobber\",\n  \"clock\",\n  \"clone\",\n  \"cloning\",\n  \"closable\",\n  \"closure\",\n  \"clothes\",\n  \"clothing\",\n  \"cloud\",\n  \"clover\",\n  \"clubbed\",\n  \"clubbing\",\n  \"clubhouse\",\n  \"clump\",\n  \"clumsily\",\n  \"clumsy\",\n  \"clunky\",\n  \"clustered\",\n  \"clutch\",\n  \"clutter\",\n  \"coach\",\n  \"coagulant\",\n  \"coastal\",\n  \"coaster\",\n  \"coasting\",\n  \"coastland\",\n  \"coastline\",\n  \"coat\",\n  \"coauthor\",\n  \"cobalt\",\n  \"cobbler\",\n  \"cobweb\",\n  \"cocoa\",\n  \"coconut\",\n  \"cod\",\n  \"coeditor\",\n  \"coerce\",\n  \"coexist\",\n  \"coffee\",\n  \"cofounder\",\n  \"cognition\",\n  \"cognitive\",\n  \"cogwheel\",\n  \"coherence\",\n  \"coherent\",\n  \"cohesive\",\n  \"coil\",\n  \"coke\",\n  \"cola\",\n  \"cold\",\n  \"coleslaw\",\n  \"coliseum\",\n  \"collage\",\n  \"collapse\",\n  \"collar\",\n  \"collected\",\n  \"collector\",\n  \"collide\",\n  \"collie\",\n  \"collision\",\n  \"colonial\",\n  \"colonist\",\n  \"colonize\",\n  \"colony\",\n  \"colossal\",\n  \"colt\",\n  \"coma\",\n  \"come\",\n  \"comfort\",\n  \"comfy\",\n  \"comic\",\n  \"coming\",\n  \"comma\",\n  \"commence\",\n  \"commend\",\n  \"comment\",\n  \"commerce\",\n  \"commode\",\n  \"commodity\",\n  \"commodore\",\n  \"common\",\n  \"commotion\",\n  \"commute\",\n  \"commuting\",\n  \"compacted\",\n  \"compacter\",\n  \"compactly\",\n  \"compactor\",\n  \"companion\",\n  \"company\",\n  \"compare\",\n  \"compel\",\n  \"compile\",\n  \"comply\",\n  \"component\",\n  \"composed\",\n  \"composer\",\n  \"composite\",\n  \"compost\",\n  \"composure\",\n  \"compound\",\n  \"compress\",\n  \"comprised\",\n  \"computer\",\n  \"computing\",\n  \"comrade\",\n  \"concave\",\n  \"conceal\",\n  \"conceded\",\n  \"concept\",\n  \"concerned\",\n  \"concert\",\n  \"conch\",\n  \"concierge\",\n  \"concise\",\n  \"conclude\",\n  \"concrete\",\n  \"concur\",\n  \"condense\",\n  \"condiment\",\n  \"condition\",\n  \"condone\",\n  \"conducive\",\n  \"conductor\",\n  \"conduit\",\n  \"cone\",\n  \"confess\",\n  \"confetti\",\n  \"confidant\",\n  \"confident\",\n  \"confider\",\n  \"confiding\",\n  \"configure\",\n  \"confined\",\n  \"confining\",\n  \"confirm\",\n  \"conflict\",\n  \"conform\",\n  \"confound\",\n  \"confront\",\n  \"confused\",\n  \"confusing\",\n  \"confusion\",\n  \"congenial\",\n  \"congested\",\n  \"congrats\",\n  \"congress\",\n  \"conical\",\n  \"conjoined\",\n  \"conjure\",\n  \"conjuror\",\n  \"connected\",\n  \"connector\",\n  \"consensus\",\n  \"consent\",\n  \"console\",\n  \"consoling\",\n  \"consonant\",\n  \"constable\",\n  \"constant\",\n  \"constrain\",\n  \"constrict\",\n  \"construct\",\n  \"consult\",\n  \"consumer\",\n  \"consuming\",\n  \"contact\",\n  \"container\",\n  \"contempt\",\n  \"contend\",\n  \"contented\",\n  \"contently\",\n  \"contents\",\n  \"contest\",\n  \"context\",\n  \"contort\",\n  \"contour\",\n  \"contrite\",\n  \"control\",\n  \"contusion\",\n  \"convene\",\n  \"convent\",\n  \"copartner\",\n  \"cope\",\n  \"copied\",\n  \"copier\",\n  \"copilot\",\n  \"coping\",\n  \"copious\",\n  \"copper\",\n  \"copy\",\n  \"coral\",\n  \"cork\",\n  \"cornball\",\n  \"cornbread\",\n  \"corncob\",\n  \"cornea\",\n  \"corned\",\n  \"corner\",\n  \"cornfield\",\n  \"cornflake\",\n  \"cornhusk\",\n  \"cornmeal\",\n  \"cornstalk\",\n  \"corny\",\n  \"coronary\",\n  \"coroner\",\n  \"corporal\",\n  \"corporate\",\n  \"corral\",\n  \"correct\",\n  \"corridor\",\n  \"corrode\",\n  \"corroding\",\n  \"corrosive\",\n  \"corsage\",\n  \"corset\",\n  \"cortex\",\n  \"cosigner\",\n  \"cosmetics\",\n  \"cosmic\",\n  \"cosmos\",\n  \"cosponsor\",\n  \"cost\",\n  \"cottage\",\n  \"cotton\",\n  \"couch\",\n  \"cough\",\n  \"could\",\n  \"countable\",\n  \"countdown\",\n  \"counting\",\n  \"countless\",\n  \"country\",\n  \"county\",\n  \"courier\",\n  \"covenant\",\n  \"cover\",\n  \"coveted\",\n  \"coveting\",\n  \"coyness\",\n  \"cozily\",\n  \"coziness\",\n  \"cozy\",\n  \"crabbing\",\n  \"crabgrass\",\n  \"crablike\",\n  \"crabmeat\",\n  \"cradle\",\n  \"cradling\",\n  \"crafter\",\n  \"craftily\",\n  \"craftsman\",\n  \"craftwork\",\n  \"crafty\",\n  \"cramp\",\n  \"cranberry\",\n  \"crane\",\n  \"cranial\",\n  \"cranium\",\n  \"crank\",\n  \"crate\",\n  \"crave\",\n  \"craving\",\n  \"crawfish\",\n  \"crawlers\",\n  \"crawling\",\n  \"crayfish\",\n  \"crayon\",\n  \"crazed\",\n  \"crazily\",\n  \"craziness\",\n  \"crazy\",\n  \"creamed\",\n  \"creamer\",\n  \"creamlike\",\n  \"crease\",\n  \"creasing\",\n  \"creatable\",\n  \"create\",\n  \"creation\",\n  \"creative\",\n  \"creature\",\n  \"credible\",\n  \"credibly\",\n  \"credit\",\n  \"creed\",\n  \"creme\",\n  \"creole\",\n  \"crepe\",\n  \"crept\",\n  \"crescent\",\n  \"crested\",\n  \"cresting\",\n  \"crestless\",\n  \"crevice\",\n  \"crewless\",\n  \"crewman\",\n  \"crewmate\",\n  \"crib\",\n  \"cricket\",\n  \"cried\",\n  \"crier\",\n  \"crimp\",\n  \"crimson\",\n  \"cringe\",\n  \"cringing\",\n  \"crinkle\",\n  \"crinkly\",\n  \"crisped\",\n  \"crisping\",\n  \"crisply\",\n  \"crispness\",\n  \"crispy\",\n  \"criteria\",\n  \"critter\",\n  \"croak\",\n  \"crock\",\n  \"crook\",\n  \"croon\",\n  \"crop\",\n  \"cross\",\n  \"crouch\",\n  \"crouton\",\n  \"crowbar\",\n  \"crowd\",\n  \"crown\",\n  \"crucial\",\n  \"crudely\",\n  \"crudeness\",\n  \"cruelly\",\n  \"cruelness\",\n  \"cruelty\",\n  \"crumb\",\n  \"crummiest\",\n  \"crummy\",\n  \"crumpet\",\n  \"crumpled\",\n  \"cruncher\",\n  \"crunching\",\n  \"crunchy\",\n  \"crusader\",\n  \"crushable\",\n  \"crushed\",\n  \"crusher\",\n  \"crushing\",\n  \"crust\",\n  \"crux\",\n  \"crying\",\n  \"cryptic\",\n  \"crystal\",\n  \"cubbyhole\",\n  \"cube\",\n  \"cubical\",\n  \"cubicle\",\n  \"cucumber\",\n  \"cuddle\",\n  \"cuddly\",\n  \"cufflink\",\n  \"culinary\",\n  \"culminate\",\n  \"culpable\",\n  \"culprit\",\n  \"cultivate\",\n  \"cultural\",\n  \"culture\",\n  \"cupbearer\",\n  \"cupcake\",\n  \"cupid\",\n  \"cupped\",\n  \"cupping\",\n  \"curable\",\n  \"curator\",\n  \"curdle\",\n  \"cure\",\n  \"curfew\",\n  \"curing\",\n  \"curled\",\n  \"curler\",\n  \"curliness\",\n  \"curling\",\n  \"curly\",\n  \"curry\",\n  \"curse\",\n  \"cursive\",\n  \"cursor\",\n  \"curtain\",\n  \"curtly\",\n  \"curtsy\",\n  \"curvature\",\n  \"curve\",\n  \"curvy\",\n  \"cushy\",\n  \"cusp\",\n  \"cussed\",\n  \"custard\",\n  \"custodian\",\n  \"custody\",\n  \"customary\",\n  \"customer\",\n  \"customize\",\n  \"customs\",\n  \"cut\",\n  \"cycle\",\n  \"cyclic\",\n  \"cycling\",\n  \"cyclist\",\n  \"cylinder\",\n  \"cymbal\",\n  \"cytoplasm\",\n  \"cytoplast\",\n  \"dab\",\n  \"dad\",\n  \"daffodil\",\n  \"dagger\",\n  \"daily\",\n  \"daintily\",\n  \"dainty\",\n  \"dairy\",\n  \"daisy\",\n  \"dallying\",\n  \"dance\",\n  \"dancing\",\n  \"dandelion\",\n  \"dander\",\n  \"dandruff\",\n  \"dandy\",\n  \"danger\",\n  \"dangle\",\n  \"dangling\",\n  \"daredevil\",\n  \"dares\",\n  \"daringly\",\n  \"darkened\",\n  \"darkening\",\n  \"darkish\",\n  \"darkness\",\n  \"darkroom\",\n  \"darling\",\n  \"darn\",\n  \"dart\",\n  \"darwinism\",\n  \"dash\",\n  \"dastardly\",\n  \"data\",\n  \"datebook\",\n  \"dating\",\n  \"daughter\",\n  \"daunting\",\n  \"dawdler\",\n  \"dawn\",\n  \"daybed\",\n  \"daybreak\",\n  \"daycare\",\n  \"daydream\",\n  \"daylight\",\n  \"daylong\",\n  \"dayroom\",\n  \"daytime\",\n  \"dazzler\",\n  \"dazzling\",\n  \"deacon\",\n  \"deafening\",\n  \"deafness\",\n  \"dealer\",\n  \"dealing\",\n  \"dealmaker\",\n  \"dealt\",\n  \"dean\",\n  \"debatable\",\n  \"debate\",\n  \"debating\",\n  \"debit\",\n  \"debrief\",\n  \"debtless\",\n  \"debtor\",\n  \"debug\",\n  \"debunk\",\n  \"decade\",\n  \"decaf\",\n  \"decal\",\n  \"decathlon\",\n  \"decay\",\n  \"deceased\",\n  \"deceit\",\n  \"deceiver\",\n  \"deceiving\",\n  \"december\",\n  \"decency\",\n  \"decent\",\n  \"deception\",\n  \"deceptive\",\n  \"decibel\",\n  \"decidable\",\n  \"decimal\",\n  \"decimeter\",\n  \"decipher\",\n  \"deck\",\n  \"declared\",\n  \"decline\",\n  \"decode\",\n  \"decompose\",\n  \"decorated\",\n  \"decorator\",\n  \"decoy\",\n  \"decrease\",\n  \"decree\",\n  \"dedicate\",\n  \"dedicator\",\n  \"deduce\",\n  \"deduct\",\n  \"deed\",\n  \"deem\",\n  \"deepen\",\n  \"deeply\",\n  \"deepness\",\n  \"deface\",\n  \"defacing\",\n  \"defame\",\n  \"default\",\n  \"defeat\",\n  \"defection\",\n  \"defective\",\n  \"defendant\",\n  \"defender\",\n  \"defense\",\n  \"defensive\",\n  \"deferral\",\n  \"deferred\",\n  \"defiance\",\n  \"defiant\",\n  \"defile\",\n  \"defiling\",\n  \"define\",\n  \"definite\",\n  \"deflate\",\n  \"deflation\",\n  \"deflator\",\n  \"deflected\",\n  \"deflector\",\n  \"defog\",\n  \"deforest\",\n  \"defraud\",\n  \"defrost\",\n  \"deftly\",\n  \"defuse\",\n  \"defy\",\n  \"degraded\",\n  \"degrading\",\n  \"degrease\",\n  \"degree\",\n  \"dehydrate\",\n  \"deity\",\n  \"dejected\",\n  \"delay\",\n  \"delegate\",\n  \"delegator\",\n  \"delete\",\n  \"deletion\",\n  \"delicacy\",\n  \"delicate\",\n  \"delicious\",\n  \"delighted\",\n  \"delirious\",\n  \"delirium\",\n  \"deliverer\",\n  \"delivery\",\n  \"delouse\",\n  \"delta\",\n  \"deluge\",\n  \"delusion\",\n  \"deluxe\",\n  \"demanding\",\n  \"demeaning\",\n  \"demeanor\",\n  \"demise\",\n  \"democracy\",\n  \"democrat\",\n  \"demote\",\n  \"demotion\",\n  \"demystify\",\n  \"denatured\",\n  \"deniable\",\n  \"denial\",\n  \"denim\",\n  \"denote\",\n  \"dense\",\n  \"density\",\n  \"dental\",\n  \"dentist\",\n  \"denture\",\n  \"deny\",\n  \"deodorant\",\n  \"deodorize\",\n  \"departed\",\n  \"departure\",\n  \"depict\",\n  \"deplete\",\n  \"depletion\",\n  \"deplored\",\n  \"deploy\",\n  \"deport\",\n  \"depose\",\n  \"depraved\",\n  \"depravity\",\n  \"deprecate\",\n  \"depress\",\n  \"deprive\",\n  \"depth\",\n  \"deputize\",\n  \"deputy\",\n  \"derail\",\n  \"deranged\",\n  \"derby\",\n  \"derived\",\n  \"desecrate\",\n  \"deserve\",\n  \"deserving\",\n  \"designate\",\n  \"designed\",\n  \"designer\",\n  \"designing\",\n  \"deskbound\",\n  \"desktop\",\n  \"deskwork\",\n  \"desolate\",\n  \"despair\",\n  \"despise\",\n  \"despite\",\n  \"destiny\",\n  \"destitute\",\n  \"destruct\",\n  \"detached\",\n  \"detail\",\n  \"detection\",\n  \"detective\",\n  \"detector\",\n  \"detention\",\n  \"detergent\",\n  \"detest\",\n  \"detonate\",\n  \"detonator\",\n  \"detoxify\",\n  \"detract\",\n  \"deuce\",\n  \"devalue\",\n  \"deviancy\",\n  \"deviant\",\n  \"deviate\",\n  \"deviation\",\n  \"deviator\",\n  \"device\",\n  \"devious\",\n  \"devotedly\",\n  \"devotee\",\n  \"devotion\",\n  \"devourer\",\n  \"devouring\",\n  \"devoutly\",\n  \"dexterity\",\n  \"dexterous\",\n  \"diabetes\",\n  \"diabetic\",\n  \"diabolic\",\n  \"diagnoses\",\n  \"diagnosis\",\n  \"diagram\",\n  \"dial\",\n  \"diameter\",\n  \"diaper\",\n  \"diaphragm\",\n  \"diary\",\n  \"dice\",\n  \"dicing\",\n  \"dictate\",\n  \"dictation\",\n  \"dictator\",\n  \"difficult\",\n  \"diffused\",\n  \"diffuser\",\n  \"diffusion\",\n  \"diffusive\",\n  \"dig\",\n  \"dilation\",\n  \"diligence\",\n  \"diligent\",\n  \"dill\",\n  \"dilute\",\n  \"dime\",\n  \"diminish\",\n  \"dimly\",\n  \"dimmed\",\n  \"dimmer\",\n  \"dimness\",\n  \"dimple\",\n  \"diner\",\n  \"dingbat\",\n  \"dinghy\",\n  \"dinginess\",\n  \"dingo\",\n  \"dingy\",\n  \"dining\",\n  \"dinner\",\n  \"diocese\",\n  \"dioxide\",\n  \"diploma\",\n  \"dipped\",\n  \"dipper\",\n  \"dipping\",\n  \"directed\",\n  \"direction\",\n  \"directive\",\n  \"directly\",\n  \"directory\",\n  \"direness\",\n  \"dirtiness\",\n  \"disabled\",\n  \"disagree\",\n  \"disallow\",\n  \"disarm\",\n  \"disarray\",\n  \"disaster\",\n  \"disband\",\n  \"disbelief\",\n  \"disburse\",\n  \"discard\",\n  \"discern\",\n  \"discharge\",\n  \"disclose\",\n  \"discolor\",\n  \"discount\",\n  \"discourse\",\n  \"discover\",\n  \"discuss\",\n  \"disdain\",\n  \"disengage\",\n  \"disfigure\",\n  \"disgrace\",\n  \"dish\",\n  \"disinfect\",\n  \"disjoin\",\n  \"disk\",\n  \"dislike\",\n  \"disliking\",\n  \"dislocate\",\n  \"dislodge\",\n  \"disloyal\",\n  \"dismantle\",\n  \"dismay\",\n  \"dismiss\",\n  \"dismount\",\n  \"disobey\",\n  \"disorder\",\n  \"disown\",\n  \"disparate\",\n  \"disparity\",\n  \"dispatch\",\n  \"dispense\",\n  \"dispersal\",\n  \"dispersed\",\n  \"disperser\",\n  \"displace\",\n  \"display\",\n  \"displease\",\n  \"disposal\",\n  \"dispose\",\n  \"disprove\",\n  \"dispute\",\n  \"disregard\",\n  \"disrupt\",\n  \"dissuade\",\n  \"distance\",\n  \"distant\",\n  \"distaste\",\n  \"distill\",\n  \"distinct\",\n  \"distort\",\n  \"distract\",\n  \"distress\",\n  \"district\",\n  \"distrust\",\n  \"ditch\",\n  \"ditto\",\n  \"ditzy\",\n  \"dividable\",\n  \"divided\",\n  \"dividend\",\n  \"dividers\",\n  \"dividing\",\n  \"divinely\",\n  \"diving\",\n  \"divinity\",\n  \"divisible\",\n  \"divisibly\",\n  \"division\",\n  \"divisive\",\n  \"divorcee\",\n  \"dizziness\",\n  \"dizzy\",\n  \"doable\",\n  \"docile\",\n  \"dock\",\n  \"doctrine\",\n  \"document\",\n  \"dodge\",\n  \"dodgy\",\n  \"doily\",\n  \"doing\",\n  \"dole\",\n  \"dollar\",\n  \"dollhouse\",\n  \"dollop\",\n  \"dolly\",\n  \"dolphin\",\n  \"domain\",\n  \"domelike\",\n  \"domestic\",\n  \"dominion\",\n  \"dominoes\",\n  \"donated\",\n  \"donation\",\n  \"donator\",\n  \"donor\",\n  \"donut\",\n  \"doodle\",\n  \"doorbell\",\n  \"doorframe\",\n  \"doorknob\",\n  \"doorman\",\n  \"doormat\",\n  \"doornail\",\n  \"doorpost\",\n  \"doorstep\",\n  \"doorstop\",\n  \"doorway\",\n  \"doozy\",\n  \"dork\",\n  \"dormitory\",\n  \"dorsal\",\n  \"dosage\",\n  \"dose\",\n  \"dotted\",\n  \"doubling\",\n  \"douche\",\n  \"dove\",\n  \"down\",\n  \"dowry\",\n  \"doze\",\n  \"drab\",\n  \"dragging\",\n  \"dragonfly\",\n  \"dragonish\",\n  \"dragster\",\n  \"drainable\",\n  \"drainage\",\n  \"drained\",\n  \"drainer\",\n  \"drainpipe\",\n  \"dramatic\",\n  \"dramatize\",\n  \"drank\",\n  \"drapery\",\n  \"drastic\",\n  \"draw\",\n  \"dreaded\",\n  \"dreadful\",\n  \"dreadlock\",\n  \"dreamboat\",\n  \"dreamily\",\n  \"dreamland\",\n  \"dreamless\",\n  \"dreamlike\",\n  \"dreamt\",\n  \"dreamy\",\n  \"drearily\",\n  \"dreary\",\n  \"drench\",\n  \"dress\",\n  \"drew\",\n  \"dribble\",\n  \"dried\",\n  \"drier\",\n  \"drift\",\n  \"driller\",\n  \"drilling\",\n  \"drinkable\",\n  \"drinking\",\n  \"dripping\",\n  \"drippy\",\n  \"drivable\",\n  \"driven\",\n  \"driver\",\n  \"driveway\",\n  \"driving\",\n  \"drizzle\",\n  \"drizzly\",\n  \"drone\",\n  \"drool\",\n  \"droop\",\n  \"drop-down\",\n  \"dropbox\",\n  \"dropkick\",\n  \"droplet\",\n  \"dropout\",\n  \"dropper\",\n  \"drove\",\n  \"drown\",\n  \"drowsily\",\n  \"drudge\",\n  \"drum\",\n  \"dry\",\n  \"dubbed\",\n  \"dubiously\",\n  \"duchess\",\n  \"duckbill\",\n  \"ducking\",\n  \"duckling\",\n  \"ducktail\",\n  \"ducky\",\n  \"duct\",\n  \"dude\",\n  \"duffel\",\n  \"dugout\",\n  \"duh\",\n  \"duke\",\n  \"duller\",\n  \"dullness\",\n  \"duly\",\n  \"dumping\",\n  \"dumpling\",\n  \"dumpster\",\n  \"duo\",\n  \"dupe\",\n  \"duplex\",\n  \"duplicate\",\n  \"duplicity\",\n  \"durable\",\n  \"durably\",\n  \"duration\",\n  \"duress\",\n  \"during\",\n  \"dusk\",\n  \"dust\",\n  \"dutiful\",\n  \"duty\",\n  \"duvet\",\n  \"dwarf\",\n  \"dweeb\",\n  \"dwelled\",\n  \"dweller\",\n  \"dwelling\",\n  \"dwindle\",\n  \"dwindling\",\n  \"dynamic\",\n  \"dynamite\",\n  \"dynasty\",\n  \"dyslexia\",\n  \"dyslexic\",\n  \"each\",\n  \"eagle\",\n  \"earache\",\n  \"eardrum\",\n  \"earflap\",\n  \"earful\",\n  \"earlobe\",\n  \"early\",\n  \"earmark\",\n  \"earmuff\",\n  \"earphone\",\n  \"earpiece\",\n  \"earplugs\",\n  \"earring\",\n  \"earshot\",\n  \"earthen\",\n  \"earthlike\",\n  \"earthling\",\n  \"earthly\",\n  \"earthworm\",\n  \"earthy\",\n  \"earwig\",\n  \"easeful\",\n  \"easel\",\n  \"easiest\",\n  \"easily\",\n  \"easiness\",\n  \"easing\",\n  \"eastbound\",\n  \"eastcoast\",\n  \"easter\",\n  \"eastward\",\n  \"eatable\",\n  \"eaten\",\n  \"eatery\",\n  \"eating\",\n  \"eats\",\n  \"ebay\",\n  \"ebony\",\n  \"ebook\",\n  \"ecard\",\n  \"eccentric\",\n  \"echo\",\n  \"eclair\",\n  \"eclipse\",\n  \"ecologist\",\n  \"ecology\",\n  \"economic\",\n  \"economist\",\n  \"economy\",\n  \"ecosphere\",\n  \"ecosystem\",\n  \"edge\",\n  \"edginess\",\n  \"edging\",\n  \"edgy\",\n  \"edition\",\n  \"editor\",\n  \"educated\",\n  \"education\",\n  \"educator\",\n  \"eel\",\n  \"effective\",\n  \"effects\",\n  \"efficient\",\n  \"effort\",\n  \"eggbeater\",\n  \"egging\",\n  \"eggnog\",\n  \"eggplant\",\n  \"eggshell\",\n  \"egomaniac\",\n  \"egotism\",\n  \"egotistic\",\n  \"either\",\n  \"eject\",\n  \"elaborate\",\n  \"elastic\",\n  \"elated\",\n  \"elbow\",\n  \"eldercare\",\n  \"elderly\",\n  \"eldest\",\n  \"electable\",\n  \"election\",\n  \"elective\",\n  \"elephant\",\n  \"elevate\",\n  \"elevating\",\n  \"elevation\",\n  \"elevator\",\n  \"eleven\",\n  \"elf\",\n  \"eligible\",\n  \"eligibly\",\n  \"eliminate\",\n  \"elite\",\n  \"elitism\",\n  \"elixir\",\n  \"elk\",\n  \"ellipse\",\n  \"elliptic\",\n  \"elm\",\n  \"elongated\",\n  \"elope\",\n  \"eloquence\",\n  \"eloquent\",\n  \"elsewhere\",\n  \"elude\",\n  \"elusive\",\n  \"elves\",\n  \"email\",\n  \"embargo\",\n  \"embark\",\n  \"embassy\",\n  \"embattled\",\n  \"embellish\",\n  \"ember\",\n  \"embezzle\",\n  \"emblaze\",\n  \"emblem\",\n  \"embody\",\n  \"embolism\",\n  \"emboss\",\n  \"embroider\",\n  \"emcee\",\n  \"emerald\",\n  \"emergency\",\n  \"emission\",\n  \"emit\",\n  \"emote\",\n  \"emoticon\",\n  \"emotion\",\n  \"empathic\",\n  \"empathy\",\n  \"emperor\",\n  \"emphases\",\n  \"emphasis\",\n  \"emphasize\",\n  \"emphatic\",\n  \"empirical\",\n  \"employed\",\n  \"employee\",\n  \"employer\",\n  \"emporium\",\n  \"empower\",\n  \"emptier\",\n  \"emptiness\",\n  \"empty\",\n  \"emu\",\n  \"enable\",\n  \"enactment\",\n  \"enamel\",\n  \"enchanted\",\n  \"enchilada\",\n  \"encircle\",\n  \"enclose\",\n  \"enclosure\",\n  \"encode\",\n  \"encore\",\n  \"encounter\",\n  \"encourage\",\n  \"encroach\",\n  \"encrust\",\n  \"encrypt\",\n  \"endanger\",\n  \"endeared\",\n  \"endearing\",\n  \"ended\",\n  \"ending\",\n  \"endless\",\n  \"endnote\",\n  \"endocrine\",\n  \"endorphin\",\n  \"endorse\",\n  \"endowment\",\n  \"endpoint\",\n  \"endurable\",\n  \"endurance\",\n  \"enduring\",\n  \"energetic\",\n  \"energize\",\n  \"energy\",\n  \"enforced\",\n  \"enforcer\",\n  \"engaged\",\n  \"engaging\",\n  \"engine\",\n  \"engorge\",\n  \"engraved\",\n  \"engraver\",\n  \"engraving\",\n  \"engross\",\n  \"engulf\",\n  \"enhance\",\n  \"enigmatic\",\n  \"enjoyable\",\n  \"enjoyably\",\n  \"enjoyer\",\n  \"enjoying\",\n  \"enjoyment\",\n  \"enlarged\",\n  \"enlarging\",\n  \"enlighten\",\n  \"enlisted\",\n  \"enquirer\",\n  \"enrage\",\n  \"enrich\",\n  \"enroll\",\n  \"enslave\",\n  \"ensnare\",\n  \"ensure\",\n  \"entail\",\n  \"entangled\",\n  \"entering\",\n  \"entertain\",\n  \"enticing\",\n  \"entire\",\n  \"entitle\",\n  \"entity\",\n  \"entomb\",\n  \"entourage\",\n  \"entrap\",\n  \"entree\",\n  \"entrench\",\n  \"entrust\",\n  \"entryway\",\n  \"entwine\",\n  \"enunciate\",\n  \"envelope\",\n  \"enviable\",\n  \"enviably\",\n  \"envious\",\n  \"envision\",\n  \"envoy\",\n  \"envy\",\n  \"enzyme\",\n  \"epic\",\n  \"epidemic\",\n  \"epidermal\",\n  \"epidermis\",\n  \"epidural\",\n  \"epilepsy\",\n  \"epileptic\",\n  \"epilogue\",\n  \"epiphany\",\n  \"episode\",\n  \"equal\",\n  \"equate\",\n  \"equation\",\n  \"equator\",\n  \"equinox\",\n  \"equipment\",\n  \"equity\",\n  \"equivocal\",\n  \"eradicate\",\n  \"erasable\",\n  \"erased\",\n  \"eraser\",\n  \"erasure\",\n  \"ergonomic\",\n  \"errand\",\n  \"errant\",\n  \"erratic\",\n  \"error\",\n  \"erupt\",\n  \"escalate\",\n  \"escalator\",\n  \"escapable\",\n  \"escapade\",\n  \"escapist\",\n  \"escargot\",\n  \"eskimo\",\n  \"esophagus\",\n  \"espionage\",\n  \"espresso\",\n  \"esquire\",\n  \"essay\",\n  \"essence\",\n  \"essential\",\n  \"establish\",\n  \"estate\",\n  \"esteemed\",\n  \"estimate\",\n  \"estimator\",\n  \"estranged\",\n  \"estrogen\",\n  \"etching\",\n  \"eternal\",\n  \"eternity\",\n  \"ethanol\",\n  \"ether\",\n  \"ethically\",\n  \"ethics\",\n  \"euphemism\",\n  \"evacuate\",\n  \"evacuee\",\n  \"evade\",\n  \"evaluate\",\n  \"evaluator\",\n  \"evaporate\",\n  \"evasion\",\n  \"evasive\",\n  \"even\",\n  \"everglade\",\n  \"evergreen\",\n  \"everybody\",\n  \"everyday\",\n  \"everyone\",\n  \"evict\",\n  \"evidence\",\n  \"evident\",\n  \"evil\",\n  \"evoke\",\n  \"evolution\",\n  \"evolve\",\n  \"exact\",\n  \"exalted\",\n  \"example\",\n  \"excavate\",\n  \"excavator\",\n  \"exceeding\",\n  \"exception\",\n  \"excess\",\n  \"exchange\",\n  \"excitable\",\n  \"exciting\",\n  \"exclaim\",\n  \"exclude\",\n  \"excluding\",\n  \"exclusion\",\n  \"exclusive\",\n  \"excretion\",\n  \"excretory\",\n  \"excursion\",\n  \"excusable\",\n  \"excusably\",\n  \"excuse\",\n  \"exemplary\",\n  \"exemplify\",\n  \"exemption\",\n  \"exerciser\",\n  \"exert\",\n  \"exes\",\n  \"exfoliate\",\n  \"exhale\",\n  \"exhaust\",\n  \"exhume\",\n  \"exile\",\n  \"existing\",\n  \"exit\",\n  \"exodus\",\n  \"exonerate\",\n  \"exorcism\",\n  \"exorcist\",\n  \"expand\",\n  \"expanse\",\n  \"expansion\",\n  \"expansive\",\n  \"expectant\",\n  \"expedited\",\n  \"expediter\",\n  \"expel\",\n  \"expend\",\n  \"expenses\",\n  \"expensive\",\n  \"expert\",\n  \"expire\",\n  \"expiring\",\n  \"explain\",\n  \"expletive\",\n  \"explicit\",\n  \"explode\",\n  \"exploit\",\n  \"explore\",\n  \"exploring\",\n  \"exponent\",\n  \"exporter\",\n  \"exposable\",\n  \"expose\",\n  \"exposure\",\n  \"express\",\n  \"expulsion\",\n  \"exquisite\",\n  \"extended\",\n  \"extending\",\n  \"extent\",\n  \"extenuate\",\n  \"exterior\",\n  \"external\",\n  \"extinct\",\n  \"extortion\",\n  \"extradite\",\n  \"extras\",\n  \"extrovert\",\n  \"extrude\",\n  \"extruding\",\n  \"exuberant\",\n  \"fable\",\n  \"fabric\",\n  \"fabulous\",\n  \"facebook\",\n  \"facecloth\",\n  \"facedown\",\n  \"faceless\",\n  \"facelift\",\n  \"faceplate\",\n  \"faceted\",\n  \"facial\",\n  \"facility\",\n  \"facing\",\n  \"facsimile\",\n  \"faction\",\n  \"factoid\",\n  \"factor\",\n  \"factsheet\",\n  \"factual\",\n  \"faculty\",\n  \"fade\",\n  \"fading\",\n  \"failing\",\n  \"falcon\",\n  \"fall\",\n  \"false\",\n  \"falsify\",\n  \"fame\",\n  \"familiar\",\n  \"family\",\n  \"famine\",\n  \"famished\",\n  \"fanatic\",\n  \"fancied\",\n  \"fanciness\",\n  \"fancy\",\n  \"fanfare\",\n  \"fang\",\n  \"fanning\",\n  \"fantasize\",\n  \"fantastic\",\n  \"fantasy\",\n  \"fascism\",\n  \"fastball\",\n  \"faster\",\n  \"fasting\",\n  \"fastness\",\n  \"faucet\",\n  \"favorable\",\n  \"favorably\",\n  \"favored\",\n  \"favoring\",\n  \"favorite\",\n  \"fax\",\n  \"feast\",\n  \"federal\",\n  \"fedora\",\n  \"feeble\",\n  \"feed\",\n  \"feel\",\n  \"feisty\",\n  \"feline\",\n  \"felt-tip\",\n  \"feminine\",\n  \"feminism\",\n  \"feminist\",\n  \"feminize\",\n  \"femur\",\n  \"fence\",\n  \"fencing\",\n  \"fender\",\n  \"ferment\",\n  \"fernlike\",\n  \"ferocious\",\n  \"ferocity\",\n  \"ferret\",\n  \"ferris\",\n  \"ferry\",\n  \"fervor\",\n  \"fester\",\n  \"festival\",\n  \"festive\",\n  \"festivity\",\n  \"fetal\",\n  \"fetch\",\n  \"fever\",\n  \"fiber\",\n  \"fiction\",\n  \"fiddle\",\n  \"fiddling\",\n  \"fidelity\",\n  \"fidgeting\",\n  \"fidgety\",\n  \"fifteen\",\n  \"fifth\",\n  \"fiftieth\",\n  \"fifty\",\n  \"figment\",\n  \"figure\",\n  \"figurine\",\n  \"filing\",\n  \"filled\",\n  \"filler\",\n  \"filling\",\n  \"film\",\n  \"filter\",\n  \"filth\",\n  \"filtrate\",\n  \"finale\",\n  \"finalist\",\n  \"finalize\",\n  \"finally\",\n  \"finance\",\n  \"financial\",\n  \"finch\",\n  \"fineness\",\n  \"finer\",\n  \"finicky\",\n  \"finished\",\n  \"finisher\",\n  \"finishing\",\n  \"finite\",\n  \"finless\",\n  \"finlike\",\n  \"fiscally\",\n  \"fit\",\n  \"five\",\n  \"flaccid\",\n  \"flagman\",\n  \"flagpole\",\n  \"flagship\",\n  \"flagstick\",\n  \"flagstone\",\n  \"flail\",\n  \"flakily\",\n  \"flaky\",\n  \"flame\",\n  \"flammable\",\n  \"flanked\",\n  \"flanking\",\n  \"flannels\",\n  \"flap\",\n  \"flaring\",\n  \"flashback\",\n  \"flashbulb\",\n  \"flashcard\",\n  \"flashily\",\n  \"flashing\",\n  \"flashy\",\n  \"flask\",\n  \"flatbed\",\n  \"flatfoot\",\n  \"flatly\",\n  \"flatness\",\n  \"flatten\",\n  \"flattered\",\n  \"flatterer\",\n  \"flattery\",\n  \"flattop\",\n  \"flatware\",\n  \"flatworm\",\n  \"flavored\",\n  \"flavorful\",\n  \"flavoring\",\n  \"flaxseed\",\n  \"fled\",\n  \"fleshed\",\n  \"fleshy\",\n  \"flick\",\n  \"flier\",\n  \"flight\",\n  \"flinch\",\n  \"fling\",\n  \"flint\",\n  \"flip\",\n  \"flirt\",\n  \"float\",\n  \"flock\",\n  \"flogging\",\n  \"flop\",\n  \"floral\",\n  \"florist\",\n  \"floss\",\n  \"flounder\",\n  \"flyable\",\n  \"flyaway\",\n  \"flyer\",\n  \"flying\",\n  \"flyover\",\n  \"flypaper\",\n  \"foam\",\n  \"foe\",\n  \"fog\",\n  \"foil\",\n  \"folic\",\n  \"folk\",\n  \"follicle\",\n  \"follow\",\n  \"fondling\",\n  \"fondly\",\n  \"fondness\",\n  \"fondue\",\n  \"font\",\n  \"food\",\n  \"fool\",\n  \"footage\",\n  \"football\",\n  \"footbath\",\n  \"footboard\",\n  \"footer\",\n  \"footgear\",\n  \"foothill\",\n  \"foothold\",\n  \"footing\",\n  \"footless\",\n  \"footman\",\n  \"footnote\",\n  \"footpad\",\n  \"footpath\",\n  \"footprint\",\n  \"footrest\",\n  \"footsie\",\n  \"footsore\",\n  \"footwear\",\n  \"footwork\",\n  \"fossil\",\n  \"foster\",\n  \"founder\",\n  \"founding\",\n  \"fountain\",\n  \"fox\",\n  \"foyer\",\n  \"fraction\",\n  \"fracture\",\n  \"fragile\",\n  \"fragility\",\n  \"fragment\",\n  \"fragrance\",\n  \"fragrant\",\n  \"frail\",\n  \"frame\",\n  \"framing\",\n  \"frantic\",\n  \"fraternal\",\n  \"frayed\",\n  \"fraying\",\n  \"frays\",\n  \"freckled\",\n  \"freckles\",\n  \"freebase\",\n  \"freebee\",\n  \"freebie\",\n  \"freedom\",\n  \"freefall\",\n  \"freehand\",\n  \"freeing\",\n  \"freeload\",\n  \"freely\",\n  \"freemason\",\n  \"freeness\",\n  \"freestyle\",\n  \"freeware\",\n  \"freeway\",\n  \"freewill\",\n  \"freezable\",\n  \"freezing\",\n  \"freight\",\n  \"french\",\n  \"frenzied\",\n  \"frenzy\",\n  \"frequency\",\n  \"frequent\",\n  \"fresh\",\n  \"fretful\",\n  \"fretted\",\n  \"friction\",\n  \"friday\",\n  \"fridge\",\n  \"fried\",\n  \"friend\",\n  \"frighten\",\n  \"frightful\",\n  \"frigidity\",\n  \"frigidly\",\n  \"frill\",\n  \"fringe\",\n  \"frisbee\",\n  \"frisk\",\n  \"fritter\",\n  \"frivolous\",\n  \"frolic\",\n  \"from\",\n  \"front\",\n  \"frostbite\",\n  \"frosted\",\n  \"frostily\",\n  \"frosting\",\n  \"frostlike\",\n  \"frosty\",\n  \"froth\",\n  \"frown\",\n  \"frozen\",\n  \"fructose\",\n  \"frugality\",\n  \"frugally\",\n  \"fruit\",\n  \"frustrate\",\n  \"frying\",\n  \"gab\",\n  \"gaffe\",\n  \"gag\",\n  \"gainfully\",\n  \"gaining\",\n  \"gains\",\n  \"gala\",\n  \"gallantly\",\n  \"galleria\",\n  \"gallery\",\n  \"galley\",\n  \"gallon\",\n  \"gallows\",\n  \"gallstone\",\n  \"galore\",\n  \"galvanize\",\n  \"gambling\",\n  \"game\",\n  \"gaming\",\n  \"gamma\",\n  \"gander\",\n  \"gangly\",\n  \"gangrene\",\n  \"gangway\",\n  \"gap\",\n  \"garage\",\n  \"garbage\",\n  \"garden\",\n  \"gargle\",\n  \"garland\",\n  \"garlic\",\n  \"garment\",\n  \"garnet\",\n  \"garnish\",\n  \"garter\",\n  \"gas\",\n  \"gatherer\",\n  \"gathering\",\n  \"gating\",\n  \"gauging\",\n  \"gauntlet\",\n  \"gauze\",\n  \"gave\",\n  \"gawk\",\n  \"gazing\",\n  \"gear\",\n  \"gecko\",\n  \"geek\",\n  \"geiger\",\n  \"gem\",\n  \"gender\",\n  \"generic\",\n  \"generous\",\n  \"genetics\",\n  \"genre\",\n  \"gentile\",\n  \"gentleman\",\n  \"gently\",\n  \"gents\",\n  \"geography\",\n  \"geologic\",\n  \"geologist\",\n  \"geology\",\n  \"geometric\",\n  \"geometry\",\n  \"geranium\",\n  \"gerbil\",\n  \"geriatric\",\n  \"germicide\",\n  \"germinate\",\n  \"germless\",\n  \"germproof\",\n  \"gestate\",\n  \"gestation\",\n  \"gesture\",\n  \"getaway\",\n  \"getting\",\n  \"getup\",\n  \"giant\",\n  \"gibberish\",\n  \"giblet\",\n  \"giddily\",\n  \"giddiness\",\n  \"giddy\",\n  \"gift\",\n  \"gigabyte\",\n  \"gigahertz\",\n  \"gigantic\",\n  \"giggle\",\n  \"giggling\",\n  \"giggly\",\n  \"gigolo\",\n  \"gilled\",\n  \"gills\",\n  \"gimmick\",\n  \"girdle\",\n  \"giveaway\",\n  \"given\",\n  \"giver\",\n  \"giving\",\n  \"gizmo\",\n  \"gizzard\",\n  \"glacial\",\n  \"glacier\",\n  \"glade\",\n  \"gladiator\",\n  \"gladly\",\n  \"glamorous\",\n  \"glamour\",\n  \"glance\",\n  \"glancing\",\n  \"glandular\",\n  \"glare\",\n  \"glaring\",\n  \"glass\",\n  \"glaucoma\",\n  \"glazing\",\n  \"gleaming\",\n  \"gleeful\",\n  \"glider\",\n  \"gliding\",\n  \"glimmer\",\n  \"glimpse\",\n  \"glisten\",\n  \"glitch\",\n  \"glitter\",\n  \"glitzy\",\n  \"gloater\",\n  \"gloating\",\n  \"gloomily\",\n  \"gloomy\",\n  \"glorified\",\n  \"glorifier\",\n  \"glorify\",\n  \"glorious\",\n  \"glory\",\n  \"gloss\",\n  \"glove\",\n  \"glowing\",\n  \"glowworm\",\n  \"glucose\",\n  \"glue\",\n  \"gluten\",\n  \"glutinous\",\n  \"glutton\",\n  \"gnarly\",\n  \"gnat\",\n  \"goal\",\n  \"goatskin\",\n  \"goes\",\n  \"goggles\",\n  \"going\",\n  \"goldfish\",\n  \"goldmine\",\n  \"goldsmith\",\n  \"golf\",\n  \"goliath\",\n  \"gonad\",\n  \"gondola\",\n  \"gone\",\n  \"gong\",\n  \"good\",\n  \"gooey\",\n  \"goofball\",\n  \"goofiness\",\n  \"goofy\",\n  \"google\",\n  \"goon\",\n  \"gopher\",\n  \"gore\",\n  \"gorged\",\n  \"gorgeous\",\n  \"gory\",\n  \"gosling\",\n  \"gossip\",\n  \"gothic\",\n  \"gotten\",\n  \"gout\",\n  \"gown\",\n  \"grab\",\n  \"graceful\",\n  \"graceless\",\n  \"gracious\",\n  \"gradation\",\n  \"graded\",\n  \"grader\",\n  \"gradient\",\n  \"grading\",\n  \"gradually\",\n  \"graduate\",\n  \"graffiti\",\n  \"grafted\",\n  \"grafting\",\n  \"grain\",\n  \"granddad\",\n  \"grandkid\",\n  \"grandly\",\n  \"grandma\",\n  \"grandpa\",\n  \"grandson\",\n  \"granite\",\n  \"granny\",\n  \"granola\",\n  \"grant\",\n  \"granular\",\n  \"grape\",\n  \"graph\",\n  \"grapple\",\n  \"grappling\",\n  \"grasp\",\n  \"grass\",\n  \"gratified\",\n  \"gratify\",\n  \"grating\",\n  \"gratitude\",\n  \"gratuity\",\n  \"gravel\",\n  \"graveness\",\n  \"graves\",\n  \"graveyard\",\n  \"gravitate\",\n  \"gravity\",\n  \"gravy\",\n  \"gray\",\n  \"grazing\",\n  \"greasily\",\n  \"greedily\",\n  \"greedless\",\n  \"greedy\",\n  \"green\",\n  \"greeter\",\n  \"greeting\",\n  \"grew\",\n  \"greyhound\",\n  \"grid\",\n  \"grief\",\n  \"grievance\",\n  \"grieving\",\n  \"grievous\",\n  \"grill\",\n  \"grimace\",\n  \"grimacing\",\n  \"grime\",\n  \"griminess\",\n  \"grimy\",\n  \"grinch\",\n  \"grinning\",\n  \"grip\",\n  \"gristle\",\n  \"grit\",\n  \"groggily\",\n  \"groggy\",\n  \"groin\",\n  \"groom\",\n  \"groove\",\n  \"grooving\",\n  \"groovy\",\n  \"grope\",\n  \"ground\",\n  \"grouped\",\n  \"grout\",\n  \"grove\",\n  \"grower\",\n  \"growing\",\n  \"growl\",\n  \"grub\",\n  \"grudge\",\n  \"grudging\",\n  \"grueling\",\n  \"gruffly\",\n  \"grumble\",\n  \"grumbling\",\n  \"grumbly\",\n  \"grumpily\",\n  \"grunge\",\n  \"grunt\",\n  \"guacamole\",\n  \"guidable\",\n  \"guidance\",\n  \"guide\",\n  \"guiding\",\n  \"guileless\",\n  \"guise\",\n  \"gulf\",\n  \"gullible\",\n  \"gully\",\n  \"gulp\",\n  \"gumball\",\n  \"gumdrop\",\n  \"gumminess\",\n  \"gumming\",\n  \"gummy\",\n  \"gurgle\",\n  \"gurgling\",\n  \"guru\",\n  \"gush\",\n  \"gusto\",\n  \"gusty\",\n  \"gutless\",\n  \"guts\",\n  \"gutter\",\n  \"guy\",\n  \"guzzler\",\n  \"gyration\",\n  \"habitable\",\n  \"habitant\",\n  \"habitat\",\n  \"habitual\",\n  \"hacked\",\n  \"hacker\",\n  \"hacking\",\n  \"hacksaw\",\n  \"had\",\n  \"haggler\",\n  \"haiku\",\n  \"half\",\n  \"halogen\",\n  \"halt\",\n  \"halved\",\n  \"halves\",\n  \"hamburger\",\n  \"hamlet\",\n  \"hammock\",\n  \"hamper\",\n  \"hamster\",\n  \"hamstring\",\n  \"handbag\",\n  \"handball\",\n  \"handbook\",\n  \"handbrake\",\n  \"handcart\",\n  \"handclap\",\n  \"handclasp\",\n  \"handcraft\",\n  \"handcuff\",\n  \"handed\",\n  \"handful\",\n  \"handgrip\",\n  \"handgun\",\n  \"handheld\",\n  \"handiness\",\n  \"handiwork\",\n  \"handlebar\",\n  \"handled\",\n  \"handler\",\n  \"handling\",\n  \"handmade\",\n  \"handoff\",\n  \"handpick\",\n  \"handprint\",\n  \"handrail\",\n  \"handsaw\",\n  \"handset\",\n  \"handsfree\",\n  \"handshake\",\n  \"handstand\",\n  \"handwash\",\n  \"handwork\",\n  \"handwoven\",\n  \"handwrite\",\n  \"handyman\",\n  \"hangnail\",\n  \"hangout\",\n  \"hangover\",\n  \"hangup\",\n  \"hankering\",\n  \"hankie\",\n  \"hanky\",\n  \"haphazard\",\n  \"happening\",\n  \"happier\",\n  \"happiest\",\n  \"happily\",\n  \"happiness\",\n  \"happy\",\n  \"harbor\",\n  \"hardcopy\",\n  \"hardcore\",\n  \"hardcover\",\n  \"harddisk\",\n  \"hardened\",\n  \"hardener\",\n  \"hardening\",\n  \"hardhat\",\n  \"hardhead\",\n  \"hardiness\",\n  \"hardly\",\n  \"hardness\",\n  \"hardship\",\n  \"hardware\",\n  \"hardwired\",\n  \"hardwood\",\n  \"hardy\",\n  \"harmful\",\n  \"harmless\",\n  \"harmonica\",\n  \"harmonics\",\n  \"harmonize\",\n  \"harmony\",\n  \"harness\",\n  \"harpist\",\n  \"harsh\",\n  \"harvest\",\n  \"hash\",\n  \"hassle\",\n  \"haste\",\n  \"hastily\",\n  \"hastiness\",\n  \"hasty\",\n  \"hatbox\",\n  \"hatchback\",\n  \"hatchery\",\n  \"hatchet\",\n  \"hatching\",\n  \"hatchling\",\n  \"hate\",\n  \"hatless\",\n  \"hatred\",\n  \"haunt\",\n  \"haven\",\n  \"hazard\",\n  \"hazelnut\",\n  \"hazily\",\n  \"haziness\",\n  \"hazing\",\n  \"hazy\",\n  \"headache\",\n  \"headband\",\n  \"headboard\",\n  \"headcount\",\n  \"headdress\",\n  \"headed\",\n  \"header\",\n  \"headfirst\",\n  \"headgear\",\n  \"heading\",\n  \"headlamp\",\n  \"headless\",\n  \"headlock\",\n  \"headphone\",\n  \"headpiece\",\n  \"headrest\",\n  \"headroom\",\n  \"headscarf\",\n  \"headset\",\n  \"headsman\",\n  \"headstand\",\n  \"headstone\",\n  \"headway\",\n  \"headwear\",\n  \"heap\",\n  \"heat\",\n  \"heave\",\n  \"heavily\",\n  \"heaviness\",\n  \"heaving\",\n  \"hedge\",\n  \"hedging\",\n  \"heftiness\",\n  \"hefty\",\n  \"helium\",\n  \"helmet\",\n  \"helper\",\n  \"helpful\",\n  \"helping\",\n  \"helpless\",\n  \"helpline\",\n  \"hemlock\",\n  \"hemstitch\",\n  \"hence\",\n  \"henchman\",\n  \"henna\",\n  \"herald\",\n  \"herbal\",\n  \"herbicide\",\n  \"herbs\",\n  \"heritage\",\n  \"hermit\",\n  \"heroics\",\n  \"heroism\",\n  \"herring\",\n  \"herself\",\n  \"hertz\",\n  \"hesitancy\",\n  \"hesitant\",\n  \"hesitate\",\n  \"hexagon\",\n  \"hexagram\",\n  \"hubcap\",\n  \"huddle\",\n  \"huddling\",\n  \"huff\",\n  \"hug\",\n  \"hula\",\n  \"hulk\",\n  \"hull\",\n  \"human\",\n  \"humble\",\n  \"humbling\",\n  \"humbly\",\n  \"humid\",\n  \"humiliate\",\n  \"humility\",\n  \"humming\",\n  \"hummus\",\n  \"humongous\",\n  \"humorist\",\n  \"humorless\",\n  \"humorous\",\n  \"humpback\",\n  \"humped\",\n  \"humvee\",\n  \"hunchback\",\n  \"hundredth\",\n  \"hunger\",\n  \"hungrily\",\n  \"hungry\",\n  \"hunk\",\n  \"hunter\",\n  \"hunting\",\n  \"huntress\",\n  \"huntsman\",\n  \"hurdle\",\n  \"hurled\",\n  \"hurler\",\n  \"hurling\",\n  \"hurray\",\n  \"hurricane\",\n  \"hurried\",\n  \"hurry\",\n  \"hurt\",\n  \"husband\",\n  \"hush\",\n  \"husked\",\n  \"huskiness\",\n  \"hut\",\n  \"hybrid\",\n  \"hydrant\",\n  \"hydrated\",\n  \"hydration\",\n  \"hydrogen\",\n  \"hydroxide\",\n  \"hyperlink\",\n  \"hypertext\",\n  \"hyphen\",\n  \"hypnoses\",\n  \"hypnosis\",\n  \"hypnotic\",\n  \"hypnotism\",\n  \"hypnotist\",\n  \"hypnotize\",\n  \"hypocrisy\",\n  \"hypocrite\",\n  \"ibuprofen\",\n  \"ice\",\n  \"iciness\",\n  \"icing\",\n  \"icky\",\n  \"icon\",\n  \"icy\",\n  \"idealism\",\n  \"idealist\",\n  \"idealize\",\n  \"ideally\",\n  \"idealness\",\n  \"identical\",\n  \"identify\",\n  \"identity\",\n  \"ideology\",\n  \"idiocy\",\n  \"idiom\",\n  \"idly\",\n  \"igloo\",\n  \"ignition\",\n  \"ignore\",\n  \"iguana\",\n  \"illicitly\",\n  \"illusion\",\n  \"illusive\",\n  \"image\",\n  \"imaginary\",\n  \"imagines\",\n  \"imaging\",\n  \"imbecile\",\n  \"imitate\",\n  \"imitation\",\n  \"immature\",\n  \"immerse\",\n  \"immersion\",\n  \"imminent\",\n  \"immobile\",\n  \"immodest\",\n  \"immorally\",\n  \"immortal\",\n  \"immovable\",\n  \"immovably\",\n  \"immunity\",\n  \"immunize\",\n  \"impaired\",\n  \"impale\",\n  \"impart\",\n  \"impatient\",\n  \"impeach\",\n  \"impeding\",\n  \"impending\",\n  \"imperfect\",\n  \"imperial\",\n  \"impish\",\n  \"implant\",\n  \"implement\",\n  \"implicate\",\n  \"implicit\",\n  \"implode\",\n  \"implosion\",\n  \"implosive\",\n  \"imply\",\n  \"impolite\",\n  \"important\",\n  \"importer\",\n  \"impose\",\n  \"imposing\",\n  \"impotence\",\n  \"impotency\",\n  \"impotent\",\n  \"impound\",\n  \"imprecise\",\n  \"imprint\",\n  \"imprison\",\n  \"impromptu\",\n  \"improper\",\n  \"improve\",\n  \"improving\",\n  \"improvise\",\n  \"imprudent\",\n  \"impulse\",\n  \"impulsive\",\n  \"impure\",\n  \"impurity\",\n  \"iodine\",\n  \"iodize\",\n  \"ion\",\n  \"ipad\",\n  \"iphone\",\n  \"ipod\",\n  \"irate\",\n  \"irk\",\n  \"iron\",\n  \"irregular\",\n  \"irrigate\",\n  \"irritable\",\n  \"irritably\",\n  \"irritant\",\n  \"irritate\",\n  \"islamic\",\n  \"islamist\",\n  \"isolated\",\n  \"isolating\",\n  \"isolation\",\n  \"isotope\",\n  \"issue\",\n  \"issuing\",\n  \"italicize\",\n  \"italics\",\n  \"item\",\n  \"itinerary\",\n  \"itunes\",\n  \"ivory\",\n  \"ivy\",\n  \"jab\",\n  \"jackal\",\n  \"jacket\",\n  \"jackknife\",\n  \"jackpot\",\n  \"jailbird\",\n  \"jailbreak\",\n  \"jailer\",\n  \"jailhouse\",\n  \"jalapeno\",\n  \"jam\",\n  \"janitor\",\n  \"january\",\n  \"jargon\",\n  \"jarring\",\n  \"jasmine\",\n  \"jaundice\",\n  \"jaunt\",\n  \"java\",\n  \"jawed\",\n  \"jawless\",\n  \"jawline\",\n  \"jaws\",\n  \"jaybird\",\n  \"jaywalker\",\n  \"jazz\",\n  \"jeep\",\n  \"jeeringly\",\n  \"jellied\",\n  \"jelly\",\n  \"jersey\",\n  \"jester\",\n  \"jet\",\n  \"jiffy\",\n  \"jigsaw\",\n  \"jimmy\",\n  \"jingle\",\n  \"jingling\",\n  \"jinx\",\n  \"jitters\",\n  \"jittery\",\n  \"job\",\n  \"jockey\",\n  \"jockstrap\",\n  \"jogger\",\n  \"jogging\",\n  \"john\",\n  \"joining\",\n  \"jokester\",\n  \"jokingly\",\n  \"jolliness\",\n  \"jolly\",\n  \"jolt\",\n  \"jot\",\n  \"jovial\",\n  \"joyfully\",\n  \"joylessly\",\n  \"joyous\",\n  \"joyride\",\n  \"joystick\",\n  \"jubilance\",\n  \"jubilant\",\n  \"judge\",\n  \"judgingly\",\n  \"judicial\",\n  \"judiciary\",\n  \"judo\",\n  \"juggle\",\n  \"juggling\",\n  \"jugular\",\n  \"juice\",\n  \"juiciness\",\n  \"juicy\",\n  \"jujitsu\",\n  \"jukebox\",\n  \"july\",\n  \"jumble\",\n  \"jumbo\",\n  \"jump\",\n  \"junction\",\n  \"juncture\",\n  \"june\",\n  \"junior\",\n  \"juniper\",\n  \"junkie\",\n  \"junkman\",\n  \"junkyard\",\n  \"jurist\",\n  \"juror\",\n  \"jury\",\n  \"justice\",\n  \"justifier\",\n  \"justify\",\n  \"justly\",\n  \"justness\",\n  \"juvenile\",\n  \"kabob\",\n  \"kangaroo\",\n  \"karaoke\",\n  \"karate\",\n  \"karma\",\n  \"kebab\",\n  \"keenly\",\n  \"keenness\",\n  \"keep\",\n  \"keg\",\n  \"kelp\",\n  \"kennel\",\n  \"kept\",\n  \"kerchief\",\n  \"kerosene\",\n  \"kettle\",\n  \"kick\",\n  \"kiln\",\n  \"kilobyte\",\n  \"kilogram\",\n  \"kilometer\",\n  \"kilowatt\",\n  \"kilt\",\n  \"kimono\",\n  \"kindle\",\n  \"kindling\",\n  \"kindly\",\n  \"kindness\",\n  \"kindred\",\n  \"kinetic\",\n  \"kinfolk\",\n  \"king\",\n  \"kinship\",\n  \"kinsman\",\n  \"kinswoman\",\n  \"kissable\",\n  \"kisser\",\n  \"kissing\",\n  \"kitchen\",\n  \"kite\",\n  \"kitten\",\n  \"kitty\",\n  \"kiwi\",\n  \"kleenex\",\n  \"knapsack\",\n  \"knee\",\n  \"knelt\",\n  \"knickers\",\n  \"knoll\",\n  \"koala\",\n  \"kooky\",\n  \"kosher\",\n  \"krypton\",\n  \"kudos\",\n  \"kung\",\n  \"labored\",\n  \"laborer\",\n  \"laboring\",\n  \"laborious\",\n  \"labrador\",\n  \"ladder\",\n  \"ladies\",\n  \"ladle\",\n  \"ladybug\",\n  \"ladylike\",\n  \"lagged\",\n  \"lagging\",\n  \"lagoon\",\n  \"lair\",\n  \"lake\",\n  \"lance\",\n  \"landed\",\n  \"landfall\",\n  \"landfill\",\n  \"landing\",\n  \"landlady\",\n  \"landless\",\n  \"landline\",\n  \"landlord\",\n  \"landmark\",\n  \"landmass\",\n  \"landmine\",\n  \"landowner\",\n  \"landscape\",\n  \"landside\",\n  \"landslide\",\n  \"language\",\n  \"lankiness\",\n  \"lanky\",\n  \"lantern\",\n  \"lapdog\",\n  \"lapel\",\n  \"lapped\",\n  \"lapping\",\n  \"laptop\",\n  \"lard\",\n  \"large\",\n  \"lark\",\n  \"lash\",\n  \"lasso\",\n  \"last\",\n  \"latch\",\n  \"late\",\n  \"lather\",\n  \"latitude\",\n  \"latrine\",\n  \"latter\",\n  \"latticed\",\n  \"launch\",\n  \"launder\",\n  \"laundry\",\n  \"laurel\",\n  \"lavender\",\n  \"lavish\",\n  \"laxative\",\n  \"lazily\",\n  \"laziness\",\n  \"lazy\",\n  \"lecturer\",\n  \"left\",\n  \"legacy\",\n  \"legal\",\n  \"legend\",\n  \"legged\",\n  \"leggings\",\n  \"legible\",\n  \"legibly\",\n  \"legislate\",\n  \"lego\",\n  \"legroom\",\n  \"legume\",\n  \"legwarmer\",\n  \"legwork\",\n  \"lemon\",\n  \"lend\",\n  \"length\",\n  \"lens\",\n  \"lent\",\n  \"leotard\",\n  \"lesser\",\n  \"letdown\",\n  \"lethargic\",\n  \"lethargy\",\n  \"letter\",\n  \"lettuce\",\n  \"level\",\n  \"leverage\",\n  \"levers\",\n  \"levitate\",\n  \"levitator\",\n  \"liability\",\n  \"liable\",\n  \"liberty\",\n  \"librarian\",\n  \"library\",\n  \"licking\",\n  \"licorice\",\n  \"lid\",\n  \"life\",\n  \"lifter\",\n  \"lifting\",\n  \"liftoff\",\n  \"ligament\",\n  \"likely\",\n  \"likeness\",\n  \"likewise\",\n  \"liking\",\n  \"lilac\",\n  \"lilly\",\n  \"lily\",\n  \"limb\",\n  \"limeade\",\n  \"limelight\",\n  \"limes\",\n  \"limit\",\n  \"limping\",\n  \"limpness\",\n  \"line\",\n  \"lingo\",\n  \"linguini\",\n  \"linguist\",\n  \"lining\",\n  \"linked\",\n  \"linoleum\",\n  \"linseed\",\n  \"lint\",\n  \"lion\",\n  \"lip\",\n  \"liquefy\",\n  \"liqueur\",\n  \"liquid\",\n  \"lisp\",\n  \"list\",\n  \"litigate\",\n  \"litigator\",\n  \"litmus\",\n  \"litter\",\n  \"little\",\n  \"livable\",\n  \"lived\",\n  \"lively\",\n  \"liver\",\n  \"livestock\",\n  \"lividly\",\n  \"living\",\n  \"lizard\",\n  \"lubricant\",\n  \"lubricate\",\n  \"lucid\",\n  \"luckily\",\n  \"luckiness\",\n  \"luckless\",\n  \"lucrative\",\n  \"ludicrous\",\n  \"lugged\",\n  \"lukewarm\",\n  \"lullaby\",\n  \"lumber\",\n  \"luminance\",\n  \"luminous\",\n  \"lumpiness\",\n  \"lumping\",\n  \"lumpish\",\n  \"lunacy\",\n  \"lunar\",\n  \"lunchbox\",\n  \"luncheon\",\n  \"lunchroom\",\n  \"lunchtime\",\n  \"lung\",\n  \"lurch\",\n  \"lure\",\n  \"luridness\",\n  \"lurk\",\n  \"lushly\",\n  \"lushness\",\n  \"luster\",\n  \"lustfully\",\n  \"lustily\",\n  \"lustiness\",\n  \"lustrous\",\n  \"lusty\",\n  \"luxurious\",\n  \"luxury\",\n  \"lying\",\n  \"lyrically\",\n  \"lyricism\",\n  \"lyricist\",\n  \"lyrics\",\n  \"macarena\",\n  \"macaroni\",\n  \"macaw\",\n  \"mace\",\n  \"machine\",\n  \"machinist\",\n  \"magazine\",\n  \"magenta\",\n  \"maggot\",\n  \"magical\",\n  \"magician\",\n  \"magma\",\n  \"magnesium\",\n  \"magnetic\",\n  \"magnetism\",\n  \"magnetize\",\n  \"magnifier\",\n  \"magnify\",\n  \"magnitude\",\n  \"magnolia\",\n  \"mahogany\",\n  \"maimed\",\n  \"majestic\",\n  \"majesty\",\n  \"majorette\",\n  \"majority\",\n  \"makeover\",\n  \"maker\",\n  \"makeshift\",\n  \"making\",\n  \"malformed\",\n  \"malt\",\n  \"mama\",\n  \"mammal\",\n  \"mammary\",\n  \"mammogram\",\n  \"manager\",\n  \"managing\",\n  \"manatee\",\n  \"mandarin\",\n  \"mandate\",\n  \"mandatory\",\n  \"mandolin\",\n  \"manger\",\n  \"mangle\",\n  \"mango\",\n  \"mangy\",\n  \"manhandle\",\n  \"manhole\",\n  \"manhood\",\n  \"manhunt\",\n  \"manicotti\",\n  \"manicure\",\n  \"manifesto\",\n  \"manila\",\n  \"mankind\",\n  \"manlike\",\n  \"manliness\",\n  \"manly\",\n  \"manmade\",\n  \"manned\",\n  \"mannish\",\n  \"manor\",\n  \"manpower\",\n  \"mantis\",\n  \"mantra\",\n  \"manual\",\n  \"many\",\n  \"map\",\n  \"marathon\",\n  \"marauding\",\n  \"marbled\",\n  \"marbles\",\n  \"marbling\",\n  \"march\",\n  \"mardi\",\n  \"margarine\",\n  \"margarita\",\n  \"margin\",\n  \"marigold\",\n  \"marina\",\n  \"marine\",\n  \"marital\",\n  \"maritime\",\n  \"marlin\",\n  \"marmalade\",\n  \"maroon\",\n  \"married\",\n  \"marrow\",\n  \"marry\",\n  \"marshland\",\n  \"marshy\",\n  \"marsupial\",\n  \"marvelous\",\n  \"marxism\",\n  \"mascot\",\n  \"masculine\",\n  \"mashed\",\n  \"mashing\",\n  \"massager\",\n  \"masses\",\n  \"massive\",\n  \"mastiff\",\n  \"matador\",\n  \"matchbook\",\n  \"matchbox\",\n  \"matcher\",\n  \"matching\",\n  \"matchless\",\n  \"material\",\n  \"maternal\",\n  \"maternity\",\n  \"math\",\n  \"mating\",\n  \"matriarch\",\n  \"matrimony\",\n  \"matrix\",\n  \"matron\",\n  \"matted\",\n  \"matter\",\n  \"maturely\",\n  \"maturing\",\n  \"maturity\",\n  \"mauve\",\n  \"maverick\",\n  \"maximize\",\n  \"maximum\",\n  \"maybe\",\n  \"mayday\",\n  \"mayflower\",\n  \"moaner\",\n  \"moaning\",\n  \"mobile\",\n  \"mobility\",\n  \"mobilize\",\n  \"mobster\",\n  \"mocha\",\n  \"mocker\",\n  \"mockup\",\n  \"modified\",\n  \"modify\",\n  \"modular\",\n  \"modulator\",\n  \"module\",\n  \"moisten\",\n  \"moistness\",\n  \"moisture\",\n  \"molar\",\n  \"molasses\",\n  \"mold\",\n  \"molecular\",\n  \"molecule\",\n  \"molehill\",\n  \"mollusk\",\n  \"mom\",\n  \"monastery\",\n  \"monday\",\n  \"monetary\",\n  \"monetize\",\n  \"moneybags\",\n  \"moneyless\",\n  \"moneywise\",\n  \"mongoose\",\n  \"mongrel\",\n  \"monitor\",\n  \"monkhood\",\n  \"monogamy\",\n  \"monogram\",\n  \"monologue\",\n  \"monopoly\",\n  \"monorail\",\n  \"monotone\",\n  \"monotype\",\n  \"monoxide\",\n  \"monsieur\",\n  \"monsoon\",\n  \"monstrous\",\n  \"monthly\",\n  \"monument\",\n  \"moocher\",\n  \"moodiness\",\n  \"moody\",\n  \"mooing\",\n  \"moonbeam\",\n  \"mooned\",\n  \"moonlight\",\n  \"moonlike\",\n  \"moonlit\",\n  \"moonrise\",\n  \"moonscape\",\n  \"moonshine\",\n  \"moonstone\",\n  \"moonwalk\",\n  \"mop\",\n  \"morale\",\n  \"morality\",\n  \"morally\",\n  \"morbidity\",\n  \"morbidly\",\n  \"morphine\",\n  \"morphing\",\n  \"morse\",\n  \"mortality\",\n  \"mortally\",\n  \"mortician\",\n  \"mortified\",\n  \"mortify\",\n  \"mortuary\",\n  \"mosaic\",\n  \"mossy\",\n  \"most\",\n  \"mothball\",\n  \"mothproof\",\n  \"motion\",\n  \"motivate\",\n  \"motivator\",\n  \"motive\",\n  \"motocross\",\n  \"motor\",\n  \"motto\",\n  \"mountable\",\n  \"mountain\",\n  \"mounted\",\n  \"mounting\",\n  \"mourner\",\n  \"mournful\",\n  \"mouse\",\n  \"mousiness\",\n  \"moustache\",\n  \"mousy\",\n  \"mouth\",\n  \"movable\",\n  \"move\",\n  \"movie\",\n  \"moving\",\n  \"mower\",\n  \"mowing\",\n  \"much\",\n  \"muck\",\n  \"mud\",\n  \"mug\",\n  \"mulberry\",\n  \"mulch\",\n  \"mule\",\n  \"mulled\",\n  \"mullets\",\n  \"multiple\",\n  \"multiply\",\n  \"multitask\",\n  \"multitude\",\n  \"mumble\",\n  \"mumbling\",\n  \"mumbo\",\n  \"mummified\",\n  \"mummify\",\n  \"mummy\",\n  \"mumps\",\n  \"munchkin\",\n  \"mundane\",\n  \"municipal\",\n  \"muppet\",\n  \"mural\",\n  \"murkiness\",\n  \"murky\",\n  \"murmuring\",\n  \"muscular\",\n  \"museum\",\n  \"mushily\",\n  \"mushiness\",\n  \"mushroom\",\n  \"mushy\",\n  \"music\",\n  \"musket\",\n  \"muskiness\",\n  \"musky\",\n  \"mustang\",\n  \"mustard\",\n  \"muster\",\n  \"mustiness\",\n  \"musty\",\n  \"mutable\",\n  \"mutate\",\n  \"mutation\",\n  \"mute\",\n  \"mutilated\",\n  \"mutilator\",\n  \"mutiny\",\n  \"mutt\",\n  \"mutual\",\n  \"muzzle\",\n  \"myself\",\n  \"myspace\",\n  \"mystified\",\n  \"mystify\",\n  \"myth\",\n  \"nacho\",\n  \"nag\",\n  \"nail\",\n  \"name\",\n  \"naming\",\n  \"nanny\",\n  \"nanometer\",\n  \"nape\",\n  \"napkin\",\n  \"napped\",\n  \"napping\",\n  \"nappy\",\n  \"narrow\",\n  \"nastily\",\n  \"nastiness\",\n  \"national\",\n  \"native\",\n  \"nativity\",\n  \"natural\",\n  \"nature\",\n  \"naturist\",\n  \"nautical\",\n  \"navigate\",\n  \"navigator\",\n  \"navy\",\n  \"nearby\",\n  \"nearest\",\n  \"nearly\",\n  \"nearness\",\n  \"neatly\",\n  \"neatness\",\n  \"nebula\",\n  \"nebulizer\",\n  \"nectar\",\n  \"negate\",\n  \"negation\",\n  \"negative\",\n  \"neglector\",\n  \"negligee\",\n  \"negligent\",\n  \"negotiate\",\n  \"nemeses\",\n  \"nemesis\",\n  \"neon\",\n  \"nephew\",\n  \"nerd\",\n  \"nervous\",\n  \"nervy\",\n  \"nest\",\n  \"net\",\n  \"neurology\",\n  \"neuron\",\n  \"neurosis\",\n  \"neurotic\",\n  \"neuter\",\n  \"neutron\",\n  \"never\",\n  \"next\",\n  \"nibble\",\n  \"nickname\",\n  \"nicotine\",\n  \"niece\",\n  \"nifty\",\n  \"nimble\",\n  \"nimbly\",\n  \"nineteen\",\n  \"ninetieth\",\n  \"ninja\",\n  \"nintendo\",\n  \"ninth\",\n  \"nuclear\",\n  \"nuclei\",\n  \"nucleus\",\n  \"nugget\",\n  \"nullify\",\n  \"number\",\n  \"numbing\",\n  \"numbly\",\n  \"numbness\",\n  \"numeral\",\n  \"numerate\",\n  \"numerator\",\n  \"numeric\",\n  \"numerous\",\n  \"nuptials\",\n  \"nursery\",\n  \"nursing\",\n  \"nurture\",\n  \"nutcase\",\n  \"nutlike\",\n  \"nutmeg\",\n  \"nutrient\",\n  \"nutshell\",\n  \"nuttiness\",\n  \"nutty\",\n  \"nuzzle\",\n  \"nylon\",\n  \"oaf\",\n  \"oak\",\n  \"oasis\",\n  \"oat\",\n  \"obedience\",\n  \"obedient\",\n  \"obituary\",\n  \"object\",\n  \"obligate\",\n  \"obliged\",\n  \"oblivion\",\n  \"oblivious\",\n  \"oblong\",\n  \"obnoxious\",\n  \"oboe\",\n  \"obscure\",\n  \"obscurity\",\n  \"observant\",\n  \"observer\",\n  \"observing\",\n  \"obsessed\",\n  \"obsession\",\n  \"obsessive\",\n  \"obsolete\",\n  \"obstacle\",\n  \"obstinate\",\n  \"obstruct\",\n  \"obtain\",\n  \"obtrusive\",\n  \"obtuse\",\n  \"obvious\",\n  \"occultist\",\n  \"occupancy\",\n  \"occupant\",\n  \"occupier\",\n  \"occupy\",\n  \"ocean\",\n  \"ocelot\",\n  \"octagon\",\n  \"octane\",\n  \"october\",\n  \"octopus\",\n  \"ogle\",\n  \"oil\",\n  \"oink\",\n  \"ointment\",\n  \"okay\",\n  \"old\",\n  \"olive\",\n  \"olympics\",\n  \"omega\",\n  \"omen\",\n  \"ominous\",\n  \"omission\",\n  \"omit\",\n  \"omnivore\",\n  \"onboard\",\n  \"oncoming\",\n  \"ongoing\",\n  \"onion\",\n  \"online\",\n  \"onlooker\",\n  \"only\",\n  \"onscreen\",\n  \"onset\",\n  \"onshore\",\n  \"onslaught\",\n  \"onstage\",\n  \"onto\",\n  \"onward\",\n  \"onyx\",\n  \"oops\",\n  \"ooze\",\n  \"oozy\",\n  \"opacity\",\n  \"opal\",\n  \"open\",\n  \"operable\",\n  \"operate\",\n  \"operating\",\n  \"operation\",\n  \"operative\",\n  \"operator\",\n  \"opium\",\n  \"opossum\",\n  \"opponent\",\n  \"oppose\",\n  \"opposing\",\n  \"opposite\",\n  \"oppressed\",\n  \"oppressor\",\n  \"opt\",\n  \"opulently\",\n  \"osmosis\",\n  \"other\",\n  \"otter\",\n  \"ouch\",\n  \"ought\",\n  \"ounce\",\n  \"outage\",\n  \"outback\",\n  \"outbid\",\n  \"outboard\",\n  \"outbound\",\n  \"outbreak\",\n  \"outburst\",\n  \"outcast\",\n  \"outclass\",\n  \"outcome\",\n  \"outdated\",\n  \"outdoors\",\n  \"outer\",\n  \"outfield\",\n  \"outfit\",\n  \"outflank\",\n  \"outgoing\",\n  \"outgrow\",\n  \"outhouse\",\n  \"outing\",\n  \"outlast\",\n  \"outlet\",\n  \"outline\",\n  \"outlook\",\n  \"outlying\",\n  \"outmatch\",\n  \"outmost\",\n  \"outnumber\",\n  \"outplayed\",\n  \"outpost\",\n  \"outpour\",\n  \"output\",\n  \"outrage\",\n  \"outrank\",\n  \"outreach\",\n  \"outright\",\n  \"outscore\",\n  \"outsell\",\n  \"outshine\",\n  \"outshoot\",\n  \"outsider\",\n  \"outskirts\",\n  \"outsmart\",\n  \"outsource\",\n  \"outspoken\",\n  \"outtakes\",\n  \"outthink\",\n  \"outward\",\n  \"outweigh\",\n  \"outwit\",\n  \"oval\",\n  \"ovary\",\n  \"oven\",\n  \"overact\",\n  \"overall\",\n  \"overarch\",\n  \"overbid\",\n  \"overbill\",\n  \"overbite\",\n  \"overblown\",\n  \"overboard\",\n  \"overbook\",\n  \"overbuilt\",\n  \"overcast\",\n  \"overcoat\",\n  \"overcome\",\n  \"overcook\",\n  \"overcrowd\",\n  \"overdraft\",\n  \"overdrawn\",\n  \"overdress\",\n  \"overdrive\",\n  \"overdue\",\n  \"overeager\",\n  \"overeater\",\n  \"overexert\",\n  \"overfed\",\n  \"overfeed\",\n  \"overfill\",\n  \"overflow\",\n  \"overfull\",\n  \"overgrown\",\n  \"overhand\",\n  \"overhang\",\n  \"overhaul\",\n  \"overhead\",\n  \"overhear\",\n  \"overheat\",\n  \"overhung\",\n  \"overjoyed\",\n  \"overkill\",\n  \"overlabor\",\n  \"overlaid\",\n  \"overlap\",\n  \"overlay\",\n  \"overload\",\n  \"overlook\",\n  \"overlord\",\n  \"overlying\",\n  \"overnight\",\n  \"overpass\",\n  \"overpay\",\n  \"overplant\",\n  \"overplay\",\n  \"overpower\",\n  \"overprice\",\n  \"overrate\",\n  \"overreach\",\n  \"overreact\",\n  \"override\",\n  \"overripe\",\n  \"overrule\",\n  \"overrun\",\n  \"overshoot\",\n  \"overshot\",\n  \"oversight\",\n  \"oversized\",\n  \"oversleep\",\n  \"oversold\",\n  \"overspend\",\n  \"overstate\",\n  \"overstay\",\n  \"overstep\",\n  \"overstock\",\n  \"overstuff\",\n  \"oversweet\",\n  \"overtake\",\n  \"overthrow\",\n  \"overtime\",\n  \"overtly\",\n  \"overtone\",\n  \"overture\",\n  \"overturn\",\n  \"overuse\",\n  \"overvalue\",\n  \"overview\",\n  \"overwrite\",\n  \"owl\",\n  \"oxford\",\n  \"oxidant\",\n  \"oxidation\",\n  \"oxidize\",\n  \"oxidizing\",\n  \"oxygen\",\n  \"oxymoron\",\n  \"oyster\",\n  \"ozone\",\n  \"paced\",\n  \"pacemaker\",\n  \"pacific\",\n  \"pacifier\",\n  \"pacifism\",\n  \"pacifist\",\n  \"pacify\",\n  \"padded\",\n  \"padding\",\n  \"paddle\",\n  \"paddling\",\n  \"padlock\",\n  \"pagan\",\n  \"pager\",\n  \"paging\",\n  \"pajamas\",\n  \"palace\",\n  \"palatable\",\n  \"palm\",\n  \"palpable\",\n  \"palpitate\",\n  \"paltry\",\n  \"pampered\",\n  \"pamperer\",\n  \"pampers\",\n  \"pamphlet\",\n  \"panama\",\n  \"pancake\",\n  \"pancreas\",\n  \"panda\",\n  \"pandemic\",\n  \"pang\",\n  \"panhandle\",\n  \"panic\",\n  \"panning\",\n  \"panorama\",\n  \"panoramic\",\n  \"panther\",\n  \"pantomime\",\n  \"pantry\",\n  \"pants\",\n  \"pantyhose\",\n  \"paparazzi\",\n  \"papaya\",\n  \"paper\",\n  \"paprika\",\n  \"papyrus\",\n  \"parabola\",\n  \"parachute\",\n  \"parade\",\n  \"paradox\",\n  \"paragraph\",\n  \"parakeet\",\n  \"paralegal\",\n  \"paralyses\",\n  \"paralysis\",\n  \"paralyze\",\n  \"paramedic\",\n  \"parameter\",\n  \"paramount\",\n  \"parasail\",\n  \"parasite\",\n  \"parasitic\",\n  \"parcel\",\n  \"parched\",\n  \"parchment\",\n  \"pardon\",\n  \"parish\",\n  \"parka\",\n  \"parking\",\n  \"parkway\",\n  \"parlor\",\n  \"parmesan\",\n  \"parole\",\n  \"parrot\",\n  \"parsley\",\n  \"parsnip\",\n  \"partake\",\n  \"parted\",\n  \"parting\",\n  \"partition\",\n  \"partly\",\n  \"partner\",\n  \"partridge\",\n  \"party\",\n  \"passable\",\n  \"passably\",\n  \"passage\",\n  \"passcode\",\n  \"passenger\",\n  \"passerby\",\n  \"passing\",\n  \"passion\",\n  \"passive\",\n  \"passivism\",\n  \"passover\",\n  \"passport\",\n  \"password\",\n  \"pasta\",\n  \"pasted\",\n  \"pastel\",\n  \"pastime\",\n  \"pastor\",\n  \"pastrami\",\n  \"pasture\",\n  \"pasty\",\n  \"patchwork\",\n  \"patchy\",\n  \"paternal\",\n  \"paternity\",\n  \"path\",\n  \"patience\",\n  \"patient\",\n  \"patio\",\n  \"patriarch\",\n  \"patriot\",\n  \"patrol\",\n  \"patronage\",\n  \"patronize\",\n  \"pauper\",\n  \"pavement\",\n  \"paver\",\n  \"pavestone\",\n  \"pavilion\",\n  \"paving\",\n  \"pawing\",\n  \"payable\",\n  \"payback\",\n  \"paycheck\",\n  \"payday\",\n  \"payee\",\n  \"payer\",\n  \"paying\",\n  \"payment\",\n  \"payphone\",\n  \"payroll\",\n  \"pebble\",\n  \"pebbly\",\n  \"pecan\",\n  \"pectin\",\n  \"peculiar\",\n  \"peddling\",\n  \"pediatric\",\n  \"pedicure\",\n  \"pedigree\",\n  \"pedometer\",\n  \"pegboard\",\n  \"pelican\",\n  \"pellet\",\n  \"pelt\",\n  \"pelvis\",\n  \"penalize\",\n  \"penalty\",\n  \"pencil\",\n  \"pendant\",\n  \"pending\",\n  \"penholder\",\n  \"penknife\",\n  \"pennant\",\n  \"penniless\",\n  \"penny\",\n  \"penpal\",\n  \"pension\",\n  \"pentagon\",\n  \"pentagram\",\n  \"pep\",\n  \"perceive\",\n  \"percent\",\n  \"perch\",\n  \"percolate\",\n  \"perennial\",\n  \"perfected\",\n  \"perfectly\",\n  \"perfume\",\n  \"periscope\",\n  \"perish\",\n  \"perjurer\",\n  \"perjury\",\n  \"perkiness\",\n  \"perky\",\n  \"perm\",\n  \"peroxide\",\n  \"perpetual\",\n  \"perplexed\",\n  \"persecute\",\n  \"persevere\",\n  \"persuaded\",\n  \"persuader\",\n  \"pesky\",\n  \"peso\",\n  \"pessimism\",\n  \"pessimist\",\n  \"pester\",\n  \"pesticide\",\n  \"petal\",\n  \"petite\",\n  \"petition\",\n  \"petri\",\n  \"petroleum\",\n  \"petted\",\n  \"petticoat\",\n  \"pettiness\",\n  \"petty\",\n  \"petunia\",\n  \"phantom\",\n  \"phobia\",\n  \"phoenix\",\n  \"phonebook\",\n  \"phoney\",\n  \"phonics\",\n  \"phoniness\",\n  \"phony\",\n  \"phosphate\",\n  \"photo\",\n  \"phrase\",\n  \"phrasing\",\n  \"placard\",\n  \"placate\",\n  \"placidly\",\n  \"plank\",\n  \"planner\",\n  \"plant\",\n  \"plasma\",\n  \"plaster\",\n  \"plastic\",\n  \"plated\",\n  \"platform\",\n  \"plating\",\n  \"platinum\",\n  \"platonic\",\n  \"platter\",\n  \"platypus\",\n  \"plausible\",\n  \"plausibly\",\n  \"playable\",\n  \"playback\",\n  \"player\",\n  \"playful\",\n  \"playgroup\",\n  \"playhouse\",\n  \"playing\",\n  \"playlist\",\n  \"playmaker\",\n  \"playmate\",\n  \"playoff\",\n  \"playpen\",\n  \"playroom\",\n  \"playset\",\n  \"plaything\",\n  \"playtime\",\n  \"plaza\",\n  \"pleading\",\n  \"pleat\",\n  \"pledge\",\n  \"plentiful\",\n  \"plenty\",\n  \"plethora\",\n  \"plexiglas\",\n  \"pliable\",\n  \"plod\",\n  \"plop\",\n  \"plot\",\n  \"plow\",\n  \"ploy\",\n  \"pluck\",\n  \"plug\",\n  \"plunder\",\n  \"plunging\",\n  \"plural\",\n  \"plus\",\n  \"plutonium\",\n  \"plywood\",\n  \"poach\",\n  \"pod\",\n  \"poem\",\n  \"poet\",\n  \"pogo\",\n  \"pointed\",\n  \"pointer\",\n  \"pointing\",\n  \"pointless\",\n  \"pointy\",\n  \"poise\",\n  \"poison\",\n  \"poker\",\n  \"poking\",\n  \"polar\",\n  \"police\",\n  \"policy\",\n  \"polio\",\n  \"polish\",\n  \"politely\",\n  \"polka\",\n  \"polo\",\n  \"polyester\",\n  \"polygon\",\n  \"polygraph\",\n  \"polymer\",\n  \"poncho\",\n  \"pond\",\n  \"pony\",\n  \"popcorn\",\n  \"pope\",\n  \"poplar\",\n  \"popper\",\n  \"poppy\",\n  \"popsicle\",\n  \"populace\",\n  \"popular\",\n  \"populate\",\n  \"porcupine\",\n  \"pork\",\n  \"porous\",\n  \"porridge\",\n  \"portable\",\n  \"portal\",\n  \"portfolio\",\n  \"porthole\",\n  \"portion\",\n  \"portly\",\n  \"portside\",\n  \"poser\",\n  \"posh\",\n  \"posing\",\n  \"possible\",\n  \"possibly\",\n  \"possum\",\n  \"postage\",\n  \"postal\",\n  \"postbox\",\n  \"postcard\",\n  \"posted\",\n  \"poster\",\n  \"posting\",\n  \"postnasal\",\n  \"posture\",\n  \"postwar\",\n  \"pouch\",\n  \"pounce\",\n  \"pouncing\",\n  \"pound\",\n  \"pouring\",\n  \"pout\",\n  \"powdered\",\n  \"powdering\",\n  \"powdery\",\n  \"power\",\n  \"powwow\",\n  \"pox\",\n  \"praising\",\n  \"prance\",\n  \"prancing\",\n  \"pranker\",\n  \"prankish\",\n  \"prankster\",\n  \"prayer\",\n  \"praying\",\n  \"preacher\",\n  \"preaching\",\n  \"preachy\",\n  \"preamble\",\n  \"precinct\",\n  \"precise\",\n  \"precision\",\n  \"precook\",\n  \"precut\",\n  \"predator\",\n  \"predefine\",\n  \"predict\",\n  \"preface\",\n  \"prefix\",\n  \"preflight\",\n  \"preformed\",\n  \"pregame\",\n  \"pregnancy\",\n  \"pregnant\",\n  \"preheated\",\n  \"prelaunch\",\n  \"prelaw\",\n  \"prelude\",\n  \"premiere\",\n  \"premises\",\n  \"premium\",\n  \"prenatal\",\n  \"preoccupy\",\n  \"preorder\",\n  \"prepaid\",\n  \"prepay\",\n  \"preplan\",\n  \"preppy\",\n  \"preschool\",\n  \"prescribe\",\n  \"preseason\",\n  \"preset\",\n  \"preshow\",\n  \"president\",\n  \"presoak\",\n  \"press\",\n  \"presume\",\n  \"presuming\",\n  \"preteen\",\n  \"pretended\",\n  \"pretender\",\n  \"pretense\",\n  \"pretext\",\n  \"pretty\",\n  \"pretzel\",\n  \"prevail\",\n  \"prevalent\",\n  \"prevent\",\n  \"preview\",\n  \"previous\",\n  \"prewar\",\n  \"prewashed\",\n  \"prideful\",\n  \"pried\",\n  \"primal\",\n  \"primarily\",\n  \"primary\",\n  \"primate\",\n  \"primer\",\n  \"primp\",\n  \"princess\",\n  \"print\",\n  \"prior\",\n  \"prism\",\n  \"prison\",\n  \"prissy\",\n  \"pristine\",\n  \"privacy\",\n  \"private\",\n  \"privatize\",\n  \"prize\",\n  \"proactive\",\n  \"probable\",\n  \"probably\",\n  \"probation\",\n  \"probe\",\n  \"probing\",\n  \"probiotic\",\n  \"problem\",\n  \"procedure\",\n  \"process\",\n  \"proclaim\",\n  \"procreate\",\n  \"procurer\",\n  \"prodigal\",\n  \"prodigy\",\n  \"produce\",\n  \"product\",\n  \"profane\",\n  \"profanity\",\n  \"professed\",\n  \"professor\",\n  \"profile\",\n  \"profound\",\n  \"profusely\",\n  \"progeny\",\n  \"prognosis\",\n  \"program\",\n  \"progress\",\n  \"projector\",\n  \"prologue\",\n  \"prolonged\",\n  \"promenade\",\n  \"prominent\",\n  \"promoter\",\n  \"promotion\",\n  \"prompter\",\n  \"promptly\",\n  \"prone\",\n  \"prong\",\n  \"pronounce\",\n  \"pronto\",\n  \"proofing\",\n  \"proofread\",\n  \"proofs\",\n  \"propeller\",\n  \"properly\",\n  \"property\",\n  \"proponent\",\n  \"proposal\",\n  \"propose\",\n  \"props\",\n  \"prorate\",\n  \"protector\",\n  \"protegee\",\n  \"proton\",\n  \"prototype\",\n  \"protozoan\",\n  \"protract\",\n  \"protrude\",\n  \"proud\",\n  \"provable\",\n  \"proved\",\n  \"proven\",\n  \"provided\",\n  \"provider\",\n  \"providing\",\n  \"province\",\n  \"proving\",\n  \"provoke\",\n  \"provoking\",\n  \"provolone\",\n  \"prowess\",\n  \"prowler\",\n  \"prowling\",\n  \"proximity\",\n  \"proxy\",\n  \"prozac\",\n  \"prude\",\n  \"prudishly\",\n  \"prune\",\n  \"pruning\",\n  \"pry\",\n  \"psychic\",\n  \"public\",\n  \"publisher\",\n  \"pucker\",\n  \"pueblo\",\n  \"pug\",\n  \"pull\",\n  \"pulmonary\",\n  \"pulp\",\n  \"pulsate\",\n  \"pulse\",\n  \"pulverize\",\n  \"puma\",\n  \"pumice\",\n  \"pummel\",\n  \"punch\",\n  \"punctual\",\n  \"punctuate\",\n  \"punctured\",\n  \"pungent\",\n  \"punisher\",\n  \"punk\",\n  \"pupil\",\n  \"puppet\",\n  \"puppy\",\n  \"purchase\",\n  \"pureblood\",\n  \"purebred\",\n  \"purely\",\n  \"pureness\",\n  \"purgatory\",\n  \"purge\",\n  \"purging\",\n  \"purifier\",\n  \"purify\",\n  \"purist\",\n  \"puritan\",\n  \"purity\",\n  \"purple\",\n  \"purplish\",\n  \"purposely\",\n  \"purr\",\n  \"purse\",\n  \"pursuable\",\n  \"pursuant\",\n  \"pursuit\",\n  \"purveyor\",\n  \"pushcart\",\n  \"pushchair\",\n  \"pusher\",\n  \"pushiness\",\n  \"pushing\",\n  \"pushover\",\n  \"pushpin\",\n  \"pushup\",\n  \"pushy\",\n  \"putdown\",\n  \"putt\",\n  \"puzzle\",\n  \"puzzling\",\n  \"pyramid\",\n  \"pyromania\",\n  \"python\",\n  \"quack\",\n  \"quadrant\",\n  \"quail\",\n  \"quaintly\",\n  \"quake\",\n  \"quaking\",\n  \"qualified\",\n  \"qualifier\",\n  \"qualify\",\n  \"quality\",\n  \"qualm\",\n  \"quantum\",\n  \"quarrel\",\n  \"quarry\",\n  \"quartered\",\n  \"quarterly\",\n  \"quarters\",\n  \"quartet\",\n  \"quench\",\n  \"query\",\n  \"quicken\",\n  \"quickly\",\n  \"quickness\",\n  \"quicksand\",\n  \"quickstep\",\n  \"quiet\",\n  \"quill\",\n  \"quilt\",\n  \"quintet\",\n  \"quintuple\",\n  \"quirk\",\n  \"quit\",\n  \"quiver\",\n  \"quizzical\",\n  \"quotable\",\n  \"quotation\",\n  \"quote\",\n  \"rabid\",\n  \"race\",\n  \"racing\",\n  \"racism\",\n  \"rack\",\n  \"racoon\",\n  \"radar\",\n  \"radial\",\n  \"radiance\",\n  \"radiantly\",\n  \"radiated\",\n  \"radiation\",\n  \"radiator\",\n  \"radio\",\n  \"radish\",\n  \"raffle\",\n  \"raft\",\n  \"rage\",\n  \"ragged\",\n  \"raging\",\n  \"ragweed\",\n  \"raider\",\n  \"railcar\",\n  \"railing\",\n  \"railroad\",\n  \"railway\",\n  \"raisin\",\n  \"rake\",\n  \"raking\",\n  \"rally\",\n  \"ramble\",\n  \"rambling\",\n  \"ramp\",\n  \"ramrod\",\n  \"ranch\",\n  \"rancidity\",\n  \"random\",\n  \"ranged\",\n  \"ranger\",\n  \"ranging\",\n  \"ranked\",\n  \"ranking\",\n  \"ransack\",\n  \"ranting\",\n  \"rants\",\n  \"rare\",\n  \"rarity\",\n  \"rascal\",\n  \"rash\",\n  \"rasping\",\n  \"ravage\",\n  \"raven\",\n  \"ravine\",\n  \"raving\",\n  \"ravioli\",\n  \"ravishing\",\n  \"reabsorb\",\n  \"reach\",\n  \"reacquire\",\n  \"reaction\",\n  \"reactive\",\n  \"reactor\",\n  \"reaffirm\",\n  \"ream\",\n  \"reanalyze\",\n  \"reappear\",\n  \"reapply\",\n  \"reappoint\",\n  \"reapprove\",\n  \"rearrange\",\n  \"rearview\",\n  \"reason\",\n  \"reassign\",\n  \"reassure\",\n  \"reattach\",\n  \"reawake\",\n  \"rebalance\",\n  \"rebate\",\n  \"rebel\",\n  \"rebirth\",\n  \"reboot\",\n  \"reborn\",\n  \"rebound\",\n  \"rebuff\",\n  \"rebuild\",\n  \"rebuilt\",\n  \"reburial\",\n  \"rebuttal\",\n  \"recall\",\n  \"recant\",\n  \"recapture\",\n  \"recast\",\n  \"recede\",\n  \"recent\",\n  \"recess\",\n  \"recharger\",\n  \"recipient\",\n  \"recital\",\n  \"recite\",\n  \"reckless\",\n  \"reclaim\",\n  \"recliner\",\n  \"reclining\",\n  \"recluse\",\n  \"reclusive\",\n  \"recognize\",\n  \"recoil\",\n  \"recollect\",\n  \"recolor\",\n  \"reconcile\",\n  \"reconfirm\",\n  \"reconvene\",\n  \"recopy\",\n  \"record\",\n  \"recount\",\n  \"recoup\",\n  \"recovery\",\n  \"recreate\",\n  \"rectal\",\n  \"rectangle\",\n  \"rectified\",\n  \"rectify\",\n  \"recycled\",\n  \"recycler\",\n  \"recycling\",\n  \"reemerge\",\n  \"reenact\",\n  \"reenter\",\n  \"reentry\",\n  \"reexamine\",\n  \"referable\",\n  \"referee\",\n  \"reference\",\n  \"refill\",\n  \"refinance\",\n  \"refined\",\n  \"refinery\",\n  \"refining\",\n  \"refinish\",\n  \"reflected\",\n  \"reflector\",\n  \"reflex\",\n  \"reflux\",\n  \"refocus\",\n  \"refold\",\n  \"reforest\",\n  \"reformat\",\n  \"reformed\",\n  \"reformer\",\n  \"reformist\",\n  \"refract\",\n  \"refrain\",\n  \"refreeze\",\n  \"refresh\",\n  \"refried\",\n  \"refueling\",\n  \"refund\",\n  \"refurbish\",\n  \"refurnish\",\n  \"refusal\",\n  \"refuse\",\n  \"refusing\",\n  \"refutable\",\n  \"refute\",\n  \"regain\",\n  \"regalia\",\n  \"regally\",\n  \"reggae\",\n  \"regime\",\n  \"region\",\n  \"register\",\n  \"registrar\",\n  \"registry\",\n  \"regress\",\n  \"regretful\",\n  \"regroup\",\n  \"regular\",\n  \"regulate\",\n  \"regulator\",\n  \"rehab\",\n  \"reheat\",\n  \"rehire\",\n  \"rehydrate\",\n  \"reimburse\",\n  \"reissue\",\n  \"reiterate\",\n  \"rejoice\",\n  \"rejoicing\",\n  \"rejoin\",\n  \"rekindle\",\n  \"relapse\",\n  \"relapsing\",\n  \"relatable\",\n  \"related\",\n  \"relation\",\n  \"relative\",\n  \"relax\",\n  \"relay\",\n  \"relearn\",\n  \"release\",\n  \"relenting\",\n  \"reliable\",\n  \"reliably\",\n  \"reliance\",\n  \"reliant\",\n  \"relic\",\n  \"relieve\",\n  \"relieving\",\n  \"relight\",\n  \"relish\",\n  \"relive\",\n  \"reload\",\n  \"relocate\",\n  \"relock\",\n  \"reluctant\",\n  \"rely\",\n  \"remake\",\n  \"remark\",\n  \"remarry\",\n  \"rematch\",\n  \"remedial\",\n  \"remedy\",\n  \"remember\",\n  \"reminder\",\n  \"remindful\",\n  \"remission\",\n  \"remix\",\n  \"remnant\",\n  \"remodeler\",\n  \"remold\",\n  \"remorse\",\n  \"remote\",\n  \"removable\",\n  \"removal\",\n  \"removed\",\n  \"remover\",\n  \"removing\",\n  \"rename\",\n  \"renderer\",\n  \"rendering\",\n  \"rendition\",\n  \"renegade\",\n  \"renewable\",\n  \"renewably\",\n  \"renewal\",\n  \"renewed\",\n  \"renounce\",\n  \"renovate\",\n  \"renovator\",\n  \"rentable\",\n  \"rental\",\n  \"rented\",\n  \"renter\",\n  \"reoccupy\",\n  \"reoccur\",\n  \"reopen\",\n  \"reorder\",\n  \"repackage\",\n  \"repacking\",\n  \"repaint\",\n  \"repair\",\n  \"repave\",\n  \"repaying\",\n  \"repayment\",\n  \"repeal\",\n  \"repeated\",\n  \"repeater\",\n  \"repent\",\n  \"rephrase\",\n  \"replace\",\n  \"replay\",\n  \"replica\",\n  \"reply\",\n  \"reporter\",\n  \"repose\",\n  \"repossess\",\n  \"repost\",\n  \"repressed\",\n  \"reprimand\",\n  \"reprint\",\n  \"reprise\",\n  \"reproach\",\n  \"reprocess\",\n  \"reproduce\",\n  \"reprogram\",\n  \"reps\",\n  \"reptile\",\n  \"reptilian\",\n  \"repugnant\",\n  \"repulsion\",\n  \"repulsive\",\n  \"repurpose\",\n  \"reputable\",\n  \"reputably\",\n  \"request\",\n  \"require\",\n  \"requisite\",\n  \"reroute\",\n  \"rerun\",\n  \"resale\",\n  \"resample\",\n  \"rescuer\",\n  \"reseal\",\n  \"research\",\n  \"reselect\",\n  \"reseller\",\n  \"resemble\",\n  \"resend\",\n  \"resent\",\n  \"reset\",\n  \"reshape\",\n  \"reshoot\",\n  \"reshuffle\",\n  \"residence\",\n  \"residency\",\n  \"resident\",\n  \"residual\",\n  \"residue\",\n  \"resigned\",\n  \"resilient\",\n  \"resistant\",\n  \"resisting\",\n  \"resize\",\n  \"resolute\",\n  \"resolved\",\n  \"resonant\",\n  \"resonate\",\n  \"resort\",\n  \"resource\",\n  \"respect\",\n  \"resubmit\",\n  \"result\",\n  \"resume\",\n  \"resupply\",\n  \"resurface\",\n  \"resurrect\",\n  \"retail\",\n  \"retainer\",\n  \"retaining\",\n  \"retake\",\n  \"retaliate\",\n  \"retention\",\n  \"rethink\",\n  \"retinal\",\n  \"retired\",\n  \"retiree\",\n  \"retiring\",\n  \"retold\",\n  \"retool\",\n  \"retorted\",\n  \"retouch\",\n  \"retrace\",\n  \"retract\",\n  \"retrain\",\n  \"retread\",\n  \"retreat\",\n  \"retrial\",\n  \"retrieval\",\n  \"retriever\",\n  \"retry\",\n  \"return\",\n  \"retying\",\n  \"retype\",\n  \"reunion\",\n  \"reunite\",\n  \"reusable\",\n  \"reuse\",\n  \"reveal\",\n  \"reveler\",\n  \"revenge\",\n  \"revenue\",\n  \"reverb\",\n  \"revered\",\n  \"reverence\",\n  \"reverend\",\n  \"reversal\",\n  \"reverse\",\n  \"reversing\",\n  \"reversion\",\n  \"revert\",\n  \"revisable\",\n  \"revise\",\n  \"revision\",\n  \"revisit\",\n  \"revivable\",\n  \"revival\",\n  \"reviver\",\n  \"reviving\",\n  \"revocable\",\n  \"revoke\",\n  \"revolt\",\n  \"revolver\",\n  \"revolving\",\n  \"reward\",\n  \"rewash\",\n  \"rewind\",\n  \"rewire\",\n  \"reword\",\n  \"rework\",\n  \"rewrap\",\n  \"rewrite\",\n  \"rhyme\",\n  \"ribbon\",\n  \"ribcage\",\n  \"rice\",\n  \"riches\",\n  \"richly\",\n  \"richness\",\n  \"rickety\",\n  \"ricotta\",\n  \"riddance\",\n  \"ridden\",\n  \"ride\",\n  \"riding\",\n  \"rifling\",\n  \"rift\",\n  \"rigging\",\n  \"rigid\",\n  \"rigor\",\n  \"rimless\",\n  \"rimmed\",\n  \"rind\",\n  \"rink\",\n  \"rinse\",\n  \"rinsing\",\n  \"riot\",\n  \"ripcord\",\n  \"ripeness\",\n  \"ripening\",\n  \"ripping\",\n  \"ripple\",\n  \"rippling\",\n  \"riptide\",\n  \"rise\",\n  \"rising\",\n  \"risk\",\n  \"risotto\",\n  \"ritalin\",\n  \"ritzy\",\n  \"rival\",\n  \"riverbank\",\n  \"riverbed\",\n  \"riverboat\",\n  \"riverside\",\n  \"riveter\",\n  \"riveting\",\n  \"roamer\",\n  \"roaming\",\n  \"roast\",\n  \"robbing\",\n  \"robe\",\n  \"robin\",\n  \"robotics\",\n  \"robust\",\n  \"rockband\",\n  \"rocker\",\n  \"rocket\",\n  \"rockfish\",\n  \"rockiness\",\n  \"rocking\",\n  \"rocklike\",\n  \"rockslide\",\n  \"rockstar\",\n  \"rocky\",\n  \"rogue\",\n  \"roman\",\n  \"romp\",\n  \"rope\",\n  \"roping\",\n  \"roster\",\n  \"rosy\",\n  \"rotten\",\n  \"rotting\",\n  \"rotunda\",\n  \"roulette\",\n  \"rounding\",\n  \"roundish\",\n  \"roundness\",\n  \"roundup\",\n  \"roundworm\",\n  \"routine\",\n  \"routing\",\n  \"rover\",\n  \"roving\",\n  \"royal\",\n  \"rubbed\",\n  \"rubber\",\n  \"rubbing\",\n  \"rubble\",\n  \"rubdown\",\n  \"ruby\",\n  \"ruckus\",\n  \"rudder\",\n  \"rug\",\n  \"ruined\",\n  \"rule\",\n  \"rumble\",\n  \"rumbling\",\n  \"rummage\",\n  \"rumor\",\n  \"runaround\",\n  \"rundown\",\n  \"runner\",\n  \"running\",\n  \"runny\",\n  \"runt\",\n  \"runway\",\n  \"rupture\",\n  \"rural\",\n  \"ruse\",\n  \"rush\",\n  \"rust\",\n  \"rut\",\n  \"sabbath\",\n  \"sabotage\",\n  \"sacrament\",\n  \"sacred\",\n  \"sacrifice\",\n  \"sadden\",\n  \"saddlebag\",\n  \"saddled\",\n  \"saddling\",\n  \"sadly\",\n  \"sadness\",\n  \"safari\",\n  \"safeguard\",\n  \"safehouse\",\n  \"safely\",\n  \"safeness\",\n  \"saffron\",\n  \"saga\",\n  \"sage\",\n  \"sagging\",\n  \"saggy\",\n  \"said\",\n  \"saint\",\n  \"sake\",\n  \"salad\",\n  \"salami\",\n  \"salaried\",\n  \"salary\",\n  \"saline\",\n  \"salon\",\n  \"saloon\",\n  \"salsa\",\n  \"salt\",\n  \"salutary\",\n  \"salute\",\n  \"salvage\",\n  \"salvaging\",\n  \"salvation\",\n  \"same\",\n  \"sample\",\n  \"sampling\",\n  \"sanction\",\n  \"sanctity\",\n  \"sanctuary\",\n  \"sandal\",\n  \"sandbag\",\n  \"sandbank\",\n  \"sandbar\",\n  \"sandblast\",\n  \"sandbox\",\n  \"sanded\",\n  \"sandfish\",\n  \"sanding\",\n  \"sandlot\",\n  \"sandpaper\",\n  \"sandpit\",\n  \"sandstone\",\n  \"sandstorm\",\n  \"sandworm\",\n  \"sandy\",\n  \"sanitary\",\n  \"sanitizer\",\n  \"sank\",\n  \"santa\",\n  \"sapling\",\n  \"sappiness\",\n  \"sappy\",\n  \"sarcasm\",\n  \"sarcastic\",\n  \"sardine\",\n  \"sash\",\n  \"sasquatch\",\n  \"sassy\",\n  \"satchel\",\n  \"satiable\",\n  \"satin\",\n  \"satirical\",\n  \"satisfied\",\n  \"satisfy\",\n  \"saturate\",\n  \"saturday\",\n  \"sauciness\",\n  \"saucy\",\n  \"sauna\",\n  \"savage\",\n  \"savanna\",\n  \"saved\",\n  \"savings\",\n  \"savior\",\n  \"savor\",\n  \"saxophone\",\n  \"say\",\n  \"scabbed\",\n  \"scabby\",\n  \"scalded\",\n  \"scalding\",\n  \"scale\",\n  \"scaling\",\n  \"scallion\",\n  \"scallop\",\n  \"scalping\",\n  \"scam\",\n  \"scandal\",\n  \"scanner\",\n  \"scanning\",\n  \"scant\",\n  \"scapegoat\",\n  \"scarce\",\n  \"scarcity\",\n  \"scarecrow\",\n  \"scared\",\n  \"scarf\",\n  \"scarily\",\n  \"scariness\",\n  \"scarring\",\n  \"scary\",\n  \"scavenger\",\n  \"scenic\",\n  \"schedule\",\n  \"schematic\",\n  \"scheme\",\n  \"scheming\",\n  \"schilling\",\n  \"schnapps\",\n  \"scholar\",\n  \"science\",\n  \"scientist\",\n  \"scion\",\n  \"scoff\",\n  \"scolding\",\n  \"scone\",\n  \"scoop\",\n  \"scooter\",\n  \"scope\",\n  \"scorch\",\n  \"scorebook\",\n  \"scorecard\",\n  \"scored\",\n  \"scoreless\",\n  \"scorer\",\n  \"scoring\",\n  \"scorn\",\n  \"scorpion\",\n  \"scotch\",\n  \"scoundrel\",\n  \"scoured\",\n  \"scouring\",\n  \"scouting\",\n  \"scouts\",\n  \"scowling\",\n  \"scrabble\",\n  \"scraggly\",\n  \"scrambled\",\n  \"scrambler\",\n  \"scrap\",\n  \"scratch\",\n  \"scrawny\",\n  \"screen\",\n  \"scribble\",\n  \"scribe\",\n  \"scribing\",\n  \"scrimmage\",\n  \"script\",\n  \"scroll\",\n  \"scrooge\",\n  \"scrounger\",\n  \"scrubbed\",\n  \"scrubber\",\n  \"scruffy\",\n  \"scrunch\",\n  \"scrutiny\",\n  \"scuba\",\n  \"scuff\",\n  \"sculptor\",\n  \"sculpture\",\n  \"scurvy\",\n  \"scuttle\",\n  \"secluded\",\n  \"secluding\",\n  \"seclusion\",\n  \"second\",\n  \"secrecy\",\n  \"secret\",\n  \"sectional\",\n  \"sector\",\n  \"secular\",\n  \"securely\",\n  \"security\",\n  \"sedan\",\n  \"sedate\",\n  \"sedation\",\n  \"sedative\",\n  \"sediment\",\n  \"seduce\",\n  \"seducing\",\n  \"segment\",\n  \"seismic\",\n  \"seizing\",\n  \"seldom\",\n  \"selected\",\n  \"selection\",\n  \"selective\",\n  \"selector\",\n  \"self\",\n  \"seltzer\",\n  \"semantic\",\n  \"semester\",\n  \"semicolon\",\n  \"semifinal\",\n  \"seminar\",\n  \"semisoft\",\n  \"semisweet\",\n  \"senate\",\n  \"senator\",\n  \"send\",\n  \"senior\",\n  \"senorita\",\n  \"sensation\",\n  \"sensitive\",\n  \"sensitize\",\n  \"sensually\",\n  \"sensuous\",\n  \"sepia\",\n  \"september\",\n  \"septic\",\n  \"septum\",\n  \"sequel\",\n  \"sequence\",\n  \"sequester\",\n  \"series\",\n  \"sermon\",\n  \"serotonin\",\n  \"serpent\",\n  \"serrated\",\n  \"serve\",\n  \"service\",\n  \"serving\",\n  \"sesame\",\n  \"sessions\",\n  \"setback\",\n  \"setting\",\n  \"settle\",\n  \"settling\",\n  \"setup\",\n  \"sevenfold\",\n  \"seventeen\",\n  \"seventh\",\n  \"seventy\",\n  \"severity\",\n  \"shabby\",\n  \"shack\",\n  \"shaded\",\n  \"shadily\",\n  \"shadiness\",\n  \"shading\",\n  \"shadow\",\n  \"shady\",\n  \"shaft\",\n  \"shakable\",\n  \"shakily\",\n  \"shakiness\",\n  \"shaking\",\n  \"shaky\",\n  \"shale\",\n  \"shallot\",\n  \"shallow\",\n  \"shame\",\n  \"shampoo\",\n  \"shamrock\",\n  \"shank\",\n  \"shanty\",\n  \"shape\",\n  \"shaping\",\n  \"share\",\n  \"sharpener\",\n  \"sharper\",\n  \"sharpie\",\n  \"sharply\",\n  \"sharpness\",\n  \"shawl\",\n  \"sheath\",\n  \"shed\",\n  \"sheep\",\n  \"sheet\",\n  \"shelf\",\n  \"shell\",\n  \"shelter\",\n  \"shelve\",\n  \"shelving\",\n  \"sherry\",\n  \"shield\",\n  \"shifter\",\n  \"shifting\",\n  \"shiftless\",\n  \"shifty\",\n  \"shimmer\",\n  \"shimmy\",\n  \"shindig\",\n  \"shine\",\n  \"shingle\",\n  \"shininess\",\n  \"shining\",\n  \"shiny\",\n  \"ship\",\n  \"shirt\",\n  \"shivering\",\n  \"shock\",\n  \"shone\",\n  \"shoplift\",\n  \"shopper\",\n  \"shopping\",\n  \"shoptalk\",\n  \"shore\",\n  \"shortage\",\n  \"shortcake\",\n  \"shortcut\",\n  \"shorten\",\n  \"shorter\",\n  \"shorthand\",\n  \"shortlist\",\n  \"shortly\",\n  \"shortness\",\n  \"shorts\",\n  \"shortwave\",\n  \"shorty\",\n  \"shout\",\n  \"shove\",\n  \"showbiz\",\n  \"showcase\",\n  \"showdown\",\n  \"shower\",\n  \"showgirl\",\n  \"showing\",\n  \"showman\",\n  \"shown\",\n  \"showoff\",\n  \"showpiece\",\n  \"showplace\",\n  \"showroom\",\n  \"showy\",\n  \"shrank\",\n  \"shrapnel\",\n  \"shredder\",\n  \"shredding\",\n  \"shrewdly\",\n  \"shriek\",\n  \"shrill\",\n  \"shrimp\",\n  \"shrine\",\n  \"shrink\",\n  \"shrivel\",\n  \"shrouded\",\n  \"shrubbery\",\n  \"shrubs\",\n  \"shrug\",\n  \"shrunk\",\n  \"shucking\",\n  \"shudder\",\n  \"shuffle\",\n  \"shuffling\",\n  \"shun\",\n  \"shush\",\n  \"shut\",\n  \"shy\",\n  \"siamese\",\n  \"siberian\",\n  \"sibling\",\n  \"siding\",\n  \"sierra\",\n  \"siesta\",\n  \"sift\",\n  \"sighing\",\n  \"silenced\",\n  \"silencer\",\n  \"silent\",\n  \"silica\",\n  \"silicon\",\n  \"silk\",\n  \"silliness\",\n  \"silly\",\n  \"silo\",\n  \"silt\",\n  \"silver\",\n  \"similarly\",\n  \"simile\",\n  \"simmering\",\n  \"simple\",\n  \"simplify\",\n  \"simply\",\n  \"sincere\",\n  \"sincerity\",\n  \"singer\",\n  \"singing\",\n  \"single\",\n  \"singular\",\n  \"sinister\",\n  \"sinless\",\n  \"sinner\",\n  \"sinuous\",\n  \"sip\",\n  \"siren\",\n  \"sister\",\n  \"sitcom\",\n  \"sitter\",\n  \"sitting\",\n  \"situated\",\n  \"situation\",\n  \"sixfold\",\n  \"sixteen\",\n  \"sixth\",\n  \"sixties\",\n  \"sixtieth\",\n  \"sixtyfold\",\n  \"sizable\",\n  \"sizably\",\n  \"size\",\n  \"sizing\",\n  \"sizzle\",\n  \"sizzling\",\n  \"skater\",\n  \"skating\",\n  \"skedaddle\",\n  \"skeletal\",\n  \"skeleton\",\n  \"skeptic\",\n  \"sketch\",\n  \"skewed\",\n  \"skewer\",\n  \"skid\",\n  \"skied\",\n  \"skier\",\n  \"skies\",\n  \"skiing\",\n  \"skilled\",\n  \"skillet\",\n  \"skillful\",\n  \"skimmed\",\n  \"skimmer\",\n  \"skimming\",\n  \"skimpily\",\n  \"skincare\",\n  \"skinhead\",\n  \"skinless\",\n  \"skinning\",\n  \"skinny\",\n  \"skintight\",\n  \"skipper\",\n  \"skipping\",\n  \"skirmish\",\n  \"skirt\",\n  \"skittle\",\n  \"skydiver\",\n  \"skylight\",\n  \"skyline\",\n  \"skype\",\n  \"skyrocket\",\n  \"skyward\",\n  \"slab\",\n  \"slacked\",\n  \"slacker\",\n  \"slacking\",\n  \"slackness\",\n  \"slacks\",\n  \"slain\",\n  \"slam\",\n  \"slander\",\n  \"slang\",\n  \"slapping\",\n  \"slapstick\",\n  \"slashed\",\n  \"slashing\",\n  \"slate\",\n  \"slather\",\n  \"slaw\",\n  \"sled\",\n  \"sleek\",\n  \"sleep\",\n  \"sleet\",\n  \"sleeve\",\n  \"slept\",\n  \"sliceable\",\n  \"sliced\",\n  \"slicer\",\n  \"slicing\",\n  \"slick\",\n  \"slider\",\n  \"slideshow\",\n  \"sliding\",\n  \"slighted\",\n  \"slighting\",\n  \"slightly\",\n  \"slimness\",\n  \"slimy\",\n  \"slinging\",\n  \"slingshot\",\n  \"slinky\",\n  \"slip\",\n  \"slit\",\n  \"sliver\",\n  \"slobbery\",\n  \"slogan\",\n  \"sloped\",\n  \"sloping\",\n  \"sloppily\",\n  \"sloppy\",\n  \"slot\",\n  \"slouching\",\n  \"slouchy\",\n  \"sludge\",\n  \"slug\",\n  \"slum\",\n  \"slurp\",\n  \"slush\",\n  \"sly\",\n  \"small\",\n  \"smartly\",\n  \"smartness\",\n  \"smasher\",\n  \"smashing\",\n  \"smashup\",\n  \"smell\",\n  \"smelting\",\n  \"smile\",\n  \"smilingly\",\n  \"smirk\",\n  \"smite\",\n  \"smith\",\n  \"smitten\",\n  \"smock\",\n  \"smog\",\n  \"smoked\",\n  \"smokeless\",\n  \"smokiness\",\n  \"smoking\",\n  \"smoky\",\n  \"smolder\",\n  \"smooth\",\n  \"smother\",\n  \"smudge\",\n  \"smudgy\",\n  \"smuggler\",\n  \"smuggling\",\n  \"smugly\",\n  \"smugness\",\n  \"snack\",\n  \"snagged\",\n  \"snaking\",\n  \"snap\",\n  \"snare\",\n  \"snarl\",\n  \"snazzy\",\n  \"sneak\",\n  \"sneer\",\n  \"sneeze\",\n  \"sneezing\",\n  \"snide\",\n  \"sniff\",\n  \"snippet\",\n  \"snipping\",\n  \"snitch\",\n  \"snooper\",\n  \"snooze\",\n  \"snore\",\n  \"snoring\",\n  \"snorkel\",\n  \"snort\",\n  \"snout\",\n  \"snowbird\",\n  \"snowboard\",\n  \"snowbound\",\n  \"snowcap\",\n  \"snowdrift\",\n  \"snowdrop\",\n  \"snowfall\",\n  \"snowfield\",\n  \"snowflake\",\n  \"snowiness\",\n  \"snowless\",\n  \"snowman\",\n  \"snowplow\",\n  \"snowshoe\",\n  \"snowstorm\",\n  \"snowsuit\",\n  \"snowy\",\n  \"snub\",\n  \"snuff\",\n  \"snuggle\",\n  \"snugly\",\n  \"snugness\",\n  \"speak\",\n  \"spearfish\",\n  \"spearhead\",\n  \"spearman\",\n  \"spearmint\",\n  \"species\",\n  \"specimen\",\n  \"specked\",\n  \"speckled\",\n  \"specks\",\n  \"spectacle\",\n  \"spectator\",\n  \"spectrum\",\n  \"speculate\",\n  \"speech\",\n  \"speed\",\n  \"spellbind\",\n  \"speller\",\n  \"spelling\",\n  \"spendable\",\n  \"spender\",\n  \"spending\",\n  \"spent\",\n  \"spew\",\n  \"sphere\",\n  \"spherical\",\n  \"sphinx\",\n  \"spider\",\n  \"spied\",\n  \"spiffy\",\n  \"spill\",\n  \"spilt\",\n  \"spinach\",\n  \"spinal\",\n  \"spindle\",\n  \"spinner\",\n  \"spinning\",\n  \"spinout\",\n  \"spinster\",\n  \"spiny\",\n  \"spiral\",\n  \"spirited\",\n  \"spiritism\",\n  \"spirits\",\n  \"spiritual\",\n  \"splashed\",\n  \"splashing\",\n  \"splashy\",\n  \"splatter\",\n  \"spleen\",\n  \"splendid\",\n  \"splendor\",\n  \"splice\",\n  \"splicing\",\n  \"splinter\",\n  \"splotchy\",\n  \"splurge\",\n  \"spoilage\",\n  \"spoiled\",\n  \"spoiler\",\n  \"spoiling\",\n  \"spoils\",\n  \"spoken\",\n  \"spokesman\",\n  \"sponge\",\n  \"spongy\",\n  \"sponsor\",\n  \"spoof\",\n  \"spookily\",\n  \"spooky\",\n  \"spool\",\n  \"spoon\",\n  \"spore\",\n  \"sporting\",\n  \"sports\",\n  \"sporty\",\n  \"spotless\",\n  \"spotlight\",\n  \"spotted\",\n  \"spotter\",\n  \"spotting\",\n  \"spotty\",\n  \"spousal\",\n  \"spouse\",\n  \"spout\",\n  \"sprain\",\n  \"sprang\",\n  \"sprawl\",\n  \"spray\",\n  \"spree\",\n  \"sprig\",\n  \"spring\",\n  \"sprinkled\",\n  \"sprinkler\",\n  \"sprint\",\n  \"sprite\",\n  \"sprout\",\n  \"spruce\",\n  \"sprung\",\n  \"spry\",\n  \"spud\",\n  \"spur\",\n  \"sputter\",\n  \"spyglass\",\n  \"squabble\",\n  \"squad\",\n  \"squall\",\n  \"squander\",\n  \"squash\",\n  \"squatted\",\n  \"squatter\",\n  \"squatting\",\n  \"squeak\",\n  \"squealer\",\n  \"squealing\",\n  \"squeamish\",\n  \"squeegee\",\n  \"squeeze\",\n  \"squeezing\",\n  \"squid\",\n  \"squiggle\",\n  \"squiggly\",\n  \"squint\",\n  \"squire\",\n  \"squirt\",\n  \"squishier\",\n  \"squishy\",\n  \"stability\",\n  \"stabilize\",\n  \"stable\",\n  \"stack\",\n  \"stadium\",\n  \"staff\",\n  \"stage\",\n  \"staging\",\n  \"stagnant\",\n  \"stagnate\",\n  \"stainable\",\n  \"stained\",\n  \"staining\",\n  \"stainless\",\n  \"stalemate\",\n  \"staleness\",\n  \"stalling\",\n  \"stallion\",\n  \"stamina\",\n  \"stammer\",\n  \"stamp\",\n  \"stand\",\n  \"stank\",\n  \"staple\",\n  \"stapling\",\n  \"starboard\",\n  \"starch\",\n  \"stardom\",\n  \"stardust\",\n  \"starfish\",\n  \"stargazer\",\n  \"staring\",\n  \"stark\",\n  \"starless\",\n  \"starlet\",\n  \"starlight\",\n  \"starlit\",\n  \"starring\",\n  \"starry\",\n  \"starship\",\n  \"starter\",\n  \"starting\",\n  \"startle\",\n  \"startling\",\n  \"startup\",\n  \"starved\",\n  \"starving\",\n  \"stash\",\n  \"state\",\n  \"static\",\n  \"statistic\",\n  \"statue\",\n  \"stature\",\n  \"status\",\n  \"statute\",\n  \"statutory\",\n  \"staunch\",\n  \"stays\",\n  \"steadfast\",\n  \"steadier\",\n  \"steadily\",\n  \"steadying\",\n  \"steam\",\n  \"steed\",\n  \"steep\",\n  \"steerable\",\n  \"steering\",\n  \"steersman\",\n  \"stegosaur\",\n  \"stellar\",\n  \"stem\",\n  \"stench\",\n  \"stencil\",\n  \"step\",\n  \"stereo\",\n  \"sterile\",\n  \"sterility\",\n  \"sterilize\",\n  \"sterling\",\n  \"sternness\",\n  \"sternum\",\n  \"stew\",\n  \"stick\",\n  \"stiffen\",\n  \"stiffly\",\n  \"stiffness\",\n  \"stifle\",\n  \"stifling\",\n  \"stillness\",\n  \"stilt\",\n  \"stimulant\",\n  \"stimulate\",\n  \"stimuli\",\n  \"stimulus\",\n  \"stinger\",\n  \"stingily\",\n  \"stinging\",\n  \"stingray\",\n  \"stingy\",\n  \"stinking\",\n  \"stinky\",\n  \"stipend\",\n  \"stipulate\",\n  \"stir\",\n  \"stitch\",\n  \"stock\",\n  \"stoic\",\n  \"stoke\",\n  \"stole\",\n  \"stomp\",\n  \"stonewall\",\n  \"stoneware\",\n  \"stonework\",\n  \"stoning\",\n  \"stony\",\n  \"stood\",\n  \"stooge\",\n  \"stool\",\n  \"stoop\",\n  \"stoplight\",\n  \"stoppable\",\n  \"stoppage\",\n  \"stopped\",\n  \"stopper\",\n  \"stopping\",\n  \"stopwatch\",\n  \"storable\",\n  \"storage\",\n  \"storeroom\",\n  \"storewide\",\n  \"storm\",\n  \"stout\",\n  \"stove\",\n  \"stowaway\",\n  \"stowing\",\n  \"straddle\",\n  \"straggler\",\n  \"strained\",\n  \"strainer\",\n  \"straining\",\n  \"strangely\",\n  \"stranger\",\n  \"strangle\",\n  \"strategic\",\n  \"strategy\",\n  \"stratus\",\n  \"straw\",\n  \"stray\",\n  \"streak\",\n  \"stream\",\n  \"street\",\n  \"strength\",\n  \"strenuous\",\n  \"strep\",\n  \"stress\",\n  \"stretch\",\n  \"strewn\",\n  \"stricken\",\n  \"strict\",\n  \"stride\",\n  \"strife\",\n  \"strike\",\n  \"striking\",\n  \"strive\",\n  \"striving\",\n  \"strobe\",\n  \"strode\",\n  \"stroller\",\n  \"strongbox\",\n  \"strongly\",\n  \"strongman\",\n  \"struck\",\n  \"structure\",\n  \"strudel\",\n  \"struggle\",\n  \"strum\",\n  \"strung\",\n  \"strut\",\n  \"stubbed\",\n  \"stubble\",\n  \"stubbly\",\n  \"stubborn\",\n  \"stucco\",\n  \"stuck\",\n  \"student\",\n  \"studied\",\n  \"studio\",\n  \"study\",\n  \"stuffed\",\n  \"stuffing\",\n  \"stuffy\",\n  \"stumble\",\n  \"stumbling\",\n  \"stump\",\n  \"stung\",\n  \"stunned\",\n  \"stunner\",\n  \"stunning\",\n  \"stunt\",\n  \"stupor\",\n  \"sturdily\",\n  \"sturdy\",\n  \"styling\",\n  \"stylishly\",\n  \"stylist\",\n  \"stylized\",\n  \"stylus\",\n  \"suave\",\n  \"subarctic\",\n  \"subatomic\",\n  \"subdivide\",\n  \"subdued\",\n  \"subduing\",\n  \"subfloor\",\n  \"subgroup\",\n  \"subheader\",\n  \"subject\",\n  \"sublease\",\n  \"sublet\",\n  \"sublevel\",\n  \"sublime\",\n  \"submarine\",\n  \"submerge\",\n  \"submersed\",\n  \"submitter\",\n  \"subpanel\",\n  \"subpar\",\n  \"subplot\",\n  \"subprime\",\n  \"subscribe\",\n  \"subscript\",\n  \"subsector\",\n  \"subside\",\n  \"subsiding\",\n  \"subsidize\",\n  \"subsidy\",\n  \"subsoil\",\n  \"subsonic\",\n  \"substance\",\n  \"subsystem\",\n  \"subtext\",\n  \"subtitle\",\n  \"subtly\",\n  \"subtotal\",\n  \"subtract\",\n  \"subtype\",\n  \"suburb\",\n  \"subway\",\n  \"subwoofer\",\n  \"subzero\",\n  \"succulent\",\n  \"such\",\n  \"suction\",\n  \"sudden\",\n  \"sudoku\",\n  \"suds\",\n  \"sufferer\",\n  \"suffering\",\n  \"suffice\",\n  \"suffix\",\n  \"suffocate\",\n  \"suffrage\",\n  \"sugar\",\n  \"suggest\",\n  \"suing\",\n  \"suitable\",\n  \"suitably\",\n  \"suitcase\",\n  \"suitor\",\n  \"sulfate\",\n  \"sulfide\",\n  \"sulfite\",\n  \"sulfur\",\n  \"sulk\",\n  \"sullen\",\n  \"sulphate\",\n  \"sulphuric\",\n  \"sultry\",\n  \"superbowl\",\n  \"superglue\",\n  \"superhero\",\n  \"superior\",\n  \"superjet\",\n  \"superman\",\n  \"supermom\",\n  \"supernova\",\n  \"supervise\",\n  \"supper\",\n  \"supplier\",\n  \"supply\",\n  \"support\",\n  \"supremacy\",\n  \"supreme\",\n  \"surcharge\",\n  \"surely\",\n  \"sureness\",\n  \"surface\",\n  \"surfacing\",\n  \"surfboard\",\n  \"surfer\",\n  \"surgery\",\n  \"surgical\",\n  \"surging\",\n  \"surname\",\n  \"surpass\",\n  \"surplus\",\n  \"surprise\",\n  \"surreal\",\n  \"surrender\",\n  \"surrogate\",\n  \"surround\",\n  \"survey\",\n  \"survival\",\n  \"survive\",\n  \"surviving\",\n  \"survivor\",\n  \"sushi\",\n  \"suspect\",\n  \"suspend\",\n  \"suspense\",\n  \"sustained\",\n  \"sustainer\",\n  \"swab\",\n  \"swaddling\",\n  \"swagger\",\n  \"swampland\",\n  \"swan\",\n  \"swapping\",\n  \"swarm\",\n  \"sway\",\n  \"swear\",\n  \"sweat\",\n  \"sweep\",\n  \"swell\",\n  \"swept\",\n  \"swerve\",\n  \"swifter\",\n  \"swiftly\",\n  \"swiftness\",\n  \"swimmable\",\n  \"swimmer\",\n  \"swimming\",\n  \"swimsuit\",\n  \"swimwear\",\n  \"swinger\",\n  \"swinging\",\n  \"swipe\",\n  \"swirl\",\n  \"switch\",\n  \"swivel\",\n  \"swizzle\",\n  \"swooned\",\n  \"swoop\",\n  \"swoosh\",\n  \"swore\",\n  \"sworn\",\n  \"swung\",\n  \"sycamore\",\n  \"sympathy\",\n  \"symphonic\",\n  \"symphony\",\n  \"symptom\",\n  \"synapse\",\n  \"syndrome\",\n  \"synergy\",\n  \"synopses\",\n  \"synopsis\",\n  \"synthesis\",\n  \"synthetic\",\n  \"syrup\",\n  \"system\",\n  \"t-shirt\",\n  \"tabasco\",\n  \"tabby\",\n  \"tableful\",\n  \"tables\",\n  \"tablet\",\n  \"tableware\",\n  \"tabloid\",\n  \"tackiness\",\n  \"tacking\",\n  \"tackle\",\n  \"tackling\",\n  \"tacky\",\n  \"taco\",\n  \"tactful\",\n  \"tactical\",\n  \"tactics\",\n  \"tactile\",\n  \"tactless\",\n  \"tadpole\",\n  \"taekwondo\",\n  \"tag\",\n  \"tainted\",\n  \"take\",\n  \"taking\",\n  \"talcum\",\n  \"talisman\",\n  \"tall\",\n  \"talon\",\n  \"tamale\",\n  \"tameness\",\n  \"tamer\",\n  \"tamper\",\n  \"tank\",\n  \"tanned\",\n  \"tannery\",\n  \"tanning\",\n  \"tantrum\",\n  \"tapeless\",\n  \"tapered\",\n  \"tapering\",\n  \"tapestry\",\n  \"tapioca\",\n  \"tapping\",\n  \"taps\",\n  \"tarantula\",\n  \"target\",\n  \"tarmac\",\n  \"tarnish\",\n  \"tarot\",\n  \"tartar\",\n  \"tartly\",\n  \"tartness\",\n  \"task\",\n  \"tassel\",\n  \"taste\",\n  \"tastiness\",\n  \"tasting\",\n  \"tasty\",\n  \"tattered\",\n  \"tattle\",\n  \"tattling\",\n  \"tattoo\",\n  \"taunt\",\n  \"tavern\",\n  \"thank\",\n  \"that\",\n  \"thaw\",\n  \"theater\",\n  \"theatrics\",\n  \"thee\",\n  \"theft\",\n  \"theme\",\n  \"theology\",\n  \"theorize\",\n  \"thermal\",\n  \"thermos\",\n  \"thesaurus\",\n  \"these\",\n  \"thesis\",\n  \"thespian\",\n  \"thicken\",\n  \"thicket\",\n  \"thickness\",\n  \"thieving\",\n  \"thievish\",\n  \"thigh\",\n  \"thimble\",\n  \"thing\",\n  \"think\",\n  \"thinly\",\n  \"thinner\",\n  \"thinness\",\n  \"thinning\",\n  \"thirstily\",\n  \"thirsting\",\n  \"thirsty\",\n  \"thirteen\",\n  \"thirty\",\n  \"thong\",\n  \"thorn\",\n  \"those\",\n  \"thousand\",\n  \"thrash\",\n  \"thread\",\n  \"threaten\",\n  \"threefold\",\n  \"thrift\",\n  \"thrill\",\n  \"thrive\",\n  \"thriving\",\n  \"throat\",\n  \"throbbing\",\n  \"throng\",\n  \"throttle\",\n  \"throwaway\",\n  \"throwback\",\n  \"thrower\",\n  \"throwing\",\n  \"thud\",\n  \"thumb\",\n  \"thumping\",\n  \"thursday\",\n  \"thus\",\n  \"thwarting\",\n  \"thyself\",\n  \"tiara\",\n  \"tibia\",\n  \"tidal\",\n  \"tidbit\",\n  \"tidiness\",\n  \"tidings\",\n  \"tidy\",\n  \"tiger\",\n  \"tighten\",\n  \"tightly\",\n  \"tightness\",\n  \"tightrope\",\n  \"tightwad\",\n  \"tigress\",\n  \"tile\",\n  \"tiling\",\n  \"till\",\n  \"tilt\",\n  \"timid\",\n  \"timing\",\n  \"timothy\",\n  \"tinderbox\",\n  \"tinfoil\",\n  \"tingle\",\n  \"tingling\",\n  \"tingly\",\n  \"tinker\",\n  \"tinkling\",\n  \"tinsel\",\n  \"tinsmith\",\n  \"tint\",\n  \"tinwork\",\n  \"tiny\",\n  \"tipoff\",\n  \"tipped\",\n  \"tipper\",\n  \"tipping\",\n  \"tiptoeing\",\n  \"tiptop\",\n  \"tiring\",\n  \"tissue\",\n  \"trace\",\n  \"tracing\",\n  \"track\",\n  \"traction\",\n  \"tractor\",\n  \"trade\",\n  \"trading\",\n  \"tradition\",\n  \"traffic\",\n  \"tragedy\",\n  \"trailing\",\n  \"trailside\",\n  \"train\",\n  \"traitor\",\n  \"trance\",\n  \"tranquil\",\n  \"transfer\",\n  \"transform\",\n  \"translate\",\n  \"transpire\",\n  \"transport\",\n  \"transpose\",\n  \"trapdoor\",\n  \"trapeze\",\n  \"trapezoid\",\n  \"trapped\",\n  \"trapper\",\n  \"trapping\",\n  \"traps\",\n  \"trash\",\n  \"travel\",\n  \"traverse\",\n  \"travesty\",\n  \"tray\",\n  \"treachery\",\n  \"treading\",\n  \"treadmill\",\n  \"treason\",\n  \"treat\",\n  \"treble\",\n  \"tree\",\n  \"trekker\",\n  \"tremble\",\n  \"trembling\",\n  \"tremor\",\n  \"trench\",\n  \"trend\",\n  \"trespass\",\n  \"triage\",\n  \"trial\",\n  \"triangle\",\n  \"tribesman\",\n  \"tribunal\",\n  \"tribune\",\n  \"tributary\",\n  \"tribute\",\n  \"triceps\",\n  \"trickery\",\n  \"trickily\",\n  \"tricking\",\n  \"trickle\",\n  \"trickster\",\n  \"tricky\",\n  \"tricolor\",\n  \"tricycle\",\n  \"trident\",\n  \"tried\",\n  \"trifle\",\n  \"trifocals\",\n  \"trillion\",\n  \"trilogy\",\n  \"trimester\",\n  \"trimmer\",\n  \"trimming\",\n  \"trimness\",\n  \"trinity\",\n  \"trio\",\n  \"tripod\",\n  \"tripping\",\n  \"triumph\",\n  \"trivial\",\n  \"trodden\",\n  \"trolling\",\n  \"trombone\",\n  \"trophy\",\n  \"tropical\",\n  \"tropics\",\n  \"trouble\",\n  \"troubling\",\n  \"trough\",\n  \"trousers\",\n  \"trout\",\n  \"trowel\",\n  \"truce\",\n  \"truck\",\n  \"truffle\",\n  \"trump\",\n  \"trunks\",\n  \"trustable\",\n  \"trustee\",\n  \"trustful\",\n  \"trusting\",\n  \"trustless\",\n  \"truth\",\n  \"try\",\n  \"tubby\",\n  \"tubeless\",\n  \"tubular\",\n  \"tucking\",\n  \"tuesday\",\n  \"tug\",\n  \"tuition\",\n  \"tulip\",\n  \"tumble\",\n  \"tumbling\",\n  \"tummy\",\n  \"turban\",\n  \"turbine\",\n  \"turbofan\",\n  \"turbojet\",\n  \"turbulent\",\n  \"turf\",\n  \"turkey\",\n  \"turmoil\",\n  \"turret\",\n  \"turtle\",\n  \"tusk\",\n  \"tutor\",\n  \"tutu\",\n  \"tux\",\n  \"tweak\",\n  \"tweed\",\n  \"tweet\",\n  \"tweezers\",\n  \"twelve\",\n  \"twentieth\",\n  \"twenty\",\n  \"twerp\",\n  \"twice\",\n  \"twiddle\",\n  \"twiddling\",\n  \"twig\",\n  \"twilight\",\n  \"twine\",\n  \"twins\",\n  \"twirl\",\n  \"twistable\",\n  \"twisted\",\n  \"twister\",\n  \"twisting\",\n  \"twisty\",\n  \"twitch\",\n  \"twitter\",\n  \"tycoon\",\n  \"tying\",\n  \"tyke\",\n  \"udder\",\n  \"ultimate\",\n  \"ultimatum\",\n  \"ultra\",\n  \"umbilical\",\n  \"umbrella\",\n  \"umpire\",\n  \"unabashed\",\n  \"unable\",\n  \"unadorned\",\n  \"unadvised\",\n  \"unafraid\",\n  \"unaired\",\n  \"unaligned\",\n  \"unaltered\",\n  \"unarmored\",\n  \"unashamed\",\n  \"unaudited\",\n  \"unawake\",\n  \"unaware\",\n  \"unbaked\",\n  \"unbalance\",\n  \"unbeaten\",\n  \"unbend\",\n  \"unbent\",\n  \"unbiased\",\n  \"unbitten\",\n  \"unblended\",\n  \"unblessed\",\n  \"unblock\",\n  \"unbolted\",\n  \"unbounded\",\n  \"unboxed\",\n  \"unbraided\",\n  \"unbridle\",\n  \"unbroken\",\n  \"unbuckled\",\n  \"unbundle\",\n  \"unburned\",\n  \"unbutton\",\n  \"uncanny\",\n  \"uncapped\",\n  \"uncaring\",\n  \"uncertain\",\n  \"unchain\",\n  \"unchanged\",\n  \"uncharted\",\n  \"uncheck\",\n  \"uncivil\",\n  \"unclad\",\n  \"unclaimed\",\n  \"unclamped\",\n  \"unclasp\",\n  \"uncle\",\n  \"unclip\",\n  \"uncloak\",\n  \"unclog\",\n  \"unclothed\",\n  \"uncoated\",\n  \"uncoiled\",\n  \"uncolored\",\n  \"uncombed\",\n  \"uncommon\",\n  \"uncooked\",\n  \"uncork\",\n  \"uncorrupt\",\n  \"uncounted\",\n  \"uncouple\",\n  \"uncouth\",\n  \"uncover\",\n  \"uncross\",\n  \"uncrown\",\n  \"uncrushed\",\n  \"uncured\",\n  \"uncurious\",\n  \"uncurled\",\n  \"uncut\",\n  \"undamaged\",\n  \"undated\",\n  \"undaunted\",\n  \"undead\",\n  \"undecided\",\n  \"undefined\",\n  \"underage\",\n  \"underarm\",\n  \"undercoat\",\n  \"undercook\",\n  \"undercut\",\n  \"underdog\",\n  \"underdone\",\n  \"underfed\",\n  \"underfeed\",\n  \"underfoot\",\n  \"undergo\",\n  \"undergrad\",\n  \"underhand\",\n  \"underline\",\n  \"underling\",\n  \"undermine\",\n  \"undermost\",\n  \"underpaid\",\n  \"underpass\",\n  \"underpay\",\n  \"underrate\",\n  \"undertake\",\n  \"undertone\",\n  \"undertook\",\n  \"undertow\",\n  \"underuse\",\n  \"underwear\",\n  \"underwent\",\n  \"underwire\",\n  \"undesired\",\n  \"undiluted\",\n  \"undivided\",\n  \"undocked\",\n  \"undoing\",\n  \"undone\",\n  \"undrafted\",\n  \"undress\",\n  \"undrilled\",\n  \"undusted\",\n  \"undying\",\n  \"unearned\",\n  \"unearth\",\n  \"unease\",\n  \"uneasily\",\n  \"uneasy\",\n  \"uneatable\",\n  \"uneaten\",\n  \"unedited\",\n  \"unelected\",\n  \"unending\",\n  \"unengaged\",\n  \"unenvied\",\n  \"unequal\",\n  \"unethical\",\n  \"uneven\",\n  \"unexpired\",\n  \"unexposed\",\n  \"unfailing\",\n  \"unfair\",\n  \"unfasten\",\n  \"unfazed\",\n  \"unfeeling\",\n  \"unfiled\",\n  \"unfilled\",\n  \"unfitted\",\n  \"unfitting\",\n  \"unfixable\",\n  \"unfixed\",\n  \"unflawed\",\n  \"unfocused\",\n  \"unfold\",\n  \"unfounded\",\n  \"unframed\",\n  \"unfreeze\",\n  \"unfrosted\",\n  \"unfrozen\",\n  \"unfunded\",\n  \"unglazed\",\n  \"ungloved\",\n  \"unglue\",\n  \"ungodly\",\n  \"ungraded\",\n  \"ungreased\",\n  \"unguarded\",\n  \"unguided\",\n  \"unhappily\",\n  \"unhappy\",\n  \"unharmed\",\n  \"unhealthy\",\n  \"unheard\",\n  \"unhearing\",\n  \"unheated\",\n  \"unhelpful\",\n  \"unhidden\",\n  \"unhinge\",\n  \"unhitched\",\n  \"unholy\",\n  \"unhook\",\n  \"unicorn\",\n  \"unicycle\",\n  \"unified\",\n  \"unifier\",\n  \"uniformed\",\n  \"uniformly\",\n  \"unify\",\n  \"unimpeded\",\n  \"uninjured\",\n  \"uninstall\",\n  \"uninsured\",\n  \"uninvited\",\n  \"union\",\n  \"uniquely\",\n  \"unisexual\",\n  \"unison\",\n  \"unissued\",\n  \"unit\",\n  \"universal\",\n  \"universe\",\n  \"unjustly\",\n  \"unkempt\",\n  \"unkind\",\n  \"unknotted\",\n  \"unknowing\",\n  \"unknown\",\n  \"unlaced\",\n  \"unlatch\",\n  \"unlawful\",\n  \"unleaded\",\n  \"unlearned\",\n  \"unleash\",\n  \"unless\",\n  \"unleveled\",\n  \"unlighted\",\n  \"unlikable\",\n  \"unlimited\",\n  \"unlined\",\n  \"unlinked\",\n  \"unlisted\",\n  \"unlit\",\n  \"unlivable\",\n  \"unloaded\",\n  \"unloader\",\n  \"unlocked\",\n  \"unlocking\",\n  \"unlovable\",\n  \"unloved\",\n  \"unlovely\",\n  \"unloving\",\n  \"unluckily\",\n  \"unlucky\",\n  \"unmade\",\n  \"unmanaged\",\n  \"unmanned\",\n  \"unmapped\",\n  \"unmarked\",\n  \"unmasked\",\n  \"unmasking\",\n  \"unmatched\",\n  \"unmindful\",\n  \"unmixable\",\n  \"unmixed\",\n  \"unmolded\",\n  \"unmoral\",\n  \"unmovable\",\n  \"unmoved\",\n  \"unmoving\",\n  \"unnamable\",\n  \"unnamed\",\n  \"unnatural\",\n  \"unneeded\",\n  \"unnerve\",\n  \"unnerving\",\n  \"unnoticed\",\n  \"unopened\",\n  \"unopposed\",\n  \"unpack\",\n  \"unpadded\",\n  \"unpaid\",\n  \"unpainted\",\n  \"unpaired\",\n  \"unpaved\",\n  \"unpeeled\",\n  \"unpicked\",\n  \"unpiloted\",\n  \"unpinned\",\n  \"unplanned\",\n  \"unplanted\",\n  \"unpleased\",\n  \"unpledged\",\n  \"unplowed\",\n  \"unplug\",\n  \"unpopular\",\n  \"unproven\",\n  \"unquote\",\n  \"unranked\",\n  \"unrated\",\n  \"unraveled\",\n  \"unreached\",\n  \"unread\",\n  \"unreal\",\n  \"unreeling\",\n  \"unrefined\",\n  \"unrelated\",\n  \"unrented\",\n  \"unrest\",\n  \"unretired\",\n  \"unrevised\",\n  \"unrigged\",\n  \"unripe\",\n  \"unrivaled\",\n  \"unroasted\",\n  \"unrobed\",\n  \"unroll\",\n  \"unruffled\",\n  \"unruly\",\n  \"unrushed\",\n  \"unsaddle\",\n  \"unsafe\",\n  \"unsaid\",\n  \"unsalted\",\n  \"unsaved\",\n  \"unsavory\",\n  \"unscathed\",\n  \"unscented\",\n  \"unscrew\",\n  \"unsealed\",\n  \"unseated\",\n  \"unsecured\",\n  \"unseeing\",\n  \"unseemly\",\n  \"unseen\",\n  \"unselect\",\n  \"unselfish\",\n  \"unsent\",\n  \"unsettled\",\n  \"unshackle\",\n  \"unshaken\",\n  \"unshaved\",\n  \"unshaven\",\n  \"unsheathe\",\n  \"unshipped\",\n  \"unsightly\",\n  \"unsigned\",\n  \"unskilled\",\n  \"unsliced\",\n  \"unsmooth\",\n  \"unsnap\",\n  \"unsocial\",\n  \"unsoiled\",\n  \"unsold\",\n  \"unsolved\",\n  \"unsorted\",\n  \"unspoiled\",\n  \"unspoken\",\n  \"unstable\",\n  \"unstaffed\",\n  \"unstamped\",\n  \"unsteady\",\n  \"unsterile\",\n  \"unstirred\",\n  \"unstitch\",\n  \"unstopped\",\n  \"unstuck\",\n  \"unstuffed\",\n  \"unstylish\",\n  \"unsubtle\",\n  \"unsubtly\",\n  \"unsuited\",\n  \"unsure\",\n  \"unsworn\",\n  \"untagged\",\n  \"untainted\",\n  \"untaken\",\n  \"untamed\",\n  \"untangled\",\n  \"untapped\",\n  \"untaxed\",\n  \"unthawed\",\n  \"unthread\",\n  \"untidy\",\n  \"untie\",\n  \"until\",\n  \"untimed\",\n  \"untimely\",\n  \"untitled\",\n  \"untoasted\",\n  \"untold\",\n  \"untouched\",\n  \"untracked\",\n  \"untrained\",\n  \"untreated\",\n  \"untried\",\n  \"untrimmed\",\n  \"untrue\",\n  \"untruth\",\n  \"unturned\",\n  \"untwist\",\n  \"untying\",\n  \"unusable\",\n  \"unused\",\n  \"unusual\",\n  \"unvalued\",\n  \"unvaried\",\n  \"unvarying\",\n  \"unveiled\",\n  \"unveiling\",\n  \"unvented\",\n  \"unviable\",\n  \"unvisited\",\n  \"unvocal\",\n  \"unwanted\",\n  \"unwarlike\",\n  \"unwary\",\n  \"unwashed\",\n  \"unwatched\",\n  \"unweave\",\n  \"unwed\",\n  \"unwelcome\",\n  \"unwell\",\n  \"unwieldy\",\n  \"unwilling\",\n  \"unwind\",\n  \"unwired\",\n  \"unwitting\",\n  \"unwomanly\",\n  \"unworldly\",\n  \"unworn\",\n  \"unworried\",\n  \"unworthy\",\n  \"unwound\",\n  \"unwoven\",\n  \"unwrapped\",\n  \"unwritten\",\n  \"unzip\",\n  \"upbeat\",\n  \"upchuck\",\n  \"upcoming\",\n  \"upcountry\",\n  \"update\",\n  \"upfront\",\n  \"upgrade\",\n  \"upheaval\",\n  \"upheld\",\n  \"uphill\",\n  \"uphold\",\n  \"uplifted\",\n  \"uplifting\",\n  \"upload\",\n  \"upon\",\n  \"upper\",\n  \"upright\",\n  \"uprising\",\n  \"upriver\",\n  \"uproar\",\n  \"uproot\",\n  \"upscale\",\n  \"upside\",\n  \"upstage\",\n  \"upstairs\",\n  \"upstart\",\n  \"upstate\",\n  \"upstream\",\n  \"upstroke\",\n  \"upswing\",\n  \"uptake\",\n  \"uptight\",\n  \"uptown\",\n  \"upturned\",\n  \"upward\",\n  \"upwind\",\n  \"uranium\",\n  \"urban\",\n  \"urchin\",\n  \"urethane\",\n  \"urgency\",\n  \"urgent\",\n  \"urging\",\n  \"urologist\",\n  \"urology\",\n  \"usable\",\n  \"usage\",\n  \"useable\",\n  \"used\",\n  \"uselessly\",\n  \"user\",\n  \"usher\",\n  \"usual\",\n  \"utensil\",\n  \"utility\",\n  \"utilize\",\n  \"utmost\",\n  \"utopia\",\n  \"utter\",\n  \"vacancy\",\n  \"vacant\",\n  \"vacate\",\n  \"vacation\",\n  \"vagabond\",\n  \"vagrancy\",\n  \"vagrantly\",\n  \"vaguely\",\n  \"vagueness\",\n  \"valiant\",\n  \"valid\",\n  \"valium\",\n  \"valley\",\n  \"valuables\",\n  \"value\",\n  \"vanilla\",\n  \"vanish\",\n  \"vanity\",\n  \"vanquish\",\n  \"vantage\",\n  \"vaporizer\",\n  \"variable\",\n  \"variably\",\n  \"varied\",\n  \"variety\",\n  \"various\",\n  \"varmint\",\n  \"varnish\",\n  \"varsity\",\n  \"varying\",\n  \"vascular\",\n  \"vaseline\",\n  \"vastly\",\n  \"vastness\",\n  \"veal\",\n  \"vegan\",\n  \"veggie\",\n  \"vehicular\",\n  \"velcro\",\n  \"velocity\",\n  \"velvet\",\n  \"vendetta\",\n  \"vending\",\n  \"vendor\",\n  \"veneering\",\n  \"vengeful\",\n  \"venomous\",\n  \"ventricle\",\n  \"venture\",\n  \"venue\",\n  \"venus\",\n  \"verbalize\",\n  \"verbally\",\n  \"verbose\",\n  \"verdict\",\n  \"verify\",\n  \"verse\",\n  \"version\",\n  \"versus\",\n  \"vertebrae\",\n  \"vertical\",\n  \"vertigo\",\n  \"very\",\n  \"vessel\",\n  \"vest\",\n  \"veteran\",\n  \"veto\",\n  \"vexingly\",\n  \"viability\",\n  \"viable\",\n  \"vibes\",\n  \"vice\",\n  \"vicinity\",\n  \"victory\",\n  \"video\",\n  \"viewable\",\n  \"viewer\",\n  \"viewing\",\n  \"viewless\",\n  \"viewpoint\",\n  \"vigorous\",\n  \"village\",\n  \"villain\",\n  \"vindicate\",\n  \"vineyard\",\n  \"vintage\",\n  \"violate\",\n  \"violation\",\n  \"violator\",\n  \"violet\",\n  \"violin\",\n  \"viper\",\n  \"viral\",\n  \"virtual\",\n  \"virtuous\",\n  \"virus\",\n  \"visa\",\n  \"viscosity\",\n  \"viscous\",\n  \"viselike\",\n  \"visible\",\n  \"visibly\",\n  \"vision\",\n  \"visiting\",\n  \"visitor\",\n  \"visor\",\n  \"vista\",\n  \"vitality\",\n  \"vitalize\",\n  \"vitally\",\n  \"vitamins\",\n  \"vivacious\",\n  \"vividly\",\n  \"vividness\",\n  \"vixen\",\n  \"vocalist\",\n  \"vocalize\",\n  \"vocally\",\n  \"vocation\",\n  \"voice\",\n  \"voicing\",\n  \"void\",\n  \"volatile\",\n  \"volley\",\n  \"voltage\",\n  \"volumes\",\n  \"voter\",\n  \"voting\",\n  \"voucher\",\n  \"vowed\",\n  \"vowel\",\n  \"voyage\",\n  \"wackiness\",\n  \"wad\",\n  \"wafer\",\n  \"waffle\",\n  \"waged\",\n  \"wager\",\n  \"wages\",\n  \"waggle\",\n  \"wagon\",\n  \"wake\",\n  \"waking\",\n  \"walk\",\n  \"walmart\",\n  \"walnut\",\n  \"walrus\",\n  \"waltz\",\n  \"wand\",\n  \"wannabe\",\n  \"wanted\",\n  \"wanting\",\n  \"wasabi\",\n  \"washable\",\n  \"washbasin\",\n  \"washboard\",\n  \"washbowl\",\n  \"washcloth\",\n  \"washday\",\n  \"washed\",\n  \"washer\",\n  \"washhouse\",\n  \"washing\",\n  \"washout\",\n  \"washroom\",\n  \"washstand\",\n  \"washtub\",\n  \"wasp\",\n  \"wasting\",\n  \"watch\",\n  \"water\",\n  \"waviness\",\n  \"waving\",\n  \"wavy\",\n  \"whacking\",\n  \"whacky\",\n  \"wham\",\n  \"wharf\",\n  \"wheat\",\n  \"whenever\",\n  \"whiff\",\n  \"whimsical\",\n  \"whinny\",\n  \"whiny\",\n  \"whisking\",\n  \"whoever\",\n  \"whole\",\n  \"whomever\",\n  \"whoopee\",\n  \"whooping\",\n  \"whoops\",\n  \"why\",\n  \"wick\",\n  \"widely\",\n  \"widen\",\n  \"widget\",\n  \"widow\",\n  \"width\",\n  \"wieldable\",\n  \"wielder\",\n  \"wife\",\n  \"wifi\",\n  \"wikipedia\",\n  \"wildcard\",\n  \"wildcat\",\n  \"wilder\",\n  \"wildfire\",\n  \"wildfowl\",\n  \"wildland\",\n  \"wildlife\",\n  \"wildly\",\n  \"wildness\",\n  \"willed\",\n  \"willfully\",\n  \"willing\",\n  \"willow\",\n  \"willpower\",\n  \"wilt\",\n  \"wimp\",\n  \"wince\",\n  \"wincing\",\n  \"wind\",\n  \"wing\",\n  \"winking\",\n  \"winner\",\n  \"winnings\",\n  \"winter\",\n  \"wipe\",\n  \"wired\",\n  \"wireless\",\n  \"wiring\",\n  \"wiry\",\n  \"wisdom\",\n  \"wise\",\n  \"wish\",\n  \"wisplike\",\n  \"wispy\",\n  \"wistful\",\n  \"wizard\",\n  \"wobble\",\n  \"wobbling\",\n  \"wobbly\",\n  \"wok\",\n  \"wolf\",\n  \"wolverine\",\n  \"womanhood\",\n  \"womankind\",\n  \"womanless\",\n  \"womanlike\",\n  \"womanly\",\n  \"womb\",\n  \"woof\",\n  \"wooing\",\n  \"wool\",\n  \"woozy\",\n  \"word\",\n  \"work\",\n  \"worried\",\n  \"worrier\",\n  \"worrisome\",\n  \"worry\",\n  \"worsening\",\n  \"worshiper\",\n  \"worst\",\n  \"wound\",\n  \"woven\",\n  \"wow\",\n  \"wrangle\",\n  \"wrath\",\n  \"wreath\",\n  \"wreckage\",\n  \"wrecker\",\n  \"wrecking\",\n  \"wrench\",\n  \"wriggle\",\n  \"wriggly\",\n  \"wrinkle\",\n  \"wrinkly\",\n  \"wrist\",\n  \"writing\",\n  \"written\",\n  \"wrongdoer\",\n  \"wronged\",\n  \"wrongful\",\n  \"wrongly\",\n  \"wrongness\",\n  \"wrought\",\n  \"xbox\",\n  \"xerox\",\n  \"yahoo\",\n  \"yam\",\n  \"yanking\",\n  \"yapping\",\n  \"yard\",\n  \"yarn\",\n  \"yeah\",\n  \"yearbook\",\n  \"yearling\",\n  \"yearly\",\n  \"yearning\",\n  \"yeast\",\n  \"yelling\",\n  \"yelp\",\n  \"yen\",\n  \"yesterday\",\n  \"yiddish\",\n  \"yield\",\n  \"yin\",\n  \"yippee\",\n  \"yo-yo\",\n  \"yodel\",\n  \"yoga\",\n  \"yogurt\",\n  \"yonder\",\n  \"yoyo\",\n  \"yummy\",\n  \"zap\",\n  \"zealous\",\n  \"zebra\",\n  \"zen\",\n  \"zeppelin\",\n  \"zero\",\n  \"zestfully\",\n  \"zesty\",\n  \"zigzagged\",\n  \"zipfile\",\n  \"zipping\",\n  \"zippy\",\n  \"zips\",\n  \"zit\",\n  \"zodiac\",\n  \"zombie\",\n  \"zone\",\n  \"zoning\",\n  \"zookeeper\",\n  \"zoologist\",\n  \"zoology\",\n  \"zoom\",\n];\n","/** Request format for passphrase credential generation.\n *  The members of this type may be `undefined` when the user is\n *  generating a password.\n */\nexport type PassphraseGenerationOptions = {\n  /** The number of words to include in the passphrase.\n   * This value defaults to 3.\n   */\n  numWords?: number;\n\n  /** The ASCII separator character to use between words in the passphrase.\n   * This value defaults to a dash.\n   * If multiple characters appear in the string, only the first character is used.\n   */\n  wordSeparator?: string;\n\n  /** `true` when the first character of every word should be capitalized.\n   * This value defaults to `false`.\n   */\n  capitalize?: boolean;\n\n  /** `true` when a number should be included in the passphrase.\n   * This value defaults to `false`.\n   */\n  includeNumber?: boolean;\n};\n\n/** The default options for passphrase generation. */\nexport const DefaultPassphraseGenerationOptions: Partial<PassphraseGenerationOptions> =\n  Object.freeze({\n    numWords: 3,\n    wordSeparator: \"-\",\n    capitalize: false,\n    includeNumber: false,\n  });\n","import { PolicyEvaluator } from \"../abstractions/policy-evaluator.abstraction\";\n\nimport {\n  DefaultPassphraseGenerationOptions,\n  PassphraseGenerationOptions,\n} from \"./passphrase-generation-options\";\nimport { PassphraseGeneratorPolicy } from \"./passphrase-generator-policy\";\n\ntype Boundary = {\n  readonly min: number;\n  readonly max: number;\n};\n\nfunction initializeBoundaries() {\n  const numWords = Object.freeze({\n    min: 3,\n    max: 20,\n  });\n\n  return Object.freeze({\n    numWords,\n  });\n}\n\n/** Immutable default boundaries for passphrase generation.\n * These are used when the policy does not override a value.\n */\nexport const DefaultBoundaries = initializeBoundaries();\n\n/** Enforces policy for passphrase generation options.\n */\nexport class PassphraseGeneratorOptionsEvaluator\n  implements PolicyEvaluator<PassphraseGeneratorPolicy, PassphraseGenerationOptions>\n{\n  // This design is not ideal, but it is a step towards a more robust passphrase\n  // generator. Ideally, `sanitize` would be implemented on an options class,\n  // and `applyPolicy` would be implemented on a policy class, \"mise en place\".\n  //\n  // The current design of the passphrase generator, unfortunately, would require\n  // a substantial rewrite to make this feasible. Hopefully this change can be\n  // applied when the passphrase generator is ported to rust.\n\n  /** Policy applied by the evaluator.\n   */\n  readonly policy: PassphraseGeneratorPolicy;\n\n  /** Boundaries for the number of words allowed in the password.\n   */\n  readonly numWords: Boundary;\n\n  /** Instantiates the evaluator.\n   * @param policy The policy applied by the evaluator. When this conflicts with\n   *               the defaults, the policy takes precedence.\n   */\n  constructor(policy: PassphraseGeneratorPolicy) {\n    function createBoundary(value: number, defaultBoundary: Boundary): Boundary {\n      const boundary = {\n        min: Math.max(defaultBoundary.min, value),\n        max: Math.max(defaultBoundary.max, value),\n      };\n\n      return boundary;\n    }\n\n    this.policy = structuredClone(policy);\n    this.numWords = createBoundary(policy.minNumberWords, DefaultBoundaries.numWords);\n  }\n\n  /** {@link PolicyEvaluator.policyInEffect} */\n  get policyInEffect(): boolean {\n    const policies = [\n      this.policy.capitalize,\n      this.policy.includeNumber,\n      this.policy.minNumberWords > DefaultBoundaries.numWords.min,\n    ];\n\n    return policies.includes(true);\n  }\n\n  /** Apply policy to the input options.\n   *  @param options The options to build from. These options are not altered.\n   *  @returns A new password generation request with policy applied.\n   */\n  applyPolicy(options: PassphraseGenerationOptions): PassphraseGenerationOptions {\n    function fitToBounds(value: number, boundaries: Boundary) {\n      const { min, max } = boundaries;\n\n      const withUpperBound = Math.min(value ?? boundaries.min, max);\n      const withLowerBound = Math.max(withUpperBound, min);\n\n      return withLowerBound;\n    }\n\n    // apply policy overrides\n    const capitalize = this.policy.capitalize || options.capitalize || false;\n    const includeNumber = this.policy.includeNumber || options.includeNumber || false;\n\n    // apply boundaries\n    const numWords = fitToBounds(options.numWords, this.numWords);\n\n    return {\n      ...options,\n      numWords,\n      capitalize,\n      includeNumber,\n    };\n  }\n\n  /** Ensures internal options consistency.\n   *  @param options The options to cascade. These options are not altered.\n   *  @returns A passphrase generation request with cascade applied.\n   */\n  sanitize(options: PassphraseGenerationOptions): PassphraseGenerationOptions {\n    // ensure words are separated by a single character or the empty string\n    const wordSeparator =\n      options.wordSeparator === \"\"\n        ? \"\"\n        : options.wordSeparator?.[0] ?? DefaultPassphraseGenerationOptions.wordSeparator;\n\n    return {\n      ...options,\n      wordSeparator,\n    };\n  }\n}\n","export class GeneratedPasswordHistory {\n  password: string;\n  date: number;\n\n  constructor(password: string, date: number) {\n    this.password = password;\n    this.date = date;\n  }\n}\n","import { PolicyService } from \"../../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"../../../admin-console/enums\";\nimport { PasswordGeneratorPolicyOptions } from \"../../../admin-console/models/domain/password-generator-policy-options\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { EFFLongWordList } from \"../../../platform/misc/wordlist\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { PassphraseGeneratorOptionsEvaluator } from \"../passphrase/passphrase-generator-options-evaluator\";\n\nimport { GeneratedPasswordHistory } from \"./generated-password-history\";\nimport { PasswordGenerationServiceAbstraction } from \"./password-generation.service.abstraction\";\nimport { PasswordGeneratorOptions } from \"./password-generator-options\";\nimport { PasswordGeneratorOptionsEvaluator } from \"./password-generator-options-evaluator\";\n\nconst DefaultOptions: PasswordGeneratorOptions = {\n  length: 14,\n  minLength: 5,\n  ambiguous: false,\n  number: true,\n  minNumber: 1,\n  uppercase: true,\n  minUppercase: 0,\n  lowercase: true,\n  minLowercase: 0,\n  special: false,\n  minSpecial: 1,\n  type: \"password\",\n  numWords: 3,\n  wordSeparator: \"-\",\n  capitalize: false,\n  includeNumber: false,\n};\n\nconst DefaultPolicy = new PasswordGeneratorPolicyOptions();\n\nconst MaxPasswordsInHistory = 100;\n\nexport class PasswordGenerationService implements PasswordGenerationServiceAbstraction {\n  constructor(\n    private cryptoService: CryptoService,\n    private policyService: PolicyService,\n    private stateService: StateService,\n  ) {}\n\n  async generatePassword(options: PasswordGeneratorOptions): Promise<string> {\n    if ((options.type ?? DefaultOptions.type) === \"passphrase\") {\n      return this.generatePassphrase({ ...DefaultOptions, ...options });\n    }\n\n    const evaluator = new PasswordGeneratorOptionsEvaluator(DefaultPolicy);\n    const o = evaluator.sanitize({ ...DefaultOptions, ...options });\n\n    const positions: string[] = [];\n    if (o.lowercase && o.minLowercase > 0) {\n      for (let i = 0; i < o.minLowercase; i++) {\n        positions.push(\"l\");\n      }\n    }\n    if (o.uppercase && o.minUppercase > 0) {\n      for (let i = 0; i < o.minUppercase; i++) {\n        positions.push(\"u\");\n      }\n    }\n    if (o.number && o.minNumber > 0) {\n      for (let i = 0; i < o.minNumber; i++) {\n        positions.push(\"n\");\n      }\n    }\n    if (o.special && o.minSpecial > 0) {\n      for (let i = 0; i < o.minSpecial; i++) {\n        positions.push(\"s\");\n      }\n    }\n    while (positions.length < o.length) {\n      positions.push(\"a\");\n    }\n\n    // shuffle\n    await this.shuffleArray(positions);\n\n    // build out the char sets\n    let allCharSet = \"\";\n\n    let lowercaseCharSet = \"abcdefghijkmnopqrstuvwxyz\";\n    if (o.ambiguous) {\n      lowercaseCharSet += \"l\";\n    }\n    if (o.lowercase) {\n      allCharSet += lowercaseCharSet;\n    }\n\n    let uppercaseCharSet = \"ABCDEFGHJKLMNPQRSTUVWXYZ\";\n    if (o.ambiguous) {\n      uppercaseCharSet += \"IO\";\n    }\n    if (o.uppercase) {\n      allCharSet += uppercaseCharSet;\n    }\n\n    let numberCharSet = \"23456789\";\n    if (o.ambiguous) {\n      numberCharSet += \"01\";\n    }\n    if (o.number) {\n      allCharSet += numberCharSet;\n    }\n\n    const specialCharSet = \"!@#$%^&*\";\n    if (o.special) {\n      allCharSet += specialCharSet;\n    }\n\n    let password = \"\";\n    for (let i = 0; i < o.length; i++) {\n      let positionChars: string;\n      switch (positions[i]) {\n        case \"l\":\n          positionChars = lowercaseCharSet;\n          break;\n        case \"u\":\n          positionChars = uppercaseCharSet;\n          break;\n        case \"n\":\n          positionChars = numberCharSet;\n          break;\n        case \"s\":\n          positionChars = specialCharSet;\n          break;\n        case \"a\":\n          positionChars = allCharSet;\n          break;\n        default:\n          break;\n      }\n\n      const randomCharIndex = await this.cryptoService.randomNumber(0, positionChars.length - 1);\n      password += positionChars.charAt(randomCharIndex);\n    }\n\n    return password;\n  }\n\n  async generatePassphrase(options: PasswordGeneratorOptions): Promise<string> {\n    const evaluator = new PassphraseGeneratorOptionsEvaluator(DefaultPolicy);\n    const o = evaluator.sanitize({ ...DefaultOptions, ...options });\n\n    if (o.numWords == null || o.numWords <= 2) {\n      o.numWords = DefaultOptions.numWords;\n    }\n    if (o.capitalize == null) {\n      o.capitalize = false;\n    }\n    if (o.includeNumber == null) {\n      o.includeNumber = false;\n    }\n\n    const listLength = EFFLongWordList.length - 1;\n    const wordList = new Array(o.numWords);\n    for (let i = 0; i < o.numWords; i++) {\n      const wordIndex = await this.cryptoService.randomNumber(0, listLength);\n      if (o.capitalize) {\n        wordList[i] = this.capitalize(EFFLongWordList[wordIndex]);\n      } else {\n        wordList[i] = EFFLongWordList[wordIndex];\n      }\n    }\n\n    if (o.includeNumber) {\n      await this.appendRandomNumberToRandomWord(wordList);\n    }\n    return wordList.join(o.wordSeparator);\n  }\n\n  async getOptions(): Promise<[PasswordGeneratorOptions, PasswordGeneratorPolicyOptions]> {\n    let options = await this.stateService.getPasswordGenerationOptions();\n    if (options == null) {\n      options = Object.assign({}, DefaultOptions);\n    } else {\n      options = Object.assign({}, DefaultOptions, options);\n    }\n    await this.stateService.setPasswordGenerationOptions(options);\n    const enforcedOptions = await this.enforcePasswordGeneratorPoliciesOnOptions(options);\n    options = enforcedOptions[0];\n    return [options, enforcedOptions[1]];\n  }\n\n  async enforcePasswordGeneratorPoliciesOnOptions(\n    options: PasswordGeneratorOptions,\n  ): Promise<[PasswordGeneratorOptions, PasswordGeneratorPolicyOptions]> {\n    let policy = await this.getPasswordGeneratorPolicyOptions();\n    policy = policy ?? new PasswordGeneratorPolicyOptions();\n\n    // Force default type if password/passphrase selected via policy\n    if (policy.defaultType === \"password\" || policy.defaultType === \"passphrase\") {\n      options.type = policy.defaultType;\n    }\n\n    const evaluator =\n      options.type == \"password\"\n        ? new PasswordGeneratorOptionsEvaluator(policy)\n        : new PassphraseGeneratorOptionsEvaluator(policy);\n\n    // Ensure the options to pass the current rules\n    const withPolicy = evaluator.applyPolicy(options);\n    const sanitized = evaluator.sanitize(withPolicy);\n\n    // callers assume this function updates the options parameter\n    const result = Object.assign(options, sanitized);\n    return [result, policy];\n  }\n\n  async getPasswordGeneratorPolicyOptions(): Promise<PasswordGeneratorPolicyOptions> {\n    const policies = await this.policyService?.getAll(PolicyType.PasswordGenerator);\n    let enforcedOptions: PasswordGeneratorPolicyOptions = null;\n\n    if (policies == null || policies.length === 0) {\n      return enforcedOptions;\n    }\n\n    policies.forEach((currentPolicy) => {\n      if (!currentPolicy.enabled || currentPolicy.data == null) {\n        return;\n      }\n\n      if (enforcedOptions == null) {\n        enforcedOptions = new PasswordGeneratorPolicyOptions();\n      }\n\n      // Password wins in multi-org collisions\n      if (currentPolicy.data.defaultType != null && enforcedOptions.defaultType !== \"password\") {\n        enforcedOptions.defaultType = currentPolicy.data.defaultType;\n      }\n\n      if (\n        currentPolicy.data.minLength != null &&\n        currentPolicy.data.minLength > enforcedOptions.minLength\n      ) {\n        enforcedOptions.minLength = currentPolicy.data.minLength;\n      }\n\n      if (currentPolicy.data.useUpper) {\n        enforcedOptions.useUppercase = true;\n      }\n\n      if (currentPolicy.data.useLower) {\n        enforcedOptions.useLowercase = true;\n      }\n\n      if (currentPolicy.data.useNumbers) {\n        enforcedOptions.useNumbers = true;\n      }\n\n      if (\n        currentPolicy.data.minNumbers != null &&\n        currentPolicy.data.minNumbers > enforcedOptions.numberCount\n      ) {\n        enforcedOptions.numberCount = currentPolicy.data.minNumbers;\n      }\n\n      if (currentPolicy.data.useSpecial) {\n        enforcedOptions.useSpecial = true;\n      }\n\n      if (\n        currentPolicy.data.minSpecial != null &&\n        currentPolicy.data.minSpecial > enforcedOptions.specialCount\n      ) {\n        enforcedOptions.specialCount = currentPolicy.data.minSpecial;\n      }\n\n      if (\n        currentPolicy.data.minNumberWords != null &&\n        currentPolicy.data.minNumberWords > enforcedOptions.minNumberWords\n      ) {\n        enforcedOptions.minNumberWords = currentPolicy.data.minNumberWords;\n      }\n\n      if (currentPolicy.data.capitalize) {\n        enforcedOptions.capitalize = true;\n      }\n\n      if (currentPolicy.data.includeNumber) {\n        enforcedOptions.includeNumber = true;\n      }\n    });\n\n    return enforcedOptions;\n  }\n\n  async saveOptions(options: PasswordGeneratorOptions) {\n    await this.stateService.setPasswordGenerationOptions(options);\n  }\n\n  async getHistory(): Promise<GeneratedPasswordHistory[]> {\n    const hasKey = await this.cryptoService.hasUserKey();\n    if (!hasKey) {\n      return new Array<GeneratedPasswordHistory>();\n    }\n\n    if ((await this.stateService.getDecryptedPasswordGenerationHistory()) == null) {\n      const encrypted = await this.stateService.getEncryptedPasswordGenerationHistory();\n      const decrypted = await this.decryptHistory(encrypted);\n      await this.stateService.setDecryptedPasswordGenerationHistory(decrypted);\n    }\n\n    const passwordGenerationHistory =\n      await this.stateService.getDecryptedPasswordGenerationHistory();\n    return passwordGenerationHistory != null\n      ? passwordGenerationHistory\n      : new Array<GeneratedPasswordHistory>();\n  }\n\n  async addHistory(password: string): Promise<void> {\n    // Cannot add new history if no key is available\n    const hasKey = await this.cryptoService.hasUserKey();\n    if (!hasKey) {\n      return;\n    }\n\n    const currentHistory = await this.getHistory();\n\n    // Prevent duplicates\n    if (this.matchesPrevious(password, currentHistory)) {\n      return;\n    }\n\n    currentHistory.unshift(new GeneratedPasswordHistory(password, Date.now()));\n\n    // Remove old items.\n    if (currentHistory.length > MaxPasswordsInHistory) {\n      currentHistory.pop();\n    }\n\n    const newHistory = await this.encryptHistory(currentHistory);\n    await this.stateService.setDecryptedPasswordGenerationHistory(currentHistory);\n    return await this.stateService.setEncryptedPasswordGenerationHistory(newHistory);\n  }\n\n  async clear(userId?: string): Promise<void> {\n    await this.stateService.setEncryptedPasswordGenerationHistory(null, { userId: userId });\n    await this.stateService.setDecryptedPasswordGenerationHistory(null, { userId: userId });\n  }\n\n  normalizeOptions(\n    options: PasswordGeneratorOptions,\n    enforcedPolicyOptions: PasswordGeneratorPolicyOptions,\n  ) {\n    const evaluator =\n      options.type == \"password\"\n        ? new PasswordGeneratorOptionsEvaluator(enforcedPolicyOptions)\n        : new PassphraseGeneratorOptionsEvaluator(enforcedPolicyOptions);\n\n    const evaluatedOptions = evaluator.applyPolicy(options);\n    const santizedOptions = evaluator.sanitize(evaluatedOptions);\n\n    // callers assume this function updates the options parameter\n    Object.assign(options, santizedOptions);\n\n    return options;\n  }\n\n  private capitalize(str: string) {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n  }\n\n  private async appendRandomNumberToRandomWord(wordList: string[]) {\n    if (wordList == null || wordList.length <= 0) {\n      return;\n    }\n    const index = await this.cryptoService.randomNumber(0, wordList.length - 1);\n    const num = await this.cryptoService.randomNumber(0, 9);\n    wordList[index] = wordList[index] + num;\n  }\n\n  private async encryptHistory(\n    history: GeneratedPasswordHistory[],\n  ): Promise<GeneratedPasswordHistory[]> {\n    if (history == null || history.length === 0) {\n      return Promise.resolve([]);\n    }\n\n    const promises = history.map(async (item) => {\n      const encrypted = await this.cryptoService.encrypt(item.password);\n      return new GeneratedPasswordHistory(encrypted.encryptedString, item.date);\n    });\n\n    return await Promise.all(promises);\n  }\n\n  private async decryptHistory(\n    history: GeneratedPasswordHistory[],\n  ): Promise<GeneratedPasswordHistory[]> {\n    if (history == null || history.length === 0) {\n      return Promise.resolve([]);\n    }\n\n    const promises = history.map(async (item) => {\n      const decrypted = await this.cryptoService.decryptToUtf8(new EncString(item.password));\n      return new GeneratedPasswordHistory(decrypted, item.date);\n    });\n\n    return await Promise.all(promises);\n  }\n\n  private matchesPrevious(password: string, history: GeneratedPasswordHistory[]): boolean {\n    if (history == null || history.length === 0) {\n      return false;\n    }\n\n    return history[history.length - 1].password === password;\n  }\n\n  // ref: https://stackoverflow.com/a/12646864/1090359\n  private async shuffleArray(array: string[]) {\n    for (let i = array.length - 1; i > 0; i--) {\n      const j = await this.cryptoService.randomNumber(0, i);\n      [array[i], array[j]] = [array[j], array[i]];\n    }\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class AnonAddyForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid addy.io API token.\";\n    }\n    if (options.anonaddy?.domain == null || options.anonaddy.domain === \"\") {\n      throw \"Invalid addy.io domain.\";\n    }\n    if (options.anonaddy?.baseUrl == null || options.anonaddy.baseUrl === \"\") {\n      throw \"Invalid addy.io url.\";\n    }\n\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.apiKey,\n        \"Content-Type\": \"application/json\",\n        \"X-Requested-With\": \"XMLHttpRequest\",\n      }),\n    };\n    const url = options.anonaddy.baseUrl + \"/api/v1/aliases\";\n    requestInit.body = JSON.stringify({\n      domain: options.anonaddy.domain,\n      description:\n        (options.website != null ? \"Website: \" + options.website + \". \" : \"\") +\n        \"Generated by Bitwarden.\",\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json?.data?.email;\n    }\n    if (response.status === 401) {\n      throw \"Invalid addy.io API token.\";\n    }\n    if (response?.statusText != null) {\n      throw \"addy.io error:\\n\" + response.statusText;\n    }\n    throw \"Unknown addy.io error occurred.\";\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class DuckDuckGoForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid DuckDuckGo API token.\";\n    }\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.apiKey,\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    const url = \"https://quack.duckduckgo.com/api/email/addresses\";\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      if (json.address) {\n        return `${json.address}@duck.com`;\n      }\n    } else if (response.status === 401) {\n      throw \"Invalid DuckDuckGo API token.\";\n    }\n    throw \"Unknown DuckDuckGo error occurred.\";\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class FastmailForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid Fastmail API token.\";\n    }\n\n    const accountId = await this.getAccountId(apiService, options);\n    if (accountId == null || accountId === \"\") {\n      throw \"Unable to obtain Fastmail masked email account ID.\";\n    }\n\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.apiKey,\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    const url = \"https://api.fastmail.com/jmap/api/\";\n    requestInit.body = JSON.stringify({\n      using: [\"https://www.fastmail.com/dev/maskedemail\", \"urn:ietf:params:jmap:core\"],\n      methodCalls: [\n        [\n          \"MaskedEmail/set\",\n          {\n            accountId: accountId,\n            create: {\n              \"new-masked-email\": {\n                state: \"enabled\",\n                description: \"\",\n                forDomain: options.website,\n                emailPrefix: options.fastmail.prefix,\n              },\n            },\n          },\n          \"0\",\n        ],\n      ],\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200) {\n      const json = await response.json();\n      if (\n        json.methodResponses != null &&\n        json.methodResponses.length > 0 &&\n        json.methodResponses[0].length > 0\n      ) {\n        if (json.methodResponses[0][0] === \"MaskedEmail/set\") {\n          if (json.methodResponses[0][1]?.created?.[\"new-masked-email\"] != null) {\n            return json.methodResponses[0][1]?.created?.[\"new-masked-email\"]?.email;\n          }\n          if (json.methodResponses[0][1]?.notCreated?.[\"new-masked-email\"] != null) {\n            throw (\n              \"Fastmail error: \" +\n              json.methodResponses[0][1]?.notCreated?.[\"new-masked-email\"]?.description\n            );\n          }\n        } else if (json.methodResponses[0][0] === \"error\") {\n          throw \"Fastmail error: \" + json.methodResponses[0][1]?.description;\n        }\n      }\n    }\n    if (response.status === 401 || response.status === 403) {\n      throw \"Invalid Fastmail API token.\";\n    }\n    throw \"Unknown Fastmail error occurred.\";\n  }\n\n  private async getAccountId(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    const requestInit: RequestInit = {\n      cache: \"no-store\",\n      method: \"GET\",\n      headers: new Headers({\n        Authorization: \"Bearer \" + options.apiKey,\n      }),\n    };\n    const url = \"https://api.fastmail.com/.well-known/jmap\";\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200) {\n      const json = await response.json();\n      if (json.primaryAccounts != null) {\n        return json.primaryAccounts[\"https://www.fastmail.com/dev/maskedemail\"];\n      }\n    }\n    return null;\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class FirefoxRelayForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid Firefox Relay API token.\";\n    }\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Token \" + options.apiKey,\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    const url = \"https://relay.firefox.com/api/v1/relayaddresses/\";\n    requestInit.body = JSON.stringify({\n      enabled: true,\n      generated_for: options.website,\n      description:\n        (options.website != null ? options.website + \" - \" : \"\") + \"Generated by Bitwarden.\",\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json?.full_address;\n    }\n    if (response.status === 401) {\n      throw \"Invalid Firefox Relay API token.\";\n    }\n    throw \"Unknown Firefox Relay error occurred.\";\n  }\n}\n","export class ForwarderOptions {\n  apiKey: string;\n  website: string;\n  fastmail = new FastmailForwarderOptions();\n  anonaddy = new AnonAddyForwarderOptions();\n  forwardemail = new ForwardEmailForwarderOptions();\n  simplelogin = new SimpleLoginForwarderOptions();\n}\n\nexport class FastmailForwarderOptions {\n  prefix: string;\n}\n\nexport class AnonAddyForwarderOptions {\n  domain: string;\n  baseUrl: string;\n}\n\nexport class ForwardEmailForwarderOptions {\n  domain: string;\n}\n\nexport class SimpleLoginForwarderOptions {\n  baseUrl: string;\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class SimpleLoginForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid SimpleLogin API key.\";\n    }\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authentication: options.apiKey,\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    let url = options.simplelogin.baseUrl + \"/api/alias/random/new\";\n    if (options.website != null) {\n      url += \"?hostname=\" + options.website;\n    }\n    requestInit.body = JSON.stringify({\n      note:\n        (options.website != null ? \"Website: \" + options.website + \". \" : \"\") +\n        \"Generated by Bitwarden.\",\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json.alias;\n    }\n    if (response.status === 401) {\n      throw \"Invalid SimpleLogin API key.\";\n    }\n    const json = await response.json();\n    if (json?.error != null) {\n      throw \"SimpleLogin error:\" + json.error;\n    }\n    throw \"Unknown SimpleLogin error occurred.\";\n  }\n}\n","import { ApiService } from \"../../../../abstractions/api.service\";\nimport { Utils } from \"../../../../platform/misc/utils\";\n\nimport { Forwarder } from \"./forwarder\";\nimport { ForwarderOptions } from \"./forwarder-options\";\n\nexport class ForwardEmailForwarder implements Forwarder {\n  async generate(apiService: ApiService, options: ForwarderOptions): Promise<string> {\n    if (options.apiKey == null || options.apiKey === \"\") {\n      throw \"Invalid Forward Email API key.\";\n    }\n    if (options.forwardemail?.domain == null || options.forwardemail.domain === \"\") {\n      throw \"Invalid Forward Email domain.\";\n    }\n    const requestInit: RequestInit = {\n      redirect: \"manual\",\n      cache: \"no-store\",\n      method: \"POST\",\n      headers: new Headers({\n        Authorization: \"Basic \" + Utils.fromUtf8ToB64(options.apiKey + \":\"),\n        \"Content-Type\": \"application/json\",\n      }),\n    };\n    const url = `https://api.forwardemail.net/v1/domains/${options.forwardemail.domain}/aliases`;\n    requestInit.body = JSON.stringify({\n      labels: options.website,\n      description:\n        (options.website != null ? \"Website: \" + options.website + \". \" : \"\") +\n        \"Generated by Bitwarden.\",\n    });\n    const request = new Request(url, requestInit);\n    const response = await apiService.nativeFetch(request);\n    if (response.status === 200 || response.status === 201) {\n      const json = await response.json();\n      return json?.name + \"@\" + (json?.domain?.name || options.forwardemail.domain);\n    }\n    if (response.status === 401) {\n      throw \"Invalid Forward Email API key.\";\n    }\n    const json = await response.json();\n    if (json?.message != null) {\n      throw \"Forward Email error:\\n\" + json.message;\n    }\n    if (json?.error != null) {\n      throw \"Forward Email error:\\n\" + json.error;\n    }\n    throw \"Unknown Forward Email error occurred.\";\n  }\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { EFFLongWordList } from \"../../../platform/misc/wordlist\";\n\nimport {\n  AnonAddyForwarder,\n  DuckDuckGoForwarder,\n  FastmailForwarder,\n  FirefoxRelayForwarder,\n  ForwardEmailForwarder,\n  Forwarder,\n  ForwarderOptions,\n  SimpleLoginForwarder,\n} from \"./email-forwarders\";\nimport { UsernameGeneratorOptions } from \"./username-generation-options\";\nimport { UsernameGenerationServiceAbstraction } from \"./username-generation.service.abstraction\";\n\nconst DefaultOptions: UsernameGeneratorOptions = {\n  type: \"word\",\n  wordCapitalize: true,\n  wordIncludeNumber: true,\n  subaddressType: \"random\",\n  catchallType: \"random\",\n  forwardedService: \"\",\n  forwardedAnonAddyDomain: \"anonaddy.me\",\n  forwardedAnonAddyBaseUrl: \"https://app.addy.io\",\n  forwardedForwardEmailDomain: \"hideaddress.net\",\n  forwardedSimpleLoginBaseUrl: \"https://app.simplelogin.io\",\n};\n\nexport class UsernameGenerationService implements UsernameGenerationServiceAbstraction {\n  constructor(\n    private cryptoService: CryptoService,\n    private stateService: StateService,\n    private apiService: ApiService,\n  ) {}\n\n  generateUsername(options: UsernameGeneratorOptions): Promise<string> {\n    if (options.type === \"catchall\") {\n      return this.generateCatchall(options);\n    } else if (options.type === \"subaddress\") {\n      return this.generateSubaddress(options);\n    } else if (options.type === \"forwarded\") {\n      return this.generateForwarded(options);\n    } else {\n      return this.generateWord(options);\n    }\n  }\n\n  async generateWord(options: UsernameGeneratorOptions): Promise<string> {\n    const o = Object.assign({}, DefaultOptions, options);\n\n    if (o.wordCapitalize == null) {\n      o.wordCapitalize = true;\n    }\n    if (o.wordIncludeNumber == null) {\n      o.wordIncludeNumber = true;\n    }\n\n    const wordIndex = await this.cryptoService.randomNumber(0, EFFLongWordList.length - 1);\n    let word = EFFLongWordList[wordIndex];\n    if (o.wordCapitalize) {\n      word = word.charAt(0).toUpperCase() + word.slice(1);\n    }\n    if (o.wordIncludeNumber) {\n      const num = await this.cryptoService.randomNumber(1, 9999);\n      word = word + this.zeroPad(num.toString(), 4);\n    }\n    return word;\n  }\n\n  async generateSubaddress(options: UsernameGeneratorOptions): Promise<string> {\n    const o = Object.assign({}, DefaultOptions, options);\n\n    const subaddressEmail = o.subaddressEmail;\n    if (subaddressEmail == null || subaddressEmail.length < 3) {\n      return o.subaddressEmail;\n    }\n    const atIndex = subaddressEmail.indexOf(\"@\");\n    if (atIndex < 1 || atIndex >= subaddressEmail.length - 1) {\n      return subaddressEmail;\n    }\n    if (o.subaddressType == null) {\n      o.subaddressType = \"random\";\n    }\n\n    const emailBeginning = subaddressEmail.substr(0, atIndex);\n    const emailEnding = subaddressEmail.substr(atIndex + 1, subaddressEmail.length);\n\n    let subaddressString = \"\";\n    if (o.subaddressType === \"random\") {\n      subaddressString = await this.randomString(8);\n    } else if (o.subaddressType === \"website-name\") {\n      subaddressString = o.website;\n    }\n    return emailBeginning + \"+\" + subaddressString + \"@\" + emailEnding;\n  }\n\n  async generateCatchall(options: UsernameGeneratorOptions): Promise<string> {\n    const o = Object.assign({}, DefaultOptions, options);\n\n    if (o.catchallDomain == null || o.catchallDomain === \"\") {\n      return null;\n    }\n    if (o.catchallType == null) {\n      o.catchallType = \"random\";\n    }\n\n    let startString = \"\";\n    if (o.catchallType === \"random\") {\n      startString = await this.randomString(8);\n    } else if (o.catchallType === \"website-name\") {\n      startString = o.website;\n    }\n    return startString + \"@\" + o.catchallDomain;\n  }\n\n  async generateForwarded(options: UsernameGeneratorOptions): Promise<string> {\n    const o = Object.assign({}, DefaultOptions, options);\n\n    if (o.forwardedService == null) {\n      return null;\n    }\n\n    let forwarder: Forwarder = null;\n    const forwarderOptions = new ForwarderOptions();\n    forwarderOptions.website = o.website;\n    if (o.forwardedService === \"simplelogin\") {\n      forwarder = new SimpleLoginForwarder();\n      forwarderOptions.apiKey = o.forwardedSimpleLoginApiKey;\n      forwarderOptions.simplelogin.baseUrl = o.forwardedSimpleLoginBaseUrl;\n    } else if (o.forwardedService === \"anonaddy\") {\n      forwarder = new AnonAddyForwarder();\n      forwarderOptions.apiKey = o.forwardedAnonAddyApiToken;\n      forwarderOptions.anonaddy.domain = o.forwardedAnonAddyDomain;\n      forwarderOptions.anonaddy.baseUrl = o.forwardedAnonAddyBaseUrl;\n    } else if (o.forwardedService === \"firefoxrelay\") {\n      forwarder = new FirefoxRelayForwarder();\n      forwarderOptions.apiKey = o.forwardedFirefoxApiToken;\n    } else if (o.forwardedService === \"fastmail\") {\n      forwarder = new FastmailForwarder();\n      forwarderOptions.apiKey = o.forwardedFastmailApiToken;\n    } else if (o.forwardedService === \"duckduckgo\") {\n      forwarder = new DuckDuckGoForwarder();\n      forwarderOptions.apiKey = o.forwardedDuckDuckGoToken;\n    } else if (o.forwardedService === \"forwardemail\") {\n      forwarder = new ForwardEmailForwarder();\n      forwarderOptions.apiKey = o.forwardedForwardEmailApiToken;\n      forwarderOptions.forwardemail.domain = o.forwardedForwardEmailDomain;\n    }\n\n    if (forwarder == null) {\n      return null;\n    }\n\n    return forwarder.generate(this.apiService, forwarderOptions);\n  }\n\n  async getOptions(): Promise<UsernameGeneratorOptions> {\n    let options = await this.stateService.getUsernameGenerationOptions();\n    if (options == null) {\n      options = Object.assign({}, DefaultOptions);\n    } else {\n      options = Object.assign({}, DefaultOptions, options);\n    }\n    await this.stateService.setUsernameGenerationOptions(options);\n    return options;\n  }\n\n  async saveOptions(options: UsernameGeneratorOptions) {\n    await this.stateService.setUsernameGenerationOptions(options);\n  }\n\n  private async randomString(length: number) {\n    let str = \"\";\n    const charSet = \"abcdefghijklmnopqrstuvwxyz1234567890\";\n    for (let i = 0; i < length; i++) {\n      const randomCharIndex = await this.cryptoService.randomNumber(0, charSet.length - 1);\n      str += charSet.charAt(randomCharIndex);\n    }\n    return str;\n  }\n\n  // ref: https://stackoverflow.com/a/10073788\n  private zeroPad(number: string, width: number) {\n    return number.length >= width\n      ? number\n      : new Array(width - number.length + 1).join(\"0\") + number;\n  }\n}\n","export enum SendType {\n  Text = 0,\n  File = 1,\n}\n","import * as zxcvbn from \"zxcvbn\";\n\nimport { PasswordStrengthServiceAbstraction } from \"./password-strength.service.abstraction\";\n\nexport class PasswordStrengthService implements PasswordStrengthServiceAbstraction {\n  /**\n   * Calculates a password strength score using zxcvbn.\n   * @param password The password to calculate the strength of.\n   * @param emailInput An unparsed email address to use as user input.\n   * @param userInputs An array of additional user inputs to use when calculating the strength.\n   */\n  getPasswordStrength(\n    password: string,\n    emailInput: string = null,\n    userInputs: string[] = null,\n  ): zxcvbn.ZXCVBNResult {\n    if (password == null || password.length === 0) {\n      return null;\n    }\n    const globalUserInputs = [\n      \"bitwarden\",\n      \"bit\",\n      \"warden\",\n      ...(userInputs ?? []),\n      ...this.emailToUserInputs(emailInput),\n    ];\n    // Use a hash set to get rid of any duplicate user inputs\n    const finalUserInputs = Array.from(new Set(globalUserInputs));\n    const result = zxcvbn(password, finalUserInputs);\n    return result;\n  }\n\n  /**\n   * Convert an email address into a list of user inputs for zxcvbn by\n   * taking the local part of the email address and splitting it into words.\n   * @param email\n   * @private\n   */\n  private emailToUserInputs(email: string): string[] {\n    if (email == null || email.length === 0) {\n      return [];\n    }\n    const atPosition = email.indexOf(\"@\");\n    if (atPosition < 0) {\n      return [];\n    }\n    return email\n      .substring(0, atPosition)\n      .trim()\n      .toLowerCase()\n      .split(/[^A-Za-z0-9]/);\n  }\n}\n","import { SendFileApi } from \"../api/send-file.api\";\n\nexport class SendFileData {\n  id: string;\n  fileName: string;\n  size: string;\n  sizeName: string;\n\n  constructor(data?: SendFileApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.id = data.id;\n    this.fileName = data.fileName;\n    this.size = data.size;\n    this.sizeName = data.sizeName;\n  }\n}\n","import { SendTextApi } from \"../api/send-text.api\";\n\nexport class SendTextData {\n  text: string;\n  hidden: boolean;\n\n  constructor(data?: SendTextApi) {\n    if (data == null) {\n      return;\n    }\n\n    this.text = data.text;\n    this.hidden = data.hidden;\n  }\n}\n","import { SendType } from \"../../enums/send-type\";\nimport { SendResponse } from \"../response/send.response\";\n\nimport { SendFileData } from \"./send-file.data\";\nimport { SendTextData } from \"./send-text.data\";\n\nexport class SendData {\n  id: string;\n  accessId: string;\n  type: SendType;\n  name: string;\n  notes: string;\n  file: SendFileData;\n  text: SendTextData;\n  key: string;\n  maxAccessCount?: number;\n  accessCount: number;\n  revisionDate: string;\n  expirationDate: string;\n  deletionDate: string;\n  password: string;\n  disabled: boolean;\n  hideEmail: boolean;\n\n  constructor(response?: SendResponse) {\n    if (response == null) {\n      return;\n    }\n\n    this.id = response.id;\n    this.accessId = response.accessId;\n    this.type = response.type;\n    this.name = response.name;\n    this.notes = response.notes;\n    this.key = response.key;\n    this.maxAccessCount = response.maxAccessCount;\n    this.accessCount = response.accessCount;\n    this.revisionDate = response.revisionDate;\n    this.expirationDate = response.expirationDate;\n    this.deletionDate = response.deletionDate;\n    this.password = response.password;\n    this.disabled = response.disable;\n    this.hideEmail = response.hideEmail;\n\n    switch (this.type) {\n      case SendType.Text:\n        this.text = new SendTextData(response.text);\n        break;\n      case SendType.File:\n        this.file = new SendFileData(response.file);\n        break;\n      default:\n        break;\n    }\n  }\n}\n","import { SendType } from \"../../enums/send-type\";\nimport { SendFileApi } from \"../api/send-file.api\";\nimport { SendTextApi } from \"../api/send-text.api\";\nimport { Send } from \"../domain/send\";\n\nexport class SendRequest {\n  type: SendType;\n  fileLength?: number;\n  name: string;\n  notes: string;\n  key: string;\n  maxAccessCount?: number;\n  expirationDate: string;\n  deletionDate: string;\n  text: SendTextApi;\n  file: SendFileApi;\n  password: string;\n  disabled: boolean;\n  hideEmail: boolean;\n\n  constructor(send: Send, fileLength?: number) {\n    this.type = send.type;\n    this.fileLength = fileLength;\n    this.name = send.name ? send.name.encryptedString : null;\n    this.notes = send.notes ? send.notes.encryptedString : null;\n    this.maxAccessCount = send.maxAccessCount;\n    this.expirationDate = send.expirationDate != null ? send.expirationDate.toISOString() : null;\n    this.deletionDate = send.deletionDate != null ? send.deletionDate.toISOString() : null;\n    this.key = send.key != null ? send.key.encryptedString : null;\n    this.password = send.password;\n    this.disabled = send.disabled;\n    this.hideEmail = send.hideEmail;\n\n    switch (this.type) {\n      case SendType.Text:\n        this.text = new SendTextApi();\n        this.text.text = send.text.text != null ? send.text.text.encryptedString : null;\n        this.text.hidden = send.text.hidden;\n        break;\n      case SendType.File:\n        this.file = new SendFileApi();\n        this.file.fileName = send.file.fileName != null ? send.file.fileName.encryptedString : null;\n        break;\n      default:\n        break;\n    }\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { SendType } from \"../../enums/send-type\";\nimport { SendFileApi } from \"../api/send-file.api\";\nimport { SendTextApi } from \"../api/send-text.api\";\n\nexport class SendAccessResponse extends BaseResponse {\n  id: string;\n  type: SendType;\n  name: string;\n  file: SendFileApi;\n  text: SendTextApi;\n  expirationDate: Date;\n  creatorIdentifier: string;\n\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.type = this.getResponseProperty(\"Type\");\n    this.name = this.getResponseProperty(\"Name\");\n\n    const text = this.getResponseProperty(\"Text\");\n    if (text != null) {\n      this.text = new SendTextApi(text);\n    }\n\n    const file = this.getResponseProperty(\"File\");\n    if (file != null) {\n      this.file = new SendFileApi(file);\n    }\n\n    this.expirationDate = this.getResponseProperty(\"ExpirationDate\");\n    this.creatorIdentifier = this.getResponseProperty(\"CreatorIdentifier\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\n\nexport class SendFileDownloadDataResponse extends BaseResponse {\n  id: string = null;\n  url: string = null;\n  constructor(response: any) {\n    super(response);\n    this.id = this.getResponseProperty(\"Id\");\n    this.url = this.getResponseProperty(\"Url\");\n  }\n}\n","import { BaseResponse } from \"../../../../models/response/base.response\";\nimport { FileUploadType } from \"../../../../platform/enums\";\n\nimport { SendResponse } from \"./send.response\";\n\nexport class SendFileUploadDataResponse extends BaseResponse {\n  fileUploadType: FileUploadType;\n  sendResponse: SendResponse;\n  url: string = null;\n  constructor(response: any) {\n    super(response);\n    this.fileUploadType = this.getResponseProperty(\"FileUploadType\");\n    const sendResponse = this.getResponseProperty(\"SendResponse\");\n    this.sendResponse = sendResponse == null ? null : new SendResponse(sendResponse);\n    this.url = this.getResponseProperty(\"Url\");\n  }\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { ErrorResponse } from \"../../../models/response/error.response\";\nimport { ListResponse } from \"../../../models/response/list.response\";\nimport {\n  FileUploadApiMethods,\n  FileUploadService,\n} from \"../../../platform/abstractions/file-upload/file-upload.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { EncArrayBuffer } from \"../../../platform/models/domain/enc-array-buffer\";\nimport { SendType } from \"../enums/send-type\";\nimport { SendData } from \"../models/data/send.data\";\nimport { Send } from \"../models/domain/send\";\nimport { SendAccessRequest } from \"../models/request/send-access.request\";\nimport { SendRequest } from \"../models/request/send.request\";\nimport { SendAccessResponse } from \"../models/response/send-access.response\";\nimport { SendFileDownloadDataResponse } from \"../models/response/send-file-download-data.response\";\nimport { SendFileUploadDataResponse } from \"../models/response/send-file-upload-data.response\";\nimport { SendResponse } from \"../models/response/send.response\";\nimport { SendAccessView } from \"../models/view/send-access.view\";\n\nimport { SendApiService as SendApiServiceAbstraction } from \"./send-api.service.abstraction\";\nimport { InternalSendService } from \"./send.service.abstraction\";\n\nexport class SendApiService implements SendApiServiceAbstraction {\n  constructor(\n    private apiService: ApiService,\n    private fileUploadService: FileUploadService,\n    private sendService: InternalSendService,\n  ) {}\n\n  async getSend(id: string): Promise<SendResponse> {\n    const r = await this.apiService.send(\"GET\", \"/sends/\" + id, null, true, true);\n    return new SendResponse(r);\n  }\n\n  async postSendAccess(\n    id: string,\n    request: SendAccessRequest,\n    apiUrl?: string,\n  ): Promise<SendAccessResponse> {\n    const addSendIdHeader = (headers: Headers) => {\n      headers.set(\"Send-Id\", id);\n    };\n    const r = await this.apiService.send(\n      \"POST\",\n      \"/sends/access/\" + id,\n      request,\n      false,\n      true,\n      apiUrl,\n      addSendIdHeader,\n    );\n    return new SendAccessResponse(r);\n  }\n\n  async getSendFileDownloadData(\n    send: SendAccessView,\n    request: SendAccessRequest,\n    apiUrl?: string,\n  ): Promise<SendFileDownloadDataResponse> {\n    const addSendIdHeader = (headers: Headers) => {\n      headers.set(\"Send-Id\", send.id);\n    };\n    const r = await this.apiService.send(\n      \"POST\",\n      \"/sends/\" + send.id + \"/access/file/\" + send.file.id,\n      request,\n      false,\n      true,\n      apiUrl,\n      addSendIdHeader,\n    );\n    return new SendFileDownloadDataResponse(r);\n  }\n\n  async getSends(): Promise<ListResponse<SendResponse>> {\n    const r = await this.apiService.send(\"GET\", \"/sends\", null, true, true);\n    return new ListResponse(r, SendResponse);\n  }\n\n  async postSend(request: SendRequest): Promise<SendResponse> {\n    const r = await this.apiService.send(\"POST\", \"/sends\", request, true, true);\n    return new SendResponse(r);\n  }\n\n  async postFileTypeSend(request: SendRequest): Promise<SendFileUploadDataResponse> {\n    const r = await this.apiService.send(\"POST\", \"/sends/file/v2\", request, true, true);\n    return new SendFileUploadDataResponse(r);\n  }\n\n  async renewSendFileUploadUrl(\n    sendId: string,\n    fileId: string,\n  ): Promise<SendFileUploadDataResponse> {\n    const r = await this.apiService.send(\n      \"GET\",\n      \"/sends/\" + sendId + \"/file/\" + fileId,\n      null,\n      true,\n      true,\n    );\n    return new SendFileUploadDataResponse(r);\n  }\n\n  postSendFile(sendId: string, fileId: string, data: FormData): Promise<any> {\n    return this.apiService.send(\"POST\", \"/sends/\" + sendId + \"/file/\" + fileId, data, true, false);\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async postSendFileLegacy(data: FormData): Promise<SendResponse> {\n    const r = await this.apiService.send(\"POST\", \"/sends/file\", data, true, true);\n    return new SendResponse(r);\n  }\n\n  async putSend(id: string, request: SendRequest): Promise<SendResponse> {\n    const r = await this.apiService.send(\"PUT\", \"/sends/\" + id, request, true, true);\n    return new SendResponse(r);\n  }\n\n  async putSendRemovePassword(id: string): Promise<SendResponse> {\n    const r = await this.apiService.send(\n      \"PUT\",\n      \"/sends/\" + id + \"/remove-password\",\n      null,\n      true,\n      true,\n    );\n    return new SendResponse(r);\n  }\n\n  deleteSend(id: string): Promise<any> {\n    return this.apiService.send(\"DELETE\", \"/sends/\" + id, null, true, false);\n  }\n\n  async save(sendData: [Send, EncArrayBuffer]): Promise<any> {\n    const response = await this.upload(sendData);\n\n    const data = new SendData(response);\n    await this.sendService.upsert(data);\n  }\n\n  async delete(id: string): Promise<any> {\n    await this.deleteSend(id);\n    await this.sendService.delete(id);\n  }\n\n  async removePassword(id: string): Promise<any> {\n    const response = await this.putSendRemovePassword(id);\n    const data = new SendData(response);\n    await this.sendService.upsert(data);\n  }\n\n  // Send File Upload methods\n\n  private async upload(sendData: [Send, EncArrayBuffer]): Promise<SendResponse> {\n    const request = new SendRequest(sendData[0], sendData[1]?.buffer.byteLength);\n    let response: SendResponse;\n    if (sendData[0].id == null) {\n      if (sendData[0].type === SendType.Text) {\n        response = await this.postSend(request);\n      } else {\n        try {\n          const uploadDataResponse = await this.postFileTypeSend(request);\n          response = uploadDataResponse.sendResponse;\n          await this.fileUploadService.upload(\n            uploadDataResponse,\n            sendData[0].file.fileName,\n            sendData[1],\n            this.generateMethods(uploadDataResponse, response),\n          );\n        } catch (e) {\n          if (e instanceof ErrorResponse && (e as ErrorResponse).statusCode === 404) {\n            response = await this.legacyServerSendFileUpload(sendData, request);\n          } else if (e instanceof ErrorResponse) {\n            throw new Error((e as ErrorResponse).getSingleMessage());\n          } else {\n            throw e;\n          }\n        }\n      }\n      sendData[0].id = response.id;\n      sendData[0].accessId = response.accessId;\n    } else {\n      response = await this.putSend(sendData[0].id, request);\n    }\n    return response;\n  }\n\n  private generateMethods(\n    uploadData: SendFileUploadDataResponse,\n    response: SendResponse,\n  ): FileUploadApiMethods {\n    return {\n      postDirect: this.generatePostDirectCallback(response),\n      renewFileUploadUrl: this.generateRenewFileUploadUrlCallback(response.id, response.file.id),\n      rollback: this.generateRollbackCallback(response.id),\n    };\n  }\n\n  private generatePostDirectCallback(sendResponse: SendResponse) {\n    return (data: FormData) => {\n      return this.postSendFile(sendResponse.id, sendResponse.file.id, data);\n    };\n  }\n\n  private generateRenewFileUploadUrlCallback(sendId: string, fileId: string) {\n    return async () => {\n      const renewResponse = await this.renewSendFileUploadUrl(sendId, fileId);\n      return renewResponse?.url;\n    };\n  }\n\n  private generateRollbackCallback(sendId: string) {\n    return () => {\n      return this.deleteSend(sendId);\n    };\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async legacyServerSendFileUpload(\n    sendData: [Send, EncArrayBuffer],\n    request: SendRequest,\n  ): Promise<SendResponse> {\n    const fd = new FormData();\n    try {\n      const blob = new Blob([sendData[1].buffer], { type: \"application/octet-stream\" });\n      fd.append(\"model\", JSON.stringify(request));\n      fd.append(\"data\", blob, sendData[0].file.fileName.encryptedString);\n    } catch (e) {\n      if (Utils.isNode && !Utils.isBrowser) {\n        fd.append(\"model\", JSON.stringify(request));\n        fd.append(\n          \"data\",\n          Buffer.from(sendData[1].buffer) as any,\n          {\n            filepath: sendData[0].file.fileName.encryptedString,\n            contentType: \"application/octet-stream\",\n          } as any,\n        );\n      } else {\n        throw e;\n      }\n    }\n    return await this.postSendFileLegacy(fd);\n  }\n}\n","// required to avoid linting errors when there are no flags\n/* eslint-disable @typescript-eslint/ban-types */\nexport type SharedFlags = {\n  multithreadDecryption: boolean;\n  showPasswordless?: boolean;\n  enableCipherKeyEncryption?: boolean;\n};\n\n// required to avoid linting errors when there are no flags\n/* eslint-disable @typescript-eslint/ban-types */\nexport type SharedDevFlags = {\n  noopNotifications: boolean;\n};\n\nfunction getFlags<T>(envFlags: string | T): T {\n  if (typeof envFlags === \"string\") {\n    return JSON.parse(envFlags) as T;\n  } else {\n    return envFlags as T;\n  }\n}\n\n/**\n * Gets the value of a feature flag from environment.\n * All flags default to \"on\" (true).\n * Only use for shared code in `libs`, otherwise use the client-specific function.\n * @param flag The name of the feature flag to check\n * @returns The value of the flag\n */\nexport function flagEnabled<Flags extends SharedFlags>(flag: keyof Flags): boolean {\n  const flags = getFlags<Flags>(process.env.FLAGS);\n  return flags[flag] == null || !!flags[flag];\n}\n\n/**\n * Gets the value of a dev flag from environment.\n * Will always return false unless in development.\n * Only use for shared code in `libs`, otherwise use the client-specific function.\n * @param flag The name of the dev flag to check\n * @returns The value of the flag\n */\nexport function devFlagEnabled<DevFlags extends SharedDevFlags>(flag: keyof DevFlags): boolean {\n  if (process.env.ENV !== \"development\") {\n    return false;\n  }\n\n  const devFlags = getFlags<DevFlags>(process.env.DEV_FLAGS);\n  return devFlags?.[flag] == null ? false : !!devFlags[flag];\n}\n\n/**\n * Gets the value of a dev flag from environment.\n * Will always return false unless in development.\n * @param flag The name of the dev flag to check\n * @returns The value of the flag\n * @throws Error if the flag is not enabled\n */\nexport function devFlagValue<DevFlags extends SharedDevFlags>(\n  flag: keyof DevFlags,\n): DevFlags[keyof DevFlags] {\n  if (!devFlagEnabled(flag)) {\n    throw new Error(`This method should not be called, it is protected by a disabled dev flag.`);\n  }\n\n  const devFlags = getFlags<DevFlags>(process.env.DEV_FLAGS);\n  return devFlags[flag];\n}\n","/**\n * Use as a Decorator on async functions, it will prevent multiple 'active' calls as the same time\n *\n * If a promise was returned from a previous call to this function, that hasn't yet resolved it will\n * be returned, instead of calling the original function again\n *\n * Results are not cached, once the promise has returned, the next call will result in a fresh call\n *\n * Read more at https://github.com/bitwarden/jslib/pull/7\n */\nexport function sequentialize(cacheKey: (args: any[]) => string) {\n  return (target: any, propertyKey: string | symbol, descriptor: PropertyDescriptor) => {\n    const originalMethod: () => Promise<any> = descriptor.value;\n    const caches = new Map<any, Map<string, Promise<any>>>();\n\n    const getCache = (obj: any) => {\n      let cache = caches.get(obj);\n      if (cache != null) {\n        return cache;\n      }\n      cache = new Map<string, Promise<any>>();\n      caches.set(obj, cache);\n      return cache;\n    };\n\n    return {\n      value: function (...args: any[]) {\n        const cache = getCache(this);\n        const argsCacheKey = cacheKey(args);\n        let response = cache.get(argsCacheKey);\n        if (response != null) {\n          return response;\n        }\n\n        const onFinally = () => {\n          cache.delete(argsCacheKey);\n          if (cache.size === 0) {\n            caches.delete(this);\n          }\n        };\n        response = originalMethod\n          .apply(this, args)\n          .then((val: any) => {\n            onFinally();\n            return val;\n          })\n          .catch((err: any) => {\n            onFinally();\n            throw err;\n          });\n\n        cache.set(argsCacheKey, response);\n        return response;\n      },\n    };\n  };\n}\n","import { CipherView } from \"../view/cipher.view\";\n\nconst CacheTTL = 3000;\n\nexport class SortedCiphersCache {\n  private readonly sortedCiphersByUrl: Map<string, Ciphers> = new Map<string, Ciphers>();\n  private readonly timeouts: Map<string, any> = new Map<string, any>();\n\n  constructor(private readonly comparator: (a: CipherView, b: CipherView) => number) {}\n\n  isCached(url: string) {\n    return this.sortedCiphersByUrl.has(url);\n  }\n\n  addCiphers(url: string, ciphers: CipherView[]) {\n    ciphers.sort(this.comparator);\n    this.sortedCiphersByUrl.set(url, new Ciphers(ciphers));\n    this.resetTimer(url);\n  }\n\n  getLastUsed(url: string) {\n    this.resetTimer(url);\n    return this.isCached(url) ? this.sortedCiphersByUrl.get(url).getLastUsed() : null;\n  }\n\n  getLastLaunched(url: string) {\n    return this.isCached(url) ? this.sortedCiphersByUrl.get(url).getLastLaunched() : null;\n  }\n\n  getNext(url: string) {\n    this.resetTimer(url);\n    return this.isCached(url) ? this.sortedCiphersByUrl.get(url).getNext() : null;\n  }\n\n  updateLastUsedIndex(url: string) {\n    if (this.isCached(url)) {\n      this.sortedCiphersByUrl.get(url).updateLastUsedIndex();\n    }\n  }\n\n  clear() {\n    this.sortedCiphersByUrl.clear();\n    this.timeouts.clear();\n  }\n\n  private resetTimer(url: string) {\n    clearTimeout(this.timeouts.get(url));\n    this.timeouts.set(\n      url,\n      setTimeout(() => {\n        this.sortedCiphersByUrl.delete(url);\n        this.timeouts.delete(url);\n      }, CacheTTL),\n    );\n  }\n}\n\nclass Ciphers {\n  lastUsedIndex = -1;\n\n  constructor(private readonly ciphers: CipherView[]) {}\n\n  getLastUsed() {\n    this.lastUsedIndex = Math.max(this.lastUsedIndex, 0);\n    return this.ciphers[this.lastUsedIndex];\n  }\n\n  getLastLaunched() {\n    const usedCiphers = this.ciphers.filter((cipher) => cipher.localData?.lastLaunched);\n    const sortedCiphers = usedCiphers.sort(\n      (x, y) => y.localData.lastLaunched.valueOf() - x.localData.lastLaunched.valueOf(),\n    );\n    return sortedCiphers[0];\n  }\n\n  getNextIndex() {\n    return (this.lastUsedIndex + 1) % this.ciphers.length;\n  }\n\n  getNext() {\n    return this.ciphers[this.getNextIndex()];\n  }\n\n  updateLastUsedIndex() {\n    this.lastUsedIndex = this.getNextIndex();\n  }\n}\n","export class CipherBulkDeleteRequest {\n  ids: string[];\n  organizationId: string;\n\n  constructor(ids: string[], organizationId?: string) {\n    this.ids = ids == null ? [] : ids;\n    this.organizationId = organizationId;\n  }\n}\n","export class CipherBulkMoveRequest {\n  ids: string[];\n  folderId: string;\n\n  constructor(ids: string[], folderId: string) {\n    this.ids = ids == null ? [] : ids;\n    this.folderId = folderId;\n  }\n}\n","export class CipherBulkRestoreRequest {\n  ids: string[];\n  organizationId: string;\n\n  constructor(ids: string[], organizationId?: string) {\n    this.ids = ids == null ? [] : ids;\n    this.organizationId = organizationId;\n  }\n}\n","export class AttachmentRequest {\n  fileName: string;\n  key: string;\n  fileSize: number;\n  adminRequest: boolean;\n}\n","import { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../enums/cipher-type\";\nimport { CardApi } from \"../api/card.api\";\nimport { Fido2CredentialApi } from \"../api/fido2-credential.api\";\nimport { FieldApi } from \"../api/field.api\";\nimport { IdentityApi } from \"../api/identity.api\";\nimport { LoginUriApi } from \"../api/login-uri.api\";\nimport { LoginApi } from \"../api/login.api\";\nimport { SecureNoteApi } from \"../api/secure-note.api\";\nimport { Cipher } from \"../domain/cipher\";\n\nimport { AttachmentRequest } from \"./attachment.request\";\nimport { PasswordHistoryRequest } from \"./password-history.request\";\n\nexport class CipherRequest {\n  type: CipherType;\n  folderId: string;\n  organizationId: string;\n  name: string;\n  notes: string;\n  favorite: boolean;\n  login: LoginApi;\n  secureNote: SecureNoteApi;\n  card: CardApi;\n  identity: IdentityApi;\n  fields: FieldApi[];\n  passwordHistory: PasswordHistoryRequest[];\n  // Deprecated, remove at some point and rename attachments2 to attachments\n  attachments: { [id: string]: string };\n  attachments2: { [id: string]: AttachmentRequest };\n  lastKnownRevisionDate: Date;\n  reprompt: CipherRepromptType;\n  key: string;\n\n  constructor(cipher: Cipher) {\n    this.type = cipher.type;\n    this.folderId = cipher.folderId;\n    this.organizationId = cipher.organizationId;\n    this.name = cipher.name ? cipher.name.encryptedString : null;\n    this.notes = cipher.notes ? cipher.notes.encryptedString : null;\n    this.favorite = cipher.favorite;\n    this.lastKnownRevisionDate = cipher.revisionDate;\n    this.reprompt = cipher.reprompt;\n    this.key = cipher.key?.encryptedString;\n\n    switch (this.type) {\n      case CipherType.Login:\n        this.login = new LoginApi();\n        this.login.uris =\n          cipher.login.uris?.map((u) => {\n            const uri = new LoginUriApi();\n            uri.uri = u.uri != null ? u.uri.encryptedString : null;\n            uri.match = u.match != null ? u.match : null;\n            uri.uriChecksum = u.uriChecksum != null ? u.uriChecksum.encryptedString : null;\n            return uri;\n          }) ?? [];\n        this.login.username = cipher.login.username ? cipher.login.username.encryptedString : null;\n        this.login.password = cipher.login.password ? cipher.login.password.encryptedString : null;\n        this.login.passwordRevisionDate =\n          cipher.login.passwordRevisionDate != null\n            ? cipher.login.passwordRevisionDate.toISOString()\n            : null;\n        this.login.totp = cipher.login.totp ? cipher.login.totp.encryptedString : null;\n        this.login.autofillOnPageLoad = cipher.login.autofillOnPageLoad;\n\n        if (cipher.login.fido2Credentials != null) {\n          this.login.fido2Credentials = cipher.login.fido2Credentials.map((key) => {\n            const keyApi = new Fido2CredentialApi();\n            keyApi.credentialId =\n              key.credentialId != null ? key.credentialId.encryptedString : null;\n            keyApi.keyType =\n              key.keyType != null ? (key.keyType.encryptedString as \"public-key\") : null;\n            keyApi.keyAlgorithm =\n              key.keyAlgorithm != null ? (key.keyAlgorithm.encryptedString as \"ECDSA\") : null;\n            keyApi.keyCurve =\n              key.keyCurve != null ? (key.keyCurve.encryptedString as \"P-256\") : null;\n            keyApi.keyValue = key.keyValue != null ? key.keyValue.encryptedString : null;\n            keyApi.rpId = key.rpId != null ? key.rpId.encryptedString : null;\n            keyApi.rpName = key.rpName != null ? key.rpName.encryptedString : null;\n            keyApi.counter = key.counter != null ? key.counter.encryptedString : null;\n            keyApi.userHandle = key.userHandle != null ? key.userHandle.encryptedString : null;\n            keyApi.userName = key.userName != null ? key.userName.encryptedString : null;\n            keyApi.userDisplayName =\n              key.userDisplayName != null ? key.userDisplayName.encryptedString : null;\n            keyApi.discoverable =\n              key.discoverable != null ? key.discoverable.encryptedString : null;\n            keyApi.creationDate = key.creationDate != null ? key.creationDate.toISOString() : null;\n            return keyApi;\n          });\n        }\n        break;\n      case CipherType.SecureNote:\n        this.secureNote = new SecureNoteApi();\n        this.secureNote.type = cipher.secureNote.type;\n        break;\n      case CipherType.Card:\n        this.card = new CardApi();\n        this.card.cardholderName =\n          cipher.card.cardholderName != null ? cipher.card.cardholderName.encryptedString : null;\n        this.card.brand = cipher.card.brand != null ? cipher.card.brand.encryptedString : null;\n        this.card.number = cipher.card.number != null ? cipher.card.number.encryptedString : null;\n        this.card.expMonth =\n          cipher.card.expMonth != null ? cipher.card.expMonth.encryptedString : null;\n        this.card.expYear =\n          cipher.card.expYear != null ? cipher.card.expYear.encryptedString : null;\n        this.card.code = cipher.card.code != null ? cipher.card.code.encryptedString : null;\n        break;\n      case CipherType.Identity:\n        this.identity = new IdentityApi();\n        this.identity.title =\n          cipher.identity.title != null ? cipher.identity.title.encryptedString : null;\n        this.identity.firstName =\n          cipher.identity.firstName != null ? cipher.identity.firstName.encryptedString : null;\n        this.identity.middleName =\n          cipher.identity.middleName != null ? cipher.identity.middleName.encryptedString : null;\n        this.identity.lastName =\n          cipher.identity.lastName != null ? cipher.identity.lastName.encryptedString : null;\n        this.identity.address1 =\n          cipher.identity.address1 != null ? cipher.identity.address1.encryptedString : null;\n        this.identity.address2 =\n          cipher.identity.address2 != null ? cipher.identity.address2.encryptedString : null;\n        this.identity.address3 =\n          cipher.identity.address3 != null ? cipher.identity.address3.encryptedString : null;\n        this.identity.city =\n          cipher.identity.city != null ? cipher.identity.city.encryptedString : null;\n        this.identity.state =\n          cipher.identity.state != null ? cipher.identity.state.encryptedString : null;\n        this.identity.postalCode =\n          cipher.identity.postalCode != null ? cipher.identity.postalCode.encryptedString : null;\n        this.identity.country =\n          cipher.identity.country != null ? cipher.identity.country.encryptedString : null;\n        this.identity.company =\n          cipher.identity.company != null ? cipher.identity.company.encryptedString : null;\n        this.identity.email =\n          cipher.identity.email != null ? cipher.identity.email.encryptedString : null;\n        this.identity.phone =\n          cipher.identity.phone != null ? cipher.identity.phone.encryptedString : null;\n        this.identity.ssn =\n          cipher.identity.ssn != null ? cipher.identity.ssn.encryptedString : null;\n        this.identity.username =\n          cipher.identity.username != null ? cipher.identity.username.encryptedString : null;\n        this.identity.passportNumber =\n          cipher.identity.passportNumber != null\n            ? cipher.identity.passportNumber.encryptedString\n            : null;\n        this.identity.licenseNumber =\n          cipher.identity.licenseNumber != null\n            ? cipher.identity.licenseNumber.encryptedString\n            : null;\n        break;\n      default:\n        break;\n    }\n\n    if (cipher.fields != null) {\n      this.fields = cipher.fields.map((f) => {\n        const field = new FieldApi();\n        field.type = f.type;\n        field.name = f.name ? f.name.encryptedString : null;\n        field.value = f.value ? f.value.encryptedString : null;\n        field.linkedId = f.linkedId;\n        return field;\n      });\n    }\n\n    if (cipher.passwordHistory != null) {\n      this.passwordHistory = [];\n      cipher.passwordHistory.forEach((ph) => {\n        this.passwordHistory.push({\n          lastUsedDate: ph.lastUsedDate,\n          password: ph.password ? ph.password.encryptedString : null,\n        });\n      });\n    }\n\n    if (cipher.attachments != null) {\n      this.attachments = {};\n      this.attachments2 = {};\n      cipher.attachments.forEach((attachment) => {\n        const fileName = attachment.fileName ? attachment.fileName.encryptedString : null;\n        this.attachments[attachment.id] = fileName;\n        const attachmentRequest = new AttachmentRequest();\n        attachmentRequest.fileName = fileName;\n        if (attachment.key != null) {\n          attachmentRequest.key = attachment.key.encryptedString;\n        }\n        this.attachments2[attachment.id] = attachmentRequest;\n      });\n    }\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nimport { CipherRequest } from \"./cipher.request\";\n\nexport class CipherWithIdRequest extends CipherRequest {\n  id: string;\n\n  constructor(cipher: Cipher) {\n    super(cipher);\n    this.id = cipher.id;\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nimport { CipherWithIdRequest } from \"./cipher-with-id.request\";\n\nexport class CipherBulkShareRequest {\n  ciphers: CipherWithIdRequest[];\n  collectionIds: string[];\n\n  constructor(ciphers: Cipher[], collectionIds: string[]) {\n    if (ciphers != null) {\n      this.ciphers = [];\n      ciphers.forEach((c) => {\n        this.ciphers.push(new CipherWithIdRequest(c));\n      });\n    }\n    this.collectionIds = collectionIds;\n  }\n}\n","export class CipherCollectionsRequest {\n  collectionIds: string[];\n\n  constructor(collectionIds: string[]) {\n    this.collectionIds = collectionIds == null ? [] : collectionIds;\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nimport { CipherRequest } from \"./cipher.request\";\n\nexport class CipherCreateRequest {\n  cipher: CipherRequest;\n  collectionIds: string[];\n\n  constructor(cipher: Cipher) {\n    this.cipher = new CipherRequest(cipher);\n    this.collectionIds = cipher.collectionIds;\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nexport class CipherPartialRequest {\n  folderId: string;\n  favorite: boolean;\n\n  constructor(cipher: Cipher) {\n    this.folderId = cipher.folderId;\n    this.favorite = cipher.favorite;\n  }\n}\n","import { Cipher } from \"../domain/cipher\";\n\nimport { CipherRequest } from \"./cipher.request\";\n\nexport class CipherShareRequest {\n  cipher: CipherRequest;\n  collectionIds: string[];\n\n  constructor(cipher: Cipher) {\n    this.cipher = new CipherRequest(cipher);\n    this.collectionIds = cipher.collectionIds;\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\nimport { SemVer } from \"semver\";\n\nimport { ApiService } from \"../../abstractions/api.service\";\nimport { SearchService } from \"../../abstractions/search.service\";\nimport { SettingsService } from \"../../abstractions/settings.service\";\nimport { AutofillSettingsServiceAbstraction } from \"../../autofill/services/autofill-settings.service\";\nimport { ErrorResponse } from \"../../models/response/error.response\";\nimport { ListResponse } from \"../../models/response/list.response\";\nimport { View } from \"../../models/view/view\";\nimport { ConfigServiceAbstraction } from \"../../platform/abstractions/config/config.service.abstraction\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { EncryptService } from \"../../platform/abstractions/encrypt.service\";\nimport { I18nService } from \"../../platform/abstractions/i18n.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\nimport { flagEnabled } from \"../../platform/misc/flags\";\nimport { sequentialize } from \"../../platform/misc/sequentialize\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport Domain from \"../../platform/models/domain/domain-base\";\nimport { EncArrayBuffer } from \"../../platform/models/domain/enc-array-buffer\";\nimport { EncString } from \"../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../platform/models/domain/symmetric-crypto-key\";\nimport { UserKey, OrgKey } from \"../../types/key\";\nimport { CipherService as CipherServiceAbstraction } from \"../abstractions/cipher.service\";\nimport { CipherFileUploadService } from \"../abstractions/file-upload/cipher-file-upload.service\";\nimport { FieldType, UriMatchType } from \"../enums\";\nimport { CipherType } from \"../enums/cipher-type\";\nimport { CipherData } from \"../models/data/cipher.data\";\nimport { Attachment } from \"../models/domain/attachment\";\nimport { Card } from \"../models/domain/card\";\nimport { Cipher } from \"../models/domain/cipher\";\nimport { Fido2Credential } from \"../models/domain/fido2-credential\";\nimport { Field } from \"../models/domain/field\";\nimport { Identity } from \"../models/domain/identity\";\nimport { Login } from \"../models/domain/login\";\nimport { LoginUri } from \"../models/domain/login-uri\";\nimport { Password } from \"../models/domain/password\";\nimport { SecureNote } from \"../models/domain/secure-note\";\nimport { SortedCiphersCache } from \"../models/domain/sorted-ciphers-cache\";\nimport { CipherBulkDeleteRequest } from \"../models/request/cipher-bulk-delete.request\";\nimport { CipherBulkMoveRequest } from \"../models/request/cipher-bulk-move.request\";\nimport { CipherBulkRestoreRequest } from \"../models/request/cipher-bulk-restore.request\";\nimport { CipherBulkShareRequest } from \"../models/request/cipher-bulk-share.request\";\nimport { CipherCollectionsRequest } from \"../models/request/cipher-collections.request\";\nimport { CipherCreateRequest } from \"../models/request/cipher-create.request\";\nimport { CipherPartialRequest } from \"../models/request/cipher-partial.request\";\nimport { CipherShareRequest } from \"../models/request/cipher-share.request\";\nimport { CipherRequest } from \"../models/request/cipher.request\";\nimport { CipherResponse } from \"../models/response/cipher.response\";\nimport { AttachmentView } from \"../models/view/attachment.view\";\nimport { CipherView } from \"../models/view/cipher.view\";\nimport { FieldView } from \"../models/view/field.view\";\nimport { PasswordHistoryView } from \"../models/view/password-history.view\";\n\nconst CIPHER_KEY_ENC_MIN_SERVER_VER = new SemVer(\"2024.2.0\");\n\nexport class CipherService implements CipherServiceAbstraction {\n  private sortedCiphersCache: SortedCiphersCache = new SortedCiphersCache(\n    this.sortCiphersByLastUsed,\n  );\n\n  constructor(\n    private cryptoService: CryptoService,\n    private settingsService: SettingsService,\n    private apiService: ApiService,\n    private i18nService: I18nService,\n    private searchService: SearchService,\n    private stateService: StateService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private encryptService: EncryptService,\n    private cipherFileUploadService: CipherFileUploadService,\n    private configService: ConfigServiceAbstraction,\n  ) {}\n\n  async getDecryptedCipherCache(): Promise<CipherView[]> {\n    const decryptedCiphers = await this.stateService.getDecryptedCiphers();\n    return decryptedCiphers;\n  }\n\n  async setDecryptedCipherCache(value: CipherView[]) {\n    await this.stateService.setDecryptedCiphers(value);\n    if (this.searchService != null) {\n      if (value == null) {\n        this.searchService.clearIndex();\n      } else {\n        this.searchService.indexCiphers(value);\n      }\n    }\n  }\n\n  async clearCache(userId?: string): Promise<void> {\n    await this.clearDecryptedCiphersState(userId);\n  }\n\n  async encrypt(\n    model: CipherView,\n    keyForEncryption?: SymmetricCryptoKey,\n    keyForCipherKeyDecryption?: SymmetricCryptoKey,\n    originalCipher: Cipher = null,\n  ): Promise<Cipher> {\n    if (model.id != null) {\n      if (originalCipher == null) {\n        originalCipher = await this.get(model.id);\n      }\n      if (originalCipher != null) {\n        await this.updateModelfromExistingCipher(model, originalCipher);\n      }\n      this.adjustPasswordHistoryLength(model);\n    }\n\n    const cipher = new Cipher();\n    cipher.id = model.id;\n    cipher.folderId = model.folderId;\n    cipher.favorite = model.favorite;\n    cipher.organizationId = model.organizationId;\n    cipher.type = model.type;\n    cipher.collectionIds = model.collectionIds;\n    cipher.revisionDate = model.revisionDate;\n    cipher.reprompt = model.reprompt;\n    cipher.edit = model.edit;\n\n    if (await this.getCipherKeyEncryptionEnabled()) {\n      cipher.key = originalCipher?.key ?? null;\n      const userOrOrgKey = await this.getKeyForCipherKeyDecryption(cipher);\n      // The keyForEncryption is only used for encrypting the cipher key, not the cipher itself, since cipher key encryption is enabled.\n      // If the caller has provided a key for cipher key encryption, use it. Otherwise, use the user or org key.\n      keyForEncryption ||= userOrOrgKey;\n      // If the caller has provided a key for cipher key decryption, use it. Otherwise, use the user or org key.\n      keyForCipherKeyDecryption ||= userOrOrgKey;\n      return this.encryptCipherWithCipherKey(\n        model,\n        cipher,\n        keyForEncryption,\n        keyForCipherKeyDecryption,\n      );\n    } else {\n      if (keyForEncryption == null && cipher.organizationId != null) {\n        keyForEncryption = await this.cryptoService.getOrgKey(cipher.organizationId);\n        if (keyForEncryption == null) {\n          throw new Error(\"Cannot encrypt cipher for organization. No key.\");\n        }\n      }\n      // We want to ensure that the cipher key is null if cipher key encryption is disabled\n      // so that decryption uses the proper key.\n      cipher.key = null;\n      return this.encryptCipher(model, cipher, keyForEncryption);\n    }\n  }\n\n  async encryptAttachments(\n    attachmentsModel: AttachmentView[],\n    key: SymmetricCryptoKey,\n  ): Promise<Attachment[]> {\n    if (attachmentsModel == null || attachmentsModel.length === 0) {\n      return null;\n    }\n\n    const promises: Promise<any>[] = [];\n    const encAttachments: Attachment[] = [];\n    attachmentsModel.forEach(async (model) => {\n      const attachment = new Attachment();\n      attachment.id = model.id;\n      attachment.size = model.size;\n      attachment.sizeName = model.sizeName;\n      attachment.url = model.url;\n      const promise = this.encryptObjProperty(\n        model,\n        attachment,\n        {\n          fileName: null,\n        },\n        key,\n      ).then(async () => {\n        if (model.key != null) {\n          attachment.key = await this.cryptoService.encrypt(model.key.key, key);\n        }\n        encAttachments.push(attachment);\n      });\n      promises.push(promise);\n    });\n\n    await Promise.all(promises);\n    return encAttachments;\n  }\n\n  async encryptFields(fieldsModel: FieldView[], key: SymmetricCryptoKey): Promise<Field[]> {\n    if (!fieldsModel || !fieldsModel.length) {\n      return null;\n    }\n\n    const self = this;\n    const encFields: Field[] = [];\n    await fieldsModel.reduce(async (promise, field) => {\n      await promise;\n      const encField = await self.encryptField(field, key);\n      encFields.push(encField);\n    }, Promise.resolve());\n\n    return encFields;\n  }\n\n  async encryptField(fieldModel: FieldView, key: SymmetricCryptoKey): Promise<Field> {\n    const field = new Field();\n    field.type = fieldModel.type;\n    field.linkedId = fieldModel.linkedId;\n    // normalize boolean type field values\n    if (fieldModel.type === FieldType.Boolean && fieldModel.value !== \"true\") {\n      fieldModel.value = \"false\";\n    }\n\n    await this.encryptObjProperty(\n      fieldModel,\n      field,\n      {\n        name: null,\n        value: null,\n      },\n      key,\n    );\n\n    return field;\n  }\n\n  async encryptPasswordHistories(\n    phModels: PasswordHistoryView[],\n    key: SymmetricCryptoKey,\n  ): Promise<Password[]> {\n    if (!phModels || !phModels.length) {\n      return null;\n    }\n\n    const self = this;\n    const encPhs: Password[] = [];\n    await phModels.reduce(async (promise, ph) => {\n      await promise;\n      const encPh = await self.encryptPasswordHistory(ph, key);\n      encPhs.push(encPh);\n    }, Promise.resolve());\n\n    return encPhs;\n  }\n\n  async encryptPasswordHistory(\n    phModel: PasswordHistoryView,\n    key: SymmetricCryptoKey,\n  ): Promise<Password> {\n    const ph = new Password();\n    ph.lastUsedDate = phModel.lastUsedDate;\n\n    await this.encryptObjProperty(\n      phModel,\n      ph,\n      {\n        password: null,\n      },\n      key,\n    );\n\n    return ph;\n  }\n\n  async get(id: string): Promise<Cipher> {\n    const ciphers = await this.stateService.getEncryptedCiphers();\n    // eslint-disable-next-line\n    if (ciphers == null || !ciphers.hasOwnProperty(id)) {\n      return null;\n    }\n\n    const localData = await this.stateService.getLocalData();\n    return new Cipher(ciphers[id], localData ? localData[id] : null);\n  }\n\n  async getAll(): Promise<Cipher[]> {\n    const localData = await this.stateService.getLocalData();\n    const ciphers = await this.stateService.getEncryptedCiphers();\n    const response: Cipher[] = [];\n    for (const id in ciphers) {\n      // eslint-disable-next-line\n      if (ciphers.hasOwnProperty(id)) {\n        response.push(new Cipher(ciphers[id], localData ? localData[id] : null));\n      }\n    }\n    return response;\n  }\n\n  @sequentialize(() => \"getAllDecrypted\")\n  async getAllDecrypted(): Promise<CipherView[]> {\n    if ((await this.getDecryptedCipherCache()) != null) {\n      await this.reindexCiphers();\n      return await this.getDecryptedCipherCache();\n    }\n\n    const ciphers = await this.getAll();\n    const orgKeys = await this.cryptoService.getOrgKeys();\n    const userKey = await this.cryptoService.getUserKeyWithLegacySupport();\n    if (Object.keys(orgKeys).length === 0 && userKey == null) {\n      // return early if there are no keys to decrypt with\n      return;\n    }\n\n    // Group ciphers by orgId or under 'null' for the user's ciphers\n    const grouped = ciphers.reduce(\n      (agg, c) => {\n        agg[c.organizationId] ??= [];\n        agg[c.organizationId].push(c);\n        return agg;\n      },\n      {} as Record<string, Cipher[]>,\n    );\n\n    const decCiphers = (\n      await Promise.all(\n        Object.entries(grouped).map(([orgId, groupedCiphers]) =>\n          this.encryptService.decryptItems(groupedCiphers, orgKeys[orgId] ?? userKey),\n        ),\n      )\n    )\n      .flat()\n      .sort(this.getLocaleSortingFunction());\n\n    await this.setDecryptedCipherCache(decCiphers);\n    return decCiphers;\n  }\n\n  private async reindexCiphers() {\n    const userId = await this.stateService.getUserId();\n    const reindexRequired =\n      this.searchService != null && (this.searchService.indexedEntityId ?? userId) !== userId;\n    if (reindexRequired) {\n      this.searchService.indexCiphers(await this.getDecryptedCipherCache(), userId);\n    }\n  }\n\n  async getAllDecryptedForGrouping(groupingId: string, folder = true): Promise<CipherView[]> {\n    const ciphers = await this.getAllDecrypted();\n\n    return ciphers.filter((cipher) => {\n      if (cipher.isDeleted) {\n        return false;\n      }\n      if (folder && cipher.folderId === groupingId) {\n        return true;\n      } else if (\n        !folder &&\n        cipher.collectionIds != null &&\n        cipher.collectionIds.indexOf(groupingId) > -1\n      ) {\n        return true;\n      }\n\n      return false;\n    });\n  }\n\n  async getAllDecryptedForUrl(\n    url: string,\n    includeOtherTypes?: CipherType[],\n    defaultMatch: UriMatchType = null,\n  ): Promise<CipherView[]> {\n    if (url == null && includeOtherTypes == null) {\n      return Promise.resolve([]);\n    }\n\n    const equivalentDomains = this.settingsService.getEquivalentDomains(url);\n    const ciphers = await this.getAllDecrypted();\n    defaultMatch ??= await this.stateService.getDefaultUriMatch();\n\n    return ciphers.filter((cipher) => {\n      const cipherIsLogin = cipher.type === CipherType.Login && cipher.login !== null;\n\n      if (cipher.deletedDate !== null) {\n        return false;\n      }\n\n      if (\n        Array.isArray(includeOtherTypes) &&\n        includeOtherTypes.includes(cipher.type) &&\n        !cipherIsLogin\n      ) {\n        return true;\n      }\n\n      if (cipherIsLogin) {\n        return cipher.login.matchesUri(url, equivalentDomains, defaultMatch);\n      }\n\n      return false;\n    });\n  }\n\n  async getAllFromApiForOrganization(organizationId: string): Promise<CipherView[]> {\n    const response = await this.apiService.getCiphersOrganization(organizationId);\n    return await this.decryptOrganizationCiphersResponse(response, organizationId);\n  }\n\n  async getManyFromApiForOrganization(organizationId: string): Promise<CipherView[]> {\n    const response = await this.apiService.send(\n      \"GET\",\n      \"/ciphers/organization-details/assigned?organizationId=\" + organizationId,\n      null,\n      true,\n      true,\n    );\n    return this.decryptOrganizationCiphersResponse(response, organizationId);\n  }\n\n  private async decryptOrganizationCiphersResponse(\n    response: ListResponse<CipherResponse>,\n    organizationId: string,\n  ): Promise<CipherView[]> {\n    if (response?.data == null || response.data.length < 1) {\n      return [];\n    }\n\n    const ciphers = response.data.map((cr) => new Cipher(new CipherData(cr)));\n    const key = await this.cryptoService.getOrgKey(organizationId);\n    const decCiphers = await this.encryptService.decryptItems(ciphers, key);\n\n    decCiphers.sort(this.getLocaleSortingFunction());\n    return decCiphers;\n  }\n\n  async getLastUsedForUrl(url: string, autofillOnPageLoad = false): Promise<CipherView> {\n    return this.getCipherForUrl(url, true, false, autofillOnPageLoad);\n  }\n\n  async getLastLaunchedForUrl(url: string, autofillOnPageLoad = false): Promise<CipherView> {\n    return this.getCipherForUrl(url, false, true, autofillOnPageLoad);\n  }\n\n  async getNextCipherForUrl(url: string): Promise<CipherView> {\n    return this.getCipherForUrl(url, false, false, false);\n  }\n\n  updateLastUsedIndexForUrl(url: string) {\n    this.sortedCiphersCache.updateLastUsedIndex(url);\n  }\n\n  async updateLastUsedDate(id: string): Promise<void> {\n    let ciphersLocalData = await this.stateService.getLocalData();\n    if (!ciphersLocalData) {\n      ciphersLocalData = {};\n    }\n\n    if (ciphersLocalData[id]) {\n      ciphersLocalData[id].lastUsedDate = new Date().getTime();\n    } else {\n      ciphersLocalData[id] = {\n        lastUsedDate: new Date().getTime(),\n      };\n    }\n\n    await this.stateService.setLocalData(ciphersLocalData);\n\n    const decryptedCipherCache = await this.stateService.getDecryptedCiphers();\n    if (!decryptedCipherCache) {\n      return;\n    }\n\n    for (let i = 0; i < decryptedCipherCache.length; i++) {\n      const cached = decryptedCipherCache[i];\n      if (cached.id === id) {\n        cached.localData = ciphersLocalData[id];\n        break;\n      }\n    }\n    await this.stateService.setDecryptedCiphers(decryptedCipherCache);\n  }\n\n  async updateLastLaunchedDate(id: string): Promise<void> {\n    let ciphersLocalData = await this.stateService.getLocalData();\n    if (!ciphersLocalData) {\n      ciphersLocalData = {};\n    }\n\n    if (ciphersLocalData[id]) {\n      ciphersLocalData[id].lastLaunched = new Date().getTime();\n    } else {\n      ciphersLocalData[id] = {\n        lastUsedDate: new Date().getTime(),\n      };\n    }\n\n    await this.stateService.setLocalData(ciphersLocalData);\n\n    const decryptedCipherCache = await this.stateService.getDecryptedCiphers();\n    if (!decryptedCipherCache) {\n      return;\n    }\n\n    for (let i = 0; i < decryptedCipherCache.length; i++) {\n      const cached = decryptedCipherCache[i];\n      if (cached.id === id) {\n        cached.localData = ciphersLocalData[id];\n        break;\n      }\n    }\n    await this.stateService.setDecryptedCiphers(decryptedCipherCache);\n  }\n\n  async saveNeverDomain(domain: string): Promise<void> {\n    if (domain == null) {\n      return;\n    }\n\n    let domains = await this.stateService.getNeverDomains();\n    if (!domains) {\n      domains = {};\n    }\n    domains[domain] = null;\n    await this.stateService.setNeverDomains(domains);\n  }\n\n  async createWithServer(cipher: Cipher, orgAdmin?: boolean): Promise<any> {\n    let response: CipherResponse;\n    if (orgAdmin && cipher.organizationId != null) {\n      const request = new CipherCreateRequest(cipher);\n      response = await this.apiService.postCipherAdmin(request);\n    } else if (cipher.collectionIds != null) {\n      const request = new CipherCreateRequest(cipher);\n      response = await this.apiService.postCipherCreate(request);\n    } else {\n      const request = new CipherRequest(cipher);\n      response = await this.apiService.postCipher(request);\n    }\n    cipher.id = response.id;\n\n    const data = new CipherData(response, cipher.collectionIds);\n    await this.upsert(data);\n  }\n\n  async updateWithServer(cipher: Cipher, orgAdmin?: boolean, isNotClone?: boolean): Promise<any> {\n    let response: CipherResponse;\n    if (orgAdmin && isNotClone) {\n      const request = new CipherRequest(cipher);\n      response = await this.apiService.putCipherAdmin(cipher.id, request);\n    } else if (cipher.edit) {\n      const request = new CipherRequest(cipher);\n      response = await this.apiService.putCipher(cipher.id, request);\n    } else {\n      const request = new CipherPartialRequest(cipher);\n      response = await this.apiService.putPartialCipher(cipher.id, request);\n    }\n\n    const data = new CipherData(response, cipher.collectionIds);\n    await this.upsert(data);\n  }\n\n  async shareWithServer(\n    cipher: CipherView,\n    organizationId: string,\n    collectionIds: string[],\n  ): Promise<any> {\n    const attachmentPromises: Promise<any>[] = [];\n    if (cipher.attachments != null) {\n      cipher.attachments.forEach((attachment) => {\n        if (attachment.key == null) {\n          attachmentPromises.push(\n            this.shareAttachmentWithServer(attachment, cipher.id, organizationId),\n          );\n        }\n      });\n    }\n    await Promise.all(attachmentPromises);\n\n    cipher.organizationId = organizationId;\n    cipher.collectionIds = collectionIds;\n    const encCipher = await this.encryptSharedCipher(cipher);\n    const request = new CipherShareRequest(encCipher);\n    const response = await this.apiService.putShareCipher(cipher.id, request);\n    const data = new CipherData(response, collectionIds);\n    await this.upsert(data);\n  }\n\n  async shareManyWithServer(\n    ciphers: CipherView[],\n    organizationId: string,\n    collectionIds: string[],\n  ): Promise<any> {\n    const promises: Promise<any>[] = [];\n    const encCiphers: Cipher[] = [];\n    for (const cipher of ciphers) {\n      cipher.organizationId = organizationId;\n      cipher.collectionIds = collectionIds;\n      promises.push(\n        this.encryptSharedCipher(cipher).then((c) => {\n          encCiphers.push(c);\n        }),\n      );\n    }\n    await Promise.all(promises);\n    const request = new CipherBulkShareRequest(encCiphers, collectionIds);\n    try {\n      await this.apiService.putShareCiphers(request);\n    } catch (e) {\n      for (const cipher of ciphers) {\n        cipher.organizationId = null;\n        cipher.collectionIds = null;\n      }\n      throw e;\n    }\n    await this.upsert(encCiphers.map((c) => c.toCipherData()));\n  }\n\n  saveAttachmentWithServer(cipher: Cipher, unencryptedFile: any, admin = false): Promise<Cipher> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsArrayBuffer(unencryptedFile);\n      reader.onload = async (evt: any) => {\n        try {\n          const cData = await this.saveAttachmentRawWithServer(\n            cipher,\n            unencryptedFile.name,\n            evt.target.result,\n            admin,\n          );\n          resolve(cData);\n        } catch (e) {\n          reject(e);\n        }\n      };\n      reader.onerror = () => {\n        reject(\"Error reading file.\");\n      };\n    });\n  }\n\n  async saveAttachmentRawWithServer(\n    cipher: Cipher,\n    filename: string,\n    data: Uint8Array,\n    admin = false,\n  ): Promise<Cipher> {\n    const encKey = await this.getKeyForCipherKeyDecryption(cipher);\n    const cipherKeyEncryptionEnabled = await this.getCipherKeyEncryptionEnabled();\n\n    const cipherEncKey =\n      cipherKeyEncryptionEnabled && cipher.key != null\n        ? (new SymmetricCryptoKey(\n            await this.encryptService.decryptToBytes(cipher.key, encKey),\n          ) as UserKey)\n        : encKey;\n\n    //if cipher key encryption is disabled but the item has an individual key,\n    //then we rollback to using the user key as the main key of encryption of the item\n    //in order to keep item and it's attachments with the same encryption level\n    if (cipher.key != null && !cipherKeyEncryptionEnabled) {\n      const model = await cipher.decrypt(await this.getKeyForCipherKeyDecryption(cipher));\n      cipher = await this.encrypt(model);\n      await this.updateWithServer(cipher);\n    }\n\n    const encFileName = await this.encryptService.encrypt(filename, cipherEncKey);\n\n    const dataEncKey = await this.cryptoService.makeDataEncKey(cipherEncKey);\n    const encData = await this.encryptService.encryptToBytes(new Uint8Array(data), dataEncKey[0]);\n\n    const response = await this.cipherFileUploadService.upload(\n      cipher,\n      encFileName,\n      encData,\n      admin,\n      dataEncKey,\n    );\n\n    const cData = new CipherData(response, cipher.collectionIds);\n    if (!admin) {\n      await this.upsert(cData);\n    }\n    return new Cipher(cData);\n  }\n\n  async saveCollectionsWithServer(cipher: Cipher): Promise<any> {\n    const request = new CipherCollectionsRequest(cipher.collectionIds);\n    await this.apiService.putCipherCollections(cipher.id, request);\n    const data = cipher.toCipherData();\n    await this.upsert(data);\n  }\n\n  async upsert(cipher: CipherData | CipherData[]): Promise<any> {\n    let ciphers = await this.stateService.getEncryptedCiphers();\n    if (ciphers == null) {\n      ciphers = {};\n    }\n\n    if (cipher instanceof CipherData) {\n      const c = cipher as CipherData;\n      ciphers[c.id] = c;\n    } else {\n      (cipher as CipherData[]).forEach((c) => {\n        ciphers[c.id] = c;\n      });\n    }\n\n    await this.replace(ciphers);\n  }\n\n  async replace(ciphers: { [id: string]: CipherData }): Promise<any> {\n    await this.clearDecryptedCiphersState();\n    await this.stateService.setEncryptedCiphers(ciphers);\n  }\n\n  async clear(userId?: string): Promise<any> {\n    await this.clearEncryptedCiphersState(userId);\n    await this.clearCache(userId);\n  }\n\n  async moveManyWithServer(ids: string[], folderId: string): Promise<any> {\n    await this.apiService.putMoveCiphers(new CipherBulkMoveRequest(ids, folderId));\n\n    let ciphers = await this.stateService.getEncryptedCiphers();\n    if (ciphers == null) {\n      ciphers = {};\n    }\n\n    ids.forEach((id) => {\n      // eslint-disable-next-line\n      if (ciphers.hasOwnProperty(id)) {\n        ciphers[id].folderId = folderId;\n      }\n    });\n\n    await this.clearCache();\n    await this.stateService.setEncryptedCiphers(ciphers);\n  }\n\n  async delete(id: string | string[]): Promise<any> {\n    const ciphers = await this.stateService.getEncryptedCiphers();\n    if (ciphers == null) {\n      return;\n    }\n\n    if (typeof id === \"string\") {\n      if (ciphers[id] == null) {\n        return;\n      }\n      delete ciphers[id];\n    } else {\n      (id as string[]).forEach((i) => {\n        delete ciphers[i];\n      });\n    }\n\n    await this.clearCache();\n    await this.stateService.setEncryptedCiphers(ciphers);\n  }\n\n  async deleteWithServer(id: string, asAdmin = false): Promise<any> {\n    if (asAdmin) {\n      await this.apiService.deleteCipherAdmin(id);\n    } else {\n      await this.apiService.deleteCipher(id);\n    }\n\n    await this.delete(id);\n  }\n\n  async deleteManyWithServer(ids: string[], asAdmin = false): Promise<any> {\n    const request = new CipherBulkDeleteRequest(ids);\n    if (asAdmin) {\n      await this.apiService.deleteManyCiphersAdmin(request);\n    } else {\n      await this.apiService.deleteManyCiphers(request);\n    }\n    await this.delete(ids);\n  }\n\n  async deleteAttachment(id: string, attachmentId: string): Promise<void> {\n    const ciphers = await this.stateService.getEncryptedCiphers();\n\n    // eslint-disable-next-line\n    if (ciphers == null || !ciphers.hasOwnProperty(id) || ciphers[id].attachments == null) {\n      return;\n    }\n\n    for (let i = 0; i < ciphers[id].attachments.length; i++) {\n      if (ciphers[id].attachments[i].id === attachmentId) {\n        ciphers[id].attachments.splice(i, 1);\n      }\n    }\n\n    await this.clearCache();\n    await this.stateService.setEncryptedCiphers(ciphers);\n  }\n\n  async deleteAttachmentWithServer(id: string, attachmentId: string): Promise<void> {\n    try {\n      await this.apiService.deleteCipherAttachment(id, attachmentId);\n    } catch (e) {\n      return Promise.reject((e as ErrorResponse).getSingleMessage());\n    }\n    await this.deleteAttachment(id, attachmentId);\n  }\n\n  sortCiphersByLastUsed(a: CipherView, b: CipherView): number {\n    const aLastUsed =\n      a.localData && a.localData.lastUsedDate ? (a.localData.lastUsedDate as number) : null;\n    const bLastUsed =\n      b.localData && b.localData.lastUsedDate ? (b.localData.lastUsedDate as number) : null;\n\n    const bothNotNull = aLastUsed != null && bLastUsed != null;\n    if (bothNotNull && aLastUsed < bLastUsed) {\n      return 1;\n    }\n    if (aLastUsed != null && bLastUsed == null) {\n      return -1;\n    }\n\n    if (bothNotNull && aLastUsed > bLastUsed) {\n      return -1;\n    }\n    if (bLastUsed != null && aLastUsed == null) {\n      return 1;\n    }\n\n    return 0;\n  }\n\n  sortCiphersByLastUsedThenName(a: CipherView, b: CipherView): number {\n    const result = this.sortCiphersByLastUsed(a, b);\n    if (result !== 0) {\n      return result;\n    }\n\n    return this.getLocaleSortingFunction()(a, b);\n  }\n\n  getLocaleSortingFunction(): (a: CipherView, b: CipherView) => number {\n    return (a, b) => {\n      let aName = a.name;\n      let bName = b.name;\n\n      if (aName == null && bName != null) {\n        return -1;\n      }\n      if (aName != null && bName == null) {\n        return 1;\n      }\n      if (aName == null && bName == null) {\n        return 0;\n      }\n\n      const result = this.i18nService.collator\n        ? this.i18nService.collator.compare(aName, bName)\n        : aName.localeCompare(bName);\n\n      if (result !== 0 || a.type !== CipherType.Login || b.type !== CipherType.Login) {\n        return result;\n      }\n\n      if (a.login.username != null) {\n        aName += a.login.username;\n      }\n\n      if (b.login.username != null) {\n        bName += b.login.username;\n      }\n\n      return this.i18nService.collator\n        ? this.i18nService.collator.compare(aName, bName)\n        : aName.localeCompare(bName);\n    };\n  }\n\n  async softDelete(id: string | string[]): Promise<any> {\n    const ciphers = await this.stateService.getEncryptedCiphers();\n    if (ciphers == null) {\n      return;\n    }\n\n    const setDeletedDate = (cipherId: string) => {\n      if (ciphers[cipherId] == null) {\n        return;\n      }\n      ciphers[cipherId].deletedDate = new Date().toISOString();\n    };\n\n    if (typeof id === \"string\") {\n      setDeletedDate(id);\n    } else {\n      (id as string[]).forEach(setDeletedDate);\n    }\n\n    await this.clearCache();\n    await this.stateService.setEncryptedCiphers(ciphers);\n  }\n\n  async softDeleteWithServer(id: string, asAdmin = false): Promise<any> {\n    if (asAdmin) {\n      await this.apiService.putDeleteCipherAdmin(id);\n    } else {\n      await this.apiService.putDeleteCipher(id);\n    }\n\n    await this.softDelete(id);\n  }\n\n  async softDeleteManyWithServer(ids: string[], asAdmin = false): Promise<any> {\n    const request = new CipherBulkDeleteRequest(ids);\n    if (asAdmin) {\n      await this.apiService.putDeleteManyCiphersAdmin(request);\n    } else {\n      await this.apiService.putDeleteManyCiphers(request);\n    }\n\n    await this.softDelete(ids);\n  }\n\n  async restore(\n    cipher: { id: string; revisionDate: string } | { id: string; revisionDate: string }[],\n  ) {\n    const ciphers = await this.stateService.getEncryptedCiphers();\n    if (ciphers == null) {\n      return;\n    }\n\n    const clearDeletedDate = (c: { id: string; revisionDate: string }) => {\n      if (ciphers[c.id] == null) {\n        return;\n      }\n      ciphers[c.id].deletedDate = null;\n      ciphers[c.id].revisionDate = c.revisionDate;\n    };\n\n    if (cipher.constructor.name === Array.name) {\n      (cipher as { id: string; revisionDate: string }[]).forEach(clearDeletedDate);\n    } else {\n      clearDeletedDate(cipher as { id: string; revisionDate: string });\n    }\n\n    await this.clearCache();\n    await this.stateService.setEncryptedCiphers(ciphers);\n  }\n\n  async restoreWithServer(id: string, asAdmin = false): Promise<any> {\n    let response;\n    if (asAdmin) {\n      response = await this.apiService.putRestoreCipherAdmin(id);\n    } else {\n      response = await this.apiService.putRestoreCipher(id);\n    }\n\n    await this.restore({ id: id, revisionDate: response.revisionDate });\n  }\n\n  async restoreManyWithServer(\n    ids: string[],\n    organizationId: string = null,\n    asAdmin = false,\n  ): Promise<void> {\n    let response;\n    if (asAdmin) {\n      const request = new CipherBulkRestoreRequest(ids, organizationId);\n      response = await this.apiService.putRestoreManyCiphersAdmin(request);\n    } else {\n      const request = new CipherBulkRestoreRequest(ids);\n      response = await this.apiService.putRestoreManyCiphers(request);\n    }\n\n    const restores: { id: string; revisionDate: string }[] = [];\n    for (const cipher of response.data) {\n      restores.push({ id: cipher.id, revisionDate: cipher.revisionDate });\n    }\n    await this.restore(restores);\n  }\n\n  async getKeyForCipherKeyDecryption(cipher: Cipher): Promise<UserKey | OrgKey> {\n    return (\n      (await this.cryptoService.getOrgKey(cipher.organizationId)) ||\n      ((await this.cryptoService.getUserKeyWithLegacySupport()) as UserKey)\n    );\n  }\n\n  // Helpers\n\n  // In the case of a cipher that is being shared with an organization, we want to decrypt the\n  // cipher key with the user's key and then re-encrypt it with the organization's key.\n  private async encryptSharedCipher(model: CipherView): Promise<Cipher> {\n    const keyForCipherKeyDecryption = await this.cryptoService.getUserKeyWithLegacySupport();\n    return await this.encrypt(model, null, keyForCipherKeyDecryption);\n  }\n\n  private async updateModelfromExistingCipher(\n    model: CipherView,\n    originalCipher: Cipher,\n  ): Promise<void> {\n    const existingCipher = await originalCipher.decrypt(\n      await this.getKeyForCipherKeyDecryption(originalCipher),\n    );\n    model.passwordHistory = existingCipher.passwordHistory || [];\n    if (model.type === CipherType.Login && existingCipher.type === CipherType.Login) {\n      if (\n        existingCipher.login.password != null &&\n        existingCipher.login.password !== \"\" &&\n        existingCipher.login.password !== model.login.password\n      ) {\n        const ph = new PasswordHistoryView();\n        ph.password = existingCipher.login.password;\n        ph.lastUsedDate = model.login.passwordRevisionDate = new Date();\n        model.passwordHistory.splice(0, 0, ph);\n      } else {\n        model.login.passwordRevisionDate = existingCipher.login.passwordRevisionDate;\n      }\n    }\n    if (existingCipher.hasFields) {\n      const existingHiddenFields = existingCipher.fields.filter(\n        (f) =>\n          f.type === FieldType.Hidden &&\n          f.name != null &&\n          f.name !== \"\" &&\n          f.value != null &&\n          f.value !== \"\",\n      );\n      const hiddenFields =\n        model.fields == null\n          ? []\n          : model.fields.filter(\n              (f) => f.type === FieldType.Hidden && f.name != null && f.name !== \"\",\n            );\n      existingHiddenFields.forEach((ef) => {\n        const matchedField = hiddenFields.find((f) => f.name === ef.name);\n        if (matchedField == null || matchedField.value !== ef.value) {\n          const ph = new PasswordHistoryView();\n          ph.password = ef.name + \": \" + ef.value;\n          ph.lastUsedDate = new Date();\n          model.passwordHistory.splice(0, 0, ph);\n        }\n      });\n    }\n  }\n\n  private adjustPasswordHistoryLength(model: CipherView) {\n    if (model.passwordHistory != null && model.passwordHistory.length === 0) {\n      model.passwordHistory = null;\n    } else if (model.passwordHistory != null && model.passwordHistory.length > 5) {\n      // only save last 5 history\n      model.passwordHistory = model.passwordHistory.slice(0, 5);\n    }\n  }\n\n  private async shareAttachmentWithServer(\n    attachmentView: AttachmentView,\n    cipherId: string,\n    organizationId: string,\n  ): Promise<any> {\n    const attachmentResponse = await this.apiService.nativeFetch(\n      new Request(attachmentView.url, { cache: \"no-store\" }),\n    );\n    if (attachmentResponse.status !== 200) {\n      throw Error(\"Failed to download attachment: \" + attachmentResponse.status.toString());\n    }\n\n    const encBuf = await EncArrayBuffer.fromResponse(attachmentResponse);\n    const decBuf = await this.cryptoService.decryptFromBytes(encBuf, null);\n\n    let encKey: UserKey | OrgKey;\n    encKey = await this.cryptoService.getOrgKey(organizationId);\n    encKey ||= (await this.cryptoService.getUserKeyWithLegacySupport()) as UserKey;\n\n    const dataEncKey = await this.cryptoService.makeDataEncKey(encKey);\n\n    const encFileName = await this.encryptService.encrypt(attachmentView.fileName, encKey);\n    const encData = await this.encryptService.encryptToBytes(new Uint8Array(decBuf), dataEncKey[0]);\n\n    const fd = new FormData();\n    try {\n      const blob = new Blob([encData.buffer], { type: \"application/octet-stream\" });\n      fd.append(\"key\", dataEncKey[1].encryptedString);\n      fd.append(\"data\", blob, encFileName.encryptedString);\n    } catch (e) {\n      if (Utils.isNode && !Utils.isBrowser) {\n        fd.append(\"key\", dataEncKey[1].encryptedString);\n        fd.append(\n          \"data\",\n          Buffer.from(encData.buffer) as any,\n          {\n            filepath: encFileName.encryptedString,\n            contentType: \"application/octet-stream\",\n          } as any,\n        );\n      } else {\n        throw e;\n      }\n    }\n\n    try {\n      await this.apiService.postShareCipherAttachment(\n        cipherId,\n        attachmentView.id,\n        fd,\n        organizationId,\n      );\n    } catch (e) {\n      throw new Error((e as ErrorResponse).getSingleMessage());\n    }\n  }\n\n  private async encryptObjProperty<V extends View, D extends Domain>(\n    model: V,\n    obj: D,\n    map: any,\n    key: SymmetricCryptoKey,\n  ): Promise<void> {\n    const promises = [];\n    const self = this;\n\n    for (const prop in map) {\n      // eslint-disable-next-line\n      if (!map.hasOwnProperty(prop)) {\n        continue;\n      }\n\n      (function (theProp, theObj) {\n        const p = Promise.resolve()\n          .then(() => {\n            const modelProp = (model as any)[map[theProp] || theProp];\n            if (modelProp && modelProp !== \"\") {\n              return self.cryptoService.encrypt(modelProp, key);\n            }\n            return null;\n          })\n          .then((val: EncString) => {\n            (theObj as any)[theProp] = val;\n          });\n        promises.push(p);\n      })(prop, obj);\n    }\n\n    await Promise.all(promises);\n  }\n\n  private async encryptCipherData(cipher: Cipher, model: CipherView, key: SymmetricCryptoKey) {\n    switch (cipher.type) {\n      case CipherType.Login:\n        cipher.login = new Login();\n        cipher.login.passwordRevisionDate = model.login.passwordRevisionDate;\n        cipher.login.autofillOnPageLoad = model.login.autofillOnPageLoad;\n        await this.encryptObjProperty(\n          model.login,\n          cipher.login,\n          {\n            username: null,\n            password: null,\n            totp: null,\n          },\n          key,\n        );\n\n        if (model.login.uris != null) {\n          cipher.login.uris = [];\n          model.login.uris = model.login.uris.filter((u) => u.uri != null);\n          for (let i = 0; i < model.login.uris.length; i++) {\n            const loginUri = new LoginUri();\n            loginUri.match = model.login.uris[i].match;\n            await this.encryptObjProperty(\n              model.login.uris[i],\n              loginUri,\n              {\n                uri: null,\n              },\n              key,\n            );\n            const uriHash = await this.encryptService.hash(model.login.uris[i].uri, \"sha256\");\n            loginUri.uriChecksum = await this.cryptoService.encrypt(uriHash, key);\n            cipher.login.uris.push(loginUri);\n          }\n        }\n\n        if (model.login.fido2Credentials != null) {\n          cipher.login.fido2Credentials = await Promise.all(\n            model.login.fido2Credentials.map(async (viewKey) => {\n              const domainKey = new Fido2Credential();\n              await this.encryptObjProperty(\n                viewKey,\n                domainKey,\n                {\n                  credentialId: null,\n                  keyType: null,\n                  keyAlgorithm: null,\n                  keyCurve: null,\n                  keyValue: null,\n                  rpId: null,\n                  rpName: null,\n                  userHandle: null,\n                  userName: null,\n                  userDisplayName: null,\n                  origin: null,\n                },\n                key,\n              );\n              domainKey.counter = await this.cryptoService.encrypt(String(viewKey.counter), key);\n              domainKey.discoverable = await this.cryptoService.encrypt(\n                String(viewKey.discoverable),\n                key,\n              );\n              domainKey.creationDate = viewKey.creationDate;\n              return domainKey;\n            }),\n          );\n        }\n        return;\n      case CipherType.SecureNote:\n        cipher.secureNote = new SecureNote();\n        cipher.secureNote.type = model.secureNote.type;\n        return;\n      case CipherType.Card:\n        cipher.card = new Card();\n        await this.encryptObjProperty(\n          model.card,\n          cipher.card,\n          {\n            cardholderName: null,\n            brand: null,\n            number: null,\n            expMonth: null,\n            expYear: null,\n            code: null,\n          },\n          key,\n        );\n        return;\n      case CipherType.Identity:\n        cipher.identity = new Identity();\n        await this.encryptObjProperty(\n          model.identity,\n          cipher.identity,\n          {\n            title: null,\n            firstName: null,\n            middleName: null,\n            lastName: null,\n            address1: null,\n            address2: null,\n            address3: null,\n            city: null,\n            state: null,\n            postalCode: null,\n            country: null,\n            company: null,\n            email: null,\n            phone: null,\n            ssn: null,\n            username: null,\n            passportNumber: null,\n            licenseNumber: null,\n          },\n          key,\n        );\n        return;\n      default:\n        throw new Error(\"Unknown cipher type.\");\n    }\n  }\n\n  private async getAutofillOnPageLoadDefault() {\n    return await firstValueFrom(this.autofillSettingsService.autofillOnPageLoadDefault$);\n  }\n\n  private async getCipherForUrl(\n    url: string,\n    lastUsed: boolean,\n    lastLaunched: boolean,\n    autofillOnPageLoad: boolean,\n  ): Promise<CipherView> {\n    const cacheKey = autofillOnPageLoad ? \"autofillOnPageLoad-\" + url : url;\n\n    if (!this.sortedCiphersCache.isCached(cacheKey)) {\n      let ciphers = await this.getAllDecryptedForUrl(url);\n      if (!ciphers) {\n        return null;\n      }\n\n      if (autofillOnPageLoad) {\n        const autofillOnPageLoadDefault = await this.getAutofillOnPageLoadDefault();\n\n        ciphers = ciphers.filter(\n          (cipher) =>\n            cipher.login.autofillOnPageLoad ||\n            (cipher.login.autofillOnPageLoad == null && autofillOnPageLoadDefault !== false),\n        );\n        if (ciphers.length === 0) {\n          return null;\n        }\n      }\n\n      this.sortedCiphersCache.addCiphers(cacheKey, ciphers);\n    }\n\n    if (lastLaunched) {\n      return this.sortedCiphersCache.getLastLaunched(cacheKey);\n    } else if (lastUsed) {\n      return this.sortedCiphersCache.getLastUsed(cacheKey);\n    } else {\n      return this.sortedCiphersCache.getNext(cacheKey);\n    }\n  }\n\n  private async clearEncryptedCiphersState(userId?: string) {\n    await this.stateService.setEncryptedCiphers(null, { userId: userId });\n  }\n\n  private async clearDecryptedCiphersState(userId?: string) {\n    await this.stateService.setDecryptedCiphers(null, { userId: userId });\n    this.clearSortedCiphers();\n  }\n\n  private clearSortedCiphers() {\n    this.sortedCiphersCache.clear();\n  }\n\n  private async encryptCipher(\n    model: CipherView,\n    cipher: Cipher,\n    key: SymmetricCryptoKey,\n  ): Promise<Cipher> {\n    await Promise.all([\n      this.encryptObjProperty(\n        model,\n        cipher,\n        {\n          name: null,\n          notes: null,\n        },\n        key,\n      ),\n      this.encryptCipherData(cipher, model, key),\n      this.encryptFields(model.fields, key).then((fields) => {\n        cipher.fields = fields;\n      }),\n      this.encryptPasswordHistories(model.passwordHistory, key).then((ph) => {\n        cipher.passwordHistory = ph;\n      }),\n      this.encryptAttachments(model.attachments, key).then((attachments) => {\n        cipher.attachments = attachments;\n      }),\n    ]);\n\n    return cipher;\n  }\n\n  private async encryptCipherWithCipherKey(\n    model: CipherView,\n    cipher: Cipher,\n    keyForCipherKeyEncryption: SymmetricCryptoKey,\n    keyForCipherKeyDecryption: SymmetricCryptoKey,\n  ): Promise<Cipher> {\n    // First, we get the key for cipher key encryption, in its decrypted form\n    let decryptedCipherKey: SymmetricCryptoKey;\n    if (cipher.key == null) {\n      decryptedCipherKey = await this.cryptoService.makeCipherKey();\n    } else {\n      decryptedCipherKey = new SymmetricCryptoKey(\n        await this.encryptService.decryptToBytes(cipher.key, keyForCipherKeyDecryption),\n      );\n    }\n\n    // Then, we have to encrypt the cipher key with the proper key.\n    cipher.key = await this.encryptService.encrypt(\n      decryptedCipherKey.key,\n      keyForCipherKeyEncryption,\n    );\n\n    // Finally, we can encrypt the cipher with the decrypted cipher key.\n    return this.encryptCipher(model, cipher, decryptedCipherKey);\n  }\n\n  private async getCipherKeyEncryptionEnabled(): Promise<boolean> {\n    return (\n      flagEnabled(\"enableCipherKeyEncryption\") &&\n      (await firstValueFrom(\n        this.configService.checkServerMeetsVersionRequirement$(CIPHER_KEY_ENC_MIN_SERVER_VER),\n      ))\n    );\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { CollectionId, OrganizationId } from \"../../../types/guid\";\nimport { CollectionDetailsResponse } from \"../response/collection.response\";\n\nexport class CollectionData {\n  id: CollectionId;\n  organizationId: OrganizationId;\n  name: string;\n  externalId: string;\n  readOnly: boolean;\n  manage: boolean;\n  hidePasswords: boolean;\n\n  constructor(response: CollectionDetailsResponse) {\n    this.id = response.id;\n    this.organizationId = response.organizationId;\n    this.name = response.name;\n    this.externalId = response.externalId;\n    this.readOnly = response.readOnly;\n    this.manage = response.manage;\n    this.hidePasswords = response.hidePasswords;\n  }\n\n  static fromJSON(obj: Jsonify<CollectionData>) {\n    return Object.assign(new CollectionData(new CollectionDetailsResponse({})), obj);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Organization } from \"../../../admin-console/models/domain/organization\";\nimport { View } from \"../../../models/view/view\";\nimport { Collection } from \"../domain/collection\";\nimport { ITreeNodeObject } from \"../domain/tree-node\";\nimport { CollectionAccessDetailsResponse } from \"../response/collection.response\";\n\nexport const NestingDelimiter = \"/\";\n\nexport class CollectionView implements View, ITreeNodeObject {\n  id: string = null;\n  organizationId: string = null;\n  name: string = null;\n  externalId: string = null;\n  // readOnly applies to the items within a collection\n  readOnly: boolean = null;\n  hidePasswords: boolean = null;\n  manage: boolean = null;\n\n  constructor(c?: Collection | CollectionAccessDetailsResponse) {\n    if (!c) {\n      return;\n    }\n\n    this.id = c.id;\n    this.organizationId = c.organizationId;\n    this.externalId = c.externalId;\n    if (c instanceof Collection) {\n      this.readOnly = c.readOnly;\n      this.hidePasswords = c.hidePasswords;\n      this.manage = c.manage;\n    }\n  }\n\n  // For editing collection details, not the items within it.\n  canEdit(org: Organization): boolean {\n    if (org != null && org.id !== this.organizationId) {\n      throw new Error(\n        \"Id of the organization provided does not match the org id of the collection.\",\n      );\n    }\n\n    return org?.flexibleCollections\n      ? org?.canEditAnyCollection || this.manage\n      : org?.canEditAnyCollection || org?.canEditAssignedCollections;\n  }\n\n  // For deleting a collection, not the items within it.\n  canDelete(org: Organization): boolean {\n    if (org != null && org.id !== this.organizationId) {\n      throw new Error(\n        \"Id of the organization provided does not match the org id of the collection.\",\n      );\n    }\n\n    return org?.flexibleCollections\n      ? org?.canDeleteAnyCollection || (!org?.limitCollectionCreationDeletion && this.manage)\n      : org?.canDeleteAnyCollection || org?.canDeleteAssignedCollections;\n  }\n\n  static fromJSON(obj: Jsonify<CollectionView>) {\n    return Object.assign(new CollectionView(new Collection()), obj);\n  }\n}\n","import Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { CollectionData } from \"../data/collection.data\";\nimport { CollectionView } from \"../view/collection.view\";\n\nexport class Collection extends Domain {\n  id: string;\n  organizationId: string;\n  name: EncString;\n  externalId: string;\n  readOnly: boolean;\n  hidePasswords: boolean;\n  manage: boolean;\n\n  constructor(obj?: CollectionData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        organizationId: null,\n        name: null,\n        externalId: null,\n        readOnly: null,\n        hidePasswords: null,\n        manage: null,\n      },\n      [\"id\", \"organizationId\", \"externalId\", \"readOnly\", \"hidePasswords\", \"manage\"],\n    );\n  }\n\n  decrypt(): Promise<CollectionView> {\n    return this.decryptObj(\n      new CollectionView(this),\n      {\n        name: null,\n      },\n      this.organizationId,\n    );\n  }\n}\n","export class TreeNode<T extends ITreeNodeObject> {\n  node: T;\n  parent: TreeNode<T>;\n  children: TreeNode<T>[] = [];\n\n  constructor(node: T, parent: TreeNode<T>, name?: string, id?: string) {\n    this.parent = parent;\n    this.node = node;\n    if (name) {\n      this.node.name = name;\n    }\n    if (id) {\n      this.node.id = id;\n    }\n  }\n}\n\nexport interface ITreeNodeObject {\n  id: string;\n  name: string;\n}\n","import { ITreeNodeObject, TreeNode } from \"./models/domain/tree-node\";\n\nexport class ServiceUtils {\n  /**\n   * Recursively adds a node to nodeTree\n   * @param {TreeNode<ITreeNodeObject>[]} nodeTree - An array of TreeNodes that the node will be added to\n   * @param {number} partIndex - Index of the `parts` array that is being processed\n   * @param {string[]} parts - Array of strings that represent the path to the `obj` node\n   * @param {ITreeNodeObject} obj - The node to be added to the tree\n   * @param {ITreeNodeObject} parent - The parent node of the `obj` node\n   * @param {string} delimiter - The delimiter used to split the path string, will be used to combine the path for missing nodes\n   */\n  static nestedTraverse(\n    nodeTree: TreeNode<ITreeNodeObject>[],\n    partIndex: number,\n    parts: string[],\n    obj: ITreeNodeObject,\n    parent: TreeNode<ITreeNodeObject> | undefined,\n    delimiter: string,\n  ) {\n    if (parts.length <= partIndex) {\n      return;\n    }\n\n    const end: boolean = partIndex === parts.length - 1;\n    const partName: string = parts[partIndex];\n\n    for (let i = 0; i < nodeTree.length; i++) {\n      if (nodeTree[i].node.name !== partName) {\n        continue;\n      }\n      if (end && nodeTree[i].node.id !== obj.id) {\n        // Another node exists with the same name as the node being added\n        nodeTree.push(new TreeNode(obj, parent, partName));\n        return;\n      }\n      // Move down the tree to the next level\n      ServiceUtils.nestedTraverse(\n        nodeTree[i].children,\n        partIndex + 1,\n        parts,\n        obj,\n        nodeTree[i],\n        delimiter,\n      );\n      return;\n    }\n\n    // If there's no node here with the same name...\n    if (nodeTree.filter((n) => n.node.name === partName).length === 0) {\n      // And we're at the end of the path given, add the node\n      if (end) {\n        nodeTree.push(new TreeNode(obj, parent, partName));\n        return;\n      }\n      // And we're not at the end of the path, combine the current name with the next name\n      // 1, *1.2, 1.2.1 becomes\n      // 1, *1.2/1.2.1\n      const newPartName = partName + delimiter + parts[partIndex + 1];\n      ServiceUtils.nestedTraverse(\n        nodeTree,\n        0,\n        [newPartName, ...parts.slice(partIndex + 2)],\n        obj,\n        parent,\n        delimiter,\n      );\n    }\n  }\n\n  /**\n   * Searches a tree for a node with a matching `id`\n   * @param {TreeNode<T>} nodeTree - A single TreeNode branch that will be searched\n   * @param {string} id - The id of the node to be found\n   * @returns {TreeNode<T>} The node with a matching `id`\n   */\n  static getTreeNodeObject<T extends ITreeNodeObject>(\n    nodeTree: TreeNode<T>,\n    id: string,\n  ): TreeNode<T> {\n    if (nodeTree.node.id === id) {\n      return nodeTree;\n    }\n    for (let i = 0; i < nodeTree.children.length; i++) {\n      if (nodeTree.children[i].children != null) {\n        const node = ServiceUtils.getTreeNodeObject(nodeTree.children[i], id);\n        if (node !== null) {\n          return node;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Searches an array of tree nodes for a node with a matching `id`\n   * @param {TreeNode<T>} nodeTree - An array of TreeNode branches that will be searched\n   * @param {string} id - The id of the node to be found\n   * @returns {TreeNode<T>} The node with a matching `id`\n   */\n  static getTreeNodeObjectFromList<T extends ITreeNodeObject>(\n    nodeTree: TreeNode<T>[],\n    id: string,\n  ): TreeNode<T> {\n    for (let i = 0; i < nodeTree.length; i++) {\n      if (nodeTree[i].node.id === id) {\n        return nodeTree[i];\n      } else if (nodeTree[i].children != null) {\n        const node = ServiceUtils.getTreeNodeObjectFromList(nodeTree[i].children, id);\n        if (node !== null) {\n          return node;\n        }\n      }\n    }\n    return null;\n  }\n}\n","import { firstValueFrom, map, Observable } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { I18nService } from \"../../platform/abstractions/i18n.service\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport {\n  ActiveUserState,\n  KeyDefinition,\n  StateProvider,\n  COLLECTION_DATA,\n  DeriveDefinition,\n  DerivedState,\n} from \"../../platform/state\";\nimport { CollectionId, UserId } from \"../../types/guid\";\nimport { CollectionService as CollectionServiceAbstraction } from \"../../vault/abstractions/collection.service\";\nimport { CollectionData } from \"../models/data/collection.data\";\nimport { Collection } from \"../models/domain/collection\";\nimport { TreeNode } from \"../models/domain/tree-node\";\nimport { CollectionView } from \"../models/view/collection.view\";\nimport { ServiceUtils } from \"../service-utils\";\n\nconst ENCRYPTED_COLLECTION_DATA_KEY = KeyDefinition.record<CollectionData, CollectionId>(\n  COLLECTION_DATA,\n  \"collections\",\n  {\n    deserializer: (jsonData: Jsonify<CollectionData>) => CollectionData.fromJSON(jsonData),\n  },\n);\n\nconst DECRYPTED_COLLECTION_DATA_KEY = DeriveDefinition.from<\n  Record<CollectionId, CollectionData>,\n  CollectionView[],\n  { collectionService: CollectionService }\n>(ENCRYPTED_COLLECTION_DATA_KEY, {\n  deserializer: (obj) => obj.map((collection) => CollectionView.fromJSON(collection)),\n  derive: async (collections: Record<CollectionId, CollectionData>, { collectionService }) => {\n    const data: Collection[] = [];\n    for (const id in collections ?? {}) {\n      const collectionId = id as CollectionId;\n      data.push(new Collection(collections[collectionId]));\n    }\n    return await collectionService.decryptMany(data);\n  },\n});\n\nconst NestingDelimiter = \"/\";\n\nexport class CollectionService implements CollectionServiceAbstraction {\n  private encryptedCollectionDataState: ActiveUserState<Record<CollectionId, CollectionData>>;\n  encryptedCollections$: Observable<Collection[]>;\n  private decryptedCollectionDataState: DerivedState<CollectionView[]>;\n  decryptedCollections$: Observable<CollectionView[]>;\n\n  decryptedCollectionViews$(ids: CollectionId[]): Observable<CollectionView[]> {\n    return this.decryptedCollections$.pipe(\n      map((collections) => collections.filter((c) => ids.includes(c.id as CollectionId))),\n    );\n  }\n\n  constructor(\n    private cryptoService: CryptoService,\n    private i18nService: I18nService,\n    protected stateProvider: StateProvider,\n  ) {\n    this.encryptedCollectionDataState = this.stateProvider.getActive(ENCRYPTED_COLLECTION_DATA_KEY);\n    this.encryptedCollections$ = this.encryptedCollectionDataState.state$.pipe(\n      map((collections) => {\n        const response: Collection[] = [];\n        for (const id in collections ?? {}) {\n          response.push(new Collection(collections[id as CollectionId]));\n        }\n        return response;\n      }),\n    );\n\n    this.decryptedCollectionDataState = this.stateProvider.getDerived(\n      this.encryptedCollectionDataState.state$,\n      DECRYPTED_COLLECTION_DATA_KEY,\n      { collectionService: this },\n    );\n\n    this.decryptedCollections$ = this.decryptedCollectionDataState.state$;\n  }\n\n  async clearActiveUserCache(): Promise<void> {\n    await this.decryptedCollectionDataState.forceValue(null);\n  }\n\n  async encrypt(model: CollectionView): Promise<Collection> {\n    if (model.organizationId == null) {\n      throw new Error(\"Collection has no organization id.\");\n    }\n    const key = await this.cryptoService.getOrgKey(model.organizationId);\n    if (key == null) {\n      throw new Error(\"No key for this collection's organization.\");\n    }\n    const collection = new Collection();\n    collection.id = model.id;\n    collection.organizationId = model.organizationId;\n    collection.readOnly = model.readOnly;\n    collection.name = await this.cryptoService.encrypt(model.name, key);\n    return collection;\n  }\n\n  async decryptMany(collections: Collection[]): Promise<CollectionView[]> {\n    if (collections == null) {\n      return [];\n    }\n    const decCollections: CollectionView[] = [];\n    const promises: Promise<any>[] = [];\n    collections.forEach((collection) => {\n      promises.push(collection.decrypt().then((c) => decCollections.push(c)));\n    });\n    await Promise.all(promises);\n    return decCollections.sort(Utils.getSortFunction(this.i18nService, \"name\"));\n  }\n\n  async get(id: string): Promise<Collection> {\n    return (\n      (await firstValueFrom(\n        this.encryptedCollections$.pipe(map((cs) => cs.find((c) => c.id === id))),\n      )) ?? null\n    );\n  }\n\n  async getAll(): Promise<Collection[]> {\n    return await firstValueFrom(this.encryptedCollections$);\n  }\n\n  async getAllDecrypted(): Promise<CollectionView[]> {\n    return await firstValueFrom(this.decryptedCollections$);\n  }\n\n  async getAllNested(collections: CollectionView[] = null): Promise<TreeNode<CollectionView>[]> {\n    if (collections == null) {\n      collections = await this.getAllDecrypted();\n    }\n    const nodes: TreeNode<CollectionView>[] = [];\n    collections.forEach((c) => {\n      const collectionCopy = new CollectionView();\n      collectionCopy.id = c.id;\n      collectionCopy.organizationId = c.organizationId;\n      const parts = c.name != null ? c.name.replace(/^\\/+|\\/+$/g, \"\").split(NestingDelimiter) : [];\n      ServiceUtils.nestedTraverse(nodes, 0, parts, collectionCopy, null, NestingDelimiter);\n    });\n    return nodes;\n  }\n\n  /**\n   * @deprecated August 30 2022: Moved to new Vault Filter Service\n   * Remove when Desktop and Browser are updated\n   */\n  async getNested(id: string): Promise<TreeNode<CollectionView>> {\n    const collections = await this.getAllNested();\n    return ServiceUtils.getTreeNodeObjectFromList(collections, id) as TreeNode<CollectionView>;\n  }\n\n  async upsert(toUpdate: CollectionData | CollectionData[]): Promise<void> {\n    if (toUpdate == null) {\n      return;\n    }\n    await this.encryptedCollectionDataState.update((collections) => {\n      if (collections == null) {\n        collections = {};\n      }\n      if (Array.isArray(toUpdate)) {\n        toUpdate.forEach((c) => {\n          collections[c.id] = c;\n        });\n      } else {\n        collections[toUpdate.id] = toUpdate;\n      }\n      return collections;\n    });\n  }\n\n  async replace(collections: Record<CollectionId, CollectionData>): Promise<void> {\n    await this.encryptedCollectionDataState.update(() => collections);\n  }\n\n  async clear(userId?: UserId): Promise<any> {\n    if (userId == null) {\n      await this.encryptedCollectionDataState.update(() => null);\n      await this.decryptedCollectionDataState.forceValue(null);\n    } else {\n      await this.stateProvider.getUser(userId, ENCRYPTED_COLLECTION_DATA_KEY).update(() => null);\n    }\n  }\n\n  async delete(id: CollectionId | CollectionId[]): Promise<any> {\n    await this.encryptedCollectionDataState.update((collections) => {\n      if (collections == null) {\n        collections = {};\n      }\n      if (typeof id === \"string\") {\n        delete collections[id];\n      } else {\n        (id as CollectionId[]).forEach((i) => {\n          delete collections[i];\n        });\n      }\n      return collections;\n    });\n  }\n}\n","/**\n * This class represents an abstraction of the WebAuthn Authenticator model as described by W3C:\n * https://www.w3.org/TR/webauthn-3/#sctn-authenticator-model\n *\n * The authenticator provides key management and cryptographic signatures.\n */\nexport abstract class Fido2AuthenticatorService {\n  /**\n   * Create and save a new credential as described in:\n   * https://www.w3.org/TR/webauthn-3/#sctn-op-make-cred\n   *\n   * @param params Parameters for creating a new credential\n   * @param abortController An AbortController that can be used to abort the operation.\n   * @returns A promise that resolves with the new credential and an attestation signature.\n   **/\n  makeCredential: (\n    params: Fido2AuthenticatorMakeCredentialsParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ) => Promise<Fido2AuthenticatorMakeCredentialResult>;\n\n  /**\n   * Generate an assertion using an existing credential as describe in:\n   * https://www.w3.org/TR/webauthn-3/#sctn-op-get-assertion\n   *\n   * @param params Parameters for generating an assertion\n   * @param abortController An AbortController that can be used to abort the operation.\n   * @returns A promise that resolves with the asserted credential and an assertion signature.\n   */\n  getAssertion: (\n    params: Fido2AuthenticatorGetAssertionParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ) => Promise<Fido2AuthenticatorGetAssertionResult>;\n}\n\nexport enum Fido2AlgorithmIdentifier {\n  ES256 = -7,\n  RS256 = -257,\n}\n\nexport enum Fido2AuthenticatorErrorCode {\n  Unknown = \"UnknownError\",\n  NotSupported = \"NotSupportedError\",\n  InvalidState = \"InvalidStateError\",\n  NotAllowed = \"NotAllowedError\",\n  Constraint = \"ConstraintError\",\n}\n\nexport class Fido2AuthenticatorError extends Error {\n  constructor(readonly errorCode: Fido2AuthenticatorErrorCode) {\n    super(errorCode);\n  }\n}\n\nexport interface PublicKeyCredentialDescriptor {\n  id: BufferSource;\n  transports?: (\"ble\" | \"hybrid\" | \"internal\" | \"nfc\" | \"usb\")[];\n  type: \"public-key\";\n}\n\n/**\n * Parameters for {@link Fido2AuthenticatorService.makeCredential}\n *\n * This interface represents the input parameters described in\n * https://www.w3.org/TR/webauthn-3/#sctn-op-make-cred\n */\nexport interface Fido2AuthenticatorMakeCredentialsParams {\n  /** The hash of the serialized client data, provided by the client. */\n  hash: BufferSource;\n  /** The Relying Party's PublicKeyCredentialRpEntity. */\n  rpEntity: {\n    name: string;\n    id?: string;\n  };\n  /** The user account’s PublicKeyCredentialUserEntity, containing the user handle given by the Relying Party. */\n  userEntity: {\n    id: BufferSource;\n    name?: string;\n    displayName?: string;\n    icon?: string;\n  };\n  /** A sequence of pairs of PublicKeyCredentialType and public key algorithms (COSEAlgorithmIdentifier) requested by the Relying Party. This sequence is ordered from most preferred to least preferred. The authenticator makes a best-effort to create the most preferred credential that it can. */\n  credTypesAndPubKeyAlgs: {\n    alg: number;\n    type: \"public-key\"; // not used\n  }[];\n  /** An OPTIONAL list of PublicKeyCredentialDescriptor objects provided by the Relying Party with the intention that, if any of these are known to the authenticator, it SHOULD NOT create a new credential. excludeCredentialDescriptorList contains a list of known credentials. */\n  excludeCredentialDescriptorList?: PublicKeyCredentialDescriptor[];\n  /** A map from extension identifiers to their authenticator extension inputs, created by the client based on the extensions requested by the Relying Party, if any. */\n  extensions?: {\n    appid?: string;\n    appidExclude?: string;\n    credProps?: boolean;\n    uvm?: boolean;\n  };\n  /** A Boolean value that indicates that individually-identifying attestation MAY be returned by the authenticator. */\n  enterpriseAttestationPossible?: boolean; // Ignored by bitwarden at the moment\n  /** The effective resident key requirement for credential creation, a Boolean value determined by the client. Resident is synonymous with discoverable. */\n  requireResidentKey: boolean;\n  requireUserVerification: boolean;\n  /** Forwarded to user interface */\n  fallbackSupported: boolean;\n  /** The constant Boolean value true. It is included here as a pseudo-parameter to simplify applying this abstract authenticator model to implementations that may wish to make a test of user presence optional although WebAuthn does not. */\n  // requireUserPresence: true; // Always required\n}\n\nexport interface Fido2AuthenticatorMakeCredentialResult {\n  credentialId: BufferSource;\n  attestationObject: BufferSource;\n  authData: BufferSource;\n  publicKey: BufferSource;\n  publicKeyAlgorithm: number;\n}\n\n/**\n * Parameters for {@link Fido2AuthenticatorService.getAssertion}\n\n * This interface represents the input parameters described in\n * https://www.w3.org/TR/webauthn-3/#sctn-op-get-assertion\n */\nexport interface Fido2AuthenticatorGetAssertionParams {\n  /** The caller’s RP ID, as determined by the user agent and the client. */\n  rpId: string;\n  /** The hash of the serialized client data, provided by the client. */\n  hash: BufferSource;\n  allowCredentialDescriptorList: PublicKeyCredentialDescriptor[];\n  /** The effective user verification requirement for assertion, a Boolean value provided by the client. */\n  requireUserVerification: boolean;\n  /** The constant Boolean value true. It is included here as a pseudo-parameter to simplify applying this abstract authenticator model to implementations that may wish to make a test of user presence optional although WebAuthn does not. */\n  // requireUserPresence: boolean; // Always required\n  extensions: unknown;\n  /** Forwarded to user interface */\n  fallbackSupported: boolean;\n}\n\nexport interface Fido2AuthenticatorGetAssertionResult {\n  selectedCredential: {\n    id: Uint8Array;\n    userHandle?: Uint8Array;\n  };\n  authenticatorData: Uint8Array;\n  signature: Uint8Array;\n}\n","/**\nThe MIT License (MIT)\n\nCopyright (c) 2014-2016 Patrick Gansterer <paroga@paroga.com>\nCopyright (c) 2020-present Aaron Huggins <ahuggins@aaronhuggins.com>\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\nExported from GitHub release version 0.4.0\n*/\n\n/* eslint-disable */\n/** @hidden */\nconst POW_2_24 = 5.960464477539063e-8;\n/** @hidden */\nconst POW_2_32 = 4294967296;\n/** @hidden */\nconst POW_2_53 = 9007199254740992;\n/** @hidden */\nconst DECODE_CHUNK_SIZE = 8192;\n\n/** @hidden */\nfunction objectIs(x: any, y: any) {\n  if (typeof Object.is === \"function\") return Object.is(x, y);\n\n  // SameValue algorithm\n  // Steps 1-5, 7-10\n  if (x === y) {\n    // Steps 6.b-6.e: +0 != -0\n    return x !== 0 || 1 / x === 1 / y;\n  }\n\n  // Step 6.a: NaN == NaN\n  return x !== x && y !== y;\n}\n\n/** A function that extracts tagged values. */\ntype TaggedValueFunction = (value: any, tag: number) => TaggedValue;\n/** A function that extracts simple values. */\ntype SimpleValueFunction = (value: any) => SimpleValue;\n\n/** Convenience class for structuring a tagged value. */\nexport class TaggedValue {\n  constructor(value: any, tag: number) {\n    this.value = value;\n    this.tag = tag;\n  }\n\n  value: any;\n  tag: number;\n}\n\n/** Convenience class for structuring a simple value. */\nexport class SimpleValue {\n  constructor(value: any) {\n    this.value = value;\n  }\n\n  value: any;\n}\n\n/**\n * Converts a Concise Binary Object Representation (CBOR) buffer into an object.\n * @param {ArrayBuffer|SharedArrayBuffer} data - A valid CBOR buffer.\n * @param {Function} [tagger] - A function that extracts tagged values. This function is called for each member of the object.\n * @param {Function} [simpleValue] - A function that extracts simple values. This function is called for each member of the object.\n * @returns {any} The CBOR buffer converted to a JavaScript value.\n */\nexport function decode<T = any>(\n  data: ArrayBuffer | SharedArrayBuffer,\n  tagger?: TaggedValueFunction,\n  simpleValue?: SimpleValueFunction,\n): T {\n  let dataView = new DataView(data);\n  let ta = new Uint8Array(data);\n  let offset = 0;\n  let tagValueFunction: TaggedValueFunction = function (value: number, tag: number): any {\n    return new TaggedValue(value, tag);\n  };\n  let simpleValFunction: SimpleValueFunction = function (value: number): SimpleValue {\n    return undefined as unknown as SimpleValue;\n  };\n\n  if (typeof tagger === \"function\") tagValueFunction = tagger;\n  if (typeof simpleValue === \"function\") simpleValFunction = simpleValue;\n\n  function commitRead<T>(length: number, value: T): T {\n    offset += length;\n    return value;\n  }\n  function readArrayBuffer(length: number) {\n    return commitRead(length, new Uint8Array(data, offset, length));\n  }\n  function readFloat16() {\n    let tempArrayBuffer = new ArrayBuffer(4);\n    let tempDataView = new DataView(tempArrayBuffer);\n    let value = readUint16();\n\n    let sign = value & 0x8000;\n    let exponent = value & 0x7c00;\n    let fraction = value & 0x03ff;\n\n    if (exponent === 0x7c00) exponent = 0xff << 10;\n    else if (exponent !== 0) exponent += (127 - 15) << 10;\n    else if (fraction !== 0) return (sign ? -1 : 1) * fraction * POW_2_24;\n\n    tempDataView.setUint32(0, (sign << 16) | (exponent << 13) | (fraction << 13));\n    return tempDataView.getFloat32(0);\n  }\n  function readFloat32(): number {\n    return commitRead(4, dataView.getFloat32(offset));\n  }\n  function readFloat64(): number {\n    return commitRead(8, dataView.getFloat64(offset));\n  }\n  function readUint8(): number {\n    return commitRead(1, ta[offset]);\n  }\n  function readUint16(): number {\n    return commitRead(2, dataView.getUint16(offset));\n  }\n  function readUint32(): number {\n    return commitRead(4, dataView.getUint32(offset));\n  }\n  function readUint64(): number {\n    return readUint32() * POW_2_32 + readUint32();\n  }\n  function readBreak(): boolean {\n    if (ta[offset] !== 0xff) return false;\n    offset += 1;\n    return true;\n  }\n  function readLength(additionalInformation: number): number {\n    if (additionalInformation < 24) return additionalInformation;\n    if (additionalInformation === 24) return readUint8();\n    if (additionalInformation === 25) return readUint16();\n    if (additionalInformation === 26) return readUint32();\n    if (additionalInformation === 27) return readUint64();\n    if (additionalInformation === 31) return -1;\n    throw new Error(\"Invalid length encoding\");\n  }\n  function readIndefiniteStringLength(majorType: number): number {\n    let initialByte = readUint8();\n    if (initialByte === 0xff) return -1;\n    let length = readLength(initialByte & 0x1f);\n    if (length < 0 || initialByte >> 5 !== majorType)\n      throw new Error(\"Invalid indefinite length element\");\n    return length;\n  }\n\n  function appendUtf16Data(utf16data: number[], length: number) {\n    for (let i = 0; i < length; ++i) {\n      let value = readUint8();\n      if (value & 0x80) {\n        if (value < 0xe0) {\n          value = ((value & 0x1f) << 6) | (readUint8() & 0x3f);\n          length -= 1;\n        } else if (value < 0xf0) {\n          value = ((value & 0x0f) << 12) | ((readUint8() & 0x3f) << 6) | (readUint8() & 0x3f);\n          length -= 2;\n        } else {\n          value =\n            ((value & 0x0f) << 18) |\n            ((readUint8() & 0x3f) << 12) |\n            ((readUint8() & 0x3f) << 6) |\n            (readUint8() & 0x3f);\n          length -= 3;\n        }\n      }\n\n      if (value < 0x10000) {\n        utf16data.push(value);\n      } else {\n        value -= 0x10000;\n        utf16data.push(0xd800 | (value >> 10));\n        utf16data.push(0xdc00 | (value & 0x3ff));\n      }\n    }\n  }\n\n  function decodeItem(): any {\n    let initialByte = readUint8();\n    let majorType = initialByte >> 5;\n    let additionalInformation = initialByte & 0x1f;\n    let i;\n    let length;\n\n    if (majorType === 7) {\n      switch (additionalInformation) {\n        case 25:\n          return readFloat16();\n        case 26:\n          return readFloat32();\n        case 27:\n          return readFloat64();\n      }\n    }\n\n    length = readLength(additionalInformation);\n    if (length < 0 && (majorType < 2 || 6 < majorType)) throw new Error(\"Invalid length\");\n\n    switch (majorType) {\n      case 0:\n        return length;\n      case 1:\n        return -1 - length;\n      case 2:\n        if (length < 0) {\n          let elements = [];\n          let fullArrayLength = 0;\n          while ((length = readIndefiniteStringLength(majorType)) >= 0) {\n            fullArrayLength += length;\n            elements.push(readArrayBuffer(length));\n          }\n          let fullArray = new Uint8Array(fullArrayLength);\n          let fullArrayOffset = 0;\n          for (i = 0; i < elements.length; ++i) {\n            fullArray.set(elements[i], fullArrayOffset);\n            fullArrayOffset += elements[i].length;\n          }\n          return fullArray;\n        }\n        return readArrayBuffer(length);\n      case 3:\n        let utf16data: number[] = [];\n        if (length < 0) {\n          while ((length = readIndefiniteStringLength(majorType)) >= 0)\n            appendUtf16Data(utf16data, length);\n        } else {\n          appendUtf16Data(utf16data, length);\n        }\n        let string = \"\";\n        for (i = 0; i < utf16data.length; i += DECODE_CHUNK_SIZE) {\n          string += String.fromCharCode.apply(null, utf16data.slice(i, i + DECODE_CHUNK_SIZE));\n        }\n        return string;\n      case 4:\n        let retArray;\n        if (length < 0) {\n          retArray = [];\n          while (!readBreak()) retArray.push(decodeItem());\n        } else {\n          retArray = new Array(length);\n          for (i = 0; i < length; ++i) retArray[i] = decodeItem();\n        }\n        return retArray;\n      case 5:\n        let retObject: any = {};\n        for (i = 0; i < length || (length < 0 && !readBreak()); ++i) {\n          let key = decodeItem();\n          retObject[key] = decodeItem();\n        }\n        return retObject;\n      case 6:\n        return tagValueFunction(decodeItem(), length);\n      case 7:\n        switch (length) {\n          case 20:\n            return false;\n          case 21:\n            return true;\n          case 22:\n            return null;\n          case 23:\n            return undefined;\n          default:\n            return simpleValFunction(length);\n        }\n    }\n  }\n\n  let ret = decodeItem();\n  if (offset !== data.byteLength) throw new Error(\"Remaining bytes\");\n  return ret;\n}\n\n/**\n * Converts a JavaScript value to a Concise Binary Object Representation (CBOR) buffer.\n * @param {any} value - A JavaScript value, usually an object or array, to be converted.\n * @returns {ArrayBuffer} The JavaScript value converted to CBOR format.\n */\nexport function encode<T = any>(value: T): ArrayBuffer {\n  let data = new ArrayBuffer(256);\n  let dataView = new DataView(data);\n  let byteView = new Uint8Array(data);\n  let lastLength: number;\n  let offset = 0;\n\n  function prepareWrite(length: number): DataView {\n    let newByteLength = data.byteLength;\n    let requiredLength = offset + length;\n    while (newByteLength < requiredLength) newByteLength <<= 1;\n    if (newByteLength !== data.byteLength) {\n      let oldDataView = dataView;\n      data = new ArrayBuffer(newByteLength);\n      dataView = new DataView(data);\n      byteView = new Uint8Array(data);\n      let uint32count = (offset + 3) >> 2;\n      for (let i = 0; i < uint32count; ++i)\n        dataView.setUint32(i << 2, oldDataView.getUint32(i << 2));\n    }\n\n    lastLength = length;\n    return dataView;\n  }\n  function commitWrite(...args: any[]) {\n    offset += lastLength;\n  }\n  function writeFloat64(val: number) {\n    commitWrite(prepareWrite(8).setFloat64(offset, val));\n  }\n  function writeUint8(val: number) {\n    commitWrite(prepareWrite(1).setUint8(offset, val));\n  }\n  function writeUint8Array(val: number[] | Uint8Array) {\n    prepareWrite(val.length);\n    byteView.set(val, offset);\n    commitWrite();\n  }\n  function writeUint16(val: number) {\n    commitWrite(prepareWrite(2).setUint16(offset, val));\n  }\n  function writeUint32(val: number) {\n    commitWrite(prepareWrite(4).setUint32(offset, val));\n  }\n  function writeUint64(val: number) {\n    let low = val % POW_2_32;\n    let high = (val - low) / POW_2_32;\n    let view = prepareWrite(8);\n    view.setUint32(offset, high);\n    view.setUint32(offset + 4, low);\n    commitWrite();\n  }\n  function writeVarUint(val: number, mod: number = 0) {\n    if (val <= 0xff) {\n      if (val < 24) {\n        writeUint8(val | mod);\n      } else {\n        writeUint8(0x18 | mod);\n        writeUint8(val);\n      }\n    } else if (val <= 0xffff) {\n      writeUint8(0x19 | mod);\n      writeUint16(val);\n    } else if (val <= 0xffffffff) {\n      writeUint8(0x1a | mod);\n      writeUint32(val);\n    } else {\n      writeUint8(0x1b | mod);\n      writeUint64(val);\n    }\n  }\n  function writeTypeAndLength(type: number, length: number) {\n    if (length < 24) {\n      writeUint8((type << 5) | length);\n    } else if (length < 0x100) {\n      writeUint8((type << 5) | 24);\n      writeUint8(length);\n    } else if (length < 0x10000) {\n      writeUint8((type << 5) | 25);\n      writeUint16(length);\n    } else if (length < 0x100000000) {\n      writeUint8((type << 5) | 26);\n      writeUint32(length);\n    } else {\n      writeUint8((type << 5) | 27);\n      writeUint64(length);\n    }\n  }\n\n  function encodeItem(val: any) {\n    let i;\n\n    if (val === false) return writeUint8(0xf4);\n    if (val === true) return writeUint8(0xf5);\n    if (val === null) return writeUint8(0xf6);\n    if (val === undefined) return writeUint8(0xf7);\n    if (objectIs(val, -0)) return writeUint8Array([0xf9, 0x80, 0x00]);\n\n    switch (typeof val) {\n      case \"number\":\n        if (Math.floor(val) === val) {\n          if (0 <= val && val <= POW_2_53) return writeTypeAndLength(0, val);\n          if (-POW_2_53 <= val && val < 0) return writeTypeAndLength(1, -(val + 1));\n        }\n        writeUint8(0xfb);\n        return writeFloat64(val);\n\n      case \"string\":\n        let utf8data = [];\n        for (i = 0; i < val.length; ++i) {\n          let charCode = val.charCodeAt(i);\n          if (charCode < 0x80) {\n            utf8data.push(charCode);\n          } else if (charCode < 0x800) {\n            utf8data.push(0xc0 | (charCode >> 6));\n            utf8data.push(0x80 | (charCode & 0x3f));\n          } else if (charCode < 0xd800 || charCode >= 0xe000) {\n            utf8data.push(0xe0 | (charCode >> 12));\n            utf8data.push(0x80 | ((charCode >> 6) & 0x3f));\n            utf8data.push(0x80 | (charCode & 0x3f));\n          } else {\n            charCode = (charCode & 0x3ff) << 10;\n            charCode |= val.charCodeAt(++i) & 0x3ff;\n            charCode += 0x10000;\n\n            utf8data.push(0xf0 | (charCode >> 18));\n            utf8data.push(0x80 | ((charCode >> 12) & 0x3f));\n            utf8data.push(0x80 | ((charCode >> 6) & 0x3f));\n            utf8data.push(0x80 | (charCode & 0x3f));\n          }\n        }\n\n        writeTypeAndLength(3, utf8data.length);\n        return writeUint8Array(utf8data);\n\n      default:\n        let length;\n        let converted;\n        if (Array.isArray(val)) {\n          length = val.length;\n          writeTypeAndLength(4, length);\n          for (i = 0; i < length; i += 1) encodeItem(val[i]);\n        } else if (val instanceof Uint8Array) {\n          writeTypeAndLength(2, val.length);\n          writeUint8Array(val);\n        } else if (ArrayBuffer.isView(val)) {\n          converted = new Uint8Array(val.buffer);\n          writeTypeAndLength(2, converted.length);\n          writeUint8Array(converted);\n        } else if (\n          val instanceof ArrayBuffer ||\n          (typeof SharedArrayBuffer === \"function\" && val instanceof SharedArrayBuffer)\n        ) {\n          converted = new Uint8Array(val);\n          writeTypeAndLength(2, converted.length);\n          writeUint8Array(converted);\n        } else if (val instanceof TaggedValue) {\n          writeVarUint(val.tag, 0b11000000);\n          encodeItem(val.value);\n        } else {\n          let keys = Object.keys(val);\n          length = keys.length;\n          writeTypeAndLength(5, length);\n          for (i = 0; i < length; i += 1) {\n            let key = keys[i];\n            encodeItem(key);\n            encodeItem(val[key]);\n          }\n        }\n    }\n  }\n\n  encodeItem(value);\n\n  if (\"slice\" in data) return data.slice(0, offset);\n\n  let ret = new ArrayBuffer(offset);\n  let retView = new DataView(ret);\n  for (let i = 0; i < offset; ++i) retView.setUint8(i, dataView.getUint8(i));\n  return ret;\n}\n\n/**\n * An intrinsic object that provides functions to convert JavaScript values\n * to and from the Concise Binary Object Representation (CBOR) format.\n */\nexport const CBOR: {\n  decode: <T = any>(\n    data: ArrayBuffer | SharedArrayBuffer,\n    tagger?: TaggedValueFunction,\n    simpleValue?: SimpleValueFunction,\n  ) => T;\n  encode: <T = any>(value: T) => ArrayBuffer;\n} = {\n  decode,\n  encode,\n};\n","/*\n   Copyright 2015 D2L Corporation\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License. */\n\n// Changes:\n// - Cherry-pick the methods that we have a need for.\n// - Add typings.\n// - Original code is made for running in node, this version is adapted to work in the browser.\n\n// https://github.com/Brightspace/node-ecdsa-sig-formatter/blob/master/src/param-bytes-for-alg.js\n\nfunction getParamSize(keySize: number) {\n  const result = ((keySize / 8) | 0) + (keySize % 8 === 0 ? 0 : 1);\n  return result;\n}\n\nconst paramBytesForAlg = {\n  ES256: getParamSize(256),\n  ES384: getParamSize(384),\n  ES512: getParamSize(521),\n};\n\ntype Alg = keyof typeof paramBytesForAlg;\n\nfunction getParamBytesForAlg(alg: Alg) {\n  const paramBytes = paramBytesForAlg[alg];\n  if (paramBytes) {\n    return paramBytes;\n  }\n\n  throw new Error('Unknown algorithm \"' + alg + '\"');\n}\n\n// https://github.com/Brightspace/node-ecdsa-sig-formatter/blob/master/src/ecdsa-sig-formatter.js\n\nconst MAX_OCTET = 0x80,\n  CLASS_UNIVERSAL = 0,\n  PRIMITIVE_BIT = 0x20,\n  TAG_SEQ = 0x10,\n  TAG_INT = 0x02,\n  ENCODED_TAG_SEQ = TAG_SEQ | PRIMITIVE_BIT | (CLASS_UNIVERSAL << 6),\n  ENCODED_TAG_INT = TAG_INT | (CLASS_UNIVERSAL << 6);\n\n// Counts leading zeros and determines if there's a need for 0x00 padding\nfunction countPadding(\n  buf: Uint8Array,\n  start: number,\n  end: number,\n): { padding: number; needs0x00: boolean } {\n  let padding = 0;\n  while (start + padding < end && buf[start + padding] === 0) {\n    padding++;\n  }\n\n  const needs0x00 = (buf[start + padding] & MAX_OCTET) === MAX_OCTET;\n  return { padding, needs0x00 };\n}\n\nexport function p1363ToDer(signature: Uint8Array) {\n  const alg = \"ES256\";\n  const paramBytes = getParamBytesForAlg(alg);\n\n  const signatureBytes = signature.length;\n  if (signatureBytes !== paramBytes * 2) {\n    throw new TypeError(\n      '\"' +\n        alg +\n        '\" signatures must be \"' +\n        paramBytes * 2 +\n        '\" bytes, saw \"' +\n        signatureBytes +\n        '\"',\n    );\n  }\n\n  const { padding: rPadding, needs0x00: rNeeds0x00 } = countPadding(signature, 0, paramBytes);\n  const { padding: sPadding, needs0x00: sNeeds0x00 } = countPadding(\n    signature,\n    paramBytes,\n    signature.length,\n  );\n\n  const rActualLength = paramBytes - rPadding;\n  const sActualLength = paramBytes - sPadding;\n\n  const rLength = rActualLength + (rNeeds0x00 ? 1 : 0);\n  const sLength = sActualLength + (sNeeds0x00 ? 1 : 0);\n\n  const rsBytes = 2 + rLength + 2 + sLength;\n\n  const shortLength = rsBytes < MAX_OCTET;\n\n  const dst = new Uint8Array((shortLength ? 2 : 3) + rsBytes);\n\n  let offset = 0;\n  dst[offset++] = ENCODED_TAG_SEQ;\n  if (shortLength) {\n    dst[offset++] = rsBytes;\n  } else {\n    dst[offset++] = MAX_OCTET | 1;\n    dst[offset++] = rsBytes & 0xff;\n  }\n\n  // Encoding 'R' component\n  dst[offset++] = ENCODED_TAG_INT;\n  dst[offset++] = rLength;\n  if (rNeeds0x00) {\n    dst[offset++] = 0;\n  }\n  dst.set(signature.subarray(rPadding, rPadding + rActualLength), offset);\n  offset += rActualLength;\n\n  // Encoding 'S' component\n  dst[offset++] = ENCODED_TAG_INT;\n  dst[offset++] = sLength;\n  if (sNeeds0x00) {\n    dst[offset++] = 0;\n  }\n  dst.set(signature.subarray(paramBytes + sPadding, paramBytes + sPadding + sActualLength), offset);\n\n  return dst;\n}\n","import { Utils } from \"../../../platform/misc/utils\";\n\nexport class Fido2Utils {\n  static bufferToString(bufferSource: BufferSource): string {\n    const buffer = Fido2Utils.bufferSourceToUint8Array(bufferSource);\n\n    return Utils.fromBufferToUrlB64(buffer);\n  }\n\n  static stringToBuffer(str: string): Uint8Array {\n    return Utils.fromUrlB64ToArray(str);\n  }\n\n  static bufferSourceToUint8Array(bufferSource: BufferSource) {\n    if (Fido2Utils.isArrayBuffer(bufferSource)) {\n      return new Uint8Array(bufferSource);\n    } else {\n      return new Uint8Array(bufferSource.buffer);\n    }\n  }\n\n  /** Utility function to identify type of bufferSource. Necessary because of differences between runtimes */\n  private static isArrayBuffer(bufferSource: BufferSource): bufferSource is ArrayBuffer {\n    return bufferSource instanceof ArrayBuffer || bufferSource.buffer === undefined;\n  }\n}\n","/*\n  License for: guidToRawFormat, guidToStandardFormat\n  Source: https://github.com/uuidjs/uuid/\n  The MIT License (MIT)\n  Copyright (c) 2010-2020 Robert Kieffer and other contributors\n  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n  The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.*/\n\n/** Private array used for optimization */\nconst byteToHex = Array.from({ length: 256 }, (_, i) => (i + 0x100).toString(16).substring(1));\n\n/** Convert standard format (XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX) UUID to raw 16 byte array. */\nexport function guidToRawFormat(guid: string) {\n  if (!isValidGuid(guid)) {\n    throw TypeError(\"GUID parameter is invalid\");\n  }\n\n  let v;\n  const arr = new Uint8Array(16);\n\n  // Parse ########-....-....-....-............\n  arr[0] = (v = parseInt(guid.slice(0, 8), 16)) >>> 24;\n  arr[1] = (v >>> 16) & 0xff;\n  arr[2] = (v >>> 8) & 0xff;\n  arr[3] = v & 0xff;\n\n  // Parse ........-####-....-....-............\n  arr[4] = (v = parseInt(guid.slice(9, 13), 16)) >>> 8;\n  arr[5] = v & 0xff;\n\n  // Parse ........-....-####-....-............\n  arr[6] = (v = parseInt(guid.slice(14, 18), 16)) >>> 8;\n  arr[7] = v & 0xff;\n\n  // Parse ........-....-....-####-............\n  arr[8] = (v = parseInt(guid.slice(19, 23), 16)) >>> 8;\n  arr[9] = v & 0xff;\n\n  // Parse ........-....-....-....-############\n  // (Use \"/\" to avoid 32-bit truncation when bit-shifting high-order bytes)\n  arr[10] = ((v = parseInt(guid.slice(24, 36), 16)) / 0x10000000000) & 0xff;\n  arr[11] = (v / 0x100000000) & 0xff;\n  arr[12] = (v >>> 24) & 0xff;\n  arr[13] = (v >>> 16) & 0xff;\n  arr[14] = (v >>> 8) & 0xff;\n  arr[15] = v & 0xff;\n\n  return arr;\n}\n\n/** Convert raw 16 byte array to standard format (XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX) UUID. */\nexport function guidToStandardFormat(bufferSource: BufferSource) {\n  const arr =\n    bufferSource instanceof ArrayBuffer\n      ? new Uint8Array(bufferSource)\n      : new Uint8Array(bufferSource.buffer);\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  const guid = (\n    byteToHex[arr[0]] +\n    byteToHex[arr[1]] +\n    byteToHex[arr[2]] +\n    byteToHex[arr[3]] +\n    \"-\" +\n    byteToHex[arr[4]] +\n    byteToHex[arr[5]] +\n    \"-\" +\n    byteToHex[arr[6]] +\n    byteToHex[arr[7]] +\n    \"-\" +\n    byteToHex[arr[8]] +\n    byteToHex[arr[9]] +\n    \"-\" +\n    byteToHex[arr[10]] +\n    byteToHex[arr[11]] +\n    byteToHex[arr[12]] +\n    byteToHex[arr[13]] +\n    byteToHex[arr[14]] +\n    byteToHex[arr[15]]\n  ).toLowerCase();\n\n  // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // or more input array values not mapping to a hex octet (leading to \"undefined\" in the uuid)\n  if (!isValidGuid(guid)) {\n    throw TypeError(\"Converted GUID is invalid\");\n  }\n\n  return guid;\n}\n\n// Perform format validation, without enforcing any variant restrictions as Utils.isGuid does\nfunction isValidGuid(guid: string): boolean {\n  return RegExp(/^[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/, \"i\").test(guid);\n}\n","import { LogService } from \"../../../platform/abstractions/log.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { CipherService } from \"../../abstractions/cipher.service\";\nimport {\n  Fido2AlgorithmIdentifier,\n  Fido2AuthenticatorError,\n  Fido2AuthenticatorErrorCode,\n  Fido2AuthenticatorGetAssertionParams,\n  Fido2AuthenticatorGetAssertionResult,\n  Fido2AuthenticatorMakeCredentialResult,\n  Fido2AuthenticatorMakeCredentialsParams,\n  Fido2AuthenticatorService as Fido2AuthenticatorServiceAbstraction,\n  PublicKeyCredentialDescriptor,\n} from \"../../abstractions/fido2/fido2-authenticator.service.abstraction\";\nimport { Fido2UserInterfaceService } from \"../../abstractions/fido2/fido2-user-interface.service.abstraction\";\nimport { SyncService } from \"../../abstractions/sync/sync.service.abstraction\";\nimport { CipherRepromptType } from \"../../enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../enums/cipher-type\";\nimport { CipherView } from \"../../models/view/cipher.view\";\nimport { Fido2CredentialView } from \"../../models/view/fido2-credential.view\";\n\nimport { CBOR } from \"./cbor\";\nimport { p1363ToDer } from \"./ecdsa-utils\";\nimport { Fido2Utils } from \"./fido2-utils\";\nimport { guidToRawFormat, guidToStandardFormat } from \"./guid-utils\";\n\n// AAGUID: d548826e-79b4-db40-a3d8-11116f7e8349\nexport const AAGUID = new Uint8Array([\n  0xd5, 0x48, 0x82, 0x6e, 0x79, 0xb4, 0xdb, 0x40, 0xa3, 0xd8, 0x11, 0x11, 0x6f, 0x7e, 0x83, 0x49,\n]);\n\nconst KeyUsages: KeyUsage[] = [\"sign\"];\n\n/**\n * Bitwarden implementation of the WebAuthn Authenticator Model as described by W3C\n * https://www.w3.org/TR/webauthn-3/#sctn-authenticator-model\n *\n * It is highly recommended that the W3C specification is used a reference when reading this code.\n */\nexport class Fido2AuthenticatorService implements Fido2AuthenticatorServiceAbstraction {\n  constructor(\n    private cipherService: CipherService,\n    private userInterface: Fido2UserInterfaceService,\n    private syncService: SyncService,\n    private logService?: LogService,\n  ) {}\n\n  async makeCredential(\n    params: Fido2AuthenticatorMakeCredentialsParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ): Promise<Fido2AuthenticatorMakeCredentialResult> {\n    const userInterfaceSession = await this.userInterface.newSession(\n      params.fallbackSupported,\n      tab,\n      abortController,\n    );\n\n    try {\n      if (params.credTypesAndPubKeyAlgs.every((p) => p.alg !== Fido2AlgorithmIdentifier.ES256)) {\n        const requestedAlgorithms = params.credTypesAndPubKeyAlgs.map((p) => p.alg).join(\", \");\n        this.logService?.warning(\n          `[Fido2Authenticator] No compatible algorithms found, RP requested: ${requestedAlgorithms}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotSupported);\n      }\n\n      if (\n        params.requireResidentKey != undefined &&\n        typeof params.requireResidentKey !== \"boolean\"\n      ) {\n        this.logService?.error(\n          `[Fido2Authenticator] Invalid 'requireResidentKey' value: ${String(\n            params.requireResidentKey,\n          )}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n\n      if (\n        params.requireUserVerification != undefined &&\n        typeof params.requireUserVerification !== \"boolean\"\n      ) {\n        this.logService?.error(\n          `[Fido2Authenticator] Invalid 'requireUserVerification' value: ${String(\n            params.requireUserVerification,\n          )}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n\n      await userInterfaceSession.ensureUnlockedVault();\n      await this.syncService.fullSync(false);\n\n      const existingCipherIds = await this.findExcludedCredentials(\n        params.excludeCredentialDescriptorList,\n      );\n      if (existingCipherIds.length > 0) {\n        this.logService?.info(\n          `[Fido2Authenticator] Aborting due to excluded credential found in vault.`,\n        );\n        await userInterfaceSession.informExcludedCredential(existingCipherIds);\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      let cipher: CipherView;\n      let fido2Credential: Fido2CredentialView;\n      let keyPair: CryptoKeyPair;\n      let userVerified = false;\n      let credentialId: string;\n      let pubKeyDer: ArrayBuffer;\n      const response = await userInterfaceSession.confirmNewCredential({\n        credentialName: params.rpEntity.name,\n        userName: params.userEntity.displayName,\n        userVerification: params.requireUserVerification,\n      });\n      const cipherId = response.cipherId;\n      userVerified = response.userVerified;\n\n      if (cipherId === undefined) {\n        this.logService?.warning(\n          `[Fido2Authenticator] Aborting because user confirmation was not recieved.`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      try {\n        keyPair = await createKeyPair();\n        pubKeyDer = await crypto.subtle.exportKey(\"spki\", keyPair.publicKey);\n        const encrypted = await this.cipherService.get(cipherId);\n        cipher = await encrypted.decrypt(\n          await this.cipherService.getKeyForCipherKeyDecryption(encrypted),\n        );\n\n        if (\n          !userVerified &&\n          (params.requireUserVerification || cipher.reprompt !== CipherRepromptType.None)\n        ) {\n          this.logService?.warning(\n            `[Fido2Authenticator] Aborting because user verification was unsuccessful.`,\n          );\n          throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n        }\n\n        fido2Credential = await createKeyView(params, keyPair.privateKey);\n        cipher.login.fido2Credentials = [fido2Credential];\n        const reencrypted = await this.cipherService.encrypt(cipher);\n        await this.cipherService.updateWithServer(reencrypted);\n        credentialId = fido2Credential.credentialId;\n      } catch (error) {\n        this.logService?.error(\n          `[Fido2Authenticator] Aborting because of unknown error when creating credential: ${error}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n\n      const authData = await generateAuthData({\n        rpId: params.rpEntity.id,\n        credentialId: guidToRawFormat(credentialId),\n        counter: fido2Credential.counter,\n        userPresence: true,\n        userVerification: userVerified,\n        keyPair,\n      });\n      const attestationObject = new Uint8Array(\n        CBOR.encode({\n          fmt: \"none\",\n          attStmt: {},\n          authData,\n        }),\n      );\n\n      return {\n        credentialId: guidToRawFormat(credentialId),\n        attestationObject,\n        authData,\n        publicKey: pubKeyDer,\n        publicKeyAlgorithm: -7,\n      };\n    } finally {\n      userInterfaceSession.close();\n    }\n  }\n\n  async getAssertion(\n    params: Fido2AuthenticatorGetAssertionParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ): Promise<Fido2AuthenticatorGetAssertionResult> {\n    const userInterfaceSession = await this.userInterface.newSession(\n      params.fallbackSupported,\n      tab,\n      abortController,\n    );\n    try {\n      if (\n        params.requireUserVerification != undefined &&\n        typeof params.requireUserVerification !== \"boolean\"\n      ) {\n        this.logService?.error(\n          `[Fido2Authenticator] Invalid 'requireUserVerification' value: ${String(\n            params.requireUserVerification,\n          )}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n\n      let cipherOptions: CipherView[];\n\n      await userInterfaceSession.ensureUnlockedVault();\n      await this.syncService.fullSync(false);\n\n      if (params.allowCredentialDescriptorList?.length > 0) {\n        cipherOptions = await this.findCredentialsById(\n          params.allowCredentialDescriptorList,\n          params.rpId,\n        );\n      } else {\n        cipherOptions = await this.findCredentialsByRp(params.rpId);\n      }\n\n      if (cipherOptions.length === 0) {\n        this.logService?.info(\n          `[Fido2Authenticator] Aborting because no matching credentials were found in the vault.`,\n        );\n\n        await userInterfaceSession.informCredentialNotFound();\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      const response = await userInterfaceSession.pickCredential({\n        cipherIds: cipherOptions.map((cipher) => cipher.id),\n        userVerification: params.requireUserVerification,\n      });\n      const selectedCipherId = response.cipherId;\n      const userVerified = response.userVerified;\n      const selectedCipher = cipherOptions.find((c) => c.id === selectedCipherId);\n\n      if (selectedCipher === undefined) {\n        this.logService?.error(\n          `[Fido2Authenticator] Aborting because the selected credential could not be found.`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      if (\n        !userVerified &&\n        (params.requireUserVerification || selectedCipher.reprompt !== CipherRepromptType.None)\n      ) {\n        this.logService?.warning(\n          `[Fido2Authenticator] Aborting because user verification was unsuccessful.`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.NotAllowed);\n      }\n\n      try {\n        const selectedFido2Credential = selectedCipher.login.fido2Credentials[0];\n        const selectedCredentialId = selectedFido2Credential.credentialId;\n\n        ++selectedFido2Credential.counter;\n\n        selectedCipher.localData = {\n          ...selectedCipher.localData,\n          lastUsedDate: new Date().getTime(),\n        };\n        const encrypted = await this.cipherService.encrypt(selectedCipher);\n        await this.cipherService.updateWithServer(encrypted);\n\n        const authenticatorData = await generateAuthData({\n          rpId: selectedFido2Credential.rpId,\n          credentialId: guidToRawFormat(selectedCredentialId),\n          counter: selectedFido2Credential.counter,\n          userPresence: true,\n          userVerification: userVerified,\n        });\n\n        const signature = await generateSignature({\n          authData: authenticatorData,\n          clientDataHash: params.hash,\n          privateKey: await getPrivateKeyFromFido2Credential(selectedFido2Credential),\n        });\n\n        return {\n          authenticatorData,\n          selectedCredential: {\n            id: guidToRawFormat(selectedCredentialId),\n            userHandle: Fido2Utils.stringToBuffer(selectedFido2Credential.userHandle),\n          },\n          signature,\n        };\n      } catch (error) {\n        this.logService?.error(\n          `[Fido2Authenticator] Aborting because of unknown error when asserting credential: ${error}`,\n        );\n        throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n      }\n    } finally {\n      userInterfaceSession.close();\n    }\n  }\n\n  /** Finds existing crendetials and returns the `cipherId` for each one */\n  private async findExcludedCredentials(\n    credentials: PublicKeyCredentialDescriptor[],\n  ): Promise<string[]> {\n    const ids: string[] = [];\n\n    for (const credential of credentials) {\n      try {\n        ids.push(guidToStandardFormat(credential.id));\n        // eslint-disable-next-line no-empty\n      } catch {}\n    }\n\n    if (ids.length === 0) {\n      return [];\n    }\n\n    const ciphers = await this.cipherService.getAllDecrypted();\n    return ciphers\n      .filter(\n        (cipher) =>\n          !cipher.isDeleted &&\n          cipher.organizationId == undefined &&\n          cipher.type === CipherType.Login &&\n          cipher.login.hasFido2Credentials &&\n          ids.includes(cipher.login.fido2Credentials[0].credentialId),\n      )\n      .map((cipher) => cipher.id);\n  }\n\n  private async findCredentialsById(\n    credentials: PublicKeyCredentialDescriptor[],\n    rpId: string,\n  ): Promise<CipherView[]> {\n    const ids: string[] = [];\n\n    for (const credential of credentials) {\n      try {\n        ids.push(guidToStandardFormat(credential.id));\n        // eslint-disable-next-line no-empty\n      } catch {}\n    }\n\n    if (ids.length === 0) {\n      return [];\n    }\n\n    const ciphers = await this.cipherService.getAllDecrypted();\n    return ciphers.filter(\n      (cipher) =>\n        !cipher.isDeleted &&\n        cipher.type === CipherType.Login &&\n        cipher.login.hasFido2Credentials &&\n        cipher.login.fido2Credentials[0].rpId === rpId &&\n        ids.includes(cipher.login.fido2Credentials[0].credentialId),\n    );\n  }\n\n  private async findCredentialsByRp(rpId: string): Promise<CipherView[]> {\n    const ciphers = await this.cipherService.getAllDecrypted();\n    return ciphers.filter(\n      (cipher) =>\n        !cipher.isDeleted &&\n        cipher.type === CipherType.Login &&\n        cipher.login.hasFido2Credentials &&\n        cipher.login.fido2Credentials[0].rpId === rpId &&\n        cipher.login.fido2Credentials[0].discoverable,\n    );\n  }\n}\n\nasync function createKeyPair() {\n  return await crypto.subtle.generateKey(\n    {\n      name: \"ECDSA\",\n      namedCurve: \"P-256\",\n    },\n    true,\n    KeyUsages,\n  );\n}\n\nasync function createKeyView(\n  params: Fido2AuthenticatorMakeCredentialsParams,\n  keyValue: CryptoKey,\n): Promise<Fido2CredentialView> {\n  if (keyValue.algorithm.name !== \"ECDSA\" && (keyValue.algorithm as any).namedCurve !== \"P-256\") {\n    throw new Fido2AuthenticatorError(Fido2AuthenticatorErrorCode.Unknown);\n  }\n\n  const pkcs8Key = await crypto.subtle.exportKey(\"pkcs8\", keyValue);\n  const fido2Credential = new Fido2CredentialView();\n  fido2Credential.credentialId = Utils.newGuid();\n  fido2Credential.keyType = \"public-key\";\n  fido2Credential.keyAlgorithm = \"ECDSA\";\n  fido2Credential.keyCurve = \"P-256\";\n  fido2Credential.keyValue = Fido2Utils.bufferToString(pkcs8Key);\n  fido2Credential.rpId = params.rpEntity.id;\n  fido2Credential.userHandle = Fido2Utils.bufferToString(params.userEntity.id);\n  fido2Credential.userName = params.userEntity.name;\n  fido2Credential.counter = 0;\n  fido2Credential.rpName = params.rpEntity.name;\n  fido2Credential.userDisplayName = params.userEntity.displayName;\n  fido2Credential.discoverable = params.requireResidentKey;\n  fido2Credential.creationDate = new Date();\n\n  return fido2Credential;\n}\n\nasync function getPrivateKeyFromFido2Credential(\n  fido2Credential: Fido2CredentialView,\n): Promise<CryptoKey> {\n  const keyBuffer = Fido2Utils.stringToBuffer(fido2Credential.keyValue);\n  return await crypto.subtle.importKey(\n    \"pkcs8\",\n    keyBuffer,\n    {\n      name: fido2Credential.keyAlgorithm,\n      namedCurve: fido2Credential.keyCurve,\n    } as EcKeyImportParams,\n    true,\n    KeyUsages,\n  );\n}\n\ninterface AuthDataParams {\n  rpId: string;\n  credentialId: BufferSource;\n  userPresence: boolean;\n  userVerification: boolean;\n  counter: number;\n  keyPair?: CryptoKeyPair;\n}\n\nasync function generateAuthData(params: AuthDataParams) {\n  const authData: Array<number> = [];\n\n  const rpIdHash = new Uint8Array(\n    await crypto.subtle.digest({ name: \"SHA-256\" }, Utils.fromByteStringToArray(params.rpId)),\n  );\n  authData.push(...rpIdHash);\n\n  const flags = authDataFlags({\n    extensionData: false,\n    attestationData: params.keyPair != undefined,\n    backupEligibility: true,\n    backupState: true, // Credentials are always synced\n    userVerification: params.userVerification,\n    userPresence: params.userPresence,\n  });\n  authData.push(flags);\n\n  // add 4 bytes of counter - we use time in epoch seconds as monotonic counter\n  // TODO: Consider changing this to a cryptographically safe random number\n  const counter = params.counter;\n  authData.push(\n    ((counter & 0xff000000) >> 24) & 0xff,\n    ((counter & 0x00ff0000) >> 16) & 0xff,\n    ((counter & 0x0000ff00) >> 8) & 0xff,\n    counter & 0x000000ff,\n  );\n\n  if (params.keyPair) {\n    // attestedCredentialData\n    const attestedCredentialData: Array<number> = [];\n\n    attestedCredentialData.push(...AAGUID);\n\n    // credentialIdLength (2 bytes) and credential Id\n    const rawId = Fido2Utils.bufferSourceToUint8Array(params.credentialId);\n    const credentialIdLength = [(rawId.length - (rawId.length & 0xff)) / 256, rawId.length & 0xff];\n    attestedCredentialData.push(...credentialIdLength);\n    attestedCredentialData.push(...rawId);\n\n    const publicKeyJwk = await crypto.subtle.exportKey(\"jwk\", params.keyPair.publicKey);\n    // COSE format of the EC256 key\n    const keyX = Utils.fromUrlB64ToArray(publicKeyJwk.x);\n    const keyY = Utils.fromUrlB64ToArray(publicKeyJwk.y);\n\n    // Can't get `cbor-redux` to encode in CTAP2 canonical CBOR. So we do it manually:\n    const coseBytes = new Uint8Array(77);\n    coseBytes.set([0xa5, 0x01, 0x02, 0x03, 0x26, 0x20, 0x01, 0x21, 0x58, 0x20], 0);\n    coseBytes.set(keyX, 10);\n    coseBytes.set([0x22, 0x58, 0x20], 10 + 32);\n    coseBytes.set(keyY, 10 + 32 + 3);\n\n    // credential public key - convert to array from CBOR encoded COSE key\n    attestedCredentialData.push(...coseBytes);\n\n    authData.push(...attestedCredentialData);\n  }\n\n  return new Uint8Array(authData);\n}\n\ninterface SignatureParams {\n  authData: Uint8Array;\n  clientDataHash: BufferSource;\n  privateKey: CryptoKey;\n}\n\nasync function generateSignature(params: SignatureParams) {\n  const sigBase = new Uint8Array([\n    ...params.authData,\n    ...Fido2Utils.bufferSourceToUint8Array(params.clientDataHash),\n  ]);\n  const p1363_signature = new Uint8Array(\n    await crypto.subtle.sign(\n      {\n        name: \"ECDSA\",\n        hash: { name: \"SHA-256\" },\n      },\n      params.privateKey,\n      sigBase,\n    ),\n  );\n\n  const asn1Der_signature = p1363ToDer(p1363_signature);\n\n  return asn1Der_signature;\n}\n\ninterface Flags {\n  extensionData: boolean;\n  attestationData: boolean;\n  backupEligibility: boolean;\n  backupState: boolean;\n  userVerification: boolean;\n  userPresence: boolean;\n}\n\nfunction authDataFlags(options: Flags): number {\n  let flags = 0;\n\n  if (options.extensionData) {\n    flags |= 0b1000000;\n  }\n\n  if (options.attestationData) {\n    flags |= 0b01000000;\n  }\n\n  if (options.backupEligibility) {\n    flags |= 0b00001000;\n  }\n\n  if (options.backupState) {\n    flags |= 0b00010000;\n  }\n\n  if (options.userVerification) {\n    flags |= 0b00000100;\n  }\n\n  if (options.userPresence) {\n    flags |= 0b00000001;\n  }\n\n  return flags;\n}\n","export const UserRequestedFallbackAbortReason = \"UserRequestedFallback\";\n\nexport type UserVerification = \"discouraged\" | \"preferred\" | \"required\";\n\n/**\n * This class represents an abstraction of the WebAuthn Client as described by W3C:\n * https://www.w3.org/TR/webauthn-3/#webauthn-client\n *\n * The WebAuthn Client is an intermediary entity typically implemented in the user agent\n * (in whole, or in part). Conceptually, it underlies the Web Authentication API and embodies\n * the implementation of the Web Authentication API's operations.\n *\n * It is responsible for both marshalling the inputs for the underlying authenticator operations,\n * and for returning the results of the latter operations to the Web Authentication API's callers.\n */\nexport abstract class Fido2ClientService {\n  isFido2FeatureEnabled: (hostname: string, origin: string) => Promise<boolean>;\n\n  /**\n   * Allows WebAuthn Relying Party scripts to request the creation of a new public key credential source.\n   * For more information please see: https://www.w3.org/TR/webauthn-3/#sctn-createCredential\n   *\n   * @param params The parameters for the credential creation operation.\n   * @param abortController An AbortController that can be used to abort the operation.\n   * @returns A promise that resolves with the new credential.\n   */\n  createCredential: (\n    params: CreateCredentialParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ) => Promise<CreateCredentialResult>;\n\n  /**\n   * Allows WebAuthn Relying Party scripts to discover and use an existing public key credential, with the user’s consent.\n   * Relying Party script can optionally specify some criteria to indicate what credential sources are acceptable to it.\n   * For more information please see: https://www.w3.org/TR/webauthn-3/#sctn-getAssertion\n   *\n   * @param params The parameters for the credential assertion operation.\n   * @param abortController An AbortController that can be used to abort the operation.\n   * @returns A promise that resolves with the asserted credential.\n   */\n  assertCredential: (\n    params: AssertCredentialParams,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ) => Promise<AssertCredentialResult>;\n}\n\n/**\n * Parameters for creating a new credential.\n */\nexport interface CreateCredentialParams {\n  /** The Relaying Parties origin, see: https://html.spec.whatwg.org/multipage/browsers.html#concept-origin */\n  origin: string;\n  /**\n   * A value which is true if and only if the caller’s environment settings object is same-origin with its ancestors.\n   * It is false if caller is cross-origin.\n   * */\n  sameOriginWithAncestors: boolean;\n  /** The Relying Party's preference for attestation conveyance */\n  attestation?: \"direct\" | \"enterprise\" | \"indirect\" | \"none\";\n  /** The Relying Party's requirements of the authenticator used in the creation of the credential. */\n  authenticatorSelection?: {\n    // authenticatorAttachment?: AuthenticatorAttachment; // not used\n    requireResidentKey?: boolean;\n    residentKey?: \"discouraged\" | \"preferred\" | \"required\";\n    userVerification?: UserVerification;\n  };\n  /** Challenge intended to be used for generating the newly created credential's attestation object. */\n  challenge: string; // b64 encoded\n  /**\n   * This member is intended for use by Relying Parties that wish to limit the creation of multiple credentials for\n   * the same account on a single authenticator. The client is requested to return an error if the new credential would\n   * be created on an authenticator that also contains one of the credentials enumerated in this parameter.\n   * */\n  excludeCredentials?: {\n    id: string; // b64 encoded\n    transports?: (\"ble\" | \"hybrid\" | \"internal\" | \"nfc\" | \"usb\")[];\n    type: \"public-key\";\n  }[];\n  /**\n   * This member contains additional parameters requesting additional processing by the client and authenticator.\n   **/\n  extensions?: {\n    appid?: string; // Not supported\n    appidExclude?: string; // Not supported\n    uvm?: boolean; // Not supported\n    credProps?: boolean;\n  };\n  /**\n   * This member contains information about the desired properties of the credential to be created.\n   * The sequence is ordered from most preferred to least preferred.\n   * The client makes a best-effort to create the most preferred credential that it can.\n   */\n  pubKeyCredParams: PublicKeyCredentialParam[];\n  /** Data about the Relying Party responsible for the request. */\n  rp: {\n    id?: string;\n    name: string;\n  };\n  /** Data about the user account for which the Relying Party is requesting attestation. */\n  user: {\n    id: string; // b64 encoded\n    displayName: string;\n    name: string;\n  };\n  /** Forwarded to user interface */\n  fallbackSupported: boolean;\n  /**\n   * This member specifies a time, in milliseconds, that the caller is willing to wait for the call to complete.\n   * This is treated as a hint, and MAY be overridden by the client.\n   **/\n  timeout?: number;\n}\n\n/**\n * The result of creating a new credential.\n */\nexport interface CreateCredentialResult {\n  credentialId: string;\n  clientDataJSON: string;\n  attestationObject: string;\n  authData: string;\n  publicKey: string;\n  publicKeyAlgorithm: number;\n  transports: string[];\n  extensions: {\n    credProps?: {\n      rk: boolean;\n    };\n  };\n}\n\n/**\n * Parameters for asserting a credential.\n */\nexport interface AssertCredentialParams {\n  allowedCredentialIds: string[];\n  rpId: string;\n  origin: string;\n  challenge: string;\n  userVerification?: UserVerification;\n  timeout: number;\n  sameOriginWithAncestors: boolean;\n  fallbackSupported: boolean;\n}\n\n/**\n * The result of asserting a credential.\n */\nexport interface AssertCredentialResult {\n  credentialId: string;\n  clientDataJSON: string;\n  authenticatorData: string;\n  signature: string;\n  userHandle: string;\n}\n\n/**\n * A description of a key type and algorithm.\n *\n * @example {\n *   alg: -7, // ES256\n *   type: \"public-key\"\n * }\n */\nexport interface PublicKeyCredentialParam {\n  alg: number;\n  type: \"public-key\";\n}\n\n/**\n * Error thrown when the user requests a fallback to the browser's built-in WebAuthn implementation.\n */\nexport class FallbackRequestedError extends Error {\n  readonly fallbackRequested = true;\n  constructor() {\n    super(\"FallbackRequested\");\n  }\n}\n","import { parse } from \"tldts\";\n\nexport function isValidRpId(rpId: string, origin: string) {\n  const parsedOrigin = parse(origin, { allowPrivateDomains: true });\n  const parsedRpId = parse(rpId, { allowPrivateDomains: true });\n\n  return (\n    (parsedOrigin.domain == null &&\n      parsedOrigin.hostname == parsedRpId.hostname &&\n      parsedOrigin.hostname == \"localhost\") ||\n    (parsedOrigin.domain != null &&\n      parsedOrigin.domain == parsedRpId.domain &&\n      parsedOrigin.subdomain.endsWith(parsedRpId.subdomain))\n  );\n}\n","import { firstValueFrom } from \"rxjs\";\nimport { parse } from \"tldts\";\n\nimport { AuthService } from \"../../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../../auth/enums/authentication-status\";\nimport { ConfigServiceAbstraction } from \"../../../platform/abstractions/config/config.service.abstraction\";\nimport { LogService } from \"../../../platform/abstractions/log.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport {\n  Fido2AuthenticatorError,\n  Fido2AuthenticatorErrorCode,\n  Fido2AuthenticatorGetAssertionParams,\n  Fido2AuthenticatorMakeCredentialsParams,\n  Fido2AuthenticatorService,\n  PublicKeyCredentialDescriptor,\n} from \"../../abstractions/fido2/fido2-authenticator.service.abstraction\";\nimport {\n  AssertCredentialParams,\n  AssertCredentialResult,\n  CreateCredentialParams,\n  CreateCredentialResult,\n  FallbackRequestedError,\n  Fido2ClientService as Fido2ClientServiceAbstraction,\n  PublicKeyCredentialParam,\n  UserRequestedFallbackAbortReason,\n  UserVerification,\n} from \"../../abstractions/fido2/fido2-client.service.abstraction\";\nimport { VaultSettingsService } from \"../../abstractions/vault-settings/vault-settings.service\";\n\nimport { isValidRpId } from \"./domain-utils\";\nimport { Fido2Utils } from \"./fido2-utils\";\n\n/**\n * Bitwarden implementation of the Web Authentication API as described by W3C\n * https://www.w3.org/TR/webauthn-3/#sctn-api\n *\n * It is highly recommended that the W3C specification is used a reference when reading this code.\n */\nexport class Fido2ClientService implements Fido2ClientServiceAbstraction {\n  constructor(\n    private authenticator: Fido2AuthenticatorService,\n    private configService: ConfigServiceAbstraction,\n    private authService: AuthService,\n    private stateService: StateService,\n    private vaultSettingsService: VaultSettingsService,\n    private logService?: LogService,\n  ) {}\n\n  async isFido2FeatureEnabled(hostname: string, origin: string): Promise<boolean> {\n    const userEnabledPasskeys = await firstValueFrom(this.vaultSettingsService.enablePasskeys$);\n    const isUserLoggedIn =\n      (await this.authService.getAuthStatus()) !== AuthenticationStatus.LoggedOut;\n\n    const neverDomains = await this.stateService.getNeverDomains();\n    const isExcludedDomain = neverDomains != null && hostname in neverDomains;\n\n    const serverConfig = await firstValueFrom(this.configService.serverConfig$);\n    const isOriginEqualBitwardenVault = origin === serverConfig.environment?.vault;\n\n    return (\n      userEnabledPasskeys && isUserLoggedIn && !isExcludedDomain && !isOriginEqualBitwardenVault\n    );\n  }\n\n  async createCredential(\n    params: CreateCredentialParams,\n    tab: chrome.tabs.Tab,\n    abortController = new AbortController(),\n  ): Promise<CreateCredentialResult> {\n    const parsedOrigin = parse(params.origin, { allowPrivateDomains: true });\n    const enableFido2VaultCredentials = await this.isFido2FeatureEnabled(\n      parsedOrigin.hostname,\n      params.origin,\n    );\n\n    if (!enableFido2VaultCredentials) {\n      this.logService?.warning(`[Fido2Client] Fido2VaultCredential is not enabled`);\n      throw new FallbackRequestedError();\n    }\n\n    if (!params.sameOriginWithAncestors) {\n      this.logService?.warning(\n        `[Fido2Client] Invalid 'sameOriginWithAncestors' value: ${params.sameOriginWithAncestors}`,\n      );\n      throw new DOMException(\"Invalid 'sameOriginWithAncestors' value\", \"NotAllowedError\");\n    }\n\n    const userId = Fido2Utils.stringToBuffer(params.user.id);\n    if (userId.length < 1 || userId.length > 64) {\n      this.logService?.warning(\n        `[Fido2Client] Invalid 'user.id' length: ${params.user.id} (${userId.length})`,\n      );\n      throw new TypeError(\"Invalid 'user.id' length\");\n    }\n\n    params.rp.id = params.rp.id ?? parsedOrigin.hostname;\n    if (parsedOrigin.hostname == undefined || !params.origin.startsWith(\"https://\")) {\n      this.logService?.warning(`[Fido2Client] Invalid https origin: ${params.origin}`);\n      throw new DOMException(\"'origin' is not a valid https origin\", \"SecurityError\");\n    }\n\n    if (!isValidRpId(params.rp.id, params.origin)) {\n      this.logService?.warning(\n        `[Fido2Client] 'rp.id' cannot be used with the current origin: rp.id = ${params.rp.id}; origin = ${params.origin}`,\n      );\n      throw new DOMException(\"'rp.id' cannot be used with the current origin\", \"SecurityError\");\n    }\n\n    let credTypesAndPubKeyAlgs: PublicKeyCredentialParam[];\n    if (params.pubKeyCredParams?.length > 0) {\n      // Filter out all unsupported algorithms\n      credTypesAndPubKeyAlgs = params.pubKeyCredParams.filter(\n        (kp) => kp.alg === -7 && kp.type === \"public-key\",\n      );\n    } else {\n      // Assign default algorithms\n      credTypesAndPubKeyAlgs = [\n        { alg: -7, type: \"public-key\" },\n        { alg: -257, type: \"public-key\" },\n      ];\n    }\n\n    if (credTypesAndPubKeyAlgs.length === 0) {\n      const requestedAlgorithms = credTypesAndPubKeyAlgs.map((p) => p.alg).join(\", \");\n      this.logService?.warning(\n        `[Fido2Client] No compatible algorithms found, RP requested: ${requestedAlgorithms}`,\n      );\n      throw new DOMException(\"No supported key algorithms were found\", \"NotSupportedError\");\n    }\n\n    const collectedClientData = {\n      type: \"webauthn.create\",\n      challenge: params.challenge,\n      origin: params.origin,\n      crossOrigin: !params.sameOriginWithAncestors,\n      // tokenBinding: {} // Not currently supported\n    };\n    const clientDataJSON = JSON.stringify(collectedClientData);\n    const clientDataJSONBytes = Utils.fromByteStringToArray(clientDataJSON);\n    const clientDataHash = await crypto.subtle.digest({ name: \"SHA-256\" }, clientDataJSONBytes);\n    const makeCredentialParams = mapToMakeCredentialParams({\n      params,\n      credTypesAndPubKeyAlgs,\n      clientDataHash,\n    });\n\n    // Set timeout before invoking authenticator\n    if (abortController.signal.aborted) {\n      this.logService?.info(`[Fido2Client] Aborted with AbortController`);\n      throw new DOMException(\"The operation either timed out or was not allowed.\", \"AbortError\");\n    }\n    const timeout = setAbortTimeout(\n      abortController,\n      params.authenticatorSelection?.userVerification,\n      params.timeout,\n    );\n\n    let makeCredentialResult;\n    try {\n      makeCredentialResult = await this.authenticator.makeCredential(\n        makeCredentialParams,\n        tab,\n        abortController,\n      );\n    } catch (error) {\n      if (\n        abortController.signal.aborted &&\n        abortController.signal.reason === UserRequestedFallbackAbortReason\n      ) {\n        this.logService?.info(`[Fido2Client] Aborting because user requested fallback`);\n        throw new FallbackRequestedError();\n      }\n\n      if (\n        error instanceof Fido2AuthenticatorError &&\n        error.errorCode === Fido2AuthenticatorErrorCode.InvalidState\n      ) {\n        this.logService?.warning(`[Fido2Client] Unknown error: ${error}`);\n        throw new DOMException(\"Unknown error occured.\", \"InvalidStateError\");\n      }\n\n      this.logService?.info(`[Fido2Client] Aborted by user: ${error}`);\n      throw new DOMException(\n        \"The operation either timed out or was not allowed.\",\n        \"NotAllowedError\",\n      );\n    }\n\n    if (abortController.signal.aborted) {\n      this.logService?.info(`[Fido2Client] Aborted with AbortController`);\n      throw new DOMException(\"The operation either timed out or was not allowed.\", \"AbortError\");\n    }\n\n    let credProps;\n    if (params.extensions?.credProps) {\n      credProps = {\n        rk: makeCredentialParams.requireResidentKey,\n      };\n    }\n\n    clearTimeout(timeout);\n    return {\n      credentialId: Fido2Utils.bufferToString(makeCredentialResult.credentialId),\n      attestationObject: Fido2Utils.bufferToString(makeCredentialResult.attestationObject),\n      authData: Fido2Utils.bufferToString(makeCredentialResult.authData),\n      clientDataJSON: Fido2Utils.bufferToString(clientDataJSONBytes),\n      publicKey: Fido2Utils.bufferToString(makeCredentialResult.publicKey),\n      publicKeyAlgorithm: makeCredentialResult.publicKeyAlgorithm,\n      transports: params.rp.id === \"google.com\" ? [\"internal\", \"usb\"] : [\"internal\"],\n      extensions: { credProps },\n    };\n  }\n\n  async assertCredential(\n    params: AssertCredentialParams,\n    tab: chrome.tabs.Tab,\n    abortController = new AbortController(),\n  ): Promise<AssertCredentialResult> {\n    const parsedOrigin = parse(params.origin, { allowPrivateDomains: true });\n    const enableFido2VaultCredentials = await this.isFido2FeatureEnabled(\n      parsedOrigin.hostname,\n      params.origin,\n    );\n\n    if (!enableFido2VaultCredentials) {\n      this.logService?.warning(`[Fido2Client] Fido2VaultCredential is not enabled`);\n      throw new FallbackRequestedError();\n    }\n\n    params.rpId = params.rpId ?? parsedOrigin.hostname;\n\n    if (parsedOrigin.hostname == undefined || !params.origin.startsWith(\"https://\")) {\n      this.logService?.warning(`[Fido2Client] Invalid https origin: ${params.origin}`);\n      throw new DOMException(\"'origin' is not a valid https origin\", \"SecurityError\");\n    }\n\n    if (!isValidRpId(params.rpId, params.origin)) {\n      this.logService?.warning(\n        `[Fido2Client] 'rp.id' cannot be used with the current origin: rp.id = ${params.rpId}; origin = ${params.origin}`,\n      );\n      throw new DOMException(\"'rp.id' cannot be used with the current origin\", \"SecurityError\");\n    }\n\n    const collectedClientData = {\n      type: \"webauthn.get\",\n      challenge: params.challenge,\n      origin: params.origin,\n      crossOrigin: !params.sameOriginWithAncestors,\n      // tokenBinding: {} // Not currently supported\n    };\n    const clientDataJSON = JSON.stringify(collectedClientData);\n    const clientDataJSONBytes = Utils.fromByteStringToArray(clientDataJSON);\n    const clientDataHash = await crypto.subtle.digest({ name: \"SHA-256\" }, clientDataJSONBytes);\n    const getAssertionParams = mapToGetAssertionParams({ params, clientDataHash });\n\n    if (abortController.signal.aborted) {\n      this.logService?.info(`[Fido2Client] Aborted with AbortController`);\n      throw new DOMException(\"The operation either timed out or was not allowed.\", \"AbortError\");\n    }\n\n    const timeout = setAbortTimeout(abortController, params.userVerification, params.timeout);\n\n    let getAssertionResult;\n    try {\n      getAssertionResult = await this.authenticator.getAssertion(\n        getAssertionParams,\n        tab,\n        abortController,\n      );\n    } catch (error) {\n      if (\n        abortController.signal.aborted &&\n        abortController.signal.reason === UserRequestedFallbackAbortReason\n      ) {\n        this.logService?.info(`[Fido2Client] Aborting because user requested fallback`);\n        throw new FallbackRequestedError();\n      }\n\n      if (\n        error instanceof Fido2AuthenticatorError &&\n        error.errorCode === Fido2AuthenticatorErrorCode.InvalidState\n      ) {\n        this.logService?.warning(`[Fido2Client] Unknown error: ${error}`);\n        throw new DOMException(\"Unknown error occured.\", \"InvalidStateError\");\n      }\n\n      this.logService?.info(`[Fido2Client] Aborted by user: ${error}`);\n      throw new DOMException(\n        \"The operation either timed out or was not allowed.\",\n        \"NotAllowedError\",\n      );\n    }\n\n    if (abortController.signal.aborted) {\n      this.logService?.info(`[Fido2Client] Aborted with AbortController`);\n      throw new DOMException(\"The operation either timed out or was not allowed.\", \"AbortError\");\n    }\n    clearTimeout(timeout);\n\n    return {\n      authenticatorData: Fido2Utils.bufferToString(getAssertionResult.authenticatorData),\n      clientDataJSON: Fido2Utils.bufferToString(clientDataJSONBytes),\n      credentialId: Fido2Utils.bufferToString(getAssertionResult.selectedCredential.id),\n      userHandle:\n        getAssertionResult.selectedCredential.userHandle !== undefined\n          ? Fido2Utils.bufferToString(getAssertionResult.selectedCredential.userHandle)\n          : undefined,\n      signature: Fido2Utils.bufferToString(getAssertionResult.signature),\n    };\n  }\n}\n\nconst TIMEOUTS = {\n  NO_VERIFICATION: {\n    DEFAULT: 120000,\n    MIN: 30000,\n    MAX: 180000,\n  },\n  WITH_VERIFICATION: {\n    DEFAULT: 300000,\n    MIN: 30000,\n    MAX: 600000,\n  },\n};\n\nfunction setAbortTimeout(\n  abortController: AbortController,\n  userVerification?: UserVerification,\n  timeout?: number,\n): number {\n  let clampedTimeout: number;\n\n  if (userVerification === \"required\") {\n    timeout = timeout ?? TIMEOUTS.WITH_VERIFICATION.DEFAULT;\n    clampedTimeout = Math.max(\n      TIMEOUTS.WITH_VERIFICATION.MIN,\n      Math.min(timeout, TIMEOUTS.WITH_VERIFICATION.MAX),\n    );\n  } else {\n    timeout = timeout ?? TIMEOUTS.NO_VERIFICATION.DEFAULT;\n    clampedTimeout = Math.max(\n      TIMEOUTS.NO_VERIFICATION.MIN,\n      Math.min(timeout, TIMEOUTS.NO_VERIFICATION.MAX),\n    );\n  }\n\n  return window.setTimeout(() => abortController.abort(), clampedTimeout);\n}\n\n/**\n * Convert data gathered by the WebAuthn Client to a format that can be used by the authenticator.\n */\nfunction mapToMakeCredentialParams({\n  params,\n  credTypesAndPubKeyAlgs,\n  clientDataHash,\n}: {\n  params: CreateCredentialParams;\n  credTypesAndPubKeyAlgs: PublicKeyCredentialParam[];\n  clientDataHash: ArrayBuffer;\n}): Fido2AuthenticatorMakeCredentialsParams {\n  const excludeCredentialDescriptorList: PublicKeyCredentialDescriptor[] =\n    params.excludeCredentials?.map((credential) => ({\n      id: Fido2Utils.stringToBuffer(credential.id),\n      transports: credential.transports,\n      type: credential.type,\n    })) ?? [];\n\n  const requireResidentKey =\n    params.authenticatorSelection?.residentKey === \"required\" ||\n    params.authenticatorSelection?.residentKey === \"preferred\" ||\n    (params.authenticatorSelection?.residentKey === undefined &&\n      params.authenticatorSelection?.requireResidentKey === true);\n\n  const requireUserVerification =\n    params.authenticatorSelection?.userVerification === \"required\" ||\n    params.authenticatorSelection?.userVerification === \"preferred\" ||\n    params.authenticatorSelection?.userVerification === undefined;\n\n  return {\n    requireResidentKey,\n    requireUserVerification,\n    enterpriseAttestationPossible: params.attestation === \"enterprise\",\n    excludeCredentialDescriptorList,\n    credTypesAndPubKeyAlgs,\n    hash: clientDataHash,\n    rpEntity: {\n      id: params.rp.id,\n      name: params.rp.name,\n    },\n    userEntity: {\n      id: Fido2Utils.stringToBuffer(params.user.id),\n      displayName: params.user.displayName,\n      name: params.user.name,\n    },\n    fallbackSupported: params.fallbackSupported,\n  };\n}\n\n/**\n * Convert data gathered by the WebAuthn Client to a format that can be used by the authenticator.\n */\nfunction mapToGetAssertionParams({\n  params,\n  clientDataHash,\n}: {\n  params: AssertCredentialParams;\n  clientDataHash: ArrayBuffer;\n}): Fido2AuthenticatorGetAssertionParams {\n  const allowCredentialDescriptorList: PublicKeyCredentialDescriptor[] =\n    params.allowedCredentialIds.map((id) => ({\n      id: Fido2Utils.stringToBuffer(id),\n      type: \"public-key\",\n    }));\n\n  const requireUserVerification =\n    params.userVerification === \"required\" ||\n    params.userVerification === \"preferred\" ||\n    params.userVerification === undefined;\n\n  return {\n    rpId: params.rpId,\n    requireUserVerification,\n    hash: clientDataHash,\n    allowCredentialDescriptorList,\n    extensions: {},\n    fallbackSupported: params.fallbackSupported,\n  };\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { ErrorResponse } from \"../../../models/response/error.response\";\nimport {\n  FileUploadApiMethods,\n  FileUploadService,\n} from \"../../../platform/abstractions/file-upload/file-upload.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { EncArrayBuffer } from \"../../../platform/models/domain/enc-array-buffer\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { CipherFileUploadService as CipherFileUploadServiceAbstraction } from \"../../abstractions/file-upload/cipher-file-upload.service\";\nimport { Cipher } from \"../../models/domain/cipher\";\nimport { AttachmentRequest } from \"../../models/request/attachment.request\";\nimport { AttachmentUploadDataResponse } from \"../../models/response/attachment-upload-data.response\";\nimport { CipherResponse } from \"../../models/response/cipher.response\";\n\nexport class CipherFileUploadService implements CipherFileUploadServiceAbstraction {\n  constructor(\n    private apiService: ApiService,\n    private fileUploadService: FileUploadService,\n  ) {}\n\n  async upload(\n    cipher: Cipher,\n    encFileName: EncString,\n    encData: EncArrayBuffer,\n    admin: boolean,\n    dataEncKey: [SymmetricCryptoKey, EncString],\n  ): Promise<CipherResponse> {\n    const request: AttachmentRequest = {\n      key: dataEncKey[1].encryptedString,\n      fileName: encFileName.encryptedString,\n      fileSize: encData.buffer.byteLength,\n      adminRequest: admin,\n    };\n\n    let response: CipherResponse;\n    try {\n      const uploadDataResponse = await this.apiService.postCipherAttachment(cipher.id, request);\n      response = admin ? uploadDataResponse.cipherMiniResponse : uploadDataResponse.cipherResponse;\n      await this.fileUploadService.upload(\n        uploadDataResponse,\n        encFileName,\n        encData,\n        this.generateMethods(uploadDataResponse, response, request.adminRequest),\n      );\n    } catch (e) {\n      if (\n        (e instanceof ErrorResponse && (e as ErrorResponse).statusCode === 404) ||\n        (e as ErrorResponse).statusCode === 405\n      ) {\n        response = await this.legacyServerAttachmentFileUpload(\n          request.adminRequest,\n          cipher.id,\n          encFileName,\n          encData,\n          dataEncKey[1],\n        );\n      } else if (e instanceof ErrorResponse) {\n        throw new Error((e as ErrorResponse).getSingleMessage());\n      } else {\n        throw e;\n      }\n    }\n    return response;\n  }\n\n  private generateMethods(\n    uploadData: AttachmentUploadDataResponse,\n    response: CipherResponse,\n    isAdmin: boolean,\n  ): FileUploadApiMethods {\n    return {\n      postDirect: this.generatePostDirectCallback(uploadData, isAdmin),\n      renewFileUploadUrl: this.generateRenewFileUploadUrlCallback(uploadData, response, isAdmin),\n      rollback: this.generateRollbackCallback(response, uploadData, isAdmin),\n    };\n  }\n\n  private generatePostDirectCallback(uploadData: AttachmentUploadDataResponse, isAdmin: boolean) {\n    return (data: FormData) => {\n      const response = isAdmin ? uploadData.cipherMiniResponse : uploadData.cipherResponse;\n      return this.apiService.postAttachmentFile(response.id, uploadData.attachmentId, data);\n    };\n  }\n\n  private generateRenewFileUploadUrlCallback(\n    uploadData: AttachmentUploadDataResponse,\n    response: CipherResponse,\n    isAdmin: boolean,\n  ) {\n    return async () => {\n      const renewResponse = await this.apiService.renewAttachmentUploadUrl(\n        response.id,\n        uploadData.attachmentId,\n      );\n      return renewResponse?.url;\n    };\n  }\n\n  private generateRollbackCallback(\n    response: CipherResponse,\n    uploadData: AttachmentUploadDataResponse,\n    isAdmin: boolean,\n  ) {\n    return () => {\n      if (isAdmin) {\n        return this.apiService.deleteCipherAttachmentAdmin(response.id, uploadData.attachmentId);\n      } else {\n        return this.apiService.deleteCipherAttachment(response.id, uploadData.attachmentId);\n      }\n    };\n  }\n\n  /**\n   * @deprecated Mar 25 2021: This method has been deprecated in favor of direct uploads.\n   * This method still exists for backward compatibility with old server versions.\n   */\n  async legacyServerAttachmentFileUpload(\n    admin: boolean,\n    cipherId: string,\n    encFileName: EncString,\n    encData: EncArrayBuffer,\n    key: EncString,\n  ) {\n    const fd = new FormData();\n    try {\n      const blob = new Blob([encData.buffer], { type: \"application/octet-stream\" });\n      fd.append(\"key\", key.encryptedString);\n      fd.append(\"data\", blob, encFileName.encryptedString);\n    } catch (e) {\n      if (Utils.isNode && !Utils.isBrowser) {\n        fd.append(\"key\", key.encryptedString);\n        fd.append(\n          \"data\",\n          Buffer.from(encData.buffer) as any,\n          {\n            filepath: encFileName.encryptedString,\n            contentType: \"application/octet-stream\",\n          } as any,\n        );\n      } else {\n        throw e;\n      }\n    }\n\n    let response: CipherResponse;\n    try {\n      if (admin) {\n        response = await this.apiService.postCipherAttachmentAdminLegacy(cipherId, fd);\n      } else {\n        response = await this.apiService.postCipherAttachmentLegacy(cipherId, fd);\n      }\n    } catch (e) {\n      throw new Error((e as ErrorResponse).getSingleMessage());\n    }\n\n    return response;\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { FolderResponse } from \"../response/folder.response\";\n\nexport class FolderData {\n  id: string;\n  name: string;\n  revisionDate: string;\n\n  constructor(response: Partial<FolderResponse>) {\n    this.name = response?.name;\n    this.id = response?.id;\n    this.revisionDate = response?.revisionDate;\n  }\n\n  static fromJSON(obj: Jsonify<FolderData>) {\n    return Object.assign(new FolderData({}), obj);\n  }\n}\n","import { Folder } from \"../domain/folder\";\n\nexport class FolderRequest {\n  name: string;\n\n  constructor(folder: Folder) {\n    this.name = folder.name ? folder.name.encryptedString : null;\n  }\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { FolderApiServiceAbstraction } from \"../../../vault/abstractions/folder/folder-api.service.abstraction\";\nimport { InternalFolderService } from \"../../../vault/abstractions/folder/folder.service.abstraction\";\nimport { FolderData } from \"../../../vault/models/data/folder.data\";\nimport { Folder } from \"../../../vault/models/domain/folder\";\nimport { FolderRequest } from \"../../../vault/models/request/folder.request\";\nimport { FolderResponse } from \"../../../vault/models/response/folder.response\";\n\nexport class FolderApiService implements FolderApiServiceAbstraction {\n  constructor(\n    private folderService: InternalFolderService,\n    private apiService: ApiService,\n  ) {}\n\n  async save(folder: Folder): Promise<any> {\n    const request = new FolderRequest(folder);\n\n    let response: FolderResponse;\n    if (folder.id == null) {\n      response = await this.postFolder(request);\n      folder.id = response.id;\n    } else {\n      response = await this.putFolder(folder.id, request);\n    }\n\n    const data = new FolderData(response);\n    await this.folderService.upsert(data);\n  }\n\n  async delete(id: string): Promise<any> {\n    await this.deleteFolder(id);\n    await this.folderService.delete(id);\n  }\n\n  async get(id: string): Promise<FolderResponse> {\n    const r = await this.apiService.send(\"GET\", \"/folders/\" + id, null, true, true);\n    return new FolderResponse(r);\n  }\n\n  private async postFolder(request: FolderRequest): Promise<FolderResponse> {\n    const r = await this.apiService.send(\"POST\", \"/folders\", request, true, true);\n    return new FolderResponse(r);\n  }\n\n  async putFolder(id: string, request: FolderRequest): Promise<FolderResponse> {\n    const r = await this.apiService.send(\"PUT\", \"/folders/\" + id, request, true, true);\n    return new FolderResponse(r);\n  }\n\n  private deleteFolder(id: string): Promise<any> {\n    return this.apiService.send(\"DELETE\", \"/folders/\" + id, null, true, false);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { View } from \"../../../models/view/view\";\nimport { Folder } from \"../domain/folder\";\nimport { ITreeNodeObject } from \"../domain/tree-node\";\n\nexport class FolderView implements View, ITreeNodeObject {\n  id: string = null;\n  name: string = null;\n  revisionDate: Date = null;\n\n  constructor(f?: Folder) {\n    if (!f) {\n      return;\n    }\n\n    this.id = f.id;\n    this.revisionDate = f.revisionDate;\n  }\n\n  static fromJSON(obj: Jsonify<FolderView>) {\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    return Object.assign(new FolderView(), obj, { revisionDate });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { FolderData } from \"../data/folder.data\";\nimport { FolderView } from \"../view/folder.view\";\n\nexport class Folder extends Domain {\n  id: string;\n  name: EncString;\n  revisionDate: Date;\n\n  constructor(obj?: FolderData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        name: null,\n      },\n      [\"id\"],\n    );\n\n    this.revisionDate = obj.revisionDate != null ? new Date(obj.revisionDate) : null;\n  }\n\n  decrypt(): Promise<FolderView> {\n    return this.decryptObj(\n      new FolderView(this),\n      {\n        name: null,\n      },\n      null,\n    );\n  }\n\n  static fromJSON(obj: Jsonify<Folder>) {\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    return Object.assign(new Folder(), obj, { name: EncString.fromJSON(obj.name), revisionDate });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { DeriveDefinition, FOLDER_DISK, KeyDefinition } from \"../../../platform/state\";\nimport { FolderService } from \"../../abstractions/folder/folder.service.abstraction\";\nimport { FolderData } from \"../../models/data/folder.data\";\nimport { Folder } from \"../../models/domain/folder\";\nimport { FolderView } from \"../../models/view/folder.view\";\n\nexport const FOLDER_ENCRYPTED_FOLDERS = KeyDefinition.record<FolderData>(FOLDER_DISK, \"folders\", {\n  deserializer: (obj: Jsonify<FolderData>) => FolderData.fromJSON(obj),\n});\n\nexport const FOLDER_DECRYPTED_FOLDERS = DeriveDefinition.from<\n  Record<string, FolderData>,\n  FolderView[],\n  { folderService: FolderService; cryptoService: CryptoService }\n>(FOLDER_ENCRYPTED_FOLDERS, {\n  deserializer: (obj) => obj.map((f) => FolderView.fromJSON(f)),\n  derive: async (from, { folderService, cryptoService }) => {\n    const folders = Object.values(from || {}).map((f) => new Folder(f));\n\n    if (await cryptoService.hasUserKey()) {\n      return await folderService.decryptFolders(folders);\n    } else {\n      return [];\n    }\n  },\n});\n","import { Observable, firstValueFrom, map } from \"rxjs\";\n\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { I18nService } from \"../../../platform/abstractions/i18n.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { ActiveUserState, DerivedState, StateProvider } from \"../../../platform/state\";\nimport { UserId } from \"../../../types/guid\";\nimport { CipherService } from \"../../../vault/abstractions/cipher.service\";\nimport { InternalFolderService as InternalFolderServiceAbstraction } from \"../../../vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherData } from \"../../../vault/models/data/cipher.data\";\nimport { FolderData } from \"../../../vault/models/data/folder.data\";\nimport { Folder } from \"../../../vault/models/domain/folder\";\nimport { FolderView } from \"../../../vault/models/view/folder.view\";\nimport { FOLDER_DECRYPTED_FOLDERS, FOLDER_ENCRYPTED_FOLDERS } from \"../key-state/folder.state\";\n\nexport class FolderService implements InternalFolderServiceAbstraction {\n  folders$: Observable<Folder[]>;\n  folderViews$: Observable<FolderView[]>;\n\n  private encryptedFoldersState: ActiveUserState<Record<string, FolderData>>;\n  private decryptedFoldersState: DerivedState<FolderView[]>;\n\n  constructor(\n    private cryptoService: CryptoService,\n    private i18nService: I18nService,\n    private cipherService: CipherService,\n    private stateService: StateService,\n    private stateProvider: StateProvider,\n  ) {\n    this.encryptedFoldersState = this.stateProvider.getActive(FOLDER_ENCRYPTED_FOLDERS);\n    this.decryptedFoldersState = this.stateProvider.getDerived(\n      this.encryptedFoldersState.state$,\n      FOLDER_DECRYPTED_FOLDERS,\n      { folderService: this, cryptoService: this.cryptoService },\n    );\n\n    this.folders$ = this.encryptedFoldersState.state$.pipe(\n      map((folderData) => Object.values(folderData).map((f) => new Folder(f))),\n    );\n\n    this.folderViews$ = this.decryptedFoldersState.state$;\n  }\n\n  async clearCache(): Promise<void> {\n    await this.decryptedFoldersState.forceValue([]);\n  }\n\n  // TODO: This should be moved to EncryptService or something\n  async encrypt(model: FolderView, key?: SymmetricCryptoKey): Promise<Folder> {\n    const folder = new Folder();\n    folder.id = model.id;\n    folder.name = await this.cryptoService.encrypt(model.name, key);\n    return folder;\n  }\n\n  async get(id: string): Promise<Folder> {\n    const folders = await firstValueFrom(this.folders$);\n\n    return folders.find((folder) => folder.id === id);\n  }\n\n  async getAllFromState(): Promise<Folder[]> {\n    return await firstValueFrom(this.folders$);\n  }\n\n  /**\n   * @deprecated For the CLI only\n   * @param id id of the folder\n   */\n  async getFromState(id: string): Promise<Folder> {\n    const folder = await this.get(id);\n    if (!folder) {\n      return null;\n    }\n\n    return folder;\n  }\n\n  /**\n   * @deprecated Only use in CLI!\n   */\n  async getAllDecryptedFromState(): Promise<FolderView[]> {\n    return await firstValueFrom(this.folderViews$);\n  }\n\n  async upsert(folderData: FolderData | FolderData[]): Promise<void> {\n    await this.encryptedFoldersState.update((folders) => {\n      if (folders == null) {\n        folders = {};\n      }\n\n      if (folderData instanceof FolderData) {\n        const f = folderData as FolderData;\n        folders[f.id] = f;\n      } else {\n        (folderData as FolderData[]).forEach((f) => {\n          folders[f.id] = f;\n        });\n      }\n\n      return folders;\n    });\n  }\n\n  async replace(folders: { [id: string]: FolderData }): Promise<void> {\n    if (!folders) {\n      return;\n    }\n\n    await this.encryptedFoldersState.update(() => {\n      const newFolders: Record<string, FolderData> = { ...folders };\n      return newFolders;\n    });\n  }\n\n  async clear(userId?: UserId): Promise<void> {\n    if (userId == null) {\n      await this.encryptedFoldersState.update(() => ({}));\n      await this.decryptedFoldersState.forceValue([]);\n    } else {\n      await this.stateProvider.getUser(userId, FOLDER_ENCRYPTED_FOLDERS).update(() => ({}));\n    }\n  }\n\n  async delete(id: string | string[]): Promise<any> {\n    await this.encryptedFoldersState.update((folders) => {\n      if (folders == null) {\n        return;\n      }\n\n      if (typeof id === \"string\") {\n        if (folders[id] == null) {\n          return;\n        }\n        delete folders[id];\n      } else {\n        (id as string[]).forEach((i) => {\n          delete folders[i];\n        });\n      }\n      return folders;\n    });\n\n    // Items in a deleted folder are re-assigned to \"No Folder\"\n    const ciphers = await this.stateService.getEncryptedCiphers();\n    if (ciphers != null) {\n      const updates: CipherData[] = [];\n      for (const cId in ciphers) {\n        if (ciphers[cId].folderId === id) {\n          ciphers[cId].folderId = null;\n          updates.push(ciphers[cId]);\n        }\n      }\n      if (updates.length > 0) {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.cipherService.upsert(updates);\n      }\n    }\n  }\n\n  async decryptFolders(folders: Folder[]) {\n    const decryptFolderPromises = folders.map((f) => f.decrypt());\n    const decryptedFolders = await Promise.all(decryptFolderPromises);\n\n    decryptedFolders.sort(Utils.getSortFunction(this.i18nService, \"name\"));\n\n    const noneFolder = new FolderView();\n    noneFolder.name = this.i18nService.t(\"noneFolder\");\n    decryptedFolders.push(noneFolder);\n    return decryptedFolders;\n  }\n}\n","import { Subject } from \"rxjs\";\n\nimport { SyncNotifierService as SyncNotifierServiceAbstraction } from \"../../abstractions/sync/sync-notifier.service.abstraction\";\nimport { SyncEventArgs } from \"../../types/sync-event-args\";\n\n/**\n * This class should most likely have 0 dependencies because it will hopefully\n * be rolled into SyncService once upon a time.\n */\nexport class SyncNotifierService implements SyncNotifierServiceAbstraction {\n  private _sync = new Subject<SyncEventArgs>();\n\n  sync$ = this._sync.asObservable();\n\n  next(event: SyncEventArgs): void {\n    this._sync.next(event);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { ProductType } from \"../../../enums\";\nimport { OrganizationUserStatusType, OrganizationUserType, ProviderType } from \"../../enums\";\nimport { PermissionsApi } from \"../api/permissions.api\";\nimport { ProfileOrganizationResponse } from \"../response/profile-organization.response\";\n\nexport class OrganizationData {\n  id: string;\n  name: string;\n  status: OrganizationUserStatusType;\n  type: OrganizationUserType;\n  enabled: boolean;\n  usePolicies: boolean;\n  useGroups: boolean;\n  useDirectory: boolean;\n  useEvents: boolean;\n  useTotp: boolean;\n  use2fa: boolean;\n  useApi: boolean;\n  useSso: boolean;\n  useKeyConnector: boolean;\n  useScim: boolean;\n  useCustomPermissions: boolean;\n  useResetPassword: boolean;\n  useSecretsManager: boolean;\n  usePasswordManager: boolean;\n  useActivateAutofillPolicy: boolean;\n  selfHost: boolean;\n  usersGetPremium: boolean;\n  seats: number;\n  maxCollections: number;\n  maxStorageGb?: number;\n  ssoBound: boolean;\n  identifier: string;\n  permissions: PermissionsApi;\n  resetPasswordEnrolled: boolean;\n  userId: string;\n  hasPublicAndPrivateKeys: boolean;\n  providerId: string;\n  providerName: string;\n  providerType?: ProviderType;\n  isProviderUser: boolean;\n  isMember: boolean;\n  familySponsorshipFriendlyName: string;\n  familySponsorshipAvailable: boolean;\n  planProductType: ProductType;\n  keyConnectorEnabled: boolean;\n  keyConnectorUrl: string;\n  familySponsorshipLastSyncDate?: Date;\n  familySponsorshipValidUntil?: Date;\n  familySponsorshipToDelete?: boolean;\n  accessSecretsManager: boolean;\n  limitCollectionCreationDeletion: boolean;\n  allowAdminAccessToAllCollectionItems: boolean;\n  flexibleCollections: boolean;\n\n  constructor(\n    response?: ProfileOrganizationResponse,\n    options?: {\n      isMember: boolean;\n      isProviderUser: boolean;\n    },\n  ) {\n    if (response == null) {\n      return;\n    }\n\n    this.id = response.id;\n    this.name = response.name;\n    this.status = response.status;\n    this.type = response.type;\n    this.enabled = response.enabled;\n    this.usePolicies = response.usePolicies;\n    this.useGroups = response.useGroups;\n    this.useDirectory = response.useDirectory;\n    this.useEvents = response.useEvents;\n    this.useTotp = response.useTotp;\n    this.use2fa = response.use2fa;\n    this.useApi = response.useApi;\n    this.useSso = response.useSso;\n    this.useKeyConnector = response.useKeyConnector;\n    this.useScim = response.useScim;\n    this.useCustomPermissions = response.useCustomPermissions;\n    this.useResetPassword = response.useResetPassword;\n    this.useSecretsManager = response.useSecretsManager;\n    this.usePasswordManager = response.usePasswordManager;\n    this.useActivateAutofillPolicy = response.useActivateAutofillPolicy;\n    this.selfHost = response.selfHost;\n    this.usersGetPremium = response.usersGetPremium;\n    this.seats = response.seats;\n    this.maxCollections = response.maxCollections;\n    this.maxStorageGb = response.maxStorageGb;\n    this.ssoBound = response.ssoBound;\n    this.identifier = response.identifier;\n    this.permissions = response.permissions;\n    this.resetPasswordEnrolled = response.resetPasswordEnrolled;\n    this.userId = response.userId;\n    this.hasPublicAndPrivateKeys = response.hasPublicAndPrivateKeys;\n    this.providerId = response.providerId;\n    this.providerName = response.providerName;\n    this.providerType = response.providerType;\n    this.familySponsorshipFriendlyName = response.familySponsorshipFriendlyName;\n    this.familySponsorshipAvailable = response.familySponsorshipAvailable;\n    this.planProductType = response.planProductType;\n    this.keyConnectorEnabled = response.keyConnectorEnabled;\n    this.keyConnectorUrl = response.keyConnectorUrl;\n    this.familySponsorshipLastSyncDate = response.familySponsorshipLastSyncDate;\n    this.familySponsorshipValidUntil = response.familySponsorshipValidUntil;\n    this.familySponsorshipToDelete = response.familySponsorshipToDelete;\n    this.accessSecretsManager = response.accessSecretsManager;\n    this.limitCollectionCreationDeletion = response.limitCollectionCreationDeletion;\n    this.allowAdminAccessToAllCollectionItems = response.allowAdminAccessToAllCollectionItems;\n    this.flexibleCollections = response.flexibleCollections;\n\n    this.isMember = options.isMember;\n    this.isProviderUser = options.isProviderUser;\n  }\n\n  static fromJSON(obj: Jsonify<OrganizationData>) {\n    return Object.assign(new OrganizationData(), obj, {\n      familySponsorshipLastSyncDate:\n        obj.familySponsorshipLastSyncDate != null\n          ? new Date(obj.familySponsorshipLastSyncDate)\n          : obj.familySponsorshipLastSyncDate,\n      familySponsorshipValidUntil:\n        obj.familySponsorshipValidUntil != null\n          ? new Date(obj.familySponsorshipValidUntil)\n          : obj.familySponsorshipValidUntil,\n    });\n  }\n}\n","import { ProviderUserStatusType, ProviderUserType } from \"../../enums\";\nimport { ProfileProviderResponse } from \"../response/profile-provider.response\";\n\nexport class ProviderData {\n  id: string;\n  name: string;\n  status: ProviderUserStatusType;\n  type: ProviderUserType;\n  enabled: boolean;\n  userId: string;\n  useEvents: boolean;\n\n  constructor(response: ProfileProviderResponse) {\n    this.id = response.id;\n    this.name = response.name;\n    this.status = response.status;\n    this.type = response.type;\n    this.enabled = response.enabled;\n    this.userId = response.userId;\n    this.useEvents = response.useEvents;\n  }\n}\n","import { ApiService } from \"../../../abstractions/api.service\";\nimport { SettingsService } from \"../../../abstractions/settings.service\";\nimport { InternalOrganizationServiceAbstraction } from \"../../../admin-console/abstractions/organization/organization.service.abstraction\";\nimport { InternalPolicyService } from \"../../../admin-console/abstractions/policy/policy.service.abstraction\";\nimport { ProviderService } from \"../../../admin-console/abstractions/provider.service\";\nimport { OrganizationUserType } from \"../../../admin-console/enums\";\nimport { OrganizationData } from \"../../../admin-console/models/data/organization.data\";\nimport { PolicyData } from \"../../../admin-console/models/data/policy.data\";\nimport { ProviderData } from \"../../../admin-console/models/data/provider.data\";\nimport { PolicyResponse } from \"../../../admin-console/models/response/policy.response\";\nimport { KeyConnectorService } from \"../../../auth/abstractions/key-connector.service\";\nimport { ForceSetPasswordReason } from \"../../../auth/models/domain/force-set-password-reason\";\nimport { DomainsResponse } from \"../../../models/response/domains.response\";\nimport {\n  SyncCipherNotification,\n  SyncFolderNotification,\n  SyncSendNotification,\n} from \"../../../models/response/notification.response\";\nimport { ProfileResponse } from \"../../../models/response/profile.response\";\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { LogService } from \"../../../platform/abstractions/log.service\";\nimport { MessagingService } from \"../../../platform/abstractions/messaging.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { sequentialize } from \"../../../platform/misc/sequentialize\";\nimport { AccountDecryptionOptions } from \"../../../platform/models/domain/account\";\nimport { SendData } from \"../../../tools/send/models/data/send.data\";\nimport { SendResponse } from \"../../../tools/send/models/response/send.response\";\nimport { SendApiService } from \"../../../tools/send/services/send-api.service.abstraction\";\nimport { InternalSendService } from \"../../../tools/send/services/send.service.abstraction\";\nimport { CipherService } from \"../../../vault/abstractions/cipher.service\";\nimport { FolderApiServiceAbstraction } from \"../../../vault/abstractions/folder/folder-api.service.abstraction\";\nimport { InternalFolderService } from \"../../../vault/abstractions/folder/folder.service.abstraction\";\nimport { SyncService as SyncServiceAbstraction } from \"../../../vault/abstractions/sync/sync.service.abstraction\";\nimport { CipherData } from \"../../../vault/models/data/cipher.data\";\nimport { FolderData } from \"../../../vault/models/data/folder.data\";\nimport { CipherResponse } from \"../../../vault/models/response/cipher.response\";\nimport { FolderResponse } from \"../../../vault/models/response/folder.response\";\nimport { CollectionService } from \"../../abstractions/collection.service\";\nimport { CollectionData } from \"../../models/data/collection.data\";\nimport { CollectionDetailsResponse } from \"../../models/response/collection.response\";\n\nexport class SyncService implements SyncServiceAbstraction {\n  syncInProgress = false;\n\n  constructor(\n    private apiService: ApiService,\n    private settingsService: SettingsService,\n    private folderService: InternalFolderService,\n    private cipherService: CipherService,\n    private cryptoService: CryptoService,\n    private collectionService: CollectionService,\n    private messagingService: MessagingService,\n    private policyService: InternalPolicyService,\n    private sendService: InternalSendService,\n    private logService: LogService,\n    private keyConnectorService: KeyConnectorService,\n    private stateService: StateService,\n    private providerService: ProviderService,\n    private folderApiService: FolderApiServiceAbstraction,\n    private organizationService: InternalOrganizationServiceAbstraction,\n    private sendApiService: SendApiService,\n    private logoutCallback: (expired: boolean) => Promise<void>,\n  ) {}\n\n  async getLastSync(): Promise<Date> {\n    if ((await this.stateService.getUserId()) == null) {\n      return null;\n    }\n\n    const lastSync = await this.stateService.getLastSync();\n    if (lastSync) {\n      return new Date(lastSync);\n    }\n\n    return null;\n  }\n\n  async setLastSync(date: Date, userId?: string): Promise<any> {\n    await this.stateService.setLastSync(date.toJSON(), { userId: userId });\n  }\n\n  @sequentialize(() => \"fullSync\")\n  async fullSync(forceSync: boolean, allowThrowOnError = false): Promise<boolean> {\n    this.syncStarted();\n    const isAuthenticated = await this.stateService.getIsAuthenticated();\n    if (!isAuthenticated) {\n      return this.syncCompleted(false);\n    }\n\n    const now = new Date();\n    let needsSync = false;\n    try {\n      needsSync = await this.needsSyncing(forceSync);\n    } catch (e) {\n      if (allowThrowOnError) {\n        throw e;\n      }\n    }\n\n    if (!needsSync) {\n      await this.setLastSync(now);\n      return this.syncCompleted(false);\n    }\n\n    try {\n      await this.apiService.refreshIdentityToken();\n      const response = await this.apiService.getSync();\n\n      await this.syncProfile(response.profile);\n      await this.syncFolders(response.folders);\n      await this.syncCollections(response.collections);\n      await this.syncCiphers(response.ciphers);\n      await this.syncSends(response.sends);\n      await this.syncSettings(response.domains);\n      await this.syncPolicies(response.policies);\n\n      await this.setLastSync(now);\n      return this.syncCompleted(true);\n    } catch (e) {\n      if (allowThrowOnError) {\n        throw e;\n      } else {\n        return this.syncCompleted(false);\n      }\n    }\n  }\n\n  async syncUpsertFolder(notification: SyncFolderNotification, isEdit: boolean): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      try {\n        const localFolder = await this.folderService.get(notification.id);\n        if (\n          (!isEdit && localFolder == null) ||\n          (isEdit && localFolder != null && localFolder.revisionDate < notification.revisionDate)\n        ) {\n          const remoteFolder = await this.folderApiService.get(notification.id);\n          if (remoteFolder != null) {\n            await this.folderService.upsert(new FolderData(remoteFolder));\n            this.messagingService.send(\"syncedUpsertedFolder\", { folderId: notification.id });\n            return this.syncCompleted(true);\n          }\n        }\n      } catch (e) {\n        this.logService.error(e);\n      }\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncDeleteFolder(notification: SyncFolderNotification): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      await this.folderService.delete(notification.id);\n      this.messagingService.send(\"syncedDeletedFolder\", { folderId: notification.id });\n      this.syncCompleted(true);\n      return true;\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncUpsertCipher(notification: SyncCipherNotification, isEdit: boolean): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      try {\n        let shouldUpdate = true;\n        const localCipher = await this.cipherService.get(notification.id);\n        if (localCipher != null && localCipher.revisionDate >= notification.revisionDate) {\n          shouldUpdate = false;\n        }\n\n        let checkCollections = false;\n        if (shouldUpdate) {\n          if (isEdit) {\n            shouldUpdate = localCipher != null;\n            checkCollections = true;\n          } else {\n            if (notification.collectionIds == null || notification.organizationId == null) {\n              shouldUpdate = localCipher == null;\n            } else {\n              shouldUpdate = false;\n              checkCollections = true;\n            }\n          }\n        }\n\n        if (\n          !shouldUpdate &&\n          checkCollections &&\n          notification.organizationId != null &&\n          notification.collectionIds != null &&\n          notification.collectionIds.length > 0\n        ) {\n          const collections = await this.collectionService.getAll();\n          if (collections != null) {\n            for (let i = 0; i < collections.length; i++) {\n              if (notification.collectionIds.indexOf(collections[i].id) > -1) {\n                shouldUpdate = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (shouldUpdate) {\n          const remoteCipher = await this.apiService.getFullCipherDetails(notification.id);\n          if (remoteCipher != null) {\n            await this.cipherService.upsert(new CipherData(remoteCipher));\n            this.messagingService.send(\"syncedUpsertedCipher\", { cipherId: notification.id });\n            return this.syncCompleted(true);\n          }\n        }\n      } catch (e) {\n        if (e != null && e.statusCode === 404 && isEdit) {\n          await this.cipherService.delete(notification.id);\n          this.messagingService.send(\"syncedDeletedCipher\", { cipherId: notification.id });\n          return this.syncCompleted(true);\n        }\n      }\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncDeleteCipher(notification: SyncCipherNotification): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      await this.cipherService.delete(notification.id);\n      this.messagingService.send(\"syncedDeletedCipher\", { cipherId: notification.id });\n      return this.syncCompleted(true);\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncUpsertSend(notification: SyncSendNotification, isEdit: boolean): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      try {\n        const localSend = this.sendService.get(notification.id);\n        if (\n          (!isEdit && localSend == null) ||\n          (isEdit && localSend != null && localSend.revisionDate < notification.revisionDate)\n        ) {\n          const remoteSend = await this.sendApiService.getSend(notification.id);\n          if (remoteSend != null) {\n            await this.sendService.upsert(new SendData(remoteSend));\n            this.messagingService.send(\"syncedUpsertedSend\", { sendId: notification.id });\n            return this.syncCompleted(true);\n          }\n        }\n      } catch (e) {\n        this.logService.error(e);\n      }\n    }\n    return this.syncCompleted(false);\n  }\n\n  async syncDeleteSend(notification: SyncSendNotification): Promise<boolean> {\n    this.syncStarted();\n    if (await this.stateService.getIsAuthenticated()) {\n      await this.sendService.delete(notification.id);\n      this.messagingService.send(\"syncedDeletedSend\", { sendId: notification.id });\n      this.syncCompleted(true);\n      return true;\n    }\n    return this.syncCompleted(false);\n  }\n\n  // Helpers\n\n  private syncStarted() {\n    this.syncInProgress = true;\n    this.messagingService.send(\"syncStarted\");\n  }\n\n  private syncCompleted(successfully: boolean): boolean {\n    this.syncInProgress = false;\n    this.messagingService.send(\"syncCompleted\", { successfully: successfully });\n    return successfully;\n  }\n\n  private async needsSyncing(forceSync: boolean) {\n    if (forceSync) {\n      return true;\n    }\n\n    const lastSync = await this.getLastSync();\n    if (lastSync == null || lastSync.getTime() === 0) {\n      return true;\n    }\n\n    const response = await this.apiService.getAccountRevisionDate();\n    if (new Date(response) <= lastSync) {\n      return false;\n    }\n    return true;\n  }\n\n  private async syncProfile(response: ProfileResponse) {\n    const stamp = await this.stateService.getSecurityStamp();\n    if (stamp != null && stamp !== response.securityStamp) {\n      if (this.logoutCallback != null) {\n        await this.logoutCallback(true);\n      }\n\n      throw new Error(\"Stamp has changed\");\n    }\n\n    await this.cryptoService.setMasterKeyEncryptedUserKey(response.key);\n    await this.cryptoService.setPrivateKey(response.privateKey);\n    await this.cryptoService.setProviderKeys(response.providers);\n    await this.cryptoService.setOrgKeys(response.organizations, response.providerOrganizations);\n    await this.stateService.setAvatarColor(response.avatarColor);\n    await this.stateService.setSecurityStamp(response.securityStamp);\n    await this.stateService.setEmailVerified(response.emailVerified);\n    await this.stateService.setHasPremiumPersonally(response.premiumPersonally);\n    await this.stateService.setHasPremiumFromOrganization(response.premiumFromOrganization);\n    await this.keyConnectorService.setUsesKeyConnector(response.usesKeyConnector);\n\n    await this.setForceSetPasswordReasonIfNeeded(response);\n\n    const providers: { [id: string]: ProviderData } = {};\n    response.providers.forEach((p) => {\n      providers[p.id] = new ProviderData(p);\n    });\n\n    await this.providerService.save(providers);\n\n    await this.syncProfileOrganizations(response);\n\n    if (await this.keyConnectorService.userNeedsMigration()) {\n      await this.keyConnectorService.setConvertAccountRequired(true);\n      this.messagingService.send(\"convertAccountToKeyConnector\");\n    } else {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.keyConnectorService.removeConvertAccountRequired();\n    }\n  }\n\n  private async setForceSetPasswordReasonIfNeeded(profileResponse: ProfileResponse) {\n    // The `forcePasswordReset` flag indicates an admin has reset the user's password and must be updated\n    if (profileResponse.forcePasswordReset) {\n      await this.stateService.setForceSetPasswordReason(\n        ForceSetPasswordReason.AdminForcePasswordReset,\n      );\n    }\n\n    const acctDecryptionOpts: AccountDecryptionOptions =\n      await this.stateService.getAccountDecryptionOptions();\n\n    // Account decryption options should never be null or undefined b/c it is always initialized\n    // during the processing of the ID token response, but there might be a state issue\n    // where it is being overwritten with undefined affecting browser extension + FireFox users.\n    // TODO: Consider removing this once we figure out the root cause of the state issue or after the state provider refactor.\n    if (acctDecryptionOpts === null || acctDecryptionOpts === undefined) {\n      this.logService.error(\"Sync: Account decryption options are null or undefined.\");\n      // Early return as a bandaid to allow the rest of the sync to continue so users can access\n      // their data that they might have added from another device.\n      // Otherwise, trying to access properties on undefined below will throw an error.\n      return;\n    }\n\n    // Even though TDE users should only be in a single org (per single org policy), check\n    // through all orgs for the manageResetPassword permission. If they have it in any org,\n    // they should be forced to set a password.\n    let hasManageResetPasswordPermission = false;\n    for (const org of profileResponse.organizations) {\n      const isAdmin = org.type === OrganizationUserType.Admin;\n      const isOwner = org.type === OrganizationUserType.Owner;\n\n      // Note: apparently permissions only come down populated for custom roles.\n      if (isAdmin || isOwner || (org.permissions && org.permissions.manageResetPassword)) {\n        hasManageResetPasswordPermission = true;\n        break;\n      }\n    }\n\n    if (\n      acctDecryptionOpts.trustedDeviceOption !== undefined &&\n      !acctDecryptionOpts.hasMasterPassword &&\n      hasManageResetPasswordPermission\n    ) {\n      // TDE user w/out MP went from having no password reset permission to having it.\n      // Must set the force password reset reason so the auth guard will redirect to the set password page.\n      await this.stateService.setForceSetPasswordReason(\n        ForceSetPasswordReason.TdeUserWithoutPasswordHasPasswordResetPermission,\n      );\n    }\n  }\n\n  private async syncProfileOrganizations(response: ProfileResponse) {\n    const organizations: { [id: string]: OrganizationData } = {};\n    response.organizations.forEach((o) => {\n      organizations[o.id] = new OrganizationData(o, {\n        isMember: true,\n        isProviderUser: false,\n      });\n    });\n\n    response.providerOrganizations.forEach((o) => {\n      if (organizations[o.id] == null) {\n        organizations[o.id] = new OrganizationData(o, {\n          isMember: false,\n          isProviderUser: true,\n        });\n      } else {\n        organizations[o.id].isProviderUser = true;\n      }\n    });\n\n    await this.organizationService.replace(organizations);\n  }\n\n  private async syncFolders(response: FolderResponse[]) {\n    const folders: { [id: string]: FolderData } = {};\n    response.forEach((f) => {\n      folders[f.id] = new FolderData(f);\n    });\n    return await this.folderService.replace(folders);\n  }\n\n  private async syncCollections(response: CollectionDetailsResponse[]) {\n    const collections: { [id: string]: CollectionData } = {};\n    response.forEach((c) => {\n      collections[c.id] = new CollectionData(c);\n    });\n    return await this.collectionService.replace(collections);\n  }\n\n  private async syncCiphers(response: CipherResponse[]) {\n    const ciphers: { [id: string]: CipherData } = {};\n    response.forEach((c) => {\n      ciphers[c.id] = new CipherData(c);\n    });\n    return await this.cipherService.replace(ciphers);\n  }\n\n  private async syncSends(response: SendResponse[]) {\n    const sends: { [id: string]: SendData } = {};\n    response.forEach((s) => {\n      sends[s.id] = new SendData(s);\n    });\n    return await this.sendService.replace(sends);\n  }\n\n  private async syncSettings(response: DomainsResponse) {\n    let eqDomains: string[][] = [];\n    if (response != null && response.equivalentDomains != null) {\n      eqDomains = eqDomains.concat(response.equivalentDomains);\n    }\n\n    if (response != null && response.globalEquivalentDomains != null) {\n      response.globalEquivalentDomains.forEach((global) => {\n        if (global.domains.length > 0) {\n          eqDomains.push(global.domains);\n        }\n      });\n    }\n\n    return this.settingsService.setEquivalentDomains(eqDomains);\n  }\n\n  private async syncPolicies(response: PolicyResponse[]) {\n    const policies: { [id: string]: PolicyData } = {};\n    if (response != null) {\n      response.forEach((p) => {\n        policies[p.id] = new PolicyData(p);\n      });\n    }\n    return await this.policyService.replace(policies);\n  }\n}\n","import { CryptoFunctionService } from \"../../platform/abstractions/crypto-function.service\";\nimport { LogService } from \"../../platform/abstractions/log.service\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { TotpService as TotpServiceAbstraction } from \"../abstractions/totp.service\";\n\nconst B32Chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\";\nconst SteamChars = \"23456789BCDFGHJKMNPQRTVWXY\";\n\nexport class TotpService implements TotpServiceAbstraction {\n  constructor(\n    private cryptoFunctionService: CryptoFunctionService,\n    private logService: LogService,\n  ) {}\n\n  async getCode(key: string): Promise<string> {\n    if (key == null) {\n      return null;\n    }\n    let period = 30;\n    let alg: \"sha1\" | \"sha256\" | \"sha512\" = \"sha1\";\n    let digits = 6;\n    let keyB32 = key;\n    const isOtpAuth = key.toLowerCase().indexOf(\"otpauth://\") === 0;\n    const isSteamAuth = !isOtpAuth && key.toLowerCase().indexOf(\"steam://\") === 0;\n    if (isOtpAuth) {\n      const params = Utils.getQueryParams(key);\n      if (params.has(\"digits\") && params.get(\"digits\") != null) {\n        try {\n          const digitParams = parseInt(params.get(\"digits\").trim(), null);\n          if (digitParams > 10) {\n            digits = 10;\n          } else if (digitParams > 0) {\n            digits = digitParams;\n          }\n        } catch {\n          this.logService.error(\"Invalid digits param.\");\n        }\n      }\n      if (params.has(\"period\") && params.get(\"period\") != null) {\n        try {\n          const periodParam = parseInt(params.get(\"period\").trim(), null);\n          if (periodParam > 0) {\n            period = periodParam;\n          }\n        } catch {\n          this.logService.error(\"Invalid period param.\");\n        }\n      }\n      if (params.has(\"secret\") && params.get(\"secret\") != null) {\n        keyB32 = params.get(\"secret\");\n      }\n      if (params.has(\"algorithm\") && params.get(\"algorithm\") != null) {\n        const algParam = params.get(\"algorithm\").toLowerCase();\n        if (algParam === \"sha1\" || algParam === \"sha256\" || algParam === \"sha512\") {\n          alg = algParam;\n        }\n      }\n    } else if (isSteamAuth) {\n      keyB32 = key.substr(\"steam://\".length);\n      digits = 5;\n    }\n\n    const epoch = Math.round(new Date().getTime() / 1000.0);\n    const timeHex = this.leftPad(this.decToHex(Math.floor(epoch / period)), 16, \"0\");\n    const timeBytes = Utils.fromHexToArray(timeHex);\n    const keyBytes = this.b32ToBytes(keyB32);\n\n    if (!keyBytes.length || !timeBytes.length) {\n      return null;\n    }\n\n    const hash = await this.sign(keyBytes, timeBytes, alg);\n    if (hash.length === 0) {\n      return null;\n    }\n\n    const offset = hash[hash.length - 1] & 0xf;\n    const binary =\n      ((hash[offset] & 0x7f) << 24) |\n      ((hash[offset + 1] & 0xff) << 16) |\n      ((hash[offset + 2] & 0xff) << 8) |\n      (hash[offset + 3] & 0xff);\n\n    let otp = \"\";\n    if (isSteamAuth) {\n      let fullCode = binary & 0x7fffffff;\n      for (let i = 0; i < digits; i++) {\n        otp += SteamChars[fullCode % SteamChars.length];\n        fullCode = Math.trunc(fullCode / SteamChars.length);\n      }\n    } else {\n      otp = (binary % Math.pow(10, digits)).toString();\n      otp = this.leftPad(otp, digits, \"0\");\n    }\n\n    return otp;\n  }\n\n  getTimeInterval(key: string): number {\n    let period = 30;\n    if (key != null && key.toLowerCase().indexOf(\"otpauth://\") === 0) {\n      const params = Utils.getQueryParams(key);\n      if (params.has(\"period\") && params.get(\"period\") != null) {\n        try {\n          period = parseInt(params.get(\"period\").trim(), null);\n        } catch {\n          this.logService.error(\"Invalid period param.\");\n        }\n      }\n    }\n    return period;\n  }\n\n  // Helpers\n\n  private leftPad(s: string, l: number, p: string): string {\n    if (l + 1 >= s.length) {\n      s = Array(l + 1 - s.length).join(p) + s;\n    }\n    return s;\n  }\n\n  private decToHex(d: number): string {\n    return (d < 15.5 ? \"0\" : \"\") + Math.round(d).toString(16);\n  }\n\n  private b32ToHex(s: string): string {\n    s = s.toUpperCase();\n    let cleanedInput = \"\";\n\n    for (let i = 0; i < s.length; i++) {\n      if (B32Chars.indexOf(s[i]) < 0) {\n        continue;\n      }\n\n      cleanedInput += s[i];\n    }\n    s = cleanedInput;\n\n    let bits = \"\";\n    let hex = \"\";\n    for (let i = 0; i < s.length; i++) {\n      const byteIndex = B32Chars.indexOf(s.charAt(i));\n      if (byteIndex < 0) {\n        continue;\n      }\n      bits += this.leftPad(byteIndex.toString(2), 5, \"0\");\n    }\n    for (let i = 0; i + 4 <= bits.length; i += 4) {\n      const chunk = bits.substr(i, 4);\n      hex = hex + parseInt(chunk, 2).toString(16);\n    }\n    return hex;\n  }\n\n  private b32ToBytes(s: string): Uint8Array {\n    return Utils.fromHexToArray(this.b32ToHex(s));\n  }\n\n  private async sign(\n    keyBytes: Uint8Array,\n    timeBytes: Uint8Array,\n    alg: \"sha1\" | \"sha256\" | \"sha512\",\n  ) {\n    const signature = await this.cryptoFunctionService.hmac(timeBytes, keyBytes, alg);\n    return new Uint8Array(signature);\n  }\n}\n","import { VAULT_SETTINGS_DISK, KeyDefinition } from \"../../../platform/state\";\n\nexport const USER_ENABLE_PASSKEYS = new KeyDefinition<boolean>(\n  VAULT_SETTINGS_DISK,\n  \"enablePasskeys\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n","import { Observable, map } from \"rxjs\";\n\nimport { GlobalState, StateProvider } from \"../../../platform/state\";\nimport { VaultSettingsService as VaultSettingsServiceAbstraction } from \"../../abstractions/vault-settings/vault-settings.service\";\nimport { USER_ENABLE_PASSKEYS } from \"../key-state/enable-passkey.state\";\n\n/**\n * {@link VaultSettingsServiceAbstraction}\n */\nexport class VaultSettingsService implements VaultSettingsServiceAbstraction {\n  private enablePasskeysState: GlobalState<boolean> =\n    this.stateProvider.getGlobal(USER_ENABLE_PASSKEYS);\n\n  /**\n   * {@link VaultSettingsServiceAbstraction.enablePasskeys$}\n   */\n  readonly enablePasskeys$: Observable<boolean> = this.enablePasskeysState.state$.pipe(\n    map((x) => x ?? true),\n  );\n\n  constructor(private stateProvider: StateProvider) {}\n\n  /**\n   * {@link VaultSettingsServiceAbstraction.setEnablePasskeys}\n   */\n  async setEnablePasskeys(value: boolean): Promise<void> {\n    await this.enablePasskeysState.update(() => value);\n  }\n}\n","import { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { ImportCiphersRequest } from \"@bitwarden/common/models/request/import-ciphers.request\";\nimport { ImportOrganizationCiphersRequest } from \"@bitwarden/common/models/request/import-organization-ciphers.request\";\n\nimport { ImportApiServiceAbstraction } from \"./import-api.service.abstraction\";\n\nexport class ImportApiService implements ImportApiServiceAbstraction {\n  constructor(private apiService: ApiService) {}\n\n  async postImportCiphers(request: ImportCiphersRequest): Promise<any> {\n    return await this.apiService.send(\"POST\", \"/ciphers/import\", request, true, false);\n  }\n\n  async postImportOrganizationCiphers(\n    organizationId: string,\n    request: ImportOrganizationCiphersRequest,\n  ): Promise<any> {\n    return await this.apiService.send(\n      \"POST\",\n      \"/ciphers/import-organization?organizationId=\" + organizationId,\n      request,\n      true,\n      false,\n    );\n  }\n}\n","import { CipherRequest } from \"../../vault/models/request/cipher.request\";\nimport { FolderWithIdRequest } from \"../../vault/models/request/folder-with-id.request\";\n\nimport { KvpRequest } from \"./kvp.request\";\n\nexport class ImportCiphersRequest {\n  ciphers: CipherRequest[] = [];\n  folders: FolderWithIdRequest[] = [];\n  folderRelationships: KvpRequest<number, number>[] = [];\n}\n","import { CipherRequest } from \"../../vault/models/request/cipher.request\";\nimport { CollectionWithIdRequest } from \"../../vault/models/request/collection-with-id.request\";\n\nimport { KvpRequest } from \"./kvp.request\";\n\nexport class ImportOrganizationCiphersRequest {\n  ciphers: CipherRequest[] = [];\n  collections: CollectionWithIdRequest[] = [];\n  collectionRelationships: KvpRequest<number, number>[] = [];\n}\n","export class KvpRequest<TK, TV> {\n  key: TK;\n  value: TV;\n\n  constructor(key: TK, value: TV) {\n    this.key = key;\n    this.value = value;\n  }\n}\n","import { SelectionReadOnlyRequest } from \"../../../admin-console/models/request/selection-read-only.request\";\nimport { Collection } from \"../domain/collection\";\n\nexport class CollectionRequest {\n  name: string;\n  externalId: string;\n  groups: SelectionReadOnlyRequest[] = [];\n  users: SelectionReadOnlyRequest[] = [];\n\n  constructor(collection?: Collection) {\n    if (collection == null) {\n      return;\n    }\n    this.name = collection.name ? collection.name.encryptedString : null;\n    this.externalId = collection.externalId;\n  }\n}\n","import { Collection } from \"../domain/collection\";\n\nimport { CollectionRequest } from \"./collection.request\";\n\nexport class CollectionWithIdRequest extends CollectionRequest {\n  id: string;\n\n  constructor(collection?: Collection) {\n    if (collection == null) {\n      return;\n    }\n    super(collection);\n    this.id = collection.id;\n  }\n}\n","import { Folder } from \"../domain/folder\";\n\nimport { FolderRequest } from \"./folder.request\";\n\nexport class FolderWithIdRequest extends FolderRequest {\n  id: string;\n\n  constructor(folder: Folder) {\n    super(folder);\n    this.id = folder.id;\n  }\n}\n","import { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nexport class ImportResult {\n  success = false;\n  errorMessage: string;\n  ciphers: CipherView[] = [];\n  folders: FolderView[] = [];\n  folderRelationships: [number, number][] = [];\n  collections: CollectionView[] = [];\n  collectionRelationships: [number, number][] = [];\n}\n","import * as papa from \"papaparse\";\n\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { ConsoleLogService } from \"@bitwarden/common/platform/services/console-log.service\";\nimport { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FieldView } from \"@bitwarden/common/vault/models/view/field.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport { LoginUriView } from \"@bitwarden/common/vault/models/view/login-uri.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nexport abstract class BaseImporter {\n  organizationId: string = null;\n\n  protected logService: LogService = new ConsoleLogService(false);\n\n  protected newLineRegex = /(?:\\r\\n|\\r|\\n)/;\n\n  protected passwordFieldNames = [\n    \"password\",\n    \"pass word\",\n    \"passphrase\",\n    \"pass phrase\",\n    \"pass\",\n    \"code\",\n    \"code word\",\n    \"codeword\",\n    \"secret\",\n    \"secret word\",\n    \"personpwd\",\n    \"key\",\n    \"keyword\",\n    \"key word\",\n    \"keyphrase\",\n    \"key phrase\",\n    \"form_pw\",\n    \"wppassword\",\n    \"pin\",\n    \"pwd\",\n    \"pw\",\n    \"pword\",\n    \"passwd\",\n    \"p\",\n    \"serial\",\n    \"serial#\",\n    \"license key\",\n    \"reg #\",\n\n    // Non-English names\n    \"passwort\",\n  ];\n\n  protected usernameFieldNames = [\n    \"user\",\n    \"name\",\n    \"user name\",\n    \"username\",\n    \"login name\",\n    \"email\",\n    \"e-mail\",\n    \"id\",\n    \"userid\",\n    \"user id\",\n    \"login\",\n    \"form_loginname\",\n    \"wpname\",\n    \"mail\",\n    \"loginid\",\n    \"login id\",\n    \"log\",\n    \"personlogin\",\n    \"first name\",\n    \"last name\",\n    \"card#\",\n    \"account #\",\n    \"member\",\n    \"member #\",\n\n    // Non-English names\n    \"nom\",\n    \"benutzername\",\n  ];\n\n  protected notesFieldNames = [\n    \"note\",\n    \"notes\",\n    \"comment\",\n    \"comments\",\n    \"memo\",\n    \"description\",\n    \"free form\",\n    \"freeform\",\n    \"free text\",\n    \"freetext\",\n    \"free\",\n\n    // Non-English names\n    \"kommentar\",\n  ];\n\n  protected uriFieldNames: string[] = [\n    \"url\",\n    \"hyper link\",\n    \"hyperlink\",\n    \"link\",\n    \"host\",\n    \"hostname\",\n    \"host name\",\n    \"server\",\n    \"address\",\n    \"hyper ref\",\n    \"href\",\n    \"web\",\n    \"website\",\n    \"web site\",\n    \"site\",\n    \"web-site\",\n    \"uri\",\n\n    // Non-English names\n    \"ort\",\n    \"adresse\",\n  ];\n\n  protected parseCsvOptions = {\n    encoding: \"UTF-8\",\n    skipEmptyLines: false,\n  };\n\n  protected get organization() {\n    return this.organizationId != null;\n  }\n\n  protected parseXml(data: string): Document {\n    // Ensure there are no external entity elements in the XML to prevent against XXE attacks.\n    if (!this.validateNoExternalEntities(data)) {\n      return null;\n    }\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(data, \"application/xml\");\n    return doc != null && doc.querySelector(\"parsererror\") == null ? doc : null;\n  }\n\n  protected parseCsv(data: string, header: boolean, options: any = {}): any[] {\n    const parseOptions: papa.ParseConfig<string> = Object.assign(\n      { header: header },\n      this.parseCsvOptions,\n      options,\n    );\n    data = this.splitNewLine(data).join(\"\\n\").trim();\n    const result = papa.parse(data, parseOptions);\n    if (result.errors != null && result.errors.length > 0) {\n      result.errors.forEach((e) => {\n        if (e.row != null) {\n          this.logService.warning(\"Error parsing row \" + e.row + \": \" + e.message);\n        }\n      });\n    }\n    return result.data && result.data.length > 0 ? result.data : null;\n  }\n\n  protected parseSingleRowCsv(rowData: string) {\n    if (this.isNullOrWhitespace(rowData)) {\n      return null;\n    }\n    const parsedRow = this.parseCsv(rowData, false);\n    if (parsedRow != null && parsedRow.length > 0 && parsedRow[0].length > 0) {\n      return parsedRow[0];\n    }\n    return null;\n  }\n\n  protected makeUriArray(uri: string | string[]): LoginUriView[] {\n    if (uri == null) {\n      return null;\n    }\n\n    if (typeof uri === \"string\") {\n      const loginUri = new LoginUriView();\n      loginUri.uri = this.fixUri(uri);\n      if (this.isNullOrWhitespace(loginUri.uri)) {\n        return null;\n      }\n      loginUri.match = null;\n      return [loginUri];\n    }\n\n    if (uri.length > 0) {\n      const returnArr: LoginUriView[] = [];\n      uri.forEach((u) => {\n        const loginUri = new LoginUriView();\n        loginUri.uri = this.fixUri(u);\n        if (this.isNullOrWhitespace(loginUri.uri)) {\n          return;\n        }\n        loginUri.match = null;\n        returnArr.push(loginUri);\n      });\n      return returnArr.length === 0 ? null : returnArr;\n    }\n\n    return null;\n  }\n\n  protected fixUri(uri: string) {\n    if (uri == null) {\n      return null;\n    }\n    uri = uri.trim();\n    if (uri.indexOf(\"://\") === -1 && uri.indexOf(\".\") >= 0) {\n      uri = \"http://\" + uri;\n    }\n    if (uri.length > 1000) {\n      return uri.substring(0, 1000);\n    }\n    return uri;\n  }\n\n  protected nameFromUrl(url: string) {\n    const hostname = Utils.getHostname(url);\n    if (this.isNullOrWhitespace(hostname)) {\n      return null;\n    }\n    return hostname.startsWith(\"www.\") ? hostname.replace(\"www.\", \"\") : hostname;\n  }\n\n  protected isNullOrWhitespace(str: string): boolean {\n    return Utils.isNullOrWhitespace(str);\n  }\n\n  protected getValueOrDefault(str: string, defaultValue: string = null): string {\n    if (this.isNullOrWhitespace(str)) {\n      return defaultValue;\n    }\n    return str;\n  }\n\n  protected splitNewLine(str: string): string[] {\n    return str.split(this.newLineRegex);\n  }\n\n  protected setCardExpiration(cipher: CipherView, expiration: string): boolean {\n    if (this.isNullOrWhitespace(expiration)) {\n      return false;\n    }\n\n    expiration = expiration.replace(/\\s/g, \"\");\n\n    const monthRegex = \"0?(?<month>[1-9]|1[0-2])\";\n    const yearRegex = \"(?<year>(?:[1-2][0-9])?[0-9]{2})\";\n    const expiryRegex = new RegExp(`^${monthRegex}/${yearRegex}$`);\n\n    const expiryMatch = expiration.match(expiryRegex);\n\n    if (!expiryMatch) {\n      return false;\n    }\n\n    cipher.card.expMonth = expiryMatch.groups.month;\n    const year: string = expiryMatch.groups.year;\n    cipher.card.expYear = year.length === 2 ? \"20\" + year : year;\n    return true;\n  }\n\n  protected moveFoldersToCollections(result: ImportResult) {\n    result.folderRelationships.forEach((r) => result.collectionRelationships.push(r));\n    result.collections = result.folders.map((f) => {\n      const collection = new CollectionView();\n      collection.name = f.name;\n      collection.id = f.id;\n      return collection;\n    });\n    result.folderRelationships = [];\n    result.folders = [];\n  }\n\n  protected querySelectorDirectChild(parentEl: Element, query: string) {\n    const els = this.querySelectorAllDirectChild(parentEl, query);\n    return els.length === 0 ? null : els[0];\n  }\n\n  protected querySelectorAllDirectChild(parentEl: Element, query: string) {\n    return Array.from(parentEl.querySelectorAll(query)).filter((el) => el.parentNode === parentEl);\n  }\n\n  protected initLoginCipher() {\n    const cipher = new CipherView();\n    cipher.favorite = false;\n    cipher.notes = \"\";\n    cipher.fields = [];\n    cipher.login = new LoginView();\n    cipher.type = CipherType.Login;\n    return cipher;\n  }\n\n  protected cleanupCipher(cipher: CipherView) {\n    if (cipher == null) {\n      return;\n    }\n    if (cipher.type !== CipherType.Login) {\n      cipher.login = null;\n    }\n    if (this.isNullOrWhitespace(cipher.name)) {\n      cipher.name = \"--\";\n    }\n    if (this.isNullOrWhitespace(cipher.notes)) {\n      cipher.notes = null;\n    } else {\n      cipher.notes = cipher.notes.trim();\n    }\n    if (cipher.fields != null && cipher.fields.length === 0) {\n      cipher.fields = null;\n    }\n    if (cipher.passwordHistory != null && cipher.passwordHistory.length === 0) {\n      cipher.passwordHistory = null;\n    }\n  }\n\n  protected processKvp(\n    cipher: CipherView,\n    key: string,\n    value: string,\n    type: FieldType = FieldType.Text,\n  ) {\n    if (this.isNullOrWhitespace(value)) {\n      return;\n    }\n    if (this.isNullOrWhitespace(key)) {\n      key = \"\";\n    }\n    if (value.length > 200 || value.trim().search(this.newLineRegex) > -1) {\n      if (cipher.notes == null) {\n        cipher.notes = \"\";\n      }\n      cipher.notes += key + \": \" + this.splitNewLine(value).join(\"\\n\") + \"\\n\";\n    } else {\n      if (cipher.fields == null) {\n        cipher.fields = [];\n      }\n      const field = new FieldView();\n      field.type = type;\n      field.name = key;\n      field.value = value;\n      cipher.fields.push(field);\n    }\n  }\n\n  protected processFolder(\n    result: ImportResult,\n    folderName: string,\n    addRelationship: boolean = true,\n  ) {\n    if (this.isNullOrWhitespace(folderName)) {\n      return;\n    }\n\n    let folderIndex = result.folders.length;\n    // Replace backslashes with forward slashes, ensuring we create sub-folders\n    folderName = folderName.replace(\"\\\\\", \"/\");\n    let addFolder = true;\n\n    for (let i = 0; i < result.folders.length; i++) {\n      if (result.folders[i].name === folderName) {\n        addFolder = false;\n        folderIndex = i;\n        break;\n      }\n    }\n\n    if (addFolder) {\n      const f = new FolderView();\n      f.name = folderName;\n      result.folders.push(f);\n    }\n\n    //Some folders can have sub-folders but no ciphers directly, we should not add to the folderRelationships array\n    if (addRelationship) {\n      result.folderRelationships.push([result.ciphers.length, folderIndex]);\n    }\n  }\n\n  protected convertToNoteIfNeeded(cipher: CipherView) {\n    if (\n      cipher.type === CipherType.Login &&\n      this.isNullOrWhitespace(cipher.login.username) &&\n      this.isNullOrWhitespace(cipher.login.password) &&\n      (cipher.login.uris == null || cipher.login.uris.length === 0)\n    ) {\n      cipher.type = CipherType.SecureNote;\n      cipher.secureNote = new SecureNoteView();\n      cipher.secureNote.type = SecureNoteType.Generic;\n    }\n  }\n\n  protected processFullName(cipher: CipherView, fullName: string) {\n    if (this.isNullOrWhitespace(fullName)) {\n      return;\n    }\n\n    const nameParts = fullName.split(\" \");\n    if (nameParts.length > 0) {\n      cipher.identity.firstName = this.getValueOrDefault(nameParts[0]);\n    }\n    if (nameParts.length === 2) {\n      cipher.identity.lastName = this.getValueOrDefault(nameParts[1]);\n    } else if (nameParts.length >= 3) {\n      cipher.identity.middleName = this.getValueOrDefault(nameParts[1]);\n      cipher.identity.lastName = nameParts.slice(2, nameParts.length).join(\" \");\n    }\n  }\n\n  private validateNoExternalEntities(data: string): boolean {\n    const regex = new RegExp(\"<!ENTITY\", \"i\");\n    const hasExternalEntities = regex.test(data);\n    return !hasExternalEntities;\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class AscendoCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 2) {\n        return;\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value[value.length - 1]);\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n\n      if (value.length > 2 && value.length % 2 === 0) {\n        for (let i = 0; i < value.length - 2; i += 2) {\n          const val: string = value[i + 2];\n          const field: string = value[i + 1];\n          if (this.isNullOrWhitespace(val) || this.isNullOrWhitespace(field)) {\n            continue;\n          }\n\n          const fieldLower = field.toLowerCase();\n          if (cipher.login.password == null && this.passwordFieldNames.indexOf(fieldLower) > -1) {\n            cipher.login.password = this.getValueOrDefault(val);\n          } else if (\n            cipher.login.username == null &&\n            this.usernameFieldNames.indexOf(fieldLower) > -1\n          ) {\n            cipher.login.username = this.getValueOrDefault(val);\n          } else if (\n            (cipher.login.uris == null || cipher.login.uris.length === 0) &&\n            this.uriFieldNames.indexOf(fieldLower) > -1\n          ) {\n            cipher.login.uris = this.makeUriArray(val);\n          } else {\n            this.processKvp(cipher, field, val);\n          }\n        }\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class AvastCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.name);\n      cipher.login.uris = this.makeUriArray(value.web);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.username = this.getValueOrDefault(value.login);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class AvastJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    if (results.logins != null) {\n      results.logins.forEach((value: any) => {\n        const cipher = this.initLoginCipher();\n        cipher.name = this.getValueOrDefault(value.custName);\n        cipher.notes = this.getValueOrDefault(value.note);\n        cipher.login.uris = this.makeUriArray(value.url);\n        cipher.login.password = this.getValueOrDefault(value.pwd);\n        cipher.login.username = this.getValueOrDefault(value.loginName);\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n    }\n\n    if (results.notes != null) {\n      results.notes.forEach((value: any) => {\n        const cipher = this.initLoginCipher();\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote.type = SecureNoteType.Generic;\n        cipher.name = this.getValueOrDefault(value.label);\n        cipher.notes = this.getValueOrDefault(value.text);\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n    }\n\n    if (results.cards != null) {\n      results.cards.forEach((value: any) => {\n        const cipher = this.initLoginCipher();\n        cipher.type = CipherType.Card;\n        cipher.name = this.getValueOrDefault(value.custName);\n        cipher.notes = this.getValueOrDefault(value.note);\n        cipher.card.cardholderName = this.getValueOrDefault(value.holderName);\n        cipher.card.number = this.getValueOrDefault(value.cardNumber);\n        cipher.card.code = this.getValueOrDefault(value.cvv);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        if (value.expirationDate != null) {\n          if (value.expirationDate.month != null) {\n            cipher.card.expMonth = value.expirationDate.month + \"\";\n          }\n          if (value.expirationDate.year != null) {\n            cipher.card.expYear = value.expirationDate.year + \"\";\n          }\n        }\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class AviraCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(\n        value.name,\n        this.getValueOrDefault(this.nameFromUrl(value.website), \"--\"),\n      );\n      cipher.login.uris = this.makeUriArray(value.website);\n      cipher.login.password = this.getValueOrDefault(value.password);\n\n      if (\n        this.isNullOrWhitespace(value.username) &&\n        !this.isNullOrWhitespace(value.secondary_username)\n      ) {\n        cipher.login.username = value.secondary_username;\n      } else {\n        cipher.login.username = this.getValueOrDefault(value.username);\n        cipher.notes = this.getValueOrDefault(value.secondary_username);\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class BlackBerryCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.grouping === \"list\") {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.favorite = value.fav === \"1\";\n      cipher.name = this.getValueOrDefault(value.name);\n      cipher.notes = this.getValueOrDefault(value.extra);\n      if (value.grouping !== \"note\") {\n        cipher.login.uris = this.makeUriArray(value.url);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.username = this.getValueOrDefault(value.username);\n      }\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class ChromeCsvImporter extends BaseImporter implements Importer {\n  private androidPatternRegex = new RegExp(\"^android:\\\\/\\\\/.*(?<=@)(.*)(?=\\\\/)\");\n\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      let name = value.name;\n      if (!name && this.androidPatternRegex.test(value.url)) {\n        name = value.url.match(this.androidPatternRegex)[1];\n      }\n      cipher.name = this.getValueOrDefault(name, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.username);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.uris = this.makeUriArray(value.url);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRepromptType } from \"@bitwarden/common/vault/enums/cipher-reprompt-type\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FieldView } from \"@bitwarden/common/vault/models/view/field.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class BitwardenCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (this.organization && !this.isNullOrWhitespace(value.collections)) {\n        const collections = (value.collections as string).split(\",\");\n        collections.forEach((col) => {\n          let addCollection = true;\n          let collectionIndex = result.collections.length;\n\n          for (let i = 0; i < result.collections.length; i++) {\n            if (result.collections[i].name === col) {\n              addCollection = false;\n              collectionIndex = i;\n              break;\n            }\n          }\n\n          if (addCollection) {\n            const collection = new CollectionView();\n            collection.name = col;\n            result.collections.push(collection);\n          }\n\n          result.collectionRelationships.push([result.ciphers.length, collectionIndex]);\n        });\n      } else if (!this.organization) {\n        this.processFolder(result, value.folder);\n      }\n\n      const cipher = new CipherView();\n      cipher.favorite =\n        !this.organization && this.getValueOrDefault(value.favorite, \"0\") !== \"0\" ? true : false;\n      cipher.type = CipherType.Login;\n      cipher.notes = this.getValueOrDefault(value.notes);\n      cipher.name = this.getValueOrDefault(value.name, \"--\");\n      try {\n        cipher.reprompt = parseInt(\n          this.getValueOrDefault(value.reprompt, CipherRepromptType.None.toString()),\n          10,\n        );\n      } catch (e) {\n        // eslint-disable-next-line\n        console.error(\"Unable to parse reprompt value\", e);\n        cipher.reprompt = CipherRepromptType.None;\n      }\n\n      if (!this.isNullOrWhitespace(value.fields)) {\n        const fields = this.splitNewLine(value.fields);\n        for (let i = 0; i < fields.length; i++) {\n          if (this.isNullOrWhitespace(fields[i])) {\n            continue;\n          }\n\n          const delimPosition = fields[i].lastIndexOf(\": \");\n          if (delimPosition === -1) {\n            continue;\n          }\n\n          if (cipher.fields == null) {\n            cipher.fields = [];\n          }\n\n          const field = new FieldView();\n          field.name = fields[i].substr(0, delimPosition);\n          field.value = null;\n          field.type = FieldType.Text;\n          if (fields[i].length > delimPosition + 2) {\n            field.value = fields[i].substr(delimPosition + 2);\n          }\n          cipher.fields.push(field);\n        }\n      }\n\n      const valueType = value.type != null ? value.type.toLowerCase() : null;\n      switch (valueType) {\n        case \"note\":\n          cipher.type = CipherType.SecureNote;\n          cipher.secureNote = new SecureNoteView();\n          cipher.secureNote.type = SecureNoteType.Generic;\n          break;\n        default: {\n          cipher.type = CipherType.Login;\n          cipher.login = new LoginView();\n          cipher.login.totp = this.getValueOrDefault(value.login_totp || value.totp);\n          cipher.login.username = this.getValueOrDefault(value.login_username || value.username);\n          cipher.login.password = this.getValueOrDefault(value.login_password || value.password);\n          const uris = this.parseSingleRowCsv(value.login_uri || value.uri);\n          cipher.login.uris = this.makeUriArray(uris);\n          break;\n        }\n      }\n\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Card as CardDomain } from \"../../vault/models/domain/card\";\nimport { CardView } from \"../../vault/models/view/card.view\";\n\nexport class CardExport {\n  static template(): CardExport {\n    const req = new CardExport();\n    req.cardholderName = \"John Doe\";\n    req.brand = \"visa\";\n    req.number = \"4242424242424242\";\n    req.expMonth = \"04\";\n    req.expYear = \"2023\";\n    req.code = \"123\";\n    return req;\n  }\n\n  static toView(req: CardExport, view = new CardView()) {\n    view.cardholderName = req.cardholderName;\n    view.brand = req.brand;\n    view.number = req.number;\n    view.expMonth = req.expMonth;\n    view.expYear = req.expYear;\n    view.code = req.code;\n    return view;\n  }\n\n  static toDomain(req: CardExport, domain = new CardDomain()) {\n    domain.cardholderName = req.cardholderName != null ? new EncString(req.cardholderName) : null;\n    domain.brand = req.brand != null ? new EncString(req.brand) : null;\n    domain.number = req.number != null ? new EncString(req.number) : null;\n    domain.expMonth = req.expMonth != null ? new EncString(req.expMonth) : null;\n    domain.expYear = req.expYear != null ? new EncString(req.expYear) : null;\n    domain.code = req.code != null ? new EncString(req.code) : null;\n    return domain;\n  }\n\n  cardholderName: string;\n  brand: string;\n  number: string;\n  expMonth: string;\n  expYear: string;\n  code: string;\n\n  constructor(o?: CardView | CardDomain) {\n    if (o == null) {\n      return;\n    }\n\n    if (o instanceof CardView) {\n      this.cardholderName = o.cardholderName;\n      this.brand = o.brand;\n      this.number = o.number;\n      this.expMonth = o.expMonth;\n      this.expYear = o.expYear;\n      this.code = o.code;\n    } else {\n      this.cardholderName = o.cardholderName?.encryptedString;\n      this.brand = o.brand?.encryptedString;\n      this.number = o.number?.encryptedString;\n      this.expMonth = o.expMonth?.encryptedString;\n      this.expYear = o.expYear?.encryptedString;\n      this.code = o.code?.encryptedString;\n    }\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { FieldType, LinkedIdType } from \"../../vault/enums\";\nimport { Field as FieldDomain } from \"../../vault/models/domain/field\";\nimport { FieldView } from \"../../vault/models/view/field.view\";\n\nexport class FieldExport {\n  static template(): FieldExport {\n    const req = new FieldExport();\n    req.name = \"Field name\";\n    req.value = \"Some value\";\n    req.type = FieldType.Text;\n    return req;\n  }\n\n  static toView(req: FieldExport, view = new FieldView()) {\n    view.type = req.type;\n    view.value = req.value;\n    view.name = req.name;\n    view.linkedId = req.linkedId;\n    return view;\n  }\n\n  static toDomain(req: FieldExport, domain = new FieldDomain()) {\n    domain.type = req.type;\n    domain.value = req.value != null ? new EncString(req.value) : null;\n    domain.name = req.name != null ? new EncString(req.name) : null;\n    domain.linkedId = req.linkedId;\n    return domain;\n  }\n\n  name: string;\n  value: string;\n  type: FieldType;\n  linkedId: LinkedIdType;\n\n  constructor(o?: FieldView | FieldDomain) {\n    if (o == null) {\n      return;\n    }\n\n    if (o instanceof FieldView) {\n      this.name = o.name;\n      this.value = o.value;\n    } else {\n      this.name = o.name?.encryptedString;\n      this.value = o.value?.encryptedString;\n    }\n    this.type = o.type;\n    this.linkedId = o.linkedId;\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Identity as IdentityDomain } from \"../../vault/models/domain/identity\";\nimport { IdentityView } from \"../../vault/models/view/identity.view\";\n\nexport class IdentityExport {\n  static template(): IdentityExport {\n    const req = new IdentityExport();\n    req.title = \"Mr\";\n    req.firstName = \"John\";\n    req.middleName = \"William\";\n    req.lastName = \"Doe\";\n    req.address1 = \"123 Any St\";\n    req.address2 = \"Apt #123\";\n    req.address3 = null;\n    req.city = \"New York\";\n    req.state = \"NY\";\n    req.postalCode = \"10001\";\n    req.country = \"US\";\n    req.company = \"Acme Inc.\";\n    req.email = \"john@company.com\";\n    req.phone = \"5555551234\";\n    req.ssn = \"000-123-4567\";\n    req.username = \"jdoe\";\n    req.passportNumber = \"US-123456789\";\n    req.licenseNumber = \"D123-12-123-12333\";\n    return req;\n  }\n\n  static toView(req: IdentityExport, view = new IdentityView()) {\n    view.title = req.title;\n    view.firstName = req.firstName;\n    view.middleName = req.middleName;\n    view.lastName = req.lastName;\n    view.address1 = req.address1;\n    view.address2 = req.address2;\n    view.address3 = req.address3;\n    view.city = req.city;\n    view.state = req.state;\n    view.postalCode = req.postalCode;\n    view.country = req.country;\n    view.company = req.company;\n    view.email = req.email;\n    view.phone = req.phone;\n    view.ssn = req.ssn;\n    view.username = req.username;\n    view.passportNumber = req.passportNumber;\n    view.licenseNumber = req.licenseNumber;\n    return view;\n  }\n\n  static toDomain(req: IdentityExport, domain = new IdentityDomain()) {\n    domain.title = req.title != null ? new EncString(req.title) : null;\n    domain.firstName = req.firstName != null ? new EncString(req.firstName) : null;\n    domain.middleName = req.middleName != null ? new EncString(req.middleName) : null;\n    domain.lastName = req.lastName != null ? new EncString(req.lastName) : null;\n    domain.address1 = req.address1 != null ? new EncString(req.address1) : null;\n    domain.address2 = req.address2 != null ? new EncString(req.address2) : null;\n    domain.address3 = req.address3 != null ? new EncString(req.address3) : null;\n    domain.city = req.city != null ? new EncString(req.city) : null;\n    domain.state = req.state != null ? new EncString(req.state) : null;\n    domain.postalCode = req.postalCode != null ? new EncString(req.postalCode) : null;\n    domain.country = req.country != null ? new EncString(req.country) : null;\n    domain.company = req.company != null ? new EncString(req.company) : null;\n    domain.email = req.email != null ? new EncString(req.email) : null;\n    domain.phone = req.phone != null ? new EncString(req.phone) : null;\n    domain.ssn = req.ssn != null ? new EncString(req.ssn) : null;\n    domain.username = req.username != null ? new EncString(req.username) : null;\n    domain.passportNumber = req.passportNumber != null ? new EncString(req.passportNumber) : null;\n    domain.licenseNumber = req.licenseNumber != null ? new EncString(req.licenseNumber) : null;\n    return domain;\n  }\n\n  title: string;\n  firstName: string;\n  middleName: string;\n  lastName: string;\n  address1: string;\n  address2: string;\n  address3: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n  company: string;\n  email: string;\n  phone: string;\n  ssn: string;\n  username: string;\n  passportNumber: string;\n  licenseNumber: string;\n\n  constructor(o?: IdentityView | IdentityDomain) {\n    if (o == null) {\n      return;\n    }\n\n    if (o instanceof IdentityView) {\n      this.title = o.title;\n      this.firstName = o.firstName;\n      this.middleName = o.middleName;\n      this.lastName = o.lastName;\n      this.address1 = o.address1;\n      this.address2 = o.address2;\n      this.address3 = o.address3;\n      this.city = o.city;\n      this.state = o.state;\n      this.postalCode = o.postalCode;\n      this.country = o.country;\n      this.company = o.company;\n      this.email = o.email;\n      this.phone = o.phone;\n      this.ssn = o.ssn;\n      this.username = o.username;\n      this.passportNumber = o.passportNumber;\n      this.licenseNumber = o.licenseNumber;\n    } else {\n      this.title = o.title?.encryptedString;\n      this.firstName = o.firstName?.encryptedString;\n      this.middleName = o.middleName?.encryptedString;\n      this.lastName = o.lastName?.encryptedString;\n      this.address1 = o.address1?.encryptedString;\n      this.address2 = o.address2?.encryptedString;\n      this.address3 = o.address3?.encryptedString;\n      this.city = o.city?.encryptedString;\n      this.state = o.state?.encryptedString;\n      this.postalCode = o.postalCode?.encryptedString;\n      this.country = o.country?.encryptedString;\n      this.company = o.company?.encryptedString;\n      this.email = o.email?.encryptedString;\n      this.phone = o.phone?.encryptedString;\n      this.ssn = o.ssn?.encryptedString;\n      this.username = o.username?.encryptedString;\n      this.passportNumber = o.passportNumber?.encryptedString;\n      this.licenseNumber = o.licenseNumber?.encryptedString;\n    }\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Fido2Credential } from \"../../vault/models/domain/fido2-credential\";\nimport { Fido2CredentialView } from \"../../vault/models/view/fido2-credential.view\";\n\n/**\n * Represents format of Fido2 Credentials in JSON exports.\n */\nexport class Fido2CredentialExport {\n  /**\n   * Generates a template for Fido2CredentialExport\n   * @returns Instance of Fido2CredentialExport with predefined values.\n   */\n  static template(): Fido2CredentialExport {\n    const req = new Fido2CredentialExport();\n    req.credentialId = \"keyId\";\n    req.keyType = \"keyType\";\n    req.keyAlgorithm = \"keyAlgorithm\";\n    req.keyCurve = \"keyCurve\";\n    req.keyValue = \"keyValue\";\n    req.rpId = \"rpId\";\n    req.userHandle = \"userHandle\";\n    req.userName = \"userName\";\n    req.counter = \"counter\";\n    req.rpName = \"rpName\";\n    req.userDisplayName = \"userDisplayName\";\n    req.discoverable = \"false\";\n    req.creationDate = null;\n    return req;\n  }\n\n  /**\n   * Converts a Fido2CredentialExport object to its view representation.\n   * @param req - The Fido2CredentialExport object to be converted.\n   * @param view - (Optional) The Fido2CredentialView object to popualte with Fido2CredentialExport data\n   * @returns Fido2CredentialView - The populated view, or a new instance if none was provided.\n   */\n  static toView(req: Fido2CredentialExport, view = new Fido2CredentialView()) {\n    view.credentialId = req.credentialId;\n    view.keyType = req.keyType as \"public-key\";\n    view.keyAlgorithm = req.keyAlgorithm as \"ECDSA\";\n    view.keyCurve = req.keyCurve as \"P-256\";\n    view.keyValue = req.keyValue;\n    view.rpId = req.rpId;\n    view.userHandle = req.userHandle;\n    view.userName = req.userName;\n    view.counter = parseInt(req.counter);\n    view.rpName = req.rpName;\n    view.userDisplayName = req.userDisplayName;\n    view.discoverable = req.discoverable === \"true\";\n    view.creationDate = new Date(req.creationDate);\n    return view;\n  }\n\n  /**\n   * Converts a Fido2CredentialExport object to its domain representation.\n   * @param req - The Fido2CredentialExport object to be converted.\n   * @param domain - (Optional) The Fido2Credential object to popualte with Fido2CredentialExport data\n   * @returns Fido2Credential - The populated domain, or a new instance if none was provided.\n   */\n  static toDomain(req: Fido2CredentialExport, domain = new Fido2Credential()) {\n    domain.credentialId = req.credentialId != null ? new EncString(req.credentialId) : null;\n    domain.keyType = req.keyType != null ? new EncString(req.keyType) : null;\n    domain.keyAlgorithm = req.keyAlgorithm != null ? new EncString(req.keyAlgorithm) : null;\n    domain.keyCurve = req.keyCurve != null ? new EncString(req.keyCurve) : null;\n    domain.keyValue = req.keyValue != null ? new EncString(req.keyValue) : null;\n    domain.rpId = req.rpId != null ? new EncString(req.rpId) : null;\n    domain.userHandle = req.userHandle != null ? new EncString(req.userHandle) : null;\n    domain.userName = req.userName != null ? new EncString(req.userName) : null;\n    domain.counter = req.counter != null ? new EncString(req.counter) : null;\n    domain.rpName = req.rpName != null ? new EncString(req.rpName) : null;\n    domain.userDisplayName =\n      req.userDisplayName != null ? new EncString(req.userDisplayName) : null;\n    domain.discoverable = req.discoverable != null ? new EncString(req.discoverable) : null;\n    domain.creationDate = req.creationDate;\n    return domain;\n  }\n\n  credentialId: string;\n  keyType: string;\n  keyAlgorithm: string;\n  keyCurve: string;\n  keyValue: string;\n  rpId: string;\n  userHandle: string;\n  userName: string;\n  counter: string;\n  rpName: string;\n  userDisplayName: string;\n  discoverable: string;\n  creationDate: Date;\n\n  /**\n   * Constructs a new Fid2CredentialExport instance.\n   *\n   * @param o - The credential storing the data being exported. When not provided, an empty export is created instead.\n   */\n  constructor(o?: Fido2CredentialView | Fido2Credential) {\n    if (o == null) {\n      return;\n    }\n\n    if (o instanceof Fido2CredentialView) {\n      this.credentialId = o.credentialId;\n      this.keyType = o.keyType;\n      this.keyAlgorithm = o.keyAlgorithm;\n      this.keyCurve = o.keyCurve;\n      this.keyValue = o.keyValue;\n      this.rpId = o.rpId;\n      this.userHandle = o.userHandle;\n      this.userName = o.userName;\n      this.counter = String(o.counter);\n      this.rpName = o.rpName;\n      this.userDisplayName = o.userDisplayName;\n      this.discoverable = String(o.discoverable);\n    } else {\n      this.credentialId = o.credentialId?.encryptedString;\n      this.keyType = o.keyType?.encryptedString;\n      this.keyAlgorithm = o.keyAlgorithm?.encryptedString;\n      this.keyCurve = o.keyCurve?.encryptedString;\n      this.keyValue = o.keyValue?.encryptedString;\n      this.rpId = o.rpId?.encryptedString;\n      this.userHandle = o.userHandle?.encryptedString;\n      this.userName = o.userName?.encryptedString;\n      this.counter = o.counter?.encryptedString;\n      this.rpName = o.rpName?.encryptedString;\n      this.userDisplayName = o.userDisplayName?.encryptedString;\n      this.discoverable = o.discoverable?.encryptedString;\n    }\n    this.creationDate = o.creationDate;\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { UriMatchType } from \"../../vault/enums\";\nimport { LoginUri as LoginUriDomain } from \"../../vault/models/domain/login-uri\";\nimport { LoginUriView } from \"../../vault/models/view/login-uri.view\";\n\nexport class LoginUriExport {\n  static template(): LoginUriExport {\n    const req = new LoginUriExport();\n    req.uri = \"https://google.com\";\n    req.match = null;\n    return req;\n  }\n\n  static toView(req: LoginUriExport, view = new LoginUriView()) {\n    view.uri = req.uri;\n    view.match = req.match;\n    return view;\n  }\n\n  static toDomain(req: LoginUriExport, domain = new LoginUriDomain()) {\n    domain.uri = req.uri != null ? new EncString(req.uri) : null;\n    domain.uriChecksum = req.uriChecksum != null ? new EncString(req.uriChecksum) : null;\n    domain.match = req.match;\n    return domain;\n  }\n\n  uri: string;\n  uriChecksum: string | undefined;\n  match: UriMatchType = null;\n\n  constructor(o?: LoginUriView | LoginUriDomain) {\n    if (o == null) {\n      return;\n    }\n\n    if (o instanceof LoginUriView) {\n      this.uri = o.uri;\n    } else {\n      this.uri = o.uri?.encryptedString;\n      this.uriChecksum = o.uriChecksum?.encryptedString;\n    }\n    this.match = o.match;\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Login as LoginDomain } from \"../../vault/models/domain/login\";\nimport { LoginView } from \"../../vault/models/view/login.view\";\n\nimport { Fido2CredentialExport } from \"./fido2-credential.export\";\nimport { LoginUriExport } from \"./login-uri.export\";\n\nexport class LoginExport {\n  static template(): LoginExport {\n    const req = new LoginExport();\n    req.uris = [];\n    req.username = \"jdoe\";\n    req.password = \"myp@ssword123\";\n    req.totp = \"JBSWY3DPEHPK3PXP\";\n    req.fido2Credentials = [Fido2CredentialExport.template()];\n    return req;\n  }\n\n  static toView(req: LoginExport, view = new LoginView()) {\n    if (req.uris != null) {\n      view.uris = req.uris.map((u) => LoginUriExport.toView(u));\n    }\n    view.username = req.username;\n    view.password = req.password;\n    view.totp = req.totp;\n    if (req.fido2Credentials != null) {\n      view.fido2Credentials = req.fido2Credentials.map((key) => Fido2CredentialExport.toView(key));\n    }\n    return view;\n  }\n\n  static toDomain(req: LoginExport, domain = new LoginDomain()) {\n    if (req.uris != null) {\n      domain.uris = req.uris.map((u) => LoginUriExport.toDomain(u));\n    }\n    domain.username = req.username != null ? new EncString(req.username) : null;\n    domain.password = req.password != null ? new EncString(req.password) : null;\n    domain.totp = req.totp != null ? new EncString(req.totp) : null;\n    // Fido2credentials are currently not supported for exports.\n\n    return domain;\n  }\n\n  uris: LoginUriExport[];\n  username: string;\n  password: string;\n  totp: string;\n  fido2Credentials: Fido2CredentialExport[] = [];\n\n  constructor(o?: LoginView | LoginDomain) {\n    if (o == null) {\n      return;\n    }\n\n    if (o.uris != null) {\n      if (o instanceof LoginView) {\n        this.uris = o.uris.map((u) => new LoginUriExport(u));\n      } else {\n        this.uris = o.uris.map((u) => new LoginUriExport(u));\n      }\n    }\n\n    if (o.fido2Credentials != null) {\n      this.fido2Credentials = o.fido2Credentials.map((key) => new Fido2CredentialExport(key));\n    }\n\n    if (o instanceof LoginView) {\n      this.username = o.username;\n      this.password = o.password;\n      this.totp = o.totp;\n    } else {\n      this.username = o.username?.encryptedString;\n      this.password = o.password?.encryptedString;\n      this.totp = o.totp?.encryptedString;\n    }\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Password } from \"../../vault/models/domain/password\";\nimport { PasswordHistoryView } from \"../../vault/models/view/password-history.view\";\n\nexport class PasswordHistoryExport {\n  static template(): PasswordHistoryExport {\n    const req = new PasswordHistoryExport();\n    req.password = null;\n    req.lastUsedDate = null;\n    return req;\n  }\n\n  static toView(req: PasswordHistoryExport, view = new PasswordHistoryView()) {\n    view.password = req.password;\n    view.lastUsedDate = req.lastUsedDate;\n    return view;\n  }\n\n  static toDomain(req: PasswordHistoryExport, domain = new Password()) {\n    domain.password = req.password != null ? new EncString(req.password) : null;\n    domain.lastUsedDate = req.lastUsedDate;\n    return domain;\n  }\n\n  password: string;\n  lastUsedDate: Date = null;\n\n  constructor(o?: PasswordHistoryView | Password) {\n    if (o == null) {\n      return;\n    }\n\n    if (o instanceof PasswordHistoryView) {\n      this.password = o.password;\n    } else {\n      this.password = o.password?.encryptedString;\n    }\n    this.lastUsedDate = o.lastUsedDate;\n  }\n}\n","import { SecureNoteType } from \"../../vault/enums\";\nimport { SecureNote as SecureNoteDomain } from \"../../vault/models/domain/secure-note\";\nimport { SecureNoteView } from \"../../vault/models/view/secure-note.view\";\n\nexport class SecureNoteExport {\n  static template(): SecureNoteExport {\n    const req = new SecureNoteExport();\n    req.type = SecureNoteType.Generic;\n    return req;\n  }\n\n  static toView(req: SecureNoteExport, view = new SecureNoteView()) {\n    view.type = req.type;\n    return view;\n  }\n\n  static toDomain(req: SecureNoteExport, view = new SecureNoteDomain()) {\n    view.type = req.type;\n    return view;\n  }\n\n  type: SecureNoteType;\n\n  constructor(o?: SecureNoteView | SecureNoteDomain) {\n    if (o == null) {\n      return;\n    }\n\n    this.type = o.type;\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { CipherRepromptType } from \"../../vault/enums/cipher-reprompt-type\";\nimport { CipherType } from \"../../vault/enums/cipher-type\";\nimport { Cipher as CipherDomain } from \"../../vault/models/domain/cipher\";\nimport { CipherView } from \"../../vault/models/view/cipher.view\";\n\nimport { CardExport } from \"./card.export\";\nimport { FieldExport } from \"./field.export\";\nimport { IdentityExport } from \"./identity.export\";\nimport { LoginExport } from \"./login.export\";\nimport { PasswordHistoryExport } from \"./password-history.export\";\nimport { SecureNoteExport } from \"./secure-note.export\";\n\nexport class CipherExport {\n  static template(): CipherExport {\n    const req = new CipherExport();\n    req.organizationId = null;\n    req.collectionIds = null;\n    req.folderId = null;\n    req.type = CipherType.Login;\n    req.name = \"Item name\";\n    req.notes = \"Some notes about this item.\";\n    req.favorite = false;\n    req.fields = [];\n    req.login = null;\n    req.secureNote = null;\n    req.card = null;\n    req.identity = null;\n    req.reprompt = CipherRepromptType.None;\n    req.passwordHistory = [];\n    req.creationDate = null;\n    req.revisionDate = null;\n    req.deletedDate = null;\n    return req;\n  }\n\n  static toView(req: CipherExport, view = new CipherView()) {\n    view.type = req.type;\n    view.folderId = req.folderId;\n    if (view.organizationId == null) {\n      view.organizationId = req.organizationId;\n    }\n    if (view.collectionIds || req.collectionIds) {\n      const set = new Set((view.collectionIds ?? []).concat(req.collectionIds ?? []));\n      view.collectionIds = Array.from(set.values());\n    }\n    view.name = req.name;\n    view.notes = req.notes;\n    view.favorite = req.favorite;\n    view.reprompt = req.reprompt ?? CipherRepromptType.None;\n\n    if (req.fields != null) {\n      view.fields = req.fields.map((f) => FieldExport.toView(f));\n    }\n\n    switch (req.type) {\n      case CipherType.Login:\n        view.login = LoginExport.toView(req.login);\n        break;\n      case CipherType.SecureNote:\n        view.secureNote = SecureNoteExport.toView(req.secureNote);\n        break;\n      case CipherType.Card:\n        view.card = CardExport.toView(req.card);\n        break;\n      case CipherType.Identity:\n        view.identity = IdentityExport.toView(req.identity);\n        break;\n    }\n\n    if (req.passwordHistory != null) {\n      view.passwordHistory = req.passwordHistory.map((ph) => PasswordHistoryExport.toView(ph));\n    }\n\n    view.creationDate = req.creationDate;\n    view.revisionDate = req.revisionDate;\n    view.deletedDate = req.deletedDate;\n    return view;\n  }\n\n  static toDomain(req: CipherExport, domain = new CipherDomain()) {\n    domain.type = req.type;\n    domain.folderId = req.folderId;\n    if (domain.organizationId == null) {\n      domain.organizationId = req.organizationId;\n    }\n    domain.name = req.name != null ? new EncString(req.name) : null;\n    domain.notes = req.notes != null ? new EncString(req.notes) : null;\n    domain.favorite = req.favorite;\n    domain.reprompt = req.reprompt ?? CipherRepromptType.None;\n    domain.key = req.key != null ? new EncString(req.key) : null;\n\n    if (req.fields != null) {\n      domain.fields = req.fields.map((f) => FieldExport.toDomain(f));\n    }\n\n    switch (req.type) {\n      case CipherType.Login:\n        domain.login = LoginExport.toDomain(req.login);\n        break;\n      case CipherType.SecureNote:\n        domain.secureNote = SecureNoteExport.toDomain(req.secureNote);\n        break;\n      case CipherType.Card:\n        domain.card = CardExport.toDomain(req.card);\n        break;\n      case CipherType.Identity:\n        domain.identity = IdentityExport.toDomain(req.identity);\n        break;\n    }\n\n    if (req.passwordHistory != null) {\n      domain.passwordHistory = req.passwordHistory.map((ph) => PasswordHistoryExport.toDomain(ph));\n    }\n\n    domain.creationDate = req.creationDate;\n    domain.revisionDate = req.revisionDate;\n    domain.deletedDate = req.deletedDate;\n    return domain;\n  }\n\n  type: CipherType;\n  folderId: string;\n  organizationId: string;\n  collectionIds: string[];\n  name: string;\n  notes: string;\n  favorite: boolean;\n  fields: FieldExport[];\n  login: LoginExport;\n  secureNote: SecureNoteExport;\n  card: CardExport;\n  identity: IdentityExport;\n  reprompt: CipherRepromptType;\n  passwordHistory: PasswordHistoryExport[] = null;\n  revisionDate: Date = null;\n  creationDate: Date = null;\n  deletedDate: Date = null;\n  key: string;\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: CipherView | CipherDomain) {\n    this.organizationId = o.organizationId;\n    this.folderId = o.folderId;\n    this.type = o.type;\n    this.reprompt = o.reprompt;\n\n    if (o instanceof CipherView) {\n      this.name = o.name;\n      this.notes = o.notes;\n    } else {\n      this.name = o.name?.encryptedString;\n      this.notes = o.notes?.encryptedString;\n      this.key = o.key?.encryptedString;\n    }\n\n    this.favorite = o.favorite;\n\n    if (o.fields != null) {\n      if (o instanceof CipherView) {\n        this.fields = o.fields.map((f) => new FieldExport(f));\n      } else {\n        this.fields = o.fields.map((f) => new FieldExport(f));\n      }\n    }\n\n    switch (o.type) {\n      case CipherType.Login:\n        this.login = new LoginExport(o.login);\n        break;\n      case CipherType.SecureNote:\n        this.secureNote = new SecureNoteExport(o.secureNote);\n        break;\n      case CipherType.Card:\n        this.card = new CardExport(o.card);\n        break;\n      case CipherType.Identity:\n        this.identity = new IdentityExport(o.identity);\n        break;\n    }\n\n    if (o.passwordHistory != null) {\n      if (o instanceof CipherView) {\n        this.passwordHistory = o.passwordHistory.map((ph) => new PasswordHistoryExport(ph));\n      } else {\n        this.passwordHistory = o.passwordHistory.map((ph) => new PasswordHistoryExport(ph));\n      }\n    }\n\n    this.creationDate = o.creationDate;\n    this.revisionDate = o.revisionDate;\n    this.deletedDate = o.deletedDate;\n  }\n}\n","import { Cipher as CipherDomain } from \"../../vault/models/domain/cipher\";\nimport { CipherView } from \"../../vault/models/view/cipher.view\";\n\nimport { CipherExport } from \"./cipher.export\";\n\nexport class CipherWithIdExport extends CipherExport {\n  id: string;\n  collectionIds: string[];\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: CipherView | CipherDomain) {\n    this.id = o.id;\n    super.build(o);\n    this.collectionIds = o.collectionIds;\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Collection as CollectionDomain } from \"../../vault/models/domain/collection\";\nimport { CollectionView } from \"../../vault/models/view/collection.view\";\n\nexport class CollectionExport {\n  static template(): CollectionExport {\n    const req = new CollectionExport();\n    req.organizationId = \"00000000-0000-0000-0000-000000000000\";\n    req.name = \"Collection name\";\n    req.externalId = null;\n    return req;\n  }\n\n  static toView(req: CollectionExport, view = new CollectionView()) {\n    view.name = req.name;\n    view.externalId = req.externalId;\n    if (view.organizationId == null) {\n      view.organizationId = req.organizationId;\n    }\n    return view;\n  }\n\n  static toDomain(req: CollectionExport, domain = new CollectionDomain()) {\n    domain.name = req.name != null ? new EncString(req.name) : null;\n    domain.externalId = req.externalId;\n    if (domain.organizationId == null) {\n      domain.organizationId = req.organizationId;\n    }\n    return domain;\n  }\n\n  organizationId: string;\n  name: string;\n  externalId: string;\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: CollectionView | CollectionDomain) {\n    this.organizationId = o.organizationId;\n    if (o instanceof CollectionView) {\n      this.name = o.name;\n    } else {\n      this.name = o.name?.encryptedString;\n    }\n    this.externalId = o.externalId;\n  }\n}\n","import { Collection as CollectionDomain } from \"../../vault/models/domain/collection\";\nimport { CollectionView } from \"../../vault/models/view/collection.view\";\n\nimport { CollectionExport } from \"./collection.export\";\n\nexport class CollectionWithIdExport extends CollectionExport {\n  id: string;\n\n  static toView(req: CollectionWithIdExport, view = new CollectionView()) {\n    view.id = req.id;\n    return super.toView(req, view);\n  }\n\n  static toDomain(req: CollectionWithIdExport, domain = new CollectionDomain()) {\n    domain.id = req.id;\n    return super.toDomain(req, domain);\n  }\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: CollectionView | CollectionDomain) {\n    this.id = o.id;\n    super.build(o);\n  }\n}\n","import { EncString } from \"../../platform/models/domain/enc-string\";\nimport { Folder as FolderDomain } from \"../../vault/models/domain/folder\";\nimport { FolderView } from \"../../vault/models/view/folder.view\";\n\nexport class FolderExport {\n  static template(): FolderExport {\n    const req = new FolderExport();\n    req.name = \"Folder name\";\n    return req;\n  }\n\n  static toView(req: FolderExport, view = new FolderView()) {\n    view.name = req.name;\n    return view;\n  }\n\n  static toDomain(req: FolderExport, domain = new FolderDomain()) {\n    domain.name = req.name != null ? new EncString(req.name) : null;\n    return domain;\n  }\n\n  name: string;\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: FolderView | FolderDomain) {\n    if (o instanceof FolderView) {\n      this.name = o.name;\n    } else {\n      this.name = o.name?.encryptedString;\n    }\n  }\n}\n","import { Folder as FolderDomain } from \"../../vault/models/domain/folder\";\nimport { FolderView } from \"../../vault/models/view/folder.view\";\n\nimport { FolderExport } from \"./folder.export\";\n\nexport class FolderWithIdExport extends FolderExport {\n  id: string;\n\n  static toView(req: FolderWithIdExport, view = new FolderView()) {\n    view.id = req.id;\n    return super.toView(req, view);\n  }\n\n  static toDomain(req: FolderWithIdExport, domain = new FolderDomain()) {\n    domain.id = req.id;\n    return super.toDomain(req, domain);\n  }\n\n  // Use build method instead of ctor so that we can control order of JSON stringify for pretty print\n  build(o: FolderView | FolderDomain) {\n    this.id = o.id;\n    super.build(o);\n  }\n}\n","import {\n  CipherWithIdExport,\n  CollectionWithIdExport,\n  FolderWithIdExport,\n} from \"@bitwarden/common/models/export\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport {\n  BitwardenEncryptedIndividualJsonExport,\n  BitwardenEncryptedOrgJsonExport,\n  BitwardenJsonExport,\n  BitwardenUnEncryptedIndividualJsonExport,\n  BitwardenUnEncryptedOrgJsonExport,\n} from \"@bitwarden/vault-export-core\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class BitwardenJsonImporter extends BaseImporter implements Importer {\n  private result: ImportResult;\n\n  protected constructor(\n    protected cryptoService: CryptoService,\n    protected i18nService: I18nService,\n    protected cipherService: CipherService,\n  ) {\n    super();\n  }\n\n  async parse(data: string): Promise<ImportResult> {\n    this.result = new ImportResult();\n    const results: BitwardenJsonExport = JSON.parse(data);\n    if (results == null || results.items == null) {\n      this.result.success = false;\n      return this.result;\n    }\n\n    if (results.encrypted) {\n      await this.parseEncrypted(results as any);\n    } else {\n      await this.parseDecrypted(results as any);\n    }\n\n    return this.result;\n  }\n\n  private async parseEncrypted(\n    results: BitwardenEncryptedIndividualJsonExport | BitwardenEncryptedOrgJsonExport,\n  ) {\n    if (results.encKeyValidation_DO_NOT_EDIT != null) {\n      const orgKey = await this.cryptoService.getOrgKey(this.organizationId);\n      const encKeyValidation = new EncString(results.encKeyValidation_DO_NOT_EDIT);\n      const encKeyValidationDecrypt = await this.cryptoService.decryptToUtf8(\n        encKeyValidation,\n        orgKey,\n      );\n      if (encKeyValidationDecrypt === null) {\n        this.result.success = false;\n        this.result.errorMessage = this.i18nService.t(\"importEncKeyError\");\n        return;\n      }\n    }\n\n    const groupingsMap = this.organization\n      ? await this.parseCollections(results as BitwardenEncryptedOrgJsonExport)\n      : await this.parseFolders(results as BitwardenEncryptedIndividualJsonExport);\n\n    for (const c of results.items) {\n      const cipher = CipherWithIdExport.toDomain(c);\n      // reset ids incase they were set for some reason\n      cipher.id = null;\n      cipher.organizationId = this.organizationId;\n      cipher.collectionIds = null;\n\n      // make sure password history is limited\n      if (cipher.passwordHistory != null && cipher.passwordHistory.length > 5) {\n        cipher.passwordHistory = cipher.passwordHistory.slice(0, 5);\n      }\n\n      if (!this.organization && c.folderId != null && groupingsMap.has(c.folderId)) {\n        this.result.folderRelationships.push([\n          this.result.ciphers.length,\n          groupingsMap.get(c.folderId),\n        ]);\n      } else if (this.organization && c.collectionIds != null) {\n        c.collectionIds.forEach((cId) => {\n          if (groupingsMap.has(cId)) {\n            this.result.collectionRelationships.push([\n              this.result.ciphers.length,\n              groupingsMap.get(cId),\n            ]);\n          }\n        });\n      }\n\n      const view = await cipher.decrypt(\n        await this.cipherService.getKeyForCipherKeyDecryption(cipher),\n      );\n      this.cleanupCipher(view);\n      this.result.ciphers.push(view);\n    }\n\n    this.result.success = true;\n  }\n\n  private async parseDecrypted(\n    results: BitwardenUnEncryptedIndividualJsonExport | BitwardenUnEncryptedOrgJsonExport,\n  ) {\n    const groupingsMap = this.organization\n      ? await this.parseCollections(results as BitwardenUnEncryptedOrgJsonExport)\n      : await this.parseFolders(results as BitwardenUnEncryptedIndividualJsonExport);\n\n    results.items.forEach((c) => {\n      const cipher = CipherWithIdExport.toView(c);\n      // reset ids incase they were set for some reason\n      cipher.id = null;\n      cipher.organizationId = null;\n      cipher.collectionIds = null;\n\n      // make sure password history is limited\n      if (cipher.passwordHistory != null && cipher.passwordHistory.length > 5) {\n        cipher.passwordHistory = cipher.passwordHistory.slice(0, 5);\n      }\n\n      if (!this.organization && c.folderId != null && groupingsMap.has(c.folderId)) {\n        this.result.folderRelationships.push([\n          this.result.ciphers.length,\n          groupingsMap.get(c.folderId),\n        ]);\n      } else if (this.organization && c.collectionIds != null) {\n        c.collectionIds.forEach((cId) => {\n          if (groupingsMap.has(cId)) {\n            this.result.collectionRelationships.push([\n              this.result.ciphers.length,\n              groupingsMap.get(cId),\n            ]);\n          }\n        });\n      }\n\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n\n    this.result.success = true;\n  }\n\n  private async parseFolders(\n    data: BitwardenUnEncryptedIndividualJsonExport | BitwardenEncryptedIndividualJsonExport,\n  ): Promise<Map<string, number>> | null {\n    if (data.folders == null) {\n      return null;\n    }\n\n    const groupingsMap = new Map<string, number>();\n\n    for (const f of data.folders) {\n      let folderView: FolderView;\n      if (data.encrypted) {\n        const folder = FolderWithIdExport.toDomain(f);\n        if (folder != null) {\n          folderView = await folder.decrypt();\n        }\n      } else {\n        folderView = FolderWithIdExport.toView(f);\n      }\n\n      if (folderView != null) {\n        groupingsMap.set(f.id, this.result.folders.length);\n        this.result.folders.push(folderView);\n      }\n    }\n    return groupingsMap;\n  }\n\n  private async parseCollections(\n    data: BitwardenUnEncryptedOrgJsonExport | BitwardenEncryptedOrgJsonExport,\n  ): Promise<Map<string, number>> | null {\n    if (data.collections == null) {\n      return null;\n    }\n\n    const groupingsMap = new Map<string, number>();\n\n    for (const c of data.collections) {\n      let collectionView: CollectionView;\n      if (data.encrypted) {\n        const collection = CollectionWithIdExport.toDomain(c);\n        collection.organizationId = this.organizationId;\n        collectionView = await collection.decrypt();\n      } else {\n        collectionView = CollectionWithIdExport.toView(c);\n        collectionView.organizationId = null;\n      }\n\n      if (collectionView != null) {\n        groupingsMap.set(c.id, this.result.collections.length);\n        this.result.collections.push(collectionView);\n      }\n    }\n    return groupingsMap;\n  }\n}\n","import { KdfConfig } from \"@bitwarden/common/auth/models/domain/kdf-config\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { KdfType } from \"@bitwarden/common/platform/enums\";\nimport { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { BitwardenPasswordProtectedFileFormat } from \"@bitwarden/vault-export-core\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { Importer } from \"../importer\";\n\nimport { BitwardenJsonImporter } from \"./bitwarden-json-importer\";\n\nexport class BitwardenPasswordProtectedImporter extends BitwardenJsonImporter implements Importer {\n  private key: SymmetricCryptoKey;\n\n  constructor(\n    cryptoService: CryptoService,\n    i18nService: I18nService,\n    cipherService: CipherService,\n    private promptForPassword_callback: () => Promise<string>,\n  ) {\n    super(cryptoService, i18nService, cipherService);\n  }\n\n  async parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const parsedData: BitwardenPasswordProtectedFileFormat = JSON.parse(data);\n\n    if (!parsedData) {\n      result.success = false;\n      return result;\n    }\n\n    // File is unencrypted\n    if (!parsedData?.encrypted) {\n      return await super.parse(data);\n    }\n\n    // File is account-encrypted\n    if (!parsedData?.passwordProtected) {\n      return await super.parse(data);\n    }\n\n    if (this.cannotParseFile(parsedData)) {\n      result.success = false;\n      return result;\n    }\n\n    // File is password-protected\n    const password = await this.promptForPassword_callback();\n    if (!(await this.checkPassword(parsedData, password))) {\n      result.success = false;\n      result.errorMessage = this.i18nService.t(\"invalidFilePassword\");\n      return result;\n    }\n\n    const encData = new EncString(parsedData.data);\n    const clearTextData = await this.cryptoService.decryptToUtf8(encData, this.key);\n    return await super.parse(clearTextData);\n  }\n\n  private async checkPassword(\n    jdoc: BitwardenPasswordProtectedFileFormat,\n    password: string,\n  ): Promise<boolean> {\n    if (this.isNullOrWhitespace(password)) {\n      return false;\n    }\n\n    this.key = await this.cryptoService.makePinKey(\n      password,\n      jdoc.salt,\n      jdoc.kdfType,\n      new KdfConfig(jdoc.kdfIterations, jdoc.kdfMemory, jdoc.kdfParallelism),\n    );\n\n    const encKeyValidation = new EncString(jdoc.encKeyValidation_DO_NOT_EDIT);\n\n    const encKeyValidationDecrypt = await this.cryptoService.decryptToUtf8(\n      encKeyValidation,\n      this.key,\n    );\n    if (encKeyValidationDecrypt === null) {\n      return false;\n    }\n    return true;\n  }\n\n  private cannotParseFile(jdoc: BitwardenPasswordProtectedFileFormat): boolean {\n    return (\n      !jdoc ||\n      !jdoc.encrypted ||\n      !jdoc.passwordProtected ||\n      !jdoc.salt ||\n      !jdoc.kdfIterations ||\n      typeof jdoc.kdfIterations !== \"number\" ||\n      jdoc.kdfType == null ||\n      KdfType[jdoc.kdfType] == null ||\n      !jdoc.encKeyValidation_DO_NOT_EDIT ||\n      !jdoc.data\n    );\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class BlurCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.label === \"null\") {\n        value.label = null;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(\n        value.label,\n        this.getValueOrDefault(this.nameFromUrl(value.domain), \"--\"),\n      );\n      cipher.login.uris = this.makeUriArray(value.domain);\n      cipher.login.password = this.getValueOrDefault(value.password);\n\n      if (this.isNullOrWhitespace(value.email) && !this.isNullOrWhitespace(value.username)) {\n        cipher.login.username = value.username;\n      } else {\n        cipher.login.username = this.getValueOrDefault(value.email);\n        cipher.notes = this.getValueOrDefault(value.username);\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nconst OfficialProps = [\"!group_id\", \"!group_name\", \"title\", \"username\", \"password\", \"URL\", \"id\"];\n\nexport class ButtercupCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      this.processFolder(result, this.getValueOrDefault(value[\"!group_name\"]));\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.title, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.username);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.uris = this.makeUriArray(value.URL);\n\n      let processingCustomFields = false;\n      for (const prop in value) {\n        // eslint-disable-next-line\n        if (value.hasOwnProperty(prop)) {\n          if (!processingCustomFields && OfficialProps.indexOf(prop) === -1) {\n            processingCustomFields = true;\n          }\n          if (processingCustomFields) {\n            this.processKvp(cipher, prop, value[prop]);\n          }\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class ClipperzHtmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const textarea = doc.querySelector(\"textarea\");\n    if (textarea == null || this.isNullOrWhitespace(textarea.textContent)) {\n      result.errorMessage = \"Missing textarea.\";\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const entries = JSON.parse(textarea.textContent);\n    entries.forEach((entry: any) => {\n      const cipher = this.initLoginCipher();\n      if (!this.isNullOrWhitespace(entry.label)) {\n        cipher.name = entry.label.split(\" \")[0];\n      }\n      if (entry.data != null && !this.isNullOrWhitespace(entry.data.notes)) {\n        cipher.notes = entry.data.notes.split(\"\\\\n\").join(\"\\n\");\n      }\n\n      if (entry.currentVersion != null && entry.currentVersion.fields != null) {\n        for (const property in entry.currentVersion.fields) {\n          // eslint-disable-next-line\n          if (!entry.currentVersion.fields.hasOwnProperty(property)) {\n            continue;\n          }\n\n          const field = entry.currentVersion.fields[property];\n          const actionType = field.actionType != null ? field.actionType.toLowerCase() : null;\n          switch (actionType) {\n            case \"password\":\n              cipher.login.password = this.getValueOrDefault(field.value);\n              break;\n            case \"email\":\n            case \"username\":\n            case \"user\":\n            case \"name\":\n              cipher.login.username = this.getValueOrDefault(field.value);\n              break;\n            case \"url\":\n              cipher.login.uris = this.makeUriArray(field.value);\n              break;\n            default: {\n              const labelLower = field.label != null ? field.label.toLowerCase() : null;\n              if (\n                cipher.login.password == null &&\n                this.passwordFieldNames.indexOf(labelLower) > -1\n              ) {\n                cipher.login.password = this.getValueOrDefault(field.value);\n              } else if (\n                cipher.login.username == null &&\n                this.usernameFieldNames.indexOf(labelLower) > -1\n              ) {\n                cipher.login.username = this.getValueOrDefault(field.value);\n              } else if (\n                (cipher.login.uris == null || cipher.login.uris.length === 0) &&\n                this.uriFieldNames.indexOf(labelLower) > -1\n              ) {\n                cipher.login.uris = this.makeUriArray(field.value);\n              } else {\n                this.processKvp(cipher, field.label, field.value);\n              }\n              break;\n            }\n          }\n        }\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class CodebookCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      this.processFolder(result, this.getValueOrDefault(value.Category));\n\n      const cipher = this.initLoginCipher();\n      cipher.favorite = this.getValueOrDefault(value.Favorite) === \"True\";\n      cipher.name = this.getValueOrDefault(value.Entry, \"--\");\n      cipher.notes = this.getValueOrDefault(value.Note);\n      cipher.login.username = this.getValueOrDefault(value.Username, value.Email);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.totp = this.getValueOrDefault(value.TOTP);\n      cipher.login.uris = this.makeUriArray(value.Website);\n\n      if (!this.isNullOrWhitespace(value.Username)) {\n        this.processKvp(cipher, \"Email\", value.Email);\n      }\n      this.processKvp(cipher, \"Phone\", value.Phone);\n      this.processKvp(cipher, \"PIN\", value.PIN);\n      this.processKvp(cipher, \"Account\", value.Account);\n      this.processKvp(cipher, \"Date\", value.Date);\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport {\n  CredentialsRecord,\n  IdRecord,\n  PaymentsRecord,\n  PersonalInformationRecord,\n  SecureNoteRecord,\n} from \"./types/dashlane-csv-types\";\n\nconst _mappedCredentialsColumns = new Set([\n  \"title\",\n  \"note\",\n  \"username\",\n  \"password\",\n  \"url\",\n  \"otpSecret\",\n  \"category\",\n]);\n\nconst _mappedPersonalInfoAsIdentityColumns = new Set([\n  \"type\",\n  \"title\",\n  \"first_name\",\n  \"middle_name\",\n  \"last_name\",\n  \"login\",\n  \"email\",\n  \"phone_number\",\n  \"address\",\n  \"country\",\n  \"state\",\n  \"city\",\n  \"zip\",\n  // Skip item_name as we already have set a combined name\n  \"item_name\",\n]);\n\nconst _mappedSecureNoteColumns = new Set([\"title\", \"note\"]);\n\nexport class DashlaneCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    if (results[0].type != null && results[0].title != null) {\n      const personalRecords = results as PersonalInformationRecord[];\n\n      // If personalRecords has only one \"name\" then create an Identity-Cipher\n      if (personalRecords.filter((x) => x.type === \"name\").length === 1) {\n        const cipher = this.initLoginCipher();\n        cipher.type = CipherType.Identity;\n        cipher.identity = new IdentityView();\n        results.forEach((row) => {\n          this.parsePersonalInformationRecordAsIdentity(cipher, row);\n        });\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n        result.success = true;\n        return Promise.resolve(result);\n      }\n    }\n\n    results.forEach((row) => {\n      const cipher = this.initLoginCipher();\n\n      const rowKeys = Object.keys(row);\n      if (rowKeys[0] === \"username\") {\n        this.processFolder(result, row.category);\n        this.parseCredentialsRecord(cipher, row);\n      }\n\n      if (rowKeys[0] === \"type\" && rowKeys[1] === \"account_name\") {\n        this.parsePaymentRecord(cipher, row);\n      }\n\n      if (rowKeys[0] === \"type\" && rowKeys[1] === \"number\") {\n        this.parseIdRecord(cipher, row);\n      }\n\n      if ((rowKeys[0] === \"type\") != null && rowKeys[1] === \"title\") {\n        this.parsePersonalInformationRecord(cipher, row);\n      }\n\n      if (rowKeys[0] === \"title\" && rowKeys[1] === \"note\") {\n        this.parseSecureNoteRecords(cipher, row);\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  parseCredentialsRecord(cipher: CipherView, row: CredentialsRecord) {\n    cipher.type = CipherType.Login;\n    cipher.login = new LoginView();\n\n    cipher.name = row.title;\n    cipher.notes = row.note;\n    cipher.login.username = row.username;\n    cipher.login.password = row.password;\n    cipher.login.totp = row.otpSecret;\n    cipher.login.uris = this.makeUriArray(row.url);\n\n    this.importUnmappedFields(cipher, row, _mappedCredentialsColumns);\n  }\n\n  parsePaymentRecord(cipher: CipherView, row: PaymentsRecord) {\n    cipher.type = CipherType.Card;\n    cipher.card = new CardView();\n\n    cipher.name = row.account_name;\n    let mappedValues: string[] = [];\n    switch (row.type) {\n      case \"credit_card\":\n        cipher.card.cardholderName = row.account_name;\n        cipher.card.number = row.cc_number;\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        cipher.card.code = row.code;\n        this.setCardExpiration(cipher, `${row.expiration_month}/${row.expiration_year}`);\n\n        // If you add more mapped fields please extend this\n        mappedValues = [\n          \"account_name\",\n          \"account_holder\",\n          \"cc_number\",\n          \"code\",\n          \"expiration_month\",\n          \"expiration_year\",\n        ];\n        break;\n      case \"bank\":\n        cipher.card.cardholderName = row.account_holder;\n        cipher.card.number = row.account_number;\n\n        // If you add more mapped fields please extend this\n        mappedValues = [\"account_name\", \"account_holder\", \"account_number\"];\n        break;\n      default:\n        break;\n    }\n\n    this.importUnmappedFields(cipher, row, new Set(mappedValues));\n  }\n\n  parseIdRecord(cipher: CipherView, row: IdRecord) {\n    cipher.type = CipherType.Identity;\n    cipher.identity = new IdentityView();\n\n    const mappedValues: string[] = [\"name\", \"number\"];\n    switch (row.type) {\n      case \"card\":\n        cipher.name = `${row.name} ${row.type}`;\n        this.processFullName(cipher, row.name);\n        cipher.identity.licenseNumber = row.number;\n        break;\n      case \"passport\":\n        cipher.name = `${row.name} ${row.type}`;\n        this.processFullName(cipher, row.name);\n        cipher.identity.passportNumber = row.number;\n        break;\n      case \"license\":\n        cipher.name = `${row.name} ${row.type}`;\n        this.processFullName(cipher, row.name);\n        cipher.identity.licenseNumber = row.number;\n        cipher.identity.state = row.state;\n\n        mappedValues.push(\"state\");\n        break;\n      case \"social_security\":\n        cipher.name = `${row.name} ${row.type}`;\n        this.processFullName(cipher, row.name);\n        cipher.identity.ssn = row.number;\n        break;\n      case \"tax_number\":\n        cipher.name = row.type;\n        cipher.identity.licenseNumber = row.number;\n        break;\n\n      default:\n        break;\n    }\n\n    // If you add more mapped fields please extend this\n    this.importUnmappedFields(cipher, row, new Set(mappedValues));\n  }\n\n  parsePersonalInformationRecord(cipher: CipherView, row: PersonalInformationRecord) {\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote.type = SecureNoteType.Generic;\n    if (row.type === \"name\") {\n      cipher.name = `${row.title} ${row.first_name} ${row.middle_name} ${row.last_name}`\n        .replace(\"  \", \" \")\n        .trim();\n    } else {\n      cipher.name = row.item_name;\n    }\n\n    const dataRow = row as any;\n    Object.keys(row).forEach((key) => {\n      this.processKvp(cipher, key, dataRow[key]);\n    });\n  }\n\n  parsePersonalInformationRecordAsIdentity(cipher: CipherView, row: PersonalInformationRecord) {\n    switch (row.type) {\n      case \"name\":\n        this.processFullName(cipher, `${row.first_name} ${row.middle_name} ${row.last_name}`);\n        cipher.identity.title = row.title;\n        cipher.name = cipher.identity.fullName;\n\n        cipher.identity.username = row.login;\n        break;\n      case \"email\":\n        cipher.identity.email = row.email;\n        break;\n      case \"number\":\n        cipher.identity.phone = row.phone_number;\n        break;\n      case \"address\":\n        cipher.identity.address1 = row.address;\n        cipher.identity.city = row.city;\n        cipher.identity.postalCode = row.zip;\n        cipher.identity.state = row.state;\n        cipher.identity.country = row.country;\n        break;\n      default:\n        break;\n    }\n\n    this.importUnmappedFields(cipher, row, _mappedPersonalInfoAsIdentityColumns);\n  }\n\n  parseSecureNoteRecords(cipher: CipherView, row: SecureNoteRecord) {\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote.type = SecureNoteType.Generic;\n    cipher.name = row.title;\n    cipher.notes = row.note;\n\n    this.importUnmappedFields(cipher, row, _mappedSecureNoteColumns);\n  }\n\n  importUnmappedFields(cipher: CipherView, row: any, mappedValues: Set<string>) {\n    const unmappedFields = Object.keys(row).filter((x) => !mappedValues.has(x));\n    unmappedFields.forEach((key) => {\n      const item = row as any;\n      this.processKvp(cipher, key, item[key]);\n    });\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nconst HandledResults = new Set([\n  \"ADDRESS\",\n  \"AUTHENTIFIANT\",\n  \"BANKSTATEMENT\",\n  \"IDCARD\",\n  \"IDENTITY\",\n  \"PAYMENTMEANS_CREDITCARD\",\n  \"PAYMENTMEAN_PAYPAL\",\n  \"EMAIL\",\n]);\n\nexport class DashlaneJsonImporter extends BaseImporter implements Importer {\n  private result: ImportResult;\n\n  parse(data: string): Promise<ImportResult> {\n    this.result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null || results.length === 0) {\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    if (results.ADDRESS != null) {\n      this.processAddress(results.ADDRESS);\n    }\n    if (results.AUTHENTIFIANT != null) {\n      this.processAuth(results.AUTHENTIFIANT);\n    }\n    if (results.BANKSTATEMENT != null) {\n      this.processNote(results.BANKSTATEMENT, \"BankAccountName\");\n    }\n    if (results.IDCARD != null) {\n      this.processNote(results.IDCARD, \"Fullname\");\n    }\n    if (results.PAYMENTMEANS_CREDITCARD != null) {\n      this.processCard(results.PAYMENTMEANS_CREDITCARD);\n    }\n    if (results.IDENTITY != null) {\n      this.processIdentity(results.IDENTITY);\n    }\n\n    for (const key in results) {\n      // eslint-disable-next-line\n      if (results.hasOwnProperty(key) && !HandledResults.has(key)) {\n        this.processNote(results[key], null, \"Generic Note\");\n      }\n    }\n\n    this.result.success = true;\n    return Promise.resolve(this.result);\n  }\n\n  private processAuth(results: any[]) {\n    results.forEach((credential: any) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(credential.title);\n\n      cipher.login.username = this.getValueOrDefault(\n        credential.login,\n        this.getValueOrDefault(credential.secondaryLogin),\n      );\n      if (this.isNullOrWhitespace(cipher.login.username)) {\n        cipher.login.username = this.getValueOrDefault(credential.email);\n      } else if (!this.isNullOrWhitespace(credential.email)) {\n        cipher.notes = \"Email: \" + credential.email + \"\\n\";\n      }\n\n      cipher.login.password = this.getValueOrDefault(credential.password);\n      cipher.login.uris = this.makeUriArray(credential.domain);\n      cipher.notes += this.getValueOrDefault(credential.note, \"\");\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n\n  private processIdentity(results: any[]) {\n    results.forEach((obj: any) => {\n      const cipher = new CipherView();\n      cipher.identity = new IdentityView();\n      cipher.type = CipherType.Identity;\n      cipher.name = this.getValueOrDefault(obj.fullName, \"\");\n      const nameParts = cipher.name.split(\" \");\n      if (nameParts.length > 0) {\n        cipher.identity.firstName = this.getValueOrDefault(nameParts[0]);\n      }\n      if (nameParts.length === 2) {\n        cipher.identity.lastName = this.getValueOrDefault(nameParts[1]);\n      } else if (nameParts.length === 3) {\n        cipher.identity.middleName = this.getValueOrDefault(nameParts[1]);\n        cipher.identity.lastName = this.getValueOrDefault(nameParts[2]);\n      }\n      cipher.identity.username = this.getValueOrDefault(obj.pseudo);\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n\n  private processAddress(results: any[]) {\n    results.forEach((obj: any) => {\n      const cipher = new CipherView();\n      cipher.identity = new IdentityView();\n      cipher.type = CipherType.Identity;\n      cipher.name = this.getValueOrDefault(obj.addressName);\n      cipher.identity.address1 = this.getValueOrDefault(obj.addressFull);\n      cipher.identity.city = this.getValueOrDefault(obj.city);\n      cipher.identity.state = this.getValueOrDefault(obj.state);\n      cipher.identity.postalCode = this.getValueOrDefault(obj.zipcode);\n      cipher.identity.country = this.getValueOrDefault(obj.country);\n      if (cipher.identity.country != null) {\n        cipher.identity.country = cipher.identity.country.toUpperCase();\n      }\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n\n  private processCard(results: any[]) {\n    results.forEach((obj: any) => {\n      const cipher = new CipherView();\n      cipher.card = new CardView();\n      cipher.type = CipherType.Card;\n      cipher.name = this.getValueOrDefault(obj.bank);\n      cipher.card.number = this.getValueOrDefault(obj.cardNumber);\n      cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n      cipher.card.cardholderName = this.getValueOrDefault(obj.owner);\n      if (!this.isNullOrWhitespace(cipher.card.brand)) {\n        if (this.isNullOrWhitespace(cipher.name)) {\n          cipher.name = cipher.card.brand;\n        } else {\n          cipher.name += \" - \" + cipher.card.brand;\n        }\n      }\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n\n  private processNote(results: any[], nameProperty: string, name: string = null) {\n    results.forEach((obj: any) => {\n      const cipher = new CipherView();\n      cipher.secureNote = new SecureNoteView();\n      cipher.type = CipherType.SecureNote;\n      cipher.secureNote.type = SecureNoteType.Generic;\n      if (name != null) {\n        cipher.name = name;\n      } else {\n        cipher.name = this.getValueOrDefault(obj[nameProperty]);\n      }\n      for (const key in obj) {\n        // eslint-disable-next-line\n        if (obj.hasOwnProperty(key) && key !== nameProperty) {\n          this.processKvp(cipher, key, obj[key].toString());\n        }\n      }\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class EncryptrCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.Label, \"--\");\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      const text = this.getValueOrDefault(value.Text);\n      if (!this.isNullOrWhitespace(text)) {\n        if (this.isNullOrWhitespace(cipher.notes)) {\n          cipher.notes = text;\n        } else {\n          cipher.notes += \"\\n\\n\" + text;\n        }\n      }\n\n      const type = value[\"Entry Type\"];\n      if (type === \"Password\") {\n        cipher.login.username = this.getValueOrDefault(value.Username);\n        cipher.login.password = this.getValueOrDefault(value.Password);\n        cipher.login.uris = this.makeUriArray(value[\"Site URL\"]);\n      } else if (type === \"Credit Card\") {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n        cipher.card.cardholderName = this.getValueOrDefault(value[\"Name on card\"]);\n        cipher.card.number = this.getValueOrDefault(value[\"Card Number\"]);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        cipher.card.code = this.getValueOrDefault(value.CVV);\n        const expiry = this.getValueOrDefault(value.Expiry);\n        if (!this.isNullOrWhitespace(expiry)) {\n          const expParts = expiry.split(\"/\");\n          if (expParts.length > 1) {\n            cipher.card.expMonth = parseInt(expParts[0], null).toString();\n            cipher.card.expYear = (2000 + parseInt(expParts[1], null)).toString();\n          }\n        }\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class EnpassCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    let firstRow = true;\n    results.forEach((value) => {\n      if (value.length < 2 || (firstRow && (value[0] === \"Title\" || value[0] === \"title\"))) {\n        firstRow = false;\n        return;\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value[value.length - 1]);\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n\n      if (\n        value.length === 2 ||\n        (!this.containsField(value, \"username\") &&\n          !this.containsField(value, \"password\") &&\n          !this.containsField(value, \"email\") &&\n          !this.containsField(value, \"url\"))\n      ) {\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote = new SecureNoteView();\n        cipher.secureNote.type = SecureNoteType.Generic;\n      }\n\n      if (\n        this.containsField(value, \"cardholder\") &&\n        this.containsField(value, \"number\") &&\n        this.containsField(value, \"expiry date\")\n      ) {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n      }\n\n      if (value.length > 2 && value.length % 2 === 0) {\n        for (let i = 0; i < value.length - 2; i += 2) {\n          const fieldValue: string = value[i + 2];\n          if (this.isNullOrWhitespace(fieldValue)) {\n            continue;\n          }\n\n          const fieldName: string = value[i + 1];\n          const fieldNameLower = fieldName.toLowerCase();\n\n          if (cipher.type === CipherType.Login) {\n            if (\n              fieldNameLower === \"url\" &&\n              (cipher.login.uris == null || cipher.login.uris.length === 0)\n            ) {\n              cipher.login.uris = this.makeUriArray(fieldValue);\n              continue;\n            } else if (\n              (fieldNameLower === \"username\" || fieldNameLower === \"email\") &&\n              this.isNullOrWhitespace(cipher.login.username)\n            ) {\n              cipher.login.username = fieldValue;\n              continue;\n            } else if (\n              fieldNameLower === \"password\" &&\n              this.isNullOrWhitespace(cipher.login.password)\n            ) {\n              cipher.login.password = fieldValue;\n              continue;\n            } else if (fieldNameLower === \"totp\" && this.isNullOrWhitespace(cipher.login.totp)) {\n              cipher.login.totp = fieldValue;\n              continue;\n            }\n          } else if (cipher.type === CipherType.Card) {\n            if (\n              fieldNameLower === \"cardholder\" &&\n              this.isNullOrWhitespace(cipher.card.cardholderName)\n            ) {\n              cipher.card.cardholderName = fieldValue;\n              continue;\n            } else if (fieldNameLower === \"number\" && this.isNullOrWhitespace(cipher.card.number)) {\n              cipher.card.number = fieldValue;\n              cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n              continue;\n            } else if (fieldNameLower === \"cvc\" && this.isNullOrWhitespace(cipher.card.code)) {\n              cipher.card.code = fieldValue;\n              continue;\n            } else if (\n              fieldNameLower === \"expiry date\" &&\n              this.isNullOrWhitespace(cipher.card.expMonth) &&\n              this.isNullOrWhitespace(cipher.card.expYear)\n            ) {\n              if (this.setCardExpiration(cipher, fieldValue)) {\n                continue;\n              }\n            } else if (fieldNameLower === \"type\") {\n              // Skip since brand was determined from number above\n              continue;\n            }\n          }\n\n          this.processKvp(cipher, fieldName, fieldValue);\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private containsField(fields: any[], name: string) {\n    if (fields == null || name == null) {\n      return false;\n    }\n    return (\n      fields.filter((f) => !this.isNullOrWhitespace(f) && f.toLowerCase() === name.toLowerCase())\n        .length > 0\n    );\n  }\n}\n","import { FieldType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport { EnpassJsonFile, EnpassFolder, EnpassField } from \"./types/enpass-json-type\";\n\ntype EnpassFolderTreeItem = EnpassFolder & { children: EnpassFolderTreeItem[] };\nconst androidUrlRegex = new RegExp(\"androidapp://.*==@\", \"g\");\n\nexport class EnpassJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results: EnpassJsonFile = JSON.parse(data);\n    if (results == null || results.items == null || results.items.length === 0) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const foldersMap = new Map<string, string>();\n    const foldersIndexMap = new Map<string, number>();\n    const folderTree = this.buildFolderTree(results.folders);\n    this.flattenFolderTree(null, folderTree, foldersMap);\n    foldersMap.forEach((val, key) => {\n      foldersIndexMap.set(key, result.folders.length);\n      const f = new FolderView();\n      f.name = val;\n      result.folders.push(f);\n    });\n\n    results.items.forEach((item) => {\n      if (item.folders != null && item.folders.length > 0 && foldersIndexMap.has(item.folders[0])) {\n        result.folderRelationships.push([\n          result.ciphers.length,\n          foldersIndexMap.get(item.folders[0]),\n        ]);\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(item.title);\n      cipher.favorite = item.favorite > 0;\n\n      if (item.template_type != null && item.fields != null && item.fields.length > 0) {\n        if (\n          item.template_type.indexOf(\"login.\") === 0 ||\n          item.template_type.indexOf(\"password.\") === 0\n        ) {\n          this.processLogin(cipher, item.fields);\n        } else if (item.template_type.indexOf(\"creditcard.\") === 0) {\n          this.processCard(cipher, item.fields);\n        } else if (\n          item.template_type.indexOf(\"identity.\") < 0 &&\n          item.fields.some((f) => f.type === \"password\" && !this.isNullOrWhitespace(f.value))\n        ) {\n          this.processLogin(cipher, item.fields);\n        } else {\n          this.processNote(cipher, item.fields);\n        }\n      }\n\n      cipher.notes += \"\\n\" + this.getValueOrDefault(item.note, \"\");\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private processLogin(cipher: CipherView, fields: EnpassField[]) {\n    const urls: string[] = [];\n    fields.forEach((field) => {\n      if (this.isNullOrWhitespace(field.value) || field.type === \"section\") {\n        return;\n      }\n\n      if (\n        (field.type === \"username\" || field.type === \"email\") &&\n        this.isNullOrWhitespace(cipher.login.username)\n      ) {\n        cipher.login.username = field.value;\n      } else if (field.type === \"password\" && this.isNullOrWhitespace(cipher.login.password)) {\n        cipher.login.password = field.value;\n      } else if (field.type === \"totp\" && this.isNullOrWhitespace(cipher.login.totp)) {\n        cipher.login.totp = field.value;\n      } else if (field.type === \"url\") {\n        urls.push(field.value);\n      } else if (field.type === \".Android#\") {\n        let cleanedValue = field.value.startsWith(\"androidapp://\")\n          ? field.value\n          : \"androidapp://\" + field.value;\n        cleanedValue = cleanedValue.replace(\"android://\", \"\");\n        cleanedValue = cleanedValue.replace(androidUrlRegex, \"androidapp://\");\n        urls.push(cleanedValue);\n      } else {\n        this.processKvp(\n          cipher,\n          field.label,\n          field.value,\n          field.sensitive === 1 ? FieldType.Hidden : FieldType.Text,\n        );\n      }\n    });\n    cipher.login.uris = this.makeUriArray(urls);\n  }\n\n  private processCard(cipher: CipherView, fields: EnpassField[]) {\n    cipher.card = new CardView();\n    cipher.type = CipherType.Card;\n    fields.forEach((field) => {\n      if (\n        this.isNullOrWhitespace(field.value) ||\n        field.type === \"section\" ||\n        field.type === \"ccType\"\n      ) {\n        return;\n      }\n\n      if (field.type === \"ccName\" && this.isNullOrWhitespace(cipher.card.cardholderName)) {\n        cipher.card.cardholderName = field.value;\n      } else if (field.type === \"ccNumber\" && this.isNullOrWhitespace(cipher.card.number)) {\n        cipher.card.number = field.value;\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n      } else if (field.type === \"ccCvc\" && this.isNullOrWhitespace(cipher.card.code)) {\n        cipher.card.code = field.value;\n      } else if (field.type === \"ccExpiry\" && this.isNullOrWhitespace(cipher.card.expYear)) {\n        if (!this.setCardExpiration(cipher, field.value)) {\n          this.processKvp(\n            cipher,\n            field.label,\n            field.value,\n            field.sensitive === 1 ? FieldType.Hidden : FieldType.Text,\n          );\n        }\n      } else {\n        this.processKvp(\n          cipher,\n          field.label,\n          field.value,\n          field.sensitive === 1 ? FieldType.Hidden : FieldType.Text,\n        );\n      }\n    });\n  }\n\n  private processNote(cipher: CipherView, fields: EnpassField[]) {\n    fields.forEach((field) => {\n      if (this.isNullOrWhitespace(field.value) || field.type === \"section\") {\n        return;\n      }\n      this.processKvp(\n        cipher,\n        field.label,\n        field.value,\n        field.sensitive === 1 ? FieldType.Hidden : FieldType.Text,\n      );\n    });\n  }\n\n  private buildFolderTree(folders: EnpassFolder[]): EnpassFolderTreeItem[] {\n    if (folders == null) {\n      return [];\n    }\n    const folderTree: EnpassFolderTreeItem[] = [];\n    const map = new Map<string, EnpassFolderTreeItem>([]);\n    folders.forEach((obj: EnpassFolderTreeItem) => {\n      map.set(obj.uuid, obj);\n      obj.children = [];\n    });\n    folders.forEach((obj: EnpassFolderTreeItem) => {\n      if (obj.parent_uuid != null && obj.parent_uuid !== \"\" && map.has(obj.parent_uuid)) {\n        map.get(obj.parent_uuid).children.push(obj);\n      } else {\n        folderTree.push(obj);\n      }\n    });\n    return folderTree;\n  }\n\n  private flattenFolderTree(\n    titlePrefix: string,\n    tree: EnpassFolderTreeItem[],\n    map: Map<string, string>,\n  ) {\n    if (tree == null) {\n      return;\n    }\n    tree.forEach((f) => {\n      if (f.title != null && f.title.trim() !== \"\") {\n        let title = f.title.trim();\n        if (titlePrefix != null && titlePrefix.trim() !== \"\") {\n          title = titlePrefix + \"/\" + title;\n        }\n        map.set(f.uuid, title);\n        if (f.children != null && f.children.length !== 0) {\n          this.flattenFolderTree(title, f.children, map);\n        }\n      }\n    });\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class FirefoxCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results\n      .filter((value) => {\n        return value.url !== \"chrome://FirefoxAccounts\";\n      })\n      .forEach((value) => {\n        const cipher = this.initLoginCipher();\n        const url = this.getValueOrDefault(value.url, this.getValueOrDefault(value.hostname));\n        cipher.name = this.getValueOrDefault(this.nameFromUrl(url), \"--\");\n        cipher.login.username = this.getValueOrDefault(value.username);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.uris = this.makeUriArray(url);\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","export interface FskFile {\n  data: Data;\n}\n\nexport interface Data {\n  [key: string]: FskEntry;\n}\n\nexport enum FskEntryTypesEnum {\n  Login = 1,\n  CreditCard = 2,\n}\n\nexport interface FskEntry {\n  color: string;\n  creditCvv: string;\n  creditExpiry: string;\n  creditNumber: string;\n  favorite: number; // UNIX timestamp\n  notes: string;\n  password: string;\n  passwordList: PasswordList[];\n  passwordModifiedDate: number; // UNIX timestamp\n  rev: string | number;\n  service: string;\n  style: string;\n  type: FskEntryTypesEnum;\n  url: string;\n  username: string;\n  createdDate: number; // UNIX timestamp\n  modifiedDate: number; // UNIX timestamp\n}\n\nexport interface PasswordList {\n  changedate: string;\n  password: string;\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport { FskEntry, FskEntryTypesEnum, FskFile } from \"./fsecure-fsk-types\";\n\nexport class FSecureFskImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results: FskFile = JSON.parse(data);\n    if (results == null || results.data == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    for (const key in results.data) {\n      // eslint-disable-next-line\n      if (!results.data.hasOwnProperty(key)) {\n        continue;\n      }\n\n      const value = results.data[key];\n      const cipher = this.parseEntry(value);\n      result.ciphers.push(cipher);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseEntry(entry: FskEntry): CipherView {\n    const cipher = this.initLoginCipher();\n    cipher.name = this.getValueOrDefault(entry.service);\n    cipher.notes = this.getValueOrDefault(entry.notes);\n    cipher.favorite = entry.favorite > 0;\n\n    switch (entry.type) {\n      case FskEntryTypesEnum.Login:\n        this.handleLoginEntry(entry, cipher);\n        break;\n      case FskEntryTypesEnum.CreditCard:\n        this.handleCreditCardEntry(entry, cipher);\n        break;\n      default:\n        return;\n        break;\n    }\n\n    this.convertToNoteIfNeeded(cipher);\n    this.cleanupCipher(cipher);\n    return cipher;\n  }\n\n  private handleLoginEntry(entry: FskEntry, cipher: CipherView) {\n    cipher.login.username = this.getValueOrDefault(entry.username);\n    cipher.login.password = this.getValueOrDefault(entry.password);\n    cipher.login.uris = this.makeUriArray(entry.url);\n  }\n\n  private handleCreditCardEntry(entry: FskEntry, cipher: CipherView) {\n    cipher.type = CipherType.Card;\n    cipher.card = new CardView();\n    cipher.card.cardholderName = this.getValueOrDefault(entry.username);\n    cipher.card.number = this.getValueOrDefault(entry.creditNumber);\n    cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n    cipher.card.code = this.getValueOrDefault(entry.creditCvv);\n    if (!this.isNullOrWhitespace(entry.creditExpiry)) {\n      if (!this.setCardExpiration(cipher, entry.creditExpiry)) {\n        this.processKvp(cipher, \"Expiration\", entry.creditExpiry);\n      }\n    }\n    if (!this.isNullOrWhitespace(entry.password)) {\n      this.processKvp(cipher, \"PIN\", entry.password);\n    }\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class GnomeJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null || Object.keys(results).length === 0) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    for (const keyRing in results) {\n      if (\n        !results.hasOwnProperty(keyRing) || // eslint-disable-line\n        this.isNullOrWhitespace(keyRing) ||\n        results[keyRing].length === 0\n      ) {\n        continue;\n      }\n\n      results[keyRing].forEach((value: any) => {\n        if (\n          this.isNullOrWhitespace(value.display_name) ||\n          value.display_name.indexOf(\"http\") !== 0\n        ) {\n          return;\n        }\n\n        this.processFolder(result, keyRing);\n        const cipher = this.initLoginCipher();\n        cipher.name = value.display_name.replace(\"http://\", \"\").replace(\"https://\", \"\");\n        if (cipher.name.length > 30) {\n          cipher.name = cipher.name.substring(0, 30);\n        }\n        cipher.login.password = this.getValueOrDefault(value.secret);\n        cipher.login.uris = this.makeUriArray(value.display_name);\n\n        if (value.attributes != null) {\n          cipher.login.username =\n            value.attributes != null\n              ? this.getValueOrDefault(value.attributes.username_value)\n              : null;\n          for (const attr in value.attributes) {\n            if (\n              !value.attributes.hasOwnProperty(attr) || // eslint-disable-line\n              attr === \"username_value\" ||\n              attr === \"xdg:schema\"\n            ) {\n              continue;\n            }\n            this.processKvp(cipher, attr, value.attributes[attr]);\n          }\n        }\n\n        this.convertToNoteIfNeeded(cipher);\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      });\n    }\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nconst NotesHeader = \"Notes\\n\\n\";\nconst ApplicationsHeader = \"Applications\\n\\n\";\nconst WebsitesHeader = \"Websites\\n\\n\";\nconst Delimiter = \"\\n---\\n\";\n\nexport class KasperskyTxtImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n\n    let notesData: string;\n    let applicationsData: string;\n    let websitesData: string;\n    let workingData = this.splitNewLine(data).join(\"\\n\");\n\n    if (workingData.indexOf(NotesHeader) !== -1) {\n      const parts = workingData.split(NotesHeader);\n      if (parts.length > 1) {\n        workingData = parts[0];\n        notesData = parts[1];\n      }\n    }\n    if (workingData.indexOf(ApplicationsHeader) !== -1) {\n      const parts = workingData.split(ApplicationsHeader);\n      if (parts.length > 1) {\n        workingData = parts[0];\n        applicationsData = parts[1];\n      }\n    }\n    if (workingData.indexOf(WebsitesHeader) === 0) {\n      const parts = workingData.split(WebsitesHeader);\n      if (parts.length > 1) {\n        workingData = parts[0];\n        websitesData = parts[1];\n      }\n    }\n\n    const notes = this.parseDataCategory(notesData);\n    const applications = this.parseDataCategory(applicationsData);\n    const websites = this.parseDataCategory(websitesData);\n\n    notes.forEach((n) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(n.get(\"Name\"));\n      cipher.notes = this.getValueOrDefault(n.get(\"Text\"));\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    websites.concat(applications).forEach((w) => {\n      const cipher = this.initLoginCipher();\n      const nameKey = w.has(\"Website name\") ? \"Website name\" : \"Application\";\n      cipher.name = this.getValueOrDefault(w.get(nameKey), \"\");\n      if (!this.isNullOrWhitespace(w.get(\"Login name\"))) {\n        if (!this.isNullOrWhitespace(cipher.name)) {\n          cipher.name += \": \";\n        }\n        cipher.name += w.get(\"Login name\");\n      }\n      cipher.notes = this.getValueOrDefault(w.get(\"Comment\"));\n      if (w.has(\"Website URL\")) {\n        cipher.login.uris = this.makeUriArray(w.get(\"Website URL\"));\n      }\n      cipher.login.username = this.getValueOrDefault(w.get(\"Login\"));\n      cipher.login.password = this.getValueOrDefault(w.get(\"Password\"));\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseDataCategory(data: string): Map<string, string>[] {\n    if (this.isNullOrWhitespace(data) || data.indexOf(Delimiter) === -1) {\n      return [];\n    }\n    const items: Map<string, string>[] = [];\n    data.split(Delimiter).forEach((p) => {\n      if (p.indexOf(\"\\n\") === -1) {\n        return;\n      }\n      const item = new Map<string, string>();\n      let itemComment: string;\n      let itemCommentKey: string;\n      p.split(\"\\n\").forEach((l) => {\n        if (itemComment != null) {\n          itemComment += \"\\n\" + l;\n          return;\n        }\n        const colonIndex = l.indexOf(\":\");\n        let key: string;\n        let val: string;\n        if (colonIndex === -1) {\n          return;\n        } else {\n          key = l.substring(0, colonIndex);\n          if (l.length > colonIndex + 1) {\n            val = l.substring(colonIndex + 2);\n          }\n        }\n        if (key != null) {\n          item.set(key, val);\n        }\n        if (key === \"Comment\" || key === \"Text\") {\n          itemComment = val;\n          itemCommentKey = key;\n        }\n      });\n      if (itemComment != null && itemCommentKey != null) {\n        item.set(itemCommentKey, itemComment);\n      }\n      if (item.size === 0) {\n        return;\n      }\n      items.push(item);\n    });\n    return items;\n  }\n}\n","import { FieldType } from \"@bitwarden/common/vault/enums\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class KeePass2XmlImporter extends BaseImporter implements Importer {\n  result = new ImportResult();\n\n  parse(data: string): Promise<ImportResult> {\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    //Note: The doc.querySelector(\"KeePassFile > Root > Group\") no longers works on node and we have to breakdown the query by nodes\n    const KeePassFileNode = doc.querySelector(\"KeePassFile\");\n\n    if (KeePassFileNode == null) {\n      this.result.errorMessage = \"Missing `KeePassFile` node.\";\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    const RootNode = KeePassFileNode.querySelector(\"Root\");\n    if (RootNode == null) {\n      this.result.errorMessage = \"Missing `KeePassFile > Root` node.\";\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    const rootGroup = RootNode.querySelector(\"Group\");\n    if (rootGroup == null) {\n      this.result.errorMessage = \"Missing `KeePassFile > Root > Group` node.\";\n      this.result.success = false;\n      return Promise.resolve(this.result);\n    }\n\n    this.traverse(rootGroup, true, \"\");\n\n    if (this.organization) {\n      this.moveFoldersToCollections(this.result);\n    }\n\n    this.result.success = true;\n    return Promise.resolve(this.result);\n  }\n\n  traverse(node: Element, isRootNode: boolean, groupPrefixName: string) {\n    const folderIndex = this.result.folders.length;\n    let groupName = groupPrefixName;\n\n    if (!isRootNode) {\n      if (groupName !== \"\") {\n        groupName += \"/\";\n      }\n      const nameEl = this.querySelectorDirectChild(node, \"Name\");\n      groupName += nameEl == null ? \"-\" : nameEl.textContent;\n      const folder = new FolderView();\n      folder.name = groupName;\n      this.result.folders.push(folder);\n    }\n\n    this.querySelectorAllDirectChild(node, \"Entry\").forEach((entry) => {\n      const cipherIndex = this.result.ciphers.length;\n\n      const cipher = this.initLoginCipher();\n      this.querySelectorAllDirectChild(entry, \"String\").forEach((entryString) => {\n        const valueEl = this.querySelectorDirectChild(entryString, \"Value\");\n        const value = valueEl != null ? valueEl.textContent : null;\n        if (this.isNullOrWhitespace(value)) {\n          return;\n        }\n        const keyEl = this.querySelectorDirectChild(entryString, \"Key\");\n        const key = keyEl != null ? keyEl.textContent : null;\n\n        if (key === \"URL\") {\n          cipher.login.uris = this.makeUriArray(value);\n        } else if (key === \"UserName\") {\n          cipher.login.username = value;\n        } else if (key === \"Password\") {\n          cipher.login.password = value;\n        } else if (key === \"otp\") {\n          cipher.login.totp = value.replace(\"key=\", \"\");\n        } else if (key === \"Title\") {\n          cipher.name = value;\n        } else if (key === \"Notes\") {\n          cipher.notes += value + \"\\n\";\n        } else {\n          let type = FieldType.Text;\n          const attrs = valueEl.attributes as any;\n          if (\n            attrs.length > 0 &&\n            attrs.ProtectInMemory != null &&\n            attrs.ProtectInMemory.value === \"True\"\n          ) {\n            type = FieldType.Hidden;\n          }\n          this.processKvp(cipher, key, value, type);\n        }\n      });\n\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n\n      if (!isRootNode) {\n        this.result.folderRelationships.push([cipherIndex, folderIndex]);\n      }\n    });\n\n    this.querySelectorAllDirectChild(node, \"Group\").forEach((group) => {\n      this.traverse(group, false, groupName);\n    });\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class KeePassXCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (this.isNullOrWhitespace(value.Title)) {\n        return;\n      }\n\n      value.Group =\n        !this.isNullOrWhitespace(value.Group) && value.Group.startsWith(\"Root/\")\n          ? value.Group.replace(\"Root/\", \"\")\n          : value.Group;\n      const groupName = !this.isNullOrWhitespace(value.Group) ? value.Group : null;\n      this.processFolder(result, groupName);\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      cipher.name = this.getValueOrDefault(value.Title, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.Username);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.URL);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class KeeperCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 6) {\n        return;\n      }\n\n      this.processFolder(result, value[0]);\n      const cipher = this.initLoginCipher();\n\n      const notes = this.getValueOrDefault(value[5]);\n      if (notes) {\n        cipher.notes = `${notes}\\n`;\n      }\n\n      cipher.name = this.getValueOrDefault(value[1], \"--\");\n      cipher.login.username = this.getValueOrDefault(value[2]);\n      cipher.login.password = this.getValueOrDefault(value[3]);\n      cipher.login.uris = this.makeUriArray(value[4]);\n\n      if (value.length > 7) {\n        // we have some custom fields.\n        for (let i = 7; i < value.length; i = i + 2) {\n          if (value[i] == \"TFC:Keeper\") {\n            cipher.login.totp = value[i + 1];\n          } else {\n            this.processKvp(cipher, value[i], value[i + 1]);\n          }\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class LastPassCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipherIndex = result.ciphers.length;\n      let folderIndex = result.folders.length;\n      let grouping = value.grouping;\n      if (grouping != null) {\n        // eslint-disable-next-line\n        grouping = grouping.replace(/\\\\/g, \"/\").replace(/[\\x00-\\x1F\\x7F-\\x9F]/g, \"\");\n      }\n      const hasFolder = this.getValueOrDefault(grouping, \"(none)\") !== \"(none)\";\n      let addFolder = hasFolder;\n\n      if (hasFolder) {\n        for (let i = 0; i < result.folders.length; i++) {\n          if (result.folders[i].name === grouping) {\n            addFolder = false;\n            folderIndex = i;\n            break;\n          }\n        }\n      }\n\n      const cipher = this.buildBaseCipher(value);\n      if (cipher.type === CipherType.Login) {\n        cipher.notes = this.getValueOrDefault(value.extra);\n        cipher.login = new LoginView();\n        cipher.login.uris = this.makeUriArray(value.url);\n        cipher.login.username = this.getValueOrDefault(value.username);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.totp = this.getValueOrDefault(value.totp);\n      } else if (cipher.type === CipherType.SecureNote) {\n        this.parseSecureNote(value, cipher);\n      } else if (cipher.type === CipherType.Card) {\n        cipher.card = this.parseCard(value);\n        cipher.notes = this.getValueOrDefault(value.notes);\n      } else if (cipher.type === CipherType.Identity) {\n        cipher.identity = this.parseIdentity(value);\n        cipher.notes = this.getValueOrDefault(value.notes);\n        if (!this.isNullOrWhitespace(value.ccnum)) {\n          // there is a card on this identity too\n          const cardCipher = this.buildBaseCipher(value);\n          cardCipher.identity = null;\n          cardCipher.type = CipherType.Card;\n          cardCipher.card = this.parseCard(value);\n          result.ciphers.push(cardCipher);\n        }\n      }\n\n      result.ciphers.push(cipher);\n\n      if (addFolder) {\n        const f = new FolderView();\n        f.name = grouping;\n        result.folders.push(f);\n      }\n      if (hasFolder) {\n        result.folderRelationships.push([cipherIndex, folderIndex]);\n      }\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private buildBaseCipher(value: any) {\n    const cipher = new CipherView();\n    // eslint-disable-next-line\n    if (value.hasOwnProperty(\"profilename\") && value.hasOwnProperty(\"profilelanguage\")) {\n      // form fill\n      cipher.favorite = false;\n      cipher.name = this.getValueOrDefault(value.profilename, \"--\");\n      cipher.type = CipherType.Card;\n\n      if (\n        !this.isNullOrWhitespace(value.title) ||\n        !this.isNullOrWhitespace(value.firstname) ||\n        !this.isNullOrWhitespace(value.lastname) ||\n        !this.isNullOrWhitespace(value.address1) ||\n        !this.isNullOrWhitespace(value.phone) ||\n        !this.isNullOrWhitespace(value.username) ||\n        !this.isNullOrWhitespace(value.email)\n      ) {\n        cipher.type = CipherType.Identity;\n      }\n    } else {\n      // site or secure note\n      cipher.favorite = !this.organization && this.getValueOrDefault(value.fav, \"0\") === \"1\";\n      cipher.name = this.getValueOrDefault(value.name, \"--\");\n      cipher.type = value.url === \"http://sn\" ? CipherType.SecureNote : CipherType.Login;\n    }\n    return cipher;\n  }\n\n  private parseCard(value: any): CardView {\n    const card = new CardView();\n    card.cardholderName = this.getValueOrDefault(value.ccname);\n    card.number = this.getValueOrDefault(value.ccnum);\n    card.code = this.getValueOrDefault(value.cccsc);\n    card.brand = CardView.getCardBrandByPatterns(card.number);\n\n    if (!this.isNullOrWhitespace(value.ccexp) && value.ccexp.indexOf(\"-\") > -1) {\n      const ccexpParts = (value.ccexp as string).split(\"-\");\n      if (ccexpParts.length > 1) {\n        card.expYear = ccexpParts[0];\n        card.expMonth = ccexpParts[1];\n        if (card.expMonth.length === 2 && card.expMonth[0] === \"0\") {\n          card.expMonth = card.expMonth[1];\n        }\n      }\n    }\n\n    return card;\n  }\n\n  private parseIdentity(value: any): IdentityView {\n    const identity = new IdentityView();\n    identity.title = this.getValueOrDefault(value.title);\n    identity.firstName = this.getValueOrDefault(value.firstname);\n    identity.middleName = this.getValueOrDefault(value.middlename);\n    identity.lastName = this.getValueOrDefault(value.lastname);\n    identity.username = this.getValueOrDefault(value.username);\n    identity.company = this.getValueOrDefault(value.company);\n    identity.ssn = this.getValueOrDefault(value.ssn);\n    identity.address1 = this.getValueOrDefault(value.address1);\n    identity.address2 = this.getValueOrDefault(value.address2);\n    identity.address3 = this.getValueOrDefault(value.address3);\n    identity.city = this.getValueOrDefault(value.city);\n    identity.state = this.getValueOrDefault(value.state);\n    identity.postalCode = this.getValueOrDefault(value.zip);\n    identity.country = this.getValueOrDefault(value.country);\n    identity.email = this.getValueOrDefault(value.email);\n    identity.phone = this.getValueOrDefault(value.phone);\n\n    if (!this.isNullOrWhitespace(identity.title)) {\n      identity.title = identity.title.charAt(0).toUpperCase() + identity.title.slice(1);\n    }\n\n    return identity;\n  }\n\n  private parseSecureNote(value: any, cipher: CipherView) {\n    const extraParts = this.splitNewLine(value.extra);\n    let processedNote = false;\n\n    if (extraParts.length) {\n      const typeParts = extraParts[0].split(\":\");\n      if (\n        typeParts.length > 1 &&\n        typeParts[0] === \"NoteType\" &&\n        (typeParts[1] === \"Credit Card\" || typeParts[1] === \"Address\")\n      ) {\n        if (typeParts[1] === \"Credit Card\") {\n          const mappedData = this.parseSecureNoteMapping<CardView>(cipher, extraParts, {\n            Number: \"number\",\n            \"Name on Card\": \"cardholderName\",\n            \"Security Code\": \"code\",\n            // LP provides date in a format like 'June,2020'\n            // Store in expMonth, then parse and modify\n            \"Expiration Date\": \"expMonth\",\n          });\n\n          if (this.isNullOrWhitespace(mappedData.expMonth) || mappedData.expMonth === \",\") {\n            // No expiration data\n            mappedData.expMonth = undefined;\n          } else {\n            const [monthString, year] = mappedData.expMonth.split(\",\");\n            // Parse month name into number\n            if (!this.isNullOrWhitespace(monthString)) {\n              const month = new Date(Date.parse(monthString.trim() + \" 1, 2012\")).getMonth() + 1;\n              if (isNaN(month)) {\n                mappedData.expMonth = undefined;\n              } else {\n                mappedData.expMonth = month.toString();\n              }\n            } else {\n              mappedData.expMonth = undefined;\n            }\n            if (!this.isNullOrWhitespace(year)) {\n              mappedData.expYear = year;\n            }\n          }\n\n          cipher.type = CipherType.Card;\n          cipher.card = mappedData;\n        } else if (typeParts[1] === \"Address\") {\n          const mappedData = this.parseSecureNoteMapping<IdentityView>(cipher, extraParts, {\n            Title: \"title\",\n            \"First Name\": \"firstName\",\n            \"Last Name\": \"lastName\",\n            \"Middle Name\": \"middleName\",\n            Company: \"company\",\n            \"Address 1\": \"address1\",\n            \"Address 2\": \"address2\",\n            \"Address 3\": \"address3\",\n            \"City / Town\": \"city\",\n            State: \"state\",\n            \"Zip / Postal Code\": \"postalCode\",\n            Country: \"country\",\n            \"Email Address\": \"email\",\n            Username: \"username\",\n          });\n          cipher.type = CipherType.Identity;\n          cipher.identity = mappedData;\n        }\n        processedNote = true;\n      }\n    }\n\n    if (!processedNote) {\n      cipher.secureNote = new SecureNoteView();\n      cipher.secureNote.type = SecureNoteType.Generic;\n      cipher.notes = this.getValueOrDefault(value.extra);\n    }\n  }\n\n  private parseSecureNoteMapping<T>(cipher: CipherView, extraParts: string[], map: any): T {\n    const dataObj: any = {};\n\n    let processingNotes = false;\n    extraParts.forEach((extraPart) => {\n      let key: string = null;\n      let val: string = null;\n      if (!processingNotes) {\n        if (this.isNullOrWhitespace(extraPart)) {\n          return;\n        }\n        const colonIndex = extraPart.indexOf(\":\");\n        if (colonIndex === -1) {\n          key = extraPart;\n        } else {\n          key = extraPart.substring(0, colonIndex);\n          if (extraPart.length > colonIndex) {\n            val = extraPart.substring(colonIndex + 1);\n          }\n        }\n        if (this.isNullOrWhitespace(key) || this.isNullOrWhitespace(val) || key === \"NoteType\") {\n          return;\n        }\n      }\n\n      if (processingNotes) {\n        cipher.notes += \"\\n\" + extraPart;\n      } else if (key === \"Notes\") {\n        if (!this.isNullOrWhitespace(cipher.notes)) {\n          cipher.notes += \"\\n\" + val;\n        } else {\n          cipher.notes = val;\n        }\n        processingNotes = true;\n        // eslint-disable-next-line\n      } else if (map.hasOwnProperty(key)) {\n        dataObj[map[key]] = val;\n      } else {\n        this.processKvp(cipher, key, val);\n      }\n    });\n\n    return dataObj;\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class LogMeOnceCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 4) {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n      cipher.login.username = this.getValueOrDefault(value[2]);\n      cipher.login.password = this.getValueOrDefault(value[3]);\n      cipher.login.uris = this.makeUriArray(value[1]);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class MeldiumCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.DisplayName, \"--\");\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      cipher.login.username = this.getValueOrDefault(value.UserName);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.Url);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class MSecureCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 3) {\n        return;\n      }\n\n      const folderName =\n        this.getValueOrDefault(value[0], \"Unassigned\") !== \"Unassigned\" ? value[0] : null;\n      this.processFolder(result, folderName);\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[2], \"--\");\n\n      if (value[1] === \"Web Logins\" || value[1] === \"Login\") {\n        cipher.login.uris = this.makeUriArray(value[4]);\n        cipher.login.username = this.getValueOrDefault(value[5]);\n        cipher.login.password = this.getValueOrDefault(value[6]);\n        cipher.notes = !this.isNullOrWhitespace(value[3]) ? value[3].split(\"\\\\n\").join(\"\\n\") : null;\n      } else if (value.length > 3) {\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote = new SecureNoteView();\n        cipher.secureNote.type = SecureNoteType.Generic;\n        for (let i = 3; i < value.length; i++) {\n          if (!this.isNullOrWhitespace(value[i])) {\n            cipher.notes += value[i] + \"\\n\";\n          }\n        }\n      }\n\n      if (!this.isNullOrWhitespace(value[1]) && cipher.type !== CipherType.Login) {\n        cipher.name = value[1] + \": \" + cipher.name;\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nconst mappedBaseColumns = [\"nickname\", \"additionalInfo\"];\nconst _mappedUserAccountColumns = new Set(\n  mappedBaseColumns.concat([\"url\", \"username\", \"password\", \"twofaSecret\"]),\n);\nconst _mappedCreditCardColumns = new Set(\n  mappedBaseColumns.concat([\"cardNumber\", \"cardName\", \"exp_month\", \"exp_year\", \"cvv\"]),\n);\n\nconst _mappedIdentityColumns = new Set(\n  mappedBaseColumns.concat([\n    \"title\",\n    \"firstName\",\n    \"middleName\",\n    \"lastName\",\n    \"email\",\n    \"firstAddressLine\",\n    \"secondAddressLine\",\n    \"city\",\n    \"country\",\n    \"zipCode\",\n  ]),\n);\n\nconst _mappedIdCardColumns = new Set(mappedBaseColumns.concat([\"idName\", \"idNumber\", \"idCountry\"]));\n\nconst _mappedTwoFaColumns = new Set(mappedBaseColumns.concat([\"authToken\"]));\n\nconst _mappedUserNoteColumns = new Set(mappedBaseColumns.concat([\"content\"]));\n\nexport class MykiCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.nickname, \"--\");\n      cipher.notes = this.getValueOrDefault(value.additionalInfo);\n\n      if (value.url !== undefined) {\n        // Accounts\n        cipher.login.uris = this.makeUriArray(value.url);\n        cipher.login.username = this.getValueOrDefault(value.username);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.totp = this.getValueOrDefault(value.twofaSecret);\n\n        this.importUnmappedFields(cipher, value, _mappedUserAccountColumns);\n      } else if (value.authToken !== undefined) {\n        // TwoFA\n        cipher.login.totp = this.getValueOrDefault(value.authToken);\n\n        this.importUnmappedFields(cipher, value, _mappedTwoFaColumns);\n      } else if (value.cardNumber !== undefined) {\n        // Cards\n        cipher.card = new CardView();\n        cipher.type = CipherType.Card;\n        cipher.card.cardholderName = this.getValueOrDefault(value.cardName);\n        cipher.card.number = this.getValueOrDefault(value.cardNumber);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        cipher.card.expMonth = this.getValueOrDefault(value.exp_month);\n        cipher.card.expYear = this.getValueOrDefault(value.exp_year);\n        cipher.card.code = this.getValueOrDefault(value.cvv);\n\n        this.importUnmappedFields(cipher, value, _mappedCreditCardColumns);\n      } else if (value.firstName !== undefined) {\n        // Identities\n        cipher.identity = new IdentityView();\n        cipher.type = CipherType.Identity;\n        cipher.identity.title = this.getValueOrDefault(value.title);\n        cipher.identity.firstName = this.getValueOrDefault(value.firstName);\n        cipher.identity.middleName = this.getValueOrDefault(value.middleName);\n        cipher.identity.lastName = this.getValueOrDefault(value.lastName);\n        cipher.identity.phone = this.getValueOrDefault(value.number);\n        cipher.identity.email = this.getValueOrDefault(value.email);\n        cipher.identity.address1 = this.getValueOrDefault(value.firstAddressLine);\n        cipher.identity.address2 = this.getValueOrDefault(value.secondAddressLine);\n        cipher.identity.city = this.getValueOrDefault(value.city);\n        cipher.identity.country = this.getValueOrDefault(value.country);\n        cipher.identity.postalCode = this.getValueOrDefault(value.zipCode);\n\n        this.importUnmappedFields(cipher, value, _mappedIdentityColumns);\n      } else if (value.idType !== undefined) {\n        // IdCards\n\n        cipher.identity = new IdentityView();\n        cipher.type = CipherType.Identity;\n        this.processFullName(cipher, value.idName);\n        cipher.identity.country = this.getValueOrDefault(value.idCountry);\n\n        switch (value.idType) {\n          // case \"Driver's License\":\n          // case \"ID Card\":\n          // case \"Outdoor License\":\n          // case \"Software License\":\n          // case \"Tax Number\":\n          // case \"Bank Account\":\n          // case \"Insurance Card\":\n          // case \"Health Card\":\n          // case \"Membership\":\n          // case \"Database\":\n          // case \"Reward Program\":\n          // case \"Tour Visa\":\n          case \"Passport\":\n            cipher.identity.passportNumber = value.idNumber;\n            break;\n          case \"Social Security\":\n            cipher.identity.ssn = value.idNumber;\n            break;\n          default:\n            cipher.identity.licenseNumber = value.idNumber;\n            break;\n        }\n\n        this.importUnmappedFields(cipher, value, _mappedIdCardColumns);\n      } else if (value.content !== undefined) {\n        // Notes\n        cipher.secureNote = new SecureNoteView();\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote.type = SecureNoteType.Generic;\n        cipher.notes = this.getValueOrDefault(value.content);\n\n        this.importUnmappedFields(cipher, value, _mappedUserNoteColumns);\n      } else {\n        return;\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  importUnmappedFields(cipher: CipherView, row: any, mappedValues: Set<string>) {\n    const unmappedFields = Object.keys(row).filter((x) => !mappedValues.has(x));\n    unmappedFields.forEach((key) => {\n      const item = row as any;\n      this.processKvp(cipher, key, item[key]);\n    });\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\ntype nodePassCsvParsed = {\n  name: string;\n  url: string;\n  username: string;\n  password: string;\n  note: string;\n  cardholdername: string;\n  cardnumber: string;\n  cvc: string;\n  expirydate: string;\n  zipcode: string;\n  folder: string;\n  full_name: string;\n  phone_number: string;\n  email: string;\n  address1: string;\n  address2: string;\n  city: string;\n  country: string;\n  state: string;\n};\n\nexport class NordPassCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results: nodePassCsvParsed[] = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((record) => {\n      const recordType = this.evaluateType(record);\n      if (recordType === undefined) {\n        return;\n      }\n\n      if (!this.organization) {\n        this.processFolder(result, record.folder);\n      }\n\n      const cipher = new CipherView();\n      cipher.name = this.getValueOrDefault(record.name, \"--\");\n      cipher.notes = this.getValueOrDefault(record.note);\n\n      switch (recordType) {\n        case CipherType.Login:\n          cipher.type = CipherType.Login;\n          cipher.login = new LoginView();\n          cipher.login.username = this.getValueOrDefault(record.username);\n          cipher.login.password = this.getValueOrDefault(record.password);\n          cipher.login.uris = this.makeUriArray(record.url);\n          break;\n        case CipherType.Card:\n          cipher.type = CipherType.Card;\n          cipher.card.cardholderName = this.getValueOrDefault(record.cardholdername);\n          cipher.card.number = this.getValueOrDefault(record.cardnumber);\n          cipher.card.code = this.getValueOrDefault(record.cvc);\n          cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n          this.setCardExpiration(cipher, record.expirydate);\n          break;\n\n        case CipherType.Identity:\n          cipher.type = CipherType.Identity;\n\n          this.processFullName(cipher, this.getValueOrDefault(record.full_name));\n          cipher.identity.address1 = this.getValueOrDefault(record.address1);\n          cipher.identity.address2 = this.getValueOrDefault(record.address2);\n          cipher.identity.city = this.getValueOrDefault(record.city);\n          cipher.identity.state = this.getValueOrDefault(record.state);\n          cipher.identity.postalCode = this.getValueOrDefault(record.zipcode);\n          cipher.identity.country = this.getValueOrDefault(record.country);\n          if (cipher.identity.country != null) {\n            cipher.identity.country = cipher.identity.country.toUpperCase();\n          }\n          cipher.identity.email = this.getValueOrDefault(record.email);\n          cipher.identity.phone = this.getValueOrDefault(record.phone_number);\n          break;\n        case CipherType.SecureNote:\n          cipher.type = CipherType.SecureNote;\n          cipher.secureNote.type = SecureNoteType.Generic;\n          break;\n        default:\n          break;\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private evaluateType(record: nodePassCsvParsed): CipherType {\n    if (!this.isNullOrWhitespace(record.username)) {\n      return CipherType.Login;\n    }\n\n    if (!this.isNullOrWhitespace(record.cardnumber)) {\n      return CipherType.Card;\n    }\n\n    if (!this.isNullOrWhitespace(record.full_name)) {\n      return CipherType.Identity;\n    }\n\n    if (!this.isNullOrWhitespace(record.note)) {\n      return CipherType.SecureNote;\n    }\n\n    return undefined;\n  }\n}\n","import { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { PasswordHistoryView } from \"@bitwarden/common/vault/models/view/password-history.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nexport class OnePassword1PifImporter extends BaseImporter implements Importer {\n  result = new ImportResult();\n\n  parse(data: string): Promise<ImportResult> {\n    data.split(this.newLineRegex).forEach((line) => {\n      if (this.isNullOrWhitespace(line) || line[0] !== \"{\") {\n        return;\n      }\n      const item = JSON.parse(line);\n      if (item.trashed === true) {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n\n      if (this.isNullOrWhitespace(item.hmac)) {\n        this.processStandardItem(item, cipher);\n      } else {\n        this.processWinOpVaultItem(item, cipher);\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      this.result.ciphers.push(cipher);\n    });\n\n    this.result.success = true;\n    return Promise.resolve(this.result);\n  }\n\n  private processWinOpVaultItem(item: any, cipher: CipherView) {\n    if (item.overview != null) {\n      cipher.name = this.getValueOrDefault(item.overview.title);\n      if (item.overview.URLs != null) {\n        const urls: string[] = [];\n        item.overview.URLs.forEach((url: any) => {\n          if (!this.isNullOrWhitespace(url.u)) {\n            urls.push(url.u);\n          }\n        });\n        cipher.login.uris = this.makeUriArray(urls);\n      }\n    }\n\n    if (item.details != null) {\n      if (item.details.passwordHistory != null) {\n        this.parsePasswordHistory(item.details.passwordHistory, cipher);\n      }\n      if (\n        !this.isNullOrWhitespace(item.details.ccnum) ||\n        !this.isNullOrWhitespace(item.details.cvv)\n      ) {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n      } else if (\n        !this.isNullOrWhitespace(item.details.firstname) ||\n        !this.isNullOrWhitespace(item.details.address1)\n      ) {\n        cipher.type = CipherType.Identity;\n        cipher.identity = new IdentityView();\n      }\n      if (cipher.type === CipherType.Login && !this.isNullOrWhitespace(item.details.password)) {\n        cipher.login.password = item.details.password;\n      }\n      if (!this.isNullOrWhitespace(item.details.notesPlain)) {\n        cipher.notes = item.details.notesPlain.split(this.newLineRegex).join(\"\\n\") + \"\\n\";\n      }\n      if (item.details.fields != null) {\n        this.parseFields(item.details.fields, cipher, \"designation\", \"value\", \"name\");\n      }\n      if (item.details.sections != null) {\n        item.details.sections.forEach((section: any) => {\n          if (section.fields != null) {\n            this.parseFields(section.fields, cipher, \"n\", \"v\", \"t\");\n          }\n        });\n      }\n    }\n  }\n\n  private processStandardItem(item: any, cipher: CipherView) {\n    cipher.favorite = item.openContents && item.openContents.faveIndex ? true : false;\n    cipher.name = this.getValueOrDefault(item.title);\n\n    if (item.typeName === \"securenotes.SecureNote\") {\n      cipher.type = CipherType.SecureNote;\n      cipher.secureNote = new SecureNoteView();\n      cipher.secureNote.type = SecureNoteType.Generic;\n    } else if (item.typeName === \"wallet.financial.CreditCard\") {\n      cipher.type = CipherType.Card;\n      cipher.card = new CardView();\n    } else if (item.typeName === \"identities.Identity\") {\n      cipher.type = CipherType.Identity;\n      cipher.identity = new IdentityView();\n    } else {\n      cipher.login.uris = this.makeUriArray(item.location);\n    }\n\n    if (item.secureContents != null) {\n      if (item.secureContents.passwordHistory != null) {\n        this.parsePasswordHistory(item.secureContents.passwordHistory, cipher);\n      }\n      if (!this.isNullOrWhitespace(item.secureContents.notesPlain)) {\n        cipher.notes = item.secureContents.notesPlain.split(this.newLineRegex).join(\"\\n\") + \"\\n\";\n      }\n      if (cipher.type === CipherType.Login) {\n        if (!this.isNullOrWhitespace(item.secureContents.password)) {\n          cipher.login.password = item.secureContents.password;\n        }\n        if (item.secureContents.URLs != null) {\n          const urls: string[] = [];\n          item.secureContents.URLs.forEach((u: any) => {\n            if (!this.isNullOrWhitespace(u.url)) {\n              urls.push(u.url);\n            }\n          });\n          if (urls.length > 0) {\n            cipher.login.uris = this.makeUriArray(urls);\n          }\n        }\n      }\n      if (item.secureContents.fields != null) {\n        this.parseFields(item.secureContents.fields, cipher, \"designation\", \"value\", \"name\");\n      }\n      if (item.secureContents.sections != null) {\n        item.secureContents.sections.forEach((section: any) => {\n          if (section.fields != null) {\n            this.parseFields(section.fields, cipher, \"n\", \"v\", \"t\");\n          }\n        });\n      }\n    }\n  }\n\n  private parsePasswordHistory(items: any[], cipher: CipherView) {\n    const maxSize = items.length > 5 ? 5 : items.length;\n    cipher.passwordHistory = items\n      .filter((h: any) => !this.isNullOrWhitespace(h.value) && h.time != null)\n      .sort((a, b) => b.time - a.time)\n      .slice(0, maxSize)\n      .map((h: any) => {\n        const ph = new PasswordHistoryView();\n        ph.password = h.value;\n        ph.lastUsedDate = new Date((\"\" + h.time).length >= 13 ? h.time : h.time * 1000);\n        return ph;\n      });\n  }\n\n  private parseFields(\n    fields: any[],\n    cipher: CipherView,\n    designationKey: string,\n    valueKey: string,\n    nameKey: string,\n  ) {\n    fields.forEach((field: any) => {\n      if (field[valueKey] == null || field[valueKey].toString().trim() === \"\") {\n        return;\n      }\n\n      // TODO: when date FieldType exists, store this as a date field type instead of formatted Text if k is 'date'\n      const fieldValue =\n        field.k === \"date\"\n          ? new Date(field[valueKey] * 1000).toUTCString()\n          : field[valueKey].toString();\n      const fieldDesignation =\n        field[designationKey] != null ? field[designationKey].toString() : null;\n\n      if (cipher.type === CipherType.Login) {\n        if (this.isNullOrWhitespace(cipher.login.username) && fieldDesignation === \"username\") {\n          cipher.login.username = fieldValue;\n          return;\n        } else if (\n          this.isNullOrWhitespace(cipher.login.password) &&\n          fieldDesignation === \"password\"\n        ) {\n          cipher.login.password = fieldValue;\n          return;\n        } else if (\n          this.isNullOrWhitespace(cipher.login.totp) &&\n          fieldDesignation != null &&\n          fieldDesignation.startsWith(\"TOTP_\")\n        ) {\n          cipher.login.totp = fieldValue;\n          return;\n        }\n      } else if (cipher.type === CipherType.Card) {\n        if (this.isNullOrWhitespace(cipher.card.number) && fieldDesignation === \"ccnum\") {\n          cipher.card.number = fieldValue;\n          cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n          return;\n        } else if (this.isNullOrWhitespace(cipher.card.code) && fieldDesignation === \"cvv\") {\n          cipher.card.code = fieldValue;\n          return;\n        } else if (\n          this.isNullOrWhitespace(cipher.card.cardholderName) &&\n          fieldDesignation === \"cardholder\"\n        ) {\n          cipher.card.cardholderName = fieldValue;\n          return;\n        } else if (\n          this.isNullOrWhitespace(cipher.card.expiration) &&\n          fieldDesignation === \"expiry\" &&\n          fieldValue.length === 6\n        ) {\n          cipher.card.expMonth = (fieldValue as string).substr(4, 2);\n          if (cipher.card.expMonth[0] === \"0\") {\n            cipher.card.expMonth = cipher.card.expMonth.substr(1, 1);\n          }\n          cipher.card.expYear = (fieldValue as string).substr(0, 4);\n          return;\n        } else if (fieldDesignation === \"type\") {\n          // Skip since brand was determined from number above\n          return;\n        }\n      } else if (cipher.type === CipherType.Identity) {\n        const identity = cipher.identity;\n        if (this.isNullOrWhitespace(identity.firstName) && fieldDesignation === \"firstname\") {\n          identity.firstName = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.lastName) && fieldDesignation === \"lastname\") {\n          identity.lastName = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.middleName) && fieldDesignation === \"initial\") {\n          identity.middleName = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.phone) && fieldDesignation === \"defphone\") {\n          identity.phone = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.company) && fieldDesignation === \"company\") {\n          identity.company = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.email) && fieldDesignation === \"email\") {\n          identity.email = fieldValue;\n          return;\n        } else if (this.isNullOrWhitespace(identity.username) && fieldDesignation === \"username\") {\n          identity.username = fieldValue;\n          return;\n        } else if (fieldDesignation === \"address\") {\n          // fieldValue is an object casted into a string, so access the plain value instead\n          const { street, city, country, zip } = field[valueKey];\n          identity.address1 = this.getValueOrDefault(street);\n          identity.city = this.getValueOrDefault(city);\n          if (!this.isNullOrWhitespace(country)) {\n            identity.country = country.toUpperCase();\n          }\n          identity.postalCode = this.getValueOrDefault(zip);\n          return;\n        }\n      }\n\n      const fieldName = this.isNullOrWhitespace(field[nameKey]) ? \"no_name\" : field[nameKey];\n      if (\n        fieldName === \"password\" &&\n        cipher.passwordHistory != null &&\n        cipher.passwordHistory.some((h) => h.password === fieldValue)\n      ) {\n        return;\n      }\n\n      const fieldType = field.k === \"concealed\" ? FieldType.Hidden : FieldType.Text;\n      this.processKvp(cipher, fieldName, fieldValue, fieldType);\n    });\n  }\n}\n","export interface ExportData {\n  accounts?: AccountsEntity[] | null;\n}\nexport interface AccountsEntity {\n  attrs: AccountAttributes;\n  vaults?: VaultsEntity[] | null;\n}\nexport interface AccountAttributes {\n  accountName: string;\n  name: string;\n  avatar: string;\n  email: string;\n  uuid: string;\n  domain: string;\n}\nexport interface VaultsEntity {\n  attrs: VaultAttributes;\n  items?: Item[] | null;\n}\nexport interface VaultAttributes {\n  uuid: string;\n  desc: string;\n  avatar: string;\n  name: string;\n  type: string;\n}\n\nexport enum CategoryEnum {\n  Login = \"001\",\n  CreditCard = \"002\",\n  SecureNote = \"003\",\n  Identity = \"004\",\n  Password = \"005\",\n  Document = \"006\",\n  SoftwareLicense = \"100\",\n  BankAccount = \"101\",\n  Database = \"102\",\n  DriversLicense = \"103\",\n  OutdoorLicense = \"104\",\n  Membership = \"105\",\n  Passport = \"106\",\n  RewardsProgram = \"107\",\n  SocialSecurityNumber = \"108\",\n  WirelessRouter = \"109\",\n  Server = \"110\",\n  EmailAccount = \"111\",\n  API_Credential = \"112\",\n  MedicalRecord = \"113\",\n}\n\nexport interface Item {\n  uuid: string;\n  favIndex: number;\n  createdAt: number;\n  updatedAt: number;\n  trashed?: boolean;\n  categoryUuid: string;\n  details: Details;\n  overview: Overview;\n}\nexport interface Details {\n  loginFields?: (LoginFieldsEntity | null)[] | null;\n  notesPlain?: string | null;\n  sections?: (SectionsEntity | null)[] | null;\n  passwordHistory?: (PasswordHistoryEntity | null)[] | null;\n  documentAttributes?: DocumentAttributes | null;\n  password?: string | null;\n}\n\nexport enum LoginFieldTypeEnum {\n  TextOrHtml = \"T\",\n  EmailAddress = \"E\",\n  URL = \"U\",\n  Number = \"N\",\n  Password = \"P\",\n  TextArea = \"A\",\n  PhoneNumber = \"TEL\",\n  CheckBox = \"C\",\n}\nexport interface LoginFieldsEntity {\n  value: string;\n  id: string;\n  name: string;\n  fieldType: LoginFieldTypeEnum | string;\n  designation?: string | null;\n}\nexport interface SectionsEntity {\n  title: string;\n  name?: string | null;\n  fields?: FieldsEntity[] | null;\n}\nexport interface FieldsEntity {\n  title: string;\n  id: string;\n  value: Value;\n  indexAtSource: number;\n  guarded: boolean;\n  multiline: boolean;\n  dontGenerate: boolean;\n  placeholder?: string;\n  inputTraits: InputTraits;\n  clipboardFilter?: string | null;\n}\nexport interface Value {\n  totp?: string | null;\n  date?: number | null;\n  string?: string | null;\n  concealed?: string | null;\n  email?: Email | null;\n  phone?: string | null;\n  menu?: string | null;\n  gender?: string | null;\n  monthYear?: number | null;\n  url?: string | null;\n  address?: Address | null;\n  creditCardType?: string | null;\n  creditCardNumber?: string | null;\n  reference?: string | null;\n}\n\nexport interface Email {\n  email_address: string;\n  provider: string;\n}\n\nexport interface Address {\n  street: string;\n  city: string;\n  country: string;\n  zip: string;\n  state: string;\n}\nexport interface InputTraits {\n  keyboard: string;\n  correction: string;\n  capitalization: string;\n}\nexport interface PasswordHistoryEntity {\n  value: string;\n  time: number;\n}\nexport interface DocumentAttributes {\n  fileName: string;\n  documentId: string;\n  decryptedSize: number;\n}\nexport interface Overview {\n  subtitle: string;\n  title: string;\n  url: string;\n  urls?: UrlsEntity[] | null;\n  ps?: number | null;\n  pbe?: number | null;\n  pgrng?: boolean | null;\n  tags?: string[] | null;\n}\nexport interface UrlsEntity {\n  label: string;\n  url: string;\n}\n","import { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRepromptType } from \"@bitwarden/common/vault/enums/cipher-reprompt-type\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\nimport { PasswordHistoryView } from \"@bitwarden/common/vault/models/view/password-history.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport {\n  CategoryEnum,\n  Details,\n  ExportData,\n  FieldsEntity,\n  Item,\n  LoginFieldTypeEnum,\n  Overview,\n  PasswordHistoryEntity,\n  SectionsEntity,\n  UrlsEntity,\n  Value,\n  VaultsEntity,\n} from \"./types/onepassword-1pux-importer-types\";\n\nexport class OnePassword1PuxImporter extends BaseImporter implements Importer {\n  result = new ImportResult();\n\n  parse(data: string): Promise<ImportResult> {\n    const exportData: ExportData = JSON.parse(data);\n\n    const account = exportData.accounts[0];\n    // TODO Add handling of multiple vaults\n    // const personalVaults = account.vaults[0].filter((v) => v.attrs.type === VaultAttributeTypeEnum.Personal);\n    account.vaults.forEach((vault: VaultsEntity) => {\n      vault.items.forEach((item: Item) => {\n        if (item.trashed === true) {\n          return;\n        }\n\n        const cipher = this.initLoginCipher();\n\n        const category = item.categoryUuid as CategoryEnum;\n        switch (category) {\n          case CategoryEnum.Login:\n          case CategoryEnum.Database:\n          case CategoryEnum.Password:\n          case CategoryEnum.WirelessRouter:\n          case CategoryEnum.Server:\n          case CategoryEnum.API_Credential:\n            cipher.type = CipherType.Login;\n            cipher.login = new LoginView();\n            break;\n          case CategoryEnum.CreditCard:\n          case CategoryEnum.BankAccount:\n            cipher.type = CipherType.Card;\n            cipher.card = new CardView();\n            break;\n          case CategoryEnum.SecureNote:\n          case CategoryEnum.SoftwareLicense:\n          case CategoryEnum.EmailAccount:\n          case CategoryEnum.MedicalRecord:\n            // case CategoryEnum.Document:\n            cipher.type = CipherType.SecureNote;\n            cipher.secureNote = new SecureNoteView();\n            cipher.secureNote.type = SecureNoteType.Generic;\n            break;\n          case CategoryEnum.Identity:\n          case CategoryEnum.DriversLicense:\n          case CategoryEnum.OutdoorLicense:\n          case CategoryEnum.Membership:\n          case CategoryEnum.Passport:\n          case CategoryEnum.RewardsProgram:\n          case CategoryEnum.SocialSecurityNumber:\n            cipher.type = CipherType.Identity;\n            cipher.identity = new IdentityView();\n            break;\n          default:\n            break;\n        }\n\n        cipher.favorite = item.favIndex === 1 ? true : false;\n\n        this.processOverview(item.overview, cipher);\n\n        this.processLoginFields(item, cipher);\n\n        this.processDetails(category, item.details, cipher);\n\n        this.parsePasswordHistory(item.details.passwordHistory, cipher);\n\n        this.processSections(category, item.details.sections, cipher);\n\n        if (!this.isNullOrWhitespace(item.details.notesPlain)) {\n          cipher.notes = item.details.notesPlain.split(this.newLineRegex).join(\"\\n\") + \"\\n\";\n        }\n\n        this.convertToNoteIfNeeded(cipher);\n        this.cleanupCipher(cipher);\n        this.result.ciphers.push(cipher);\n      });\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(this.result);\n    }\n\n    this.result.success = true;\n    return Promise.resolve(this.result);\n  }\n\n  private processOverview(overview: Overview, cipher: CipherView) {\n    if (overview == null) {\n      return;\n    }\n\n    cipher.name = this.getValueOrDefault(overview.title);\n\n    if (overview.urls != null) {\n      const urls: string[] = [];\n      overview.urls.forEach((url: UrlsEntity) => {\n        if (!this.isNullOrWhitespace(url.url)) {\n          urls.push(url.url);\n        }\n      });\n      cipher.login.uris = this.makeUriArray(urls);\n    }\n\n    if (overview.tags != null && overview.tags.length > 0) {\n      const folderName = this.capitalize(overview.tags[0]);\n      this.processFolder(this.result, folderName);\n    }\n  }\n\n  private capitalize(inputString: string): string {\n    return inputString.trim().replace(/\\w\\S*/g, (w) => w.replace(/^\\w/, (c) => c.toUpperCase()));\n  }\n\n  private processLoginFields(item: Item, cipher: CipherView) {\n    if (item.details == null) {\n      return;\n    }\n\n    if (item.details.loginFields == null || item.details.loginFields.length === 0) {\n      return;\n    }\n\n    item.details.loginFields.forEach((loginField) => {\n      if (loginField.designation === \"username\" && loginField.value !== \"\") {\n        cipher.type = CipherType.Login;\n        cipher.login.username = loginField.value;\n        return;\n      }\n\n      if (loginField.designation === \"password\" && loginField.value !== \"\") {\n        cipher.type = CipherType.Login;\n        cipher.login.password = loginField.value;\n        return;\n      }\n\n      let fieldValue = loginField.value;\n      let fieldType: FieldType = FieldType.Text;\n      switch (loginField.fieldType) {\n        case LoginFieldTypeEnum.Password:\n          fieldType = FieldType.Hidden;\n          break;\n        case LoginFieldTypeEnum.CheckBox:\n          fieldValue = loginField.value !== \"\" ? \"true\" : \"false\";\n          fieldType = FieldType.Boolean;\n          break;\n        default:\n          break;\n      }\n      this.processKvp(cipher, loginField.name, fieldValue, fieldType);\n    });\n  }\n\n  private processDetails(category: CategoryEnum, details: Details, cipher: CipherView) {\n    if (category !== CategoryEnum.Password) {\n      return;\n    }\n\n    if (details == null) {\n      return;\n    }\n    cipher.login.password = details.password;\n  }\n\n  private processSections(category: CategoryEnum, sections: SectionsEntity[], cipher: CipherView) {\n    if (sections == null || sections.length === 0) {\n      return;\n    }\n\n    sections.forEach((section: SectionsEntity) => {\n      if (section.fields == null) {\n        return;\n      }\n\n      this.parseSectionFields(category, section.fields, cipher, section.title);\n    });\n  }\n\n  private parseSectionFields(\n    category: CategoryEnum,\n    fields: FieldsEntity[],\n    cipher: CipherView,\n    sectionTitle: string,\n  ) {\n    fields.forEach((field: FieldsEntity) => {\n      const valueKey = Object.keys(field.value)[0];\n      const anyField = field as any;\n\n      if (\n        anyField.value == null ||\n        anyField.value[valueKey] == null ||\n        anyField.value[valueKey] === \"\"\n      ) {\n        return;\n      }\n\n      const fieldName = this.getFieldName(field.title, sectionTitle);\n      const fieldValue = this.extractValue(field.value, valueKey);\n\n      if (cipher.type === CipherType.Login) {\n        if (this.fillLogin(field, fieldValue, cipher)) {\n          return;\n        }\n\n        switch (category) {\n          case CategoryEnum.Login:\n          case CategoryEnum.Database:\n          case CategoryEnum.EmailAccount:\n          case CategoryEnum.WirelessRouter:\n            break;\n\n          case CategoryEnum.Server:\n            if (this.isNullOrWhitespace(cipher.login.uri) && field.id === \"url\") {\n              cipher.login.uris = this.makeUriArray(fieldValue);\n              return;\n            }\n            break;\n\n          case CategoryEnum.API_Credential:\n            if (this.fillApiCredentials(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          default:\n            break;\n        }\n      } else if (cipher.type === CipherType.Card) {\n        if (this.fillCreditCard(field, fieldValue, cipher)) {\n          return;\n        }\n\n        if (category === CategoryEnum.BankAccount) {\n          if (this.fillBankAccount(field, fieldValue, cipher)) {\n            return;\n          }\n        }\n      } else if (cipher.type === CipherType.Identity) {\n        if (this.fillIdentity(field, fieldValue, cipher, valueKey)) {\n          return;\n        }\n        if (valueKey === \"address\") {\n          // fieldValue is an object casted into a string, so access the plain value instead\n          const { street, city, country, zip, state } = field.value.address;\n          cipher.identity.address1 = this.getValueOrDefault(street);\n          cipher.identity.city = this.getValueOrDefault(city);\n          if (!this.isNullOrWhitespace(country)) {\n            cipher.identity.country = country.toUpperCase();\n          }\n          cipher.identity.postalCode = this.getValueOrDefault(zip);\n          cipher.identity.state = this.getValueOrDefault(state);\n          return;\n        }\n\n        switch (category) {\n          case CategoryEnum.Identity:\n            break;\n          case CategoryEnum.DriversLicense:\n            if (this.fillDriversLicense(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.OutdoorLicense:\n            if (this.fillOutdoorLicense(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.Membership:\n            if (this.fillMembership(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.Passport:\n            if (this.fillPassport(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.RewardsProgram:\n            if (this.fillRewardsProgram(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          case CategoryEnum.SocialSecurityNumber:\n            if (this.fillSSN(field, fieldValue, cipher)) {\n              return;\n            }\n            break;\n          default:\n            break;\n        }\n      }\n\n      if (valueKey === \"email\") {\n        // fieldValue is an object casted into a string, so access the plain value instead\n        const { email_address, provider } = field.value.email;\n        this.processKvp(cipher, fieldName, email_address, FieldType.Text);\n        this.processKvp(cipher, \"provider\", provider, FieldType.Text);\n        return;\n      }\n\n      // Do not include a password field if it's already in the history\n      if (\n        field.title === \"password\" &&\n        cipher.passwordHistory != null &&\n        cipher.passwordHistory.some((h) => h.password === fieldValue)\n      ) {\n        return;\n      }\n\n      // TODO ?? If one of the fields is marked as guarded, then activate Password-Reprompt for the entire item\n      if (field.guarded && cipher.reprompt === CipherRepromptType.None) {\n        cipher.reprompt = CipherRepromptType.Password;\n      }\n\n      const fieldType = valueKey === \"concealed\" ? FieldType.Hidden : FieldType.Text;\n      this.processKvp(cipher, fieldName, fieldValue, fieldType);\n    });\n  }\n\n  // Use the title if available. If not use the sectionTitle if available.\n  // Default to an empty string in all other cases.\n  private getFieldName(title: string, sectionTitle?: string): string {\n    if (!this.isNullOrWhitespace(title)) {\n      return title;\n    }\n\n    if (!this.isNullOrWhitespace(sectionTitle)) {\n      return sectionTitle;\n    }\n\n    return \"\";\n  }\n\n  private extractValue(value: Value, valueKey: string): string {\n    if (valueKey === \"date\") {\n      return new Date(value.date * 1000).toUTCString();\n    }\n\n    if (valueKey === \"monthYear\") {\n      return value.monthYear.toString();\n    }\n\n    return (value as any)[valueKey];\n  }\n\n  private fillLogin(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    const fieldName = this.getFieldName(field.title);\n\n    if (this.isNullOrWhitespace(cipher.login.username) && fieldName === \"username\") {\n      cipher.login.username = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.login.password) && fieldName === \"password\") {\n      cipher.login.password = fieldValue;\n      return true;\n    }\n\n    if (\n      this.isNullOrWhitespace(cipher.login.totp) &&\n      field.id != null &&\n      field.id.startsWith(\"TOTP_\")\n    ) {\n      cipher.login.totp = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillApiCredentials(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    const fieldName = this.getFieldName(field.title);\n\n    if (this.isNullOrWhitespace(cipher.login.password) && fieldName === \"credential\") {\n      cipher.login.password = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.login.uri) && fieldName === \"hostname\") {\n      cipher.login.uris = this.makeUriArray(fieldValue);\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillCreditCard(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.card.number) && field.id === \"ccnum\") {\n      cipher.card.number = fieldValue;\n      cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.card.code) && field.id === \"cvv\") {\n      cipher.card.code = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.card.cardholderName) && field.id === \"cardholder\") {\n      cipher.card.cardholderName = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.card.expiration) && field.id === \"expiry\") {\n      const monthYear: string = fieldValue.toString().trim();\n      cipher.card.expMonth = monthYear.substring(4, 6);\n      if (cipher.card.expMonth[0] === \"0\") {\n        cipher.card.expMonth = cipher.card.expMonth.substring(1, 2);\n      }\n      cipher.card.expYear = monthYear.substring(0, 4);\n      return true;\n    }\n\n    if (field.id === \"type\") {\n      // Skip since brand was determined from number above\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillBankAccount(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.card.cardholderName) && field.id === \"owner\") {\n      cipher.card.cardholderName = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillIdentity(\n    field: FieldsEntity,\n    fieldValue: string,\n    cipher: CipherView,\n    valueKey: string,\n  ): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"firstname\") {\n      cipher.identity.firstName = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.lastName) && field.id === \"lastname\") {\n      cipher.identity.lastName = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.middleName) && field.id === \"initial\") {\n      cipher.identity.middleName = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.phone) && field.id === \"defphone\") {\n      cipher.identity.phone = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.company) && field.id === \"company\") {\n      cipher.identity.company = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.email)) {\n      if (valueKey === \"email\") {\n        const { email_address, provider } = field.value.email;\n        cipher.identity.email = this.getValueOrDefault(email_address);\n        this.processKvp(cipher, \"provider\", provider, FieldType.Text);\n        return true;\n      }\n\n      if (field.id === \"email\") {\n        cipher.identity.email = fieldValue;\n        return true;\n      }\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.username) && field.id === \"username\") {\n      cipher.identity.username = fieldValue;\n      return true;\n    }\n    return false;\n  }\n\n  private fillDriversLicense(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"fullname\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.address1) && field.id === \"address\") {\n      cipher.identity.address1 = fieldValue;\n      return true;\n    }\n\n    // TODO ISO code\n    if (this.isNullOrWhitespace(cipher.identity.country) && field.id === \"country\") {\n      cipher.identity.country = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.state) && field.id === \"state\") {\n      cipher.identity.state = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.licenseNumber) && field.id === \"number\") {\n      cipher.identity.licenseNumber = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillOutdoorLicense(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"name\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    // TODO ISO code\n    if (this.isNullOrWhitespace(cipher.identity.country) && field.id === \"country\") {\n      cipher.identity.country = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.state) && field.id === \"state\") {\n      cipher.identity.state = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillMembership(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"member_name\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.company) && field.id === \"org_name\") {\n      cipher.identity.company = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.phone) && field.id === \"phone\") {\n      cipher.identity.phone = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillPassport(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"fullname\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    // TODO Iso\n    if (this.isNullOrWhitespace(cipher.identity.country) && field.id === \"issuing_country\") {\n      cipher.identity.country = fieldValue;\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.passportNumber) && field.id === \"number\") {\n      cipher.identity.passportNumber = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillRewardsProgram(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"member_name\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.company) && field.id === \"company_name\") {\n      cipher.identity.company = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private fillSSN(field: FieldsEntity, fieldValue: string, cipher: CipherView): boolean {\n    if (this.isNullOrWhitespace(cipher.identity.firstName) && field.id === \"name\") {\n      this.processFullName(cipher, fieldValue);\n      return true;\n    }\n\n    if (this.isNullOrWhitespace(cipher.identity.ssn) && field.id === \"number\") {\n      cipher.identity.ssn = fieldValue;\n      return true;\n    }\n\n    return false;\n  }\n\n  private parsePasswordHistory(historyItems: PasswordHistoryEntity[], cipher: CipherView) {\n    if (historyItems == null || historyItems.length === 0) {\n      return;\n    }\n\n    const maxSize = historyItems.length > 5 ? 5 : historyItems.length;\n    cipher.passwordHistory = historyItems\n      .filter((h: any) => !this.isNullOrWhitespace(h.value) && h.time != null)\n      .sort((a, b) => b.time - a.time)\n      .slice(0, maxSize)\n      .map((h: any) => {\n        const ph = new PasswordHistoryView();\n        ph.password = h.value;\n        ph.lastUsedDate = new Date((\"\" + h.time).length >= 13 ? h.time : h.time * 1000);\n        return ph;\n      });\n  }\n}\n","import { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nexport class CipherImportContext {\n  lowerProperty: string;\n  constructor(\n    public importRecord: any,\n    public property: string,\n    public cipher: CipherView,\n  ) {\n    this.lowerProperty = property.toLowerCase();\n  }\n}\n","import { FieldType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport { CipherImportContext } from \"./cipher-import-context\";\n\nexport const IgnoredProperties = [\n  \"ainfo\",\n  \"autosubmit\",\n  \"notesplain\",\n  \"ps\",\n  \"scope\",\n  \"tags\",\n  \"title\",\n  \"uuid\",\n  \"notes\",\n];\n\nexport abstract class OnePasswordCsvImporter extends BaseImporter implements Importer {\n  protected loginPropertyParsers = [\n    this.setLoginUsername,\n    this.setLoginPassword,\n    this.setLoginUris,\n  ];\n  protected creditCardPropertyParsers = [\n    this.setCreditCardNumber,\n    this.setCreditCardVerification,\n    this.setCreditCardCardholderName,\n    this.setCreditCardExpiry,\n  ];\n  protected identityPropertyParsers = [\n    this.setIdentityFirstName,\n    this.setIdentityInitial,\n    this.setIdentityLastName,\n    this.setIdentityUserName,\n    this.setIdentityEmail,\n    this.setIdentityPhone,\n    this.setIdentityCompany,\n  ];\n\n  abstract setCipherType(value: any, cipher: CipherView): void;\n\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true, {\n      quoteChar: '\"',\n      escapeChar: \"\\\\\",\n    });\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (this.isNullOrWhitespace(this.getProp(value, \"title\"))) {\n        return;\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(this.getProp(value, \"title\"), \"--\");\n\n      this.setNotes(value, cipher);\n\n      this.setCipherType(value, cipher);\n\n      let altUsername: string = null;\n      for (const property in value) {\n        // eslint-disable-next-line\n        if (!value.hasOwnProperty(property) || this.isNullOrWhitespace(value[property])) {\n          continue;\n        }\n\n        const context = new CipherImportContext(value, property, cipher);\n        if (cipher.type === CipherType.Login && this.setKnownLoginValue(context)) {\n          continue;\n        } else if (cipher.type === CipherType.Card && this.setKnownCreditCardValue(context)) {\n          continue;\n        } else if (cipher.type === CipherType.Identity && this.setKnownIdentityValue(context)) {\n          continue;\n        }\n\n        altUsername = this.setUnknownValue(context, altUsername);\n      }\n\n      if (\n        cipher.type === CipherType.Login &&\n        !this.isNullOrWhitespace(altUsername) &&\n        this.isNullOrWhitespace(cipher.login.username) &&\n        altUsername.indexOf(\"://\") === -1\n      ) {\n        cipher.login.username = altUsername;\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  protected getProp(obj: any, name: string): any {\n    const lowerObj = Object.entries(obj).reduce((agg: any, entry: [string, any]) => {\n      agg[entry[0].toLowerCase()] = entry[1];\n      return agg;\n    }, {});\n    return lowerObj[name.toLowerCase()];\n  }\n\n  protected getPropByRegexp(obj: any, regexp: RegExp): any {\n    const matchingKeys = Object.keys(obj).reduce((agg: string[], key: string) => {\n      if (key.match(regexp)) {\n        agg.push(key);\n      }\n      return agg;\n    }, []);\n    if (matchingKeys.length === 0) {\n      return null;\n    } else {\n      return obj[matchingKeys[0]];\n    }\n  }\n\n  protected getPropIncluding(obj: any, name: string): any {\n    const includesMap = Object.keys(obj).reduce((agg: string[], entry: string) => {\n      if (entry.toLowerCase().includes(name.toLowerCase())) {\n        agg.push(entry);\n      }\n      return agg;\n    }, []);\n    if (includesMap.length === 0) {\n      return null;\n    } else {\n      return obj[includesMap[0]];\n    }\n  }\n\n  protected setNotes(importRecord: any, cipher: CipherView) {\n    cipher.notes =\n      this.getValueOrDefault(this.getProp(importRecord, \"notesPlain\"), \"\") +\n      \"\\n\" +\n      this.getValueOrDefault(this.getProp(importRecord, \"notes\"), \"\") +\n      \"\\n\";\n    cipher.notes.trim();\n  }\n\n  protected setKnownLoginValue(context: CipherImportContext): boolean {\n    return this.loginPropertyParsers.reduce((agg: boolean, func) => {\n      if (!agg) {\n        agg = func.bind(this)(context);\n      }\n      return agg;\n    }, false);\n  }\n\n  protected setKnownCreditCardValue(context: CipherImportContext): boolean {\n    return this.creditCardPropertyParsers.reduce((agg: boolean, func) => {\n      if (!agg) {\n        agg = func.bind(this)(context);\n      }\n      return agg;\n    }, false);\n  }\n\n  protected setKnownIdentityValue(context: CipherImportContext): boolean {\n    return this.identityPropertyParsers.reduce((agg: boolean, func) => {\n      if (!agg) {\n        agg = func.bind(this)(context);\n      }\n      return agg;\n    }, false);\n  }\n\n  protected setUnknownValue(context: CipherImportContext, altUsername: string): string {\n    if (\n      IgnoredProperties.indexOf(context.lowerProperty) === -1 &&\n      !context.lowerProperty.startsWith(\"section:\") &&\n      !context.lowerProperty.startsWith(\"section \")\n    ) {\n      if (altUsername == null && context.lowerProperty === \"email\") {\n        return context.importRecord[context.property];\n      } else if (\n        context.lowerProperty === \"created date\" ||\n        context.lowerProperty === \"modified date\"\n      ) {\n        const readableDate = new Date(\n          parseInt(context.importRecord[context.property], 10) * 1000,\n        ).toUTCString();\n        this.processKvp(context.cipher, \"1Password \" + context.property, readableDate);\n        return null;\n      }\n      if (\n        context.lowerProperty.includes(\"password\") ||\n        context.lowerProperty.includes(\"key\") ||\n        context.lowerProperty.includes(\"secret\")\n      ) {\n        this.processKvp(\n          context.cipher,\n          context.property,\n          context.importRecord[context.property],\n          FieldType.Hidden,\n        );\n      } else {\n        this.processKvp(context.cipher, context.property, context.importRecord[context.property]);\n      }\n    }\n    return null;\n  }\n\n  protected setIdentityFirstName(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.firstName) &&\n      context.lowerProperty.includes(\"first name\")\n    ) {\n      context.cipher.identity.firstName = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityInitial(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.middleName) &&\n      context.lowerProperty.includes(\"initial\")\n    ) {\n      context.cipher.identity.middleName = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityLastName(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.lastName) &&\n      context.lowerProperty.includes(\"last name\")\n    ) {\n      context.cipher.identity.lastName = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityUserName(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.username) &&\n      context.lowerProperty.includes(\"username\")\n    ) {\n      context.cipher.identity.username = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityCompany(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.company) &&\n      context.lowerProperty.includes(\"company\")\n    ) {\n      context.cipher.identity.company = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityPhone(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.phone) &&\n      context.lowerProperty.includes(\"default phone\")\n    ) {\n      context.cipher.identity.phone = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setIdentityEmail(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.identity.email) &&\n      context.lowerProperty.includes(\"email\")\n    ) {\n      context.cipher.identity.email = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setCreditCardNumber(context: CipherImportContext): boolean {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.number) &&\n      context.lowerProperty.includes(\"number\")\n    ) {\n      context.cipher.card.number = context.importRecord[context.property];\n      context.cipher.card.brand = CardView.getCardBrandByPatterns(context.cipher.card.number);\n      return true;\n    }\n    return false;\n  }\n\n  protected setCreditCardVerification(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.code) &&\n      context.lowerProperty.includes(\"verification number\")\n    ) {\n      context.cipher.card.code = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setCreditCardCardholderName(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.cardholderName) &&\n      context.lowerProperty.includes(\"cardholder name\")\n    ) {\n      context.cipher.card.cardholderName = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setCreditCardExpiry(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.expiration) &&\n      context.lowerProperty.includes(\"expiry date\") &&\n      context.importRecord[context.property].length === 7\n    ) {\n      context.cipher.card.expMonth = (context.importRecord[context.property] as string).substr(\n        0,\n        2,\n      );\n      if (context.cipher.card.expMonth[0] === \"0\") {\n        context.cipher.card.expMonth = context.cipher.card.expMonth.substr(1, 1);\n      }\n      context.cipher.card.expYear = (context.importRecord[context.property] as string).substr(3, 4);\n      return true;\n    }\n    return false;\n  }\n\n  protected setLoginPassword(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.login.password) &&\n      context.lowerProperty === \"password\"\n    ) {\n      context.cipher.login.password = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setLoginUsername(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.login.username) &&\n      context.lowerProperty === \"username\"\n    ) {\n      context.cipher.login.username = context.importRecord[context.property];\n      return true;\n    }\n    return false;\n  }\n\n  protected setLoginUris(context: CipherImportContext) {\n    if (\n      (context.cipher.login.uris == null || context.cipher.login.uris.length === 0) &&\n      context.lowerProperty === \"urls\"\n    ) {\n      const urls = context.importRecord[context.property].split(this.newLineRegex);\n      context.cipher.login.uris = this.makeUriArray(urls);\n      return true;\n    } else if (context.lowerProperty === \"url\") {\n      if (context.cipher.login.uris == null) {\n        context.cipher.login.uris = [];\n      }\n      context.cipher.login.uris.concat(this.makeUriArray(context.importRecord[context.property]));\n      return true;\n    }\n    return false;\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\n\nimport { Importer } from \"../importer\";\n\nimport { IgnoredProperties, OnePasswordCsvImporter } from \"./onepassword-csv-importer\";\n\nexport class OnePasswordMacCsvImporter extends OnePasswordCsvImporter implements Importer {\n  setCipherType(value: any, cipher: CipherView) {\n    const onePassType = this.getValueOrDefault(this.getProp(value, \"type\"), \"Login\");\n    switch (onePassType) {\n      case \"Credit Card\":\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n        IgnoredProperties.push(\"type\");\n        break;\n      case \"Identity\":\n        cipher.type = CipherType.Identity;\n        cipher.identity = new IdentityView();\n        IgnoredProperties.push(\"type\");\n        break;\n      case \"Login\":\n      case \"Secure Note\":\n        IgnoredProperties.push(\"type\");\n        break;\n      default:\n        break;\n    }\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { IdentityView } from \"@bitwarden/common/vault/models/view/identity.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { Importer } from \"../importer\";\n\nimport { CipherImportContext } from \"./cipher-import-context\";\nimport { OnePasswordCsvImporter } from \"./onepassword-csv-importer\";\n\nexport class OnePasswordWinCsvImporter extends OnePasswordCsvImporter implements Importer {\n  constructor() {\n    super();\n    this.identityPropertyParsers.push(this.setIdentityAddress);\n  }\n\n  setCipherType(value: any, cipher: CipherView) {\n    cipher.type = CipherType.Login;\n    cipher.login = new LoginView();\n\n    if (\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /\\d+: number/i)) &&\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /\\d+: expiry date/i))\n    ) {\n      cipher.type = CipherType.Card;\n      cipher.card = new CardView();\n    }\n\n    if (\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /name \\d+: first name/i)) ||\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /name \\d+: initial/i)) ||\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /name \\d+: last name/i)) ||\n      !this.isNullOrWhitespace(this.getPropByRegexp(value, /internet \\d+: email/i))\n    ) {\n      cipher.type = CipherType.Identity;\n      cipher.identity = new IdentityView();\n    }\n  }\n\n  setIdentityAddress(context: CipherImportContext) {\n    if (context.lowerProperty.match(/address \\d+: address/i)) {\n      this.processKvp(context.cipher, \"address\", context.importRecord[context.property]);\n      return true;\n    }\n    return false;\n  }\n\n  setCreditCardExpiry(context: CipherImportContext) {\n    if (\n      this.isNullOrWhitespace(context.cipher.card.expiration) &&\n      context.lowerProperty.includes(\"expiry date\")\n    ) {\n      const expSplit = (context.importRecord[context.property] as string).split(\"/\");\n      context.cipher.card.expMonth = expSplit[0];\n      if (context.cipher.card.expMonth[0] === \"0\" && context.cipher.card.expMonth.length === 2) {\n        context.cipher.card.expMonth = context.cipher.card.expMonth.substr(1, 1);\n      }\n      context.cipher.card.expYear = expSplit[2].length > 4 ? expSplit[2].substr(0, 4) : expSplit[2];\n      return true;\n    }\n    return false;\n  }\n}\n","import { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PadlockCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    let headers: string[] = null;\n    results.forEach((value) => {\n      if (headers == null) {\n        headers = value.map((v: string) => v);\n        return;\n      }\n\n      if (value.length < 2 || value.length !== headers.length) {\n        return;\n      }\n\n      if (!this.isNullOrWhitespace(value[1])) {\n        if (this.organization) {\n          const tags = (value[1] as string).split(\",\");\n          tags.forEach((tag) => {\n            tag = tag.trim();\n            let addCollection = true;\n            let collectionIndex = result.collections.length;\n\n            for (let i = 0; i < result.collections.length; i++) {\n              if (result.collections[i].name === tag) {\n                addCollection = false;\n                collectionIndex = i;\n                break;\n              }\n            }\n\n            if (addCollection) {\n              const collection = new CollectionView();\n              collection.name = tag;\n              result.collections.push(collection);\n            }\n\n            result.collectionRelationships.push([result.ciphers.length, collectionIndex]);\n          });\n        } else {\n          const tags = (value[1] as string).split(\",\");\n          const tag = tags.length > 0 ? tags[0].trim() : null;\n          this.processFolder(result, tag);\n        }\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n\n      for (let i = 2; i < value.length; i++) {\n        const header = headers[i].trim().toLowerCase();\n        if (this.isNullOrWhitespace(value[i]) || this.isNullOrWhitespace(header)) {\n          continue;\n        }\n\n        if (this.usernameFieldNames.indexOf(header) > -1) {\n          cipher.login.username = value[i];\n        } else if (this.passwordFieldNames.indexOf(header) > -1) {\n          cipher.login.password = value[i];\n        } else if (this.uriFieldNames.indexOf(header) > -1) {\n          cipher.login.uris = this.makeUriArray(value[i]);\n        } else {\n          this.processKvp(cipher, headers[i], value[i]);\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PassKeepCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      this.processFolder(result, this.getValue(\"category\", value));\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValue(\"description\", value);\n      cipher.name = this.getValueOrDefault(this.getValue(\"title\", value), \"--\");\n      cipher.login.username = this.getValue(\"username\", value);\n      cipher.login.password = this.getValue(\"password\", value);\n      cipher.login.uris = this.makeUriArray(this.getValue(\"site\", value));\n      this.processKvp(cipher, \"Password 2\", this.getValue(\"password2\", value));\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private getValue(key: string, value: any) {\n    return this.getValueOrDefault(value[key], this.getValueOrDefault(value[\" \" + key]));\n  }\n}\n","import { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport { PasskyJsonExport } from \"./passky-json-types\";\n\nexport class PasskyJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const passkyExport: PasskyJsonExport = JSON.parse(data);\n    if (\n      passkyExport == null ||\n      passkyExport.passwords == null ||\n      passkyExport.passwords.length === 0\n    ) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    if (passkyExport.encrypted == true) {\n      result.success = false;\n      result.errorMessage = \"Unable to import an encrypted passky backup.\";\n      return Promise.resolve(result);\n    }\n\n    passkyExport.passwords.forEach((record) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = record.website;\n      cipher.login.username = record.username;\n      cipher.login.password = record.password;\n\n      cipher.login.uris = this.makeUriArray(record.website);\n      cipher.notes = record.message;\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PassmanJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null || results.length === 0) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((credential: any) => {\n      if (credential.tags != null && credential.tags.length > 0) {\n        const folderName = credential.tags[0].text;\n        this.processFolder(result, folderName);\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = credential.label;\n\n      cipher.login.username = this.getValueOrDefault(credential.username);\n      if (this.isNullOrWhitespace(cipher.login.username)) {\n        cipher.login.username = this.getValueOrDefault(credential.email);\n      } else if (!this.isNullOrWhitespace(credential.email)) {\n        cipher.notes = \"Email: \" + credential.email + \"\\n\";\n      }\n\n      cipher.login.password = this.getValueOrDefault(credential.password);\n      cipher.login.uris = this.makeUriArray(credential.url);\n      cipher.notes += this.getValueOrDefault(credential.description, \"\");\n      if (credential.otp != null) {\n        cipher.login.totp = this.getValueOrDefault(credential.otp.secret);\n      }\n\n      if (credential.custom_fields != null) {\n        credential.custom_fields.forEach((customField: any) => {\n          switch (customField.field_type) {\n            case \"text\":\n            case \"password\":\n              this.processKvp(cipher, customField.label, customField.value);\n              break;\n          }\n        });\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasspackCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const tagsJson = !this.isNullOrWhitespace(value.Tags) ? JSON.parse(value.Tags) : null;\n      const tags: string[] =\n        tagsJson != null && tagsJson.tags != null && tagsJson.tags.length > 0\n          ? tagsJson.tags\n              .map((tagJson: string) => {\n                try {\n                  const t = JSON.parse(tagJson);\n                  return this.getValueOrDefault(t.tag);\n                } catch {\n                  // Ignore error\n                }\n                return null;\n              })\n              .filter((t: string) => !this.isNullOrWhitespace(t))\n          : null;\n\n      if (this.organization && tags != null && tags.length > 0) {\n        tags.forEach((tag) => {\n          let addCollection = true;\n          let collectionIndex = result.collections.length;\n\n          for (let i = 0; i < result.collections.length; i++) {\n            if (result.collections[i].name === tag) {\n              addCollection = false;\n              collectionIndex = i;\n              break;\n            }\n          }\n\n          if (addCollection) {\n            const collection = new CollectionView();\n            collection.name = tag;\n            result.collections.push(collection);\n          }\n\n          result.collectionRelationships.push([result.ciphers.length, collectionIndex]);\n        });\n      } else if (!this.organization && tags != null && tags.length > 0) {\n        this.processFolder(result, tags[0]);\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value.Notes, \"\");\n      cipher.notes += \"\\n\\n\" + this.getValueOrDefault(value[\"Shared Notes\"], \"\") + \"\\n\";\n      cipher.name = this.getValueOrDefault(value[\"Entry Name\"], \"--\");\n      cipher.login.username = this.getValueOrDefault(value[\"User ID\"]);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.URL);\n\n      if (value.__parsed_extra != null && value.__parsed_extra.length > 0) {\n        value.__parsed_extra.forEach((extra: string) => {\n          if (!this.isNullOrWhitespace(extra)) {\n            cipher.notes += \"\\n\" + extra;\n          }\n        });\n      }\n\n      const fieldsJson = !this.isNullOrWhitespace(value[\"Extra Fields\"])\n        ? JSON.parse(value[\"Extra Fields\"])\n        : null;\n      const fields =\n        fieldsJson != null && fieldsJson.extraFields != null && fieldsJson.extraFields.length > 0\n          ? fieldsJson.extraFields.map((fieldJson: string) => {\n              try {\n                return JSON.parse(fieldJson);\n              } catch {\n                // Ignore error\n              }\n              return null;\n            })\n          : null;\n      if (fields != null) {\n        fields.forEach((f: any) => {\n          if (f != null) {\n            this.processKvp(cipher, f.name, f.data);\n          }\n        });\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasswordAgentCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    let newVersion = true;\n    results.forEach((value) => {\n      if (value.length !== 5 && value.length < 9) {\n        return;\n      }\n      const altFormat = value.length === 10 && value[0] === \"0\";\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[altFormat ? 1 : 0], \"--\");\n      cipher.login.username = this.getValueOrDefault(value[altFormat ? 2 : 1]);\n      cipher.login.password = this.getValueOrDefault(value[altFormat ? 3 : 2]);\n      if (value.length === 5) {\n        newVersion = false;\n        cipher.notes = this.getValueOrDefault(value[4]);\n        cipher.login.uris = this.makeUriArray(value[3]);\n      } else {\n        const folder = this.getValueOrDefault(value[altFormat ? 9 : 8], \"(None)\");\n        let folderName = folder !== \"(None)\" ? folder.split(\"\\\\\").join(\"/\") : null;\n        if (folderName != null) {\n          folderName = folder.split(\" > \").join(\"/\");\n          folderName = folder.split(\">\").join(\"/\");\n        }\n        this.processFolder(result, folderName);\n        cipher.notes = this.getValueOrDefault(value[altFormat ? 5 : 3]);\n        cipher.login.uris = this.makeUriArray(value[4]);\n      }\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (newVersion && this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasswordBossJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = JSON.parse(data);\n    if (results == null || results.items == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const foldersMap = new Map<string, string>();\n    results.folders.forEach((value: any) => {\n      foldersMap.set(value.id, value.name);\n    });\n    const foldersIndexMap = new Map<string, number>();\n    foldersMap.forEach((val, key) => {\n      foldersIndexMap.set(key, result.folders.length);\n      const f = new FolderView();\n      f.name = val;\n      result.folders.push(f);\n    });\n\n    results.items.forEach((value: any) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.name, \"--\");\n      cipher.login.uris = this.makeUriArray(value.login_url);\n\n      if (value.folder != null && foldersIndexMap.has(value.folder)) {\n        result.folderRelationships.push([result.ciphers.length, foldersIndexMap.get(value.folder)]);\n      }\n\n      if (value.identifiers == null) {\n        return;\n      }\n\n      if (!this.isNullOrWhitespace(value.identifiers.notes)) {\n        cipher.notes = value.identifiers.notes.split(\"\\\\r\\\\n\").join(\"\\n\").split(\"\\\\n\").join(\"\\n\");\n      }\n\n      if (value.type === \"CreditCard\") {\n        cipher.card = new CardView();\n        cipher.type = CipherType.Card;\n      }\n\n      for (const property in value.identifiers) {\n        // eslint-disable-next-line\n        if (!value.identifiers.hasOwnProperty(property)) {\n          continue;\n        }\n        const valObj = value.identifiers[property];\n        const val = valObj != null ? valObj.toString() : null;\n        if (\n          this.isNullOrWhitespace(val) ||\n          property === \"notes\" ||\n          property === \"ignoreItemInSecurityScore\"\n        ) {\n          continue;\n        }\n\n        if (property === \"custom_fields\") {\n          valObj.forEach((cf: any) => {\n            this.processKvp(cipher, cf.name, cf.value);\n          });\n          continue;\n        }\n\n        if (cipher.type === CipherType.Card) {\n          if (property === \"cardNumber\") {\n            cipher.card.number = val;\n            cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n            continue;\n          } else if (property === \"nameOnCard\") {\n            cipher.card.cardholderName = val;\n            continue;\n          } else if (property === \"security_code\") {\n            cipher.card.code = val;\n            continue;\n          } else if (property === \"expires\") {\n            try {\n              const expDate = new Date(val);\n              cipher.card.expYear = expDate.getFullYear().toString();\n              cipher.card.expMonth = (expDate.getMonth() + 1).toString();\n            } catch {\n              // Ignore error\n            }\n            continue;\n          } else if (property === \"cardType\") {\n            continue;\n          }\n        } else {\n          if (\n            (property === \"username\" || property === \"email\") &&\n            this.isNullOrWhitespace(cipher.login.username)\n          ) {\n            cipher.login.username = val;\n            continue;\n          } else if (property === \"password\") {\n            cipher.login.password = val;\n            continue;\n          } else if (property === \"totp\") {\n            cipher.login.totp = val;\n            continue;\n          } else if (\n            (cipher.login.uris == null || cipher.login.uris.length === 0) &&\n            this.uriFieldNames.indexOf(property) > -1\n          ) {\n            cipher.login.uris = this.makeUriArray(val);\n            continue;\n          }\n        }\n\n        this.processKvp(cipher, property, val);\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasswordDragonXmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const records = doc.querySelectorAll(\"PasswordManager > record\");\n    Array.from(records).forEach((record) => {\n      const category = this.querySelectorDirectChild(record, \"Category\");\n      const categoryText =\n        category != null &&\n        !this.isNullOrWhitespace(category.textContent) &&\n        category.textContent !== \"Unfiled\"\n          ? category.textContent\n          : null;\n      this.processFolder(result, categoryText);\n\n      const accountName = this.querySelectorDirectChild(record, \"Account-Name\");\n      const userId = this.querySelectorDirectChild(record, \"User-Id\");\n      const password = this.querySelectorDirectChild(record, \"Password\");\n      const url = this.querySelectorDirectChild(record, \"URL\");\n      const notes = this.querySelectorDirectChild(record, \"Notes\");\n      const cipher = this.initLoginCipher();\n      cipher.name =\n        accountName != null ? this.getValueOrDefault(accountName.textContent, \"--\") : \"--\";\n      cipher.notes = notes != null ? this.getValueOrDefault(notes.textContent) : \"\";\n      cipher.login.username = userId != null ? this.getValueOrDefault(userId.textContent) : null;\n      cipher.login.password =\n        password != null ? this.getValueOrDefault(password.textContent) : null;\n      cipher.login.uris = url != null ? this.makeUriArray(url.textContent) : null;\n\n      const attributes: string[] = [];\n      for (let i = 1; i <= 10; i++) {\n        attributes.push(\"Attribute-\" + i);\n      }\n\n      this.querySelectorAllDirectChild(record, attributes.join(\",\")).forEach((attr) => {\n        if (this.isNullOrWhitespace(attr.textContent) || attr.textContent === \"null\") {\n          return;\n        }\n        this.processKvp(cipher, attr.tagName, attr.textContent);\n      });\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\n/** This is the importer for the xml format from pwsafe.org  */\nexport class PasswordSafeXmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const passwordSafe = doc.querySelector(\"passwordsafe\");\n    if (passwordSafe == null) {\n      result.errorMessage = \"Missing `passwordsafe` node.\";\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const notesDelimiter = passwordSafe.getAttribute(\"delimiter\");\n    const entries = doc.querySelectorAll(\"passwordsafe > entry\");\n    Array.from(entries).forEach((entry) => {\n      const group = this.querySelectorDirectChild(entry, \"group\");\n      const groupText =\n        group != null && !this.isNullOrWhitespace(group.textContent)\n          ? group.textContent.split(\".\").join(\"/\")\n          : null;\n      this.processFolder(result, groupText);\n\n      const title = this.querySelectorDirectChild(entry, \"title\");\n      const username = this.querySelectorDirectChild(entry, \"username\");\n      const email = this.querySelectorDirectChild(entry, \"email\");\n      const password = this.querySelectorDirectChild(entry, \"password\");\n      const url = this.querySelectorDirectChild(entry, \"url\");\n      const notes = this.querySelectorDirectChild(entry, \"notes\");\n      const cipher = this.initLoginCipher();\n      cipher.name = title != null ? this.getValueOrDefault(title.textContent, \"--\") : \"--\";\n      cipher.notes =\n        notes != null\n          ? this.getValueOrDefault(notes.textContent, \"\").split(notesDelimiter).join(\"\\n\")\n          : null;\n      cipher.login.username =\n        username != null ? this.getValueOrDefault(username.textContent) : null;\n      cipher.login.password =\n        password != null ? this.getValueOrDefault(password.textContent) : null;\n      cipher.login.uris = url != null ? this.makeUriArray(url.textContent) : null;\n\n      if (this.isNullOrWhitespace(cipher.login.username) && email != null) {\n        cipher.login.username = this.getValueOrDefault(email.textContent);\n      } else if (email != null && !this.isNullOrWhitespace(email.textContent)) {\n        cipher.notes = this.isNullOrWhitespace(cipher.notes)\n          ? \"Email: \" + email.textContent\n          : cipher.notes + \"\\n\" + \"Email: \" + email.textContent;\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class PasswordWalletTxtImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 1) {\n        return;\n      }\n      if (value.length > 5) {\n        this.processFolder(result, value[5]);\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n      if (value.length > 4) {\n        cipher.notes = this.getValueOrDefault(value[4], \"\").split(\"¬\").join(\"\\n\");\n      }\n      if (value.length > 2) {\n        cipher.login.username = this.getValueOrDefault(value[2]);\n      }\n      if (value.length > 3) {\n        cipher.login.password = this.getValueOrDefault(value[3]);\n      }\n      if (value.length > 1) {\n        cipher.login.uris = this.makeUriArray(value[1]);\n      }\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","export type ProtonPassJsonFile = {\n  version: string;\n  userId: string;\n  encrypted: boolean;\n  vaults: Record<string, ProtonPassVault>;\n};\n\nexport type ProtonPassVault = {\n  name: string;\n  description: string;\n  display: {\n    color: number;\n    icon: number;\n  };\n  items: ProtonPassItem[];\n};\n\nexport type ProtonPassItem = {\n  itemId: string;\n  shareId: string;\n  data: ProtonPassItemData;\n  state: ProtonPassItemState;\n  aliasEmail: string | null;\n  contentFormatVersion: number;\n  createTime: number;\n  modifyTime: number;\n};\n\nexport enum ProtonPassItemState {\n  ACTIVE = 1,\n  TRASHED = 2,\n}\n\nexport type ProtonPassItemData = {\n  metadata: ProtonPassItemMetadata;\n  extraFields: ProtonPassItemExtraField[];\n  type: \"login\" | \"alias\" | \"creditCard\" | \"note\";\n  content: ProtonPassLoginItemContent | ProtonPassCreditCardItemContent;\n};\n\nexport type ProtonPassItemMetadata = {\n  name: string;\n  note: string;\n  itemUuid: string;\n};\n\nexport type ProtonPassItemExtraField = {\n  fieldName: string;\n  type: string;\n  data: ProtonPassItemExtraFieldData;\n};\n\nexport type ProtonPassItemExtraFieldData = {\n  content?: string;\n  totpUri?: string;\n};\n\nexport type ProtonPassLoginItemContent = {\n  username?: string;\n  password?: string;\n  urls?: string[];\n  totpUri?: string;\n};\n\nexport type ProtonPassCreditCardItemContent = {\n  cardholderName?: string;\n  cardType?: number;\n  number?: string;\n  verificationNumber?: string;\n  expirationDate?: string;\n  pin?: string;\n};\n","import { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport {\n  ProtonPassCreditCardItemContent,\n  ProtonPassItemState,\n  ProtonPassJsonFile,\n  ProtonPassLoginItemContent,\n} from \"./types/protonpass-json-type\";\n\nexport class ProtonPassJsonImporter extends BaseImporter implements Importer {\n  constructor(private i18nService: I18nService) {\n    super();\n  }\n\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results: ProtonPassJsonFile = JSON.parse(data);\n    if (results == null || results.vaults == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    if (results.encrypted) {\n      result.success = false;\n      result.errorMessage = this.i18nService.t(\"unsupportedEncryptedImport\");\n      return Promise.resolve(result);\n    }\n\n    for (const [, vault] of Object.entries(results.vaults)) {\n      for (const item of vault.items) {\n        if (item.state == ProtonPassItemState.TRASHED) {\n          continue;\n        }\n        this.processFolder(result, vault.name);\n\n        const cipher = this.initLoginCipher();\n        cipher.name = this.getValueOrDefault(item.data.metadata.name, \"--\");\n        cipher.notes = this.getValueOrDefault(item.data.metadata.note);\n\n        switch (item.data.type) {\n          case \"login\": {\n            const loginContent = item.data.content as ProtonPassLoginItemContent;\n            cipher.login.uris = this.makeUriArray(loginContent.urls);\n            cipher.login.username = this.getValueOrDefault(loginContent.username);\n            cipher.login.password = this.getValueOrDefault(loginContent.password);\n            cipher.login.totp = this.getValueOrDefault(loginContent.totpUri);\n            for (const extraField of item.data.extraFields) {\n              this.processKvp(\n                cipher,\n                extraField.fieldName,\n                extraField.type == \"totp\" ? extraField.data.totpUri : extraField.data.content,\n                extraField.type == \"text\" ? FieldType.Text : FieldType.Hidden,\n              );\n            }\n            break;\n          }\n          case \"note\":\n            cipher.type = CipherType.SecureNote;\n            cipher.secureNote = new SecureNoteView();\n            cipher.secureNote.type = SecureNoteType.Generic;\n            break;\n          case \"creditCard\": {\n            const creditCardContent = item.data.content as ProtonPassCreditCardItemContent;\n            cipher.type = CipherType.Card;\n            cipher.card = new CardView();\n            cipher.card.cardholderName = this.getValueOrDefault(creditCardContent.cardholderName);\n            cipher.card.number = this.getValueOrDefault(creditCardContent.number);\n            cipher.card.brand = CardView.getCardBrandByPatterns(creditCardContent.number);\n            cipher.card.code = this.getValueOrDefault(creditCardContent.verificationNumber);\n\n            if (!this.isNullOrWhitespace(creditCardContent.expirationDate)) {\n              cipher.card.expMonth = creditCardContent.expirationDate.substring(0, 2);\n              cipher.card.expMonth = cipher.card.expMonth.replace(/^0+/, \"\");\n              cipher.card.expYear = creditCardContent.expirationDate.substring(2, 6);\n            }\n\n            if (!this.isNullOrWhitespace(creditCardContent.pin)) {\n              this.processKvp(cipher, \"PIN\", creditCardContent.pin, FieldType.Hidden);\n            }\n\n            break;\n          }\n        }\n\n        this.cleanupCipher(cipher);\n        result.ciphers.push(cipher);\n      }\n    }\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../../models/import-result\";\nimport { BaseImporter } from \"../base-importer\";\nimport { Importer } from \"../importer\";\n\nimport {\n  AppPasswordEntry,\n  BookmarkEntry,\n  EnvironmentVariablesEntry,\n  FoldersEntity,\n  GPGEntry,\n  NotesEntry,\n  PsonoItemTypes,\n  PsonoJsonExport,\n  TOTPEntry,\n  WebsitePasswordEntry,\n} from \"./psono-json-types\";\n\nexport class PsonoJsonImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const psonoExport: PsonoJsonExport = JSON.parse(data);\n    if (psonoExport == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    this.parseFolders(result, psonoExport.folders);\n    this.handleItemParsing(result, psonoExport.items);\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseFolders(result: ImportResult, folders: FoldersEntity[], parentName?: string) {\n    if (folders == null || folders.length === 0) {\n      return;\n    }\n\n    folders.forEach((folder) => {\n      const folderHasItems = folder.items != null && folder.items.length > 0;\n      const folderHasSubfolders = folder.folders != null && folder.folders.length > 0;\n\n      if (!folderHasItems && !folderHasSubfolders) {\n        return;\n      }\n\n      if (!Utils.isNullOrWhitespace(parentName)) {\n        folder.name = parentName + \"/\" + folder.name;\n      }\n\n      if (folderHasSubfolders) {\n        this.parseFolders(result, folder.folders, folder.name);\n      }\n\n      if (!folderHasItems) {\n        this.processFolder(result, folder.name, folderHasItems);\n      } else {\n        this.handleItemParsing(result, folder.items, folder.name);\n      }\n    });\n  }\n\n  private handleItemParsing(result: ImportResult, items?: PsonoItemTypes[], folderName?: string) {\n    if (items == null || items.length === 0) {\n      return;\n    }\n\n    items.forEach((record) => {\n      const cipher = this.parsePsonoItem(record);\n      this.processFolder(result, folderName, true);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n  }\n\n  private parsePsonoItem(item: PsonoItemTypes): CipherView {\n    const cipher = this.initLoginCipher();\n\n    switch (item.type) {\n      case \"website_password\":\n        this.parseWebsiteLogins(item, cipher);\n        break;\n      case \"application_password\":\n        this.parseApplicationPasswords(item, cipher);\n        break;\n      case \"environment_variables\":\n        this.parseEnvironmentVariables(item, cipher);\n        break;\n      case \"totp\":\n        this.parseTOTP(item, cipher);\n        break;\n      case \"bookmark\":\n        this.parseBookmarks(item, cipher);\n        break;\n      // Skipping this until we can save GPG into notes/custom fields\n      // case \"mail_gpg_own_key\":\n      //   this.parseGPG(item, cipher);\n      //   break;\n      case \"note\":\n        this.parseNotes(item, cipher);\n        break;\n      default:\n        break;\n    }\n\n    return cipher;\n  }\n\n  readonly WEBSITE_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"website_password_title\",\n    \"website_password_notes\",\n    \"website_password_username\",\n    \"website_password_password\",\n    \"website_password_url\",\n    \"autosubmit\",\n    \"website_password_auto_submit\",\n    \"urlfilter\",\n    \"website_password_url_filter\",\n  ]);\n  private parseWebsiteLogins(entry: WebsitePasswordEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"website_password\") {\n      return;\n    }\n\n    cipher.name = entry.website_password_title;\n    cipher.notes = entry.website_password_notes;\n\n    cipher.login.username = entry.website_password_username;\n    cipher.login.password = entry.website_password_password;\n\n    cipher.login.uris = this.makeUriArray(entry.website_password_url);\n\n    this.processKvp(\n      cipher,\n      \"website_password_auto_submit\",\n      entry.website_password_auto_submit?.toString(),\n      FieldType.Boolean,\n    );\n\n    this.processKvp(cipher, \"website_password_url_filter\", entry.website_password_url_filter);\n\n    this.importUnmappedFields(cipher, entry, this.WEBSITE_mappedValues);\n  }\n\n  readonly APP_PWD_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"application_password_title\",\n    \"application_password_notes\",\n    \"application_password_username\",\n    \"application_password_password\",\n  ]);\n  private parseApplicationPasswords(entry: AppPasswordEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"application_password\") {\n      return;\n    }\n\n    cipher.name = entry.application_password_title;\n    cipher.notes = entry.application_password_notes;\n\n    cipher.login.username = entry.application_password_username;\n    cipher.login.password = entry.application_password_password;\n\n    this.importUnmappedFields(cipher, entry, this.APP_PWD_mappedValues);\n  }\n\n  readonly BOOKMARK_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"bookmark_title\",\n    \"bookmark_notes\",\n    \"bookmark_url\",\n  ]);\n  private parseBookmarks(entry: BookmarkEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"bookmark\") {\n      return;\n    }\n\n    cipher.name = entry.bookmark_title;\n    cipher.notes = entry.bookmark_notes;\n\n    cipher.login.uris = this.makeUriArray(entry.bookmark_url);\n\n    this.importUnmappedFields(cipher, entry, this.BOOKMARK_mappedValues);\n  }\n\n  readonly NOTES_mappedValues = new Set([\"type\", \"name\", \"note_title\", \"note_notes\"]);\n  private parseNotes(entry: NotesEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"note\") {\n      return;\n    }\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote = new SecureNoteView();\n    cipher.secureNote.type = SecureNoteType.Generic;\n    cipher.name = entry.note_title;\n    cipher.notes = entry.note_notes;\n\n    this.importUnmappedFields(cipher, entry, this.NOTES_mappedValues);\n  }\n\n  readonly TOTP_mappedValues = new Set([\"type\", \"name\", \"totp_title\", \"totp_notes\", \"totp_code\"]);\n  private parseTOTP(entry: TOTPEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"totp\") {\n      return;\n    }\n\n    cipher.name = entry.totp_title;\n    cipher.notes = entry.totp_notes;\n\n    cipher.login.totp = entry.totp_code;\n\n    this.importUnmappedFields(cipher, entry, this.TOTP_mappedValues);\n  }\n\n  readonly ENV_VARIABLES_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"environment_variables_title\",\n    \"environment_variables_notes\",\n    \"environment_variables_variables\",\n  ]);\n  private parseEnvironmentVariables(entry: EnvironmentVariablesEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"environment_variables\") {\n      return;\n    }\n\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote = new SecureNoteView();\n    cipher.secureNote.type = SecureNoteType.Generic;\n    cipher.name = entry.environment_variables_title;\n    cipher.notes = entry.environment_variables_notes;\n\n    entry.environment_variables_variables.forEach((KvPair) => {\n      this.processKvp(cipher, KvPair.key, KvPair.value);\n    });\n\n    this.importUnmappedFields(cipher, entry, this.ENV_VARIABLES_mappedValues);\n  }\n\n  readonly GPG_mappedValues = new Set([\n    \"type\",\n    \"name\",\n    \"mail_gpg_own_key_title\",\n    \"mail_gpg_own_key_public\",\n    \"mail_gpg_own_key_name\",\n    \"mail_gpg_own_key_email\",\n    \"mail_gpg_own_key_private\",\n  ]);\n  private parseGPG(entry: GPGEntry, cipher: CipherView) {\n    if (entry == null || entry.type != \"mail_gpg_own_key\") {\n      return;\n    }\n\n    cipher.type = CipherType.SecureNote;\n    cipher.secureNote = new SecureNoteView();\n    cipher.secureNote.type = SecureNoteType.Generic;\n    cipher.name = entry.mail_gpg_own_key_title;\n    cipher.notes = entry.mail_gpg_own_key_public;\n\n    this.processKvp(cipher, \"mail_gpg_own_key_name\", entry.mail_gpg_own_key_name);\n    this.processKvp(cipher, \"mail_gpg_own_key_email\", entry.mail_gpg_own_key_email);\n    this.processKvp(\n      cipher,\n      \"mail_gpg_own_key_private\",\n      entry.mail_gpg_own_key_private,\n      FieldType.Hidden,\n    );\n\n    this.importUnmappedFields(cipher, entry, this.GPG_mappedValues);\n  }\n\n  private importUnmappedFields(\n    cipher: CipherView,\n    entry: PsonoItemTypes,\n    mappedValues: Set<string>,\n  ) {\n    const unmappedFields = Object.keys(entry).filter((x) => !mappedValues.has(x));\n    unmappedFields.forEach((key) => {\n      const item = entry as any;\n      this.processKvp(cipher, key, item[key].toString());\n    });\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class RememBearCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.trash === \"true\") {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.name);\n      cipher.notes = this.getValueOrDefault(value.notes);\n      if (value.type === \"LoginItem\") {\n        cipher.login.uris = this.makeUriArray(value.website);\n        cipher.login.password = this.getValueOrDefault(value.password);\n        cipher.login.username = this.getValueOrDefault(value.username);\n      } else if (value.type === \"CreditCardItem\") {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n        cipher.card.cardholderName = this.getValueOrDefault(value.cardholder);\n        cipher.card.number = this.getValueOrDefault(value.number);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        cipher.card.code = this.getValueOrDefault(value.verification);\n\n        try {\n          const expMonth = this.getValueOrDefault(value.expiryMonth);\n          if (expMonth != null) {\n            const expMonthNumber = parseInt(expMonth, null);\n            if (expMonthNumber != null && expMonthNumber >= 1 && expMonthNumber <= 12) {\n              cipher.card.expMonth = expMonthNumber.toString();\n            }\n          }\n        } catch {\n          // Ignore error\n        }\n        try {\n          const expYear = this.getValueOrDefault(value.expiryYear);\n          if (expYear != null) {\n            const expYearNumber = parseInt(expYear, null);\n            if (expYearNumber != null) {\n              cipher.card.expYear = expYearNumber.toString();\n            }\n          }\n        } catch {\n          // Ignore error\n        }\n\n        const pin = this.getValueOrDefault(value.pin);\n        if (pin != null) {\n          this.processKvp(cipher, \"PIN\", pin);\n        }\n        const zip = this.getValueOrDefault(value.zipCode);\n        if (zip != null) {\n          this.processKvp(cipher, \"Zip Code\", zip);\n        }\n      }\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class RoboFormCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    let i = 1;\n    results.forEach((value) => {\n      const folder =\n        !this.isNullOrWhitespace(value.Folder) && value.Folder.startsWith(\"/\")\n          ? value.Folder.replace(\"/\", \"\")\n          : value.Folder;\n      const folderName = !this.isNullOrWhitespace(folder) ? folder : null;\n      this.processFolder(result, folderName);\n\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value.Note);\n      cipher.name = this.getValueOrDefault(value.Name, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.Login);\n      cipher.login.password = this.getValueOrDefault(value.Pwd);\n      cipher.login.uris = this.makeUriArray(value.Url);\n\n      if (!this.isNullOrWhitespace(value.Rf_fields)) {\n        let fields: string[] = [value.Rf_fields];\n        if (value.__parsed_extra != null && value.__parsed_extra.length > 0) {\n          fields = fields.concat(value.__parsed_extra);\n        }\n        fields.forEach((field: string) => {\n          const parts = field.split(\":\");\n          if (parts.length < 3) {\n            return;\n          }\n          const key = parts[0] === \"-no-name-\" ? null : parts[0];\n          const val = parts.length === 4 && parts[2] === \"rck\" ? parts[1] : parts[2];\n          this.processKvp(cipher, key, val);\n        });\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n\n      if (\n        i === results.length &&\n        cipher.name === \"--\" &&\n        this.isNullOrWhitespace(cipher.login.password)\n      ) {\n        return;\n      }\n\n      result.ciphers.push(cipher);\n      i++;\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SafariCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.Title, \"--\");\n      cipher.login.username = this.getValueOrDefault(value.Username);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.Url ?? value.URL);\n      cipher.login.totp = this.getValueOrDefault(value.OTPAuth);\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { FieldType, SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FieldView } from \"@bitwarden/common/vault/models/view/field.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SafeInCloudXmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const db = doc.querySelector(\"database\");\n    if (db == null) {\n      result.errorMessage = \"Missing `database` node.\";\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const foldersMap = new Map<string, number>();\n\n    Array.from(doc.querySelectorAll(\"database > label\")).forEach((labelEl) => {\n      const name = labelEl.getAttribute(\"name\");\n      const id = labelEl.getAttribute(\"id\");\n      if (!this.isNullOrWhitespace(name) && !this.isNullOrWhitespace(id)) {\n        foldersMap.set(id, result.folders.length);\n        const folder = new FolderView();\n        folder.name = name;\n        result.folders.push(folder);\n      }\n    });\n\n    Array.from(doc.querySelectorAll(\"database > card\")).forEach((cardEl) => {\n      if (cardEl.getAttribute(\"template\") === \"true\" || cardEl.getAttribute(\"deleted\") === \"true\") {\n        return;\n      }\n\n      const labelIdEl = this.querySelectorDirectChild(cardEl, \"label_id\");\n      if (labelIdEl != null) {\n        const labelId = labelIdEl.textContent;\n        if (!this.isNullOrWhitespace(labelId) && foldersMap.has(labelId)) {\n          result.folderRelationships.push([result.ciphers.length, foldersMap.get(labelId)]);\n        }\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(cardEl.getAttribute(\"title\"), \"--\");\n\n      if (cardEl.getAttribute(\"star\") === \"true\") {\n        cipher.favorite = true;\n      }\n\n      const cardType = cardEl.getAttribute(\"type\");\n      if (cardType === \"note\") {\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote = new SecureNoteView();\n        cipher.secureNote.type = SecureNoteType.Generic;\n      } else {\n        Array.from(this.querySelectorAllDirectChild(cardEl, \"field\")).forEach((fieldEl) => {\n          const text = fieldEl.textContent;\n          if (this.isNullOrWhitespace(text)) {\n            return;\n          }\n          const name = fieldEl.getAttribute(\"name\");\n          const fieldType = this.getValueOrDefault(fieldEl.getAttribute(\"type\"), \"\").toLowerCase();\n          if (fieldType === \"login\") {\n            cipher.login.username = text;\n          } else if (fieldType === \"password\" || fieldType === \"secret\") {\n            // safeInCloud allows for more than one password. we just insert them here and find the one used as password later\n            this.processKvp(cipher, name, text, FieldType.Hidden);\n          } else if (fieldType === \"one_time_password\") {\n            cipher.login.totp = text;\n          } else if (fieldType === \"notes\") {\n            cipher.notes += text + \"\\n\";\n          } else if (fieldType === \"weblogin\" || fieldType === \"website\") {\n            cipher.login.uris.push(...this.makeUriArray(text));\n          } else {\n            this.processKvp(cipher, name, text);\n          }\n        });\n      }\n\n      Array.from(this.querySelectorAllDirectChild(cardEl, \"notes\")).forEach((notesEl) => {\n        cipher.notes += notesEl.textContent + \"\\n\";\n      });\n\n      this.setPassword(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  // Choose a password from all passwords. Take one that has password in its name, or the first one if there is no such entry\n  // if its name is password, we can safely remove it form the fields. otherwise, it would maybe be best to keep it as a hidden field\n  setPassword(cipher: CipherView) {\n    const candidates = cipher.fields.filter((field) => field.type === FieldType.Hidden);\n    if (!candidates.length) {\n      return;\n    }\n\n    let choice: FieldView;\n    for (const field of candidates) {\n      if (this.passwordFieldNames.includes(field.name.toLowerCase())) {\n        choice = field;\n        cipher.fields = cipher.fields.filter((f) => f !== choice);\n        break;\n      }\n    }\n\n    if (!choice) {\n      choice = candidates[0];\n    }\n\n    cipher.login.password = choice.value;\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SaferPassCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(this.nameFromUrl(value.url), \"--\");\n      cipher.notes = this.getValueOrDefault(value.notes);\n      cipher.login.username = this.getValueOrDefault(value.username);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.uris = this.makeUriArray(value.url);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SecureSafeCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    // The url field can be in different case formats.\n    const urlField = Object.keys(results[0]).find((k) => /url/i.test(k));\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.Title);\n      cipher.notes = this.getValueOrDefault(value.Comment);\n      cipher.login.uris = this.makeUriArray(value[urlField]);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.username = this.getValueOrDefault(value.Username);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class SplashIdCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length < 3) {\n        return;\n      }\n\n      this.processFolder(result, this.getValueOrDefault(value[value.length - 1]));\n      const cipher = this.initLoginCipher();\n      cipher.notes = this.getValueOrDefault(value[value.length - 2], \"\");\n      cipher.name = this.getValueOrDefault(value[1], \"--\");\n\n      if (value[0] === \"Web Logins\" || value[0] === \"Servers\" || value[0] === \"Email Accounts\") {\n        cipher.login.username = this.getValueOrDefault(value[2]);\n        cipher.login.password = this.getValueOrDefault(value[3]);\n        cipher.login.uris = this.makeUriArray(value[4]);\n        this.parseFieldsToNotes(cipher, 5, value);\n      } else {\n        this.parseFieldsToNotes(cipher, 2, value);\n      }\n\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseFieldsToNotes(cipher: CipherView, startIndex: number, value: any) {\n    // last 3 rows do not get parsed\n    for (let i = startIndex; i < value.length - 3; i++) {\n      if (this.isNullOrWhitespace(value[i])) {\n        continue;\n      }\n      cipher.notes += value[i] + \"\\n\";\n    }\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class StickyPasswordXmlImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const doc = this.parseXml(data);\n    if (doc == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    const loginNodes = doc.querySelectorAll(\"root > Database > Logins > Login\");\n    Array.from(loginNodes).forEach((loginNode) => {\n      const accountId = loginNode.getAttribute(\"ID\");\n      if (this.isNullOrWhitespace(accountId)) {\n        return;\n      }\n\n      const usernameText = loginNode.getAttribute(\"Name\");\n      const passwordText = loginNode.getAttribute(\"Password\");\n      let titleText: string = null;\n      let linkText: string = null;\n      let notesText: string = null;\n      let groupId: string = null;\n      let groupText: string = null;\n\n      const accountLogin = doc.querySelector(\n        \"root > Database > Accounts > Account > \" +\n          'LoginLinks > Login[SourceLoginID=\"' +\n          accountId +\n          '\"]',\n      );\n      if (accountLogin != null) {\n        const account = accountLogin.parentElement.parentElement;\n        if (account != null) {\n          titleText = account.getAttribute(\"Name\");\n          linkText = account.getAttribute(\"Link\");\n          groupId = account.getAttribute(\"ParentID\");\n          notesText = account.getAttribute(\"Comments\");\n          if (!this.isNullOrWhitespace(notesText)) {\n            notesText = notesText.split(\"/n\").join(\"\\n\");\n          }\n        }\n      }\n\n      if (!this.isNullOrWhitespace(groupId)) {\n        groupText = this.buildGroupText(doc, groupId, \"\");\n        this.processFolder(result, groupText);\n      }\n\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(titleText, \"--\");\n      cipher.notes = this.getValueOrDefault(notesText);\n      cipher.login.username = this.getValueOrDefault(usernameText);\n      cipher.login.password = this.getValueOrDefault(passwordText);\n      cipher.login.uris = this.makeUriArray(linkText);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  buildGroupText(doc: Document, groupId: string, groupText: string): string {\n    const group = doc.querySelector('root > Database > Groups > Group[ID=\"' + groupId + '\"]');\n    if (group == null) {\n      return groupText;\n    }\n    if (!this.isNullOrWhitespace(groupText)) {\n      groupText = \"/\" + groupText;\n    }\n    groupText = group.getAttribute(\"Name\") + groupText;\n    return this.buildGroupText(doc, group.getAttribute(\"ParentID\"), groupText);\n  }\n}\n","import { SecureNoteType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CardView } from \"@bitwarden/common/vault/models/view/card.view\";\nimport { SecureNoteView } from \"@bitwarden/common/vault/models/view/secure-note.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nconst PropertiesToIgnore = [\n  \"kind\",\n  \"autologin\",\n  \"favorite\",\n  \"hexcolor\",\n  \"protectedwithpassword\",\n  \"subdomainonly\",\n  \"type\",\n  \"tk_export_version\",\n  \"note\",\n  \"title\",\n  \"document_content\",\n];\n\nexport class TrueKeyCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.favorite = this.getValueOrDefault(value.favorite, \"\").toLowerCase() === \"true\";\n      cipher.name = this.getValueOrDefault(value.name, \"--\");\n      cipher.notes = this.getValueOrDefault(value.memo, \"\");\n      cipher.login.username = this.getValueOrDefault(value.login);\n      cipher.login.password = this.getValueOrDefault(value.password);\n      cipher.login.uris = this.makeUriArray(value.url);\n\n      if (value.kind !== \"login\") {\n        cipher.name = this.getValueOrDefault(value.title, \"--\");\n        cipher.notes = this.getValueOrDefault(value.note, \"\");\n      }\n\n      if (value.kind === \"cc\") {\n        cipher.type = CipherType.Card;\n        cipher.card = new CardView();\n        cipher.card.cardholderName = this.getValueOrDefault(value.cardholder);\n        cipher.card.number = this.getValueOrDefault(value.number);\n        cipher.card.brand = CardView.getCardBrandByPatterns(cipher.card.number);\n        if (!this.isNullOrWhitespace(value.expiryDate)) {\n          try {\n            const expDate = new Date(value.expiryDate);\n            cipher.card.expYear = expDate.getFullYear().toString();\n            cipher.card.expMonth = (expDate.getMonth() + 1).toString();\n          } catch {\n            // Ignore error\n          }\n        }\n      } else if (value.kind !== \"login\") {\n        cipher.type = CipherType.SecureNote;\n        cipher.secureNote = new SecureNoteView();\n        cipher.secureNote.type = SecureNoteType.Generic;\n        if (!this.isNullOrWhitespace(cipher.notes)) {\n          cipher.notes = this.getValueOrDefault(value.document_content, \"\");\n        }\n        for (const property in value) {\n          if (\n            value.hasOwnProperty(property) && // eslint-disable-line\n            PropertiesToIgnore.indexOf(property.toLowerCase()) < 0 &&\n            !this.isNullOrWhitespace(value[property])\n          ) {\n            this.processKvp(cipher, property, value[property]);\n          }\n        }\n      }\n\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class UpmCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, false);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (value.length !== 5) {\n        return;\n      }\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value[0], \"--\");\n      cipher.notes = this.getValueOrDefault(value[4]);\n      cipher.login.username = this.getValueOrDefault(value[1]);\n      cipher.login.password = this.getValueOrDefault(value[2]);\n      cipher.login.uris = this.makeUriArray(value[3]);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class YotiCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      const cipher = this.initLoginCipher();\n      cipher.name = this.getValueOrDefault(value.Name, \"--\");\n      cipher.login.username = this.getValueOrDefault(value[\"User name\"]);\n      cipher.login.password = this.getValueOrDefault(value.Password);\n      cipher.login.uris = this.makeUriArray(value.URL);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n}\n","import { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { ImportResult } from \"../models/import-result\";\n\nimport { BaseImporter } from \"./base-importer\";\nimport { Importer } from \"./importer\";\n\nexport class ZohoVaultCsvImporter extends BaseImporter implements Importer {\n  parse(data: string): Promise<ImportResult> {\n    const result = new ImportResult();\n    const results = this.parseCsv(data, true);\n    if (results == null) {\n      result.success = false;\n      return Promise.resolve(result);\n    }\n\n    results.forEach((value) => {\n      if (\n        this.isNullOrWhitespace(value[\"Password Name\"]) &&\n        this.isNullOrWhitespace(value[\"Secret Name\"])\n      ) {\n        return;\n      }\n      this.processFolder(result, this.getValueOrDefault(value.ChamberName));\n      const cipher = this.initLoginCipher();\n      cipher.favorite = this.getValueOrDefault(value.Favorite, \"0\") === \"1\";\n      cipher.notes = this.getValueOrDefault(value.Notes);\n      cipher.name = this.getValueOrDefault(\n        value[\"Password Name\"],\n        this.getValueOrDefault(value[\"Secret Name\"], \"--\"),\n      );\n      cipher.login.uris = this.makeUriArray(\n        this.getValueOrDefault(value[\"Password URL\"], this.getValueOrDefault(value[\"Secret URL\"])),\n      );\n      this.parseData(cipher, value.SecretData);\n      this.parseData(cipher, value.CustomData);\n      this.convertToNoteIfNeeded(cipher);\n      this.cleanupCipher(cipher);\n      result.ciphers.push(cipher);\n    });\n\n    if (this.organization) {\n      this.moveFoldersToCollections(result);\n    }\n\n    result.success = true;\n    return Promise.resolve(result);\n  }\n\n  private parseData(cipher: CipherView, data: string) {\n    if (this.isNullOrWhitespace(data)) {\n      return;\n    }\n    const dataLines = this.splitNewLine(data);\n    dataLines.forEach((line) => {\n      const delimPosition = line.indexOf(\":\");\n      if (delimPosition < 0) {\n        return;\n      }\n      const field = line.substring(0, delimPosition);\n      const value = line.length > delimPosition ? line.substring(delimPosition + 1) : null;\n      if (\n        this.isNullOrWhitespace(field) ||\n        this.isNullOrWhitespace(value) ||\n        field === \"SecretType\"\n      ) {\n        return;\n      }\n      const fieldLower = field.toLowerCase();\n      if (cipher.login.username == null && this.usernameFieldNames.indexOf(fieldLower) > -1) {\n        cipher.login.username = value;\n      } else if (\n        cipher.login.password == null &&\n        this.passwordFieldNames.indexOf(fieldLower) > -1\n      ) {\n        cipher.login.password = value;\n      } else {\n        this.processKvp(cipher, field, value);\n      }\n    });\n  }\n}\n","export interface ImportOption {\n  id: string;\n  name: string;\n}\n\nexport const featuredImportOptions = [\n  { id: \"bitwardenjson\", name: \"Bitwarden (json)\" },\n  { id: \"bitwardencsv\", name: \"Bitwarden (csv)\" },\n  { id: \"chromecsv\", name: \"Chrome (csv)\" },\n  { id: \"dashlanecsv\", name: \"Dashlane (csv)\" },\n  { id: \"firefoxcsv\", name: \"Firefox (csv)\" },\n  { id: \"keepass2xml\", name: \"KeePass 2 (xml)\" },\n  { id: \"lastpasscsv\", name: \"LastPass\" },\n  { id: \"safaricsv\", name: \"Safari and macOS (csv)\" },\n  { id: \"1password1pux\", name: \"1Password (1pux/json)\" },\n] as const;\n\nexport const regularImportOptions = [\n  { id: \"keepassxcsv\", name: \"KeePassX (csv)\" },\n  { id: \"1password1pif\", name: \"1Password (1pif)\" },\n  { id: \"1passwordwincsv\", name: \"1Password 6 and 7 Windows (csv)\" },\n  { id: \"1passwordmaccsv\", name: \"1Password 6 and 7 Mac (csv)\" },\n  { id: \"dashlanejson\", name: \"Dashlane (json)\" },\n  { id: \"roboformcsv\", name: \"RoboForm (csv)\" },\n  { id: \"keepercsv\", name: \"Keeper (csv)\" },\n  // Temporarily remove this option for the Feb release\n  // { id: \"keeperjson\", name: \"Keeper (json)\" },\n  { id: \"enpasscsv\", name: \"Enpass (csv)\" },\n  { id: \"enpassjson\", name: \"Enpass (json)\" },\n  { id: \"protonpass\", name: \"ProtonPass (zip/json)\" },\n  { id: \"safeincloudxml\", name: \"SafeInCloud (xml)\" },\n  { id: \"pwsafexml\", name: \"Password Safe - pwsafe.org (xml)\" },\n  { id: \"stickypasswordxml\", name: \"Sticky Password (xml)\" },\n  { id: \"msecurecsv\", name: \"mSecure (csv)\" },\n  { id: \"truekeycsv\", name: \"True Key (csv)\" },\n  { id: \"passwordbossjson\", name: \"Password Boss (json)\" },\n  { id: \"zohovaultcsv\", name: \"Zoho Vault (csv)\" },\n  { id: \"splashidcsv\", name: \"SplashID (csv)\" },\n  { id: \"passworddragonxml\", name: \"Password Dragon (xml)\" },\n  { id: \"padlockcsv\", name: \"Padlock (csv)\" },\n  { id: \"passboltcsv\", name: \"Passbolt (csv)\" },\n  { id: \"clipperzhtml\", name: \"Clipperz (html)\" },\n  { id: \"aviracsv\", name: \"Avira (csv)\" },\n  { id: \"saferpasscsv\", name: \"SaferPass (csv)\" },\n  { id: \"upmcsv\", name: \"Universal Password Manager (csv)\" },\n  { id: \"ascendocsv\", name: \"Ascendo DataVault (csv)\" },\n  { id: \"meldiumcsv\", name: \"Meldium (csv)\" },\n  { id: \"passkeepcsv\", name: \"PassKeep (csv)\" },\n  { id: \"operacsv\", name: \"Opera (csv)\" },\n  { id: \"vivaldicsv\", name: \"Vivaldi (csv)\" },\n  { id: \"gnomejson\", name: \"GNOME Passwords and Keys/Seahorse (json)\" },\n  { id: \"blurcsv\", name: \"Blur (csv)\" },\n  { id: \"passwordagentcsv\", name: \"Password Agent (csv)\" },\n  { id: \"passpackcsv\", name: \"Passpack (csv)\" },\n  { id: \"passmanjson\", name: \"Passman (json)\" },\n  { id: \"avastcsv\", name: \"Avast Passwords (csv)\" },\n  { id: \"avastjson\", name: \"Avast Passwords (json)\" },\n  { id: \"fsecurefsk\", name: \"F-Secure KEY (fsk)\" },\n  { id: \"kasperskytxt\", name: \"Kaspersky Password Manager (txt)\" },\n  { id: \"remembearcsv\", name: \"RememBear (csv)\" },\n  { id: \"passwordwallettxt\", name: \"PasswordWallet (txt)\" },\n  { id: \"mykicsv\", name: \"Myki (csv)\" },\n  { id: \"securesafecsv\", name: \"SecureSafe (csv)\" },\n  { id: \"logmeoncecsv\", name: \"LogMeOnce (csv)\" },\n  { id: \"blackberrycsv\", name: \"BlackBerry Password Keeper (csv)\" },\n  { id: \"buttercupcsv\", name: \"Buttercup (csv)\" },\n  { id: \"codebookcsv\", name: \"Codebook (csv)\" },\n  { id: \"encryptrcsv\", name: \"Encryptr (csv)\" },\n  { id: \"yoticsv\", name: \"Yoti (csv)\" },\n  { id: \"nordpasscsv\", name: \"Nordpass (csv)\" },\n  { id: \"psonojson\", name: \"Psono (json)\" },\n  { id: \"passkyjson\", name: \"Passky (json)\" },\n] as const;\n\nexport type ImportType =\n  | (typeof featuredImportOptions)[number][\"id\"]\n  | (typeof regularImportOptions)[number][\"id\"];\n","import { ImportCiphersRequest } from \"@bitwarden/common/models/request/import-ciphers.request\";\nimport { ImportOrganizationCiphersRequest } from \"@bitwarden/common/models/request/import-organization-ciphers.request\";\nimport { KvpRequest } from \"@bitwarden/common/models/request/kvp.request\";\nimport { ErrorResponse } from \"@bitwarden/common/models/response/error.response\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRequest } from \"@bitwarden/common/vault/models/request/cipher.request\";\nimport { CollectionWithIdRequest } from \"@bitwarden/common/vault/models/request/collection-with-id.request\";\nimport { FolderWithIdRequest } from \"@bitwarden/common/vault/models/request/folder-with-id.request\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport {\n  AscendoCsvImporter,\n  AvastCsvImporter,\n  AvastJsonImporter,\n  AviraCsvImporter,\n  BitwardenCsvImporter,\n  BitwardenPasswordProtectedImporter,\n  BlackBerryCsvImporter,\n  BlurCsvImporter,\n  ButtercupCsvImporter,\n  ChromeCsvImporter,\n  ClipperzHtmlImporter,\n  CodebookCsvImporter,\n  DashlaneCsvImporter,\n  DashlaneJsonImporter,\n  EncryptrCsvImporter,\n  EnpassCsvImporter,\n  EnpassJsonImporter,\n  FirefoxCsvImporter,\n  FSecureFskImporter,\n  GnomeJsonImporter,\n  KasperskyTxtImporter,\n  KeePass2XmlImporter,\n  KeePassXCsvImporter,\n  KeeperCsvImporter,\n  // KeeperJsonImporter,\n  LastPassCsvImporter,\n  LogMeOnceCsvImporter,\n  MSecureCsvImporter,\n  MeldiumCsvImporter,\n  MykiCsvImporter,\n  NordPassCsvImporter,\n  OnePassword1PifImporter,\n  OnePassword1PuxImporter,\n  OnePasswordMacCsvImporter,\n  OnePasswordWinCsvImporter,\n  PadlockCsvImporter,\n  PassKeepCsvImporter,\n  PasskyJsonImporter,\n  PassmanJsonImporter,\n  PasspackCsvImporter,\n  PasswordAgentCsvImporter,\n  PasswordBossJsonImporter,\n  PasswordDragonXmlImporter,\n  PasswordSafeXmlImporter,\n  PasswordWalletTxtImporter,\n  ProtonPassJsonImporter,\n  PsonoJsonImporter,\n  RememBearCsvImporter,\n  RoboFormCsvImporter,\n  SafariCsvImporter,\n  SafeInCloudXmlImporter,\n  SaferPassCsvImporter,\n  SecureSafeCsvImporter,\n  SplashIdCsvImporter,\n  StickyPasswordXmlImporter,\n  TrueKeyCsvImporter,\n  UpmCsvImporter,\n  YotiCsvImporter,\n  ZohoVaultCsvImporter,\n} from \"../importers\";\nimport { Importer } from \"../importers/importer\";\nimport {\n  featuredImportOptions,\n  ImportOption,\n  ImportType,\n  regularImportOptions,\n} from \"../models/import-options\";\nimport { ImportResult } from \"../models/import-result\";\nimport { ImportApiServiceAbstraction } from \"../services/import-api.service.abstraction\";\nimport { ImportServiceAbstraction } from \"../services/import.service.abstraction\";\n\nexport class ImportService implements ImportServiceAbstraction {\n  featuredImportOptions = featuredImportOptions as readonly ImportOption[];\n\n  regularImportOptions = regularImportOptions as readonly ImportOption[];\n\n  constructor(\n    private cipherService: CipherService,\n    private folderService: FolderService,\n    private importApiService: ImportApiServiceAbstraction,\n    private i18nService: I18nService,\n    private collectionService: CollectionService,\n    private cryptoService: CryptoService,\n  ) {}\n\n  getImportOptions(): ImportOption[] {\n    return this.featuredImportOptions.concat(this.regularImportOptions);\n  }\n\n  async import(\n    importer: Importer,\n    fileContents: string,\n    organizationId: string = null,\n    selectedImportTarget: string = null,\n    canAccessImportExport: boolean,\n  ): Promise<ImportResult> {\n    let importResult: ImportResult;\n    try {\n      importResult = await importer.parse(fileContents);\n    } catch (error) {\n      if (error instanceof SyntaxError) {\n        throw new Error(this.i18nService.t(\"importFormatError\"));\n      }\n      throw error;\n    }\n\n    if (!importResult.success) {\n      if (!Utils.isNullOrWhitespace(importResult.errorMessage)) {\n        throw new Error(importResult.errorMessage);\n      }\n      throw new Error(this.i18nService.t(\"importFormatError\"));\n    }\n\n    if (importResult.folders.length === 0 && importResult.ciphers.length === 0) {\n      throw new Error(this.i18nService.t(\"importNothingError\"));\n    }\n\n    if (importResult.ciphers.length > 0) {\n      const halfway = Math.floor(importResult.ciphers.length / 2);\n      const last = importResult.ciphers.length - 1;\n\n      if (\n        this.badData(importResult.ciphers[0]) &&\n        this.badData(importResult.ciphers[halfway]) &&\n        this.badData(importResult.ciphers[last])\n      ) {\n        throw new Error(this.i18nService.t(\"importFormatError\"));\n      }\n    }\n\n    if (\n      organizationId &&\n      Utils.isNullOrWhitespace(selectedImportTarget) &&\n      !canAccessImportExport\n    ) {\n      const hasUnassignedCollections =\n        importResult.collectionRelationships.length < importResult.ciphers.length;\n      if (hasUnassignedCollections) {\n        throw new Error(this.i18nService.t(\"importUnassignedItemsError\"));\n      }\n    }\n\n    try {\n      await this.setImportTarget(importResult, organizationId, selectedImportTarget);\n      if (organizationId != null) {\n        await this.handleOrganizationalImport(importResult, organizationId);\n      } else {\n        await this.handleIndividualImport(importResult);\n      }\n    } catch (error) {\n      const errorResponse = new ErrorResponse(error, 400);\n      throw this.handleServerError(errorResponse, importResult);\n    }\n    return importResult;\n  }\n\n  getImporter(\n    format: ImportType | \"bitwardenpasswordprotected\",\n    promptForPassword_callback: () => Promise<string>,\n    organizationId: string = null,\n  ): Importer {\n    if (promptForPassword_callback == null) {\n      return null;\n    }\n\n    const importer = this.getImporterInstance(format, promptForPassword_callback);\n    if (importer == null) {\n      return null;\n    }\n    importer.organizationId = organizationId;\n    return importer;\n  }\n\n  private getImporterInstance(\n    format: ImportType | \"bitwardenpasswordprotected\",\n    promptForPassword_callback: () => Promise<string>,\n  ) {\n    if (format == null) {\n      return null;\n    }\n\n    switch (format) {\n      case \"bitwardencsv\":\n        return new BitwardenCsvImporter();\n      case \"bitwardenjson\":\n      case \"bitwardenpasswordprotected\":\n        return new BitwardenPasswordProtectedImporter(\n          this.cryptoService,\n          this.i18nService,\n          this.cipherService,\n          promptForPassword_callback,\n        );\n      case \"lastpasscsv\":\n      case \"passboltcsv\":\n        return new LastPassCsvImporter();\n      case \"keepassxcsv\":\n        return new KeePassXCsvImporter();\n      case \"aviracsv\":\n        return new AviraCsvImporter();\n      case \"blurcsv\":\n        return new BlurCsvImporter();\n      case \"safeincloudxml\":\n        return new SafeInCloudXmlImporter();\n      case \"padlockcsv\":\n        return new PadlockCsvImporter();\n      case \"keepass2xml\":\n        return new KeePass2XmlImporter();\n      case \"chromecsv\":\n      case \"operacsv\":\n      case \"vivaldicsv\":\n        return new ChromeCsvImporter();\n      case \"firefoxcsv\":\n        return new FirefoxCsvImporter();\n      case \"upmcsv\":\n        return new UpmCsvImporter();\n      case \"saferpasscsv\":\n        return new SaferPassCsvImporter();\n      case \"safaricsv\":\n        return new SafariCsvImporter();\n      case \"meldiumcsv\":\n        return new MeldiumCsvImporter();\n      case \"1password1pif\":\n        return new OnePassword1PifImporter();\n      case \"1password1pux\":\n        return new OnePassword1PuxImporter();\n      case \"1passwordwincsv\":\n        return new OnePasswordWinCsvImporter();\n      case \"1passwordmaccsv\":\n        return new OnePasswordMacCsvImporter();\n      case \"keepercsv\":\n        return new KeeperCsvImporter();\n      // case \"keeperjson\":\n      //   return new KeeperJsonImporter();\n      case \"passworddragonxml\":\n        return new PasswordDragonXmlImporter();\n      case \"enpasscsv\":\n        return new EnpassCsvImporter();\n      case \"enpassjson\":\n        return new EnpassJsonImporter();\n      case \"pwsafexml\":\n        return new PasswordSafeXmlImporter();\n      case \"dashlanecsv\":\n        return new DashlaneCsvImporter();\n      case \"dashlanejson\":\n        return new DashlaneJsonImporter();\n      case \"msecurecsv\":\n        return new MSecureCsvImporter();\n      case \"stickypasswordxml\":\n        return new StickyPasswordXmlImporter();\n      case \"truekeycsv\":\n        return new TrueKeyCsvImporter();\n      case \"clipperzhtml\":\n        return new ClipperzHtmlImporter();\n      case \"roboformcsv\":\n        return new RoboFormCsvImporter();\n      case \"ascendocsv\":\n        return new AscendoCsvImporter();\n      case \"passwordbossjson\":\n        return new PasswordBossJsonImporter();\n      case \"zohovaultcsv\":\n        return new ZohoVaultCsvImporter();\n      case \"splashidcsv\":\n        return new SplashIdCsvImporter();\n      case \"passkeepcsv\":\n        return new PassKeepCsvImporter();\n      case \"gnomejson\":\n        return new GnomeJsonImporter();\n      case \"passwordagentcsv\":\n        return new PasswordAgentCsvImporter();\n      case \"passpackcsv\":\n        return new PasspackCsvImporter();\n      case \"passmanjson\":\n        return new PassmanJsonImporter();\n      case \"avastcsv\":\n        return new AvastCsvImporter();\n      case \"avastjson\":\n        return new AvastJsonImporter();\n      case \"fsecurefsk\":\n        return new FSecureFskImporter();\n      case \"kasperskytxt\":\n        return new KasperskyTxtImporter();\n      case \"remembearcsv\":\n        return new RememBearCsvImporter();\n      case \"passwordwallettxt\":\n        return new PasswordWalletTxtImporter();\n      case \"mykicsv\":\n        return new MykiCsvImporter();\n      case \"securesafecsv\":\n        return new SecureSafeCsvImporter();\n      case \"logmeoncecsv\":\n        return new LogMeOnceCsvImporter();\n      case \"blackberrycsv\":\n        return new BlackBerryCsvImporter();\n      case \"buttercupcsv\":\n        return new ButtercupCsvImporter();\n      case \"codebookcsv\":\n        return new CodebookCsvImporter();\n      case \"encryptrcsv\":\n        return new EncryptrCsvImporter();\n      case \"yoticsv\":\n        return new YotiCsvImporter();\n      case \"nordpasscsv\":\n        return new NordPassCsvImporter();\n      case \"psonojson\":\n        return new PsonoJsonImporter();\n      case \"passkyjson\":\n        return new PasskyJsonImporter();\n      case \"protonpass\":\n        return new ProtonPassJsonImporter(this.i18nService);\n      default:\n        return null;\n    }\n  }\n\n  private async handleIndividualImport(importResult: ImportResult) {\n    const request = new ImportCiphersRequest();\n    for (let i = 0; i < importResult.ciphers.length; i++) {\n      const c = await this.cipherService.encrypt(importResult.ciphers[i]);\n      request.ciphers.push(new CipherRequest(c));\n    }\n    if (importResult.folders != null) {\n      for (let i = 0; i < importResult.folders.length; i++) {\n        const f = await this.folderService.encrypt(importResult.folders[i]);\n        request.folders.push(new FolderWithIdRequest(f));\n      }\n    }\n    if (importResult.folderRelationships != null) {\n      importResult.folderRelationships.forEach((r) =>\n        request.folderRelationships.push(new KvpRequest(r[0], r[1])),\n      );\n    }\n    return await this.importApiService.postImportCiphers(request);\n  }\n\n  private async handleOrganizationalImport(importResult: ImportResult, organizationId: string) {\n    const request = new ImportOrganizationCiphersRequest();\n    for (let i = 0; i < importResult.ciphers.length; i++) {\n      importResult.ciphers[i].organizationId = organizationId;\n      const c = await this.cipherService.encrypt(importResult.ciphers[i]);\n      request.ciphers.push(new CipherRequest(c));\n    }\n    if (importResult.collections != null) {\n      for (let i = 0; i < importResult.collections.length; i++) {\n        importResult.collections[i].organizationId = organizationId;\n        const c = await this.collectionService.encrypt(importResult.collections[i]);\n        request.collections.push(new CollectionWithIdRequest(c));\n      }\n    }\n    if (importResult.collectionRelationships != null) {\n      importResult.collectionRelationships.forEach((r) =>\n        request.collectionRelationships.push(new KvpRequest(r[0], r[1])),\n      );\n    }\n    return await this.importApiService.postImportOrganizationCiphers(organizationId, request);\n  }\n\n  private badData(c: CipherView) {\n    return (\n      (c.name == null || c.name === \"--\") &&\n      c.type === CipherType.Login &&\n      c.login != null &&\n      Utils.isNullOrWhitespace(c.login.password)\n    );\n  }\n\n  private handleServerError(errorResponse: ErrorResponse, importResult: ImportResult): Error {\n    if (errorResponse.validationErrors == null) {\n      return new Error(errorResponse.message);\n    }\n\n    let errorMessage = \"\";\n\n    Object.entries(errorResponse.validationErrors).forEach(([key, value], index) => {\n      let item;\n      let itemType;\n      const i = Number(key.match(/[0-9]+/)[0]);\n\n      switch (key.match(/^\\w+/)[0]) {\n        case \"Ciphers\":\n          item = importResult.ciphers[i];\n          itemType = CipherType[item.type];\n          break;\n        case \"Folders\":\n          item = importResult.folders[i];\n          itemType = \"Folder\";\n          break;\n        case \"Collections\":\n          item = importResult.collections[i];\n          itemType = \"Collection\";\n          break;\n        default:\n          return;\n      }\n\n      if (index > 0) {\n        errorMessage += \"\\n\\n\";\n      }\n\n      if (itemType !== \"Folder\" && itemType !== \"Collection\") {\n        errorMessage += \"[\" + (i + 1) + \"] \";\n      }\n\n      errorMessage += \"[\" + itemType + '] \"' + item.name + '\": ' + value;\n    });\n\n    return new Error(errorMessage);\n  }\n\n  private async setImportTarget(\n    importResult: ImportResult,\n    organizationId: string,\n    importTarget: string,\n  ) {\n    if (Utils.isNullOrWhitespace(importTarget)) {\n      return;\n    }\n\n    if (organizationId) {\n      const collectionViews: CollectionView[] = await this.collectionService.getAllDecrypted();\n      const targetCollection = collectionViews.find((c) => c.id === importTarget);\n\n      const noCollectionRelationShips: [number, number][] = [];\n      importResult.ciphers.forEach((c, index) => {\n        if (!Array.isArray(c.collectionIds) || c.collectionIds.length == 0) {\n          c.collectionIds = [targetCollection.id];\n          noCollectionRelationShips.push([index, 0]);\n        }\n      });\n\n      const collections: CollectionView[] = [...importResult.collections];\n      importResult.collections = [targetCollection];\n      collections.map((x) => {\n        const f = new CollectionView();\n        f.name = `${targetCollection.name}/${x.name}`;\n        importResult.collections.push(f);\n      });\n\n      const relationships: [number, number][] = [...importResult.collectionRelationships];\n      importResult.collectionRelationships = [...noCollectionRelationShips];\n      relationships.map((x) => {\n        importResult.collectionRelationships.push([x[0], x[1] + 1]);\n      });\n\n      return;\n    }\n\n    const folderViews = await this.folderService.getAllDecryptedFromState();\n    const targetFolder = folderViews.find((f) => f.id === importTarget);\n\n    const noFolderRelationShips: [number, number][] = [];\n    importResult.ciphers.forEach((c, index) => {\n      if (Utils.isNullOrEmpty(c.folderId)) {\n        c.folderId = targetFolder.id;\n        noFolderRelationShips.push([index, 0]);\n      }\n    });\n\n    const folders: FolderView[] = [...importResult.folders];\n    importResult.folders = [targetFolder];\n    folders.map((x) => {\n      const newFolderName = `${targetFolder.name}/${x.name}`;\n      const f = new FolderView();\n      f.name = newFolderName;\n      importResult.folders.push(f);\n    });\n\n    const relationships: [number, number][] = [...importResult.folderRelationships];\n    importResult.folderRelationships = [...noFolderRelationShips];\n    relationships.map((x) => {\n      importResult.folderRelationships.push([x[0], x[1] + 1]);\n    });\n  }\n}\n","export class ExportHelper {\n  static getFileName(prefix: string = null, extension = \"csv\"): string {\n    const now = new Date();\n    const dateString =\n      now.getFullYear() +\n      \"\" +\n      this.padNumber(now.getMonth() + 1, 2) +\n      \"\" +\n      this.padNumber(now.getDate(), 2) +\n      this.padNumber(now.getHours(), 2) +\n      \"\" +\n      this.padNumber(now.getMinutes(), 2) +\n      this.padNumber(now.getSeconds(), 2);\n\n    return \"bitwarden\" + (prefix ? \"_\" + prefix : \"\") + \"_export_\" + dateString + \".\" + extension;\n  }\n\n  private static padNumber(num: number, width: number, padCharacter = \"0\"): string {\n    const numString = num.toString();\n    return numString.length >= width\n      ? numString\n      : new Array(width - numString.length + 1).join(padCharacter) + numString;\n  }\n}\n","import { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nimport { ExportHelper } from \"./export-helper\";\nimport { IndividualVaultExportServiceAbstraction } from \"./individual-vault-export.service.abstraction\";\nimport { OrganizationVaultExportServiceAbstraction } from \"./org-vault-export.service.abstraction\";\nimport { ExportFormat, VaultExportServiceAbstraction } from \"./vault-export.service.abstraction\";\n\nexport class VaultExportService implements VaultExportServiceAbstraction {\n  constructor(\n    private individualVaultExportService: IndividualVaultExportServiceAbstraction,\n    private organizationVaultExportService: OrganizationVaultExportServiceAbstraction,\n  ) {}\n\n  async getExport(format: ExportFormat = \"csv\", password: string): Promise<string> {\n    if (!Utils.isNullOrWhitespace(password)) {\n      if (format == \"csv\") {\n        throw new Error(\"CSV does not support password protected export\");\n      }\n\n      return this.individualVaultExportService.getPasswordProtectedExport(password);\n    }\n    return this.individualVaultExportService.getExport(format);\n  }\n\n  async getOrganizationExport(\n    organizationId: string,\n    format: ExportFormat,\n    password: string,\n    onlyManagedCollections = false,\n  ): Promise<string> {\n    if (!Utils.isNullOrWhitespace(password)) {\n      if (format == \"csv\") {\n        throw new Error(\"CSV does not support password protected export\");\n      }\n\n      return this.organizationVaultExportService.getPasswordProtectedExport(\n        organizationId,\n        password,\n        onlyManagedCollections,\n      );\n    }\n\n    return this.organizationVaultExportService.getOrganizationExport(\n      organizationId,\n      format,\n      onlyManagedCollections,\n    );\n  }\n\n  getFileName(prefix: string = null, extension = \"csv\"): string {\n    return ExportHelper.getFileName(prefix, extension);\n  }\n}\n","import { KdfConfig } from \"@bitwarden/common/auth/models/domain/kdf-config\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { KdfType } from \"@bitwarden/common/platform/enums\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { BitwardenCsvExportType, BitwardenPasswordProtectedFileFormat } from \"../types\";\nexport class BaseVaultExportService {\n  constructor(\n    protected cryptoService: CryptoService,\n    private cryptoFunctionService: CryptoFunctionService,\n    private stateService: StateService,\n  ) {}\n\n  protected async buildPasswordExport(clearText: string, password: string): Promise<string> {\n    const kdfType: KdfType = await this.stateService.getKdfType();\n    const kdfConfig: KdfConfig = await this.stateService.getKdfConfig();\n\n    const salt = Utils.fromBufferToB64(await this.cryptoFunctionService.randomBytes(16));\n    const key = await this.cryptoService.makePinKey(password, salt, kdfType, kdfConfig);\n\n    const encKeyValidation = await this.cryptoService.encrypt(Utils.newGuid(), key);\n    const encText = await this.cryptoService.encrypt(clearText, key);\n\n    const jsonDoc: BitwardenPasswordProtectedFileFormat = {\n      encrypted: true,\n      passwordProtected: true,\n      salt: salt,\n      kdfType: kdfType,\n      kdfIterations: kdfConfig.iterations,\n      kdfMemory: kdfConfig.memory,\n      kdfParallelism: kdfConfig.parallelism,\n      encKeyValidation_DO_NOT_EDIT: encKeyValidation.encryptedString,\n      data: encText.encryptedString,\n    };\n\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n\n  protected buildCommonCipher(\n    cipher: BitwardenCsvExportType,\n    c: CipherView,\n  ): BitwardenCsvExportType {\n    cipher.type = null;\n    cipher.name = c.name;\n    cipher.notes = c.notes;\n    cipher.fields = null;\n    cipher.reprompt = c.reprompt;\n    // Login props\n    cipher.login_uri = null;\n    cipher.login_username = null;\n    cipher.login_password = null;\n    cipher.login_totp = null;\n\n    if (c.fields) {\n      c.fields.forEach((f) => {\n        if (!cipher.fields) {\n          cipher.fields = \"\";\n        } else {\n          cipher.fields += \"\\n\";\n        }\n\n        cipher.fields += (f.name || \"\") + \": \" + f.value;\n      });\n    }\n\n    switch (c.type) {\n      case CipherType.Login:\n        cipher.type = \"login\";\n        cipher.login_username = c.login.username;\n        cipher.login_password = c.login.password;\n        cipher.login_totp = c.login.totp;\n\n        if (c.login.uris) {\n          cipher.login_uri = [];\n          c.login.uris.forEach((u) => {\n            cipher.login_uri.push(u.uri);\n          });\n        }\n        break;\n      case CipherType.SecureNote:\n        cipher.type = \"note\";\n        break;\n      default:\n        return;\n    }\n\n    return cipher;\n  }\n}\n","import * as papa from \"papaparse\";\n\nimport { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { CipherWithIdExport, CollectionWithIdExport } from \"@bitwarden/common/models/export\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherData } from \"@bitwarden/common/vault/models/data/cipher.data\";\nimport { CollectionData } from \"@bitwarden/common/vault/models/data/collection.data\";\nimport { Cipher } from \"@bitwarden/common/vault/models/domain/cipher\";\nimport { Collection } from \"@bitwarden/common/vault/models/domain/collection\";\nimport { CollectionDetailsResponse } from \"@bitwarden/common/vault/models/response/collection.response\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\n\nimport {\n  BitwardenCsvOrgExportType,\n  BitwardenEncryptedOrgJsonExport,\n  BitwardenUnEncryptedOrgJsonExport,\n} from \"../types\";\n\nimport { BaseVaultExportService } from \"./base-vault-export.service\";\nimport { OrganizationVaultExportServiceAbstraction } from \"./org-vault-export.service.abstraction\";\nimport { ExportFormat } from \"./vault-export.service.abstraction\";\n\nexport class OrganizationVaultExportService\n  extends BaseVaultExportService\n  implements OrganizationVaultExportServiceAbstraction\n{\n  constructor(\n    private cipherService: CipherService,\n    private apiService: ApiService,\n    cryptoService: CryptoService,\n    cryptoFunctionService: CryptoFunctionService,\n    stateService: StateService,\n    private collectionService: CollectionService,\n  ) {\n    super(cryptoService, cryptoFunctionService, stateService);\n  }\n\n  async getPasswordProtectedExport(\n    organizationId: string,\n    password: string,\n    onlyManagedCollections: boolean,\n  ): Promise<string> {\n    const clearText = await this.getOrganizationExport(\n      organizationId,\n      \"json\",\n      onlyManagedCollections,\n    );\n\n    return this.buildPasswordExport(clearText, password);\n  }\n\n  async getOrganizationExport(\n    organizationId: string,\n    format: ExportFormat = \"csv\",\n    onlyManagedCollections: boolean,\n  ): Promise<string> {\n    if (Utils.isNullOrWhitespace(organizationId)) {\n      throw new Error(\"OrganizationId must be set\");\n    }\n\n    if (format === \"encrypted_json\") {\n      return onlyManagedCollections\n        ? this.getEncryptedManagedExport(organizationId)\n        : this.getOrganizationEncryptedExport(organizationId);\n    }\n\n    return onlyManagedCollections\n      ? this.getDecryptedManagedExport(organizationId, format)\n      : this.getOrganizationDecryptedExport(organizationId, format);\n  }\n\n  private async getOrganizationDecryptedExport(\n    organizationId: string,\n    format: \"json\" | \"csv\",\n  ): Promise<string> {\n    const decCollections: CollectionView[] = [];\n    const decCiphers: CipherView[] = [];\n    const promises = [];\n\n    promises.push(\n      this.apiService.getOrganizationExport(organizationId).then((exportData) => {\n        const exportPromises: any = [];\n        if (exportData != null) {\n          if (exportData.collections != null && exportData.collections.length > 0) {\n            exportData.collections.forEach((c) => {\n              const collection = new Collection(new CollectionData(c as CollectionDetailsResponse));\n              exportPromises.push(\n                collection.decrypt().then((decCol) => {\n                  decCollections.push(decCol);\n                }),\n              );\n            });\n          }\n          if (exportData.ciphers != null && exportData.ciphers.length > 0) {\n            exportData.ciphers\n              .filter((c) => c.deletedDate === null)\n              .forEach(async (c) => {\n                const cipher = new Cipher(new CipherData(c));\n                exportPromises.push(\n                  this.cipherService\n                    .getKeyForCipherKeyDecryption(cipher)\n                    .then((key) => cipher.decrypt(key))\n                    .then((decCipher) => {\n                      decCiphers.push(decCipher);\n                    }),\n                );\n              });\n          }\n        }\n        return Promise.all(exportPromises);\n      }),\n    );\n\n    await Promise.all(promises);\n\n    if (format === \"csv\") {\n      return this.buildCsvExport(decCollections, decCiphers);\n    }\n    return this.buildJsonExport(decCollections, decCiphers);\n  }\n\n  private async getOrganizationEncryptedExport(organizationId: string): Promise<string> {\n    const collections: Collection[] = [];\n    const ciphers: Cipher[] = [];\n    const promises = [];\n\n    promises.push(\n      this.apiService.getCollections(organizationId).then((c) => {\n        if (c != null && c.data != null && c.data.length > 0) {\n          c.data.forEach((r) => {\n            const collection = new Collection(new CollectionData(r as CollectionDetailsResponse));\n            collections.push(collection);\n          });\n        }\n      }),\n    );\n\n    promises.push(\n      this.apiService.getCiphersOrganization(organizationId).then((c) => {\n        if (c != null && c.data != null && c.data.length > 0) {\n          c.data\n            .filter((item) => item.deletedDate === null)\n            .forEach((item) => {\n              const cipher = new Cipher(new CipherData(item));\n              ciphers.push(cipher);\n            });\n        }\n      }),\n    );\n\n    await Promise.all(promises);\n\n    return this.BuildEncryptedExport(organizationId, collections, ciphers);\n  }\n\n  private async getDecryptedManagedExport(\n    organizationId: string,\n    format: \"json\" | \"csv\",\n  ): Promise<string> {\n    let decCiphers: CipherView[] = [];\n    let allDecCiphers: CipherView[] = [];\n    let decCollections: CollectionView[] = [];\n    const promises = [];\n\n    promises.push(\n      this.collectionService.getAllDecrypted().then(async (collections) => {\n        decCollections = collections.filter((c) => c.organizationId == organizationId && c.manage);\n      }),\n    );\n\n    promises.push(\n      this.cipherService.getAllDecrypted().then((ciphers) => {\n        allDecCiphers = ciphers;\n      }),\n    );\n    await Promise.all(promises);\n\n    decCiphers = allDecCiphers.filter(\n      (f) =>\n        f.deletedDate == null &&\n        f.organizationId == organizationId &&\n        decCollections.some((dC) => f.collectionIds.some((cId) => dC.id === cId)),\n    );\n\n    if (format === \"csv\") {\n      return this.buildCsvExport(decCollections, decCiphers);\n    }\n    return this.buildJsonExport(decCollections, decCiphers);\n  }\n\n  private async getEncryptedManagedExport(organizationId: string): Promise<string> {\n    let encCiphers: Cipher[] = [];\n    let allCiphers: Cipher[] = [];\n    let encCollections: Collection[] = [];\n    const promises = [];\n\n    promises.push(\n      this.collectionService.getAll().then((collections) => {\n        encCollections = collections.filter((c) => c.organizationId == organizationId && c.manage);\n      }),\n    );\n\n    promises.push(\n      this.cipherService.getAll().then((ciphers) => {\n        allCiphers = ciphers;\n      }),\n    );\n\n    await Promise.all(promises);\n\n    encCiphers = allCiphers.filter(\n      (f) =>\n        f.deletedDate == null &&\n        f.organizationId == organizationId &&\n        encCollections.some((eC) => f.collectionIds.some((cId) => eC.id === cId)),\n    );\n\n    return this.BuildEncryptedExport(organizationId, encCollections, encCiphers);\n  }\n\n  private async BuildEncryptedExport(\n    organizationId: string,\n    collections: Collection[],\n    ciphers: Cipher[],\n  ): Promise<string> {\n    const orgKey = await this.cryptoService.getOrgKey(organizationId);\n    const encKeyValidation = await this.cryptoService.encrypt(Utils.newGuid(), orgKey);\n\n    const jsonDoc: BitwardenEncryptedOrgJsonExport = {\n      encrypted: true,\n      encKeyValidation_DO_NOT_EDIT: encKeyValidation.encryptedString,\n      collections: [],\n      items: [],\n    };\n\n    collections.forEach((c) => {\n      const collection = new CollectionWithIdExport();\n      collection.build(c);\n      jsonDoc.collections.push(collection);\n    });\n\n    ciphers.forEach((c) => {\n      const cipher = new CipherWithIdExport();\n      cipher.build(c);\n      jsonDoc.items.push(cipher);\n    });\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n\n  private buildCsvExport(decCollections: CollectionView[], decCiphers: CipherView[]): string {\n    const collectionsMap = new Map<string, CollectionView>();\n    decCollections.forEach((c) => {\n      collectionsMap.set(c.id, c);\n    });\n\n    const exportCiphers: BitwardenCsvOrgExportType[] = [];\n    decCiphers.forEach((c) => {\n      // only export logins and secure notes\n      if (c.type !== CipherType.Login && c.type !== CipherType.SecureNote) {\n        return;\n      }\n\n      const cipher = {} as BitwardenCsvOrgExportType;\n      cipher.collections = [];\n      if (c.collectionIds != null) {\n        cipher.collections = c.collectionIds\n          .filter((id) => collectionsMap.has(id))\n          .map((id) => collectionsMap.get(id).name);\n      }\n      this.buildCommonCipher(cipher, c);\n      exportCiphers.push(cipher);\n    });\n\n    return papa.unparse(exportCiphers);\n  }\n\n  private buildJsonExport(decCollections: CollectionView[], decCiphers: CipherView[]): string {\n    const jsonDoc: BitwardenUnEncryptedOrgJsonExport = {\n      encrypted: false,\n      collections: [],\n      items: [],\n    };\n\n    decCollections.forEach((c) => {\n      const collection = new CollectionWithIdExport();\n      collection.build(c);\n      jsonDoc.collections.push(collection);\n    });\n\n    decCiphers.forEach((c) => {\n      const cipher = new CipherWithIdExport();\n      cipher.build(c);\n      jsonDoc.items.push(cipher);\n    });\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n}\n","import * as papa from \"papaparse\";\n\nimport { CipherWithIdExport, FolderWithIdExport } from \"@bitwarden/common/models/export\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { Cipher } from \"@bitwarden/common/vault/models/domain/cipher\";\nimport { Folder } from \"@bitwarden/common/vault/models/domain/folder\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport {\n  BitwardenCsvIndividualExportType,\n  BitwardenEncryptedIndividualJsonExport,\n  BitwardenUnEncryptedIndividualJsonExport,\n} from \"../types\";\n\nimport { BaseVaultExportService } from \"./base-vault-export.service\";\nimport { IndividualVaultExportServiceAbstraction } from \"./individual-vault-export.service.abstraction\";\nimport { ExportFormat } from \"./vault-export.service.abstraction\";\n\nexport class IndividualVaultExportService\n  extends BaseVaultExportService\n  implements IndividualVaultExportServiceAbstraction\n{\n  constructor(\n    private folderService: FolderService,\n    private cipherService: CipherService,\n    cryptoService: CryptoService,\n    cryptoFunctionService: CryptoFunctionService,\n    stateService: StateService,\n  ) {\n    super(cryptoService, cryptoFunctionService, stateService);\n  }\n\n  async getExport(format: ExportFormat = \"csv\"): Promise<string> {\n    if (format === \"encrypted_json\") {\n      return this.getEncryptedExport();\n    }\n    return this.getDecryptedExport(format);\n  }\n\n  async getPasswordProtectedExport(password: string): Promise<string> {\n    const clearText = await this.getExport(\"json\");\n    return this.buildPasswordExport(clearText, password);\n  }\n\n  private async getDecryptedExport(format: \"json\" | \"csv\"): Promise<string> {\n    let decFolders: FolderView[] = [];\n    let decCiphers: CipherView[] = [];\n    const promises = [];\n\n    promises.push(\n      this.folderService.getAllDecryptedFromState().then((folders) => {\n        decFolders = folders;\n      }),\n    );\n\n    promises.push(\n      this.cipherService.getAllDecrypted().then((ciphers) => {\n        decCiphers = ciphers.filter((f) => f.deletedDate == null);\n      }),\n    );\n\n    await Promise.all(promises);\n\n    if (format === \"csv\") {\n      return this.buildCsvExport(decFolders, decCiphers);\n    }\n\n    return this.buildJsonExport(decFolders, decCiphers);\n  }\n\n  private async getEncryptedExport(): Promise<string> {\n    let folders: Folder[] = [];\n    let ciphers: Cipher[] = [];\n    const promises = [];\n\n    promises.push(\n      this.folderService.getAllFromState().then((f) => {\n        folders = f;\n      }),\n    );\n\n    promises.push(\n      this.cipherService.getAll().then((c) => {\n        ciphers = c.filter((f) => f.deletedDate == null);\n      }),\n    );\n\n    await Promise.all(promises);\n\n    const encKeyValidation = await this.cryptoService.encrypt(Utils.newGuid());\n\n    const jsonDoc: BitwardenEncryptedIndividualJsonExport = {\n      encrypted: true,\n      encKeyValidation_DO_NOT_EDIT: encKeyValidation.encryptedString,\n      folders: [],\n      items: [],\n    };\n\n    folders.forEach((f) => {\n      if (f.id == null) {\n        return;\n      }\n      const folder = new FolderWithIdExport();\n      folder.build(f);\n      jsonDoc.folders.push(folder);\n    });\n\n    ciphers.forEach((c) => {\n      if (c.organizationId != null) {\n        return;\n      }\n      const cipher = new CipherWithIdExport();\n      cipher.build(c);\n      cipher.collectionIds = null;\n      jsonDoc.items.push(cipher);\n    });\n\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n\n  private buildCsvExport(decFolders: FolderView[], decCiphers: CipherView[]): string {\n    const foldersMap = new Map<string, FolderView>();\n    decFolders.forEach((f) => {\n      if (f.id != null) {\n        foldersMap.set(f.id, f);\n      }\n    });\n\n    const exportCiphers: BitwardenCsvIndividualExportType[] = [];\n    decCiphers.forEach((c) => {\n      // only export logins and secure notes\n      if (c.type !== CipherType.Login && c.type !== CipherType.SecureNote) {\n        return;\n      }\n      if (c.organizationId != null) {\n        return;\n      }\n\n      const cipher = {} as BitwardenCsvIndividualExportType;\n      cipher.folder =\n        c.folderId != null && foldersMap.has(c.folderId) ? foldersMap.get(c.folderId).name : null;\n      cipher.favorite = c.favorite ? 1 : null;\n      this.buildCommonCipher(cipher, c);\n      exportCiphers.push(cipher);\n    });\n\n    return papa.unparse(exportCiphers);\n  }\n\n  private buildJsonExport(decFolders: FolderView[], decCiphers: CipherView[]): string {\n    const jsonDoc: BitwardenUnEncryptedIndividualJsonExport = {\n      encrypted: false,\n      folders: [],\n      items: [],\n    };\n\n    decFolders.forEach((f) => {\n      if (f.id == null) {\n        return;\n      }\n      const folder = new FolderWithIdExport();\n      folder.build(f);\n      jsonDoc.folders.push(folder);\n    });\n\n    decCiphers.forEach((c) => {\n      if (c.organizationId != null) {\n        return;\n      }\n      const cipher = new CipherWithIdExport();\n      cipher.build(c);\n      cipher.collectionIds = null;\n      jsonDoc.items.push(cipher);\n    });\n\n    return JSON.stringify(jsonDoc, null, \"  \");\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { ProductType } from \"../../../enums\";\nimport { OrganizationUserStatusType, OrganizationUserType, ProviderType } from \"../../enums\";\nimport { PermissionsApi } from \"../api/permissions.api\";\nimport { OrganizationData } from \"../data/organization.data\";\n\nexport class Organization {\n  id: string;\n  name: string;\n  status: OrganizationUserStatusType;\n\n  /**\n   * The member's role in the organization.\n   * Avoid using this for permission checks - use the getters instead (e.g. isOwner, isAdmin, canManageX), because they\n   * properly handle permission inheritance and relationships.\n   */\n  type: OrganizationUserType;\n\n  enabled: boolean;\n  usePolicies: boolean;\n  useGroups: boolean;\n  useDirectory: boolean;\n  useEvents: boolean;\n  useTotp: boolean;\n  use2fa: boolean;\n  useApi: boolean;\n  useSso: boolean;\n  useKeyConnector: boolean;\n  useScim: boolean;\n  useCustomPermissions: boolean;\n  useResetPassword: boolean;\n  useSecretsManager: boolean;\n  usePasswordManager: boolean;\n  useActivateAutofillPolicy: boolean;\n  selfHost: boolean;\n  usersGetPremium: boolean;\n  seats: number;\n  maxCollections: number;\n  maxStorageGb?: number;\n  ssoBound: boolean;\n  identifier: string;\n  permissions: PermissionsApi;\n  resetPasswordEnrolled: boolean;\n  userId: string;\n  hasPublicAndPrivateKeys: boolean;\n  providerId: string;\n  providerName: string;\n  providerType?: ProviderType;\n  /**\n   * Indicates that a user is a ProviderUser for the organization\n   */\n  isProviderUser: boolean;\n  /**\n   * Indicates that a user is a member for the organization (may be `false` if they have access via a Provider only)\n   */\n  isMember: boolean;\n  familySponsorshipFriendlyName: string;\n  familySponsorshipAvailable: boolean;\n  planProductType: ProductType;\n  keyConnectorEnabled: boolean;\n  keyConnectorUrl: string;\n  familySponsorshipLastSyncDate?: Date;\n  familySponsorshipValidUntil?: Date;\n  familySponsorshipToDelete?: boolean;\n  accessSecretsManager: boolean;\n  /**\n   * Refers to the ability for an organization to limit collection creation and deletion to owners and admins only\n   */\n  limitCollectionCreationDeletion: boolean;\n  /**\n   * Refers to the ability for an owner/admin to access all collection items, regardless of assigned collections\n   */\n  allowAdminAccessToAllCollectionItems: boolean;\n  /**\n   * Returns true if this organization has enabled Flexible Collections (MVP) and their data has been migrated.\n   * Generally, you should use this as the feature flag to gate Flexible Collections features.\n   */\n  flexibleCollections: boolean;\n\n  constructor(obj?: OrganizationData) {\n    if (obj == null) {\n      return;\n    }\n\n    this.id = obj.id;\n    this.name = obj.name;\n    this.status = obj.status;\n    this.type = obj.type;\n    this.enabled = obj.enabled;\n    this.usePolicies = obj.usePolicies;\n    this.useGroups = obj.useGroups;\n    this.useDirectory = obj.useDirectory;\n    this.useEvents = obj.useEvents;\n    this.useTotp = obj.useTotp;\n    this.use2fa = obj.use2fa;\n    this.useApi = obj.useApi;\n    this.useSso = obj.useSso;\n    this.useKeyConnector = obj.useKeyConnector;\n    this.useScim = obj.useScim;\n    this.useCustomPermissions = obj.useCustomPermissions;\n    this.useResetPassword = obj.useResetPassword;\n    this.useSecretsManager = obj.useSecretsManager;\n    this.usePasswordManager = obj.usePasswordManager;\n    this.useActivateAutofillPolicy = obj.useActivateAutofillPolicy;\n    this.selfHost = obj.selfHost;\n    this.usersGetPremium = obj.usersGetPremium;\n    this.seats = obj.seats;\n    this.maxCollections = obj.maxCollections;\n    this.maxStorageGb = obj.maxStorageGb;\n    this.ssoBound = obj.ssoBound;\n    this.identifier = obj.identifier;\n    this.permissions = obj.permissions;\n    this.resetPasswordEnrolled = obj.resetPasswordEnrolled;\n    this.userId = obj.userId;\n    this.hasPublicAndPrivateKeys = obj.hasPublicAndPrivateKeys;\n    this.providerId = obj.providerId;\n    this.providerName = obj.providerName;\n    this.providerType = obj.providerType;\n    this.isProviderUser = obj.isProviderUser;\n    this.isMember = obj.isMember;\n    this.familySponsorshipFriendlyName = obj.familySponsorshipFriendlyName;\n    this.familySponsorshipAvailable = obj.familySponsorshipAvailable;\n    this.planProductType = obj.planProductType;\n    this.keyConnectorEnabled = obj.keyConnectorEnabled;\n    this.keyConnectorUrl = obj.keyConnectorUrl;\n    this.familySponsorshipLastSyncDate = obj.familySponsorshipLastSyncDate;\n    this.familySponsorshipValidUntil = obj.familySponsorshipValidUntil;\n    this.familySponsorshipToDelete = obj.familySponsorshipToDelete;\n    this.accessSecretsManager = obj.accessSecretsManager;\n    this.limitCollectionCreationDeletion = obj.limitCollectionCreationDeletion;\n    this.allowAdminAccessToAllCollectionItems = obj.allowAdminAccessToAllCollectionItems;\n    this.flexibleCollections = obj.flexibleCollections;\n  }\n\n  get canAccess() {\n    if (this.isOwner) {\n      return true;\n    }\n    return this.enabled && this.status === OrganizationUserStatusType.Confirmed;\n  }\n\n  /**\n   * Whether a user has Manager permissions or greater\n   *\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   */\n  get isManager() {\n    return this.type === OrganizationUserType.Manager || this.isAdmin;\n  }\n\n  /**\n   * Whether a user has Admin permissions or greater\n   */\n  get isAdmin() {\n    return this.type === OrganizationUserType.Admin || this.isOwner;\n  }\n\n  /**\n   * Whether a user has Owner permissions (including ProviderUsers)\n   */\n  get isOwner() {\n    return this.type === OrganizationUserType.Owner || this.isProviderUser;\n  }\n\n  get canAccessEventLogs() {\n    return (this.isAdmin || this.permissions.accessEventLogs) && this.useEvents;\n  }\n\n  get canAccessImportExport() {\n    return this.isAdmin || this.permissions.accessImportExport;\n  }\n\n  get canAccessReports() {\n    return this.isAdmin || this.permissions.accessReports;\n  }\n\n  get canCreateNewCollections() {\n    if (this.flexibleCollections) {\n      return (\n        !this.limitCollectionCreationDeletion ||\n        this.isAdmin ||\n        this.permissions.createNewCollections\n      );\n    }\n\n    return this.isManager || this.permissions.createNewCollections;\n  }\n\n  get canEditAnyCollection() {\n    return this.isAdmin || this.permissions.editAnyCollection;\n  }\n\n  get canUseAdminCollections() {\n    return this.canEditAnyCollection;\n  }\n\n  canEditAllCiphers(flexibleCollectionsV1Enabled: boolean) {\n    // Before Flexible Collections, anyone with editAnyCollection permission could edit all ciphers\n    if (!flexibleCollectionsV1Enabled) {\n      return this.canEditAnyCollection;\n    }\n    // Post Flexible Collections V1, the allowAdminAccessToAllCollectionItems flag can restrict admins\n    // Providers and custom users with canEditAnyCollection are not affected by allowAdminAccessToAllCollectionItems flag\n    return (\n      this.isProviderUser ||\n      (this.type === OrganizationUserType.Custom && this.permissions.editAnyCollection) ||\n      (this.allowAdminAccessToAllCollectionItems && this.isAdmin)\n    );\n  }\n\n  get canDeleteAnyCollection() {\n    return this.isAdmin || this.permissions.deleteAnyCollection;\n  }\n\n  get canViewAllCollections() {\n    return this.canEditAnyCollection || this.canDeleteAnyCollection;\n  }\n\n  /**\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   * This will always return false if FlexibleCollections flag is on.\n   */\n  get canEditAssignedCollections() {\n    return this.isManager || this.permissions.editAssignedCollections;\n  }\n\n  /**\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   * This will always return false if FlexibleCollections flag is on.\n   */\n  get canDeleteAssignedCollections() {\n    return this.isManager || this.permissions.deleteAssignedCollections;\n  }\n\n  /**\n   * @deprecated\n   * This is deprecated with the introduction of Flexible Collections.\n   * This will always return false if FlexibleCollections flag is on.\n   */\n  get canViewAssignedCollections() {\n    return this.canDeleteAssignedCollections || this.canEditAssignedCollections;\n  }\n\n  get canManageGroups() {\n    return (this.isAdmin || this.permissions.manageGroups) && this.useGroups;\n  }\n\n  get canManageSso() {\n    return (this.isAdmin || this.permissions.manageSso) && this.useSso;\n  }\n\n  get canManageDomainVerification() {\n    return (this.isAdmin || this.permissions.manageSso) && this.useSso;\n  }\n\n  get canManageScim() {\n    return (this.isAdmin || this.permissions.manageScim) && this.useScim;\n  }\n\n  get canManagePolicies() {\n    return (this.isAdmin || this.permissions.managePolicies) && this.usePolicies;\n  }\n\n  get canManageUsers() {\n    return this.isAdmin || this.permissions.manageUsers;\n  }\n\n  get canManageUsersPassword() {\n    return this.isAdmin || this.permissions.manageResetPassword;\n  }\n\n  get canManageDeviceApprovals() {\n    return (this.isAdmin || this.permissions.manageResetPassword) && this.useSso;\n  }\n\n  get isExemptFromPolicies() {\n    return this.canManagePolicies;\n  }\n\n  get canViewSubscription() {\n    if (this.canEditSubscription) {\n      return true;\n    }\n\n    return this.hasProvider && this.providerType === ProviderType.Msp\n      ? this.isProviderUser\n      : this.isOwner;\n  }\n\n  get canEditSubscription() {\n    return this.hasProvider ? this.isProviderUser : this.isOwner;\n  }\n\n  get canEditPaymentMethods() {\n    return this.canEditSubscription;\n  }\n\n  get canViewBillingHistory() {\n    return this.canEditSubscription;\n  }\n\n  get hasProvider() {\n    return this.providerId != null || this.providerName != null;\n  }\n\n  get hasReseller() {\n    return this.hasProvider && this.providerType === ProviderType.Reseller;\n  }\n\n  get canAccessSecretsManager() {\n    return this.useSecretsManager && this.accessSecretsManager;\n  }\n\n  get isFreeOrg() {\n    // return true if organization needs to be upgraded from a free org\n    return !this.useTotp;\n  }\n\n  static fromJSON(json: Jsonify<Organization>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new Organization(), json, {\n      familySponsorshipLastSyncDate: new Date(json.familySponsorshipLastSyncDate),\n      familySponsorshipValidUntil: new Date(json.familySponsorshipValidUntil),\n    });\n  }\n}\n","import { map, Observable } from \"rxjs\";\n\nimport { I18nService } from \"../../../platform/abstractions/i18n.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { OrganizationData } from \"../../models/data/organization.data\";\nimport { Organization } from \"../../models/domain/organization\";\n\nexport function canAccessVaultTab(org: Organization): boolean {\n  return org.canViewAssignedCollections || org.canViewAllCollections;\n}\n\nexport function canAccessSettingsTab(org: Organization): boolean {\n  return (\n    org.isOwner ||\n    org.canManagePolicies ||\n    org.canManageSso ||\n    org.canManageScim ||\n    org.canAccessImportExport ||\n    org.canManageDeviceApprovals\n  );\n}\n\nexport function canAccessMembersTab(org: Organization): boolean {\n  return org.canManageUsers || org.canManageUsersPassword;\n}\n\nexport function canAccessGroupsTab(org: Organization): boolean {\n  return org.canManageGroups;\n}\n\nexport function canAccessReportingTab(org: Organization): boolean {\n  return org.canAccessReports || org.canAccessEventLogs;\n}\n\nexport function canAccessBillingTab(org: Organization): boolean {\n  return org.isOwner;\n}\n\nexport function canAccessOrgAdmin(org: Organization): boolean {\n  // Admin console can only be accessed by Owners for disabled organizations\n  if (!org.enabled && !org.isOwner) {\n    return false;\n  }\n  return (\n    canAccessMembersTab(org) ||\n    canAccessGroupsTab(org) ||\n    canAccessReportingTab(org) ||\n    canAccessBillingTab(org) ||\n    canAccessSettingsTab(org) ||\n    canAccessVaultTab(org)\n  );\n}\n\nexport function getOrganizationById(id: string) {\n  return map<Organization[], Organization | undefined>((orgs) => orgs.find((o) => o.id === id));\n}\n\nexport function canAccessAdmin(i18nService: I18nService) {\n  return map<Organization[], Organization[]>((orgs) =>\n    orgs.filter(canAccessOrgAdmin).sort(Utils.getSortFunction(i18nService, \"name\")),\n  );\n}\n\n/**\n * @deprecated\n * To be removed after Flexible Collections.\n **/\nexport function canAccessImportExport(i18nService: I18nService) {\n  return map<Organization[], Organization[]>((orgs) =>\n    orgs\n      .filter((org) => org.canAccessImportExport)\n      .sort(Utils.getSortFunction(i18nService, \"name\")),\n  );\n}\n\nexport function canAccessImport(i18nService: I18nService) {\n  return map<Organization[], Organization[]>((orgs) =>\n    orgs\n      .filter(\n        (org) =>\n          org.canAccessImportExport || (org.canCreateNewCollections && org.flexibleCollections),\n      )\n      .sort(Utils.getSortFunction(i18nService, \"name\")),\n  );\n}\n\n/**\n * Returns `true` if a user is a member of an organization (rather than only being a ProviderUser)\n * @deprecated Use organizationService.memberOrganizations$ instead\n */\nexport function isMember(org: Organization): boolean {\n  return org.isMember;\n}\n\nexport abstract class OrganizationService {\n  organizations$: Observable<Organization[]>;\n\n  /**\n   * Organizations that the user is a member of (excludes organizations that they only have access to via a provider)\n   */\n  memberOrganizations$: Observable<Organization[]>;\n\n  get$: (id: string) => Observable<Organization | undefined>;\n  get: (id: string) => Organization;\n  getByIdentifier: (identifier: string) => Organization;\n  getAll: (userId?: string) => Promise<Organization[]>;\n  /**\n   * @deprecated For the CLI only\n   * @param id id of the organization\n   */\n  getFromState: (id: string) => Promise<Organization>;\n  canManageSponsorships: () => Promise<boolean>;\n  hasOrganizations: () => boolean;\n}\n\nexport abstract class InternalOrganizationServiceAbstraction extends OrganizationService {\n  replace: (organizations: { [id: string]: OrganizationData }) => Promise<void>;\n  upsert: (OrganizationData: OrganizationData | OrganizationData[]) => Promise<void>;\n}\n","import { BehaviorSubject, concatMap, map, Observable } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { KeyDefinition, ORGANIZATIONS_DISK, StateProvider } from \"../../../platform/state\";\nimport {\n  InternalOrganizationServiceAbstraction,\n  isMember,\n} from \"../../abstractions/organization/organization.service.abstraction\";\nimport { OrganizationData } from \"../../models/data/organization.data\";\nimport { Organization } from \"../../models/domain/organization\";\n\nexport const ORGANIZATIONS = KeyDefinition.record<OrganizationData>(\n  ORGANIZATIONS_DISK,\n  \"organizations\",\n  {\n    deserializer: (obj: Jsonify<OrganizationData>) => OrganizationData.fromJSON(obj),\n  },\n);\n\nexport class OrganizationService implements InternalOrganizationServiceAbstraction {\n  // marked for removal during AC-2009\n  protected _organizations = new BehaviorSubject<Organization[]>([]);\n  // marked for removal during AC-2009\n  organizations$ = this._organizations.asObservable();\n  // marked for removal during AC-2009\n  memberOrganizations$ = this.organizations$.pipe(map((orgs) => orgs.filter(isMember)));\n\n  activeUserOrganizations$: Observable<Organization[]>;\n  activeUserMemberOrganizations$: Observable<Organization[]>;\n\n  constructor(\n    private stateService: StateService,\n    private stateProvider: StateProvider,\n  ) {\n    this.activeUserOrganizations$ = this.stateProvider\n      .getActive(ORGANIZATIONS)\n      .state$.pipe(map((data) => Object.values(data).map((o) => new Organization(o))));\n\n    this.activeUserMemberOrganizations$ = this.activeUserOrganizations$.pipe(\n      map((orgs) => orgs.filter(isMember)),\n    );\n\n    this.stateService.activeAccountUnlocked$\n      .pipe(\n        concatMap(async (unlocked) => {\n          if (!unlocked) {\n            this._organizations.next([]);\n            return;\n          }\n\n          const data = await this.stateService.getOrganizations();\n          this.updateObservables(data);\n        }),\n      )\n      .subscribe();\n  }\n\n  get$(id: string): Observable<Organization | undefined> {\n    return this.organizations$.pipe(map((orgs) => orgs.find((o) => o.id === id)));\n  }\n\n  async getAll(userId?: string): Promise<Organization[]> {\n    const organizationsMap = await this.stateService.getOrganizations({ userId: userId });\n    return Object.values(organizationsMap || {}).map((o) => new Organization(o));\n  }\n\n  async canManageSponsorships(): Promise<boolean> {\n    const organizations = this._organizations.getValue();\n    return organizations.some(\n      (o) => o.familySponsorshipAvailable || o.familySponsorshipFriendlyName !== null,\n    );\n  }\n\n  hasOrganizations(): boolean {\n    const organizations = this._organizations.getValue();\n    return organizations.length > 0;\n  }\n\n  async upsert(organization: OrganizationData): Promise<void> {\n    let organizations = await this.stateService.getOrganizations();\n    if (organizations == null) {\n      organizations = {};\n    }\n\n    organizations[organization.id] = organization;\n\n    await this.replace(organizations);\n  }\n\n  async delete(id: string): Promise<void> {\n    const organizations = await this.stateService.getOrganizations();\n    if (organizations == null) {\n      return;\n    }\n\n    if (organizations[id] == null) {\n      return;\n    }\n\n    delete organizations[id];\n    await this.replace(organizations);\n  }\n\n  get(id: string): Organization {\n    const organizations = this._organizations.getValue();\n\n    return organizations.find((organization) => organization.id === id);\n  }\n\n  /**\n   * @deprecated For the CLI only\n   * @param id id of the organization\n   */\n  async getFromState(id: string): Promise<Organization> {\n    const organizationsMap = await this.stateService.getOrganizations();\n    const organization = organizationsMap[id];\n    if (organization == null) {\n      return null;\n    }\n\n    return new Organization(organization);\n  }\n\n  getByIdentifier(identifier: string): Organization {\n    const organizations = this._organizations.getValue();\n\n    return organizations.find((organization) => organization.identifier === identifier);\n  }\n\n  async replace(organizations: { [id: string]: OrganizationData }) {\n    await this.stateService.setOrganizations(organizations);\n    this.updateObservables(organizations);\n  }\n\n  private updateObservables(organizationsMap: { [id: string]: OrganizationData }) {\n    const organizations = Object.values(organizationsMap || {}).map((o) => new Organization(o));\n    this._organizations.next(organizations);\n  }\n}\n","import { BrowserApi } from \"../platform/browser/browser-api\";\n\nexport class SafariApp {\n  static sendMessageToApp(command: string, data: any = null, resolveNow = false): Promise<any> {\n    if (!BrowserApi.isSafariApi) {\n      return Promise.resolve(null);\n    }\n    return new Promise((resolve) => {\n      const now = new Date();\n      const messageId =\n        now.getTime().toString() + \"_\" + Math.floor(Math.random() * Number.MAX_SAFE_INTEGER);\n      (browser as any).runtime.sendNativeMessage(\n        \"com.bitwarden.desktop\",\n        {\n          id: messageId,\n          command: command,\n          data: data,\n          responseData: null,\n        },\n        (response: any) => {\n          resolve(response);\n        },\n      );\n    });\n  }\n}\n","import { ClientType, DeviceType } from \"@bitwarden/common/enums\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\n\nimport { SafariApp } from \"../../browser/safariApp\";\nimport { BrowserApi } from \"../browser/browser-api\";\n\nexport default class BrowserPlatformUtilsService implements PlatformUtilsService {\n  private static deviceCache: DeviceType = null;\n\n  constructor(\n    private messagingService: MessagingService,\n    private clipboardWriteCallback: (clipboardValue: string, clearMs: number) => void,\n    private biometricCallback: () => Promise<boolean>,\n    private win: Window & typeof globalThis,\n  ) {}\n\n  static getDevice(win: Window & typeof globalThis): DeviceType {\n    if (this.deviceCache) {\n      return this.deviceCache;\n    }\n\n    if (BrowserPlatformUtilsService.isFirefox()) {\n      this.deviceCache = DeviceType.FirefoxExtension;\n    } else if (BrowserPlatformUtilsService.isOpera(win)) {\n      this.deviceCache = DeviceType.OperaExtension;\n    } else if (BrowserPlatformUtilsService.isEdge()) {\n      this.deviceCache = DeviceType.EdgeExtension;\n    } else if (BrowserPlatformUtilsService.isVivaldi()) {\n      this.deviceCache = DeviceType.VivaldiExtension;\n    } else if (BrowserPlatformUtilsService.isChrome(win)) {\n      this.deviceCache = DeviceType.ChromeExtension;\n    } else if (BrowserPlatformUtilsService.isSafari(win)) {\n      this.deviceCache = DeviceType.SafariExtension;\n    }\n\n    return this.deviceCache;\n  }\n\n  getDevice(): DeviceType {\n    return BrowserPlatformUtilsService.getDevice(this.win);\n  }\n\n  getDeviceString(): string {\n    const device = DeviceType[this.getDevice()].toLowerCase();\n    return device.replace(\"extension\", \"\");\n  }\n\n  getClientType(): ClientType {\n    return ClientType.Browser;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  static isFirefox(): boolean {\n    return (\n      navigator.userAgent.indexOf(\" Firefox/\") !== -1 ||\n      navigator.userAgent.indexOf(\" Gecko/\") !== -1\n    );\n  }\n\n  isFirefox(): boolean {\n    return this.getDevice() === DeviceType.FirefoxExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  private static isChrome(win: Window & typeof globalThis): boolean {\n    return win.chrome && navigator.userAgent.indexOf(\" Chrome/\") !== -1;\n  }\n\n  isChrome(): boolean {\n    return this.getDevice() === DeviceType.ChromeExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  private static isEdge(): boolean {\n    return navigator.userAgent.indexOf(\" Edg/\") !== -1;\n  }\n\n  isEdge(): boolean {\n    return this.getDevice() === DeviceType.EdgeExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  private static isOpera(win: Window & typeof globalThis): boolean {\n    return (\n      (!!win.opr && !!win.opr.addons) || !!win.opera || navigator.userAgent.indexOf(\" OPR/\") >= 0\n    );\n  }\n\n  isOpera(): boolean {\n    return this.getDevice() === DeviceType.OperaExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  private static isVivaldi(): boolean {\n    return navigator.userAgent.indexOf(\" Vivaldi/\") !== -1;\n  }\n\n  isVivaldi(): boolean {\n    return this.getDevice() === DeviceType.VivaldiExtension;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use getDevice() instead\n   */\n  static isSafari(win: Window & typeof globalThis): boolean {\n    // Opera masquerades as Safari, so make sure we're not there first\n    return (\n      !BrowserPlatformUtilsService.isOpera(win) && navigator.userAgent.indexOf(\" Safari/\") !== -1\n    );\n  }\n\n  private static safariVersion(): string {\n    return navigator.userAgent.match(\"Version/([0-9.]*)\")?.[1];\n  }\n\n  /**\n   * Safari previous to version 16.1 had a bug which caused artifacts on hover in large extension popups.\n   * https://bugs.webkit.org/show_bug.cgi?id=218704\n   */\n  static shouldApplySafariHeightFix(win: Window & typeof globalThis): boolean {\n    if (BrowserPlatformUtilsService.getDevice(win) !== DeviceType.SafariExtension) {\n      return false;\n    }\n\n    const version = BrowserPlatformUtilsService.safariVersion();\n    const parts = version?.split(\".\")?.map((v) => Number(v));\n    return parts?.[0] < 16 || (parts?.[0] === 16 && parts?.[1] === 0);\n  }\n\n  isSafari(): boolean {\n    return this.getDevice() === DeviceType.SafariExtension;\n  }\n\n  isIE(): boolean {\n    return false;\n  }\n\n  isMacAppStore(): boolean {\n    return false;\n  }\n\n  /**\n   * Identifies if the vault popup is currently open. This is done by sending a\n   * message to the popup and waiting for a response. If a response is received,\n   * the view is open.\n   */\n  async isViewOpen(): Promise<boolean> {\n    return Boolean(await BrowserApi.sendMessageWithResponse(\"checkVaultPopupHeartbeat\"));\n  }\n\n  lockTimeout(): number {\n    return null;\n  }\n\n  launchUri(uri: string, options?: any): void {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.createNewTab(uri, options && options.extensionPage === true);\n  }\n\n  getApplicationVersion(): Promise<string> {\n    return Promise.resolve(BrowserApi.getApplicationVersion());\n  }\n\n  async getApplicationVersionNumber(): Promise<string> {\n    return (await this.getApplicationVersion()).split(RegExp(\"[+|-]\"))[0].trim();\n  }\n\n  supportsWebAuthn(win: Window): boolean {\n    return typeof PublicKeyCredential !== \"undefined\";\n  }\n\n  supportsDuo(): boolean {\n    return true;\n  }\n\n  showToast(\n    type: \"error\" | \"success\" | \"warning\" | \"info\",\n    title: string,\n    text: string | string[],\n    options?: any,\n  ): void {\n    this.messagingService.send(\"showToast\", {\n      text: text,\n      title: title,\n      type: type,\n      options: options,\n    });\n  }\n\n  isDev(): boolean {\n    return process.env.ENV === \"development\";\n  }\n\n  isSelfHost(): boolean {\n    return false;\n  }\n\n  copyToClipboard(text: string, options?: any): void {\n    let win = this.win;\n    let doc = this.win.document;\n    if (options && (options.window || options.win)) {\n      win = options.window || options.win;\n      doc = win.document;\n    } else if (options && options.doc) {\n      doc = options.doc;\n    }\n    const clearing = options ? !!options.clearing : false;\n    const clearMs: number = options && options.clearMs ? options.clearMs : null;\n\n    if (this.isSafari()) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      SafariApp.sendMessageToApp(\"copyToClipboard\", text).then(() => {\n        if (!clearing && this.clipboardWriteCallback != null) {\n          this.clipboardWriteCallback(text, clearMs);\n        }\n      });\n    } else if (\n      this.isFirefox() &&\n      (win as any).navigator.clipboard &&\n      (win as any).navigator.clipboard.writeText\n    ) {\n      (win as any).navigator.clipboard.writeText(text).then(() => {\n        if (!clearing && this.clipboardWriteCallback != null) {\n          this.clipboardWriteCallback(text, clearMs);\n        }\n      });\n    } else if (doc.queryCommandSupported && doc.queryCommandSupported(\"copy\")) {\n      if (this.isChrome() && text === \"\") {\n        text = \"\\u0000\";\n      }\n\n      const textarea = doc.createElement(\"textarea\");\n      textarea.textContent = text == null || text === \"\" ? \" \" : text;\n      // Prevent scrolling to bottom of page in MS Edge.\n      textarea.style.position = \"fixed\";\n      doc.body.appendChild(textarea);\n      textarea.select();\n\n      try {\n        // Security exception may be thrown by some browsers.\n        if (doc.execCommand(\"copy\") && !clearing && this.clipboardWriteCallback != null) {\n          this.clipboardWriteCallback(text, clearMs);\n        }\n      } catch (e) {\n        // eslint-disable-next-line\n        console.warn(\"Copy to clipboard failed.\", e);\n      } finally {\n        doc.body.removeChild(textarea);\n      }\n    }\n  }\n\n  async readFromClipboard(options?: any): Promise<string> {\n    let win = this.win;\n    let doc = this.win.document;\n    if (options && (options.window || options.win)) {\n      win = options.window || options.win;\n      doc = win.document;\n    } else if (options && options.doc) {\n      doc = options.doc;\n    }\n\n    if (this.isSafari()) {\n      return await SafariApp.sendMessageToApp(\"readFromClipboard\");\n    } else if (\n      this.isFirefox() &&\n      (win as any).navigator.clipboard &&\n      (win as any).navigator.clipboard.readText\n    ) {\n      return await (win as any).navigator.clipboard.readText();\n    } else if (doc.queryCommandSupported && doc.queryCommandSupported(\"paste\")) {\n      const textarea = doc.createElement(\"textarea\");\n      // Prevent scrolling to bottom of page in MS Edge.\n      textarea.style.position = \"fixed\";\n      doc.body.appendChild(textarea);\n      textarea.focus();\n      try {\n        // Security exception may be thrown by some browsers.\n        if (doc.execCommand(\"paste\")) {\n          return textarea.value;\n        }\n      } catch (e) {\n        // eslint-disable-next-line\n        console.warn(\"Read from clipboard failed.\", e);\n      } finally {\n        doc.body.removeChild(textarea);\n      }\n    }\n    return null;\n  }\n\n  async supportsBiometric() {\n    const platformInfo = await BrowserApi.getPlatformInfo();\n    if (platformInfo.os === \"android\") {\n      return false;\n    }\n\n    return true;\n  }\n\n  authenticateBiometric() {\n    return this.biometricCallback();\n  }\n\n  supportsSecureStorage(): boolean {\n    return false;\n  }\n\n  async getAutofillKeyboardShortcut(): Promise<string> {\n    let autofillCommand: string;\n    // You can not change the command in Safari or obtain it programmatically\n    if (this.isSafari()) {\n      autofillCommand = \"Cmd+Shift+L\";\n    } else if (this.isFirefox()) {\n      autofillCommand = (await browser.commands.getAll()).find(\n        (c) => c.name === \"autofill_login\",\n      ).shortcut;\n      // Firefox is returning Ctrl instead of Cmd for the modifier key on macOS if\n      // the command is the default one set on installation.\n      if (\n        (await browser.runtime.getPlatformInfo()).os === \"mac\" &&\n        autofillCommand === \"Ctrl+Shift+L\"\n      ) {\n        autofillCommand = \"Cmd+Shift+L\";\n      }\n    } else {\n      await new Promise((resolve) =>\n        chrome.commands.getAll((c) =>\n          resolve((autofillCommand = c.find((c) => c.name === \"autofill_login\").shortcut)),\n        ),\n      );\n    }\n    return autofillCommand;\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { DeviceType } from \"@bitwarden/common/enums\";\n\nimport { TabMessage } from \"../../types/tab-messages\";\nimport BrowserPlatformUtilsService from \"../services/browser-platform-utils.service\";\n\nexport class BrowserApi {\n  static isWebExtensionsApi: boolean = typeof browser !== \"undefined\";\n  static isSafariApi: boolean =\n    navigator.userAgent.indexOf(\" Safari/\") !== -1 &&\n    navigator.userAgent.indexOf(\" Chrome/\") === -1 &&\n    navigator.userAgent.indexOf(\" Chromium/\") === -1;\n  static isChromeApi: boolean = !BrowserApi.isSafariApi && typeof chrome !== \"undefined\";\n  static isFirefoxOnAndroid: boolean =\n    navigator.userAgent.indexOf(\"Firefox/\") !== -1 && navigator.userAgent.indexOf(\"Android\") !== -1;\n\n  static get manifestVersion() {\n    return chrome.runtime.getManifest().manifest_version;\n  }\n\n  /**\n   * Gets the current window or the window with the given id.\n   *\n   * @param windowId - The id of the window to get. If not provided, the current window is returned.\n   */\n  static async getWindow(windowId?: number): Promise<chrome.windows.Window> {\n    if (!windowId) {\n      return BrowserApi.getCurrentWindow();\n    }\n\n    return await BrowserApi.getWindowById(windowId);\n  }\n\n  /**\n   * Gets the currently active browser window.\n   */\n  static async getCurrentWindow(): Promise<chrome.windows.Window> {\n    return new Promise((resolve) => chrome.windows.getCurrent({ populate: true }, resolve));\n  }\n\n  /**\n   * Gets the window with the given id.\n   *\n   * @param windowId - The id of the window to get.\n   */\n  static async getWindowById(windowId: number): Promise<chrome.windows.Window> {\n    return new Promise((resolve) => chrome.windows.get(windowId, { populate: true }, resolve));\n  }\n\n  static async createWindow(options: chrome.windows.CreateData): Promise<chrome.windows.Window> {\n    return new Promise((resolve) =>\n      chrome.windows.create(options, (window) => {\n        resolve(window);\n      }),\n    );\n  }\n\n  /**\n   * Removes the window with the given id.\n   *\n   * @param windowId - The id of the window to remove.\n   */\n  static async removeWindow(windowId: number): Promise<void> {\n    return new Promise((resolve) => chrome.windows.remove(windowId, () => resolve()));\n  }\n\n  /**\n   * Updates the properties of the window with the given id.\n   *\n   * @param windowId - The id of the window to update.\n   * @param options - The window properties to update.\n   */\n  static async updateWindowProperties(\n    windowId: number,\n    options: chrome.windows.UpdateInfo,\n  ): Promise<void> {\n    return new Promise((resolve) =>\n      chrome.windows.update(windowId, options, () => {\n        resolve();\n      }),\n    );\n  }\n\n  /**\n   * Focuses the window with the given id.\n   *\n   * @param windowId - The id of the window to focus.\n   */\n  static async focusWindow(windowId: number) {\n    await BrowserApi.updateWindowProperties(windowId, { focused: true });\n  }\n\n  static async getTabFromCurrentWindowId(): Promise<chrome.tabs.Tab> | null {\n    return await BrowserApi.tabsQueryFirst({\n      active: true,\n      windowId: chrome.windows.WINDOW_ID_CURRENT,\n    });\n  }\n\n  static async getTab(tabId: number): Promise<chrome.tabs.Tab> | null {\n    if (!tabId) {\n      return null;\n    }\n\n    if (BrowserApi.manifestVersion === 3) {\n      return await chrome.tabs.get(tabId);\n    }\n\n    return new Promise((resolve) =>\n      chrome.tabs.get(tabId, (tab) => {\n        resolve(tab);\n      }),\n    );\n  }\n\n  static async getTabFromCurrentWindow(): Promise<chrome.tabs.Tab> | null {\n    return await BrowserApi.tabsQueryFirst({\n      active: true,\n      currentWindow: true,\n    });\n  }\n\n  static async getActiveTabs(): Promise<chrome.tabs.Tab[]> {\n    return await BrowserApi.tabsQuery({\n      active: true,\n    });\n  }\n\n  static async tabsQuery(options: chrome.tabs.QueryInfo): Promise<chrome.tabs.Tab[]> {\n    return new Promise((resolve) => {\n      chrome.tabs.query(options, (tabs) => {\n        resolve(tabs);\n      });\n    });\n  }\n\n  static async tabsQueryFirst(options: chrome.tabs.QueryInfo): Promise<chrome.tabs.Tab> | null {\n    const tabs = await BrowserApi.tabsQuery(options);\n    if (tabs.length > 0) {\n      return tabs[0];\n    }\n\n    return null;\n  }\n\n  static tabSendMessageData(\n    tab: chrome.tabs.Tab,\n    command: string,\n    data: any = null,\n  ): Promise<void> {\n    const obj: any = {\n      command: command,\n    };\n\n    if (data != null) {\n      obj.data = data;\n    }\n\n    return BrowserApi.tabSendMessage(tab, obj);\n  }\n\n  static async tabSendMessage<T>(\n    tab: chrome.tabs.Tab,\n    obj: T,\n    options: chrome.tabs.MessageSendOptions = null,\n  ): Promise<void> {\n    if (!tab || !tab.id) {\n      return;\n    }\n\n    return new Promise<void>((resolve) => {\n      chrome.tabs.sendMessage(tab.id, obj, options, () => {\n        if (chrome.runtime.lastError) {\n          // Some error happened\n        }\n        resolve();\n      });\n    });\n  }\n\n  static sendTabsMessage<T>(\n    tabId: number,\n    message: TabMessage,\n    options?: chrome.tabs.MessageSendOptions,\n    responseCallback?: (response: T) => void,\n  ) {\n    chrome.tabs.sendMessage<TabMessage, T>(tabId, message, options, responseCallback);\n  }\n\n  static async getPrivateModeWindows(): Promise<browser.windows.Window[]> {\n    return (await browser.windows.getAll()).filter((win) => win.incognito);\n  }\n\n  static async onWindowCreated(callback: (win: chrome.windows.Window) => any) {\n    // FIXME: Make sure that is does not cause a memory leak in Safari or use BrowserApi.AddListener\n    // and test that it doesn't break.\n    // eslint-disable-next-line no-restricted-syntax\n    return chrome.windows.onCreated.addListener(callback);\n  }\n\n  /**\n   * Gets the background page for the extension. This method is\n   * not valid within manifest v3 background service workers. As\n   * a result, it will return null when called from that context.\n   */\n  static getBackgroundPage(): any {\n    if (typeof chrome.extension.getBackgroundPage === \"undefined\") {\n      return null;\n    }\n\n    return chrome.extension.getBackgroundPage();\n  }\n\n  /**\n   * Accepts a window object and determines if it is\n   * associated with the background page of the extension.\n   *\n   * @param window - The window to check.\n   */\n  static isBackgroundPage(window: Window & typeof globalThis): boolean {\n    return typeof window !== \"undefined\" && window === BrowserApi.getBackgroundPage();\n  }\n\n  static getApplicationVersion(): string {\n    return chrome.runtime.getManifest().version;\n  }\n\n  /**\n   * Gets the extension views that match the given properties. This method is not\n   * available within background service worker. As a result, it will return an\n   * empty array when called from that context.\n   *\n   * @param fetchProperties - The properties used to filter extension views.\n   */\n  static getExtensionViews(fetchProperties?: chrome.extension.FetchProperties): Window[] {\n    if (typeof chrome.extension.getViews === \"undefined\") {\n      return [];\n    }\n\n    return chrome.extension.getViews(fetchProperties);\n  }\n\n  /**\n   * Queries all extension views that are of type `popup`\n   * and returns whether any are currently open.\n   */\n  static async isPopupOpen(): Promise<boolean> {\n    return Promise.resolve(BrowserApi.getExtensionViews({ type: \"popup\" }).length > 0);\n  }\n\n  static createNewTab(url: string, active = true): Promise<chrome.tabs.Tab> {\n    return new Promise((resolve) =>\n      chrome.tabs.create({ url: url, active: active }, (tab) => resolve(tab)),\n    );\n  }\n\n  // Keep track of all the events registered in a Safari popup so we can remove\n  // them when the popup gets unloaded, otherwise we cause a memory leak\n  private static trackedChromeEventListeners: [\n    event: chrome.events.Event<(...args: unknown[]) => unknown>,\n    callback: (...args: unknown[]) => unknown,\n  ][] = [];\n\n  static messageListener(\n    name: string,\n    callback: (\n      message: any,\n      sender: chrome.runtime.MessageSender,\n      sendResponse: any,\n    ) => boolean | void,\n  ) {\n    BrowserApi.addListener(chrome.runtime.onMessage, callback);\n  }\n\n  static messageListener$() {\n    return new Observable<unknown>((subscriber) => {\n      const handler = (message: unknown) => {\n        subscriber.next(message);\n      };\n\n      BrowserApi.addListener(chrome.runtime.onMessage, handler);\n\n      return () => BrowserApi.removeListener(chrome.runtime.onMessage, handler);\n    });\n  }\n\n  static storageChangeListener(\n    callback: Parameters<typeof chrome.storage.onChanged.addListener>[0],\n  ) {\n    BrowserApi.addListener(chrome.storage.onChanged, callback);\n  }\n\n  /**\n   * Adds a callback to the given chrome event in a cross-browser platform manner.\n   *\n   * **Important:** All event listeners in the browser extension popup context must\n   * use this instead of the native APIs to handle unsubscribing from Safari properly.\n   *\n   * @param event - The event in which to add the listener to.\n   * @param callback - The callback you want registered onto the event.\n   */\n  static addListener<T extends (...args: readonly unknown[]) => unknown>(\n    event: chrome.events.Event<T>,\n    callback: T,\n  ) {\n    event.addListener(callback);\n\n    if (BrowserApi.isSafariApi && !BrowserApi.isBackgroundPage(window)) {\n      BrowserApi.trackedChromeEventListeners.push([event, callback]);\n      BrowserApi.setupUnloadListeners();\n    }\n  }\n\n  /**\n   * Removes a callback from the given chrome event in a cross-browser platform manner.\n   * @param event - The event in which to remove the listener from.\n   * @param callback - The callback you want removed from the event.\n   */\n  static removeListener<T extends (...args: readonly unknown[]) => unknown>(\n    event: chrome.events.Event<T>,\n    callback: T,\n  ) {\n    event.removeListener(callback);\n\n    if (BrowserApi.isSafariApi && !BrowserApi.isBackgroundPage(window)) {\n      const index = BrowserApi.trackedChromeEventListeners.findIndex(([_event, eventListener]) => {\n        return eventListener == callback;\n      });\n      if (index !== -1) {\n        BrowserApi.trackedChromeEventListeners.splice(index, 1);\n      }\n    }\n  }\n\n  // Setup the event to destroy all the listeners when the popup gets unloaded in Safari, otherwise we get a memory leak\n  private static setupUnloadListeners() {\n    // The MDN recommend using 'visibilitychange' but that event is fired any time the popup window is obscured as well\n    // 'pagehide' works just like 'unload' but is compatible with the back/forward cache, so we prefer using that one\n    window.onpagehide = () => {\n      for (const [event, callback] of BrowserApi.trackedChromeEventListeners) {\n        event.removeListener(callback);\n      }\n    };\n  }\n\n  static sendMessage(subscriber: string, arg: any = {}) {\n    const message = Object.assign({}, { command: subscriber }, arg);\n    return chrome.runtime.sendMessage(message);\n  }\n\n  static sendMessageWithResponse<TResponse>(subscriber: string, arg: any = {}) {\n    const message = Object.assign({}, { command: subscriber }, arg);\n    return new Promise<TResponse>((resolve) => chrome.runtime.sendMessage(message, resolve));\n  }\n\n  static async focusTab(tabId: number) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    chrome.tabs.update(tabId, { active: true, highlighted: true });\n  }\n\n  static closePopup(win: Window) {\n    if (BrowserApi.isWebExtensionsApi && BrowserApi.isFirefoxOnAndroid) {\n      // Reactivating the active tab dismisses the popup tab. The promise final\n      // condition is only called if the popup wasn't already dismissed (future proofing).\n      // ref: https://bugzilla.mozilla.org/show_bug.cgi?id=1433604\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      browser.tabs.update({ active: true }).finally(win.close);\n    } else {\n      win.close();\n    }\n  }\n\n  static gaFilter() {\n    return process.env.ENV !== \"production\";\n  }\n\n  static getUILanguage() {\n    return chrome.i18n.getUILanguage();\n  }\n\n  /**\n   * Handles reloading the extension, either by calling the window location\n   * to reload or by calling the extension's runtime to reload.\n   *\n   * @param globalContext - The global context to use for the reload.\n   */\n  static reloadExtension(globalContext: (Window & typeof globalThis) | null) {\n    // The passed globalContext might be a ServiceWorkerGlobalScope, as a result\n    // we need to check if the location object exists before calling reload on it.\n    if (typeof globalContext?.location?.reload === \"function\") {\n      return (globalContext as any).location.reload(true);\n    }\n\n    return chrome.runtime.reload();\n  }\n\n  /**\n   * Reloads all open extension views, except the background page. Will also\n   * skip reloading the current window location if exemptCurrentHref is true.\n   *\n   * @param exemptCurrentHref - Whether to exempt the current window location from the reload.\n   */\n  static reloadOpenWindows(exemptCurrentHref = false) {\n    const views = BrowserApi.getExtensionViews();\n    if (!views.length) {\n      return;\n    }\n\n    const currentHref = window.location.href;\n    views\n      .filter((w) => w.location.href != null && !w.location.href.includes(\"background.html\"))\n      .filter((w) => !exemptCurrentHref || w.location.href !== currentHref)\n      .forEach((w) => w.location.reload());\n  }\n\n  static connectNative(application: string): browser.runtime.Port | chrome.runtime.Port {\n    if (BrowserApi.isWebExtensionsApi) {\n      return browser.runtime.connectNative(application);\n    } else if (BrowserApi.isChromeApi) {\n      return chrome.runtime.connectNative(application);\n    }\n  }\n\n  static requestPermission(permission: any) {\n    if (BrowserApi.isWebExtensionsApi) {\n      return browser.permissions.request(permission);\n    }\n    return new Promise((resolve) => {\n      chrome.permissions.request(permission, resolve);\n    });\n  }\n\n  /**\n   * Checks if the user has provided the given permissions to the extension.\n   *\n   * @param permissions - The permissions to check.\n   */\n  static async permissionsGranted(permissions: string[]): Promise<boolean> {\n    return new Promise((resolve) =>\n      chrome.permissions.contains({ permissions }, (result) => resolve(result)),\n    );\n  }\n\n  static getPlatformInfo(): Promise<browser.runtime.PlatformInfo | chrome.runtime.PlatformInfo> {\n    if (BrowserApi.isWebExtensionsApi) {\n      return browser.runtime.getPlatformInfo();\n    }\n    return new Promise((resolve) => {\n      chrome.runtime.getPlatformInfo(resolve);\n    });\n  }\n\n  static getBrowserAction() {\n    return BrowserApi.manifestVersion === 3 ? chrome.action : chrome.browserAction;\n  }\n\n  static getSidebarAction(\n    win: Window & typeof globalThis,\n  ): OperaSidebarAction | FirefoxSidebarAction | null {\n    const deviceType = BrowserPlatformUtilsService.getDevice(win);\n    if (deviceType !== DeviceType.FirefoxExtension && deviceType !== DeviceType.OperaExtension) {\n      return null;\n    }\n    return win.opr?.sidebarAction || browser.sidebarAction;\n  }\n\n  static captureVisibleTab(): Promise<string> {\n    return new Promise((resolve) => {\n      chrome.tabs.captureVisibleTab(null, { format: \"png\" }, resolve);\n    });\n  }\n\n  /**\n   * Extension API helper method used to execute a script in a tab.\n   * @see https://developer.chrome.com/docs/extensions/reference/tabs/#method-executeScript\n   * @param {number} tabId\n   * @param {chrome.tabs.InjectDetails} details\n   * @returns {Promise<unknown>}\n   */\n  static executeScriptInTab(tabId: number, details: chrome.tabs.InjectDetails) {\n    if (BrowserApi.manifestVersion === 3) {\n      return chrome.scripting.executeScript({\n        target: {\n          tabId: tabId,\n          allFrames: details.allFrames,\n          frameIds: details.frameId ? [details.frameId] : null,\n        },\n        files: details.file ? [details.file] : null,\n        injectImmediately: details.runAt === \"document_start\",\n      });\n    }\n\n    return new Promise((resolve) => {\n      chrome.tabs.executeScript(tabId, details, (result) => {\n        resolve(result);\n      });\n    });\n  }\n\n  /**\n   * Identifies if the browser autofill settings are overridden by the extension.\n   */\n  static async browserAutofillSettingsOverridden(): Promise<boolean> {\n    const checkOverrideStatus = (details: chrome.types.ChromeSettingGetResultDetails) =>\n      details.levelOfControl === \"controlled_by_this_extension\" && !details.value;\n\n    const autofillAddressOverridden: boolean = await new Promise((resolve) =>\n      chrome.privacy.services.autofillAddressEnabled.get({}, (details) =>\n        resolve(checkOverrideStatus(details)),\n      ),\n    );\n\n    const autofillCreditCardOverridden: boolean = await new Promise((resolve) =>\n      chrome.privacy.services.autofillCreditCardEnabled.get({}, (details) =>\n        resolve(checkOverrideStatus(details)),\n      ),\n    );\n\n    const passwordSavingOverridden: boolean = await new Promise((resolve) =>\n      chrome.privacy.services.passwordSavingEnabled.get({}, (details) =>\n        resolve(checkOverrideStatus(details)),\n      ),\n    );\n\n    return autofillAddressOverridden && autofillCreditCardOverridden && passwordSavingOverridden;\n  }\n\n  /**\n   * Updates the browser autofill settings to the given value.\n   *\n   * @param value - Determines whether to enable or disable the autofill settings.\n   */\n  static updateDefaultBrowserAutofillSettings(value: boolean) {\n    chrome.privacy.services.autofillAddressEnabled.set({ value });\n    chrome.privacy.services.autofillCreditCardEnabled.set({ value });\n    chrome.privacy.services.passwordSavingEnabled.set({ value });\n  }\n}\n","export type InitializeOptions = \"array\" | \"record\" | \"object\";\n\nexport class SyncedItemMetadata {\n  propertyKey: string;\n  sessionKey: string;\n  initializer: (keyValuePair: any) => any;\n  initializeAs: InitializeOptions;\n\n  static builder(metadata: SyncedItemMetadata): (o: any) => any {\n    const itemBuilder = metadata.initializer;\n    if (metadata.initializeAs === \"array\") {\n      return (keyValuePair: any) => keyValuePair.map((o: any) => itemBuilder(o));\n    } else if (metadata.initializeAs === \"record\") {\n      return (keyValuePair: any) => {\n        const record: Record<any, any> = {};\n        for (const key in keyValuePair) {\n          record[key] = itemBuilder(keyValuePair[key]);\n        }\n        return record;\n      };\n    } else {\n      return (keyValuePair: any) => itemBuilder(keyValuePair);\n    }\n  }\n}\n","import { BehaviorSubject, concatMap, ReplaySubject, skip, Subject, Subscription } from \"rxjs\";\n\nimport { AbstractMemoryStorageService } from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nimport { BrowserApi } from \"../../browser/browser-api\";\n\nimport { SyncedItemMetadata } from \"./sync-item-metadata\";\n\nexport class SessionSyncer {\n  subscription: Subscription;\n  id = Utils.newGuid();\n\n  // ignore initial values\n  private ignoreNUpdates = 0;\n\n  constructor(\n    private subject: Subject<any>,\n    private memoryStorageService: AbstractMemoryStorageService,\n    private metaData: SyncedItemMetadata,\n  ) {\n    if (!(subject instanceof Subject)) {\n      throw new Error(\"subject must inherit from Subject\");\n    }\n\n    if (metaData.initializer == null) {\n      throw new Error(\"initializer must be provided\");\n    }\n  }\n\n  async init() {\n    switch (this.subject.constructor) {\n      case ReplaySubject:\n        // ignore all updates currently in the buffer\n        this.ignoreNUpdates = (this.subject as any)._buffer.length;\n        break;\n      case BehaviorSubject:\n        this.ignoreNUpdates = 1;\n        break;\n      default:\n        break;\n    }\n\n    await this.observe();\n    // must be synchronous\n    const hasInSessionMemory = await this.memoryStorageService.has(this.metaData.sessionKey);\n    if (hasInSessionMemory) {\n      await this.updateFromMemory();\n    }\n\n    this.listenForUpdates();\n  }\n\n  private async observe() {\n    const stream = this.subject.pipe(skip(this.ignoreNUpdates));\n    this.ignoreNUpdates = 0;\n\n    // This may be a memory leak.\n    // There is no good time to unsubscribe from this observable. Hopefully Manifest V3 clears memory from temporary\n    // contexts. If so, this is handled by destruction of the context.\n    this.subscription = stream\n      .pipe(\n        concatMap(async (next) => {\n          if (this.ignoreNUpdates > 0) {\n            this.ignoreNUpdates -= 1;\n            return;\n          }\n          await this.updateSession(next);\n        }),\n      )\n      .subscribe();\n  }\n\n  private listenForUpdates() {\n    // This is an unawaited promise, but it will be executed asynchronously in the background.\n    BrowserApi.messageListener(this.updateMessageCommand, (message) => {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.updateFromMessage(message);\n    });\n  }\n\n  async updateFromMessage(message: any) {\n    if (message.command != this.updateMessageCommand || message.id === this.id) {\n      return;\n    }\n    await this.update(message.serializedValue);\n  }\n\n  async updateFromMemory() {\n    const value = await this.memoryStorageService.getBypassCache(this.metaData.sessionKey);\n    await this.update(value);\n  }\n\n  async update(serializedValue: any) {\n    const unBuiltValue = JSON.parse(serializedValue);\n    if (BrowserApi.manifestVersion !== 3 && BrowserApi.isBackgroundPage(self)) {\n      await this.memoryStorageService.save(this.metaData.sessionKey, serializedValue);\n    }\n    const builder = SyncedItemMetadata.builder(this.metaData);\n    const value = builder(unBuiltValue);\n    this.ignoreNUpdates = 1;\n    this.subject.next(value);\n  }\n\n  private async updateSession(value: any) {\n    const serializedValue = JSON.stringify(value);\n    if (BrowserApi.manifestVersion === 3 || BrowserApi.isBackgroundPage(self)) {\n      await this.memoryStorageService.save(this.metaData.sessionKey, serializedValue);\n    }\n    await BrowserApi.sendMessage(this.updateMessageCommand, { id: this.id, serializedValue });\n  }\n\n  private get updateMessageCommand() {\n    return `${this.metaData.sessionKey}_update`;\n  }\n}\n","import { Constructor } from \"type-fest\";\n\nimport { AbstractMemoryStorageService } from \"@bitwarden/common/platform/abstractions/storage.service\";\n\nimport { SessionStorable } from \"./session-storable\";\nimport { SessionSyncer } from \"./session-syncer\";\nimport { SyncedItemMetadata } from \"./sync-item-metadata\";\n\n/**\n * Mark the class as syncing state across the browser session. This decorator finds rxjs BehaviorSubject properties\n * marked with @sessionSync and syncs these values across the browser session.\n *\n * @param constructor\n * @returns A new constructor that extends the original one to add session syncing.\n */\nexport function browserSession<TCtor extends Constructor<any>>(constructor: TCtor) {\n  return class extends constructor implements SessionStorable {\n    __syncedItemMetadata: SyncedItemMetadata[];\n    __sessionSyncers: SessionSyncer[];\n\n    constructor(...args: any[]) {\n      super(...args);\n\n      // Require state service to be injected\n      const storageService: AbstractMemoryStorageService = this.findStorageService(\n        [this as any].concat(args),\n      );\n\n      if (this.__syncedItemMetadata == null || !(this.__syncedItemMetadata instanceof Array)) {\n        return;\n      }\n\n      this.__sessionSyncers = this.__syncedItemMetadata.map((metadata) =>\n        this.buildSyncer(metadata, storageService),\n      );\n    }\n\n    buildSyncer(metadata: SyncedItemMetadata, storageSerice: AbstractMemoryStorageService) {\n      const syncer = new SessionSyncer(\n        (this as any)[metadata.propertyKey],\n        storageSerice,\n        metadata,\n      );\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      syncer.init();\n      return syncer;\n    }\n\n    findStorageService(args: any[]): AbstractMemoryStorageService {\n      const storageService = args.find(this.isMemoryStorageService);\n\n      if (storageService) {\n        return storageService;\n      }\n\n      const stateService = args.find(\n        (arg) =>\n          arg?.memoryStorageService != null &&\n          this.isMemoryStorageService(arg.memoryStorageService),\n      );\n      if (stateService) {\n        return stateService.memoryStorageService;\n      }\n\n      throw new Error(\n        `Cannot decorate ${constructor.name} with browserSession, Browser's AbstractMemoryStorageService must be accessible through the observed classes parameters`,\n      );\n    }\n\n    isMemoryStorageService(arg: any): arg is AbstractMemoryStorageService {\n      return arg.type != null && arg.type === AbstractMemoryStorageService.TYPE;\n    }\n  };\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { SessionStorable } from \"./session-storable\";\nimport { InitializeOptions } from \"./sync-item-metadata\";\n\nclass BuildOptions<T, TJson = Jsonify<T>> {\n  initializer?: (keyValuePair: TJson) => T;\n  initializeAs?: InitializeOptions;\n}\n\n// Used to ensure uniqueness for each synced observable\nlet index = 0;\n\n/**\n * A decorator used to indicate the BehaviorSubject should be synced for this browser session across all contexts.\n *\n * >**Note** This decorator does nothing if the enclosing class is not decorated with @browserSession.\n *\n * >**Note** The Behavior subject must be initialized with a default or in the constructor of the class. If it is not, an error will be thrown.\n *\n * >**!!Warning!!** If the property is overwritten at any time, the new value will not be synced across the browser session.\n *\n * @param buildOptions\n * Builders for the value, requires either a constructor (ctor) for your BehaviorSubject type or an\n * initializer function that takes a key value pair representation of the BehaviorSubject data\n * and returns your instantiated BehaviorSubject value. `initializeAs can optionally be used to indicate\n * the provided initializer function should be used to build an array of values. For example,\n * ```ts\n * \\@sessionSync({ initializer: Foo.fromJSON, initializeAs: 'array' })\n * ```\n * is equivalent to\n * ```\n * \\@sessionSync({ initializer: (obj: any[]) => obj.map((f) => Foo.fromJSON })\n * ```\n *\n * @returns decorator function\n */\nexport function sessionSync<T>(buildOptions: BuildOptions<T>) {\n  return (prototype: unknown, propertyKey: string) => {\n    // Force prototype into SessionStorable and implement it.\n    const p = prototype as SessionStorable;\n\n    if (p.__syncedItemMetadata == null) {\n      p.__syncedItemMetadata = [];\n    }\n\n    p.__syncedItemMetadata.push({\n      propertyKey,\n      sessionKey: `${propertyKey}_${index++}`,\n      initializer: buildOptions.initializer,\n      initializeAs: buildOptions.initializeAs ?? \"object\",\n    });\n  };\n}\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { Organization } from \"@bitwarden/common/admin-console/models/domain/organization\";\nimport { OrganizationService } from \"@bitwarden/common/admin-console/services/organization/organization.service\";\n\nimport { browserSession, sessionSync } from \"../../platform/decorators/session-sync-observable\";\n\n@browserSession\nexport class BrowserOrganizationService extends OrganizationService {\n  @sessionSync({ initializer: Organization.fromJSON, initializeAs: \"array\" })\n  protected _organizations: BehaviorSubject<Organization[]>;\n}\n","import Domain from \"../../../platform/models/domain/domain-base\";\nimport { PolicyType } from \"../../enums\";\nimport { PolicyData } from \"../data/policy.data\";\n\nexport class Policy extends Domain {\n  id: string;\n  organizationId: string;\n  type: PolicyType;\n  data: any;\n\n  /**\n   * Warning: a user can be exempt from a policy even if the policy is enabled.\n   * @see {@link PolicyService} has methods to tell you whether a policy applies to a user.\n   */\n  enabled: boolean;\n\n  constructor(obj?: PolicyData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.id = obj.id;\n    this.organizationId = obj.organizationId;\n    this.type = obj.type;\n    this.data = obj.data;\n    this.enabled = obj.enabled;\n  }\n}\n","import Domain from \"../../../platform/models/domain/domain-base\";\n\nexport class ResetPasswordPolicyOptions extends Domain {\n  autoEnrollEnabled = false;\n}\n","import { BehaviorSubject, concatMap, map, Observable, of } from \"rxjs\";\n\nimport { ListResponse } from \"../../../models/response/list.response\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { OrganizationService } from \"../../abstractions/organization/organization.service.abstraction\";\nimport { InternalPolicyService as InternalPolicyServiceAbstraction } from \"../../abstractions/policy/policy.service.abstraction\";\nimport { OrganizationUserStatusType, OrganizationUserType, PolicyType } from \"../../enums\";\nimport { PolicyData } from \"../../models/data/policy.data\";\nimport { MasterPasswordPolicyOptions } from \"../../models/domain/master-password-policy-options\";\nimport { Organization } from \"../../models/domain/organization\";\nimport { Policy } from \"../../models/domain/policy\";\nimport { ResetPasswordPolicyOptions } from \"../../models/domain/reset-password-policy-options\";\nimport { PolicyResponse } from \"../../models/response/policy.response\";\n\nexport class PolicyService implements InternalPolicyServiceAbstraction {\n  protected _policies: BehaviorSubject<Policy[]> = new BehaviorSubject([]);\n\n  policies$ = this._policies.asObservable();\n\n  constructor(\n    protected stateService: StateService,\n    private organizationService: OrganizationService,\n  ) {\n    this.stateService.activeAccountUnlocked$\n      .pipe(\n        concatMap(async (unlocked) => {\n          if (Utils.global.bitwardenContainerService == null) {\n            return;\n          }\n\n          if (!unlocked) {\n            this._policies.next([]);\n            return;\n          }\n\n          const data = await this.stateService.getEncryptedPolicies();\n\n          await this.updateObservables(data);\n        }),\n      )\n      .subscribe();\n  }\n\n  get$(policyType: PolicyType, policyFilter?: (policy: Policy) => boolean): Observable<Policy> {\n    return this.policies$.pipe(\n      concatMap(async (policies) => {\n        const userId = await this.stateService.getUserId();\n        const appliesToCurrentUser = await this.checkPoliciesThatApplyToUser(\n          policies,\n          policyType,\n          policyFilter,\n          userId,\n        );\n        if (appliesToCurrentUser) {\n          return policies.find((policy) => policy.type === policyType && policy.enabled);\n        }\n      }),\n    );\n  }\n\n  async getAll(type?: PolicyType, userId?: string): Promise<Policy[]> {\n    let response: Policy[] = [];\n    const decryptedPolicies = await this.stateService.getDecryptedPolicies({ userId: userId });\n    if (decryptedPolicies != null) {\n      response = decryptedPolicies;\n    } else {\n      const diskPolicies = await this.stateService.getEncryptedPolicies({ userId: userId });\n      for (const id in diskPolicies) {\n        if (Object.prototype.hasOwnProperty.call(diskPolicies, id)) {\n          response.push(new Policy(diskPolicies[id]));\n        }\n      }\n      await this.stateService.setDecryptedPolicies(response, { userId: userId });\n    }\n    if (type != null) {\n      return response.filter((policy) => policy.type === type);\n    } else {\n      return response;\n    }\n  }\n\n  masterPasswordPolicyOptions$(policies?: Policy[]): Observable<MasterPasswordPolicyOptions> {\n    const observable = policies ? of(policies) : this.policies$;\n    return observable.pipe(\n      map((obsPolicies) => {\n        let enforcedOptions: MasterPasswordPolicyOptions = null;\n        const filteredPolicies = obsPolicies.filter((p) => p.type === PolicyType.MasterPassword);\n\n        if (filteredPolicies == null || filteredPolicies.length === 0) {\n          return enforcedOptions;\n        }\n\n        filteredPolicies.forEach((currentPolicy) => {\n          if (!currentPolicy.enabled || currentPolicy.data == null) {\n            return;\n          }\n\n          if (enforcedOptions == null) {\n            enforcedOptions = new MasterPasswordPolicyOptions();\n          }\n\n          if (\n            currentPolicy.data.minComplexity != null &&\n            currentPolicy.data.minComplexity > enforcedOptions.minComplexity\n          ) {\n            enforcedOptions.minComplexity = currentPolicy.data.minComplexity;\n          }\n\n          if (\n            currentPolicy.data.minLength != null &&\n            currentPolicy.data.minLength > enforcedOptions.minLength\n          ) {\n            enforcedOptions.minLength = currentPolicy.data.minLength;\n          }\n\n          if (currentPolicy.data.requireUpper) {\n            enforcedOptions.requireUpper = true;\n          }\n\n          if (currentPolicy.data.requireLower) {\n            enforcedOptions.requireLower = true;\n          }\n\n          if (currentPolicy.data.requireNumbers) {\n            enforcedOptions.requireNumbers = true;\n          }\n\n          if (currentPolicy.data.requireSpecial) {\n            enforcedOptions.requireSpecial = true;\n          }\n\n          if (currentPolicy.data.enforceOnLogin) {\n            enforcedOptions.enforceOnLogin = true;\n          }\n        });\n\n        return enforcedOptions;\n      }),\n    );\n  }\n\n  policyAppliesToActiveUser$(policyType: PolicyType, policyFilter?: (policy: Policy) => boolean) {\n    return this.policies$.pipe(\n      concatMap(async (policies) => {\n        const userId = await this.stateService.getUserId();\n        return await this.checkPoliciesThatApplyToUser(policies, policyType, policyFilter, userId);\n      }),\n    );\n  }\n\n  evaluateMasterPassword(\n    passwordStrength: number,\n    newPassword: string,\n    enforcedPolicyOptions: MasterPasswordPolicyOptions,\n  ): boolean {\n    if (enforcedPolicyOptions == null) {\n      return true;\n    }\n\n    if (\n      enforcedPolicyOptions.minComplexity > 0 &&\n      enforcedPolicyOptions.minComplexity > passwordStrength\n    ) {\n      return false;\n    }\n\n    if (\n      enforcedPolicyOptions.minLength > 0 &&\n      enforcedPolicyOptions.minLength > newPassword.length\n    ) {\n      return false;\n    }\n\n    if (enforcedPolicyOptions.requireUpper && newPassword.toLocaleLowerCase() === newPassword) {\n      return false;\n    }\n\n    if (enforcedPolicyOptions.requireLower && newPassword.toLocaleUpperCase() === newPassword) {\n      return false;\n    }\n\n    if (enforcedPolicyOptions.requireNumbers && !/[0-9]/.test(newPassword)) {\n      return false;\n    }\n\n    // eslint-disable-next-line\n    if (enforcedPolicyOptions.requireSpecial && !/[!@#$%\\^&*]/g.test(newPassword)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  getResetPasswordPolicyOptions(\n    policies: Policy[],\n    orgId: string,\n  ): [ResetPasswordPolicyOptions, boolean] {\n    const resetPasswordPolicyOptions = new ResetPasswordPolicyOptions();\n\n    if (policies == null || orgId == null) {\n      return [resetPasswordPolicyOptions, false];\n    }\n\n    const policy = policies.find(\n      (p) => p.organizationId === orgId && p.type === PolicyType.ResetPassword && p.enabled,\n    );\n    resetPasswordPolicyOptions.autoEnrollEnabled = policy?.data?.autoEnrollEnabled ?? false;\n\n    return [resetPasswordPolicyOptions, policy?.enabled ?? false];\n  }\n\n  mapPolicyFromResponse(policyResponse: PolicyResponse): Policy {\n    const policyData = new PolicyData(policyResponse);\n    return new Policy(policyData);\n  }\n\n  mapPoliciesFromToken(policiesResponse: ListResponse<PolicyResponse>): Policy[] {\n    if (policiesResponse?.data == null) {\n      return null;\n    }\n\n    return policiesResponse.data.map((response) => this.mapPolicyFromResponse(response));\n  }\n\n  async policyAppliesToUser(\n    policyType: PolicyType,\n    policyFilter?: (policy: Policy) => boolean,\n    userId?: string,\n  ) {\n    const policies = await this.getAll(policyType, userId);\n\n    return this.checkPoliciesThatApplyToUser(policies, policyType, policyFilter, userId);\n  }\n\n  async upsert(policy: PolicyData): Promise<any> {\n    let policies = await this.stateService.getEncryptedPolicies();\n    if (policies == null) {\n      policies = {};\n    }\n\n    policies[policy.id] = policy;\n\n    await this.updateObservables(policies);\n    await this.stateService.setDecryptedPolicies(null);\n    await this.stateService.setEncryptedPolicies(policies);\n  }\n\n  async replace(policies: { [id: string]: PolicyData }): Promise<void> {\n    await this.updateObservables(policies);\n    await this.stateService.setDecryptedPolicies(null);\n    await this.stateService.setEncryptedPolicies(policies);\n  }\n\n  async clear(userId?: string): Promise<void> {\n    if (userId == null || userId == (await this.stateService.getUserId())) {\n      this._policies.next([]);\n    }\n    await this.stateService.setDecryptedPolicies(null, { userId: userId });\n    await this.stateService.setEncryptedPolicies(null, { userId: userId });\n  }\n\n  private isExemptFromPolicies(organization: Organization, policyType: PolicyType) {\n    if (policyType === PolicyType.MaximumVaultTimeout) {\n      return organization.type === OrganizationUserType.Owner;\n    }\n\n    return organization.isExemptFromPolicies;\n  }\n\n  private async updateObservables(policiesMap: { [id: string]: PolicyData }) {\n    const policies = Object.values(policiesMap || {}).map((f) => new Policy(f));\n\n    this._policies.next(policies);\n  }\n\n  private async checkPoliciesThatApplyToUser(\n    policies: Policy[],\n    policyType: PolicyType,\n    policyFilter?: (policy: Policy) => boolean,\n    userId?: string,\n  ) {\n    const organizations = await this.organizationService.getAll(userId);\n    const filteredPolicies = policies.filter(\n      (p) => p.type === policyType && p.enabled && (policyFilter == null || policyFilter(p)),\n    );\n    const policySet = new Set(filteredPolicies.map((p) => p.organizationId));\n\n    return organizations.some(\n      (o) =>\n        o.status >= OrganizationUserStatusType.Accepted &&\n        o.usePolicies &&\n        policySet.has(o.id) &&\n        !this.isExemptFromPolicies(o, policyType),\n    );\n  }\n}\n","import { BehaviorSubject } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { Policy } from \"@bitwarden/common/admin-console/models/domain/policy\";\nimport { PolicyService } from \"@bitwarden/common/admin-console/services/policy/policy.service\";\n\nimport { browserSession, sessionSync } from \"../../platform/decorators/session-sync-observable\";\n\n@browserSession\nexport class BrowserPolicyService extends PolicyService {\n  @sessionSync({\n    initializer: (obj: Jsonify<Policy>) => Object.assign(new Policy(), obj),\n    initializeAs: \"array\",\n  })\n  protected _policies: BehaviorSubject<Policy[]>;\n}\n","import { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { ContextMenuClickedHandler } from \"../browser/context-menu-clicked-handler\";\n\nimport { LockedVaultPendingNotificationsData } from \"./abstractions/notification.background\";\n\nexport default class ContextMenusBackground {\n  private contextMenus: typeof chrome.contextMenus;\n\n  constructor(private contextMenuClickedHandler: ContextMenuClickedHandler) {\n    this.contextMenus = chrome.contextMenus;\n  }\n\n  init() {\n    if (!this.contextMenus) {\n      return;\n    }\n\n    this.contextMenus.onClicked.addListener((info, tab) =>\n      this.contextMenuClickedHandler.run(info, tab),\n    );\n\n    BrowserApi.messageListener(\n      \"contextmenus.background\",\n      (\n        msg: { command: string; data: LockedVaultPendingNotificationsData },\n        sender: chrome.runtime.MessageSender,\n      ) => {\n        if (msg.command === \"unlockCompleted\" && msg.data.target === \"contextmenus.background\") {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.contextMenuClickedHandler\n            .cipherAction(\n              msg.data.commandToRetry.message.contextMenuOnClickData,\n              msg.data.commandToRetry.sender.tab,\n            )\n            .then(() => {\n              // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n              // eslint-disable-next-line @typescript-eslint/no-floating-promises\n              BrowserApi.tabSendMessageData(sender.tab, \"closeNotificationBar\");\n            });\n        }\n      },\n    );\n  }\n}\n","import { BrowserApi } from \"../browser/browser-api\";\n\nimport { ScrollOptions } from \"./abstractions/browser-popup-utils.abstractions\";\n\nclass BrowserPopupUtils {\n  /**\n   * Identifies if the popup is within the sidebar.\n   *\n   * @param win - The passed window object.\n   */\n  static inSidebar(win: Window): boolean {\n    return BrowserPopupUtils.urlContainsSearchParams(win, \"uilocation\", \"sidebar\");\n  }\n\n  /**\n   * Identifies if the popup is within the popout.\n   *\n   * @param win - The passed window object.\n   */\n  static inPopout(win: Window): boolean {\n    return BrowserPopupUtils.urlContainsSearchParams(win, \"uilocation\", \"popout\");\n  }\n\n  /**\n   * Identifies if the popup is within the single action popout.\n   *\n   * @param win - The passed window object.\n   * @param popoutKey - The single action popout key used to identify the popout.\n   */\n  static inSingleActionPopout(win: Window, popoutKey: string): boolean {\n    return BrowserPopupUtils.urlContainsSearchParams(win, \"singleActionPopout\", popoutKey);\n  }\n\n  /**\n   * Identifies if the popup is within the popup.\n   *\n   * @param win - The passed window object.\n   */\n  static inPopup(win: Window): boolean {\n    return (\n      win.location.href.indexOf(\"uilocation=\") === -1 ||\n      win.location.href.indexOf(\"uilocation=popup\") > -1\n    );\n  }\n\n  /**\n   * Gets the scroll position of the popup.\n   *\n   * @param win - The passed window object.\n   * @param scrollingContainer - Element tag name of the scrolling container.\n   */\n  static getContentScrollY(win: Window, scrollingContainer = \"main\"): number {\n    const content = win.document.getElementsByTagName(scrollingContainer)[0];\n    return content.scrollTop;\n  }\n\n  /**\n   * Sets the scroll position of the popup.\n   *\n   * @param win - The passed window object.\n   * @param scrollYAmount - The amount to scroll the popup.\n   * @param options - Allows for setting the delay in ms to wait before scrolling the popup and the scrolling container tag name.\n   */\n  static async setContentScrollY(\n    win: Window,\n    scrollYAmount: number | undefined,\n    options: ScrollOptions = {\n      delay: 0,\n      containerSelector: \"main\",\n    },\n  ) {\n    const { delay, containerSelector } = options;\n    return new Promise<void>((resolve) =>\n      win.setTimeout(() => {\n        const container = win.document.querySelector(containerSelector);\n        if (!isNaN(scrollYAmount) && container) {\n          container.scrollTop = scrollYAmount;\n        }\n\n        resolve();\n      }, delay),\n    );\n  }\n\n  /**\n   * Identifies if the background page needs to be initialized.\n   */\n  static backgroundInitializationRequired() {\n    return !BrowserApi.getBackgroundPage();\n  }\n\n  /**\n   * Identifies if the popup is loading in private mode.\n   */\n  static inPrivateMode() {\n    return BrowserPopupUtils.backgroundInitializationRequired() && BrowserApi.manifestVersion !== 3;\n  }\n\n  /**\n   * Opens a popout window of any extension page. If the popout window is already open, it will be focused.\n   *\n   * @param extensionUrlPath - A relative path to the extension page. Example: \"popup/index.html#/tabs/vault\"\n   * @param options - Options for the popout window that overrides the default options.\n   */\n  static async openPopout(\n    extensionUrlPath: string,\n    options: {\n      senderWindowId?: number;\n      singleActionKey?: string;\n      forceCloseExistingWindows?: boolean;\n      windowOptions?: Partial<chrome.windows.CreateData>;\n    } = {},\n  ) {\n    const { senderWindowId, singleActionKey, forceCloseExistingWindows, windowOptions } = options;\n    const defaultPopoutWindowOptions: chrome.windows.CreateData = {\n      type: \"popup\",\n      focused: true,\n      width: 380,\n      height: 630,\n    };\n    const offsetRight = 15;\n    const offsetTop = 90;\n    const popupWidth = defaultPopoutWindowOptions.width;\n    const senderWindow = await BrowserApi.getWindow(senderWindowId);\n    const popoutWindowOptions = {\n      left: senderWindow.left + senderWindow.width - popupWidth - offsetRight,\n      top: senderWindow.top + offsetTop,\n      ...defaultPopoutWindowOptions,\n      ...windowOptions,\n      url: BrowserPopupUtils.buildPopoutUrl(extensionUrlPath, singleActionKey),\n    };\n\n    if (\n      (await BrowserPopupUtils.isSingleActionPopoutOpen(\n        singleActionKey,\n        popoutWindowOptions,\n        forceCloseExistingWindows,\n      )) &&\n      !forceCloseExistingWindows\n    ) {\n      return;\n    }\n\n    return await BrowserApi.createWindow(popoutWindowOptions);\n  }\n\n  /**\n   * Closes the single action popout window.\n   *\n   * @param popoutKey - The single action popout key used to identify the popout.\n   * @param delayClose - The amount of time to wait before closing the popout. Defaults to 0.\n   */\n  static async closeSingleActionPopout(popoutKey: string, delayClose = 0): Promise<void> {\n    const extensionUrl = chrome.runtime.getURL(\"popup/index.html\");\n    const tabs = await BrowserApi.tabsQuery({ url: `${extensionUrl}*` });\n    for (const tab of tabs) {\n      if (!tab.url.includes(`singleActionPopout=${popoutKey}`)) {\n        continue;\n      }\n\n      setTimeout(() => BrowserApi.removeWindow(tab.windowId), delayClose);\n    }\n  }\n\n  /**\n   * Opens a popout window for the current page.\n   * If the current page is set for the current tab, then the\n   * popout window will be set for the vault items listing tab.\n   *\n   * @param win - The passed window object.\n   * @param href - The href to open in the popout window.\n   */\n  static async openCurrentPagePopout(win: Window, href: string = null) {\n    const popoutUrl = href || win.location.href;\n    const parsedUrl = new URL(popoutUrl);\n    let hashRoute = parsedUrl.hash;\n    if (hashRoute.startsWith(\"#/tabs/current\")) {\n      hashRoute = \"#/tabs/vault\";\n    }\n\n    await BrowserPopupUtils.openPopout(`${parsedUrl.pathname}${hashRoute}`);\n\n    if (BrowserPopupUtils.inPopup(win)) {\n      BrowserApi.closePopup(win);\n    }\n  }\n\n  /**\n   * Identifies if a single action window is open based on the passed popoutKey.\n   * Will focus the existing window, and close any other windows that might exist\n   * with the same popout key.\n   *\n   * @param popoutKey - The single action popout key used to identify the popout.\n   * @param windowInfo - The window info to use to update the existing window.\n   * @param forceCloseExistingWindows - Identifies if the existing windows should be closed.\n   */\n  private static async isSingleActionPopoutOpen(\n    popoutKey: string | undefined,\n    windowInfo: chrome.windows.CreateData,\n    forceCloseExistingWindows = false,\n  ) {\n    if (!popoutKey) {\n      return false;\n    }\n\n    const extensionUrl = chrome.runtime.getURL(\"popup/index.html\");\n    const popoutTabs = (await BrowserApi.tabsQuery({ url: `${extensionUrl}*` })).filter((tab) =>\n      tab.url.includes(`singleActionPopout=${popoutKey}`),\n    );\n    if (popoutTabs.length === 0) {\n      return false;\n    }\n\n    if (!forceCloseExistingWindows) {\n      // Update first, remove it from list\n      const tab = popoutTabs.shift();\n      await BrowserApi.updateWindowProperties(tab.windowId, {\n        focused: true,\n        width: windowInfo.width,\n        height: windowInfo.height,\n        top: windowInfo.top,\n        left: windowInfo.left,\n      });\n    }\n\n    popoutTabs.forEach((tab) => BrowserApi.removeWindow(tab.windowId));\n\n    return true;\n  }\n\n  /**\n   * Identifies if the url contains the specified search param and value.\n   *\n   * @param win - The passed window object.\n   * @param searchParam - The search param to identify.\n   * @param searchValue - The search value to identify.\n   */\n  private static urlContainsSearchParams(\n    win: Window,\n    searchParam: string,\n    searchValue: string,\n  ): boolean {\n    return win.location.href.indexOf(`${searchParam}=${searchValue}`) > -1;\n  }\n\n  /**\n   * Builds the popout url path. Ensures that the uilocation param is set to\n   * `popout` and that the singleActionPopout param is set to the passed singleActionKey.\n   *\n   * @param extensionUrlPath - A relative path to the extension page. Example: \"popup/index.html#/tabs/vault\"\n   * @param singleActionKey - The single action popout key used to identify the popout.\n   */\n  private static buildPopoutUrl(extensionUrlPath: string, singleActionKey: string) {\n    const parsedUrl = new URL(chrome.runtime.getURL(extensionUrlPath));\n    parsedUrl.searchParams.set(\"uilocation\", \"popout\");\n\n    if (singleActionKey) {\n      parsedUrl.searchParams.set(\"singleActionPopout\", singleActionKey);\n    }\n\n    return parsedUrl.toString();\n  }\n}\n\nexport default BrowserPopupUtils;\n","import { BrowserApi } from \"../../../platform/browser/browser-api\";\nimport BrowserPopupUtils from \"../../../platform/popup/browser-popup-utils\";\n\nconst AuthPopoutType = {\n  unlockExtension: \"auth_unlockExtension\",\n  ssoAuthResult: \"auth_ssoAuthResult\",\n  twoFactorAuth: \"auth_twoFactorAuth\",\n} as const;\nconst extensionUnlockUrls = new Set([\n  chrome.runtime.getURL(\"popup/index.html#/lock\"),\n  chrome.runtime.getURL(\"popup/index.html#/home\"),\n]);\n\n/**\n * Opens a window that facilitates unlocking / logging into the extension.\n *\n * @param senderTab - Used to determine the windowId of the sender.\n * @param skipNotification - Used to determine whether to show the unlock notification.\n */\nasync function openUnlockPopout(senderTab: chrome.tabs.Tab, skipNotification = false) {\n  const existingPopoutWindowTabs = await BrowserApi.tabsQuery({ windowType: \"popup\" });\n  existingPopoutWindowTabs.forEach((tab) => {\n    if (extensionUnlockUrls.has(tab.url)) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      BrowserApi.removeWindow(tab.windowId);\n    }\n  });\n\n  await BrowserPopupUtils.openPopout(\"popup/index.html\", {\n    singleActionKey: AuthPopoutType.unlockExtension,\n    senderWindowId: senderTab.windowId,\n  });\n  await BrowserApi.tabSendMessageData(senderTab, \"bgUnlockPopoutOpened\", { skipNotification });\n}\n\n/**\n * Closes the unlock popout window.\n */\nasync function closeUnlockPopout() {\n  await BrowserPopupUtils.closeSingleActionPopout(AuthPopoutType.unlockExtension);\n}\n\n/**\n * Opens a window that facilitates presenting the results for SSO authentication.\n *\n * @param resultData - The result data from the SSO authentication.\n */\nasync function openSsoAuthResultPopout(resultData: { code: string; state: string }) {\n  const { code, state } = resultData;\n  const authResultUrl = `popup/index.html#/sso?code=${encodeURIComponent(\n    code,\n  )}&state=${encodeURIComponent(state)}`;\n\n  await BrowserPopupUtils.openPopout(authResultUrl, {\n    singleActionKey: AuthPopoutType.ssoAuthResult,\n  });\n}\n\n/**\n * Opens a window that facilitates two-factor authentication.\n *\n * @param twoFactorAuthData - The data from the two-factor authentication.\n */\nasync function openTwoFactorAuthPopout(twoFactorAuthData: { data: string; remember: string }) {\n  const { data, remember } = twoFactorAuthData;\n  const params =\n    `webAuthnResponse=${encodeURIComponent(data)};` + `remember=${encodeURIComponent(remember)}`;\n  const twoFactorUrl = `popup/index.html#/2fa;${params}`;\n\n  await BrowserPopupUtils.openPopout(twoFactorUrl, {\n    singleActionKey: AuthPopoutType.twoFactorAuth,\n  });\n}\n\n/**\n * Closes the two-factor authentication popout window.\n */\nasync function closeTwoFactorAuthPopout() {\n  await BrowserPopupUtils.closeSingleActionPopout(AuthPopoutType.twoFactorAuth);\n}\n\nexport {\n  AuthPopoutType,\n  openUnlockPopout,\n  closeUnlockPopout,\n  openSsoAuthResultPopout,\n  openTwoFactorAuthPopout,\n  closeTwoFactorAuthPopout,\n};\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\n\nimport { BrowserApi } from \"../../../platform/browser/browser-api\";\nimport BrowserPopupUtils from \"../../../platform/popup/browser-popup-utils\";\n\nconst VaultPopoutType = {\n  viewVaultItem: \"vault_viewVaultItem\",\n  addEditVaultItem: \"vault_AddEditVaultItem\",\n  fido2Popout: \"vault_Fido2Popout\",\n} as const;\n\n/**\n * Opens a popout window that facilitates viewing a vault item.\n *\n * @param senderTab - The tab that sent the request.\n * @param cipherOptions - The cipher id and action to perform.\n */\nasync function openViewVaultItemPopout(\n  senderTab: chrome.tabs.Tab,\n  cipherOptions: {\n    cipherId: string;\n    action: string;\n    forceCloseExistingWindows?: boolean;\n  },\n) {\n  const { cipherId, action, forceCloseExistingWindows } = cipherOptions;\n  let promptWindowPath = \"popup/index.html#/view-cipher\";\n  let queryParamToken = \"?\";\n  const formatQueryString = (key: string, value: string) => {\n    const queryString = `${queryParamToken}${key}=${value}`;\n    queryParamToken = \"&\";\n    return queryString;\n  };\n\n  if (cipherId) {\n    promptWindowPath += formatQueryString(\"cipherId\", cipherId);\n  }\n  if (senderTab.id) {\n    promptWindowPath += formatQueryString(\"senderTabId\", String(senderTab.id));\n  }\n  if (action) {\n    promptWindowPath += formatQueryString(\"action\", action);\n  }\n\n  await BrowserPopupUtils.openPopout(promptWindowPath, {\n    singleActionKey: `${VaultPopoutType.viewVaultItem}_${cipherId}`,\n    senderWindowId: senderTab.windowId,\n    forceCloseExistingWindows,\n  });\n}\n\n/**\n * Closes the view vault item popout window.\n *\n * @param singleActionKey - The single action popout key used to identify the popout.\n * @param delayClose - The amount of time to wait before closing the popout. Defaults to 0.\n */\nasync function closeViewVaultItemPopout(singleActionKey: string, delayClose = 0) {\n  await BrowserPopupUtils.closeSingleActionPopout(singleActionKey, delayClose);\n}\n\n/**\n * Opens a popout window that facilitates re-prompting for\n * the password of a vault item.\n *\n * @param senderTab - The tab that sent the request.\n * @param cipherOptions - The cipher id and action to perform.\n */\nasync function openVaultItemPasswordRepromptPopout(\n  senderTab: chrome.tabs.Tab,\n  cipherOptions: {\n    cipherId: string;\n    action: string;\n  },\n) {\n  await openViewVaultItemPopout(senderTab, {\n    forceCloseExistingWindows: true,\n    ...cipherOptions,\n  });\n  await BrowserApi.tabSendMessageData(senderTab, \"bgVaultItemRepromptPopoutOpened\");\n}\n\n/**\n * Opens a popout window that facilitates adding or editing a vault item.\n *\n * @param senderTab - The window id of the sender.\n * @param cipherOptions - Options passed as query params to the popout.\n */\nasync function openAddEditVaultItemPopout(\n  senderTab: chrome.tabs.Tab,\n  cipherOptions: { cipherId?: string; cipherType?: CipherType } = {},\n) {\n  const { cipherId, cipherType } = cipherOptions;\n  const { url, windowId } = senderTab;\n  let singleActionKey = VaultPopoutType.addEditVaultItem;\n  let addEditCipherUrl = \"popup/index.html#/edit-cipher\";\n  let queryParamToken = \"?\";\n  const formatQueryString = (key: string, value: string) => {\n    const queryString = `${queryParamToken}${key}=${value}`;\n    queryParamToken = \"&\";\n    return queryString;\n  };\n\n  if (cipherId && !cipherType) {\n    singleActionKey += `_${cipherId}`;\n    addEditCipherUrl += formatQueryString(\"cipherId\", cipherId);\n  }\n  if (cipherType && !cipherId) {\n    singleActionKey += `_${cipherType}`;\n    addEditCipherUrl += formatQueryString(\"type\", String(cipherType));\n  }\n  if (senderTab.url) {\n    addEditCipherUrl += formatQueryString(\"uri\", url);\n  }\n\n  await BrowserPopupUtils.openPopout(addEditCipherUrl, {\n    singleActionKey,\n    senderWindowId: windowId,\n  });\n}\n\n/**\n * Closes the add/edit vault item popout window.\n *\n * @param delayClose - The amount of time to wait before closing the popout. Defaults to 0.\n */\nasync function closeAddEditVaultItemPopout(delayClose = 0) {\n  await BrowserPopupUtils.closeSingleActionPopout(VaultPopoutType.addEditVaultItem, delayClose);\n}\n\n/**\n * Opens a popout window that facilitates FIDO2\n * authentication and passkey management.\n *\n * @param senderTab - The tab that sent the request.\n * @param options - Options passed as query params to the popout.\n */\nasync function openFido2Popout(\n  senderTab: chrome.tabs.Tab,\n  options: {\n    sessionId: string;\n    fallbackSupported: boolean;\n  },\n): Promise<chrome.windows.Window[\"id\"]> {\n  const { sessionId, fallbackSupported } = options;\n  const promptWindowPath =\n    \"popup/index.html#/fido2\" +\n    `?sessionId=${sessionId}` +\n    `&fallbackSupported=${fallbackSupported}` +\n    `&senderTabId=${senderTab.id}` +\n    `&senderUrl=${encodeURIComponent(senderTab.url)}`;\n\n  const popoutWindow = await BrowserPopupUtils.openPopout(promptWindowPath, {\n    singleActionKey: `${VaultPopoutType.fido2Popout}_${sessionId}`,\n    senderWindowId: senderTab.windowId,\n    forceCloseExistingWindows: true,\n    windowOptions: { height: 570 },\n  });\n\n  return popoutWindow.id;\n}\n\n/**\n * Closes the FIDO2 popout window associated with the passed session ID.\n *\n * @param sessionId - The session ID of the popout to close.\n */\nasync function closeFido2Popout(sessionId: string): Promise<void> {\n  await BrowserPopupUtils.closeSingleActionPopout(`${VaultPopoutType.fido2Popout}_${sessionId}`);\n}\n\nexport {\n  VaultPopoutType,\n  openViewVaultItemPopout,\n  closeViewVaultItemPopout,\n  openVaultItemPasswordRepromptPopout,\n  openAddEditVaultItemPopout,\n  closeAddEditVaultItemPopout,\n  openFido2Popout,\n  closeFido2Popout,\n};\n","const NotificationQueueMessageType = {\n  AddLogin: \"add\",\n  ChangePassword: \"change\",\n  UnlockVault: \"unlock\",\n  RequestFilelessImport: \"fileless-import\",\n} as const;\n\ntype NotificationQueueMessageTypes =\n  (typeof NotificationQueueMessageType)[keyof typeof NotificationQueueMessageType];\n\nexport { NotificationQueueMessageType, NotificationQueueMessageTypes };\n","import { firstValueFrom } from \"rxjs\";\n\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"@bitwarden/common/admin-console/enums\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { ThemeType } from \"@bitwarden/common/platform/enums\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { LoginUriView } from \"@bitwarden/common/vault/models/view/login-uri.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { openUnlockPopout } from \"../../auth/popup/utils/auth-popout-window\";\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { BrowserStateService } from \"../../platform/services/abstractions/browser-state.service\";\nimport { openAddEditVaultItemPopout } from \"../../vault/popup/utils/vault-popout-window\";\nimport { NOTIFICATION_BAR_LIFESPAN_MS } from \"../constants\";\nimport { NotificationQueueMessageType } from \"../enums/notification-queue-message-type.enum\";\nimport { AutofillService } from \"../services/abstractions/autofill.service\";\n\nimport {\n  AddChangePasswordQueueMessage,\n  AddLoginQueueMessage,\n  AddRequestFilelessImportQueueMessage,\n  AddUnlockVaultQueueMessage,\n  ChangePasswordMessageData,\n  AddLoginMessageData,\n  NotificationQueueMessageItem,\n  LockedVaultPendingNotificationsData,\n  NotificationBackgroundExtensionMessage,\n  NotificationBackgroundExtensionMessageHandlers,\n} from \"./abstractions/notification.background\";\nimport { OverlayBackgroundExtensionMessage } from \"./abstractions/overlay.background\";\n\nexport default class NotificationBackground {\n  private openUnlockPopout = openUnlockPopout;\n  private openAddEditVaultItemPopout = openAddEditVaultItemPopout;\n  private notificationQueue: NotificationQueueMessageItem[] = [];\n  private readonly extensionMessageHandlers: NotificationBackgroundExtensionMessageHandlers = {\n    unlockCompleted: ({ message, sender }) => this.handleUnlockCompleted(message, sender),\n    bgGetFolderData: () => this.getFolderData(),\n    bgCloseNotificationBar: ({ sender }) => this.handleCloseNotificationBarMessage(sender),\n    bgAdjustNotificationBar: ({ message, sender }) =>\n      this.handleAdjustNotificationBarMessage(message, sender),\n    bgAddLogin: ({ message, sender }) => this.addLogin(message, sender),\n    bgChangedPassword: ({ message, sender }) => this.changedPassword(message, sender),\n    bgRemoveTabFromNotificationQueue: ({ sender }) =>\n      this.removeTabFromNotificationQueue(sender.tab),\n    bgSaveCipher: ({ message, sender }) => this.handleSaveCipherMessage(message, sender),\n    bgNeverSave: ({ sender }) => this.saveNever(sender.tab),\n    collectPageDetailsResponse: ({ message }) =>\n      this.handleCollectPageDetailsResponseMessage(message),\n    bgUnlockPopoutOpened: ({ message, sender }) => this.unlockVault(message, sender.tab),\n    checkNotificationQueue: ({ sender }) => this.checkNotificationQueue(sender.tab),\n    bgReopenUnlockPopout: ({ sender }) => this.openUnlockPopout(sender.tab),\n  };\n\n  constructor(\n    private autofillService: AutofillService,\n    private cipherService: CipherService,\n    private authService: AuthService,\n    private policyService: PolicyService,\n    private folderService: FolderService,\n    private stateService: BrowserStateService,\n    private environmentService: EnvironmentService,\n    private logService: LogService,\n  ) {}\n\n  async init() {\n    if (chrome.runtime == null) {\n      return;\n    }\n\n    this.setupExtensionMessageListener();\n\n    this.cleanupNotificationQueue();\n  }\n\n  /**\n   * Checks the notification queue for any messages that need to be sent to the\n   * specified tab. If no tab is specified, the current tab will be used.\n   *\n   * @param tab - The tab to check the notification queue for\n   */\n  async checkNotificationQueue(tab: chrome.tabs.Tab = null): Promise<void> {\n    if (this.notificationQueue.length === 0) {\n      return;\n    }\n\n    if (tab != null) {\n      await this.doNotificationQueueCheck(tab);\n      return;\n    }\n\n    const currentTab = await BrowserApi.getTabFromCurrentWindow();\n    if (currentTab != null) {\n      await this.doNotificationQueueCheck(currentTab);\n    }\n  }\n\n  private cleanupNotificationQueue() {\n    for (let i = this.notificationQueue.length - 1; i >= 0; i--) {\n      if (this.notificationQueue[i].expires < new Date()) {\n        BrowserApi.tabSendMessageData(this.notificationQueue[i].tab, \"closeNotificationBar\").catch(\n          (error) => this.logService.error(error),\n        );\n        this.notificationQueue.splice(i, 1);\n      }\n    }\n    setTimeout(() => this.cleanupNotificationQueue(), 30000); // check every 30 seconds\n  }\n\n  private async doNotificationQueueCheck(tab: chrome.tabs.Tab): Promise<void> {\n    const tabDomain = Utils.getDomain(tab?.url);\n    if (!tabDomain) {\n      return;\n    }\n\n    const queueMessage = this.notificationQueue.find(\n      (message) => message.tab.id === tab.id && message.domain === tabDomain,\n    );\n    if (queueMessage) {\n      await this.sendNotificationQueueMessage(tab, queueMessage);\n    }\n  }\n\n  private async sendNotificationQueueMessage(\n    tab: chrome.tabs.Tab,\n    notificationQueueMessage: NotificationQueueMessageItem,\n  ) {\n    const notificationType = notificationQueueMessage.type;\n    const webVaultURL = this.environmentService.getWebVaultUrl();\n    const typeData: Record<string, any> = {\n      isVaultLocked: notificationQueueMessage.wasVaultLocked,\n      theme: await this.getCurrentTheme(),\n      webVaultURL,\n    };\n\n    switch (notificationType) {\n      case NotificationQueueMessageType.AddLogin:\n        typeData.removeIndividualVault = await this.removeIndividualVault();\n        break;\n      case NotificationQueueMessageType.RequestFilelessImport:\n        typeData.importType = (\n          notificationQueueMessage as AddRequestFilelessImportQueueMessage\n        ).importType;\n        break;\n    }\n\n    await BrowserApi.tabSendMessageData(tab, \"openNotificationBar\", {\n      type: notificationType,\n      typeData,\n    });\n  }\n\n  private async getCurrentTheme() {\n    const theme = await this.stateService.getTheme();\n\n    if (theme !== ThemeType.System) {\n      return theme;\n    }\n\n    return window.matchMedia(\"(prefers-color-scheme: dark)\").matches\n      ? ThemeType.Dark\n      : ThemeType.Light;\n  }\n\n  /**\n   * Removes any login messages from the notification queue that\n   * are associated with the specified tab.\n   *\n   * @param tab - The tab to remove messages for\n   */\n  private removeTabFromNotificationQueue(tab: chrome.tabs.Tab) {\n    for (let i = this.notificationQueue.length - 1; i >= 0; i--) {\n      if (this.notificationQueue[i].tab.id === tab.id) {\n        this.notificationQueue.splice(i, 1);\n      }\n    }\n  }\n\n  /**\n   * Adds a login message to the notification queue, prompting the user to save\n   * the login if it does not already exist in the vault. If the cipher exists\n   * but the password has changed, the user will be prompted to update the password.\n   *\n   * @param message - The message to add to the queue\n   * @param sender - The contextual sender of the message\n   */\n  private async addLogin(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    const authStatus = await this.authService.getAuthStatus();\n    if (authStatus === AuthenticationStatus.LoggedOut) {\n      return;\n    }\n\n    const loginInfo = message.login;\n    const normalizedUsername = loginInfo.username ? loginInfo.username.toLowerCase() : \"\";\n    const loginDomain = Utils.getDomain(loginInfo.url);\n    if (loginDomain == null) {\n      return;\n    }\n\n    const disabledAddLogin = await this.stateService.getDisableAddLoginNotification();\n    if (authStatus === AuthenticationStatus.Locked) {\n      if (!disabledAddLogin) {\n        await this.pushAddLoginToQueue(loginDomain, loginInfo, sender.tab, true);\n      }\n\n      return;\n    }\n\n    const ciphers = await this.cipherService.getAllDecryptedForUrl(loginInfo.url);\n    const usernameMatches = ciphers.filter(\n      (c) => c.login.username != null && c.login.username.toLowerCase() === normalizedUsername,\n    );\n    if (!disabledAddLogin && usernameMatches.length === 0) {\n      await this.pushAddLoginToQueue(loginDomain, loginInfo, sender.tab);\n      return;\n    }\n\n    const disabledChangePassword = await this.stateService.getDisableChangedPasswordNotification();\n    if (\n      !disabledChangePassword &&\n      usernameMatches.length === 1 &&\n      usernameMatches[0].login.password !== loginInfo.password\n    ) {\n      await this.pushChangePasswordToQueue(\n        usernameMatches[0].id,\n        loginDomain,\n        loginInfo.password,\n        sender.tab,\n      );\n    }\n  }\n\n  private async pushAddLoginToQueue(\n    loginDomain: string,\n    loginInfo: AddLoginMessageData,\n    tab: chrome.tabs.Tab,\n    isVaultLocked = false,\n  ) {\n    // remove any old messages for this tab\n    this.removeTabFromNotificationQueue(tab);\n    const message: AddLoginQueueMessage = {\n      type: NotificationQueueMessageType.AddLogin,\n      username: loginInfo.username,\n      password: loginInfo.password,\n      domain: loginDomain,\n      uri: loginInfo.url,\n      tab: tab,\n      expires: new Date(new Date().getTime() + NOTIFICATION_BAR_LIFESPAN_MS),\n      wasVaultLocked: isVaultLocked,\n    };\n    this.notificationQueue.push(message);\n    await this.checkNotificationQueue(tab);\n  }\n\n  /**\n   * Adds a change password message to the notification queue, prompting the user\n   * to update the password for a login that has changed.\n   *\n   * @param message - The message to add to the queue\n   * @param sender - The contextual sender of the message\n   */\n  private async changedPassword(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    const changeData = message.data as ChangePasswordMessageData;\n    const loginDomain = Utils.getDomain(changeData.url);\n    if (loginDomain == null) {\n      return;\n    }\n\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      await this.pushChangePasswordToQueue(\n        null,\n        loginDomain,\n        changeData.newPassword,\n        sender.tab,\n        true,\n      );\n      return;\n    }\n\n    let id: string = null;\n    const ciphers = await this.cipherService.getAllDecryptedForUrl(changeData.url);\n    if (changeData.currentPassword != null) {\n      const passwordMatches = ciphers.filter(\n        (c) => c.login.password === changeData.currentPassword,\n      );\n      if (passwordMatches.length === 1) {\n        id = passwordMatches[0].id;\n      }\n    } else if (ciphers.length === 1) {\n      id = ciphers[0].id;\n    }\n    if (id != null) {\n      await this.pushChangePasswordToQueue(id, loginDomain, changeData.newPassword, sender.tab);\n    }\n  }\n\n  /**\n   * Sends the page details to the notification bar. Will query all\n   * forms with a password field and pass them to the notification bar.\n   *\n   * @param message - The extension message\n   */\n  private async handleCollectPageDetailsResponseMessage(\n    message: NotificationBackgroundExtensionMessage,\n  ) {\n    if (message.sender !== \"notificationBar\") {\n      return;\n    }\n\n    const forms = this.autofillService.getFormsWithPasswordFields(message.details);\n    await BrowserApi.tabSendMessageData(message.tab, \"notificationBarPageDetails\", {\n      details: message.details,\n      forms: forms,\n    });\n  }\n\n  /**\n   * Sets up a notification to unlock the vault when the user\n   * attempts to autofill a cipher while the vault is locked.\n   *\n   * @param message - Extension message, determines if the notification should be skipped\n   * @param tab - The tab that the message was sent from\n   */\n  private async unlockVault(message: NotificationBackgroundExtensionMessage, tab: chrome.tabs.Tab) {\n    if (message.data?.skipNotification) {\n      return;\n    }\n\n    const currentAuthStatus = await this.authService.getAuthStatus();\n    if (currentAuthStatus !== AuthenticationStatus.Locked || this.notificationQueue.length) {\n      return;\n    }\n\n    const loginDomain = Utils.getDomain(tab.url);\n    if (loginDomain) {\n      await this.pushUnlockVaultToQueue(loginDomain, tab);\n    }\n  }\n\n  /**\n   * Sets up a notification to request a fileless import when the user\n   * attempts to trigger an import from a third party website.\n   *\n   * @param tab - The tab that we are sending the notification to\n   * @param importType - The type of import that is being requested\n   */\n  async requestFilelessImport(tab: chrome.tabs.Tab, importType: string) {\n    const currentAuthStatus = await this.authService.getAuthStatus();\n    if (currentAuthStatus !== AuthenticationStatus.Unlocked || this.notificationQueue.length) {\n      return;\n    }\n\n    const loginDomain = Utils.getDomain(tab.url);\n    if (loginDomain) {\n      await this.pushRequestFilelessImportToQueue(loginDomain, tab, importType);\n    }\n  }\n\n  private async pushChangePasswordToQueue(\n    cipherId: string,\n    loginDomain: string,\n    newPassword: string,\n    tab: chrome.tabs.Tab,\n    isVaultLocked = false,\n  ) {\n    // remove any old messages for this tab\n    this.removeTabFromNotificationQueue(tab);\n    const message: AddChangePasswordQueueMessage = {\n      type: NotificationQueueMessageType.ChangePassword,\n      cipherId: cipherId,\n      newPassword: newPassword,\n      domain: loginDomain,\n      tab: tab,\n      expires: new Date(new Date().getTime() + NOTIFICATION_BAR_LIFESPAN_MS),\n      wasVaultLocked: isVaultLocked,\n    };\n    this.notificationQueue.push(message);\n    await this.checkNotificationQueue(tab);\n  }\n\n  private async pushUnlockVaultToQueue(loginDomain: string, tab: chrome.tabs.Tab) {\n    this.removeTabFromNotificationQueue(tab);\n    const message: AddUnlockVaultQueueMessage = {\n      type: NotificationQueueMessageType.UnlockVault,\n      domain: loginDomain,\n      tab: tab,\n      expires: new Date(new Date().getTime() + 0.5 * 60000), // 30 seconds\n      wasVaultLocked: true,\n    };\n    await this.sendNotificationQueueMessage(tab, message);\n  }\n\n  /**\n   * Pushes a request to start a fileless import to the notification queue.\n   * This will display a notification bar to the user, prompting them to\n   * start the import.\n   *\n   * @param loginDomain - The domain of the tab that we are sending the notification to\n   * @param tab - The tab that we are sending the notification to\n   * @param importType - The type of import that is being requested\n   */\n  private async pushRequestFilelessImportToQueue(\n    loginDomain: string,\n    tab: chrome.tabs.Tab,\n    importType?: string,\n  ) {\n    this.removeTabFromNotificationQueue(tab);\n    const message: AddRequestFilelessImportQueueMessage = {\n      type: NotificationQueueMessageType.RequestFilelessImport,\n      domain: loginDomain,\n      tab,\n      expires: new Date(new Date().getTime() + 0.5 * 60000), // 30 seconds\n      wasVaultLocked: false,\n      importType,\n    };\n    this.notificationQueue.push(message);\n    await this.checkNotificationQueue(tab);\n    this.removeTabFromNotificationQueue(tab);\n  }\n\n  /**\n   * Saves a cipher based on the message sent from the notification bar. If the vault\n   * is locked, the message will be added to the notification queue and the unlock\n   * popout will be opened.\n   *\n   * @param message - The extension message\n   * @param sender - The contextual sender of the message\n   */\n  private async handleSaveCipherMessage(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      await BrowserApi.tabSendMessageData(sender.tab, \"addToLockedVaultPendingNotifications\", {\n        commandToRetry: {\n          message: {\n            command: message.command,\n            edit: message.edit,\n            folder: message.folder,\n          },\n          sender: sender,\n        },\n        target: \"notification.background\",\n      } as LockedVaultPendingNotificationsData);\n      await this.openUnlockPopout(sender.tab);\n      return;\n    }\n\n    await this.saveOrUpdateCredentials(sender.tab, message.edit, message.folder);\n  }\n\n  /**\n   * Saves or updates credentials based on the message within the\n   * notification queue that is associated with the specified tab.\n   *\n   * @param tab - The tab to save or update credentials for\n   * @param edit - Identifies if the credentials should be edited or simply added\n   * @param folderId - The folder to add the cipher to\n   */\n  private async saveOrUpdateCredentials(tab: chrome.tabs.Tab, edit: boolean, folderId?: string) {\n    for (let i = this.notificationQueue.length - 1; i >= 0; i--) {\n      const queueMessage = this.notificationQueue[i];\n      if (\n        queueMessage.tab.id !== tab.id ||\n        (queueMessage.type !== NotificationQueueMessageType.AddLogin &&\n          queueMessage.type !== NotificationQueueMessageType.ChangePassword)\n      ) {\n        continue;\n      }\n\n      const tabDomain = Utils.getDomain(tab.url);\n      if (tabDomain != null && tabDomain !== queueMessage.domain) {\n        continue;\n      }\n\n      this.notificationQueue.splice(i, 1);\n\n      if (queueMessage.type === NotificationQueueMessageType.ChangePassword) {\n        const cipherView = await this.getDecryptedCipherById(queueMessage.cipherId);\n        await this.updatePassword(cipherView, queueMessage.newPassword, edit, tab);\n        return;\n      }\n\n      // If the vault was locked, check if a cipher needs updating instead of creating a new one\n      if (queueMessage.wasVaultLocked) {\n        const allCiphers = await this.cipherService.getAllDecryptedForUrl(queueMessage.uri);\n        const existingCipher = allCiphers.find(\n          (c) =>\n            c.login.username != null && c.login.username.toLowerCase() === queueMessage.username,\n        );\n\n        if (existingCipher != null) {\n          await this.updatePassword(existingCipher, queueMessage.password, edit, tab);\n          return;\n        }\n      }\n\n      folderId = (await this.folderExists(folderId)) ? folderId : null;\n      const newCipher = this.convertAddLoginQueueMessageToCipherView(queueMessage, folderId);\n\n      if (edit) {\n        await this.editItem(newCipher, tab);\n        await BrowserApi.tabSendMessage(tab, { command: \"closeNotificationBar\" });\n        return;\n      }\n\n      const cipher = await this.cipherService.encrypt(newCipher);\n      try {\n        await this.cipherService.createWithServer(cipher);\n        await BrowserApi.tabSendMessage(tab, { command: \"saveCipherAttemptCompleted\" });\n        await BrowserApi.tabSendMessage(tab, { command: \"addedCipher\" });\n      } catch (error) {\n        await BrowserApi.tabSendMessageData(tab, \"saveCipherAttemptCompleted\", {\n          error: String(error.message),\n        });\n      }\n    }\n  }\n\n  /**\n   * Handles updating an existing cipher's password. If the cipher\n   * is being edited, a popup will be opened to allow the user to\n   * edit the cipher.\n   *\n   * @param cipherView - The cipher to update\n   * @param newPassword - The new password to update the cipher with\n   * @param edit - Identifies if the cipher should be edited or simply updated\n   * @param tab - The tab that the message was sent from\n   */\n  private async updatePassword(\n    cipherView: CipherView,\n    newPassword: string,\n    edit: boolean,\n    tab: chrome.tabs.Tab,\n  ) {\n    cipherView.login.password = newPassword;\n\n    if (edit) {\n      await this.editItem(cipherView, tab);\n      await BrowserApi.tabSendMessage(tab, { command: \"closeNotificationBar\" });\n      await BrowserApi.tabSendMessage(tab, { command: \"editedCipher\" });\n      return;\n    }\n\n    const cipher = await this.cipherService.encrypt(cipherView);\n    try {\n      // We've only updated the password, no need to broadcast editedCipher message\n      await this.cipherService.updateWithServer(cipher);\n      await BrowserApi.tabSendMessage(tab, { command: \"saveCipherAttemptCompleted\" });\n    } catch (error) {\n      await BrowserApi.tabSendMessageData(tab, \"saveCipherAttemptCompleted\", {\n        error: String(error.message),\n      });\n    }\n  }\n\n  /**\n   * Sets the add/edit cipher info in the state service\n   * and opens the add/edit vault item popout.\n   *\n   * @param cipherView - The cipher to edit\n   * @param senderTab - The tab that the message was sent from\n   */\n  private async editItem(cipherView: CipherView, senderTab: chrome.tabs.Tab) {\n    await this.stateService.setAddEditCipherInfo({\n      cipher: cipherView,\n      collectionIds: cipherView.collectionIds,\n    });\n\n    await this.openAddEditVaultItemPopout(senderTab, { cipherId: cipherView.id });\n  }\n\n  private async folderExists(folderId: string) {\n    if (Utils.isNullOrWhitespace(folderId) || folderId === \"null\") {\n      return false;\n    }\n\n    const folders = await firstValueFrom(this.folderService.folderViews$);\n    return folders.some((x) => x.id === folderId);\n  }\n\n  private async getDecryptedCipherById(cipherId: string) {\n    const cipher = await this.cipherService.get(cipherId);\n    if (cipher != null && cipher.type === CipherType.Login) {\n      return await cipher.decrypt(await this.cipherService.getKeyForCipherKeyDecryption(cipher));\n    }\n    return null;\n  }\n\n  /**\n   * Saves the current tab's domain to the never save list.\n   *\n   * @param tab - The tab that sent the neverSave message\n   */\n  private async saveNever(tab: chrome.tabs.Tab) {\n    for (let i = this.notificationQueue.length - 1; i >= 0; i--) {\n      const queueMessage = this.notificationQueue[i];\n      if (\n        queueMessage.tab.id !== tab.id ||\n        queueMessage.type !== NotificationQueueMessageType.AddLogin\n      ) {\n        continue;\n      }\n\n      const tabDomain = Utils.getDomain(tab.url);\n      if (tabDomain != null && tabDomain !== queueMessage.domain) {\n        continue;\n      }\n\n      this.notificationQueue.splice(i, 1);\n      await BrowserApi.tabSendMessageData(tab, \"closeNotificationBar\");\n\n      const hostname = Utils.getHostname(tab.url);\n      await this.cipherService.saveNeverDomain(hostname);\n    }\n  }\n\n  /**\n   * Returns the first value found from the folder service's folderViews$ observable.\n   */\n  private async getFolderData() {\n    return await firstValueFrom(this.folderService.folderViews$);\n  }\n\n  private async removeIndividualVault(): Promise<boolean> {\n    return await firstValueFrom(\n      this.policyService.policyAppliesToActiveUser$(PolicyType.PersonalOwnership),\n    );\n  }\n\n  /**\n   * Handles the unlockCompleted extension message. Will close the notification bar\n   * after an attempted autofill action, and retry the autofill action if the message\n   * contains a follow-up command.\n   *\n   * @param message - The extension message\n   * @param sender - The contextual sender of the message\n   */\n  private async handleUnlockCompleted(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ): Promise<void> {\n    const messageData = message.data as LockedVaultPendingNotificationsData;\n    const retryCommand = messageData.commandToRetry.message.command;\n    if (retryCommand === \"autofill_login\") {\n      await BrowserApi.tabSendMessageData(sender.tab, \"closeNotificationBar\");\n    }\n\n    if (messageData.target !== \"notification.background\") {\n      return;\n    }\n\n    const retryHandler: CallableFunction | undefined = this.extensionMessageHandlers[retryCommand];\n    if (retryHandler) {\n      retryHandler({\n        message: messageData.commandToRetry.message,\n        sender: messageData.commandToRetry.sender,\n      });\n    }\n  }\n\n  /**\n   * Sends a message back to the sender tab which\n   * triggers closure of the notification bar.\n   *\n   * @param sender - The contextual sender of the message\n   */\n  private async handleCloseNotificationBarMessage(sender: chrome.runtime.MessageSender) {\n    await BrowserApi.tabSendMessageData(sender.tab, \"closeNotificationBar\");\n  }\n\n  /**\n   * Sends a message back to the sender tab which triggers\n   * an CSS adjustment of the notification bar.\n   *\n   * @param message - The extension message\n   * @param sender - The contextual sender of the message\n   */\n  private async handleAdjustNotificationBarMessage(\n    message: NotificationBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    await BrowserApi.tabSendMessageData(sender.tab, \"adjustNotificationBar\", message.data);\n  }\n\n  /**\n   * Accepts a login queue message and converts it into a\n   * login uri view, login view, and cipher view.\n   *\n   * @param message - The message to convert to a cipher view\n   * @param folderId - The folder to add the cipher to\n   */\n  private convertAddLoginQueueMessageToCipherView(\n    message: AddLoginQueueMessage,\n    folderId?: string,\n  ): CipherView {\n    const uriView = new LoginUriView();\n    uriView.uri = message.uri;\n\n    const loginView = new LoginView();\n    loginView.uris = [uriView];\n    loginView.username = message.username;\n    loginView.password = message.password;\n\n    const cipherView = new CipherView();\n    cipherView.name = (Utils.getHostname(message.uri) || message.domain).replace(/^www\\./, \"\");\n    cipherView.folderId = folderId;\n    cipherView.type = CipherType.Login;\n    cipherView.login = loginView;\n\n    return cipherView;\n  }\n\n  private setupExtensionMessageListener() {\n    BrowserApi.messageListener(\"notification.background\", this.handleExtensionMessage);\n  }\n\n  private handleExtensionMessage = (\n    message: OverlayBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n    sendResponse: (response?: any) => void,\n  ) => {\n    const handler: CallableFunction | undefined = this.extensionMessageHandlers[message?.command];\n    if (!handler) {\n      return;\n    }\n\n    const messageResponse = handler({ message, sender });\n    if (!messageResponse) {\n      return;\n    }\n\n    Promise.resolve(messageResponse)\n      .then((response) => sendResponse(response))\n      .catch((error) => this.logService.error(error));\n    return true;\n  };\n}\n","import { Utils } from \"../../platform/misc/utils\";\nimport { CipherType } from \"../enums/cipher-type\";\nimport { CipherView } from \"../models/view/cipher.view\";\n\nexport function buildCipherIcon(\n  iconsServerUrl: string,\n  cipher: CipherView,\n  isFaviconDisabled: boolean,\n) {\n  const imageEnabled = !isFaviconDisabled;\n  let icon;\n  let image;\n  let fallbackImage = \"\";\n  const cardIcons: Record<string, string> = {\n    Visa: \"card-visa\",\n    Mastercard: \"card-mastercard\",\n    Amex: \"card-amex\",\n    Discover: \"card-discover\",\n    \"Diners Club\": \"card-diners-club\",\n    JCB: \"card-jcb\",\n    Maestro: \"card-maestro\",\n    UnionPay: \"card-union-pay\",\n    RuPay: \"card-ru-pay\",\n  };\n\n  switch (cipher.type) {\n    case CipherType.Login:\n      icon = \"bwi-globe\";\n\n      if (cipher.login.uri) {\n        let hostnameUri = cipher.login.uri;\n        let isWebsite = false;\n\n        if (hostnameUri.indexOf(\"androidapp://\") === 0) {\n          icon = \"bwi-android\";\n          image = null;\n        } else if (hostnameUri.indexOf(\"iosapp://\") === 0) {\n          icon = \"bwi-apple\";\n          image = null;\n        } else if (\n          imageEnabled &&\n          hostnameUri.indexOf(\"://\") === -1 &&\n          hostnameUri.indexOf(\".\") > -1\n        ) {\n          hostnameUri = `http://${hostnameUri}`;\n          isWebsite = true;\n        } else if (imageEnabled) {\n          isWebsite = hostnameUri.indexOf(\"http\") === 0 && hostnameUri.indexOf(\".\") > -1;\n        }\n\n        if (imageEnabled && isWebsite) {\n          try {\n            image = `${iconsServerUrl}/${Utils.getHostname(hostnameUri)}/icon.png`;\n            fallbackImage = \"images/bwi-globe.png\";\n          } catch (e) {\n            // Ignore error since the fallback icon will be shown if image is null.\n          }\n        }\n      } else {\n        image = null;\n      }\n      break;\n    case CipherType.SecureNote:\n      icon = \"bwi-sticky-note\";\n      break;\n    case CipherType.Card:\n      icon = \"bwi-credit-card\";\n      if (imageEnabled && cipher.card.brand in cardIcons) {\n        icon = `credit-card-icon ${cardIcons[cipher.card.brand]}`;\n      }\n      break;\n    case CipherType.Identity:\n      icon = \"bwi-id-card\";\n      break;\n    default:\n      break;\n  }\n\n  return {\n    imageEnabled,\n    image,\n    fallbackImage,\n    icon,\n  };\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { SettingsService } from \"@bitwarden/common/abstractions/settings.service\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { AutofillSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { buildCipherIcon } from \"@bitwarden/common/vault/icon/build-cipher-icon\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { LoginUriView } from \"@bitwarden/common/vault/models/view/login-uri.view\";\nimport { LoginView } from \"@bitwarden/common/vault/models/view/login.view\";\n\nimport { openUnlockPopout } from \"../../auth/popup/utils/auth-popout-window\";\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport {\n  openViewVaultItemPopout,\n  openAddEditVaultItemPopout,\n} from \"../../vault/popup/utils/vault-popout-window\";\nimport { SHOW_AUTOFILL_BUTTON } from \"../constants\";\nimport { AutofillService, PageDetail } from \"../services/abstractions/autofill.service\";\nimport {\n  InlineMenuVisibilitySetting,\n  AutofillOverlayElement,\n  AutofillOverlayPort,\n} from \"../utils/autofill-overlay.enum\";\n\nimport { LockedVaultPendingNotificationsData } from \"./abstractions/notification.background\";\nimport {\n  FocusedFieldData,\n  OverlayBackgroundExtensionMessageHandlers,\n  OverlayButtonPortMessageHandlers,\n  OverlayCipherData,\n  OverlayListPortMessageHandlers,\n  OverlayBackground as OverlayBackgroundInterface,\n  OverlayBackgroundExtensionMessage,\n  OverlayAddNewItemMessage,\n  OverlayPortMessage,\n  WebsiteIconData,\n} from \"./abstractions/overlay.background\";\n\nclass OverlayBackground implements OverlayBackgroundInterface {\n  private readonly openUnlockPopout = openUnlockPopout;\n  private readonly openViewVaultItemPopout = openViewVaultItemPopout;\n  private readonly openAddEditVaultItemPopout = openAddEditVaultItemPopout;\n  private overlayLoginCiphers: Map<string, CipherView> = new Map();\n  private pageDetailsForTab: Record<number, PageDetail[]> = {};\n  private userAuthStatus: AuthenticationStatus = AuthenticationStatus.LoggedOut;\n  private overlayButtonPort: chrome.runtime.Port;\n  private overlayListPort: chrome.runtime.Port;\n  private focusedFieldData: FocusedFieldData;\n  private overlayPageTranslations: Record<string, string>;\n  private readonly iconsServerUrl: string;\n  private readonly extensionMessageHandlers: OverlayBackgroundExtensionMessageHandlers = {\n    openAutofillOverlay: () => this.openOverlay(false),\n    autofillOverlayElementClosed: ({ message }) => this.overlayElementClosed(message),\n    autofillOverlayAddNewVaultItem: ({ message, sender }) => this.addNewVaultItem(message, sender),\n    getAutofillOverlayVisibility: () => this.getOverlayVisibility(),\n    checkAutofillOverlayFocused: () => this.checkOverlayFocused(),\n    focusAutofillOverlayList: () => this.focusOverlayList(),\n    updateAutofillOverlayPosition: ({ message }) => this.updateOverlayPosition(message),\n    updateAutofillOverlayHidden: ({ message }) => this.updateOverlayHidden(message),\n    updateFocusedFieldData: ({ message }) => this.setFocusedFieldData(message),\n    collectPageDetailsResponse: ({ message, sender }) => this.storePageDetails(message, sender),\n    unlockCompleted: ({ message }) => this.unlockCompleted(message),\n    addEditCipherSubmitted: () => this.updateOverlayCiphers(),\n    deletedCipher: () => this.updateOverlayCiphers(),\n  };\n  private readonly overlayButtonPortMessageHandlers: OverlayButtonPortMessageHandlers = {\n    overlayButtonClicked: ({ port }) => this.handleOverlayButtonClicked(port),\n    closeAutofillOverlay: ({ port }) => this.closeOverlay(port),\n    forceCloseAutofillOverlay: ({ port }) => this.closeOverlay(port, true),\n    overlayPageBlurred: () => this.checkOverlayListFocused(),\n    redirectOverlayFocusOut: ({ message, port }) => this.redirectOverlayFocusOut(message, port),\n  };\n  private readonly overlayListPortMessageHandlers: OverlayListPortMessageHandlers = {\n    checkAutofillOverlayButtonFocused: () => this.checkOverlayButtonFocused(),\n    forceCloseAutofillOverlay: ({ port }) => this.closeOverlay(port, true),\n    overlayPageBlurred: () => this.checkOverlayButtonFocused(),\n    unlockVault: ({ port }) => this.unlockVault(port),\n    fillSelectedListItem: ({ message, port }) => this.fillSelectedOverlayListItem(message, port),\n    addNewVaultItem: ({ port }) => this.getNewVaultItemDetails(port),\n    viewSelectedCipher: ({ message, port }) => this.viewSelectedCipher(message, port),\n    redirectOverlayFocusOut: ({ message, port }) => this.redirectOverlayFocusOut(message, port),\n  };\n\n  constructor(\n    private cipherService: CipherService,\n    private autofillService: AutofillService,\n    private authService: AuthService,\n    private environmentService: EnvironmentService,\n    private settingsService: SettingsService,\n    private stateService: StateService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private i18nService: I18nService,\n    private platformUtilsService: PlatformUtilsService,\n  ) {\n    this.iconsServerUrl = this.environmentService.getIconsUrl();\n  }\n\n  /**\n   * Removes cached page details for a tab\n   * based on the passed tabId.\n   *\n   * @param tabId - Used to reference the page details of a specific tab\n   */\n  removePageDetails(tabId: number) {\n    delete this.pageDetailsForTab[tabId];\n  }\n\n  /**\n   * Sets up the extension message listeners and gets the settings for the\n   * overlay's visibility and the user's authentication status.\n   */\n  async init() {\n    this.setupExtensionMessageListeners();\n    await this.getOverlayVisibility();\n    await this.getAuthStatus();\n  }\n\n  /**\n   * Updates the overlay list's ciphers and sends the updated list to the overlay list iframe.\n   * Queries all ciphers for the given url, and sorts them by last used. Will not update the\n   * list of ciphers if the extension is not unlocked.\n   */\n  async updateOverlayCiphers() {\n    if (this.userAuthStatus !== AuthenticationStatus.Unlocked) {\n      return;\n    }\n\n    const currentTab = await BrowserApi.getTabFromCurrentWindowId();\n    if (!currentTab?.url) {\n      return;\n    }\n\n    this.overlayLoginCiphers = new Map();\n    const ciphersViews = (await this.cipherService.getAllDecryptedForUrl(currentTab.url)).sort(\n      (a, b) => this.cipherService.sortCiphersByLastUsedThenName(a, b),\n    );\n    for (let cipherIndex = 0; cipherIndex < ciphersViews.length; cipherIndex++) {\n      this.overlayLoginCiphers.set(`overlay-cipher-${cipherIndex}`, ciphersViews[cipherIndex]);\n    }\n\n    const ciphers = this.getOverlayCipherData();\n    this.overlayListPort?.postMessage({ command: \"updateOverlayListCiphers\", ciphers });\n    await BrowserApi.tabSendMessageData(currentTab, \"updateIsOverlayCiphersPopulated\", {\n      isOverlayCiphersPopulated: Boolean(ciphers.length),\n    });\n  }\n\n  /**\n   * Strips out unnecessary data from the ciphers and returns an array of\n   * objects that contain the cipher data needed for the overlay list.\n   */\n  private getOverlayCipherData(): OverlayCipherData[] {\n    const isFaviconDisabled = this.settingsService.getDisableFavicon();\n    const overlayCiphersArray = Array.from(this.overlayLoginCiphers);\n    const overlayCipherData = [];\n    let loginCipherIcon: WebsiteIconData;\n\n    for (let cipherIndex = 0; cipherIndex < overlayCiphersArray.length; cipherIndex++) {\n      const [overlayCipherId, cipher] = overlayCiphersArray[cipherIndex];\n      if (!loginCipherIcon && cipher.type === CipherType.Login) {\n        loginCipherIcon = buildCipherIcon(this.iconsServerUrl, cipher, isFaviconDisabled);\n      }\n\n      overlayCipherData.push({\n        id: overlayCipherId,\n        name: cipher.name,\n        type: cipher.type,\n        reprompt: cipher.reprompt,\n        favorite: cipher.favorite,\n        icon:\n          cipher.type === CipherType.Login\n            ? loginCipherIcon\n            : buildCipherIcon(this.iconsServerUrl, cipher, isFaviconDisabled),\n        login: cipher.type === CipherType.Login ? { username: cipher.login.username } : null,\n        card: cipher.type === CipherType.Card ? cipher.card.subTitle : null,\n      });\n    }\n\n    return overlayCipherData;\n  }\n\n  /**\n   * Handles aggregation of page details for a tab. Stores the page details\n   * in association with the tabId of the tab that sent the message.\n   *\n   * @param message - Message received from the `collectPageDetailsResponse` command\n   * @param sender - The sender of the message\n   */\n  private storePageDetails(\n    message: OverlayBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    const pageDetails = {\n      frameId: sender.frameId,\n      tab: sender.tab,\n      details: message.details,\n    };\n\n    if (this.pageDetailsForTab[sender.tab.id]?.length) {\n      this.pageDetailsForTab[sender.tab.id].push(pageDetails);\n      return;\n    }\n\n    this.pageDetailsForTab[sender.tab.id] = [pageDetails];\n  }\n\n  /**\n   * Triggers autofill for the selected cipher in the overlay list. Also places\n   * the selected cipher at the top of the list of ciphers.\n   *\n   * @param overlayCipherId - Cipher ID corresponding to the overlayLoginCiphers map. Does not correspond to the actual cipher's ID.\n   * @param sender - The sender of the port message\n   */\n  private async fillSelectedOverlayListItem(\n    { overlayCipherId }: OverlayPortMessage,\n    { sender }: chrome.runtime.Port,\n  ) {\n    if (!overlayCipherId) {\n      return;\n    }\n\n    const cipher = this.overlayLoginCiphers.get(overlayCipherId);\n\n    if (await this.autofillService.isPasswordRepromptRequired(cipher, sender.tab)) {\n      return;\n    }\n    const totpCode = await this.autofillService.doAutoFill({\n      tab: sender.tab,\n      cipher: cipher,\n      pageDetails: this.pageDetailsForTab[sender.tab.id],\n      fillNewPassword: true,\n      allowTotpAutofill: true,\n    });\n\n    if (totpCode) {\n      this.platformUtilsService.copyToClipboard(totpCode, { window });\n    }\n\n    this.overlayLoginCiphers = new Map([[overlayCipherId, cipher], ...this.overlayLoginCiphers]);\n  }\n\n  /**\n   * Checks if the overlay is focused. Will check the overlay list\n   * if it is open, otherwise it will check the overlay button.\n   */\n  private checkOverlayFocused() {\n    if (this.overlayListPort) {\n      this.checkOverlayListFocused();\n\n      return;\n    }\n\n    this.checkOverlayButtonFocused();\n  }\n\n  /**\n   * Posts a message to the overlay button iframe to check if it is focused.\n   */\n  private checkOverlayButtonFocused() {\n    this.overlayButtonPort?.postMessage({ command: \"checkAutofillOverlayButtonFocused\" });\n  }\n\n  /**\n   * Posts a message to the overlay list iframe to check if it is focused.\n   */\n  private checkOverlayListFocused() {\n    this.overlayListPort?.postMessage({ command: \"checkAutofillOverlayListFocused\" });\n  }\n\n  /**\n   * Sends a message to the sender tab to close the autofill overlay.\n   *\n   * @param sender - The sender of the port message\n   * @param forceCloseOverlay - Identifies whether the overlay should be force closed\n   */\n  private closeOverlay({ sender }: chrome.runtime.Port, forceCloseOverlay = false) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.tabSendMessageData(sender.tab, \"closeAutofillOverlay\", { forceCloseOverlay });\n  }\n\n  /**\n   * Handles cleanup when an overlay element is closed. Disconnects\n   * the list and button ports and sets them to null.\n   *\n   * @param overlayElement - The overlay element that was closed, either the list or button\n   */\n  private overlayElementClosed({ overlayElement }: OverlayBackgroundExtensionMessage) {\n    if (overlayElement === AutofillOverlayElement.Button) {\n      this.overlayButtonPort?.disconnect();\n      this.overlayButtonPort = null;\n\n      return;\n    }\n\n    this.overlayListPort?.disconnect();\n    this.overlayListPort = null;\n  }\n\n  /**\n   * Updates the position of either the overlay list or button. The position\n   * is based on the focused field's position and dimensions.\n   *\n   * @param overlayElement - The overlay element to update, either the list or button\n   */\n  private updateOverlayPosition({ overlayElement }: { overlayElement?: string }) {\n    if (!overlayElement) {\n      return;\n    }\n\n    if (overlayElement === AutofillOverlayElement.Button) {\n      this.overlayButtonPort?.postMessage({\n        command: \"updateIframePosition\",\n        styles: this.getOverlayButtonPosition(),\n      });\n\n      return;\n    }\n\n    this.overlayListPort?.postMessage({\n      command: \"updateIframePosition\",\n      styles: this.getOverlayListPosition(),\n    });\n  }\n\n  /**\n   * Gets the position of the focused field and calculates the position\n   * of the overlay button based on the focused field's position and dimensions.\n   */\n  private getOverlayButtonPosition() {\n    if (!this.focusedFieldData) {\n      return;\n    }\n\n    const { top, left, width, height } = this.focusedFieldData.focusedFieldRects;\n    const { paddingRight, paddingLeft } = this.focusedFieldData.focusedFieldStyles;\n    let elementOffset = height * 0.37;\n    if (height >= 35) {\n      elementOffset = height >= 50 ? height * 0.47 : height * 0.42;\n    }\n\n    const elementHeight = height - elementOffset;\n    const elementTopPosition = top + elementOffset / 2;\n    let elementLeftPosition = left + width - height + elementOffset / 2;\n\n    const fieldPaddingRight = parseInt(paddingRight, 10);\n    const fieldPaddingLeft = parseInt(paddingLeft, 10);\n    if (fieldPaddingRight > fieldPaddingLeft) {\n      elementLeftPosition = left + width - height - (fieldPaddingRight - elementOffset + 2);\n    }\n\n    return {\n      top: `${Math.round(elementTopPosition)}px`,\n      left: `${Math.round(elementLeftPosition)}px`,\n      height: `${Math.round(elementHeight)}px`,\n      width: `${Math.round(elementHeight)}px`,\n    };\n  }\n\n  /**\n   * Gets the position of the focused field and calculates the position\n   * of the overlay list based on the focused field's position and dimensions.\n   */\n  private getOverlayListPosition() {\n    if (!this.focusedFieldData) {\n      return;\n    }\n\n    const { top, left, width, height } = this.focusedFieldData.focusedFieldRects;\n    return {\n      width: `${Math.round(width)}px`,\n      top: `${Math.round(top + height)}px`,\n      left: `${Math.round(left)}px`,\n    };\n  }\n\n  /**\n   * Sets the focused field data to the data passed in the extension message.\n   *\n   * @param focusedFieldData - Contains the rects and styles of the focused field.\n   */\n  private setFocusedFieldData({ focusedFieldData }: OverlayBackgroundExtensionMessage) {\n    this.focusedFieldData = focusedFieldData;\n  }\n\n  /**\n   * Updates the overlay's visibility based on the display property passed in the extension message.\n   *\n   * @param display - The display property of the overlay, either \"block\" or \"none\"\n   */\n  private updateOverlayHidden({ display }: OverlayBackgroundExtensionMessage) {\n    if (!display) {\n      return;\n    }\n\n    const portMessage = { command: \"updateOverlayHidden\", styles: { display } };\n\n    this.overlayButtonPort?.postMessage(portMessage);\n    this.overlayListPort?.postMessage(portMessage);\n  }\n\n  /**\n   * Sends a message to the currently active tab to open the autofill overlay.\n   *\n   * @param isFocusingFieldElement - Identifies whether the field element should be focused when the overlay is opened\n   * @param isOpeningFullOverlay - Identifies whether the full overlay should be forced open regardless of other states\n   */\n  private async openOverlay(isFocusingFieldElement = false, isOpeningFullOverlay = false) {\n    const currentTab = await BrowserApi.getTabFromCurrentWindowId();\n\n    await BrowserApi.tabSendMessageData(currentTab, \"openAutofillOverlay\", {\n      isFocusingFieldElement,\n      isOpeningFullOverlay,\n      authStatus: await this.getAuthStatus(),\n    });\n  }\n\n  /**\n   * Gets the overlay's visibility setting from the settings service.\n   */\n  private async getOverlayVisibility(): Promise<InlineMenuVisibilitySetting> {\n    return await firstValueFrom(this.autofillSettingsService.inlineMenuVisibility$);\n  }\n\n  /**\n   * Gets the user's authentication status from the auth service. If the user's\n   * authentication status has changed, the overlay button's authentication status\n   * will be updated and the overlay list's ciphers will be updated.\n   */\n  private async getAuthStatus() {\n    const formerAuthStatus = this.userAuthStatus;\n    this.userAuthStatus = await this.authService.getAuthStatus();\n\n    if (\n      this.userAuthStatus !== formerAuthStatus &&\n      this.userAuthStatus === AuthenticationStatus.Unlocked\n    ) {\n      this.updateOverlayButtonAuthStatus();\n      await this.updateOverlayCiphers();\n    }\n\n    return this.userAuthStatus;\n  }\n\n  /**\n   * Sends a message to the overlay button to update its authentication status.\n   */\n  private updateOverlayButtonAuthStatus() {\n    this.overlayButtonPort?.postMessage({\n      command: \"updateOverlayButtonAuthStatus\",\n      authStatus: this.userAuthStatus,\n    });\n  }\n\n  /**\n   * Handles the overlay button being clicked. If the user is not authenticated,\n   * the vault will be unlocked. If the user is authenticated, the overlay will\n   * be opened.\n   *\n   * @param port - The port of the overlay button\n   */\n  private handleOverlayButtonClicked(port: chrome.runtime.Port) {\n    if (this.userAuthStatus !== AuthenticationStatus.Unlocked) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.unlockVault(port);\n      return;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.openOverlay(false, true);\n  }\n\n  /**\n   * Facilitates opening the unlock popout window.\n   *\n   * @param port - The port of the overlay list\n   */\n  private async unlockVault(port: chrome.runtime.Port) {\n    const { sender } = port;\n\n    this.closeOverlay(port);\n    const retryMessage: LockedVaultPendingNotificationsData = {\n      commandToRetry: { message: { command: \"openAutofillOverlay\" }, sender },\n      target: \"overlay.background\",\n    };\n    await BrowserApi.tabSendMessageData(\n      sender.tab,\n      \"addToLockedVaultPendingNotifications\",\n      retryMessage,\n    );\n    await this.openUnlockPopout(sender.tab, true);\n  }\n\n  /**\n   * Triggers the opening of a vault item popout window associated\n   * with the passed cipher ID.\n   * @param overlayCipherId - Cipher ID corresponding to the overlayLoginCiphers map. Does not correspond to the actual cipher's ID.\n   * @param sender - The sender of the port message\n   */\n  private async viewSelectedCipher(\n    { overlayCipherId }: OverlayPortMessage,\n    { sender }: chrome.runtime.Port,\n  ) {\n    const cipher = this.overlayLoginCiphers.get(overlayCipherId);\n    if (!cipher) {\n      return;\n    }\n\n    await this.openViewVaultItemPopout(sender.tab, {\n      cipherId: cipher.id,\n      action: SHOW_AUTOFILL_BUTTON,\n    });\n  }\n\n  /**\n   * Facilitates redirecting focus to the overlay list.\n   */\n  private focusOverlayList() {\n    this.overlayListPort?.postMessage({ command: \"focusOverlayList\" });\n  }\n\n  /**\n   * Updates the authentication status for the user and opens the overlay if\n   * a followup command is present in the message.\n   *\n   * @param message - Extension message received from the `unlockCompleted` command\n   */\n  private async unlockCompleted(message: OverlayBackgroundExtensionMessage) {\n    await this.getAuthStatus();\n\n    if (message.data?.commandToRetry?.message?.command === \"openAutofillOverlay\") {\n      await this.openOverlay(true);\n    }\n  }\n\n  /**\n   * Gets the translations for the overlay page.\n   */\n  private getTranslations() {\n    if (!this.overlayPageTranslations) {\n      this.overlayPageTranslations = {\n        locale: BrowserApi.getUILanguage(),\n        opensInANewWindow: this.i18nService.translate(\"opensInANewWindow\"),\n        buttonPageTitle: this.i18nService.translate(\"bitwardenOverlayButton\"),\n        toggleBitwardenVaultOverlay: this.i18nService.translate(\"toggleBitwardenVaultOverlay\"),\n        listPageTitle: this.i18nService.translate(\"bitwardenVault\"),\n        unlockYourAccount: this.i18nService.translate(\"unlockYourAccountToViewMatchingLogins\"),\n        unlockAccount: this.i18nService.translate(\"unlockAccount\"),\n        fillCredentialsFor: this.i18nService.translate(\"fillCredentialsFor\"),\n        partialUsername: this.i18nService.translate(\"partialUsername\"),\n        view: this.i18nService.translate(\"view\"),\n        noItemsToShow: this.i18nService.translate(\"noItemsToShow\"),\n        newItem: this.i18nService.translate(\"newItem\"),\n        addNewVaultItem: this.i18nService.translate(\"addNewVaultItem\"),\n      };\n    }\n\n    return this.overlayPageTranslations;\n  }\n\n  /**\n   * Facilitates redirecting focus out of one of the\n   *  overlay elements to elements on the page.\n   *\n   * @param direction - The direction to redirect focus to (either \"next\", \"previous\" or \"current)\n   * @param sender - The sender of the port message\n   */\n  private redirectOverlayFocusOut(\n    { direction }: OverlayPortMessage,\n    { sender }: chrome.runtime.Port,\n  ) {\n    if (!direction) {\n      return;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.tabSendMessageData(sender.tab, \"redirectOverlayFocusOut\", { direction });\n  }\n\n  /**\n   * Triggers adding a new vault item from the overlay. Gathers data\n   * input by the user before calling to open the add/edit window.\n   *\n   * @param sender - The sender of the port message\n   */\n  private getNewVaultItemDetails({ sender }: chrome.runtime.Port) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.tabSendMessage(sender.tab, { command: \"addNewVaultItemFromOverlay\" });\n  }\n\n  /**\n   * Handles adding a new vault item from the overlay. Gathers data login\n   * data captured in the extension message.\n   *\n   * @param login - The login data captured from the extension message\n   * @param sender - The sender of the extension message\n   */\n  private async addNewVaultItem(\n    { login }: OverlayAddNewItemMessage,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    if (!login) {\n      return;\n    }\n\n    const uriView = new LoginUriView();\n    uriView.uri = login.uri;\n\n    const loginView = new LoginView();\n    loginView.uris = [uriView];\n    loginView.username = login.username || \"\";\n    loginView.password = login.password || \"\";\n\n    const cipherView = new CipherView();\n    cipherView.name = (Utils.getHostname(login.uri) || login.hostname).replace(/^www\\./, \"\");\n    cipherView.folderId = null;\n    cipherView.type = CipherType.Login;\n    cipherView.login = loginView;\n\n    await this.stateService.setAddEditCipherInfo({\n      cipher: cipherView,\n      collectionIds: cipherView.collectionIds,\n    });\n\n    await BrowserApi.sendMessage(\"inlineAutofillMenuRefreshAddEditCipher\");\n    await this.openAddEditVaultItemPopout(sender.tab, { cipherId: cipherView.id });\n  }\n\n  /**\n   * Sets up the extension message listeners for the overlay.\n   */\n  private setupExtensionMessageListeners() {\n    BrowserApi.messageListener(\"overlay.background\", this.handleExtensionMessage);\n    BrowserApi.addListener(chrome.runtime.onConnect, this.handlePortOnConnect);\n  }\n\n  /**\n   * Handles extension messages sent to the extension background.\n   *\n   * @param message - The message received from the extension\n   * @param sender - The sender of the message\n   * @param sendResponse - The response to send back to the sender\n   */\n  private handleExtensionMessage = (\n    message: OverlayBackgroundExtensionMessage,\n    sender: chrome.runtime.MessageSender,\n    sendResponse: (response?: any) => void,\n  ) => {\n    const handler: CallableFunction | undefined = this.extensionMessageHandlers[message?.command];\n    if (!handler) {\n      return;\n    }\n\n    const messageResponse = handler({ message, sender });\n    if (!messageResponse) {\n      return;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    Promise.resolve(messageResponse).then((response) => sendResponse(response));\n    return true;\n  };\n\n  /**\n   * Handles the connection of a port to the extension background.\n   *\n   * @param port - The port that connected to the extension background\n   */\n  private handlePortOnConnect = async (port: chrome.runtime.Port) => {\n    const isOverlayListPort = port.name === AutofillOverlayPort.List;\n    const isOverlayButtonPort = port.name === AutofillOverlayPort.Button;\n\n    if (!isOverlayListPort && !isOverlayButtonPort) {\n      return;\n    }\n\n    if (isOverlayListPort) {\n      this.overlayListPort = port;\n    } else {\n      this.overlayButtonPort = port;\n    }\n\n    port.onMessage.addListener(this.handleOverlayElementPortMessage);\n    port.postMessage({\n      command: `initAutofillOverlay${isOverlayListPort ? \"List\" : \"Button\"}`,\n      authStatus: await this.getAuthStatus(),\n      styleSheetUrl: chrome.runtime.getURL(`overlay/${isOverlayListPort ? \"list\" : \"button\"}.css`),\n      theme: await this.stateService.getTheme(),\n      translations: this.getTranslations(),\n      ciphers: isOverlayListPort ? this.getOverlayCipherData() : null,\n    });\n    this.updateOverlayPosition({\n      overlayElement: isOverlayListPort\n        ? AutofillOverlayElement.List\n        : AutofillOverlayElement.Button,\n    });\n  };\n\n  /**\n   * Handles messages sent to the overlay list or button ports.\n   *\n   * @param message - The message received from the port\n   * @param port - The port that sent the message\n   */\n  private handleOverlayElementPortMessage = (\n    message: OverlayBackgroundExtensionMessage,\n    port: chrome.runtime.Port,\n  ) => {\n    const command = message?.command;\n    let handler: CallableFunction | undefined;\n\n    if (port.name === AutofillOverlayPort.Button) {\n      handler = this.overlayButtonPortMessageHandlers[command];\n    }\n\n    if (port.name === AutofillOverlayPort.List) {\n      handler = this.overlayListPortMessageHandlers[command];\n    }\n\n    if (!handler) {\n      return;\n    }\n\n    handler({ message, port });\n  };\n}\n\nexport default OverlayBackground;\n","import MainBackground from \"../../background/main.background\";\n\nimport NotificationBackground from \"./notification.background\";\nimport OverlayBackground from \"./overlay.background\";\n\nexport default class TabsBackground {\n  constructor(\n    private main: MainBackground,\n    private notificationBackground: NotificationBackground,\n    private overlayBackground: OverlayBackground,\n  ) {}\n\n  private focusedWindowId: number;\n\n  /**\n   * Initializes the window and tab listeners.\n   */\n  async init() {\n    if (!chrome.tabs || !chrome.windows) {\n      return;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.updateCurrentTabData();\n    this.setupTabEventListeners();\n  }\n\n  /**\n   * Sets up the tab and window event listeners.\n   */\n  private setupTabEventListeners() {\n    chrome.windows.onFocusChanged.addListener(this.handleWindowOnFocusChanged);\n    chrome.tabs.onActivated.addListener(this.handleTabOnActivated);\n    chrome.tabs.onReplaced.addListener(this.handleTabOnReplaced);\n    chrome.tabs.onUpdated.addListener(this.handleTabOnUpdated);\n    chrome.tabs.onRemoved.addListener(this.handleTabOnRemoved);\n  }\n\n  /**\n   * Handles the window onFocusChanged event.\n   *\n   * @param windowId - The ID of the window that was focused.\n   */\n  private handleWindowOnFocusChanged = async (windowId: number) => {\n    if (windowId == null || windowId < 0) {\n      return;\n    }\n\n    this.focusedWindowId = windowId;\n    await this.updateCurrentTabData();\n    this.main.messagingService.send(\"windowChanged\");\n  };\n\n  /**\n   * Handles the tab onActivated event.\n   */\n  private handleTabOnActivated = async () => {\n    await this.updateCurrentTabData();\n    this.main.messagingService.send(\"tabChanged\");\n  };\n\n  /**\n   * Handles the tab onReplaced event.\n   */\n  private handleTabOnReplaced = async () => {\n    if (this.main.onReplacedRan) {\n      return;\n    }\n    this.main.onReplacedRan = true;\n\n    await this.notificationBackground.checkNotificationQueue();\n    await this.updateCurrentTabData();\n    this.main.messagingService.send(\"tabChanged\");\n  };\n\n  /**\n   * Handles the tab onUpdated event.\n   *\n   * @param tabId - The ID of the tab that was updated.\n   * @param changeInfo - The change information.\n   * @param tab - The updated tab.\n   */\n  private handleTabOnUpdated = async (\n    tabId: number,\n    changeInfo: chrome.tabs.TabChangeInfo,\n    tab: chrome.tabs.Tab,\n  ) => {\n    const removePageDetailsStatus = new Set([\"loading\", \"unloaded\"]);\n    if (removePageDetailsStatus.has(changeInfo.status)) {\n      this.overlayBackground.removePageDetails(tabId);\n    }\n\n    if (this.focusedWindowId > 0 && tab.windowId !== this.focusedWindowId) {\n      return;\n    }\n\n    if (!tab.active) {\n      return;\n    }\n\n    await this.overlayBackground.updateOverlayCiphers();\n\n    if (this.main.onUpdatedRan) {\n      return;\n    }\n    this.main.onUpdatedRan = true;\n\n    await this.notificationBackground.checkNotificationQueue(tab);\n    await this.main.refreshBadge();\n    await this.main.refreshMenu();\n    this.main.messagingService.send(\"tabChanged\");\n  };\n\n  /**\n   * Handles the tab onRemoved event.\n   *\n   * @param tabId - The ID of the tab that was removed.\n   */\n  private handleTabOnRemoved = async (tabId: number) => {\n    this.overlayBackground.removePageDetails(tabId);\n  };\n\n  /**\n   * Updates the current tab data, refreshing the badge and context menu\n   * for the current tab. Also updates the overlay ciphers.\n   */\n  private updateCurrentTabData = async () => {\n    await Promise.all([\n      this.main.refreshBadge(),\n      this.main.refreshMenu(),\n      this.overlayBackground.updateOverlayCiphers(),\n    ]);\n  };\n}\n","import { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { UriMatchType } from \"@bitwarden/common/vault/enums\";\n\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\n\nexport default class WebRequestBackground {\n  private pendingAuthRequests: any[] = [];\n  private webRequest: any;\n  private isFirefox: boolean;\n\n  constructor(\n    platformUtilsService: PlatformUtilsService,\n    private cipherService: CipherService,\n    private authService: AuthService,\n  ) {\n    if (BrowserApi.manifestVersion === 2) {\n      this.webRequest = (window as any).chrome.webRequest;\n    }\n    this.isFirefox = platformUtilsService.isFirefox();\n  }\n\n  async init() {\n    if (!this.webRequest || !this.webRequest.onAuthRequired) {\n      return;\n    }\n\n    this.webRequest.onAuthRequired.addListener(\n      async (details: any, callback: any) => {\n        if (!details.url || this.pendingAuthRequests.indexOf(details.requestId) !== -1) {\n          if (callback) {\n            callback();\n          }\n          return;\n        }\n\n        this.pendingAuthRequests.push(details.requestId);\n\n        if (this.isFirefox) {\n          // eslint-disable-next-line\n          return new Promise(async (resolve, reject) => {\n            await this.resolveAuthCredentials(details.url, resolve, reject);\n          });\n        } else {\n          await this.resolveAuthCredentials(details.url, callback, callback);\n        }\n      },\n      { urls: [\"http://*/*\", \"https://*/*\"] },\n      [this.isFirefox ? \"blocking\" : \"asyncBlocking\"],\n    );\n\n    this.webRequest.onCompleted.addListener((details: any) => this.completeAuthRequest(details), {\n      urls: [\"http://*/*\"],\n    });\n    this.webRequest.onErrorOccurred.addListener(\n      (details: any) => this.completeAuthRequest(details),\n      {\n        urls: [\"http://*/*\"],\n      },\n    );\n  }\n\n  // eslint-disable-next-line\n  private async resolveAuthCredentials(domain: string, success: Function, error: Function) {\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      error();\n      return;\n    }\n\n    try {\n      const ciphers = await this.cipherService.getAllDecryptedForUrl(\n        domain,\n        null,\n        UriMatchType.Host,\n      );\n      if (ciphers == null || ciphers.length !== 1) {\n        error();\n        return;\n      }\n\n      success({\n        authCredentials: {\n          username: ciphers[0].login.username,\n          password: ciphers[0].login.password,\n        },\n      });\n    } catch {\n      error();\n    }\n  }\n\n  private completeAuthRequest(details: any) {\n    const i = this.pendingAuthRequests.indexOf(details.requestId);\n    if (i > -1) {\n      this.pendingAuthRequests.splice(i, 1);\n    }\n  }\n}\n","export type CachedServices = Record<string, unknown>;\n\nexport type FactoryOptions = {\n  alwaysInitializeNewService?: boolean;\n  doNotStoreInitializedService?: boolean;\n  [optionsKey: string]: unknown;\n};\n\nexport async function factory<\n  TCache extends CachedServices,\n  TName extends keyof TCache,\n  TOpts extends FactoryOptions,\n>(\n  cachedServices: TCache,\n  name: TName,\n  opts: TOpts,\n  factory: () => TCache[TName] | Promise<TCache[TName]>,\n): Promise<TCache[TName]> {\n  let instance = cachedServices[name];\n  if (opts.alwaysInitializeNewService || !instance) {\n    const instanceOrPromise = factory();\n    instance = instanceOrPromise instanceof Promise ? await instanceOrPromise : instanceOrPromise;\n  }\n\n  if (!opts.doNotStoreInitializedService) {\n    cachedServices[name] = instance;\n  }\n\n  return instance as TCache[TName];\n}\n","import { mergeMap } from \"rxjs\";\n\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n  StorageUpdateType,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\n\nimport { fromChromeEvent } from \"../../browser/from-chrome-event\";\n\nexport default abstract class AbstractChromeStorageService\n  implements AbstractStorageService, ObservableStorageService\n{\n  updates$;\n\n  constructor(protected chromeStorageApi: chrome.storage.StorageArea) {\n    this.updates$ = fromChromeEvent(this.chromeStorageApi.onChanged).pipe(\n      mergeMap(([changes]) => {\n        return Object.entries(changes).map(([key, change]) => {\n          // The `newValue` property isn't on the StorageChange object\n          // when the change was from a remove. Similarly a check of the `oldValue`\n          // could be used to tell if the operation was the first creation of this key\n          // but we currently do not differentiate that.\n          // Ref: https://developer.chrome.com/docs/extensions/reference/storage/#type-StorageChange\n          // Ref: https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/StorageChange\n          const updateType: StorageUpdateType = \"newValue\" in change ? \"save\" : \"remove\";\n\n          return {\n            key: key,\n            // For removes this property will not exist but then it will just be\n            // undefined which is fine.\n            updateType: updateType,\n          };\n        });\n      }),\n    );\n  }\n\n  get valuesRequireDeserialization(): boolean {\n    return true;\n  }\n\n  async get<T>(key: string): Promise<T> {\n    return new Promise((resolve) => {\n      this.chromeStorageApi.get(key, (obj: any) => {\n        if (obj != null && obj[key] != null) {\n          resolve(obj[key] as T);\n          return;\n        }\n        resolve(null);\n      });\n    });\n  }\n\n  async has(key: string): Promise<boolean> {\n    return (await this.get(key)) != null;\n  }\n\n  async save(key: string, obj: any): Promise<void> {\n    if (obj == null) {\n      // Fix safari not liking null in set\n      return this.remove(key);\n    }\n\n    if (obj instanceof Set) {\n      obj = Array.from(obj);\n    }\n\n    const keyedObj = { [key]: obj };\n    return new Promise<void>((resolve) => {\n      this.chromeStorageApi.set(keyedObj, () => {\n        resolve();\n      });\n    });\n  }\n\n  async remove(key: string): Promise<void> {\n    return new Promise<void>((resolve) => {\n      this.chromeStorageApi.remove(key, () => {\n        resolve();\n      });\n    });\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { BrowserApi } from \"./browser-api\";\n\n/**\n * Converts a Chrome event to an Observable stream.\n *\n * @typeParam T - The type of the event arguments.\n * @param event - The Chrome event to convert.\n * @returns An Observable stream of the event arguments.\n *\n * @remarks\n * This function creates an Observable stream that listens to a Chrome event and emits its arguments\n * whenever the event is triggered. If the event throws an error, the Observable will emit an error\n * notification with the error message.\n *\n * @example\n * ```typescript\n * const onMessage = fromChromeEvent(chrome.runtime.onMessage);\n * onMessage.subscribe((message) => console.log('Received message:', message));\n * ```\n */\nexport function fromChromeEvent<T extends unknown[]>(\n  event: chrome.events.Event<(...args: T) => void>,\n): Observable<T> {\n  return new Observable<T>((subscriber) => {\n    const handler = (...args: T) => {\n      if (chrome.runtime.lastError) {\n        subscriber.error(chrome.runtime.lastError);\n        return;\n      }\n\n      subscriber.next(args);\n    };\n\n    BrowserApi.addListener(event, handler);\n    return () => BrowserApi.removeListener(event, handler);\n  });\n}\n","import AbstractChromeStorageService from \"./abstractions/abstract-chrome-storage-api.service\";\n\nexport default class BrowserLocalStorageService extends AbstractChromeStorageService {\n  constructor() {\n    super(chrome.storage.local);\n  }\n}\n","import {\n  flagEnabled as baseFlagEnabled,\n  devFlagEnabled as baseDevFlagEnabled,\n  devFlagValue as baseDevFlagValue,\n  SharedFlags,\n  SharedDevFlags,\n} from \"@bitwarden/common/platform/misc/flags\";\n\nimport { GroupPolicyEnvironment } from \"../admin-console/types/group-policy-environment\";\n\nimport { BrowserApi } from \"./browser/browser-api\";\n\n// required to avoid linting errors when there are no flags\n/* eslint-disable-next-line @typescript-eslint/ban-types */\nexport type Flags = {\n  accountSwitching?: boolean;\n} & SharedFlags;\n\n// required to avoid linting errors when there are no flags\n/* eslint-disable-next-line @typescript-eslint/ban-types */\nexport type DevFlags = {\n  storeSessionDecrypted?: boolean;\n  managedEnvironment?: GroupPolicyEnvironment;\n} & SharedDevFlags;\n\nexport function flagEnabled(flag: keyof Flags): boolean {\n  return baseFlagEnabled<Flags>(flag);\n}\n\nexport function devFlagEnabled(flag: keyof DevFlags) {\n  return baseDevFlagEnabled<DevFlags>(flag);\n}\n\nexport function devFlagValue(flag: keyof DevFlags) {\n  return baseDevFlagValue(flag);\n}\n\n/** Helper method to sync flag specifically for account switching, which as platform-based values.\n * If this pattern needs to be repeated, it's better handled by increasing complexity of webpack configurations\n * Not by expanding these flag getters.\n */\nexport function enableAccountSwitching(): boolean {\n  if (BrowserApi.isSafariApi) {\n    return false;\n  }\n  return flagEnabled(\"accountSwitching\");\n}\n","import AbstractChromeStorageService from \"./abstractions/abstract-chrome-storage-api.service\";\n\nexport default class BrowserMemoryStorageService extends AbstractChromeStorageService {\n  constructor() {\n    super(chrome.storage.session);\n  }\n}\n","import { Subject } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport { EncryptService } from \"@bitwarden/common/platform/abstractions/encrypt.service\";\nimport { KeyGenerationService } from \"@bitwarden/common/platform/abstractions/key-generation.service\";\nimport {\n  AbstractMemoryStorageService,\n  StorageUpdate,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { MemoryStorageOptions } from \"@bitwarden/common/platform/models/domain/storage-options\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\n\nimport { devFlag } from \"../decorators/dev-flag.decorator\";\nimport { devFlagEnabled } from \"../flags\";\n\nimport BrowserLocalStorageService from \"./browser-local-storage.service\";\nimport BrowserMemoryStorageService from \"./browser-memory-storage.service\";\n\nconst keys = {\n  encKey: \"localEncryptionKey\",\n  sessionKey: \"session\",\n};\n\nexport class LocalBackedSessionStorageService extends AbstractMemoryStorageService {\n  private cache = new Map<string, unknown>();\n  private localStorage = new BrowserLocalStorageService();\n  private sessionStorage = new BrowserMemoryStorageService();\n  private updatesSubject = new Subject<StorageUpdate>();\n  updates$;\n\n  constructor(\n    private encryptService: EncryptService,\n    private keyGenerationService: KeyGenerationService,\n  ) {\n    super();\n    this.updates$ = this.updatesSubject.asObservable();\n  }\n\n  get valuesRequireDeserialization(): boolean {\n    return true;\n  }\n\n  async get<T>(key: string, options?: MemoryStorageOptions<T>): Promise<T> {\n    if (this.cache.has(key)) {\n      return this.cache.get(key) as T;\n    }\n\n    return await this.getBypassCache(key, options);\n  }\n\n  async getBypassCache<T>(key: string, options?: MemoryStorageOptions<T>): Promise<T> {\n    const session = await this.getLocalSession(await this.getSessionEncKey());\n    if (session == null || !Object.keys(session).includes(key)) {\n      return null;\n    }\n\n    let value = session[key];\n    if (options?.deserializer != null) {\n      value = options.deserializer(value as Jsonify<T>);\n    }\n\n    this.cache.set(key, value);\n    return this.cache.get(key) as T;\n  }\n\n  async has(key: string): Promise<boolean> {\n    return (await this.get(key)) != null;\n  }\n\n  async save<T>(key: string, obj: T): Promise<void> {\n    if (obj == null) {\n      this.cache.delete(key);\n    } else {\n      this.cache.set(key, obj);\n    }\n\n    const sessionEncKey = await this.getSessionEncKey();\n    const localSession = (await this.getLocalSession(sessionEncKey)) ?? {};\n    localSession[key] = obj;\n    await this.setLocalSession(localSession, sessionEncKey);\n  }\n\n  async remove(key: string): Promise<void> {\n    await this.save(key, null);\n  }\n\n  async getLocalSession(encKey: SymmetricCryptoKey): Promise<Record<string, unknown>> {\n    const local = await this.localStorage.get<string>(keys.sessionKey);\n\n    if (local == null) {\n      return null;\n    }\n\n    if (devFlagEnabled(\"storeSessionDecrypted\")) {\n      return local as any as Record<string, unknown>;\n    }\n\n    const sessionJson = await this.encryptService.decryptToUtf8(new EncString(local), encKey);\n    if (sessionJson == null) {\n      // Error with decryption -- session is lost, delete state and key and start over\n      await this.setSessionEncKey(null);\n      await this.localStorage.remove(keys.sessionKey);\n      return null;\n    }\n    return JSON.parse(sessionJson);\n  }\n\n  async setLocalSession(session: Record<string, unknown>, key: SymmetricCryptoKey) {\n    if (devFlagEnabled(\"storeSessionDecrypted\")) {\n      await this.setDecryptedLocalSession(session);\n    } else {\n      await this.setEncryptedLocalSession(session, key);\n    }\n  }\n\n  @devFlag(\"storeSessionDecrypted\")\n  async setDecryptedLocalSession(session: Record<string, unknown>): Promise<void> {\n    // Make sure we're storing the jsonified version of the session\n    const jsonSession = JSON.parse(JSON.stringify(session));\n    if (session == null) {\n      await this.localStorage.remove(keys.sessionKey);\n    } else {\n      await this.localStorage.save(keys.sessionKey, jsonSession);\n    }\n  }\n\n  async setEncryptedLocalSession(session: Record<string, unknown>, key: SymmetricCryptoKey) {\n    const jsonSession = JSON.stringify(session);\n    const encSession = await this.encryptService.encrypt(jsonSession, key);\n\n    if (encSession == null) {\n      return await this.localStorage.remove(keys.sessionKey);\n    }\n    await this.localStorage.save(keys.sessionKey, encSession.encryptedString);\n  }\n\n  async getSessionEncKey(): Promise<SymmetricCryptoKey> {\n    let storedKey = await this.sessionStorage.get<SymmetricCryptoKey>(keys.encKey);\n    if (storedKey == null || Object.keys(storedKey).length == 0) {\n      const generatedKey = await this.keyGenerationService.createKeyWithPurpose(\n        128,\n        \"ephemeral\",\n        \"bitwarden-ephemeral\",\n      );\n      storedKey = generatedKey.derivedKey;\n      await this.setSessionEncKey(storedKey);\n      return storedKey;\n    } else {\n      return SymmetricCryptoKey.fromJSON(storedKey);\n    }\n  }\n\n  async setSessionEncKey(input: SymmetricCryptoKey): Promise<void> {\n    if (input == null) {\n      await this.sessionStorage.remove(keys.encKey);\n    } else {\n      await this.sessionStorage.save(keys.encKey, input);\n    }\n  }\n}\n","import { devFlagEnabled, DevFlags } from \"../flags\";\n\nexport function devFlag(flag: keyof DevFlags) {\n  return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {\n    const originalMethod = descriptor.value;\n    descriptor.value = function (...args: any[]) {\n      if (!devFlagEnabled(flag)) {\n        throw new Error(\n          `This method should not be called, it is protected by a disabled dev flag.`,\n        );\n      }\n      return originalMethod.apply(this, args);\n    };\n  };\n}\n","import { Subject } from \"rxjs\";\n\nimport {\n  AbstractMemoryStorageService,\n  ObservableStorageService,\n  StorageUpdate,\n} from \"../../abstractions/storage.service\";\n\nexport class MemoryStorageService\n  extends AbstractMemoryStorageService\n  implements ObservableStorageService\n{\n  protected store: Record<string, string> = {};\n  private updatesSubject = new Subject<StorageUpdate>();\n\n  get valuesRequireDeserialization(): boolean {\n    return true;\n  }\n  get updates$() {\n    return this.updatesSubject.asObservable();\n  }\n\n  get<T>(key: string): Promise<T> {\n    const json = this.store[key];\n    if (json) {\n      const obj = JSON.parse(json as string);\n      return Promise.resolve(obj as T);\n    }\n    return Promise.resolve(null);\n  }\n\n  async has(key: string): Promise<boolean> {\n    return (await this.get(key)) != null;\n  }\n\n  save<T>(key: string, obj: T): Promise<void> {\n    if (obj == null) {\n      return this.remove(key);\n    }\n    // TODO: Remove once foreground/background contexts are separated in browser\n    // Needed to ensure ownership of all memory by the context running the storage service\n    this.store[key] = JSON.stringify(obj);\n    this.updatesSubject.next({ key, updateType: \"save\" });\n    return Promise.resolve();\n  }\n\n  remove(key: string): Promise<void> {\n    delete this.store[key];\n    this.updatesSubject.next({ key, updateType: \"remove\" });\n    return Promise.resolve();\n  }\n\n  getBypassCache<T>(key: string): Promise<T> {\n    return this.get<T>(key);\n  }\n}\n","// eslint-disable-next-line import/no-restricted-paths -- Implementation for memory storage specifically for browser backgrounds\nimport { MemoryStorageService } from \"@bitwarden/common/platform/state/storage/memory-storage.service\";\n\nimport { BrowserApi } from \"../browser/browser-api\";\n\nimport { MemoryStoragePortMessage } from \"./port-messages\";\nimport { portName } from \"./port-name\";\n\nexport class BackgroundMemoryStorageService extends MemoryStorageService {\n  private _ports: chrome.runtime.Port[] = [];\n\n  constructor() {\n    super();\n\n    BrowserApi.addListener(chrome.runtime.onConnect, (port) => {\n      if (port.name !== portName(chrome.storage.session)) {\n        return;\n      }\n\n      this._ports.push(port);\n\n      const listenerCallback = this.onMessageFromForeground.bind(this);\n      port.onDisconnect.addListener(() => {\n        this._ports.splice(this._ports.indexOf(port), 1);\n        port.onMessage.removeListener(listenerCallback);\n      });\n      port.onMessage.addListener(listenerCallback);\n      // Initialize the new memory storage service with existing data\n      this.sendMessageTo(port, {\n        action: \"initialization\",\n        data: Array.from(Object.keys(this.store)),\n      });\n    });\n    this.updates$.subscribe((update) => {\n      this.broadcastMessage({\n        action: \"subject_update\",\n        data: update,\n      });\n    });\n  }\n\n  private async onMessageFromForeground(\n    message: MemoryStoragePortMessage,\n    port: chrome.runtime.Port,\n  ) {\n    if (message.originator === \"background\") {\n      return;\n    }\n\n    let result: unknown = null;\n\n    switch (message.action) {\n      case \"get\":\n      case \"getBypassCache\":\n      case \"has\": {\n        result = await this[message.action](message.key);\n        break;\n      }\n      case \"save\":\n        await this.save(message.key, JSON.parse((message.data as string) ?? null) as unknown);\n        break;\n      case \"remove\":\n        await this.remove(message.key);\n        break;\n    }\n\n    this.sendMessageTo(port, {\n      id: message.id,\n      key: message.key,\n      data: JSON.stringify(result),\n    });\n  }\n\n  private broadcastMessage(data: Omit<MemoryStoragePortMessage, \"originator\">) {\n    this._ports.forEach((port) => {\n      this.sendMessageTo(port, data);\n    });\n  }\n\n  private sendMessageTo(\n    port: chrome.runtime.Port,\n    data: Omit<MemoryStoragePortMessage, \"originator\">,\n  ) {\n    port.postMessage({\n      ...data,\n      originator: \"background\",\n    });\n  }\n}\n","export function portName(storageLocation: chrome.storage.StorageArea) {\n  switch (storageLocation) {\n    case chrome.storage.local:\n      return \"local\";\n    case chrome.storage.sync:\n      return \"sync\";\n    case chrome.storage.session:\n      return \"session\";\n    default:\n      throw new Error(\"Unknown storage location\");\n  }\n}\n","import { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { LogLevelType } from \"@bitwarden/common/platform/enums/log-level-type.enum\";\nimport { ConsoleLogService } from \"@bitwarden/common/platform/services/console-log.service\";\n\nimport { FactoryOptions, CachedServices, factory } from \"./factory-options\";\n\ntype LogServiceFactoryOptions = FactoryOptions & {\n  logServiceOptions: {\n    isDev: boolean;\n    filter?: (level: LogLevelType) => boolean;\n  };\n};\n\nexport type LogServiceInitOptions = LogServiceFactoryOptions;\n\nexport function logServiceFactory(\n  cache: { logService?: LogService } & CachedServices,\n  opts: LogServiceInitOptions,\n): Promise<LogService> {\n  return factory(\n    cache,\n    \"logService\",\n    opts,\n    () => new ConsoleLogService(opts.logServiceOptions.isDev, opts.logServiceOptions.filter),\n  );\n}\n","import { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { WebCryptoFunctionService } from \"@bitwarden/common/platform/services/web-crypto-function.service\";\n\nimport { CachedServices, factory, FactoryOptions } from \"./factory-options\";\n\ntype CryptoFunctionServiceFactoryOptions = FactoryOptions & {\n  cryptoFunctionServiceOptions: {\n    win: Window | typeof globalThis;\n  };\n};\n\nexport type CryptoFunctionServiceInitOptions = CryptoFunctionServiceFactoryOptions;\n\nexport function cryptoFunctionServiceFactory(\n  cache: { cryptoFunctionService?: CryptoFunctionService } & CachedServices,\n  opts: CryptoFunctionServiceFactoryOptions,\n): Promise<CryptoFunctionService> {\n  return factory(\n    cache,\n    \"cryptoFunctionService\",\n    opts,\n    () => new WebCryptoFunctionService(opts.cryptoFunctionServiceOptions.win),\n  );\n}\n","import { EncryptServiceImplementation } from \"@bitwarden/common/platform/services/cryptography/encrypt.service.implementation\";\n\nimport {\n  LogServiceInitOptions,\n  logServiceFactory,\n} from \"../../background/service-factories/log-service.factory\";\n\nimport {\n  cryptoFunctionServiceFactory,\n  CryptoFunctionServiceInitOptions,\n} from \"./crypto-function-service.factory\";\nimport { FactoryOptions, CachedServices, factory } from \"./factory-options\";\n\ntype EncryptServiceFactoryOptions = FactoryOptions & {\n  encryptServiceOptions: {\n    logMacFailures: boolean;\n  };\n};\n\nexport type EncryptServiceInitOptions = EncryptServiceFactoryOptions &\n  CryptoFunctionServiceInitOptions &\n  LogServiceInitOptions;\n\nexport function encryptServiceFactory(\n  cache: { encryptService?: EncryptServiceImplementation } & CachedServices,\n  opts: EncryptServiceInitOptions,\n): Promise<EncryptServiceImplementation> {\n  return factory(\n    cache,\n    \"encryptService\",\n    opts,\n    async () =>\n      new EncryptServiceImplementation(\n        await cryptoFunctionServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n        opts.encryptServiceOptions.logMacFailures,\n      ),\n  );\n}\n","import { KeyGenerationService as KeyGenerationServiceAbstraction } from \"@bitwarden/common/platform/abstractions/key-generation.service\";\nimport { KeyGenerationService } from \"@bitwarden/common/platform/services/key-generation.service\";\n\nimport {\n  cryptoFunctionServiceFactory,\n  CryptoFunctionServiceInitOptions,\n} from \"./crypto-function-service.factory\";\nimport { FactoryOptions, CachedServices, factory } from \"./factory-options\";\n\ntype KeyGenerationServiceFactoryOptions = FactoryOptions;\n\nexport type KeyGenerationServiceInitOptions = KeyGenerationServiceFactoryOptions &\n  CryptoFunctionServiceInitOptions;\n\nexport function keyGenerationServiceFactory(\n  cache: { keyGenerationService?: KeyGenerationServiceAbstraction } & CachedServices,\n  opts: KeyGenerationServiceInitOptions,\n): Promise<KeyGenerationServiceAbstraction> {\n  return factory(\n    cache,\n    \"keyGenerationService\",\n    opts,\n    async () => new KeyGenerationService(await cryptoFunctionServiceFactory(cache, opts)),\n  );\n}\n","import {\n  AbstractMemoryStorageService,\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { MemoryStorageService } from \"@bitwarden/common/platform/services/memory-storage.service\";\n\nimport { BrowserApi } from \"../../browser/browser-api\";\nimport BrowserLocalStorageService from \"../../services/browser-local-storage.service\";\nimport { LocalBackedSessionStorageService } from \"../../services/local-backed-session-storage.service\";\nimport { BackgroundMemoryStorageService } from \"../../storage/background-memory-storage.service\";\n\nimport { EncryptServiceInitOptions, encryptServiceFactory } from \"./encrypt-service.factory\";\nimport { CachedServices, factory, FactoryOptions } from \"./factory-options\";\nimport {\n  KeyGenerationServiceInitOptions,\n  keyGenerationServiceFactory,\n} from \"./key-generation-service.factory\";\n\ntype StorageServiceFactoryOptions = FactoryOptions;\n\nexport type DiskStorageServiceInitOptions = StorageServiceFactoryOptions;\nexport type SecureStorageServiceInitOptions = StorageServiceFactoryOptions;\nexport type MemoryStorageServiceInitOptions = StorageServiceFactoryOptions &\n  EncryptServiceInitOptions &\n  KeyGenerationServiceInitOptions;\n\nexport function diskStorageServiceFactory(\n  cache: { diskStorageService?: AbstractStorageService } & CachedServices,\n  opts: DiskStorageServiceInitOptions,\n): Promise<AbstractStorageService> {\n  return factory(cache, \"diskStorageService\", opts, () => new BrowserLocalStorageService());\n}\nexport function observableDiskStorageServiceFactory(\n  cache: {\n    diskStorageService?: AbstractStorageService & ObservableStorageService;\n  } & CachedServices,\n  opts: DiskStorageServiceInitOptions,\n): Promise<AbstractStorageService & ObservableStorageService> {\n  return factory(cache, \"diskStorageService\", opts, () => new BrowserLocalStorageService());\n}\n\nexport function secureStorageServiceFactory(\n  cache: { secureStorageService?: AbstractStorageService } & CachedServices,\n  opts: SecureStorageServiceInitOptions,\n): Promise<AbstractStorageService> {\n  return factory(cache, \"secureStorageService\", opts, () => new BrowserLocalStorageService());\n}\n\nexport function memoryStorageServiceFactory(\n  cache: { memoryStorageService?: AbstractMemoryStorageService } & CachedServices,\n  opts: MemoryStorageServiceInitOptions,\n): Promise<AbstractMemoryStorageService> {\n  return factory(cache, \"memoryStorageService\", opts, async () => {\n    if (BrowserApi.manifestVersion === 3) {\n      return new LocalBackedSessionStorageService(\n        await encryptServiceFactory(cache, opts),\n        await keyGenerationServiceFactory(cache, opts),\n      );\n    }\n    return new MemoryStorageService();\n  });\n}\n\nexport function observableMemoryStorageServiceFactory(\n  cache: {\n    memoryStorageService?: AbstractMemoryStorageService & ObservableStorageService;\n  } & CachedServices,\n  opts: MemoryStorageServiceInitOptions,\n): Promise<AbstractMemoryStorageService & ObservableStorageService> {\n  return factory(cache, \"memoryStorageService\", opts, async () => {\n    return new BackgroundMemoryStorageService();\n  });\n}\n","import { GlobalStateProvider } from \"@bitwarden/common/platform/state\";\n// eslint-disable-next-line import/no-restricted-paths -- We need the implementation to inject, but generally this should not be accessed\nimport { DefaultGlobalStateProvider } from \"@bitwarden/common/platform/state/implementations/default-global-state.provider\";\n\nimport { CachedServices, FactoryOptions, factory } from \"./factory-options\";\nimport {\n  DiskStorageServiceInitOptions,\n  MemoryStorageServiceInitOptions,\n  observableDiskStorageServiceFactory,\n  observableMemoryStorageServiceFactory,\n} from \"./storage-service.factory\";\n\ntype GlobalStateProviderFactoryOptions = FactoryOptions;\n\nexport type GlobalStateProviderInitOptions = GlobalStateProviderFactoryOptions &\n  MemoryStorageServiceInitOptions &\n  DiskStorageServiceInitOptions;\n\nexport async function globalStateProviderFactory(\n  cache: { globalStateProvider?: GlobalStateProvider } & CachedServices,\n  opts: GlobalStateProviderInitOptions,\n): Promise<GlobalStateProvider> {\n  return factory(\n    cache,\n    \"globalStateProvider\",\n    opts,\n    async () =>\n      new DefaultGlobalStateProvider(\n        await observableMemoryStorageServiceFactory(cache, opts),\n        await observableDiskStorageServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\n\nimport { BrowserApi } from \"../browser/browser-api\";\n\nexport default class BrowserMessagingService implements MessagingService {\n  send(subscriber: string, arg: any = {}) {\n    return BrowserApi.sendMessage(subscriber, arg);\n  }\n}\n","import { MessagingService as AbstractMessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\n\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../background/service-factories/factory-options\";\nimport BrowserMessagingService from \"../../services/browser-messaging.service\";\n\ntype MessagingServiceFactoryOptions = FactoryOptions;\n\nexport type MessagingServiceInitOptions = MessagingServiceFactoryOptions;\n\nexport function messagingServiceFactory(\n  cache: { messagingService?: AbstractMessagingService } & CachedServices,\n  opts: MessagingServiceInitOptions,\n): Promise<AbstractMessagingService> {\n  return factory(cache, \"messagingService\", opts, () => new BrowserMessagingService());\n}\n","import { Observable } from \"rxjs\";\n\nimport { UserId } from \"../../types/guid\";\n\nexport type Urls = {\n  base?: string;\n  webVault?: string;\n  api?: string;\n  identity?: string;\n  icons?: string;\n  notifications?: string;\n  events?: string;\n  keyConnector?: string;\n  scim?: string;\n};\n\nexport type PayPalConfig = {\n  businessId?: string;\n  buttonAction?: string;\n};\n\nexport enum Region {\n  US = \"US\",\n  EU = \"EU\",\n  SelfHosted = \"Self-hosted\",\n}\n\nexport enum RegionDomain {\n  US = \"bitwarden.com\",\n  EU = \"bitwarden.eu\",\n  USQA = \"bitwarden.pw\",\n}\n\nexport abstract class EnvironmentService {\n  urls: Observable<void>;\n  usUrls: Urls;\n  euUrls: Urls;\n  selectedRegion?: Region;\n  initialized = true;\n\n  hasBaseUrl: () => boolean;\n  getNotificationsUrl: () => string;\n  getWebVaultUrl: () => string;\n  /**\n   * Retrieves the URL of the cloud web vault app.\n   *\n   * @returns {string} The URL of the cloud web vault app.\n   * @remarks Use this method only in views exclusive to self-host instances.\n   */\n  getCloudWebVaultUrl: () => string;\n  /**\n   * Sets the URL of the cloud web vault app based on the region parameter.\n   *\n   * @param {Region} region - The region of the cloud web vault app.\n   */\n  setCloudWebVaultUrl: (region: Region) => void;\n\n  /**\n   * Seed the environment for a given user based on the globally set defaults.\n   */\n  seedUserEnvironment: (userId: UserId) => Promise<void>;\n\n  getSendUrl: () => string;\n  getIconsUrl: () => string;\n  getApiUrl: () => string;\n  getIdentityUrl: () => string;\n  getEventsUrl: () => string;\n  getKeyConnectorUrl: () => string;\n  getScimUrl: () => string;\n  setUrlsFromStorage: () => Promise<void>;\n  setUrls: (urls: Urls) => Promise<Urls>;\n  getHost: (userId?: string) => Promise<string>;\n  setRegion: (region: Region) => Promise<void>;\n  getUrls: () => Urls;\n  isCloud: () => boolean;\n  isEmpty: () => boolean;\n}\n","import { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { AccountServiceImplementation } from \"@bitwarden/common/auth/services/account.service\";\n\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  GlobalStateProviderInitOptions,\n  globalStateProviderFactory,\n} from \"../../../platform/background/service-factories/global-state-provider.factory\";\nimport {\n  LogServiceInitOptions,\n  logServiceFactory,\n} from \"../../../platform/background/service-factories/log-service.factory\";\nimport {\n  MessagingServiceInitOptions,\n  messagingServiceFactory,\n} from \"../../../platform/background/service-factories/messaging-service.factory\";\n\ntype AccountServiceFactoryOptions = FactoryOptions;\n\nexport type AccountServiceInitOptions = AccountServiceFactoryOptions &\n  MessagingServiceInitOptions &\n  LogServiceInitOptions &\n  GlobalStateProviderInitOptions;\n\nexport function accountServiceFactory(\n  cache: { accountService?: AccountService } & CachedServices,\n  opts: AccountServiceInitOptions,\n): Promise<AccountService> {\n  return factory(\n    cache,\n    \"accountService\",\n    opts,\n    async () =>\n      new AccountServiceImplementation(\n        await messagingServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n        await globalStateProviderFactory(cache, opts),\n      ),\n  );\n}\n","import { LogLevelType } from \"../enums/log-level-type.enum\";\n\nexport abstract class LogService {\n  debug: (message: string) => void;\n  info: (message: string) => void;\n  warning: (message: string) => void;\n  error: (message: string) => void;\n  write: (level: LogLevelType, message: string) => void;\n}\n","import { View } from \"../../../../models/view/view\";\nimport { DeepJsonify } from \"../../../../types/deep-jsonify\";\nimport { SendFile } from \"../domain/send-file\";\n\nexport class SendFileView implements View {\n  id: string = null;\n  size: string = null;\n  sizeName: string = null;\n  fileName: string = null;\n\n  constructor(f?: SendFile) {\n    if (!f) {\n      return;\n    }\n\n    this.id = f.id;\n    this.size = f.size;\n    this.sizeName = f.sizeName;\n  }\n\n  get fileSize(): number {\n    try {\n      if (this.size != null) {\n        return parseInt(this.size, null);\n      }\n    } catch {\n      // Invalid file size.\n    }\n    return 0;\n  }\n\n  static fromJSON(json: DeepJsonify<SendFileView>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new SendFileView(), json);\n  }\n}\n","import { View } from \"../../../../models/view/view\";\nimport { DeepJsonify } from \"../../../../types/deep-jsonify\";\nimport { SendText } from \"../domain/send-text\";\n\nexport class SendTextView implements View {\n  text: string = null;\n  hidden: boolean;\n\n  constructor(t?: SendText) {\n    if (!t) {\n      return;\n    }\n\n    this.hidden = t.hidden;\n  }\n\n  get maskedText(): string {\n    return this.text != null ? \"••••••••\" : null;\n  }\n\n  static fromJSON(json: DeepJsonify<SendTextView>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new SendTextView(), json);\n  }\n}\n","import { View } from \"../../../../models/view/view\";\nimport { Utils } from \"../../../../platform/misc/utils\";\nimport { SymmetricCryptoKey } from \"../../../../platform/models/domain/symmetric-crypto-key\";\nimport { DeepJsonify } from \"../../../../types/deep-jsonify\";\nimport { SendType } from \"../../enums/send-type\";\nimport { Send } from \"../domain/send\";\n\nimport { SendFileView } from \"./send-file.view\";\nimport { SendTextView } from \"./send-text.view\";\n\nexport class SendView implements View {\n  id: string = null;\n  accessId: string = null;\n  name: string = null;\n  notes: string = null;\n  key: Uint8Array;\n  cryptoKey: SymmetricCryptoKey;\n  type: SendType = null;\n  text = new SendTextView();\n  file = new SendFileView();\n  maxAccessCount?: number = null;\n  accessCount = 0;\n  revisionDate: Date = null;\n  deletionDate: Date = null;\n  expirationDate: Date = null;\n  password: string = null;\n  disabled = false;\n  hideEmail = false;\n\n  constructor(s?: Send) {\n    if (!s) {\n      return;\n    }\n\n    this.id = s.id;\n    this.accessId = s.accessId;\n    this.type = s.type;\n    this.maxAccessCount = s.maxAccessCount;\n    this.accessCount = s.accessCount;\n    this.revisionDate = s.revisionDate;\n    this.deletionDate = s.deletionDate;\n    this.expirationDate = s.expirationDate;\n    this.disabled = s.disabled;\n    this.password = s.password;\n    this.hideEmail = s.hideEmail;\n  }\n\n  get urlB64Key(): string {\n    return Utils.fromBufferToUrlB64(this.key);\n  }\n\n  get maxAccessCountReached(): boolean {\n    if (this.maxAccessCount == null) {\n      return false;\n    }\n    return this.accessCount >= this.maxAccessCount;\n  }\n\n  get expired(): boolean {\n    if (this.expirationDate == null) {\n      return false;\n    }\n    return this.expirationDate <= new Date();\n  }\n\n  get pendingDelete(): boolean {\n    return this.deletionDate <= new Date();\n  }\n\n  toJSON() {\n    return Utils.merge(\n      { ...this },\n      {\n        key: Utils.fromBufferToB64(this.key),\n      },\n    );\n  }\n\n  static fromJSON(json: DeepJsonify<SendView>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new SendView(), json, {\n      key: Utils.fromB64ToArray(json.key),\n      cryptoKey: SymmetricCryptoKey.fromJSON(json.cryptoKey),\n      text: SendTextView.fromJSON(json.text),\n      file: SendFileView.fromJSON(json.file),\n      revisionDate: json.revisionDate == null ? null : new Date(json.revisionDate),\n      deletionDate: json.deletionDate == null ? null : new Date(json.deletionDate),\n      expirationDate: json.expirationDate == null ? null : new Date(json.expirationDate),\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Account } from \"./account\";\nimport { GlobalState } from \"./global-state\";\n\nexport class State<\n  TGlobalState extends GlobalState = GlobalState,\n  TAccount extends Account = Account,\n> {\n  accounts: { [userId: string]: TAccount } = {};\n  globals: TGlobalState;\n  activeUserId: string;\n  authenticatedAccounts: string[] = [];\n  accountActivity: { [userId: string]: number } = {};\n\n  constructor(globals: TGlobalState) {\n    this.globals = globals;\n  }\n\n  // TODO, make Jsonify<State,TGlobalState,TAccount> work. It currently doesn't because Globals doesn't implement Jsonify.\n  static fromJSON<TGlobalState extends GlobalState, TAccount extends Account>(\n    obj: any,\n    accountDeserializer: (json: Jsonify<TAccount>) => TAccount,\n  ): State<TGlobalState, TAccount> {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new State(null), obj, {\n      accounts: State.buildAccountMapFromJSON(obj?.accounts, accountDeserializer),\n    });\n  }\n\n  private static buildAccountMapFromJSON<TAccount extends Account>(\n    jsonAccounts: { [userId: string]: Jsonify<TAccount> },\n    accountDeserializer: (json: Jsonify<TAccount>) => TAccount,\n  ) {\n    if (!jsonAccounts) {\n      return {};\n    }\n    const accounts: { [userId: string]: TAccount } = {};\n    for (const userId in jsonAccounts) {\n      accounts[userId] = accountDeserializer(jsonAccounts[userId]);\n    }\n    return accounts;\n  }\n}\n","import { BehaviorSubject, Observable, map } from \"rxjs\";\nimport { Jsonify, JsonValue } from \"type-fest\";\n\nimport { OrganizationData } from \"../../admin-console/models/data/organization.data\";\nimport { PolicyData } from \"../../admin-console/models/data/policy.data\";\nimport { ProviderData } from \"../../admin-console/models/data/provider.data\";\nimport { Policy } from \"../../admin-console/models/domain/policy\";\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { AuthenticationStatus } from \"../../auth/enums/authentication-status\";\nimport { AdminAuthRequestStorable } from \"../../auth/models/domain/admin-auth-req-storable\";\nimport { ForceSetPasswordReason } from \"../../auth/models/domain/force-set-password-reason\";\nimport { KdfConfig } from \"../../auth/models/domain/kdf-config\";\nimport { BiometricKey } from \"../../auth/types/biometric-key\";\nimport { VaultTimeoutAction } from \"../../enums/vault-timeout-action.enum\";\nimport { EventData } from \"../../models/data/event.data\";\nimport { WindowState } from \"../../models/domain/window-state\";\nimport { GeneratorOptions } from \"../../tools/generator/generator-options\";\nimport { GeneratedPasswordHistory, PasswordGeneratorOptions } from \"../../tools/generator/password\";\nimport { UsernameGeneratorOptions } from \"../../tools/generator/username\";\nimport { SendData } from \"../../tools/send/models/data/send.data\";\nimport { SendView } from \"../../tools/send/models/view/send.view\";\nimport { UserId } from \"../../types/guid\";\nimport { DeviceKey, MasterKey } from \"../../types/key\";\nimport { UriMatchType } from \"../../vault/enums\";\nimport { CipherData } from \"../../vault/models/data/cipher.data\";\nimport { LocalData } from \"../../vault/models/data/local.data\";\nimport { CipherView } from \"../../vault/models/view/cipher.view\";\nimport { AddEditCipherInfo } from \"../../vault/types/add-edit-cipher-info\";\nimport { EnvironmentService } from \"../abstractions/environment.service\";\nimport { LogService } from \"../abstractions/log.service\";\nimport {\n  InitOptions,\n  StateService as StateServiceAbstraction,\n} from \"../abstractions/state.service\";\nimport {\n  AbstractMemoryStorageService,\n  AbstractStorageService,\n} from \"../abstractions/storage.service\";\nimport { HtmlStorageLocation, KdfType, StorageLocation, ThemeType } from \"../enums\";\nimport { StateFactory } from \"../factories/state-factory\";\nimport { Utils } from \"../misc/utils\";\nimport { ServerConfigData } from \"../models/data/server-config.data\";\nimport {\n  Account,\n  AccountData,\n  AccountDecryptionOptions,\n  AccountSettings,\n  AccountSettingsSettings,\n} from \"../models/domain/account\";\nimport { EncString } from \"../models/domain/enc-string\";\nimport { GlobalState } from \"../models/domain/global-state\";\nimport { State } from \"../models/domain/state\";\nimport { StorageOptions } from \"../models/domain/storage-options\";\nimport { SymmetricCryptoKey } from \"../models/domain/symmetric-crypto-key\";\n\nimport { MigrationRunner } from \"./migration-runner\";\n\nconst keys = {\n  state: \"state\",\n  stateVersion: \"stateVersion\",\n  global: \"global\",\n  authenticatedAccounts: \"authenticatedAccounts\",\n  activeUserId: \"activeUserId\",\n  tempAccountSettings: \"tempAccountSettings\", // used to hold account specific settings (i.e clear clipboard) between initial migration and first account authentication\n  accountActivity: \"accountActivity\",\n};\n\nconst partialKeys = {\n  userAutoKey: \"_user_auto\",\n  userBiometricKey: \"_user_biometric\",\n\n  autoKey: \"_masterkey_auto\",\n  biometricKey: \"_masterkey_biometric\",\n  masterKey: \"_masterkey\",\n};\n\nconst DDG_SHARED_KEY = \"DuckDuckGoSharedKey\";\n\nexport class StateService<\n  TGlobalState extends GlobalState = GlobalState,\n  TAccount extends Account = Account,\n> implements StateServiceAbstraction<TAccount>\n{\n  protected accountsSubject = new BehaviorSubject<{ [userId: string]: TAccount }>({});\n  accounts$ = this.accountsSubject.asObservable();\n\n  protected activeAccountSubject = new BehaviorSubject<string | null>(null);\n  activeAccount$ = this.activeAccountSubject.asObservable();\n\n  activeAccountUnlocked$: Observable<boolean>;\n\n  private hasBeenInited = false;\n  protected isRecoveredSession = false;\n\n  protected accountDiskCache = new BehaviorSubject<Record<string, TAccount>>({});\n\n  // default account serializer, must be overridden by child class\n  protected accountDeserializer = Account.fromJSON as (json: Jsonify<TAccount>) => TAccount;\n\n  constructor(\n    protected storageService: AbstractStorageService,\n    protected secureStorageService: AbstractStorageService,\n    protected memoryStorageService: AbstractMemoryStorageService,\n    protected logService: LogService,\n    protected stateFactory: StateFactory<TGlobalState, TAccount>,\n    protected accountService: AccountService,\n    protected environmentService: EnvironmentService,\n    private migrationRunner: MigrationRunner,\n    protected useAccountCache: boolean = true,\n  ) {\n    this.activeAccountUnlocked$ = this.accountService.activeAccount$.pipe(\n      map((a) => {\n        return a?.status === AuthenticationStatus.Unlocked;\n      }),\n    );\n  }\n\n  async init(initOptions: InitOptions = {}): Promise<void> {\n    // Deconstruct and apply defaults\n    const { runMigrations = true } = initOptions;\n    if (this.hasBeenInited) {\n      return;\n    }\n\n    if (runMigrations) {\n      await this.migrationRunner.run();\n    } else {\n      // It may have been requested to not run the migrations but we should defensively not\n      // continue this method until migrations have a chance to be completed elsewhere.\n      await this.migrationRunner.waitForCompletion();\n    }\n\n    await this.state().then(async (state) => {\n      if (state == null) {\n        await this.setState(new State<TGlobalState, TAccount>(this.createGlobals()));\n      } else {\n        this.isRecoveredSession = true;\n      }\n    });\n    await this.initAccountState();\n\n    this.hasBeenInited = true;\n  }\n\n  async initAccountState() {\n    if (this.isRecoveredSession) {\n      return;\n    }\n\n    await this.updateState(async (state) => {\n      state.authenticatedAccounts =\n        (await this.storageService.get<string[]>(keys.authenticatedAccounts)) ?? [];\n      for (const i in state.authenticatedAccounts) {\n        if (i != null) {\n          state = await this.syncAccountFromDisk(state.authenticatedAccounts[i]);\n        }\n      }\n      const storedActiveUser = await this.storageService.get<string>(keys.activeUserId);\n      if (storedActiveUser != null) {\n        state.activeUserId = storedActiveUser;\n      }\n      await this.pushAccounts();\n      this.activeAccountSubject.next(state.activeUserId);\n      // TODO: Temporary update to avoid routing all account status changes through account service for now.\n      // account service tracks logged out accounts, but State service does not, so we need to add the active account\n      // if it's not in the accounts list.\n      if (state.activeUserId != null && this.accountsSubject.value[state.activeUserId] == null) {\n        const activeDiskAccount = await this.getAccountFromDisk({ userId: state.activeUserId });\n        await this.accountService.addAccount(state.activeUserId as UserId, {\n          name: activeDiskAccount.profile.name,\n          email: activeDiskAccount.profile.email,\n          status: AuthenticationStatus.LoggedOut,\n        });\n      }\n      await this.accountService.switchAccount(state.activeUserId as UserId);\n      // End TODO\n\n      return state;\n    });\n  }\n\n  async syncAccountFromDisk(userId: string): Promise<State<TGlobalState, TAccount>> {\n    if (userId == null) {\n      return;\n    }\n    const diskAccount = await this.getAccountFromDisk({ userId: userId });\n    const state = await this.updateState(async (state) => {\n      if (state.accounts == null) {\n        state.accounts = {};\n      }\n      state.accounts[userId] = this.createAccount();\n      state.accounts[userId].profile = diskAccount.profile;\n      return state;\n    });\n\n    // TODO: Temporary update to avoid routing all account status changes through account service for now.\n    // The determination of state should be handled by the various services that control those values.\n    const token = await this.getAccessToken({ userId: userId });\n    const autoKey = await this.getUserKeyAutoUnlock({ userId: userId });\n    const accountStatus =\n      token == null\n        ? AuthenticationStatus.LoggedOut\n        : autoKey == null\n          ? AuthenticationStatus.Locked\n          : AuthenticationStatus.Unlocked;\n    await this.accountService.addAccount(userId as UserId, {\n      status: accountStatus,\n      name: diskAccount.profile.name,\n      email: diskAccount.profile.email,\n    });\n\n    return state;\n  }\n\n  async addAccount(account: TAccount) {\n    await this.environmentService.seedUserEnvironment(account.profile.userId as UserId);\n    await this.updateState(async (state) => {\n      state.authenticatedAccounts.push(account.profile.userId);\n      await this.storageService.save(keys.authenticatedAccounts, state.authenticatedAccounts);\n      state.accounts[account.profile.userId] = account;\n      return state;\n    });\n    await this.scaffoldNewAccountStorage(account);\n    await this.setLastActive(new Date().getTime(), { userId: account.profile.userId });\n    // TODO: Temporary update to avoid routing all account status changes through account service for now.\n    await this.accountService.addAccount(account.profile.userId as UserId, {\n      status: AuthenticationStatus.Locked,\n      name: account.profile.name,\n      email: account.profile.email,\n    });\n    await this.setActiveUser(account.profile.userId);\n  }\n\n  async setActiveUser(userId: string): Promise<void> {\n    await this.clearDecryptedDataForActiveUser();\n    await this.updateState(async (state) => {\n      state.activeUserId = userId;\n      await this.storageService.save(keys.activeUserId, userId);\n      this.activeAccountSubject.next(state.activeUserId);\n      // TODO: temporary update to avoid routing all account status changes through account service for now.\n      await this.accountService.switchAccount(userId as UserId);\n\n      return state;\n    });\n\n    await this.pushAccounts();\n  }\n\n  async clean(options?: StorageOptions): Promise<UserId> {\n    options = this.reconcileOptions(options, await this.defaultInMemoryOptions());\n    await this.deAuthenticateAccount(options.userId);\n    let currentUser = (await this.state())?.activeUserId;\n    if (options.userId === currentUser) {\n      currentUser = await this.dynamicallySetActiveUser();\n    }\n\n    await this.removeAccountFromDisk(options?.userId);\n    await this.removeAccountFromMemory(options?.userId);\n    await this.pushAccounts();\n    return currentUser as UserId;\n  }\n\n  async getAccessToken(options?: StorageOptions): Promise<string> {\n    options = await this.getTimeoutBasedStorageOptions(options);\n    return (await this.getAccount(options))?.tokens?.accessToken;\n  }\n\n  async setAccessToken(value: string, options?: StorageOptions): Promise<void> {\n    options = await this.getTimeoutBasedStorageOptions(options);\n    const account = await this.getAccount(options);\n    account.tokens.accessToken = value;\n    await this.saveAccount(account, options);\n  }\n\n  async getAddEditCipherInfo(options?: StorageOptions): Promise<AddEditCipherInfo> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    // ensure prototype on cipher\n    const raw = account?.data?.addEditCipherInfo;\n    return raw == null\n      ? null\n      : {\n          cipher:\n            raw?.cipher.toJSON != null\n              ? raw.cipher\n              : CipherView.fromJSON(raw?.cipher as Jsonify<CipherView>),\n          collectionIds: raw?.collectionIds,\n        };\n  }\n\n  async setAddEditCipherInfo(value: AddEditCipherInfo, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.data.addEditCipherInfo = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getAlwaysShowDock(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.alwaysShowDock ?? false\n    );\n  }\n\n  async setAlwaysShowDock(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.alwaysShowDock = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getApiKeyClientId(options?: StorageOptions): Promise<string> {\n    options = await this.getTimeoutBasedStorageOptions(options);\n    return (await this.getAccount(options))?.profile?.apiKeyClientId;\n  }\n\n  async setApiKeyClientId(value: string, options?: StorageOptions): Promise<void> {\n    options = await this.getTimeoutBasedStorageOptions(options);\n    const account = await this.getAccount(options);\n    account.profile.apiKeyClientId = value;\n    await this.saveAccount(account, options);\n  }\n\n  async getApiKeyClientSecret(options?: StorageOptions): Promise<string> {\n    options = await this.getTimeoutBasedStorageOptions(options);\n    return (await this.getAccount(options))?.keys?.apiKeyClientSecret;\n  }\n\n  async setApiKeyClientSecret(value: string, options?: StorageOptions): Promise<void> {\n    options = await this.getTimeoutBasedStorageOptions(options);\n    const account = await this.getAccount(options);\n    account.keys.apiKeyClientSecret = value;\n    await this.saveAccount(account, options);\n  }\n\n  async getAutoConfirmFingerPrints(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.settings?.autoConfirmFingerPrints ?? false\n    );\n  }\n\n  async setAutoConfirmFingerprints(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.autoConfirmFingerPrints = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getBiometricFingerprintValidated(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.biometricFingerprintValidated ?? false\n    );\n  }\n\n  async setBiometricFingerprintValidated(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.biometricFingerprintValidated = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getBiometricUnlock(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.settings?.biometricUnlock ?? false\n    );\n  }\n\n  async setBiometricUnlock(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.biometricUnlock = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getCanAccessPremium(options?: StorageOptions): Promise<boolean> {\n    if (!(await this.getIsAuthenticated(options))) {\n      return false;\n    }\n\n    return (\n      (await this.getHasPremiumPersonally(options)) ||\n      (await this.getHasPremiumFromOrganization(options))\n    );\n  }\n\n  async getHasPremiumPersonally(options?: StorageOptions): Promise<boolean> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    return account?.profile?.hasPremiumPersonally;\n  }\n\n  async setHasPremiumPersonally(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.profile.hasPremiumPersonally = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getHasPremiumFromOrganization(options?: StorageOptions): Promise<boolean> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n\n    if (account.profile?.hasPremiumFromOrganization) {\n      return true;\n    }\n\n    // TODO: older server versions won't send the hasPremiumFromOrganization flag, so we're keeping the old logic\n    // for backwards compatibility. It can be removed after everyone has upgraded.\n    const organizations = await this.getOrganizations(options);\n    if (organizations == null) {\n      return false;\n    }\n\n    for (const id of Object.keys(organizations)) {\n      const o = organizations[id];\n      if (o.enabled && o.usersGetPremium && !o.isProviderUser) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  async setHasPremiumFromOrganization(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.profile.hasPremiumFromOrganization = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getConvertAccountToKeyConnector(options?: StorageOptions): Promise<boolean> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.profile?.convertAccountToKeyConnector;\n  }\n\n  async setConvertAccountToKeyConnector(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.profile.convertAccountToKeyConnector = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  /**\n   * @deprecated Do not save the Master Key. Use the User Symmetric Key instead\n   */\n  async getCryptoMasterKey(options?: StorageOptions): Promise<SymmetricCryptoKey> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    return account?.keys?.cryptoMasterKey;\n  }\n\n  /**\n   * User's master key derived from MP, saved only if we decrypted with MP\n   */\n  async getMasterKey(options?: StorageOptions): Promise<MasterKey> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    return account?.keys?.masterKey;\n  }\n\n  /**\n   * User's master key derived from MP, saved only if we decrypted with MP\n   */\n  async setMasterKey(value: MasterKey, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.keys.masterKey = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  /**\n   * The master key encrypted User symmetric key, saved on every auth\n   * so we can unlock with MP offline\n   */\n  async getMasterKeyEncryptedUserKey(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.keys.masterKeyEncryptedUserKey;\n  }\n\n  /**\n   * The master key encrypted User symmetric key, saved on every auth\n   * so we can unlock with MP offline\n   */\n  async setMasterKeyEncryptedUserKey(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.keys.masterKeyEncryptedUserKey = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  /**\n   * user key when using the \"never\" option of vault timeout\n   */\n  async getUserKeyAutoUnlock(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"auto\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(\n      `${options.userId}${partialKeys.userAutoKey}`,\n      options,\n    );\n  }\n\n  /**\n   * user key when using the \"never\" option of vault timeout\n   */\n  async setUserKeyAutoUnlock(value: string, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"auto\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.userAutoKey, value, options);\n  }\n\n  /**\n   * User's encrypted symmetric key when using biometrics\n   */\n  async getUserKeyBiometric(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(\n      `${options.userId}${partialKeys.userBiometricKey}`,\n      options,\n    );\n  }\n\n  async hasUserKeyBiometric(options?: StorageOptions): Promise<boolean> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return false;\n    }\n    return await this.secureStorageService.has(\n      `${options.userId}${partialKeys.userBiometricKey}`,\n      options,\n    );\n  }\n\n  async setUserKeyBiometric(value: BiometricKey, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.userBiometricKey, value, options);\n  }\n\n  async getPinKeyEncryptedUserKey(options?: StorageOptions): Promise<EncString> {\n    return EncString.fromJSON(\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.settings?.pinKeyEncryptedUserKey,\n    );\n  }\n\n  async setPinKeyEncryptedUserKey(value: EncString, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.pinKeyEncryptedUserKey = value?.encryptedString;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getPinKeyEncryptedUserKeyEphemeral(options?: StorageOptions): Promise<EncString> {\n    return EncString.fromJSON(\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions())))\n        ?.settings?.pinKeyEncryptedUserKeyEphemeral,\n    );\n  }\n\n  async setPinKeyEncryptedUserKeyEphemeral(\n    value: EncString,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.settings.pinKeyEncryptedUserKeyEphemeral = value?.encryptedString;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  /**\n   * @deprecated Use UserKeyAuto instead\n   */\n  async getCryptoMasterKeyAuto(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"auto\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(\n      `${options.userId}${partialKeys.autoKey}`,\n      options,\n    );\n  }\n\n  /**\n   * @deprecated Use UserKeyAuto instead\n   */\n  async setCryptoMasterKeyAuto(value: string, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"auto\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.autoKey, value, options);\n  }\n\n  /**\n   * @deprecated I don't see where this is even used\n   */\n  async getCryptoMasterKeyB64(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(options, await this.defaultSecureStorageOptions());\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(\n      `${options?.userId}${partialKeys.masterKey}`,\n      options,\n    );\n  }\n\n  /**\n   * @deprecated I don't see where this is even used\n   */\n  async setCryptoMasterKeyB64(value: string, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultSecureStorageOptions());\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.masterKey, value, options);\n  }\n\n  /**\n   * @deprecated Use UserKeyBiometric instead\n   */\n  async getCryptoMasterKeyBiometric(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(\n      `${options.userId}${partialKeys.biometricKey}`,\n      options,\n    );\n  }\n\n  /**\n   * @deprecated Use UserKeyBiometric instead\n   */\n  async hasCryptoMasterKeyBiometric(options?: StorageOptions): Promise<boolean> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return false;\n    }\n    return await this.secureStorageService.has(\n      `${options.userId}${partialKeys.biometricKey}`,\n      options,\n    );\n  }\n\n  /**\n   * @deprecated Use UserKeyBiometric instead\n   */\n  async setCryptoMasterKeyBiometric(value: BiometricKey, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(\n      this.reconcileOptions(options, { keySuffix: \"biometric\" }),\n      await this.defaultSecureStorageOptions(),\n    );\n    if (options?.userId == null) {\n      return;\n    }\n    await this.saveSecureStorageKey(partialKeys.biometricKey, value, options);\n  }\n\n  @withPrototypeForArrayMembers(CipherView, CipherView.fromJSON)\n  async getDecryptedCiphers(options?: StorageOptions): Promise<CipherView[]> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.data?.ciphers?.decrypted;\n  }\n\n  async setDecryptedCiphers(value: CipherView[], options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.data.ciphers.decrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  @withPrototypeForArrayMembers(GeneratedPasswordHistory)\n  async getDecryptedPasswordGenerationHistory(\n    options?: StorageOptions,\n  ): Promise<GeneratedPasswordHistory[]> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.data?.passwordGenerationHistory?.decrypted;\n  }\n\n  async setDecryptedPasswordGenerationHistory(\n    value: GeneratedPasswordHistory[],\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.data.passwordGenerationHistory.decrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  /**\n   * @deprecated Use getPinKeyEncryptedUserKeyEphemeral instead\n   */\n  async getDecryptedPinProtected(options?: StorageOptions): Promise<EncString> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.settings?.pinProtected?.decrypted;\n  }\n\n  /**\n   * @deprecated Use setPinKeyEncryptedUserKeyEphemeral instead\n   */\n  async setDecryptedPinProtected(value: EncString, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.settings.pinProtected.decrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  @withPrototypeForArrayMembers(Policy)\n  async getDecryptedPolicies(options?: StorageOptions): Promise<Policy[]> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.data?.policies?.decrypted;\n  }\n\n  async setDecryptedPolicies(value: Policy[], options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.data.policies.decrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  @withPrototypeForArrayMembers(SendView)\n  async getDecryptedSends(options?: StorageOptions): Promise<SendView[]> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.data?.sends?.decrypted;\n  }\n\n  async setDecryptedSends(value: SendView[], options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.data.sends.decrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getDefaultUriMatch(options?: StorageOptions): Promise<UriMatchType> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.settings?.defaultUriMatch;\n  }\n\n  async setDefaultUriMatch(value: UriMatchType, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.defaultUriMatch = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getDisableAddLoginNotification(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.disableAddLoginNotification ?? false\n    );\n  }\n\n  async setDisableAddLoginNotification(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.disableAddLoginNotification = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getDisableBadgeCounter(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.settings?.disableBadgeCounter ?? false\n    );\n  }\n\n  async setDisableBadgeCounter(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.disableBadgeCounter = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getDisableChangedPasswordNotification(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.disableChangedPasswordNotification ?? false\n    );\n  }\n\n  async setDisableChangedPasswordNotification(\n    value: boolean,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.disableChangedPasswordNotification = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getDisableContextMenuItem(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.disableContextMenuItem ?? false\n    );\n  }\n\n  async setDisableContextMenuItem(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.disableContextMenuItem = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getDisableFavicon(options?: StorageOptions): Promise<boolean> {\n    return (\n      (\n        await this.getGlobals(\n          this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n        )\n      )?.disableFavicon ?? false\n    );\n  }\n\n  async setDisableFavicon(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    globals.disableFavicon = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getDisableGa(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.settings?.disableGa ?? false\n    );\n  }\n\n  async setDisableGa(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.disableGa = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getDontShowCardsCurrentTab(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.settings?.dontShowCardsCurrentTab ?? false\n    );\n  }\n\n  async setDontShowCardsCurrentTab(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.dontShowCardsCurrentTab = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getDontShowIdentitiesCurrentTab(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.settings?.dontShowIdentitiesCurrentTab ?? false\n    );\n  }\n\n  async setDontShowIdentitiesCurrentTab(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.dontShowIdentitiesCurrentTab = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getDuckDuckGoSharedKey(options?: StorageOptions): Promise<string> {\n    options = this.reconcileOptions(options, await this.defaultSecureStorageOptions());\n    if (options?.userId == null) {\n      return null;\n    }\n    return await this.secureStorageService.get<string>(DDG_SHARED_KEY, options);\n  }\n\n  async setDuckDuckGoSharedKey(value: string, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultSecureStorageOptions());\n    if (options?.userId == null) {\n      return;\n    }\n    value == null\n      ? await this.secureStorageService.remove(DDG_SHARED_KEY, options)\n      : await this.secureStorageService.save(DDG_SHARED_KEY, value, options);\n  }\n\n  async getDeviceKey(options?: StorageOptions): Promise<DeviceKey | null> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskLocalOptions());\n\n    if (options?.userId == null) {\n      return null;\n    }\n\n    const account = await this.getAccount(options);\n\n    const existingDeviceKey = account?.keys?.deviceKey;\n\n    // Must manually instantiate the SymmetricCryptoKey class from the JSON object\n    if (existingDeviceKey != null) {\n      return SymmetricCryptoKey.fromJSON(existingDeviceKey) as DeviceKey;\n    } else {\n      return null;\n    }\n  }\n\n  async setDeviceKey(value: DeviceKey | null, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskLocalOptions());\n\n    if (options?.userId == null) {\n      return;\n    }\n\n    const account = await this.getAccount(options);\n\n    account.keys.deviceKey = value?.toJSON() ?? null;\n\n    await this.saveAccount(account, options);\n  }\n\n  async getAdminAuthRequest(options?: StorageOptions): Promise<AdminAuthRequestStorable | null> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskLocalOptions());\n\n    if (options?.userId == null) {\n      return null;\n    }\n\n    const account = await this.getAccount(options);\n\n    return account?.adminAuthRequest\n      ? AdminAuthRequestStorable.fromJSON(account.adminAuthRequest)\n      : null;\n  }\n\n  async setAdminAuthRequest(\n    adminAuthRequest: AdminAuthRequestStorable,\n    options?: StorageOptions,\n  ): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskLocalOptions());\n\n    if (options?.userId == null) {\n      return;\n    }\n\n    const account = await this.getAccount(options);\n\n    account.adminAuthRequest = adminAuthRequest?.toJSON();\n\n    await this.saveAccount(account, options);\n  }\n\n  async getShouldTrustDevice(options?: StorageOptions): Promise<boolean | null> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskLocalOptions());\n\n    if (options?.userId == null) {\n      return null;\n    }\n\n    const account = await this.getAccount(options);\n\n    return account?.settings?.trustDeviceChoiceForDecryption ?? null;\n  }\n\n  async setShouldTrustDevice(value: boolean, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskLocalOptions());\n    if (options?.userId == null) {\n      return;\n    }\n\n    const account = await this.getAccount(options);\n\n    account.settings.trustDeviceChoiceForDecryption = value;\n\n    await this.saveAccount(account, options);\n  }\n\n  async getAccountDecryptionOptions(\n    options?: StorageOptions,\n  ): Promise<AccountDecryptionOptions | null> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskLocalOptions());\n\n    if (options?.userId == null) {\n      return null;\n    }\n\n    const account = await this.getAccount(options);\n\n    return account?.decryptionOptions as AccountDecryptionOptions;\n  }\n\n  async setAccountDecryptionOptions(\n    value: AccountDecryptionOptions,\n    options?: StorageOptions,\n  ): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskLocalOptions());\n\n    if (options?.userId == null) {\n      return;\n    }\n\n    const account = await this.getAccount(options);\n\n    account.decryptionOptions = value;\n\n    await this.saveAccount(account, options);\n  }\n\n  async getEmail(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.profile?.email;\n  }\n\n  async setEmail(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.profile.email = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getEmailVerified(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.profile.emailVerified ?? false\n    );\n  }\n\n  async setEmailVerified(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.profile.emailVerified = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEnableAlwaysOnTop(options?: StorageOptions): Promise<boolean> {\n    const accountPreference = (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.settings?.enableAlwaysOnTop;\n    const globalPreference = (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.enableAlwaysOnTop;\n    return accountPreference ?? globalPreference ?? false;\n  }\n\n  async setEnableAlwaysOnTop(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.enableAlwaysOnTop = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableAlwaysOnTop = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEnableBrowserIntegration(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.enableBrowserIntegration ?? false\n    );\n  }\n\n  async setEnableBrowserIntegration(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableBrowserIntegration = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEnableBrowserIntegrationFingerprint(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.enableBrowserIntegrationFingerprint ?? false\n    );\n  }\n\n  async setEnableBrowserIntegrationFingerprint(\n    value: boolean,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableBrowserIntegrationFingerprint = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEnableCloseToTray(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.enableCloseToTray ?? false\n    );\n  }\n\n  async setEnableCloseToTray(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableCloseToTray = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEnableDuckDuckGoBrowserIntegration(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.enableDuckDuckGoBrowserIntegration ?? false\n    );\n  }\n\n  async setEnableDuckDuckGoBrowserIntegration(\n    value: boolean,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableDuckDuckGoBrowserIntegration = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEnableMinimizeToTray(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.enableMinimizeToTray ?? false\n    );\n  }\n\n  async setEnableMinimizeToTray(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableMinimizeToTray = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEnableStartToTray(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.enableStartToTray ?? false\n    );\n  }\n\n  async setEnableStartToTray(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableStartToTray = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEnableTray(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.enableTray ?? false\n    );\n  }\n\n  async setEnableTray(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.enableTray = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  @withPrototypeForObjectValues(CipherData)\n  async getEncryptedCiphers(options?: StorageOptions): Promise<{ [id: string]: CipherData }> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()))\n    )?.data?.ciphers?.encrypted;\n  }\n\n  async setEncryptedCiphers(\n    value: { [id: string]: CipherData },\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n    account.data.ciphers.encrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n  }\n\n  /**\n   * @deprecated Use UserKey instead\n   */\n  async getEncryptedCryptoSymmetricKey(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.keys.cryptoSymmetricKey.encrypted;\n  }\n\n  @withPrototypeForArrayMembers(GeneratedPasswordHistory)\n  async getEncryptedPasswordGenerationHistory(\n    options?: StorageOptions,\n  ): Promise<GeneratedPasswordHistory[]> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.data?.passwordGenerationHistory?.encrypted;\n  }\n\n  async setEncryptedPasswordGenerationHistory(\n    value: GeneratedPasswordHistory[],\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.data.passwordGenerationHistory.encrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEncryptedPinProtected(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.settings?.pinProtected?.encrypted;\n  }\n\n  async setEncryptedPinProtected(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.pinProtected.encrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  @withPrototypeForObjectValues(PolicyData)\n  async getEncryptedPolicies(options?: StorageOptions): Promise<{ [id: string]: PolicyData }> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.data?.policies?.encrypted;\n  }\n\n  async setEncryptedPolicies(\n    value: { [id: string]: PolicyData },\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.data.policies.encrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  @withPrototypeForObjectValues(SendData)\n  async getEncryptedSends(options?: StorageOptions): Promise<{ [id: string]: SendData }> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()))\n    )?.data?.sends.encrypted;\n  }\n\n  async setEncryptedSends(\n    value: { [id: string]: SendData },\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n    account.data.sends.encrypted = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n  }\n\n  async getEquivalentDomains(options?: StorageOptions): Promise<string[][]> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.settings?.equivalentDomains;\n  }\n\n  async setEquivalentDomains(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.equivalentDomains = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  @withPrototypeForArrayMembers(EventData)\n  async getEventCollection(options?: StorageOptions): Promise<EventData[]> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.data?.eventCollection;\n  }\n\n  async setEventCollection(value: EventData[], options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.data.eventCollection = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getEverBeenUnlocked(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions())))\n        ?.profile?.everBeenUnlocked ?? false\n    );\n  }\n\n  async setEverBeenUnlocked(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.profile.everBeenUnlocked = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getForceSetPasswordReason(options?: StorageOptions): Promise<ForceSetPasswordReason> {\n    return (\n      (\n        await this.getAccount(\n          this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n        )\n      )?.profile?.forceSetPasswordReason ?? ForceSetPasswordReason.None\n    );\n  }\n\n  async setForceSetPasswordReason(\n    value: ForceSetPasswordReason,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n    account.profile.forceSetPasswordReason = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n  }\n\n  async getInstalledVersion(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.installedVersion;\n  }\n\n  async setInstalledVersion(value: string, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.installedVersion = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getIsAuthenticated(options?: StorageOptions): Promise<boolean> {\n    return (await this.getAccessToken(options)) != null && (await this.getUserId(options)) != null;\n  }\n\n  async getKdfConfig(options?: StorageOptions): Promise<KdfConfig> {\n    const iterations = (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.profile?.kdfIterations;\n    const memory = (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.profile?.kdfMemory;\n    const parallelism = (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.profile?.kdfParallelism;\n    return new KdfConfig(iterations, memory, parallelism);\n  }\n\n  async setKdfConfig(config: KdfConfig, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.profile.kdfIterations = config.iterations;\n    account.profile.kdfMemory = config.memory;\n    account.profile.kdfParallelism = config.parallelism;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getKdfType(options?: StorageOptions): Promise<KdfType> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.profile?.kdfType;\n  }\n\n  async setKdfType(value: KdfType, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.profile.kdfType = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getKeyHash(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.profile?.keyHash;\n  }\n\n  async setKeyHash(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.profile.keyHash = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getLastActive(options?: StorageOptions): Promise<number> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskOptions());\n\n    const accountActivity = await this.storageService.get<{ [userId: string]: number }>(\n      keys.accountActivity,\n      options,\n    );\n\n    if (accountActivity == null || Object.keys(accountActivity).length < 1) {\n      return null;\n    }\n\n    return accountActivity[options.userId];\n  }\n\n  async setLastActive(value: number, options?: StorageOptions): Promise<void> {\n    options = this.reconcileOptions(options, await this.defaultOnDiskOptions());\n    if (options.userId == null) {\n      return;\n    }\n    const accountActivity =\n      (await this.storageService.get<{ [userId: string]: number }>(\n        keys.accountActivity,\n        options,\n      )) ?? {};\n    accountActivity[options.userId] = value;\n    await this.storageService.save(keys.accountActivity, accountActivity, options);\n  }\n\n  async getLastSync(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()))\n    )?.profile?.lastSync;\n  }\n\n  async setLastSync(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n    account.profile.lastSync = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n  }\n\n  async getLocalData(options?: StorageOptions): Promise<{ [cipherId: string]: LocalData }> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.data?.localData;\n  }\n\n  async setLocalData(\n    value: { [cipherId: string]: LocalData },\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.data.localData = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getLocale(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.locale;\n  }\n\n  async setLocale(value: string, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    globals.locale = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getMainWindowSize(options?: StorageOptions): Promise<number> {\n    return (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.mainWindowSize;\n  }\n\n  async setMainWindowSize(value: number, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    globals.mainWindowSize = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getMinimizeOnCopyToClipboard(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.settings?.minimizeOnCopyToClipboard ?? false\n    );\n  }\n\n  async setMinimizeOnCopyToClipboard(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.minimizeOnCopyToClipboard = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getNeverDomains(options?: StorageOptions): Promise<{ [id: string]: unknown }> {\n    return (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.neverDomains;\n  }\n\n  async setNeverDomains(value: { [id: string]: unknown }, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.neverDomains = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getOpenAtLogin(options?: StorageOptions): Promise<boolean> {\n    return (\n      (await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions())))\n        ?.openAtLogin ?? false\n    );\n  }\n\n  async setOpenAtLogin(value: boolean, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.openAtLogin = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getOrganizationInvitation(options?: StorageOptions): Promise<any> {\n    return (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.organizationInvitation;\n  }\n\n  async setOrganizationInvitation(value: any, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    globals.organizationInvitation = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  /**\n   * @deprecated Do not call this directly, use OrganizationService\n   */\n  async getOrganizations(options?: StorageOptions): Promise<{ [id: string]: OrganizationData }> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.data?.organizations;\n  }\n\n  /**\n   * @deprecated Do not call this directly, use OrganizationService\n   */\n  async setOrganizations(\n    value: { [id: string]: OrganizationData },\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.data.organizations = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getPasswordGenerationOptions(options?: StorageOptions): Promise<PasswordGeneratorOptions> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.passwordGenerationOptions;\n  }\n\n  async setPasswordGenerationOptions(\n    value: PasswordGeneratorOptions,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.passwordGenerationOptions = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getUsernameGenerationOptions(options?: StorageOptions): Promise<UsernameGeneratorOptions> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.usernameGenerationOptions;\n  }\n\n  async setUsernameGenerationOptions(\n    value: UsernameGeneratorOptions,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.usernameGenerationOptions = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getGeneratorOptions(options?: StorageOptions): Promise<GeneratorOptions> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.generatorOptions;\n  }\n\n  async setGeneratorOptions(value: GeneratorOptions, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.generatorOptions = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getProtectedPin(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.settings?.protectedPin;\n  }\n\n  async setProtectedPin(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.settings.protectedPin = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  @withPrototypeForObjectValues(ProviderData)\n  async getProviders(options?: StorageOptions): Promise<{ [id: string]: ProviderData }> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.data?.providers;\n  }\n\n  async setProviders(\n    value: { [id: string]: ProviderData },\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.data.providers = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getRefreshToken(options?: StorageOptions): Promise<string> {\n    options = await this.getTimeoutBasedStorageOptions(options);\n    return (await this.getAccount(options))?.tokens?.refreshToken;\n  }\n\n  async setRefreshToken(value: string, options?: StorageOptions): Promise<void> {\n    options = await this.getTimeoutBasedStorageOptions(options);\n    const account = await this.getAccount(options);\n    account.tokens.refreshToken = value;\n    await this.saveAccount(account, options);\n  }\n\n  async getRememberedEmail(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.rememberedEmail;\n  }\n\n  async setRememberedEmail(value: string, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    globals.rememberedEmail = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getSecurityStamp(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.tokens?.securityStamp;\n  }\n\n  async setSecurityStamp(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.tokens.securityStamp = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getSettings(options?: StorageOptions): Promise<AccountSettingsSettings> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()))\n    )?.settings?.settings;\n  }\n\n  async setSettings(value: AccountSettingsSettings, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n    account.settings.settings = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskMemoryOptions()),\n    );\n  }\n\n  async getTheme(options?: StorageOptions): Promise<ThemeType> {\n    return (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.theme;\n  }\n\n  async setTheme(value: ThemeType, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    globals.theme = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getTwoFactorToken(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.twoFactorToken;\n  }\n\n  async setTwoFactorToken(value: string, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    globals.twoFactorToken = value;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getUserId(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.profile?.userId;\n  }\n\n  async getUsesKeyConnector(options?: StorageOptions): Promise<boolean> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.profile?.usesKeyConnector;\n  }\n\n  async setUsesKeyConnector(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    account.profile.usesKeyConnector = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async getVaultTimeout(options?: StorageOptions): Promise<number> {\n    const accountVaultTimeout = (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.vaultTimeout;\n    return accountVaultTimeout;\n  }\n\n  async setVaultTimeout(value: number, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.vaultTimeout = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getVaultTimeoutAction(options?: StorageOptions): Promise<string> {\n    const accountVaultTimeoutAction = (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.vaultTimeoutAction;\n    return (\n      accountVaultTimeoutAction ??\n      (\n        await this.getGlobals(\n          this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n        )\n      )?.vaultTimeoutAction\n    );\n  }\n\n  async setVaultTimeoutAction(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.vaultTimeoutAction = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getApproveLoginRequests(options?: StorageOptions): Promise<boolean> {\n    const approveLoginRequests = (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.approveLoginRequests;\n    return approveLoginRequests;\n  }\n\n  async setApproveLoginRequests(value: boolean, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.approveLoginRequests = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getWindow(): Promise<WindowState> {\n    const globals = await this.getGlobals(await this.defaultOnDiskOptions());\n    return globals?.window != null && Object.keys(globals.window).length > 0\n      ? globals.window\n      : new WindowState();\n  }\n\n  async setWindow(value: WindowState, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.window = value;\n    return await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  async setServerConfig(value: ServerConfigData, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.serverConfig = value;\n    return await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getServerConfig(options: StorageOptions): Promise<ServerConfigData> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.serverConfig;\n  }\n\n  async getAvatarColor(options?: StorageOptions): Promise<string | null | undefined> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()))\n    )?.settings?.avatarColor;\n  }\n\n  async setAvatarColor(value: string, options?: StorageOptions): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n    account.settings.avatarColor = value;\n    return await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  async getDeepLinkRedirectUrl(options?: StorageOptions): Promise<string> {\n    return (\n      await this.getGlobals(this.reconcileOptions(options, await this.defaultOnDiskOptions()))\n    )?.deepLinkRedirectUrl;\n  }\n\n  async setDeepLinkRedirectUrl(url: string, options?: StorageOptions): Promise<void> {\n    const globals = await this.getGlobals(\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n    globals.deepLinkRedirectUrl = url;\n    await this.saveGlobals(\n      globals,\n      this.reconcileOptions(options, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  protected async getGlobals(options: StorageOptions): Promise<TGlobalState> {\n    let globals: TGlobalState;\n    if (this.useMemory(options.storageLocation)) {\n      globals = await this.getGlobalsFromMemory();\n    }\n\n    if (this.useDisk && globals == null) {\n      globals = await this.getGlobalsFromDisk(options);\n    }\n\n    if (globals == null) {\n      globals = this.createGlobals();\n    }\n\n    return globals;\n  }\n\n  protected async saveGlobals(globals: TGlobalState, options: StorageOptions) {\n    return this.useMemory(options.storageLocation)\n      ? this.saveGlobalsToMemory(globals)\n      : await this.saveGlobalsToDisk(globals, options);\n  }\n\n  protected async getGlobalsFromMemory(): Promise<TGlobalState> {\n    return (await this.state()).globals;\n  }\n\n  protected async getGlobalsFromDisk(options: StorageOptions): Promise<TGlobalState> {\n    return await this.storageService.get<TGlobalState>(keys.global, options);\n  }\n\n  protected async saveGlobalsToMemory(globals: TGlobalState): Promise<void> {\n    await this.updateState(async (state) => {\n      state.globals = globals;\n      return state;\n    });\n  }\n\n  protected async saveGlobalsToDisk(globals: TGlobalState, options: StorageOptions): Promise<void> {\n    if (options.useSecureStorage) {\n      await this.secureStorageService.save(keys.global, globals, options);\n    } else {\n      await this.storageService.save(keys.global, globals, options);\n    }\n  }\n\n  protected async getAccount(options: StorageOptions): Promise<TAccount> {\n    try {\n      let account: TAccount;\n      if (this.useMemory(options.storageLocation)) {\n        account = await this.getAccountFromMemory(options);\n      }\n\n      if (this.useDisk(options.storageLocation) && account == null) {\n        account = await this.getAccountFromDisk(options);\n      }\n\n      return account;\n    } catch (e) {\n      this.logService.error(e);\n    }\n  }\n\n  protected async getAccountFromMemory(options: StorageOptions): Promise<TAccount> {\n    return await this.state().then(async (state) => {\n      if (state.accounts == null) {\n        return null;\n      }\n      return state.accounts[await this.getUserIdFromMemory(options)];\n    });\n  }\n\n  protected async getUserIdFromMemory(options: StorageOptions): Promise<string> {\n    return await this.state().then((state) => {\n      return options?.userId != null\n        ? state.accounts[options.userId]?.profile?.userId\n        : state.activeUserId;\n    });\n  }\n\n  protected async getAccountFromDisk(options: StorageOptions): Promise<TAccount> {\n    if (options?.userId == null && (await this.state())?.activeUserId == null) {\n      return null;\n    }\n\n    if (this.useAccountCache) {\n      const cachedAccount = this.accountDiskCache.value[options.userId];\n      if (cachedAccount != null) {\n        return cachedAccount;\n      }\n    }\n\n    const account = options?.useSecureStorage\n      ? (await this.secureStorageService.get<TAccount>(options.userId, options)) ??\n        (await this.storageService.get<TAccount>(\n          options.userId,\n          this.reconcileOptions(options, { htmlStorageLocation: HtmlStorageLocation.Local }),\n        ))\n      : await this.storageService.get<TAccount>(options.userId, options);\n\n    this.setDiskCache(options.userId, account);\n    return account;\n  }\n\n  protected useMemory(storageLocation: StorageLocation) {\n    return storageLocation === StorageLocation.Memory || storageLocation === StorageLocation.Both;\n  }\n\n  protected useDisk(storageLocation: StorageLocation) {\n    return storageLocation === StorageLocation.Disk || storageLocation === StorageLocation.Both;\n  }\n\n  protected async saveAccount(\n    account: TAccount,\n    options: StorageOptions = {\n      storageLocation: StorageLocation.Both,\n      useSecureStorage: false,\n    },\n  ) {\n    return this.useMemory(options.storageLocation)\n      ? await this.saveAccountToMemory(account)\n      : await this.saveAccountToDisk(account, options);\n  }\n\n  protected async saveAccountToDisk(account: TAccount, options: StorageOptions): Promise<void> {\n    const storageLocation = options.useSecureStorage\n      ? this.secureStorageService\n      : this.storageService;\n\n    await storageLocation.save(`${options.userId}`, account, options);\n\n    this.deleteDiskCache(options.userId);\n  }\n\n  protected async saveAccountToMemory(account: TAccount): Promise<void> {\n    if ((await this.getAccountFromMemory({ userId: account.profile.userId })) !== null) {\n      await this.updateState((state) => {\n        return new Promise((resolve) => {\n          state.accounts[account.profile.userId] = account;\n          resolve(state);\n        });\n      });\n    }\n    await this.pushAccounts();\n  }\n\n  protected async scaffoldNewAccountStorage(account: TAccount): Promise<void> {\n    // We don't want to manipulate the referenced in memory account\n    const deepClone = JSON.parse(JSON.stringify(account));\n    await this.scaffoldNewAccountLocalStorage(deepClone);\n    await this.scaffoldNewAccountSessionStorage(deepClone);\n    await this.scaffoldNewAccountMemoryStorage(deepClone);\n  }\n\n  // TODO: There is a tech debt item for splitting up these methods - only Web uses multiple storage locations in its storageService.\n  // For now these methods exist with some redundancy to facilitate this special web requirement.\n  protected async scaffoldNewAccountLocalStorage(account: TAccount): Promise<void> {\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions(\n        { userId: account.profile.userId },\n        await this.defaultOnDiskLocalOptions(),\n      ),\n    );\n    if (storedAccount?.settings != null) {\n      account.settings = storedAccount.settings;\n    } else if (await this.storageService.has(keys.tempAccountSettings)) {\n      account.settings = await this.storageService.get<AccountSettings>(keys.tempAccountSettings);\n      await this.storageService.remove(keys.tempAccountSettings);\n    }\n\n    if (\n      account.settings.vaultTimeoutAction === VaultTimeoutAction.LogOut &&\n      account.settings.vaultTimeout != null\n    ) {\n      account.tokens.accessToken = null;\n      account.tokens.refreshToken = null;\n      account.profile.apiKeyClientId = null;\n      account.keys.apiKeyClientSecret = null;\n    }\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(\n        { userId: account.profile.userId },\n        await this.defaultOnDiskLocalOptions(),\n      ),\n    );\n  }\n\n  protected async scaffoldNewAccountMemoryStorage(account: TAccount): Promise<void> {\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions(\n        { userId: account.profile.userId },\n        await this.defaultOnDiskMemoryOptions(),\n      ),\n    );\n    if (storedAccount?.settings != null) {\n      account.settings = storedAccount.settings;\n    }\n    await this.storageService.save(\n      account.profile.userId,\n      account,\n      await this.defaultOnDiskMemoryOptions(),\n    );\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(\n        { userId: account.profile.userId },\n        await this.defaultOnDiskMemoryOptions(),\n      ),\n    );\n  }\n\n  protected async scaffoldNewAccountSessionStorage(account: TAccount): Promise<void> {\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions({ userId: account.profile.userId }, await this.defaultOnDiskOptions()),\n    );\n    if (storedAccount?.settings != null) {\n      account.settings = storedAccount.settings;\n    }\n    await this.storageService.save(\n      account.profile.userId,\n      account,\n      await this.defaultOnDiskMemoryOptions(),\n    );\n    await this.saveAccount(\n      account,\n      this.reconcileOptions({ userId: account.profile.userId }, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  protected async pushAccounts(): Promise<void> {\n    await this.state().then((state) => {\n      if (state.accounts == null || Object.keys(state.accounts).length < 1) {\n        this.accountsSubject.next({});\n        return;\n      }\n\n      this.accountsSubject.next(state.accounts);\n    });\n  }\n\n  protected reconcileOptions(\n    requestedOptions: StorageOptions,\n    defaultOptions: StorageOptions,\n  ): StorageOptions {\n    if (requestedOptions == null) {\n      return defaultOptions;\n    }\n    requestedOptions.userId = requestedOptions?.userId ?? defaultOptions.userId;\n    requestedOptions.storageLocation =\n      requestedOptions?.storageLocation ?? defaultOptions.storageLocation;\n    requestedOptions.useSecureStorage =\n      requestedOptions?.useSecureStorage ?? defaultOptions.useSecureStorage;\n    requestedOptions.htmlStorageLocation =\n      requestedOptions?.htmlStorageLocation ?? defaultOptions.htmlStorageLocation;\n    requestedOptions.keySuffix = requestedOptions?.keySuffix ?? defaultOptions.keySuffix;\n    return requestedOptions;\n  }\n\n  protected async defaultInMemoryOptions(): Promise<StorageOptions> {\n    return {\n      storageLocation: StorageLocation.Memory,\n      userId: (await this.state()).activeUserId,\n    };\n  }\n\n  protected async defaultOnDiskOptions(): Promise<StorageOptions> {\n    return {\n      storageLocation: StorageLocation.Disk,\n      htmlStorageLocation: HtmlStorageLocation.Session,\n      userId: (await this.state())?.activeUserId ?? (await this.getActiveUserIdFromStorage()),\n      useSecureStorage: false,\n    };\n  }\n\n  protected async defaultOnDiskLocalOptions(): Promise<StorageOptions> {\n    return {\n      storageLocation: StorageLocation.Disk,\n      htmlStorageLocation: HtmlStorageLocation.Local,\n      userId: (await this.state())?.activeUserId ?? (await this.getActiveUserIdFromStorage()),\n      useSecureStorage: false,\n    };\n  }\n\n  protected async defaultOnDiskMemoryOptions(): Promise<StorageOptions> {\n    return {\n      storageLocation: StorageLocation.Disk,\n      htmlStorageLocation: HtmlStorageLocation.Memory,\n      userId: (await this.state())?.activeUserId ?? (await this.getUserId()),\n      useSecureStorage: false,\n    };\n  }\n\n  protected async defaultSecureStorageOptions(): Promise<StorageOptions> {\n    return {\n      storageLocation: StorageLocation.Disk,\n      useSecureStorage: true,\n      userId: (await this.state())?.activeUserId ?? (await this.getActiveUserIdFromStorage()),\n    };\n  }\n\n  protected async getActiveUserIdFromStorage(): Promise<string> {\n    return await this.storageService.get<string>(keys.activeUserId);\n  }\n\n  protected async removeAccountFromLocalStorage(userId: string = null): Promise<void> {\n    userId = userId ?? (await this.state())?.activeUserId;\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions({ userId: userId }, await this.defaultOnDiskLocalOptions()),\n    );\n    await this.saveAccount(\n      this.resetAccount(storedAccount),\n      this.reconcileOptions({ userId: userId }, await this.defaultOnDiskLocalOptions()),\n    );\n  }\n\n  protected async removeAccountFromSessionStorage(userId: string = null): Promise<void> {\n    userId = userId ?? (await this.state())?.activeUserId;\n    const storedAccount = await this.getAccount(\n      this.reconcileOptions({ userId: userId }, await this.defaultOnDiskOptions()),\n    );\n    await this.saveAccount(\n      this.resetAccount(storedAccount),\n      this.reconcileOptions({ userId: userId }, await this.defaultOnDiskOptions()),\n    );\n  }\n\n  protected async removeAccountFromSecureStorage(userId: string = null): Promise<void> {\n    userId = userId ?? (await this.state())?.activeUserId;\n    await this.setUserKeyAutoUnlock(null, { userId: userId });\n    await this.setUserKeyBiometric(null, { userId: userId });\n    await this.setCryptoMasterKeyAuto(null, { userId: userId });\n    await this.setCryptoMasterKeyBiometric(null, { userId: userId });\n    await this.setCryptoMasterKeyB64(null, { userId: userId });\n  }\n\n  protected async removeAccountFromMemory(userId: string = null): Promise<void> {\n    await this.updateState(async (state) => {\n      userId = userId ?? state.activeUserId;\n      delete state.accounts[userId];\n\n      this.deleteDiskCache(userId);\n\n      return state;\n    });\n    // TODO: Invert this logic, we should remove accounts based on logged out emit\n    await this.accountService.setAccountStatus(userId as UserId, AuthenticationStatus.LoggedOut);\n  }\n\n  // settings persist even on reset, and are not affected by this method\n  protected resetAccount(account: TAccount) {\n    const persistentAccountInformation = {\n      settings: account.settings,\n      keys: { deviceKey: account.keys.deviceKey },\n      adminAuthRequest: account.adminAuthRequest,\n    };\n    return Object.assign(this.createAccount(), persistentAccountInformation);\n  }\n\n  protected async clearDecryptedDataForActiveUser(): Promise<void> {\n    await this.updateState(async (state) => {\n      const userId = state?.activeUserId;\n      if (userId != null && state?.accounts[userId]?.data != null) {\n        state.accounts[userId].data = new AccountData();\n      }\n\n      return state;\n    });\n  }\n\n  protected createAccount(init: Partial<TAccount> = null): TAccount {\n    return this.stateFactory.createAccount(init);\n  }\n\n  protected createGlobals(init: Partial<TGlobalState> = null): TGlobalState {\n    return this.stateFactory.createGlobal(init);\n  }\n\n  protected async deAuthenticateAccount(userId: string): Promise<void> {\n    await this.setAccessToken(null, { userId: userId });\n    await this.setLastActive(null, { userId: userId });\n    await this.updateState(async (state) => {\n      state.authenticatedAccounts = state.authenticatedAccounts.filter((id) => id !== userId);\n\n      await this.storageService.save(keys.authenticatedAccounts, state.authenticatedAccounts);\n\n      return state;\n    });\n  }\n\n  protected async removeAccountFromDisk(userId: string) {\n    await this.removeAccountFromSessionStorage(userId);\n    await this.removeAccountFromLocalStorage(userId);\n    await this.removeAccountFromSecureStorage(userId);\n  }\n\n  async nextUpActiveUser() {\n    const accounts = (await this.state())?.accounts;\n    if (accounts == null || Object.keys(accounts).length < 1) {\n      return null;\n    }\n\n    let newActiveUser;\n    for (const userId in accounts) {\n      if (userId == null) {\n        continue;\n      }\n      if (await this.getIsAuthenticated({ userId: userId })) {\n        newActiveUser = userId;\n        break;\n      }\n      newActiveUser = null;\n    }\n    return newActiveUser as UserId;\n  }\n\n  protected async dynamicallySetActiveUser() {\n    const newActiveUser = await this.nextUpActiveUser();\n    await this.setActiveUser(newActiveUser);\n    return newActiveUser;\n  }\n\n  private async getTimeoutBasedStorageOptions(options?: StorageOptions): Promise<StorageOptions> {\n    const timeoutAction = await this.getVaultTimeoutAction({ userId: options?.userId });\n    const timeout = await this.getVaultTimeout({ userId: options?.userId });\n    const defaultOptions =\n      timeoutAction === VaultTimeoutAction.LogOut && timeout != null\n        ? await this.defaultInMemoryOptions()\n        : await this.defaultOnDiskOptions();\n    return this.reconcileOptions(options, defaultOptions);\n  }\n\n  protected async saveSecureStorageKey<T extends JsonValue>(\n    key: string,\n    value: T,\n    options?: StorageOptions,\n  ) {\n    return value == null\n      ? await this.secureStorageService.remove(`${options.userId}${key}`, options)\n      : await this.secureStorageService.save(`${options.userId}${key}`, value, options);\n  }\n\n  protected async state(): Promise<State<TGlobalState, TAccount>> {\n    const state = await this.memoryStorageService.get<State<TGlobalState, TAccount>>(keys.state, {\n      deserializer: (s) => State.fromJSON(s, this.accountDeserializer),\n    });\n    return state;\n  }\n\n  private async setState(\n    state: State<TGlobalState, TAccount>,\n  ): Promise<State<TGlobalState, TAccount>> {\n    await this.memoryStorageService.save(keys.state, state);\n    return state;\n  }\n\n  protected async updateState(\n    stateUpdater: (state: State<TGlobalState, TAccount>) => Promise<State<TGlobalState, TAccount>>,\n  ): Promise<State<TGlobalState, TAccount>> {\n    return await this.state().then(async (state) => {\n      const updatedState = await stateUpdater(state);\n      if (updatedState == null) {\n        throw new Error(\"Attempted to update state to null value\");\n      }\n\n      return await this.setState(updatedState);\n    });\n  }\n\n  private setDiskCache(key: string, value: TAccount, options?: StorageOptions) {\n    if (this.useAccountCache) {\n      this.accountDiskCache.value[key] = value;\n      this.accountDiskCache.next(this.accountDiskCache.value);\n    }\n  }\n\n  protected deleteDiskCache(key: string) {\n    if (this.useAccountCache) {\n      delete this.accountDiskCache.value[key];\n      this.accountDiskCache.next(this.accountDiskCache.value);\n    }\n  }\n}\n\nfunction withPrototypeForArrayMembers<T>(\n  memberConstructor: new (...args: any[]) => T,\n  memberConverter: (input: any) => T = (i) => i,\n): (\n  target: any,\n  propertyKey: string | symbol,\n  descriptor: PropertyDescriptor,\n) => { value: (...args: any[]) => Promise<T[]> } {\n  return (target: any, propertyKey: string | symbol, descriptor: PropertyDescriptor) => {\n    const originalMethod = descriptor.value;\n\n    return {\n      value: function (...args: any[]) {\n        const originalResult: Promise<any[]> = originalMethod.apply(this, args);\n\n        if (!Utils.isPromise(originalResult)) {\n          throw new Error(\n            `Error applying prototype to stored value -- result is not a promise for method ${String(\n              propertyKey,\n            )}`,\n          );\n        }\n\n        return originalResult.then((result) => {\n          if (result == null) {\n            return null;\n          } else if (!(result instanceof Array)) {\n            throw new Error(\n              `Attempted to retrieve non array type from state as an array for method ${String(\n                propertyKey,\n              )}`,\n            );\n          } else {\n            return result.map((r) => {\n              return r == null ||\n                r.constructor.name === memberConstructor.prototype.constructor.name\n                ? r\n                : memberConverter(\n                    Object.create(memberConstructor.prototype, Object.getOwnPropertyDescriptors(r)),\n                  );\n            });\n          }\n        });\n      },\n    };\n  };\n}\n\nfunction withPrototypeForObjectValues<T>(\n  valuesConstructor: new (...args: any[]) => T,\n  valuesConverter: (input: any) => T = (i) => i,\n): (\n  target: any,\n  propertyKey: string | symbol,\n  descriptor: PropertyDescriptor,\n) => { value: (...args: any[]) => Promise<{ [key: string]: T }> } {\n  return (target: any, propertyKey: string | symbol, descriptor: PropertyDescriptor) => {\n    const originalMethod = descriptor.value;\n\n    return {\n      value: function (...args: any[]) {\n        const originalResult: Promise<{ [key: string]: T }> = originalMethod.apply(this, args);\n\n        if (!Utils.isPromise(originalResult)) {\n          throw new Error(\n            `Error applying prototype to stored value -- result is not a promise for method ${String(\n              propertyKey,\n            )}`,\n          );\n        }\n\n        return originalResult.then((result) => {\n          if (result == null) {\n            return null;\n          } else {\n            for (const [key, val] of Object.entries(result)) {\n              result[key] =\n                val == null || val.constructor.name === valuesConstructor.prototype.constructor.name\n                  ? valuesConverter(val)\n                  : valuesConverter(\n                      Object.create(\n                        valuesConstructor.prototype,\n                        Object.getOwnPropertyDescriptors(val),\n                      ),\n                    );\n            }\n\n            return result as { [key: string]: T };\n          }\n        });\n      },\n    };\n  };\n}\n","import { Jsonify } from \"type-fest\";\n\nexport class BrowserComponentState {\n  scrollY: number;\n  searchText: string;\n\n  static fromJSON(json: Jsonify<BrowserComponentState>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new BrowserComponentState(), json);\n  }\n}\n","import { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { DeepJsonify } from \"@bitwarden/common/types/deep-jsonify\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\n\nimport { BrowserComponentState } from \"./browserComponentState\";\n\nexport class BrowserGroupingsComponentState extends BrowserComponentState {\n  favoriteCiphers: CipherView[];\n  noFolderCiphers: CipherView[];\n  ciphers: CipherView[];\n  collectionCounts: Map<string, number>;\n  folderCounts: Map<string, number>;\n  typeCounts: Map<CipherType, number>;\n  folders: FolderView[];\n  collections: CollectionView[];\n  deletedCount: number;\n\n  toJSON() {\n    return Utils.merge(this, {\n      collectionCounts: Utils.mapToRecord(this.collectionCounts),\n      folderCounts: Utils.mapToRecord(this.folderCounts),\n      typeCounts: Utils.mapToRecord(this.typeCounts),\n    });\n  }\n\n  static fromJSON(json: DeepJsonify<BrowserGroupingsComponentState>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new BrowserGroupingsComponentState(), json, {\n      favoriteCiphers: json.favoriteCiphers?.map((c) => CipherView.fromJSON(c)),\n      noFolderCiphers: json.noFolderCiphers?.map((c) => CipherView.fromJSON(c)),\n      ciphers: json.ciphers?.map((c) => CipherView.fromJSON(c)),\n      collectionCounts: Utils.recordToMap(json.collectionCounts),\n      folderCounts: Utils.recordToMap(json.folderCounts),\n      typeCounts: Utils.recordToMap(json.typeCounts),\n      folders: json.folders?.map((f) => FolderView.fromJSON(f)),\n    });\n  }\n}\n","import { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { SendType } from \"@bitwarden/common/tools/send/enums/send-type\";\nimport { SendView } from \"@bitwarden/common/tools/send/models/view/send.view\";\nimport { DeepJsonify } from \"@bitwarden/common/types/deep-jsonify\";\n\nimport { BrowserComponentState } from \"./browserComponentState\";\n\nexport class BrowserSendComponentState extends BrowserComponentState {\n  sends: SendView[];\n  typeCounts: Map<SendType, number>;\n\n  toJSON() {\n    return Utils.merge(this, {\n      typeCounts: Utils.mapToRecord(this.typeCounts),\n    });\n  }\n\n  static fromJSON(json: DeepJsonify<BrowserSendComponentState>) {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new BrowserSendComponentState(), json, {\n      sends: json.sends?.map((s) => SendView.fromJSON(s)),\n      typeCounts: Utils.recordToMap(json.typeCounts),\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport {\n  Account as BaseAccount,\n  AccountSettings as BaseAccountSettings,\n} from \"@bitwarden/common/platform/models/domain/account\";\n\nimport { BrowserComponentState } from \"./browserComponentState\";\nimport { BrowserGroupingsComponentState } from \"./browserGroupingsComponentState\";\nimport { BrowserSendComponentState } from \"./browserSendComponentState\";\n\nexport class AccountSettings extends BaseAccountSettings {\n  vaultTimeout = -1; // On Restart\n\n  static fromJSON(json: Jsonify<AccountSettings>): AccountSettings {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new AccountSettings(), json, super.fromJSON(json));\n  }\n}\n\nexport class Account extends BaseAccount {\n  settings?: AccountSettings = new AccountSettings();\n  groupings?: BrowserGroupingsComponentState;\n  send?: BrowserSendComponentState;\n  ciphers?: BrowserComponentState;\n  sendType?: BrowserComponentState;\n\n  constructor(init: Partial<Account>) {\n    super(init);\n    Object.assign(this.settings, {\n      ...new AccountSettings(),\n      ...this.settings,\n    });\n    this.groupings = init?.groupings ?? new BrowserGroupingsComponentState();\n    this.send = init?.send ?? new BrowserSendComponentState();\n    this.ciphers = init?.ciphers ?? new BrowserComponentState();\n    this.sendType = init?.sendType ?? new BrowserComponentState();\n  }\n\n  static fromJSON(json: Jsonify<Account>): Account {\n    if (json == null) {\n      return null;\n    }\n\n    return Object.assign(new Account({}), json, super.fromJSON(json), {\n      settings: AccountSettings.fromJSON(json.settings),\n      groupings: BrowserGroupingsComponentState.fromJSON(json.groupings),\n      send: BrowserSendComponentState.fromJSON(json.send),\n      ciphers: BrowserComponentState.fromJSON(json.ciphers),\n      sendType: BrowserComponentState.fromJSON(json.sendType),\n    });\n  }\n}\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport {\n  AbstractStorageService,\n  AbstractMemoryStorageService,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\nimport { StorageOptions } from \"@bitwarden/common/platform/models/domain/storage-options\";\nimport { MigrationRunner } from \"@bitwarden/common/platform/services/migration-runner\";\nimport { StateService as BaseStateService } from \"@bitwarden/common/platform/services/state.service\";\n\nimport { Account } from \"../../models/account\";\nimport { BrowserComponentState } from \"../../models/browserComponentState\";\nimport { BrowserGroupingsComponentState } from \"../../models/browserGroupingsComponentState\";\nimport { BrowserSendComponentState } from \"../../models/browserSendComponentState\";\nimport { BrowserApi } from \"../browser/browser-api\";\nimport { browserSession, sessionSync } from \"../decorators/session-sync-observable\";\n\nimport { BrowserStateService as StateServiceAbstraction } from \"./abstractions/browser-state.service\";\n\n@browserSession\nexport class BrowserStateService\n  extends BaseStateService<GlobalState, Account>\n  implements StateServiceAbstraction\n{\n  @sessionSync({\n    initializer: Account.fromJSON as any, // TODO: Remove this any when all any types are removed from Account\n    initializeAs: \"record\",\n  })\n  protected accountsSubject: BehaviorSubject<{ [userId: string]: Account }>;\n  @sessionSync({ initializer: (s: string) => s })\n  protected activeAccountSubject: BehaviorSubject<string>;\n\n  protected accountDeserializer = Account.fromJSON;\n\n  constructor(\n    storageService: AbstractStorageService,\n    secureStorageService: AbstractStorageService,\n    memoryStorageService: AbstractMemoryStorageService,\n    logService: LogService,\n    stateFactory: StateFactory<GlobalState, Account>,\n    accountService: AccountService,\n    environmentService: EnvironmentService,\n    migrationRunner: MigrationRunner,\n    useAccountCache = true,\n  ) {\n    super(\n      storageService,\n      secureStorageService,\n      memoryStorageService,\n      logService,\n      stateFactory,\n      accountService,\n      environmentService,\n      migrationRunner,\n      useAccountCache,\n    );\n\n    // TODO: This is a hack to fix having a disk cache on both the popup and\n    // the background page that can get out of sync. We need to work out the\n    // best way to handle caching with multiple instances of the state service.\n    if (useAccountCache) {\n      BrowserApi.storageChangeListener((changes, namespace) => {\n        if (namespace === \"local\") {\n          for (const key of Object.keys(changes)) {\n            if (key !== \"accountActivity\" && this.accountDiskCache.value[key]) {\n              this.deleteDiskCache(key);\n            }\n          }\n        }\n      });\n\n      BrowserApi.addListener(\n        chrome.runtime.onMessage,\n        (message: { command: string }, _, respond) => {\n          if (message.command === \"initializeDiskCache\") {\n            respond(JSON.stringify(this.accountDiskCache.value));\n          }\n        },\n      );\n    }\n  }\n\n  override async initAccountState(): Promise<void> {\n    if (this.isRecoveredSession && this.useAccountCache) {\n      // request cache initialization\n\n      const response = await BrowserApi.sendMessageWithResponse<string>(\"initializeDiskCache\");\n      this.accountDiskCache.next(JSON.parse(response));\n\n      return;\n    }\n\n    await super.initAccountState();\n  }\n\n  async addAccount(account: Account) {\n    // Apply browser overrides to default account values\n    account = new Account(account);\n    await super.addAccount(account);\n  }\n\n  async getIsAuthenticated(options?: StorageOptions): Promise<boolean> {\n    // Firefox Private Mode can clash with non-Private Mode because they both read from the same onDiskOptions\n    // Check that there is an account in memory before considering the user authenticated\n    return (\n      (await super.getIsAuthenticated(options)) &&\n      (await this.getAccount(await this.defaultInMemoryOptions())) != null\n    );\n  }\n\n  async getBrowserGroupingComponentState(\n    options?: StorageOptions,\n  ): Promise<BrowserGroupingsComponentState> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.groupings;\n  }\n\n  async setBrowserGroupingComponentState(\n    value: BrowserGroupingsComponentState,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.groupings = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getBrowserVaultItemsComponentState(\n    options?: StorageOptions,\n  ): Promise<BrowserComponentState> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.ciphers;\n  }\n\n  async setBrowserVaultItemsComponentState(\n    value: BrowserComponentState,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.ciphers = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getBrowserSendComponentState(options?: StorageOptions): Promise<BrowserSendComponentState> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.send;\n  }\n\n  async setBrowserSendComponentState(\n    value: BrowserSendComponentState,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.send = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  async getBrowserSendTypeComponentState(options?: StorageOptions): Promise<BrowserComponentState> {\n    return (\n      await this.getAccount(this.reconcileOptions(options, await this.defaultInMemoryOptions()))\n    )?.sendType;\n  }\n\n  async setBrowserSendTypeComponentState(\n    value: BrowserComponentState,\n    options?: StorageOptions,\n  ): Promise<void> {\n    const account = await this.getAccount(\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n    account.sendType = value;\n    await this.saveAccount(\n      account,\n      this.reconcileOptions(options, await this.defaultInMemoryOptions()),\n    );\n  }\n\n  // Overriding the base class to prevent deleting the cache on save. We register a storage listener\n  // to delete the cache in the constructor above.\n  protected override async saveAccountToDisk(\n    account: Account,\n    options: StorageOptions,\n  ): Promise<void> {\n    const storageLocation = options.useSecureStorage\n      ? this.secureStorageService\n      : this.storageService;\n\n    await storageLocation.save(`${options.userId}`, account, options);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nexport class EnvironmentUrls {\n  base: string = null;\n  api: string = null;\n  identity: string = null;\n  icons: string = null;\n  notifications: string = null;\n  events: string = null;\n  webVault: string = null;\n  keyConnector: string = null;\n\n  static fromJSON(obj: Jsonify<EnvironmentUrls>): EnvironmentUrls {\n    return Object.assign(new EnvironmentUrls(), obj);\n  }\n}\n","import {\n  concatMap,\n  distinctUntilChanged,\n  firstValueFrom,\n  map,\n  Observable,\n  ReplaySubject,\n} from \"rxjs\";\n\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { EnvironmentUrls } from \"../../auth/models/domain/environment-urls\";\nimport { UserId } from \"../../types/guid\";\nimport {\n  EnvironmentService as EnvironmentServiceAbstraction,\n  Region,\n  RegionDomain,\n  Urls,\n} from \"../abstractions/environment.service\";\nimport { Utils } from \"../misc/utils\";\nimport { ENVIRONMENT_DISK, GlobalState, KeyDefinition, StateProvider } from \"../state\";\n\nconst REGION_KEY = new KeyDefinition<Region>(ENVIRONMENT_DISK, \"region\", {\n  deserializer: (s) => s,\n});\n\nconst URLS_KEY = new KeyDefinition<EnvironmentUrls>(ENVIRONMENT_DISK, \"urls\", {\n  deserializer: EnvironmentUrls.fromJSON,\n});\n\nexport class EnvironmentService implements EnvironmentServiceAbstraction {\n  private readonly urlsSubject = new ReplaySubject<void>(1);\n  urls: Observable<void> = this.urlsSubject.asObservable();\n  selectedRegion?: Region;\n  initialized = false;\n\n  protected baseUrl: string;\n  protected webVaultUrl: string;\n  protected apiUrl: string;\n  protected identityUrl: string;\n  protected iconsUrl: string;\n  protected notificationsUrl: string;\n  protected eventsUrl: string;\n  private keyConnectorUrl: string;\n  private scimUrl: string = null;\n  private cloudWebVaultUrl: string;\n\n  private regionGlobalState: GlobalState<Region | null>;\n  private urlsGlobalState: GlobalState<EnvironmentUrls | null>;\n\n  private activeAccountId$: Observable<UserId | null>;\n\n  readonly usUrls: Urls = {\n    base: null,\n    api: \"https://api.bitwarden.com\",\n    identity: \"https://identity.bitwarden.com\",\n    icons: \"https://icons.bitwarden.net\",\n    webVault: \"https://vault.bitwarden.com\",\n    notifications: \"https://notifications.bitwarden.com\",\n    events: \"https://events.bitwarden.com\",\n    scim: \"https://scim.bitwarden.com\",\n  };\n\n  readonly euUrls: Urls = {\n    base: null,\n    api: \"https://api.bitwarden.eu\",\n    identity: \"https://identity.bitwarden.eu\",\n    icons: \"https://icons.bitwarden.eu\",\n    webVault: \"https://vault.bitwarden.eu\",\n    notifications: \"https://notifications.bitwarden.eu\",\n    events: \"https://events.bitwarden.eu\",\n    scim: \"https://scim.bitwarden.eu\",\n  };\n\n  constructor(\n    private stateProvider: StateProvider,\n    private accountService: AccountService,\n  ) {\n    // We intentionally don't want the helper on account service, we want the null back if there is no active user\n    this.activeAccountId$ = this.accountService.activeAccount$.pipe(map((a) => a?.id));\n\n    // TODO: Get rid of early subscription during EnvironmentService refactor\n    this.activeAccountId$\n      .pipe(\n        // Use == here to not trigger on undefined -> null transition\n        distinctUntilChanged((oldUserId: string, newUserId: string) => oldUserId == newUserId),\n        concatMap(async () => {\n          if (!this.initialized) {\n            return;\n          }\n          await this.setUrlsFromStorage();\n        }),\n      )\n      .subscribe();\n\n    this.regionGlobalState = this.stateProvider.getGlobal(REGION_KEY);\n    this.urlsGlobalState = this.stateProvider.getGlobal(URLS_KEY);\n  }\n\n  hasBaseUrl() {\n    return this.baseUrl != null;\n  }\n\n  getNotificationsUrl() {\n    if (this.notificationsUrl != null) {\n      return this.notificationsUrl;\n    }\n\n    if (this.baseUrl != null) {\n      return this.baseUrl + \"/notifications\";\n    }\n\n    return \"https://notifications.bitwarden.com\";\n  }\n\n  getWebVaultUrl() {\n    if (this.webVaultUrl != null) {\n      return this.webVaultUrl;\n    }\n\n    if (this.baseUrl) {\n      return this.baseUrl;\n    }\n    return \"https://vault.bitwarden.com\";\n  }\n\n  getCloudWebVaultUrl() {\n    if (this.cloudWebVaultUrl != null) {\n      return this.cloudWebVaultUrl;\n    }\n\n    return this.usUrls.webVault;\n  }\n\n  setCloudWebVaultUrl(region: Region) {\n    switch (region) {\n      case Region.EU:\n        this.cloudWebVaultUrl = this.euUrls.webVault;\n        break;\n      case Region.US:\n      default:\n        this.cloudWebVaultUrl = this.usUrls.webVault;\n        break;\n    }\n  }\n\n  getSendUrl() {\n    return this.getWebVaultUrl() === \"https://vault.bitwarden.com\"\n      ? \"https://send.bitwarden.com/#\"\n      : this.getWebVaultUrl() + \"/#/send/\";\n  }\n\n  getIconsUrl() {\n    if (this.iconsUrl != null) {\n      return this.iconsUrl;\n    }\n\n    if (this.baseUrl) {\n      return this.baseUrl + \"/icons\";\n    }\n\n    return \"https://icons.bitwarden.net\";\n  }\n\n  getApiUrl() {\n    if (this.apiUrl != null) {\n      return this.apiUrl;\n    }\n\n    if (this.baseUrl) {\n      return this.baseUrl + \"/api\";\n    }\n\n    return \"https://api.bitwarden.com\";\n  }\n\n  getIdentityUrl() {\n    if (this.identityUrl != null) {\n      return this.identityUrl;\n    }\n\n    if (this.baseUrl) {\n      return this.baseUrl + \"/identity\";\n    }\n\n    return \"https://identity.bitwarden.com\";\n  }\n\n  getEventsUrl() {\n    if (this.eventsUrl != null) {\n      return this.eventsUrl;\n    }\n\n    if (this.baseUrl) {\n      return this.baseUrl + \"/events\";\n    }\n\n    return \"https://events.bitwarden.com\";\n  }\n\n  getKeyConnectorUrl() {\n    return this.keyConnectorUrl;\n  }\n\n  getScimUrl() {\n    if (this.scimUrl != null) {\n      return this.scimUrl + \"/v2\";\n    }\n\n    return this.getWebVaultUrl() === \"https://vault.bitwarden.com\"\n      ? \"https://scim.bitwarden.com/v2\"\n      : this.getWebVaultUrl() + \"/scim/v2\";\n  }\n\n  async setUrlsFromStorage(): Promise<void> {\n    const activeUserId = await firstValueFrom(this.activeAccountId$);\n\n    const region = await this.getRegion(activeUserId);\n    const savedUrls = await this.getEnvironmentUrls(activeUserId);\n    const envUrls = new EnvironmentUrls();\n\n    // In release `2023.5.0`, we set the `base` property of the environment URLs to the US web vault URL when a user clicked the \"US\" region.\n    // This check will detect these cases and convert them to the proper region instead.\n    // We are detecting this by checking for the presence of the web vault URL in the `base` and the absence of the `notifications` property.\n    // This is because the `notifications` will not be `null` in the web vault, and we don't want to migrate the URLs in that case.\n    if (savedUrls.base === \"https://vault.bitwarden.com\" && savedUrls.notifications == null) {\n      await this.setRegion(Region.US);\n      return;\n    }\n\n    switch (region) {\n      case Region.EU:\n        await this.setRegion(Region.EU);\n        return;\n      case Region.US:\n        await this.setRegion(Region.US);\n        return;\n      case Region.SelfHosted:\n      case null:\n      default:\n        this.baseUrl = envUrls.base = savedUrls.base;\n        this.webVaultUrl = savedUrls.webVault;\n        this.apiUrl = envUrls.api = savedUrls.api;\n        this.identityUrl = envUrls.identity = savedUrls.identity;\n        this.iconsUrl = savedUrls.icons;\n        this.notificationsUrl = savedUrls.notifications;\n        this.eventsUrl = envUrls.events = savedUrls.events;\n        this.keyConnectorUrl = savedUrls.keyConnector;\n        await this.setRegion(Region.SelfHosted);\n        // scimUrl is not saved to storage\n        this.urlsSubject.next();\n        break;\n    }\n  }\n\n  async setUrls(urls: Urls): Promise<Urls> {\n    urls.base = this.formatUrl(urls.base);\n    urls.webVault = this.formatUrl(urls.webVault);\n    urls.api = this.formatUrl(urls.api);\n    urls.identity = this.formatUrl(urls.identity);\n    urls.icons = this.formatUrl(urls.icons);\n    urls.notifications = this.formatUrl(urls.notifications);\n    urls.events = this.formatUrl(urls.events);\n    urls.keyConnector = this.formatUrl(urls.keyConnector);\n\n    // scimUrl cannot be cleared\n    urls.scim = this.formatUrl(urls.scim) ?? this.scimUrl;\n\n    // Don't save scim url\n    await this.urlsGlobalState.update(() => ({\n      base: urls.base,\n      api: urls.api,\n      identity: urls.identity,\n      webVault: urls.webVault,\n      icons: urls.icons,\n      notifications: urls.notifications,\n      events: urls.events,\n      keyConnector: urls.keyConnector,\n    }));\n\n    this.baseUrl = urls.base;\n    this.webVaultUrl = urls.webVault;\n    this.apiUrl = urls.api;\n    this.identityUrl = urls.identity;\n    this.iconsUrl = urls.icons;\n    this.notificationsUrl = urls.notifications;\n    this.eventsUrl = urls.events;\n    this.keyConnectorUrl = urls.keyConnector;\n    this.scimUrl = urls.scim;\n\n    await this.setRegion(Region.SelfHosted);\n\n    this.urlsSubject.next();\n\n    return urls;\n  }\n\n  getUrls() {\n    return {\n      base: this.baseUrl,\n      webVault: this.webVaultUrl,\n      cloudWebVault: this.cloudWebVaultUrl,\n      api: this.apiUrl,\n      identity: this.identityUrl,\n      icons: this.iconsUrl,\n      notifications: this.notificationsUrl,\n      events: this.eventsUrl,\n      keyConnector: this.keyConnectorUrl,\n      scim: this.scimUrl,\n    };\n  }\n\n  isEmpty(): boolean {\n    return (\n      this.baseUrl == null &&\n      this.webVaultUrl == null &&\n      this.apiUrl == null &&\n      this.identityUrl == null &&\n      this.iconsUrl == null &&\n      this.notificationsUrl == null &&\n      this.eventsUrl == null\n    );\n  }\n\n  async getHost(userId?: UserId) {\n    const region = await this.getRegion(userId);\n\n    switch (region) {\n      case Region.US:\n        return RegionDomain.US;\n      case Region.EU:\n        return RegionDomain.EU;\n      default: {\n        // Environment is self-hosted\n        const envUrls = await this.getEnvironmentUrls(userId);\n        return Utils.getHost(envUrls.webVault || envUrls.base);\n      }\n    }\n  }\n\n  private async getRegion(userId: UserId | null) {\n    // Previous rules dictated that we only get from user scoped state if there is an active user.\n    const activeUserId = await firstValueFrom(this.activeAccountId$);\n    return activeUserId == null\n      ? await firstValueFrom(this.regionGlobalState.state$)\n      : await firstValueFrom(this.stateProvider.getUser(userId ?? activeUserId, REGION_KEY).state$);\n  }\n\n  private async getEnvironmentUrls(userId: UserId | null) {\n    return userId == null\n      ? (await firstValueFrom(this.urlsGlobalState.state$)) ?? new EnvironmentUrls()\n      : (await firstValueFrom(this.stateProvider.getUser(userId, URLS_KEY).state$)) ??\n          new EnvironmentUrls();\n  }\n\n  async setRegion(region: Region) {\n    this.selectedRegion = region;\n    await this.regionGlobalState.update(() => region);\n\n    if (region === Region.SelfHosted) {\n      // If user saves a self-hosted region with empty fields, default to US\n      if (this.isEmpty()) {\n        await this.setRegion(Region.US);\n      }\n    } else {\n      // If we are setting the region to EU or US, clear the self-hosted URLs\n      await this.urlsGlobalState.update(() => new EnvironmentUrls());\n      if (region === Region.EU) {\n        this.setUrlsInternal(this.euUrls);\n      } else if (region === Region.US) {\n        this.setUrlsInternal(this.usUrls);\n      }\n    }\n  }\n\n  async seedUserEnvironment(userId: UserId) {\n    const globalRegion = await firstValueFrom(this.regionGlobalState.state$);\n    const globalUrls = await firstValueFrom(this.urlsGlobalState.state$);\n    await this.stateProvider.getUser(userId, REGION_KEY).update(() => globalRegion);\n    await this.stateProvider.getUser(userId, URLS_KEY).update(() => globalUrls);\n  }\n\n  private setUrlsInternal(urls: Urls) {\n    this.baseUrl = this.formatUrl(urls.base);\n    this.webVaultUrl = this.formatUrl(urls.webVault);\n    this.apiUrl = this.formatUrl(urls.api);\n    this.identityUrl = this.formatUrl(urls.identity);\n    this.iconsUrl = this.formatUrl(urls.icons);\n    this.notificationsUrl = this.formatUrl(urls.notifications);\n    this.eventsUrl = this.formatUrl(urls.events);\n    this.keyConnectorUrl = this.formatUrl(urls.keyConnector);\n\n    // scimUrl cannot be cleared\n    this.scimUrl = this.formatUrl(urls.scim) ?? this.scimUrl;\n    this.urlsSubject.next();\n  }\n\n  private formatUrl(url: string): string {\n    if (url == null || url === \"\") {\n      return null;\n    }\n\n    url = url.replace(/\\/+$/g, \"\");\n    if (!url.startsWith(\"http://\") && !url.startsWith(\"https://\")) {\n      url = \"https://\" + url;\n    }\n\n    return url.trim();\n  }\n\n  isCloud(): boolean {\n    return [\n      \"https://api.bitwarden.com\",\n      \"https://vault.bitwarden.com/api\",\n      \"https://api.bitwarden.eu\",\n      \"https://vault.bitwarden.eu/api\",\n    ].includes(this.getApiUrl());\n  }\n}\n","import { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/services/environment.service\";\nimport { StateProvider } from \"@bitwarden/common/platform/state\";\n\nimport { GroupPolicyEnvironment } from \"../../admin-console/types/group-policy-environment\";\nimport { devFlagEnabled, devFlagValue } from \"../flags\";\n\nexport class BrowserEnvironmentService extends EnvironmentService {\n  constructor(\n    private logService: LogService,\n    stateProvider: StateProvider,\n    accountService: AccountService,\n  ) {\n    super(stateProvider, accountService);\n  }\n\n  async hasManagedEnvironment(): Promise<boolean> {\n    try {\n      return (await this.getManagedEnvironment()) != null;\n    } catch (e) {\n      this.logService.error(e);\n      return false;\n    }\n  }\n\n  async settingsHaveChanged() {\n    if (!(await this.hasManagedEnvironment())) {\n      return false;\n    }\n\n    const env = await this.getManagedEnvironment();\n\n    return (\n      env.base != this.baseUrl ||\n      env.webVault != this.webVaultUrl ||\n      env.api != this.webVaultUrl ||\n      env.identity != this.identityUrl ||\n      env.icons != this.iconsUrl ||\n      env.notifications != this.notificationsUrl ||\n      env.events != this.eventsUrl\n    );\n  }\n\n  getManagedEnvironment(): Promise<GroupPolicyEnvironment> {\n    return devFlagEnabled(\"managedEnvironment\")\n      ? new Promise((resolve) => resolve(devFlagValue(\"managedEnvironment\")))\n      : new Promise((resolve, reject) => {\n          if (chrome.storage.managed == null) {\n            return resolve(null);\n          }\n\n          chrome.storage.managed.get(\"environment\", (result) => {\n            if (chrome.runtime.lastError) {\n              return reject(chrome.runtime.lastError);\n            }\n\n            resolve(result.environment);\n          });\n        });\n  }\n\n  async setUrlsToManagedEnvironment() {\n    const env = await this.getManagedEnvironment();\n    await this.setUrls({\n      base: env.base,\n      webVault: env.webVault,\n      api: env.api,\n      identity: env.identity,\n      icons: env.icons,\n      notifications: env.notifications,\n      events: env.events,\n    });\n  }\n}\n","import { Observable, ReplaySubject, Subject, concatMap, merge, share, timer } from \"rxjs\";\n\nimport { DerivedStateDependencies } from \"../../../types/state\";\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { DeriveDefinition } from \"../derive-definition\";\nimport { DerivedState } from \"../derived-state\";\n\n/**\n * Default derived state\n */\nexport class DefaultDerivedState<TFrom, TTo, TDeps extends DerivedStateDependencies>\n  implements DerivedState<TTo>\n{\n  private readonly storageKey: string;\n  private forcedValueSubject = new Subject<TTo>();\n\n  state$: Observable<TTo>;\n\n  constructor(\n    private parentState$: Observable<TFrom>,\n    protected deriveDefinition: DeriveDefinition<TFrom, TTo, TDeps>,\n    private memoryStorage: AbstractStorageService & ObservableStorageService,\n    private dependencies: TDeps,\n  ) {\n    this.storageKey = deriveDefinition.storageKey;\n\n    const derivedState$ = this.parentState$.pipe(\n      concatMap(async (state) => {\n        let derivedStateOrPromise = this.deriveDefinition.derive(state, this.dependencies);\n        if (derivedStateOrPromise instanceof Promise) {\n          derivedStateOrPromise = await derivedStateOrPromise;\n        }\n        const derivedState = derivedStateOrPromise;\n        await this.storeValue(derivedState);\n        return derivedState;\n      }),\n    );\n\n    this.state$ = merge(this.forcedValueSubject, derivedState$).pipe(\n      share({\n        connector: () => {\n          return new ReplaySubject<TTo>(1);\n        },\n        resetOnRefCountZero: () =>\n          timer(this.deriveDefinition.cleanupDelayMs).pipe(\n            concatMap(async () => {\n              if (this.deriveDefinition.clearOnCleanup) {\n                await this.memoryStorage.remove(this.storageKey);\n              }\n              return true;\n            }),\n          ),\n      }),\n    );\n  }\n\n  async forceValue(value: TTo) {\n    await this.storeValue(value);\n    this.forcedValueSubject.next(value);\n    return value;\n  }\n\n  private storeValue(value: TTo) {\n    return this.memoryStorage.save(this.storageKey, { derived: true, value });\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { DerivedStateDependencies } from \"../../../types/state\";\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"../../abstractions/storage.service\";\nimport { DeriveDefinition } from \"../derive-definition\";\nimport { DerivedState } from \"../derived-state\";\nimport { DerivedStateProvider } from \"../derived-state.provider\";\n\nimport { DefaultDerivedState } from \"./default-derived-state\";\n\nexport class DefaultDerivedStateProvider implements DerivedStateProvider {\n  private cache: Record<string, DerivedState<unknown>> = {};\n\n  constructor(protected memoryStorage: AbstractStorageService & ObservableStorageService) {}\n\n  get<TFrom, TTo, TDeps extends DerivedStateDependencies>(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<TFrom, TTo, TDeps>,\n    dependencies: TDeps,\n  ): DerivedState<TTo> {\n    const cacheKey = deriveDefinition.buildCacheKey();\n    const existingDerivedState = this.cache[cacheKey];\n    if (existingDerivedState != null) {\n      // I have to cast out of the unknown generic but this should be safe if rules\n      // around domain token are made\n      return existingDerivedState as DefaultDerivedState<TFrom, TTo, TDeps>;\n    }\n\n    const newDerivedState = this.buildDerivedState(parentState$, deriveDefinition, dependencies);\n    this.cache[cacheKey] = newDerivedState;\n    return newDerivedState;\n  }\n\n  protected buildDerivedState<TFrom, TTo, TDeps extends DerivedStateDependencies>(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<TFrom, TTo, TDeps>,\n    dependencies: TDeps,\n  ): DerivedState<TTo> {\n    return new DefaultDerivedState<TFrom, TTo, TDeps>(\n      parentState$,\n      deriveDefinition,\n      this.memoryStorage,\n      dependencies,\n    );\n  }\n}\n","import { Observable, Subscription } from \"rxjs\";\nimport { Jsonify } from \"type-fest\";\n\nimport {\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { DeriveDefinition } from \"@bitwarden/common/platform/state\";\n// eslint-disable-next-line import/no-restricted-paths -- extending this class for this client\nimport { DefaultDerivedState } from \"@bitwarden/common/platform/state/implementations/default-derived-state\";\nimport { DerivedStateDependencies } from \"@bitwarden/common/types/state\";\n\nimport { BrowserApi } from \"../browser/browser-api\";\n\nexport class BackgroundDerivedState<\n  TFrom,\n  TTo,\n  TDeps extends DerivedStateDependencies,\n> extends DefaultDerivedState<TFrom, TTo, TDeps> {\n  private portSubscriptions: Map<chrome.runtime.Port, Subscription> = new Map();\n\n  constructor(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<TFrom, TTo, TDeps>,\n    memoryStorage: AbstractStorageService & ObservableStorageService,\n    dependencies: TDeps,\n  ) {\n    super(parentState$, deriveDefinition, memoryStorage, dependencies);\n    const portName = deriveDefinition.buildCacheKey();\n\n    // listen for foreground derived states to connect\n    BrowserApi.addListener(chrome.runtime.onConnect, (port) => {\n      if (port.name !== portName) {\n        return;\n      }\n\n      const listenerCallback = this.onMessageFromForeground.bind(this);\n      port.onDisconnect.addListener(() => {\n        this.portSubscriptions.get(port)?.unsubscribe();\n        this.portSubscriptions.delete(port);\n        port.onMessage.removeListener(listenerCallback);\n      });\n      port.onMessage.addListener(listenerCallback);\n\n      const stateSubscription = this.state$.subscribe();\n\n      this.portSubscriptions.set(port, stateSubscription);\n    });\n  }\n\n  private async onMessageFromForeground(message: DerivedStateMessage, port: chrome.runtime.Port) {\n    if (message.originator === \"background\") {\n      return;\n    }\n\n    switch (message.action) {\n      case \"nextState\": {\n        const dataObj = JSON.parse(message.data) as Jsonify<TTo>;\n        const data = this.deriveDefinition.deserialize(dataObj);\n        await this.forceValue(data);\n        await this.sendResponse(\n          message,\n          {\n            action: \"resolve\",\n          },\n          port,\n        );\n        break;\n      }\n    }\n  }\n\n  private async sendResponse(\n    originalMessage: DerivedStateMessage,\n    response: Omit<DerivedStateMessage, \"originator\" | \"id\">,\n    port: chrome.runtime.Port,\n  ) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.sendMessage(\n      {\n        ...response,\n        id: originalMessage.id,\n      },\n      port,\n    );\n  }\n\n  private async sendMessage(\n    message: Omit<DerivedStateMessage, \"originator\">,\n    port: chrome.runtime.Port,\n  ) {\n    port.postMessage({\n      ...message,\n      originator: \"background\",\n    });\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { DeriveDefinition, DerivedState } from \"@bitwarden/common/platform/state\";\n// eslint-disable-next-line import/no-restricted-paths -- extending this class for this client\nimport { DefaultDerivedStateProvider } from \"@bitwarden/common/platform/state/implementations/default-derived-state.provider\";\nimport { DerivedStateDependencies } from \"@bitwarden/common/src/types/state\";\n\nimport { BackgroundDerivedState } from \"./background-derived-state\";\n\nexport class BackgroundDerivedStateProvider extends DefaultDerivedStateProvider {\n  override buildDerivedState<TFrom, TTo, TDeps extends DerivedStateDependencies>(\n    parentState$: Observable<TFrom>,\n    deriveDefinition: DeriveDefinition<TFrom, TTo, TDeps>,\n    dependencies: TDeps,\n  ): DerivedState<TTo> {\n    return new BackgroundDerivedState(\n      parentState$,\n      deriveDefinition,\n      this.memoryStorage,\n      dependencies,\n    );\n  }\n}\n","import { StateProvider } from \"@bitwarden/common/platform/state\";\n// eslint-disable-next-line import/no-restricted-paths -- We need the implementation to inject, but generally this should not be accessed\nimport { DefaultStateProvider } from \"@bitwarden/common/platform/state/implementations/default-state.provider\";\n\nimport {\n  ActiveUserStateProviderInitOptions,\n  activeUserStateProviderFactory,\n} from \"./active-user-state-provider.factory\";\nimport {\n  DerivedStateProviderInitOptions,\n  derivedStateProviderFactory,\n} from \"./derived-state-provider.factory\";\nimport { CachedServices, FactoryOptions, factory } from \"./factory-options\";\nimport {\n  GlobalStateProviderInitOptions,\n  globalStateProviderFactory,\n} from \"./global-state-provider.factory\";\nimport {\n  SingleUserStateProviderInitOptions,\n  singleUserStateProviderFactory,\n} from \"./single-user-state-provider.factory\";\n\ntype StateProviderFactoryOptions = FactoryOptions;\n\nexport type StateProviderInitOptions = StateProviderFactoryOptions &\n  GlobalStateProviderInitOptions &\n  ActiveUserStateProviderInitOptions &\n  SingleUserStateProviderInitOptions &\n  DerivedStateProviderInitOptions;\n\nexport async function stateProviderFactory(\n  cache: { stateProvider?: StateProvider } & CachedServices,\n  opts: StateProviderInitOptions,\n): Promise<StateProvider> {\n  return factory(\n    cache,\n    \"stateProvider\",\n    opts,\n    async () =>\n      new DefaultStateProvider(\n        await activeUserStateProviderFactory(cache, opts),\n        await singleUserStateProviderFactory(cache, opts),\n        await globalStateProviderFactory(cache, opts),\n        await derivedStateProviderFactory(cache, opts),\n      ),\n  );\n}\n","import { ActiveUserStateProvider } from \"@bitwarden/common/platform/state\";\n// eslint-disable-next-line import/no-restricted-paths -- We need the implementation to inject, but generally this should not be accessed\nimport { DefaultActiveUserStateProvider } from \"@bitwarden/common/platform/state/implementations/default-active-user-state.provider\";\n\nimport {\n  AccountServiceInitOptions,\n  accountServiceFactory,\n} from \"../../../auth/background/service-factories/account-service.factory\";\n\nimport { CachedServices, FactoryOptions, factory } from \"./factory-options\";\nimport {\n  DiskStorageServiceInitOptions,\n  MemoryStorageServiceInitOptions,\n  observableDiskStorageServiceFactory,\n  observableMemoryStorageServiceFactory,\n} from \"./storage-service.factory\";\n\ntype ActiveUserStateProviderFactory = FactoryOptions;\n\nexport type ActiveUserStateProviderInitOptions = ActiveUserStateProviderFactory &\n  AccountServiceInitOptions &\n  MemoryStorageServiceInitOptions &\n  DiskStorageServiceInitOptions;\n\nexport async function activeUserStateProviderFactory(\n  cache: { activeUserStateProvider?: ActiveUserStateProvider } & CachedServices,\n  opts: ActiveUserStateProviderInitOptions,\n): Promise<ActiveUserStateProvider> {\n  return factory(\n    cache,\n    \"activeUserStateProvider\",\n    opts,\n    async () =>\n      new DefaultActiveUserStateProvider(\n        await accountServiceFactory(cache, opts),\n        await observableMemoryStorageServiceFactory(cache, opts),\n        await observableDiskStorageServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { SingleUserStateProvider } from \"@bitwarden/common/platform/state\";\n// eslint-disable-next-line import/no-restricted-paths -- We need the implementation to inject, but generally this should not be accessed\nimport { DefaultSingleUserStateProvider } from \"@bitwarden/common/platform/state/implementations/default-single-user-state.provider\";\n\nimport { CachedServices, FactoryOptions, factory } from \"./factory-options\";\nimport {\n  DiskStorageServiceInitOptions,\n  MemoryStorageServiceInitOptions,\n  observableDiskStorageServiceFactory,\n  observableMemoryStorageServiceFactory,\n} from \"./storage-service.factory\";\n\ntype SingleUserStateProviderFactoryOptions = FactoryOptions;\n\nexport type SingleUserStateProviderInitOptions = SingleUserStateProviderFactoryOptions &\n  MemoryStorageServiceInitOptions &\n  DiskStorageServiceInitOptions;\n\nexport async function singleUserStateProviderFactory(\n  cache: { singleUserStateProvider?: SingleUserStateProvider } & CachedServices,\n  opts: SingleUserStateProviderInitOptions,\n): Promise<SingleUserStateProvider> {\n  return factory(\n    cache,\n    \"singleUserStateProvider\",\n    opts,\n    async () =>\n      new DefaultSingleUserStateProvider(\n        await observableMemoryStorageServiceFactory(cache, opts),\n        await observableDiskStorageServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { DerivedStateProvider } from \"@bitwarden/common/platform/state\";\n\nimport { BackgroundDerivedStateProvider } from \"../../state/background-derived-state.provider\";\n\nimport { CachedServices, FactoryOptions, factory } from \"./factory-options\";\nimport {\n  MemoryStorageServiceInitOptions,\n  observableMemoryStorageServiceFactory,\n} from \"./storage-service.factory\";\n\ntype DerivedStateProviderFactoryOptions = FactoryOptions;\n\nexport type DerivedStateProviderInitOptions = DerivedStateProviderFactoryOptions &\n  MemoryStorageServiceInitOptions;\n\nexport async function derivedStateProviderFactory(\n  cache: { derivedStateProvider?: DerivedStateProvider } & CachedServices,\n  opts: DerivedStateProviderInitOptions,\n): Promise<DerivedStateProvider> {\n  return factory(\n    cache,\n    \"derivedStateProvider\",\n    opts,\n    async () =>\n      new BackgroundDerivedStateProvider(await observableMemoryStorageServiceFactory(cache, opts)),\n  );\n}\n","import {\n  accountServiceFactory,\n  AccountServiceInitOptions,\n} from \"../../../auth/background/service-factories/account-service.factory\";\nimport { BrowserEnvironmentService } from \"../../services/browser-environment.service\";\n\nimport { CachedServices, factory, FactoryOptions } from \"./factory-options\";\nimport { logServiceFactory, LogServiceInitOptions } from \"./log-service.factory\";\nimport { stateProviderFactory, StateProviderInitOptions } from \"./state-provider.factory\";\n\ntype EnvironmentServiceFactoryOptions = FactoryOptions;\n\nexport type EnvironmentServiceInitOptions = EnvironmentServiceFactoryOptions &\n  StateProviderInitOptions &\n  AccountServiceInitOptions &\n  LogServiceInitOptions;\n\nexport function environmentServiceFactory(\n  cache: { environmentService?: BrowserEnvironmentService } & CachedServices,\n  opts: EnvironmentServiceInitOptions,\n): Promise<BrowserEnvironmentService> {\n  return factory(\n    cache,\n    \"environmentService\",\n    opts,\n    async () =>\n      new BrowserEnvironmentService(\n        await logServiceFactory(cache, opts),\n        await stateProviderFactory(cache, opts),\n        await accountServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\n\nimport {\n  accountServiceFactory,\n  AccountServiceInitOptions,\n} from \"../../../auth/background/service-factories/account-service.factory\";\nimport { Account } from \"../../../models/account\";\nimport { BrowserStateService } from \"../../services/browser-state.service\";\n\nimport {\n  environmentServiceFactory,\n  EnvironmentServiceInitOptions,\n} from \"./environment-service.factory\";\nimport { CachedServices, factory, FactoryOptions } from \"./factory-options\";\nimport { logServiceFactory, LogServiceInitOptions } from \"./log-service.factory\";\nimport { migrationRunnerFactory, MigrationRunnerInitOptions } from \"./migration-runner.factory\";\nimport {\n  diskStorageServiceFactory,\n  secureStorageServiceFactory,\n  memoryStorageServiceFactory,\n  DiskStorageServiceInitOptions,\n  SecureStorageServiceInitOptions,\n  MemoryStorageServiceInitOptions,\n} from \"./storage-service.factory\";\n\ntype StateServiceFactoryOptions = FactoryOptions & {\n  stateServiceOptions: {\n    useAccountCache?: boolean;\n    stateFactory: StateFactory<GlobalState, Account>;\n  };\n};\n\nexport type StateServiceInitOptions = StateServiceFactoryOptions &\n  DiskStorageServiceInitOptions &\n  SecureStorageServiceInitOptions &\n  MemoryStorageServiceInitOptions &\n  LogServiceInitOptions &\n  AccountServiceInitOptions &\n  EnvironmentServiceInitOptions &\n  MigrationRunnerInitOptions;\n\nexport async function stateServiceFactory(\n  cache: { stateService?: BrowserStateService } & CachedServices,\n  opts: StateServiceInitOptions,\n): Promise<BrowserStateService> {\n  const service = await factory(\n    cache,\n    \"stateService\",\n    opts,\n    async () =>\n      new BrowserStateService(\n        await diskStorageServiceFactory(cache, opts),\n        await secureStorageServiceFactory(cache, opts),\n        await memoryStorageServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n        opts.stateServiceOptions.stateFactory,\n        await accountServiceFactory(cache, opts),\n        await environmentServiceFactory(cache, opts),\n        await migrationRunnerFactory(cache, opts),\n        opts.stateServiceOptions.useAccountCache,\n      ),\n  );\n  // TODO: If we run migration through a chrome installed/updated event we can turn off running migrations\n  await service.init();\n  return service;\n}\n","import { MigrationBuilderService } from \"@bitwarden/common/platform/services/migration-builder.service\";\nimport { MigrationRunner } from \"@bitwarden/common/platform/services/migration-runner\";\n\nimport { CachedServices, FactoryOptions, factory } from \"./factory-options\";\nimport { LogServiceInitOptions, logServiceFactory } from \"./log-service.factory\";\nimport {\n  DiskStorageServiceInitOptions,\n  diskStorageServiceFactory,\n} from \"./storage-service.factory\";\n\ntype MigrationRunnerFactory = FactoryOptions;\n\nexport type MigrationRunnerInitOptions = MigrationRunnerFactory &\n  DiskStorageServiceInitOptions &\n  LogServiceInitOptions;\n\nexport async function migrationRunnerFactory(\n  cache: { migrationRunner?: MigrationRunner } & CachedServices,\n  opts: MigrationRunnerInitOptions,\n): Promise<MigrationRunner> {\n  return factory(\n    cache,\n    \"migrationRunner\",\n    opts,\n    async () =>\n      new MigrationRunner(\n        await diskStorageServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n        new MigrationBuilderService(),\n      ),\n  );\n}\n","import { TokenService as AbstractTokenService } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { TokenService } from \"@bitwarden/common/auth/services/token.service\";\n\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../../platform/background/service-factories/state-service.factory\";\n\ntype TokenServiceFactoryOptions = FactoryOptions;\n\nexport type TokenServiceInitOptions = TokenServiceFactoryOptions & StateServiceInitOptions;\n\nexport function tokenServiceFactory(\n  cache: { tokenService?: AbstractTokenService } & CachedServices,\n  opts: TokenServiceInitOptions,\n): Promise<AbstractTokenService> {\n  return factory(\n    cache,\n    \"tokenService\",\n    opts,\n    async () => new TokenService(await stateServiceFactory(cache, opts)),\n  );\n}\n","import { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\n\nimport BrowserPlatformUtilsService from \"../../services/browser-platform-utils.service\";\n\nimport { CachedServices, factory, FactoryOptions } from \"./factory-options\";\nimport { MessagingServiceInitOptions, messagingServiceFactory } from \"./messaging-service.factory\";\n\ntype PlatformUtilsServiceFactoryOptions = FactoryOptions & {\n  platformUtilsServiceOptions: {\n    clipboardWriteCallback: (clipboardValue: string, clearMs: number) => Promise<void>;\n    biometricCallback: () => Promise<boolean>;\n    win: Window & typeof globalThis;\n  };\n};\n\nexport type PlatformUtilsServiceInitOptions = PlatformUtilsServiceFactoryOptions &\n  MessagingServiceInitOptions;\n\nexport function platformUtilsServiceFactory(\n  cache: { platformUtilsService?: PlatformUtilsService } & CachedServices,\n  opts: PlatformUtilsServiceInitOptions,\n): Promise<PlatformUtilsService> {\n  return factory(\n    cache,\n    \"platformUtilsService\",\n    opts,\n    async () =>\n      new BrowserPlatformUtilsService(\n        await messagingServiceFactory(cache, opts),\n        opts.platformUtilsServiceOptions.clipboardWriteCallback,\n        opts.platformUtilsServiceOptions.biometricCallback,\n        opts.platformUtilsServiceOptions.win,\n      ),\n  );\n}\n","import { ApiService as AbstractApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport { ApiService } from \"@bitwarden/common/services/api.service\";\n\nimport {\n  tokenServiceFactory,\n  TokenServiceInitOptions,\n} from \"../../../auth/background/service-factories/token-service.factory\";\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../background/service-factories/factory-options\";\n\nimport { AppIdServiceInitOptions, appIdServiceFactory } from \"./app-id-service.factory\";\nimport {\n  environmentServiceFactory,\n  EnvironmentServiceInitOptions,\n} from \"./environment-service.factory\";\nimport {\n  PlatformUtilsServiceInitOptions,\n  platformUtilsServiceFactory,\n} from \"./platform-utils-service.factory\";\n\ntype ApiServiceFactoryOptions = FactoryOptions & {\n  apiServiceOptions: {\n    logoutCallback: (expired: boolean) => Promise<void>;\n    customUserAgent?: string;\n  };\n};\n\nexport type ApiServiceInitOptions = ApiServiceFactoryOptions &\n  TokenServiceInitOptions &\n  PlatformUtilsServiceInitOptions &\n  EnvironmentServiceInitOptions &\n  AppIdServiceInitOptions;\n\nexport function apiServiceFactory(\n  cache: { apiService?: AbstractApiService } & CachedServices,\n  opts: ApiServiceInitOptions,\n): Promise<AbstractApiService> {\n  return factory(\n    cache,\n    \"apiService\",\n    opts,\n    async () =>\n      new ApiService(\n        await tokenServiceFactory(cache, opts),\n        await platformUtilsServiceFactory(cache, opts),\n        await environmentServiceFactory(cache, opts),\n        await appIdServiceFactory(cache, opts),\n        opts.apiServiceOptions.logoutCallback,\n        opts.apiServiceOptions.customUserAgent,\n      ),\n  );\n}\n","import { DiskStorageOptions } from \"@koa/multer\";\n\nimport { AppIdService as AbstractAppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { AppIdService } from \"@bitwarden/common/platform/services/app-id.service\";\n\nimport { FactoryOptions, CachedServices, factory } from \"./factory-options\";\nimport { diskStorageServiceFactory } from \"./storage-service.factory\";\n\ntype AppIdServiceFactoryOptions = FactoryOptions;\n\nexport type AppIdServiceInitOptions = AppIdServiceFactoryOptions & DiskStorageOptions;\n\nexport function appIdServiceFactory(\n  cache: { appIdService?: AbstractAppIdService } & CachedServices,\n  opts: AppIdServiceInitOptions,\n): Promise<AbstractAppIdService> {\n  return factory(\n    cache,\n    \"appIdService\",\n    opts,\n    async () => new AppIdService(await diskStorageServiceFactory(cache, opts)),\n  );\n}\n","import { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { OrgKey } from \"../../../types/key\";\nimport { EncryptedOrganizationKeyData } from \"../data/encrypted-organization-key.data\";\n\nexport abstract class BaseEncryptedOrganizationKey {\n  decrypt: (cryptoService: CryptoService) => Promise<SymmetricCryptoKey>;\n\n  static fromData(data: EncryptedOrganizationKeyData) {\n    switch (data.type) {\n      case \"organization\":\n        return new EncryptedOrganizationKey(data.key);\n\n      case \"provider\":\n        return new ProviderEncryptedOrganizationKey(data.key, data.providerId);\n\n      default:\n        return null;\n    }\n  }\n}\n\nexport class EncryptedOrganizationKey implements BaseEncryptedOrganizationKey {\n  constructor(private key: string) {}\n\n  async decrypt(cryptoService: CryptoService) {\n    const decValue = await cryptoService.rsaDecrypt(this.key);\n    return new SymmetricCryptoKey(decValue) as OrgKey;\n  }\n\n  toData(): EncryptedOrganizationKeyData {\n    return {\n      type: \"organization\",\n      key: this.key,\n    };\n  }\n}\n\nexport class ProviderEncryptedOrganizationKey implements BaseEncryptedOrganizationKey {\n  constructor(\n    private key: string,\n    private providerId: string,\n  ) {}\n\n  async decrypt(cryptoService: CryptoService) {\n    const providerKey = await cryptoService.getProviderKey(this.providerId);\n    const decValue = await cryptoService.decryptToBytes(new EncString(this.key), providerKey);\n    return new SymmetricCryptoKey(decValue) as OrgKey;\n  }\n\n  toData(): EncryptedOrganizationKeyData {\n    return {\n      type: \"provider\",\n      key: this.key,\n      providerId: this.providerId,\n    };\n  }\n}\n","import { EncryptedOrganizationKeyData } from \"../../../admin-console/models/data/encrypted-organization-key.data\";\nimport { BaseEncryptedOrganizationKey } from \"../../../admin-console/models/domain/encrypted-organization-key\";\nimport { OrganizationId } from \"../../../types/guid\";\nimport { OrgKey } from \"../../../types/key\";\nimport { CryptoService } from \"../../abstractions/crypto.service\";\nimport { SymmetricCryptoKey } from \"../../models/domain/symmetric-crypto-key\";\nimport { KeyDefinition, CRYPTO_DISK, DeriveDefinition } from \"../../state\";\n\nexport const USER_ENCRYPTED_ORGANIZATION_KEYS = KeyDefinition.record<\n  EncryptedOrganizationKeyData,\n  OrganizationId\n>(CRYPTO_DISK, \"organizationKeys\", {\n  deserializer: (obj) => obj,\n});\n\nexport const USER_ORGANIZATION_KEYS = DeriveDefinition.from<\n  Record<OrganizationId, EncryptedOrganizationKeyData>,\n  Record<OrganizationId, OrgKey>,\n  { cryptoService: CryptoService }\n>(USER_ENCRYPTED_ORGANIZATION_KEYS, {\n  deserializer: (obj) => {\n    const result: Record<OrganizationId, OrgKey> = {};\n    for (const orgId of Object.keys(obj ?? {}) as OrganizationId[]) {\n      result[orgId] = SymmetricCryptoKey.fromJSON(obj[orgId]) as OrgKey;\n    }\n    return result;\n  },\n  derive: async (from, { cryptoService }) => {\n    const result: Record<OrganizationId, OrgKey> = {};\n    for (const orgId of Object.keys(from ?? {}) as OrganizationId[]) {\n      if (result[orgId] != null) {\n        continue;\n      }\n      const encrypted = BaseEncryptedOrganizationKey.fromData(from[orgId]);\n      const decrypted = await encrypted.decrypt(cryptoService);\n\n      result[orgId] = decrypted;\n    }\n\n    return result;\n  },\n});\n","import { ProviderId } from \"../../../types/guid\";\nimport { ProviderKey } from \"../../../types/key\";\nimport { EncryptService } from \"../../abstractions/encrypt.service\";\nimport { EncString, EncryptedString } from \"../../models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../models/domain/symmetric-crypto-key\";\nimport { KeyDefinition, CRYPTO_DISK, DeriveDefinition } from \"../../state\";\nimport { CryptoService } from \"../crypto.service\";\n\nexport const USER_ENCRYPTED_PROVIDER_KEYS = KeyDefinition.record<EncryptedString, ProviderId>(\n  CRYPTO_DISK,\n  \"providerKeys\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n\nexport const USER_PROVIDER_KEYS = DeriveDefinition.from<\n  Record<ProviderId, EncryptedString>,\n  Record<ProviderId, ProviderKey>,\n  { encryptService: EncryptService; cryptoService: CryptoService } // TODO: This should depend on an active user private key observable directly\n>(USER_ENCRYPTED_PROVIDER_KEYS, {\n  deserializer: (obj) => {\n    const result: Record<ProviderId, ProviderKey> = {};\n    for (const providerId of Object.keys(obj ?? {}) as ProviderId[]) {\n      result[providerId] = SymmetricCryptoKey.fromJSON(obj[providerId]) as ProviderKey;\n    }\n    return result;\n  },\n  derive: async (from, { encryptService, cryptoService }) => {\n    const result: Record<ProviderId, ProviderKey> = {};\n    for (const providerId of Object.keys(from ?? {}) as ProviderId[]) {\n      if (result[providerId] != null) {\n        continue;\n      }\n      const encrypted = new EncString(from[providerId]);\n      const privateKey = await cryptoService.getPrivateKey();\n      const decrypted = await encryptService.rsaDecrypt(encrypted, privateKey);\n      const providerKey = new SymmetricCryptoKey(decrypted) as ProviderKey;\n\n      result[providerId] = providerKey;\n    }\n\n    return result;\n  },\n});\n","import { UserPrivateKey, UserPublicKey, UserKey } from \"../../../types/key\";\nimport { CryptoFunctionService } from \"../../abstractions/crypto-function.service\";\nimport { EncryptService } from \"../../abstractions/encrypt.service\";\nimport { EncString, EncryptedString } from \"../../models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../models/domain/symmetric-crypto-key\";\nimport { KeyDefinition, CRYPTO_DISK, DeriveDefinition, CRYPTO_MEMORY } from \"../../state\";\nimport { CryptoService } from \"../crypto.service\";\n\nexport const USER_EVER_HAD_USER_KEY = new KeyDefinition<boolean>(CRYPTO_DISK, \"everHadUserKey\", {\n  deserializer: (obj) => obj,\n});\n\nexport const USER_ENCRYPTED_PRIVATE_KEY = new KeyDefinition<EncryptedString>(\n  CRYPTO_DISK,\n  \"privateKey\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n\nexport const USER_PRIVATE_KEY = DeriveDefinition.fromWithUserId<\n  EncryptedString,\n  UserPrivateKey,\n  // TODO: update cryptoService to user key directly\n  { encryptService: EncryptService; cryptoService: CryptoService }\n>(USER_ENCRYPTED_PRIVATE_KEY, {\n  deserializer: (obj) => new Uint8Array(Object.values(obj)) as UserPrivateKey,\n  derive: async ([userId, encPrivateKeyString], { encryptService, cryptoService }) => {\n    if (encPrivateKeyString == null) {\n      return null;\n    }\n\n    const userKey = await cryptoService.getUserKey(userId);\n    if (userKey == null) {\n      return null;\n    }\n\n    const encPrivateKey = new EncString(encPrivateKeyString);\n    const privateKey = (await encryptService.decryptToBytes(\n      encPrivateKey,\n      userKey,\n    )) as UserPrivateKey;\n    return privateKey;\n  },\n});\n\nexport const USER_PUBLIC_KEY = DeriveDefinition.from<\n  UserPrivateKey,\n  UserPublicKey,\n  { cryptoFunctionService: CryptoFunctionService }\n>([USER_PRIVATE_KEY, \"publicKey\"], {\n  deserializer: (obj) => new Uint8Array(Object.values(obj)) as UserPublicKey,\n  derive: async (privateKey, { cryptoFunctionService }) => {\n    if (privateKey == null) {\n      return null;\n    }\n\n    return (await cryptoFunctionService.rsaExtractPublicKey(privateKey)) as UserPublicKey;\n  },\n});\nexport const USER_KEY = new KeyDefinition<UserKey>(CRYPTO_MEMORY, \"userKey\", {\n  deserializer: (obj) => SymmetricCryptoKey.fromJSON(obj) as UserKey,\n});\n","import * as bigInt from \"big-integer\";\nimport { Observable, firstValueFrom, map } from \"rxjs\";\n\nimport { EncryptedOrganizationKeyData } from \"../../admin-console/models/data/encrypted-organization-key.data\";\nimport { ProfileOrganizationResponse } from \"../../admin-console/models/response/profile-organization.response\";\nimport { ProfileProviderOrganizationResponse } from \"../../admin-console/models/response/profile-provider-organization.response\";\nimport { ProfileProviderResponse } from \"../../admin-console/models/response/profile-provider.response\";\nimport { AccountService } from \"../../auth/abstractions/account.service\";\nimport { AuthenticationStatus } from \"../../auth/enums/authentication-status\";\nimport { KdfConfig } from \"../../auth/models/domain/kdf-config\";\nimport { Utils } from \"../../platform/misc/utils\";\nimport { CsprngArray } from \"../../types/csprng\";\nimport { OrganizationId, ProviderId, UserId } from \"../../types/guid\";\nimport {\n  OrgKey,\n  UserKey,\n  MasterKey,\n  ProviderKey,\n  PinKey,\n  CipherKey,\n  UserPrivateKey,\n  UserPublicKey,\n} from \"../../types/key\";\nimport { CryptoFunctionService } from \"../abstractions/crypto-function.service\";\nimport { CryptoService as CryptoServiceAbstraction } from \"../abstractions/crypto.service\";\nimport { EncryptService } from \"../abstractions/encrypt.service\";\nimport { KeyGenerationService } from \"../abstractions/key-generation.service\";\nimport { LogService } from \"../abstractions/log.service\";\nimport { PlatformUtilsService } from \"../abstractions/platform-utils.service\";\nimport { StateService } from \"../abstractions/state.service\";\nimport {\n  KeySuffixOptions,\n  HashPurpose,\n  KdfType,\n  ARGON2_ITERATIONS,\n  ARGON2_MEMORY,\n  ARGON2_PARALLELISM,\n  EncryptionType,\n  PBKDF2_ITERATIONS,\n} from \"../enums\";\nimport { sequentialize } from \"../misc/sequentialize\";\nimport { EFFLongWordList } from \"../misc/wordlist\";\nimport { EncArrayBuffer } from \"../models/domain/enc-array-buffer\";\nimport { EncString, EncryptedString } from \"../models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../models/domain/symmetric-crypto-key\";\nimport { ActiveUserState, DerivedState, StateProvider } from \"../state\";\n\nimport {\n  USER_ENCRYPTED_ORGANIZATION_KEYS,\n  USER_ORGANIZATION_KEYS,\n} from \"./key-state/org-keys.state\";\nimport { USER_ENCRYPTED_PROVIDER_KEYS, USER_PROVIDER_KEYS } from \"./key-state/provider-keys.state\";\nimport {\n  USER_ENCRYPTED_PRIVATE_KEY,\n  USER_EVER_HAD_USER_KEY,\n  USER_PRIVATE_KEY,\n  USER_PUBLIC_KEY,\n  USER_KEY,\n} from \"./key-state/user-key.state\";\n\nexport class CryptoService implements CryptoServiceAbstraction {\n  private readonly activeUserKeyState: ActiveUserState<UserKey>;\n  private readonly activeUserEverHadUserKey: ActiveUserState<boolean>;\n  private readonly activeUserEncryptedOrgKeysState: ActiveUserState<\n    Record<OrganizationId, EncryptedOrganizationKeyData>\n  >;\n  private readonly activeUserOrgKeysState: DerivedState<Record<OrganizationId, OrgKey>>;\n  private readonly activeUserEncryptedProviderKeysState: ActiveUserState<\n    Record<ProviderId, EncryptedString>\n  >;\n  private readonly activeUserProviderKeysState: DerivedState<Record<ProviderId, ProviderKey>>;\n  private readonly activeUserEncryptedPrivateKeyState: ActiveUserState<EncryptedString>;\n  private readonly activeUserPrivateKeyState: DerivedState<UserPrivateKey>;\n  private readonly activeUserPublicKeyState: DerivedState<UserPublicKey>;\n\n  readonly activeUserKey$: Observable<UserKey>;\n\n  readonly activeUserOrgKeys$: Observable<Record<OrganizationId, OrgKey>>;\n  readonly activeUserProviderKeys$: Observable<Record<ProviderId, ProviderKey>>;\n  readonly activeUserPrivateKey$: Observable<UserPrivateKey>;\n  readonly activeUserPublicKey$: Observable<UserPublicKey>;\n  readonly everHadUserKey$: Observable<boolean>;\n\n  constructor(\n    protected keyGenerationService: KeyGenerationService,\n    protected cryptoFunctionService: CryptoFunctionService,\n    protected encryptService: EncryptService,\n    protected platformUtilService: PlatformUtilsService,\n    protected logService: LogService,\n    protected stateService: StateService,\n    protected accountService: AccountService,\n    protected stateProvider: StateProvider,\n  ) {\n    // User Key\n    this.activeUserKeyState = stateProvider.getActive(USER_KEY);\n    this.activeUserKey$ = this.activeUserKeyState.state$;\n    this.activeUserEverHadUserKey = stateProvider.getActive(USER_EVER_HAD_USER_KEY);\n    this.everHadUserKey$ = this.activeUserEverHadUserKey.state$.pipe(map((x) => x ?? false));\n\n    // User Asymmetric Key Pair\n    this.activeUserEncryptedPrivateKeyState = stateProvider.getActive(USER_ENCRYPTED_PRIVATE_KEY);\n    this.activeUserPrivateKeyState = stateProvider.getDerived(\n      this.activeUserEncryptedPrivateKeyState.combinedState$,\n      USER_PRIVATE_KEY,\n      {\n        encryptService: this.encryptService,\n        cryptoService: this,\n      },\n    );\n    this.activeUserPrivateKey$ = this.activeUserPrivateKeyState.state$; // may be null\n    this.activeUserPublicKeyState = stateProvider.getDerived(\n      this.activeUserPrivateKey$,\n      USER_PUBLIC_KEY,\n      {\n        cryptoFunctionService: this.cryptoFunctionService,\n      },\n    );\n    this.activeUserPublicKey$ = this.activeUserPublicKeyState.state$; // may be null\n\n    // Organization keys\n    this.activeUserEncryptedOrgKeysState = stateProvider.getActive(\n      USER_ENCRYPTED_ORGANIZATION_KEYS,\n    );\n    this.activeUserOrgKeysState = stateProvider.getDerived(\n      this.activeUserEncryptedOrgKeysState.state$,\n      USER_ORGANIZATION_KEYS,\n      { cryptoService: this },\n    );\n    this.activeUserOrgKeys$ = this.activeUserOrgKeysState.state$; // null handled by `derive` function\n\n    // Provider keys\n    this.activeUserEncryptedProviderKeysState = stateProvider.getActive(\n      USER_ENCRYPTED_PROVIDER_KEYS,\n    );\n    this.activeUserProviderKeysState = stateProvider.getDerived(\n      this.activeUserEncryptedProviderKeysState.state$,\n      USER_PROVIDER_KEYS,\n      { encryptService: this.encryptService, cryptoService: this },\n    );\n    this.activeUserProviderKeys$ = this.activeUserProviderKeysState.state$; // null handled by `derive` function\n  }\n\n  async setUserKey(key: UserKey, userId?: UserId): Promise<void> {\n    if (key == null) {\n      throw new Error(\"No key provided. Use ClearUserKey to clear the key\");\n    }\n    // Set userId to ensure we have one for the account status update\n    [userId, key] = await this.stateProvider.setUserState(USER_KEY, key, userId);\n    await this.stateProvider.setUserState(USER_EVER_HAD_USER_KEY, true, userId);\n\n    await this.accountService.setAccountStatus(userId, AuthenticationStatus.Unlocked);\n\n    await this.storeAdditionalKeys(key, userId);\n  }\n\n  async refreshAdditionalKeys(): Promise<void> {\n    const key = await this.getUserKey();\n    await this.setUserKey(key);\n  }\n\n  async getUserKey(userId?: UserId): Promise<UserKey> {\n    let userKey = await firstValueFrom(this.stateProvider.getUserState$(USER_KEY, userId));\n    if (userKey) {\n      return userKey;\n    }\n\n    // If the user has set their vault timeout to 'Never', we can load the user key from storage\n    if (await this.hasUserKeyStored(KeySuffixOptions.Auto, userId)) {\n      userKey = await this.getKeyFromStorage(KeySuffixOptions.Auto, userId);\n      if (userKey) {\n        await this.setUserKey(userKey, userId);\n        return userKey;\n      }\n    }\n  }\n\n  async isLegacyUser(masterKey?: MasterKey, userId?: UserId): Promise<boolean> {\n    return await this.validateUserKey(\n      (masterKey ?? (await this.getMasterKey(userId))) as unknown as UserKey,\n    );\n  }\n\n  async getUserKeyWithLegacySupport(userId?: UserId): Promise<UserKey> {\n    const userKey = await this.getUserKey(userId);\n    if (userKey) {\n      return userKey;\n    }\n\n    // Legacy support: encryption used to be done with the master key (derived from master password).\n    // Users who have not migrated will have a null user key and must use the master key instead.\n    return (await this.getMasterKey(userId)) as unknown as UserKey;\n  }\n\n  async getUserKeyFromStorage(keySuffix: KeySuffixOptions, userId?: UserId): Promise<UserKey> {\n    const userKey = await this.getKeyFromStorage(keySuffix, userId);\n    if (userKey) {\n      if (!(await this.validateUserKey(userKey))) {\n        this.logService.warning(\"Invalid key, throwing away stored keys\");\n        await this.clearAllStoredUserKeys(userId);\n      }\n      return userKey;\n    }\n  }\n\n  async hasUserKey(): Promise<boolean> {\n    return (\n      (await this.hasUserKeyInMemory()) || (await this.hasUserKeyStored(KeySuffixOptions.Auto))\n    );\n  }\n\n  async hasUserKeyInMemory(userId?: UserId): Promise<boolean> {\n    return (await firstValueFrom(this.stateProvider.getUserState$(USER_KEY, userId))) != null;\n  }\n\n  async hasUserKeyStored(keySuffix: KeySuffixOptions, userId?: UserId): Promise<boolean> {\n    return (await this.getKeyFromStorage(keySuffix, userId)) != null;\n  }\n\n  async makeUserKey(masterKey: MasterKey): Promise<[UserKey, EncString]> {\n    masterKey ||= await this.getMasterKey();\n    if (masterKey == null) {\n      throw new Error(\"No Master Key found.\");\n    }\n\n    const newUserKey = await this.keyGenerationService.createKey(512);\n    return this.buildProtectedSymmetricKey(masterKey, newUserKey.key);\n  }\n\n  async clearUserKey(clearStoredKeys = true, userId?: UserId): Promise<void> {\n    // Set userId to ensure we have one for the account status update\n    [userId] = await this.stateProvider.setUserState(USER_KEY, null, userId);\n    await this.accountService.setMaxAccountStatus(userId, AuthenticationStatus.Locked);\n    if (clearStoredKeys) {\n      await this.clearAllStoredUserKeys(userId);\n    }\n  }\n\n  async clearStoredUserKey(keySuffix: KeySuffixOptions, userId?: UserId): Promise<void> {\n    if (keySuffix === KeySuffixOptions.Auto) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.stateService.setUserKeyAutoUnlock(null, { userId: userId });\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.clearDeprecatedKeys(KeySuffixOptions.Auto, userId);\n    }\n    if (keySuffix === KeySuffixOptions.Pin) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.stateService.setPinKeyEncryptedUserKeyEphemeral(null, { userId: userId });\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.clearDeprecatedKeys(KeySuffixOptions.Pin, userId);\n    }\n  }\n\n  async setMasterKeyEncryptedUserKey(userKeyMasterKey: string, userId?: UserId): Promise<void> {\n    await this.stateService.setMasterKeyEncryptedUserKey(userKeyMasterKey, { userId: userId });\n  }\n\n  async setMasterKey(key: MasterKey, userId?: UserId): Promise<void> {\n    await this.stateService.setMasterKey(key, { userId: userId });\n  }\n\n  async getMasterKey(userId?: UserId): Promise<MasterKey> {\n    let masterKey = await this.stateService.getMasterKey({ userId: userId });\n    if (!masterKey) {\n      masterKey = (await this.stateService.getCryptoMasterKey({ userId: userId })) as MasterKey;\n      // if master key was null/undefined and getCryptoMasterKey also returned null/undefined,\n      // don't set master key as it is unnecessary\n      if (masterKey) {\n        await this.setMasterKey(masterKey, userId);\n      }\n    }\n    return masterKey;\n  }\n\n  async getOrDeriveMasterKey(password: string, userId?: UserId) {\n    let masterKey = await this.getMasterKey(userId);\n    return (masterKey ||= await this.makeMasterKey(\n      password,\n      await this.stateService.getEmail({ userId: userId }),\n      await this.stateService.getKdfType({ userId: userId }),\n      await this.stateService.getKdfConfig({ userId: userId }),\n    ));\n  }\n\n  /**\n   * Derive a master key from a password and email.\n   *\n   * @remarks\n   * Does not validate the kdf config to ensure it satisfies the minimum requirements for the given kdf type.\n   */\n  async makeMasterKey(\n    password: string,\n    email: string,\n    kdf: KdfType,\n    KdfConfig: KdfConfig,\n  ): Promise<MasterKey> {\n    return (await this.keyGenerationService.deriveKeyFromPassword(\n      password,\n      email,\n      kdf,\n      KdfConfig,\n    )) as MasterKey;\n  }\n\n  async clearMasterKey(userId?: UserId): Promise<void> {\n    await this.stateService.setMasterKey(null, { userId: userId });\n  }\n\n  async encryptUserKeyWithMasterKey(\n    masterKey: MasterKey,\n    userKey?: UserKey,\n  ): Promise<[UserKey, EncString]> {\n    userKey ||= await this.getUserKey();\n    return await this.buildProtectedSymmetricKey(masterKey, userKey.key);\n  }\n\n  async decryptUserKeyWithMasterKey(\n    masterKey: MasterKey,\n    userKey?: EncString,\n    userId?: UserId,\n  ): Promise<UserKey> {\n    masterKey ||= await this.getMasterKey(userId);\n    if (masterKey == null) {\n      throw new Error(\"No master key found.\");\n    }\n\n    if (!userKey) {\n      let masterKeyEncryptedUserKey = await this.stateService.getMasterKeyEncryptedUserKey({\n        userId: userId,\n      });\n\n      // Try one more way to get the user key if it still wasn't found.\n      if (masterKeyEncryptedUserKey == null) {\n        masterKeyEncryptedUserKey = await this.stateService.getEncryptedCryptoSymmetricKey({\n          userId: userId,\n        });\n      }\n\n      if (masterKeyEncryptedUserKey == null) {\n        throw new Error(\"No encrypted user key found.\");\n      }\n      userKey = new EncString(masterKeyEncryptedUserKey);\n    }\n\n    let decUserKey: Uint8Array;\n    if (userKey.encryptionType === EncryptionType.AesCbc256_B64) {\n      decUserKey = await this.encryptService.decryptToBytes(userKey, masterKey);\n    } else if (userKey.encryptionType === EncryptionType.AesCbc256_HmacSha256_B64) {\n      const newKey = await this.stretchKey(masterKey);\n      decUserKey = await this.encryptService.decryptToBytes(userKey, newKey);\n    } else {\n      throw new Error(\"Unsupported encryption type.\");\n    }\n    if (decUserKey == null) {\n      return null;\n    }\n\n    return new SymmetricCryptoKey(decUserKey) as UserKey;\n  }\n\n  async hashMasterKey(\n    password: string,\n    key: MasterKey,\n    hashPurpose?: HashPurpose,\n  ): Promise<string> {\n    key ||= await this.getMasterKey();\n\n    if (password == null || key == null) {\n      throw new Error(\"Invalid parameters.\");\n    }\n\n    const iterations = hashPurpose === HashPurpose.LocalAuthorization ? 2 : 1;\n    const hash = await this.cryptoFunctionService.pbkdf2(key.key, password, \"sha256\", iterations);\n    return Utils.fromBufferToB64(hash);\n  }\n\n  async setMasterKeyHash(keyHash: string): Promise<void> {\n    await this.stateService.setKeyHash(keyHash);\n  }\n\n  async getMasterKeyHash(): Promise<string> {\n    return await this.stateService.getKeyHash();\n  }\n\n  async clearMasterKeyHash(userId?: UserId): Promise<void> {\n    return await this.stateService.setKeyHash(null, { userId: userId });\n  }\n\n  async compareAndUpdateKeyHash(masterPassword: string, masterKey: MasterKey): Promise<boolean> {\n    const storedPasswordHash = await this.getMasterKeyHash();\n    if (masterPassword != null && storedPasswordHash != null) {\n      const localKeyHash = await this.hashMasterKey(\n        masterPassword,\n        masterKey,\n        HashPurpose.LocalAuthorization,\n      );\n      if (localKeyHash != null && storedPasswordHash === localKeyHash) {\n        return true;\n      }\n\n      // TODO: remove serverKeyHash check in 1-2 releases after everyone's keyHash has been updated\n      const serverKeyHash = await this.hashMasterKey(\n        masterPassword,\n        masterKey,\n        HashPurpose.ServerAuthorization,\n      );\n      if (serverKeyHash != null && storedPasswordHash === serverKeyHash) {\n        await this.setMasterKeyHash(localKeyHash);\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  async setOrgKeys(\n    orgs: ProfileOrganizationResponse[] = [],\n    providerOrgs: ProfileProviderOrganizationResponse[] = [],\n  ): Promise<void> {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.activeUserEncryptedOrgKeysState.update((_) => {\n      const encOrgKeyData: { [orgId: string]: EncryptedOrganizationKeyData } = {};\n\n      orgs.forEach((org) => {\n        encOrgKeyData[org.id] = {\n          type: \"organization\",\n          key: org.key,\n        };\n      });\n\n      providerOrgs.forEach((org) => {\n        encOrgKeyData[org.id] = {\n          type: \"provider\",\n          providerId: org.providerId,\n          key: org.key,\n        };\n      });\n\n      return encOrgKeyData;\n    });\n  }\n\n  async getOrgKey(orgId: OrganizationId): Promise<OrgKey> {\n    return (await firstValueFrom(this.activeUserOrgKeys$))[orgId];\n  }\n\n  @sequentialize(() => \"getOrgKeys\")\n  async getOrgKeys(): Promise<Record<string, OrgKey>> {\n    return await firstValueFrom(this.activeUserOrgKeys$);\n  }\n\n  async makeDataEncKey<T extends OrgKey | UserKey>(\n    key: T,\n  ): Promise<[SymmetricCryptoKey, EncString]> {\n    if (key == null) {\n      throw new Error(\"No key provided\");\n    }\n\n    const newSymKey = await this.keyGenerationService.createKey(512);\n    return this.buildProtectedSymmetricKey(key, newSymKey.key);\n  }\n\n  async clearOrgKeys(memoryOnly?: boolean, userId?: UserId): Promise<void> {\n    const activeUserId = (await firstValueFrom(this.accountService.activeAccount$))?.id;\n    const userIdIsActive = userId == null || userId === activeUserId;\n\n    if (!memoryOnly) {\n      if (userId == null && activeUserId == null) {\n        // nothing to do\n        return;\n      }\n      await this.stateProvider\n        .getUser(userId ?? activeUserId, USER_ENCRYPTED_ORGANIZATION_KEYS)\n        .update(() => null);\n      return;\n    }\n\n    // org keys are only cached for active users\n    if (userIdIsActive) {\n      await this.activeUserOrgKeysState.forceValue({});\n    }\n  }\n\n  async setProviderKeys(providers: ProfileProviderResponse[]): Promise<void> {\n    await this.activeUserEncryptedProviderKeysState.update((_) => {\n      const encProviderKeys: { [providerId: ProviderId]: EncryptedString } = {};\n\n      providers.forEach((provider) => {\n        encProviderKeys[provider.id as ProviderId] = provider.key as EncryptedString;\n      });\n\n      return encProviderKeys;\n    });\n  }\n\n  async getProviderKey(providerId: ProviderId): Promise<ProviderKey> {\n    if (providerId == null) {\n      return null;\n    }\n\n    return (await firstValueFrom(this.activeUserProviderKeys$))[providerId] ?? null;\n  }\n\n  @sequentialize(() => \"getProviderKeys\")\n  async getProviderKeys(): Promise<Record<ProviderId, ProviderKey>> {\n    return await firstValueFrom(this.activeUserProviderKeys$);\n  }\n\n  async clearProviderKeys(memoryOnly?: boolean, userId?: UserId): Promise<void> {\n    const activeUserId = (await firstValueFrom(this.accountService.activeAccount$))?.id;\n    const userIdIsActive = userId == null || userId === activeUserId;\n\n    if (!memoryOnly) {\n      if (userId == null && activeUserId == null) {\n        // nothing to do\n        return;\n      }\n      await this.stateProvider\n        .getUser(userId ?? activeUserId, USER_ENCRYPTED_PROVIDER_KEYS)\n        .update(() => null);\n      return;\n    }\n\n    // provider keys are only cached for active users\n    if (userIdIsActive) {\n      await this.activeUserProviderKeysState.forceValue({});\n    }\n  }\n\n  async getPublicKey(): Promise<Uint8Array> {\n    return await firstValueFrom(this.activeUserPublicKey$);\n  }\n\n  async makeOrgKey<T extends OrgKey | ProviderKey>(): Promise<[EncString, T]> {\n    const shareKey = await this.keyGenerationService.createKey(512);\n    const publicKey = await this.getPublicKey();\n    const encShareKey = await this.rsaEncrypt(shareKey.key, publicKey);\n    return [encShareKey, shareKey as T];\n  }\n\n  async setPrivateKey(encPrivateKey: EncryptedString): Promise<void> {\n    if (encPrivateKey == null) {\n      return;\n    }\n\n    await this.activeUserEncryptedPrivateKeyState.update(() => encPrivateKey);\n  }\n\n  async getPrivateKey(): Promise<Uint8Array> {\n    return await firstValueFrom(this.activeUserPrivateKey$);\n  }\n\n  async getFingerprint(fingerprintMaterial: string, publicKey?: Uint8Array): Promise<string[]> {\n    if (publicKey == null) {\n      publicKey = await this.getPublicKey();\n    }\n    if (publicKey === null) {\n      throw new Error(\"No public key available.\");\n    }\n    const keyFingerprint = await this.cryptoFunctionService.hash(publicKey, \"sha256\");\n    const userFingerprint = await this.cryptoFunctionService.hkdfExpand(\n      keyFingerprint,\n      fingerprintMaterial,\n      32,\n      \"sha256\",\n    );\n    return this.hashPhrase(userFingerprint);\n  }\n\n  async makeKeyPair(key?: SymmetricCryptoKey): Promise<[string, EncString]> {\n    // Default to user key\n    key ||= await this.getUserKeyWithLegacySupport();\n\n    const keyPair = await this.cryptoFunctionService.rsaGenerateKeyPair(2048);\n    const publicB64 = Utils.fromBufferToB64(keyPair[0]);\n    const privateEnc = await this.encryptService.encrypt(keyPair[1], key);\n    return [publicB64, privateEnc];\n  }\n\n  async clearKeyPair(memoryOnly?: boolean, userId?: UserId): Promise<void[]> {\n    const activeUserId = (await firstValueFrom(this.accountService.activeAccount$))?.id;\n    const userIdIsActive = userId == null || userId === activeUserId;\n\n    if (!memoryOnly) {\n      if (userId == null && activeUserId == null) {\n        // nothing to do\n        return;\n      }\n      await this.stateProvider\n        .getUser(userId ?? activeUserId, USER_ENCRYPTED_PRIVATE_KEY)\n        .update(() => null);\n      return;\n    }\n\n    // decrypted key pair is only cached for active users\n    if (userIdIsActive) {\n      await this.activeUserPrivateKeyState.forceValue(null);\n      await this.activeUserPublicKeyState.forceValue(null);\n    }\n  }\n\n  async makePinKey(pin: string, salt: string, kdf: KdfType, kdfConfig: KdfConfig): Promise<PinKey> {\n    const pinKey = await this.keyGenerationService.deriveKeyFromPassword(pin, salt, kdf, kdfConfig);\n    return (await this.stretchKey(pinKey)) as PinKey;\n  }\n\n  async clearPinKeys(userId?: UserId): Promise<void> {\n    await this.stateService.setPinKeyEncryptedUserKey(null, { userId: userId });\n    await this.stateService.setPinKeyEncryptedUserKeyEphemeral(null, { userId: userId });\n    await this.stateService.setProtectedPin(null, { userId: userId });\n    await this.clearDeprecatedKeys(KeySuffixOptions.Pin, userId);\n  }\n\n  async decryptUserKeyWithPin(\n    pin: string,\n    salt: string,\n    kdf: KdfType,\n    kdfConfig: KdfConfig,\n    pinProtectedUserKey?: EncString,\n  ): Promise<UserKey> {\n    pinProtectedUserKey ||= await this.stateService.getPinKeyEncryptedUserKey();\n    pinProtectedUserKey ||= await this.stateService.getPinKeyEncryptedUserKeyEphemeral();\n    if (!pinProtectedUserKey) {\n      throw new Error(\"No PIN protected key found.\");\n    }\n    const pinKey = await this.makePinKey(pin, salt, kdf, kdfConfig);\n    const userKey = await this.encryptService.decryptToBytes(pinProtectedUserKey, pinKey);\n    return new SymmetricCryptoKey(userKey) as UserKey;\n  }\n\n  // only for migration purposes\n  async decryptMasterKeyWithPin(\n    pin: string,\n    salt: string,\n    kdf: KdfType,\n    kdfConfig: KdfConfig,\n    pinProtectedMasterKey?: EncString,\n  ): Promise<MasterKey> {\n    if (!pinProtectedMasterKey) {\n      const pinProtectedMasterKeyString = await this.stateService.getEncryptedPinProtected();\n      if (pinProtectedMasterKeyString == null) {\n        throw new Error(\"No PIN protected key found.\");\n      }\n      pinProtectedMasterKey = new EncString(pinProtectedMasterKeyString);\n    }\n    const pinKey = await this.makePinKey(pin, salt, kdf, kdfConfig);\n    const masterKey = await this.encryptService.decryptToBytes(pinProtectedMasterKey, pinKey);\n    return new SymmetricCryptoKey(masterKey) as MasterKey;\n  }\n\n  async makeSendKey(keyMaterial: CsprngArray): Promise<SymmetricCryptoKey> {\n    return await this.keyGenerationService.deriveKeyFromMaterial(\n      keyMaterial,\n      \"bitwarden-send\",\n      \"send\",\n    );\n  }\n\n  async makeCipherKey(): Promise<CipherKey> {\n    return (await this.keyGenerationService.createKey(512)) as CipherKey;\n  }\n\n  async clearKeys(userId?: UserId): Promise<any> {\n    await this.clearUserKey(true, userId);\n    await this.clearMasterKeyHash(userId);\n    await this.clearOrgKeys(false, userId);\n    await this.clearProviderKeys(false, userId);\n    await this.clearKeyPair(false, userId);\n    await this.clearPinKeys(userId);\n    await this.stateProvider.setUserState(USER_EVER_HAD_USER_KEY, null, userId);\n  }\n\n  async rsaEncrypt(data: Uint8Array, publicKey?: Uint8Array): Promise<EncString> {\n    if (publicKey == null) {\n      publicKey = await this.getPublicKey();\n    }\n    if (publicKey == null) {\n      throw new Error(\"Public key unavailable.\");\n    }\n\n    const encBytes = await this.cryptoFunctionService.rsaEncrypt(data, publicKey, \"sha1\");\n    return new EncString(EncryptionType.Rsa2048_OaepSha1_B64, Utils.fromBufferToB64(encBytes));\n  }\n\n  async rsaDecrypt(encValue: string, privateKeyValue?: Uint8Array): Promise<Uint8Array> {\n    const headerPieces = encValue.split(\".\");\n    let encType: EncryptionType = null;\n    let encPieces: string[];\n\n    if (headerPieces.length === 1) {\n      encType = EncryptionType.Rsa2048_OaepSha256_B64;\n      encPieces = [headerPieces[0]];\n    } else if (headerPieces.length === 2) {\n      try {\n        encType = parseInt(headerPieces[0], null);\n        encPieces = headerPieces[1].split(\"|\");\n      } catch (e) {\n        this.logService.error(e);\n      }\n    }\n\n    switch (encType) {\n      case EncryptionType.Rsa2048_OaepSha256_B64:\n      case EncryptionType.Rsa2048_OaepSha1_B64:\n      case EncryptionType.Rsa2048_OaepSha256_HmacSha256_B64: // HmacSha256 types are deprecated\n      case EncryptionType.Rsa2048_OaepSha1_HmacSha256_B64:\n        break;\n      default:\n        throw new Error(\"encType unavailable.\");\n    }\n\n    if (encPieces == null || encPieces.length <= 0) {\n      throw new Error(\"encPieces unavailable.\");\n    }\n\n    const data = Utils.fromB64ToArray(encPieces[0]);\n    const privateKey = privateKeyValue ?? (await this.getPrivateKey());\n    if (privateKey == null) {\n      throw new Error(\"No private key.\");\n    }\n\n    let alg: \"sha1\" | \"sha256\" = \"sha1\";\n    switch (encType) {\n      case EncryptionType.Rsa2048_OaepSha256_B64:\n      case EncryptionType.Rsa2048_OaepSha256_HmacSha256_B64:\n        alg = \"sha256\";\n        break;\n      case EncryptionType.Rsa2048_OaepSha1_B64:\n      case EncryptionType.Rsa2048_OaepSha1_HmacSha256_B64:\n        break;\n      default:\n        throw new Error(\"encType unavailable.\");\n    }\n\n    return this.cryptoFunctionService.rsaDecrypt(data, privateKey, alg);\n  }\n\n  // EFForg/OpenWireless\n  // ref https://github.com/EFForg/OpenWireless/blob/master/app/js/diceware.js\n  async randomNumber(min: number, max: number): Promise<number> {\n    let rval = 0;\n    const range = max - min + 1;\n    const bitsNeeded = Math.ceil(Math.log2(range));\n    if (bitsNeeded > 53) {\n      throw new Error(\"We cannot generate numbers larger than 53 bits.\");\n    }\n\n    const bytesNeeded = Math.ceil(bitsNeeded / 8);\n    const mask = Math.pow(2, bitsNeeded) - 1;\n    // 7776 -> (2^13 = 8192) -1 == 8191 or 0x00001111 11111111\n\n    // Fill a byte array with N random numbers\n    const byteArray = new Uint8Array(await this.cryptoFunctionService.randomBytes(bytesNeeded));\n\n    let p = (bytesNeeded - 1) * 8;\n    for (let i = 0; i < bytesNeeded; i++) {\n      rval += byteArray[i] * Math.pow(2, p);\n      p -= 8;\n    }\n\n    // Use & to apply the mask and reduce the number of recursive lookups\n    rval = rval & mask;\n\n    if (rval >= range) {\n      // Integer out of acceptable range\n      return this.randomNumber(min, max);\n    }\n\n    // Return an integer that falls within the range\n    return min + rval;\n  }\n\n  // ---HELPERS---\n  protected async validateUserKey(key: UserKey): Promise<boolean> {\n    if (!key) {\n      return false;\n    }\n\n    try {\n      const [userId, encPrivateKey] = await firstValueFrom(\n        this.activeUserEncryptedPrivateKeyState.combinedState$,\n      );\n      if (encPrivateKey == null) {\n        return false;\n      }\n\n      // Can decrypt private key\n      const privateKey = await USER_PRIVATE_KEY.derive([userId, encPrivateKey], {\n        encryptService: this.encryptService,\n        cryptoService: this,\n      });\n\n      // Can successfully derive public key\n      await USER_PUBLIC_KEY.derive(privateKey, {\n        cryptoFunctionService: this.cryptoFunctionService,\n      });\n    } catch (e) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Initialize all necessary crypto keys needed for a new account.\n   * Warning! This completely replaces any existing keys!\n   */\n  async initAccount(): Promise<{\n    userKey: UserKey;\n    publicKey: string;\n    privateKey: EncString;\n  }> {\n    const userKey = (await this.keyGenerationService.createKey(512)) as UserKey;\n    const [publicKey, privateKey] = await this.makeKeyPair(userKey);\n    await this.setUserKey(userKey);\n    await this.activeUserEncryptedPrivateKeyState.update(() => privateKey.encryptedString);\n\n    return {\n      userKey,\n      publicKey,\n      privateKey,\n    };\n  }\n\n  /**\n   * Generates any additional keys if needed. Additional keys are\n   * keys such as biometrics, auto, and pin keys.\n   * Useful to make sure other keys stay in sync when the user key\n   * has been rotated.\n   * @param key The user key\n   * @param userId The desired user\n   */\n  protected async storeAdditionalKeys(key: UserKey, userId?: UserId) {\n    const storeAuto = await this.shouldStoreKey(KeySuffixOptions.Auto, userId);\n    if (storeAuto) {\n      await this.stateService.setUserKeyAutoUnlock(key.keyB64, { userId: userId });\n    } else {\n      await this.stateService.setUserKeyAutoUnlock(null, { userId: userId });\n    }\n    await this.clearDeprecatedKeys(KeySuffixOptions.Auto, userId);\n\n    const storePin = await this.shouldStoreKey(KeySuffixOptions.Pin, userId);\n    if (storePin) {\n      await this.storePinKey(key, userId);\n      // We can't always clear deprecated keys because the pin is only\n      // migrated once used to unlock\n      await this.clearDeprecatedKeys(KeySuffixOptions.Pin, userId);\n    } else {\n      await this.stateService.setPinKeyEncryptedUserKey(null, { userId: userId });\n      await this.stateService.setPinKeyEncryptedUserKeyEphemeral(null, { userId: userId });\n    }\n  }\n\n  /**\n   * Stores the pin key if needed. If MP on Reset is enabled, stores the\n   * ephemeral version.\n   * @param key The user key\n   */\n  protected async storePinKey(key: UserKey, userId?: UserId) {\n    const pin = await this.encryptService.decryptToUtf8(\n      new EncString(await this.stateService.getProtectedPin({ userId: userId })),\n      key,\n    );\n    const pinKey = await this.makePinKey(\n      pin,\n      await this.stateService.getEmail({ userId: userId }),\n      await this.stateService.getKdfType({ userId: userId }),\n      await this.stateService.getKdfConfig({ userId: userId }),\n    );\n    const encPin = await this.encryptService.encrypt(key.key, pinKey);\n\n    if ((await this.stateService.getPinKeyEncryptedUserKey({ userId: userId })) != null) {\n      await this.stateService.setPinKeyEncryptedUserKey(encPin, { userId: userId });\n    } else {\n      await this.stateService.setPinKeyEncryptedUserKeyEphemeral(encPin, { userId: userId });\n    }\n  }\n\n  protected async shouldStoreKey(keySuffix: KeySuffixOptions, userId?: UserId) {\n    let shouldStoreKey = false;\n    switch (keySuffix) {\n      case KeySuffixOptions.Auto: {\n        const vaultTimeout = await this.stateService.getVaultTimeout({ userId: userId });\n        shouldStoreKey = vaultTimeout == null;\n        break;\n      }\n      case KeySuffixOptions.Pin: {\n        const protectedPin = await this.stateService.getProtectedPin({ userId: userId });\n        shouldStoreKey = !!protectedPin;\n        break;\n      }\n    }\n    return shouldStoreKey;\n  }\n\n  protected async getKeyFromStorage(\n    keySuffix: KeySuffixOptions,\n    userId?: UserId,\n  ): Promise<UserKey> {\n    if (keySuffix === KeySuffixOptions.Auto) {\n      const userKey = await this.stateService.getUserKeyAutoUnlock({ userId: userId });\n      if (userKey) {\n        return new SymmetricCryptoKey(Utils.fromB64ToArray(userKey)) as UserKey;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Validate that the KDF config follows the requirements for the given KDF type.\n   *\n   * @remarks\n   * Should always be called before updating a users KDF config.\n   */\n  validateKdfConfig(kdf: KdfType, kdfConfig: KdfConfig): void {\n    switch (kdf) {\n      case KdfType.PBKDF2_SHA256:\n        if (!PBKDF2_ITERATIONS.inRange(kdfConfig.iterations)) {\n          throw new Error(\n            `PBKDF2 iterations must be between ${PBKDF2_ITERATIONS.min} and ${PBKDF2_ITERATIONS.max}`,\n          );\n        }\n        break;\n      case KdfType.Argon2id:\n        if (!ARGON2_ITERATIONS.inRange(kdfConfig.iterations)) {\n          throw new Error(\n            `Argon2 iterations must be between ${ARGON2_ITERATIONS.min} and ${ARGON2_ITERATIONS.max}`,\n          );\n        }\n\n        if (!ARGON2_MEMORY.inRange(kdfConfig.memory)) {\n          throw new Error(\n            `Argon2 memory must be between ${ARGON2_MEMORY.min}mb and ${ARGON2_MEMORY.max}mb`,\n          );\n        }\n\n        if (!ARGON2_PARALLELISM.inRange(kdfConfig.parallelism)) {\n          throw new Error(\n            `Argon2 parallelism must be between ${ARGON2_PARALLELISM.min} and ${ARGON2_PARALLELISM.max}.`,\n          );\n        }\n        break;\n    }\n  }\n\n  protected async clearAllStoredUserKeys(userId?: UserId): Promise<void> {\n    await this.stateService.setUserKeyAutoUnlock(null, { userId: userId });\n    await this.stateService.setPinKeyEncryptedUserKeyEphemeral(null, { userId: userId });\n  }\n\n  private async stretchKey(key: SymmetricCryptoKey): Promise<SymmetricCryptoKey> {\n    const newKey = new Uint8Array(64);\n    const encKey = await this.cryptoFunctionService.hkdfExpand(key.key, \"enc\", 32, \"sha256\");\n    const macKey = await this.cryptoFunctionService.hkdfExpand(key.key, \"mac\", 32, \"sha256\");\n    newKey.set(new Uint8Array(encKey));\n    newKey.set(new Uint8Array(macKey), 32);\n    return new SymmetricCryptoKey(newKey);\n  }\n\n  private async hashPhrase(hash: Uint8Array, minimumEntropy = 64) {\n    const entropyPerWord = Math.log(EFFLongWordList.length) / Math.log(2);\n    let numWords = Math.ceil(minimumEntropy / entropyPerWord);\n\n    const hashArr = Array.from(new Uint8Array(hash));\n    const entropyAvailable = hashArr.length * 4;\n    if (numWords * entropyPerWord > entropyAvailable) {\n      throw new Error(\"Output entropy of hash function is too small\");\n    }\n\n    const phrase: string[] = [];\n    let hashNumber = bigInt.fromArray(hashArr, 256);\n    while (numWords--) {\n      const remainder = hashNumber.mod(EFFLongWordList.length);\n      hashNumber = hashNumber.divide(EFFLongWordList.length);\n      phrase.push(EFFLongWordList[remainder as any]);\n    }\n    return phrase;\n  }\n\n  private async buildProtectedSymmetricKey<T extends SymmetricCryptoKey>(\n    encryptionKey: SymmetricCryptoKey,\n    newSymKey: Uint8Array,\n  ): Promise<[T, EncString]> {\n    let protectedSymKey: EncString = null;\n    if (encryptionKey.key.byteLength === 32) {\n      const stretchedEncryptionKey = await this.stretchKey(encryptionKey);\n      protectedSymKey = await this.encryptService.encrypt(newSymKey, stretchedEncryptionKey);\n    } else if (encryptionKey.key.byteLength === 64) {\n      protectedSymKey = await this.encryptService.encrypt(newSymKey, encryptionKey);\n    } else {\n      throw new Error(\"Invalid key size.\");\n    }\n    return [new SymmetricCryptoKey(newSymKey) as T, protectedSymKey];\n  }\n\n  // --LEGACY METHODS--\n  // We previously used the master key for additional keys, but now we use the user key.\n  // These methods support migrating the old keys to the new ones.\n  // TODO: Remove after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3475)\n\n  async clearDeprecatedKeys(keySuffix: KeySuffixOptions, userId?: UserId) {\n    if (keySuffix === KeySuffixOptions.Auto) {\n      await this.stateService.setCryptoMasterKeyAuto(null, { userId: userId });\n    } else if (keySuffix === KeySuffixOptions.Pin) {\n      await this.stateService.setEncryptedPinProtected(null, { userId: userId });\n      await this.stateService.setDecryptedPinProtected(null, { userId: userId });\n    }\n  }\n\n  async migrateAutoKeyIfNeeded(userId?: UserId) {\n    const oldAutoKey = await this.stateService.getCryptoMasterKeyAuto({ userId: userId });\n    if (!oldAutoKey) {\n      return;\n    }\n    // Decrypt\n    const masterKey = new SymmetricCryptoKey(Utils.fromB64ToArray(oldAutoKey)) as MasterKey;\n    if (await this.isLegacyUser(masterKey, userId)) {\n      // Legacy users don't have a user key, so no need to migrate.\n      // Instead, set the master key for additional isLegacyUser checks that will log the user out.\n      await this.setMasterKey(masterKey, userId);\n      return;\n    }\n    const encryptedUserKey = await this.stateService.getEncryptedCryptoSymmetricKey({\n      userId: userId,\n    });\n    const userKey = await this.decryptUserKeyWithMasterKey(\n      masterKey,\n      new EncString(encryptedUserKey),\n      userId,\n    );\n    // Migrate\n    await this.stateService.setUserKeyAutoUnlock(userKey.keyB64, { userId: userId });\n    await this.stateService.setCryptoMasterKeyAuto(null, { userId: userId });\n    // Set encrypted user key in case user immediately locks without syncing\n    await this.setMasterKeyEncryptedUserKey(encryptedUserKey);\n  }\n\n  async decryptAndMigrateOldPinKey(\n    masterPasswordOnRestart: boolean,\n    pin: string,\n    email: string,\n    kdf: KdfType,\n    kdfConfig: KdfConfig,\n    oldPinKey: EncString,\n  ): Promise<UserKey> {\n    // Decrypt\n    const masterKey = await this.decryptMasterKeyWithPin(pin, email, kdf, kdfConfig, oldPinKey);\n    const encUserKey = await this.stateService.getEncryptedCryptoSymmetricKey();\n    const userKey = await this.decryptUserKeyWithMasterKey(masterKey, new EncString(encUserKey));\n    // Migrate\n    const pinKey = await this.makePinKey(pin, email, kdf, kdfConfig);\n    const pinProtectedKey = await this.encryptService.encrypt(userKey.key, pinKey);\n    if (masterPasswordOnRestart) {\n      await this.stateService.setDecryptedPinProtected(null);\n      await this.stateService.setPinKeyEncryptedUserKeyEphemeral(pinProtectedKey);\n    } else {\n      await this.stateService.setEncryptedPinProtected(null);\n      await this.stateService.setPinKeyEncryptedUserKey(pinProtectedKey);\n      // We previously only set the protected pin if MP on Restart was enabled\n      // now we set it regardless\n      const encPin = await this.encryptService.encrypt(pin, userKey);\n      await this.stateService.setProtectedPin(encPin.encryptedString);\n    }\n    // This also clears the old Biometrics key since the new Biometrics key will\n    // be created when the user key is set.\n    await this.stateService.setCryptoMasterKeyBiometric(null);\n    return userKey;\n  }\n\n  // --DEPRECATED METHODS--\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.encrypt\n   */\n  async encrypt(plainValue: string | Uint8Array, key?: SymmetricCryptoKey): Promise<EncString> {\n    key ||= await this.getUserKeyWithLegacySupport();\n    return await this.encryptService.encrypt(plainValue, key);\n  }\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.encryptToBytes\n   */\n  async encryptToBytes(plainValue: Uint8Array, key?: SymmetricCryptoKey): Promise<EncArrayBuffer> {\n    key ||= await this.getUserKeyWithLegacySupport();\n    return this.encryptService.encryptToBytes(plainValue, key);\n  }\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.decryptToBytes\n   */\n  async decryptToBytes(encString: EncString, key?: SymmetricCryptoKey): Promise<Uint8Array> {\n    key ||= await this.getUserKeyWithLegacySupport();\n    return this.encryptService.decryptToBytes(encString, key);\n  }\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.decryptToUtf8\n   */\n  async decryptToUtf8(encString: EncString, key?: SymmetricCryptoKey): Promise<string> {\n    key ||= await this.getUserKeyWithLegacySupport();\n    return await this.encryptService.decryptToUtf8(encString, key);\n  }\n\n  /**\n   * @deprecated July 25 2022: Get the key you need from CryptoService (getKeyForUserEncryption or getOrgKey)\n   * and then call encryptService.decryptToBytes\n   */\n  async decryptFromBytes(encBuffer: EncArrayBuffer, key: SymmetricCryptoKey): Promise<Uint8Array> {\n    if (encBuffer == null) {\n      throw new Error(\"No buffer provided for decryption.\");\n    }\n\n    key ||= await this.getUserKeyWithLegacySupport();\n\n    return this.encryptService.decryptToBytes(encBuffer, key);\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { KeySuffixOptions } from \"@bitwarden/common/platform/enums\";\nimport { CryptoService } from \"@bitwarden/common/platform/services/crypto.service\";\nimport { USER_KEY } from \"@bitwarden/common/platform/services/key-state/user-key.state\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\nimport { UserKey } from \"@bitwarden/common/types/key\";\n\nexport class BrowserCryptoService extends CryptoService {\n  override async hasUserKeyStored(keySuffix: KeySuffixOptions, userId?: UserId): Promise<boolean> {\n    if (keySuffix === KeySuffixOptions.Biometric) {\n      return await this.stateService.getBiometricUnlock({ userId: userId });\n    }\n    return super.hasUserKeyStored(keySuffix, userId);\n  }\n\n  /**\n   * Browser doesn't store biometric keys, so we retrieve them from the desktop and return\n   * if we successfully saved it into memory as the User Key\n   * @returns the `UserKey` if the user passes a biometrics prompt, otherwise return `null`.\n   */\n  protected override async getKeyFromStorage(\n    keySuffix: KeySuffixOptions,\n    userId?: UserId,\n  ): Promise<UserKey> {\n    if (keySuffix === KeySuffixOptions.Biometric) {\n      const biometricsResult = await this.platformUtilService.authenticateBiometric();\n\n      if (!biometricsResult) {\n        return null;\n      }\n\n      const userKey = await firstValueFrom(this.stateProvider.getUserState$(USER_KEY, userId));\n      if (userKey) {\n        return userKey;\n      }\n    }\n\n    return await super.getKeyFromStorage(keySuffix, userId);\n  }\n}\n","import { CryptoService as AbstractCryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\n\nimport {\n  AccountServiceInitOptions,\n  accountServiceFactory,\n} from \"../../../auth/background/service-factories/account-service.factory\";\nimport {\n  StateServiceInitOptions,\n  stateServiceFactory,\n} from \"../../../platform/background/service-factories/state-service.factory\";\nimport {\n  LogServiceInitOptions,\n  logServiceFactory,\n} from \"../../background/service-factories/log-service.factory\";\nimport { BrowserCryptoService } from \"../../services/browser-crypto.service\";\n\nimport {\n  cryptoFunctionServiceFactory,\n  CryptoFunctionServiceInitOptions,\n} from \"./crypto-function-service.factory\";\nimport { encryptServiceFactory, EncryptServiceInitOptions } from \"./encrypt-service.factory\";\nimport { FactoryOptions, CachedServices, factory } from \"./factory-options\";\nimport {\n  KeyGenerationServiceInitOptions,\n  keyGenerationServiceFactory,\n} from \"./key-generation-service.factory\";\nimport {\n  PlatformUtilsServiceInitOptions,\n  platformUtilsServiceFactory,\n} from \"./platform-utils-service.factory\";\nimport { StateProviderInitOptions, stateProviderFactory } from \"./state-provider.factory\";\n\ntype CryptoServiceFactoryOptions = FactoryOptions;\n\nexport type CryptoServiceInitOptions = CryptoServiceFactoryOptions &\n  KeyGenerationServiceInitOptions &\n  CryptoFunctionServiceInitOptions &\n  EncryptServiceInitOptions &\n  PlatformUtilsServiceInitOptions &\n  LogServiceInitOptions &\n  StateServiceInitOptions &\n  AccountServiceInitOptions &\n  StateProviderInitOptions;\n\nexport function cryptoServiceFactory(\n  cache: { cryptoService?: AbstractCryptoService } & CachedServices,\n  opts: CryptoServiceInitOptions,\n): Promise<AbstractCryptoService> {\n  return factory(\n    cache,\n    \"cryptoService\",\n    opts,\n    async () =>\n      new BrowserCryptoService(\n        await keyGenerationServiceFactory(cache, opts),\n        await cryptoFunctionServiceFactory(cache, opts),\n        await encryptServiceFactory(cache, opts),\n        await platformUtilsServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n        await stateServiceFactory(cache, opts),\n        await accountServiceFactory(cache, opts),\n        await stateProviderFactory(cache, opts),\n      ),\n  );\n}\n","import { AuthService as AbstractAuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthService } from \"@bitwarden/common/auth/services/auth.service\";\n\nimport {\n  ApiServiceInitOptions,\n  apiServiceFactory,\n} from \"../../../platform/background/service-factories/api-service.factory\";\nimport {\n  CryptoServiceInitOptions,\n  cryptoServiceFactory,\n} from \"../../../platform/background/service-factories/crypto-service.factory\";\nimport {\n  CachedServices,\n  FactoryOptions,\n  factory,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  messagingServiceFactory,\n  MessagingServiceInitOptions,\n} from \"../../../platform/background/service-factories/messaging-service.factory\";\nimport {\n  StateServiceInitOptions,\n  stateServiceFactory,\n} from \"../../../platform/background/service-factories/state-service.factory\";\n\ntype AuthServiceFactoryOptions = FactoryOptions;\n\nexport type AuthServiceInitOptions = AuthServiceFactoryOptions &\n  MessagingServiceInitOptions &\n  CryptoServiceInitOptions &\n  ApiServiceInitOptions &\n  StateServiceInitOptions;\n\nexport function authServiceFactory(\n  cache: { authService?: AbstractAuthService } & CachedServices,\n  opts: AuthServiceInitOptions,\n): Promise<AbstractAuthService> {\n  return factory(\n    cache,\n    \"authService\",\n    opts,\n    async () =>\n      new AuthService(\n        await messagingServiceFactory(cache, opts),\n        await cryptoServiceFactory(cache, opts),\n        await apiServiceFactory(cache, opts),\n        await stateServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { OrganizationService as AbstractOrganizationService } from \"@bitwarden/common/admin-console/abstractions/organization/organization.service.abstraction\";\n\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport { stateProviderFactory } from \"../../../platform/background/service-factories/state-provider.factory\";\nimport {\n  stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../../platform/background/service-factories/state-service.factory\";\nimport { BrowserOrganizationService } from \"../../services/browser-organization.service\";\n\ntype OrganizationServiceFactoryOptions = FactoryOptions;\n\nexport type OrganizationServiceInitOptions = OrganizationServiceFactoryOptions &\n  StateServiceInitOptions;\n\nexport function organizationServiceFactory(\n  cache: { organizationService?: AbstractOrganizationService } & CachedServices,\n  opts: OrganizationServiceInitOptions,\n): Promise<AbstractOrganizationService> {\n  return factory(\n    cache,\n    \"organizationService\",\n    opts,\n    async () =>\n      new BrowserOrganizationService(\n        await stateServiceFactory(cache, opts),\n        await stateProviderFactory(cache, opts),\n      ),\n  );\n}\n","import { PolicyService as AbstractPolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\n\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  stateServiceFactory as stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../../platform/background/service-factories/state-service.factory\";\nimport { BrowserPolicyService } from \"../../services/browser-policy.service\";\n\nimport {\n  organizationServiceFactory,\n  OrganizationServiceInitOptions,\n} from \"./organization-service.factory\";\n\ntype PolicyServiceFactoryOptions = FactoryOptions;\n\nexport type PolicyServiceInitOptions = PolicyServiceFactoryOptions &\n  StateServiceInitOptions &\n  OrganizationServiceInitOptions;\n\nexport function policyServiceFactory(\n  cache: { policyService?: AbstractPolicyService } & CachedServices,\n  opts: PolicyServiceInitOptions,\n): Promise<AbstractPolicyService> {\n  return factory(\n    cache,\n    \"policyService\",\n    opts,\n    async () =>\n      new BrowserPolicyService(\n        await stateServiceFactory(cache, opts),\n        await organizationServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { AutofillSettingsService } from \"@bitwarden/common/autofill/services/autofill-settings.service\";\n\nimport {\n  policyServiceFactory,\n  PolicyServiceInitOptions,\n} from \"../../../admin-console/background/service-factories/policy-service.factory\";\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  stateProviderFactory,\n  StateProviderInitOptions,\n} from \"../../../platform/background/service-factories/state-provider.factory\";\n\nexport type AutofillSettingsServiceInitOptions = FactoryOptions &\n  StateProviderInitOptions &\n  PolicyServiceInitOptions;\n\nexport function autofillSettingsServiceFactory(\n  cache: { autofillSettingsService?: AutofillSettingsService } & CachedServices,\n  opts: AutofillSettingsServiceInitOptions,\n): Promise<AutofillSettingsService> {\n  return factory(\n    cache,\n    \"autofillSettingsService\",\n    opts,\n    async () =>\n      new AutofillSettingsService(\n        await stateProviderFactory(cache, opts),\n        await policyServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { CipherFileUploadService as CipherFileUploadServiceAbstraction } from \"@bitwarden/common/vault/abstractions/file-upload/cipher-file-upload.service\";\nimport { CipherFileUploadService } from \"@bitwarden/common/vault/services/file-upload/cipher-file-upload.service\";\n\nimport {\n  ApiServiceInitOptions,\n  apiServiceFactory,\n} from \"../../platform/background/service-factories/api-service.factory\";\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../platform/background/service-factories/factory-options\";\nimport {\n  FileUploadServiceInitOptions,\n  fileUploadServiceFactory,\n} from \"../../platform/background/service-factories/file-upload-service.factory\";\n\ntype CipherFileUploadServiceFactoyOptions = FactoryOptions;\n\nexport type CipherFileUploadServiceInitOptions = CipherFileUploadServiceFactoyOptions &\n  ApiServiceInitOptions &\n  FileUploadServiceInitOptions;\n\nexport function cipherFileUploadServiceFactory(\n  cache: { cipherFileUploadService?: CipherFileUploadServiceAbstraction } & CachedServices,\n  opts: CipherFileUploadServiceInitOptions,\n): Promise<CipherFileUploadServiceAbstraction> {\n  return factory(\n    cache,\n    \"cipherFileUploadService\",\n    opts,\n    async () =>\n      new CipherFileUploadService(\n        await apiServiceFactory(cache, opts),\n        await fileUploadServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { FileUploadService as FileUploadServiceAbstraction } from \"@bitwarden/common/platform/abstractions/file-upload/file-upload.service\";\nimport { FileUploadService } from \"@bitwarden/common/platform/services/file-upload/file-upload.service\";\n\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../background/service-factories/factory-options\";\n\nimport { logServiceFactory, LogServiceInitOptions } from \"./log-service.factory\";\n\ntype FileUploadServiceFactoryOptions = FactoryOptions;\n\nexport type FileUploadServiceInitOptions = FileUploadServiceFactoryOptions & LogServiceInitOptions;\n\nexport function fileUploadServiceFactory(\n  cache: { fileUploadService?: FileUploadServiceAbstraction } & CachedServices,\n  opts: FileUploadServiceInitOptions,\n): Promise<FileUploadServiceAbstraction> {\n  return factory(\n    cache,\n    \"fileUploadService\",\n    opts,\n    async () => new FileUploadService(await logServiceFactory(cache, opts)),\n  );\n}\n","import { TranslationService as TranslationServiceAbstraction } from \"../abstractions/translation.service\";\n\nexport abstract class TranslationService implements TranslationServiceAbstraction {\n  // First locale is the default (English)\n  supportedTranslationLocales: string[] = [\"en\"];\n  defaultLocale = \"en\";\n  abstract translationLocale: string;\n  collator: Intl.Collator;\n  localeNames = new Map<string, string>([\n    [\"af\", \"Afrikaans\"],\n    [\"ar\", \"العربية الفصحى\"],\n    [\"az\", \"Azərbaycanca\"],\n    [\"be\", \"Беларуская\"],\n    [\"bg\", \"български\"],\n    [\"bn\", \"বাংলা\"],\n    [\"bs\", \"bosanski jezik\"],\n    [\"ca\", \"català\"],\n    [\"cs\", \"čeština\"],\n    [\"da\", \"dansk\"],\n    [\"de\", \"Deutsch\"],\n    [\"el\", \"Ελληνικά\"],\n    [\"en\", \"English\"],\n    [\"en-GB\", \"English (British)\"],\n    [\"en-IN\", \"English (India)\"],\n    [\"eo\", \"Esperanto\"],\n    [\"es\", \"español\"],\n    [\"et\", \"eesti\"],\n    [\"eu\", \"euskara\"],\n    [\"fa\", \"فارسی\"],\n    [\"fi\", \"suomi\"],\n    [\"fil\", \"Wikang Filipino\"],\n    [\"fr\", \"français\"],\n    [\"he\", \"עברית\"],\n    [\"hi\", \"हिन्दी\"],\n    [\"hr\", \"hrvatski\"],\n    [\"hu\", \"magyar\"],\n    [\"id\", \"Bahasa Indonesia\"],\n    [\"it\", \"italiano\"],\n    [\"ja\", \"日本語\"],\n    [\"ka\", \"ქართული\"],\n    [\"km\", \"ខ្មែរ, ខេមរភាសា, ភាសាខ្មែរ\"],\n    [\"kn\", \"ಕನ್ನಡ\"],\n    [\"ko\", \"한국어\"],\n    [\"lt\", \"lietuvių kalba\"],\n    [\"lv\", \"Latvietis\"],\n    [\"me\", \"црногорски\"],\n    [\"ml\", \"മലയാളം\"],\n    [\"nb\", \"norsk (bokmål)\"],\n    [\"nl\", \"Nederlands\"],\n    [\"nn\", \"Norsk Nynorsk\"],\n    [\"pl\", \"polski\"],\n    [\"pt-BR\", \"português do Brasil\"],\n    [\"pt-PT\", \"português\"],\n    [\"ro\", \"română\"],\n    [\"ru\", \"русский\"],\n    [\"si\", \"සිංහල\"],\n    [\"sk\", \"slovenčina\"],\n    [\"sl\", \"Slovenski jezik, Slovenščina\"],\n    [\"sr\", \"Српски\"],\n    [\"sv\", \"svenska\"],\n    [\"th\", \"ไทย\"],\n    [\"tr\", \"Türkçe\"],\n    [\"uk\", \"українська\"],\n    [\"vi\", \"Tiếng Việt\"],\n    [\"zh-CN\", \"中文（中国大陆）\"],\n    [\"zh-TW\", \"中文（台灣）\"],\n  ]);\n\n  protected inited: boolean;\n  protected defaultMessages: any = {};\n  protected localeMessages: any = {};\n\n  constructor(\n    protected systemLanguage: string,\n    protected localesDirectory: string,\n    protected getLocalesJson: (formattedLocale: string) => Promise<any>,\n  ) {\n    this.systemLanguage = systemLanguage.replace(\"_\", \"-\");\n  }\n\n  async init(locale?: string) {\n    if (this.inited) {\n      throw new Error(\"i18n already initialized.\");\n    }\n    if (this.supportedTranslationLocales == null || this.supportedTranslationLocales.length === 0) {\n      throw new Error(\"supportedTranslationLocales not set.\");\n    }\n\n    this.inited = true;\n    this.translationLocale = locale != null ? locale : this.systemLanguage;\n\n    try {\n      this.collator = new Intl.Collator(this.translationLocale, {\n        numeric: true,\n        sensitivity: \"base\",\n      });\n    } catch {\n      this.collator = null;\n    }\n\n    if (this.supportedTranslationLocales.indexOf(this.translationLocale) === -1) {\n      this.translationLocale = this.translationLocale.slice(0, 2);\n\n      if (this.supportedTranslationLocales.indexOf(this.translationLocale) === -1) {\n        this.translationLocale = this.defaultLocale;\n      }\n    }\n\n    if (this.localesDirectory != null) {\n      await this.loadMessages(this.translationLocale, this.localeMessages);\n      if (this.translationLocale !== this.defaultLocale) {\n        await this.loadMessages(this.defaultLocale, this.defaultMessages);\n      }\n    }\n  }\n\n  t(id: string, p1?: string, p2?: string, p3?: string): string {\n    return this.translate(id, p1, p2, p3);\n  }\n\n  translate(id: string, p1?: string | number, p2?: string | number, p3?: string | number): string {\n    let result: string;\n    // eslint-disable-next-line\n    if (this.localeMessages.hasOwnProperty(id) && this.localeMessages[id]) {\n      result = this.localeMessages[id];\n      // eslint-disable-next-line\n    } else if (this.defaultMessages.hasOwnProperty(id) && this.defaultMessages[id]) {\n      result = this.defaultMessages[id];\n    } else {\n      result = \"\";\n    }\n\n    if (result !== \"\") {\n      if (p1 != null) {\n        result = result.split(\"__$1__\").join(p1.toString());\n      }\n      if (p2 != null) {\n        result = result.split(\"__$2__\").join(p2.toString());\n      }\n      if (p3 != null) {\n        result = result.split(\"__$3__\").join(p3.toString());\n      }\n    }\n\n    return result;\n  }\n\n  protected async loadMessages(locale: string, messagesObj: any): Promise<any> {\n    const formattedLocale = locale.replace(\"-\", \"_\");\n    const locales = await this.getLocalesJson(formattedLocale);\n    for (const prop in locales) {\n      // eslint-disable-next-line\n      if (!locales.hasOwnProperty(prop)) {\n        continue;\n      }\n      messagesObj[prop] = locales[prop].message;\n\n      if (locales[prop].placeholders) {\n        for (const placeProp in locales[prop].placeholders) {\n          if (\n            !locales[prop].placeholders.hasOwnProperty(placeProp) || // eslint-disable-line\n            !locales[prop].placeholders[placeProp].content\n          ) {\n            continue;\n          }\n\n          const replaceToken = \"\\\\$\" + placeProp.toUpperCase() + \"\\\\$\";\n          let replaceContent = locales[prop].placeholders[placeProp].content;\n          if (replaceContent === \"$1\" || replaceContent === \"$2\" || replaceContent === \"$3\") {\n            replaceContent = \"__$\" + replaceContent + \"__\";\n          }\n          messagesObj[prop] = messagesObj[prop].replace(\n            new RegExp(replaceToken, \"g\"),\n            replaceContent,\n          );\n        }\n      }\n    }\n  }\n}\n","import { Observable, ReplaySubject } from \"rxjs\";\n\nimport { I18nService as I18nServiceAbstraction } from \"../abstractions/i18n.service\";\n\nimport { TranslationService } from \"./translation.service\";\n\nexport class I18nService extends TranslationService implements I18nServiceAbstraction {\n  protected _locale = new ReplaySubject<string>(1);\n  private _translationLocale: string;\n  locale$: Observable<string> = this._locale.asObservable();\n\n  constructor(\n    protected systemLanguage: string,\n    protected localesDirectory: string,\n    protected getLocalesJson: (formattedLocale: string) => Promise<any>,\n  ) {\n    super(systemLanguage, localesDirectory, getLocalesJson);\n  }\n\n  get translationLocale(): string {\n    return this._translationLocale;\n  }\n\n  set translationLocale(locale: string) {\n    this._translationLocale = locale;\n    this._locale.next(locale);\n  }\n}\n","import { I18nService as BaseI18nService } from \"@bitwarden/common/platform/services/i18n.service\";\n\nexport default class I18nService extends BaseI18nService {\n  constructor(systemLanguage: string) {\n    super(systemLanguage, null, async (formattedLocale: string) => {\n      // Deprecated\n      const file = await fetch(this.localesDirectory + formattedLocale + \"/messages.json\");\n      return await file.json();\n    });\n\n    // Please leave 'en' where it is, as it's our fallback language in case no translation can be found\n    this.supportedTranslationLocales = [\n      \"en\",\n      \"ar\",\n      \"az\",\n      \"be\",\n      \"bg\",\n      \"bn\",\n      \"bs\",\n      \"ca\",\n      \"cs\",\n      \"da\",\n      \"de\",\n      \"el\",\n      \"en-GB\",\n      \"en-IN\",\n      \"es\",\n      \"et\",\n      \"eu\",\n      \"fa\",\n      \"fi\",\n      \"fil\",\n      \"fr\",\n      \"he\",\n      \"hi\",\n      \"hr\",\n      \"hu\",\n      \"id\",\n      \"it\",\n      \"ja\",\n      \"ka\",\n      \"km\",\n      \"kn\",\n      \"ko\",\n      \"lt\",\n      \"lv\",\n      \"ml\",\n      \"nb\",\n      \"nl\",\n      \"nn\",\n      \"pl\",\n      \"pt-BR\",\n      \"pt-PT\",\n      \"ro\",\n      \"ru\",\n      \"si\",\n      \"sk\",\n      \"sl\",\n      \"sr\",\n      \"sv\",\n      \"th\",\n      \"tr\",\n      \"uk\",\n      \"vi\",\n      \"zh-CN\",\n      \"zh-TW\",\n    ];\n  }\n\n  t(id: string, p1?: string, p2?: string, p3?: string): string {\n    return this.translate(id, p1, p2, p3);\n  }\n\n  translate(id: string, p1?: string, p2?: string, p3?: string): string {\n    if (this.localesDirectory == null) {\n      const placeholders: string[] = [];\n      if (p1 != null) {\n        placeholders.push(p1);\n      }\n      if (p2 != null) {\n        placeholders.push(p2);\n      }\n      if (p3 != null) {\n        placeholders.push(p3);\n      }\n\n      if (placeholders.length) {\n        return chrome.i18n.getMessage(id, placeholders);\n      } else {\n        return chrome.i18n.getMessage(id);\n      }\n    }\n\n    return super.translate(id, p1, p2, p3);\n  }\n}\n","import { I18nService as AbstractI18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { I18nService as BaseI18nService } from \"@bitwarden/common/platform/services/i18n.service\";\n\nimport I18nService from \"../../services/i18n.service\";\n\nimport { FactoryOptions, CachedServices, factory } from \"./factory-options\";\n\ntype I18nServiceFactoryOptions = FactoryOptions & {\n  i18nServiceOptions: {\n    systemLanguage: string;\n  };\n};\n\nexport type I18nServiceInitOptions = I18nServiceFactoryOptions;\n\nexport async function i18nServiceFactory(\n  cache: { i18nService?: AbstractI18nService } & CachedServices,\n  opts: I18nServiceInitOptions,\n): Promise<AbstractI18nService> {\n  const service = await factory(\n    cache,\n    \"i18nService\",\n    opts,\n    () => new I18nService(opts.i18nServiceOptions.systemLanguage),\n  );\n  if (!(service as BaseI18nService as any).inited) {\n    await (service as BaseI18nService).init();\n  }\n  return service;\n}\n","import { BehaviorSubject, concatMap } from \"rxjs\";\n\nimport { SettingsService as SettingsServiceAbstraction } from \"../abstractions/settings.service\";\nimport { StateService } from \"../platform/abstractions/state.service\";\nimport { Utils } from \"../platform/misc/utils\";\nimport { AccountSettingsSettings } from \"../platform/models/domain/account\";\n\nexport class SettingsService implements SettingsServiceAbstraction {\n  protected _settings: BehaviorSubject<AccountSettingsSettings> = new BehaviorSubject({});\n  protected _disableFavicon = new BehaviorSubject<boolean>(null);\n\n  settings$ = this._settings.asObservable();\n  disableFavicon$ = this._disableFavicon.asObservable();\n\n  constructor(private stateService: StateService) {\n    this.stateService.activeAccountUnlocked$\n      .pipe(\n        concatMap(async (unlocked) => {\n          if (Utils.global.bitwardenContainerService == null) {\n            return;\n          }\n\n          if (!unlocked) {\n            this._settings.next({});\n            return;\n          }\n\n          const data = await this.stateService.getSettings();\n          const disableFavicon = await this.stateService.getDisableFavicon();\n\n          this._settings.next(data);\n          this._disableFavicon.next(disableFavicon);\n        }),\n      )\n      .subscribe();\n  }\n\n  async setEquivalentDomains(equivalentDomains: string[][]): Promise<void> {\n    const settings = this._settings.getValue() ?? {};\n\n    settings.equivalentDomains = equivalentDomains;\n\n    this._settings.next(settings);\n    await this.stateService.setSettings(settings);\n  }\n\n  getEquivalentDomains(url: string): Set<string> {\n    const domain = Utils.getDomain(url);\n    if (domain == null) {\n      return new Set();\n    }\n\n    const settings = this._settings.getValue();\n\n    let result: string[] = [];\n\n    if (settings?.equivalentDomains != null) {\n      settings.equivalentDomains\n        .filter((ed) => ed.length > 0 && ed.includes(domain))\n        .forEach((ed) => {\n          result = result.concat(ed);\n        });\n    }\n\n    return new Set(result);\n  }\n\n  async setDisableFavicon(value: boolean) {\n    this._disableFavicon.next(value);\n    await this.stateService.setDisableFavicon(value);\n  }\n\n  getDisableFavicon(): boolean {\n    return this._disableFavicon.getValue();\n  }\n\n  async clear(userId?: string): Promise<void> {\n    if (userId == null || userId == (await this.stateService.getUserId())) {\n      this._settings.next({});\n    }\n\n    await this.stateService.setSettings(null, { userId: userId });\n  }\n}\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { AccountSettingsSettings } from \"@bitwarden/common/platform/models/domain/account\";\nimport { SettingsService } from \"@bitwarden/common/services/settings.service\";\n\nimport { browserSession, sessionSync } from \"../platform/decorators/session-sync-observable\";\n\n@browserSession\nexport class BrowserSettingsService extends SettingsService {\n  @sessionSync({ initializer: (obj: string[][]) => obj })\n  protected _settings: BehaviorSubject<AccountSettingsSettings>;\n\n  @sessionSync({ initializer: (b: boolean) => b })\n  protected _disableFavicon: BehaviorSubject<boolean>;\n}\n","import { SettingsService as AbstractSettingsService } from \"@bitwarden/common/abstractions/settings.service\";\n\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../platform/background/service-factories/factory-options\";\nimport {\n  stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../platform/background/service-factories/state-service.factory\";\nimport { BrowserSettingsService } from \"../../services/browser-settings.service\";\n\ntype SettingsServiceFactoryOptions = FactoryOptions;\n\nexport type SettingsServiceInitOptions = SettingsServiceFactoryOptions & StateServiceInitOptions;\n\nexport function settingsServiceFactory(\n  cache: { settingsService?: AbstractSettingsService } & CachedServices,\n  opts: SettingsServiceInitOptions,\n): Promise<AbstractSettingsService> {\n  return factory(\n    cache,\n    \"settingsService\",\n    opts,\n    async () => new BrowserSettingsService(await stateServiceFactory(cache, opts)),\n  );\n}\n","import { Jsonify } from \"type-fest\";\n\nimport {\n  ServerConfigData,\n  ThirdPartyServerConfigData,\n  EnvironmentServerConfigData,\n} from \"../../models/data/server-config.data\";\n\nconst dayInMilliseconds = 24 * 3600 * 1000;\nconst eighteenHoursInMilliseconds = 18 * 3600 * 1000;\n\nexport class ServerConfig {\n  version: string;\n  gitHash: string;\n  server?: ThirdPartyServerConfigData;\n  environment?: EnvironmentServerConfigData;\n  utcDate: Date;\n  featureStates: { [key: string]: string } = {};\n\n  constructor(serverConfigData: ServerConfigData) {\n    this.version = serverConfigData.version;\n    this.gitHash = serverConfigData.gitHash;\n    this.server = serverConfigData.server;\n    this.utcDate = new Date(serverConfigData.utcDate);\n    this.environment = serverConfigData.environment;\n    this.featureStates = serverConfigData.featureStates;\n\n    if (this.server?.name == null && this.server?.url == null) {\n      this.server = null;\n    }\n  }\n\n  private getAgeInMilliseconds(): number {\n    return new Date().getTime() - this.utcDate?.getTime();\n  }\n\n  isValid(): boolean {\n    return this.getAgeInMilliseconds() <= dayInMilliseconds;\n  }\n\n  expiresSoon(): boolean {\n    return this.getAgeInMilliseconds() >= eighteenHoursInMilliseconds;\n  }\n\n  static fromJSON(obj: Jsonify<ServerConfig>): ServerConfig {\n    if (obj == null) {\n      return null;\n    }\n\n    return new ServerConfig(obj);\n  }\n}\n","import {\n  ReplaySubject,\n  Subject,\n  catchError,\n  concatMap,\n  defer,\n  delayWhen,\n  firstValueFrom,\n  map,\n  merge,\n  timer,\n} from \"rxjs\";\nimport { SemVer } from \"semver\";\n\nimport { AuthService } from \"../../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../../auth/enums/authentication-status\";\nimport { FeatureFlag, FeatureFlagValue } from \"../../../enums/feature-flag.enum\";\nimport { ConfigApiServiceAbstraction } from \"../../abstractions/config/config-api.service.abstraction\";\nimport { ConfigServiceAbstraction } from \"../../abstractions/config/config.service.abstraction\";\nimport { ServerConfig } from \"../../abstractions/config/server-config\";\nimport { EnvironmentService, Region } from \"../../abstractions/environment.service\";\nimport { LogService } from \"../../abstractions/log.service\";\nimport { StateService } from \"../../abstractions/state.service\";\nimport { ServerConfigData } from \"../../models/data/server-config.data\";\n\nconst ONE_HOUR_IN_MILLISECONDS = 1000 * 3600;\n\nexport class ConfigService implements ConfigServiceAbstraction {\n  private inited = false;\n\n  protected _serverConfig = new ReplaySubject<ServerConfig | null>(1);\n  serverConfig$ = this._serverConfig.asObservable();\n\n  private _forceFetchConfig = new Subject<void>();\n  protected refreshTimer$ = timer(ONE_HOUR_IN_MILLISECONDS, ONE_HOUR_IN_MILLISECONDS); // after 1 hour, then every hour\n\n  cloudRegion$ = this.serverConfig$.pipe(\n    map((config) => config?.environment?.cloudRegion ?? Region.US),\n  );\n\n  constructor(\n    private stateService: StateService,\n    private configApiService: ConfigApiServiceAbstraction,\n    private authService: AuthService,\n    private environmentService: EnvironmentService,\n    private logService: LogService,\n\n    // Used to avoid duplicate subscriptions, e.g. in browser between the background and popup\n    private subscribe = true,\n  ) {}\n\n  init() {\n    if (!this.subscribe || this.inited) {\n      return;\n    }\n\n    const latestServerConfig$ = defer(() => this.configApiService.get()).pipe(\n      map((response) => new ServerConfigData(response)),\n      delayWhen((data) => this.saveConfig(data)),\n      catchError((e: unknown) => {\n        // fall back to stored ServerConfig (if any)\n        this.logService.error(\"Unable to fetch ServerConfig: \" + (e as Error)?.message);\n        return this.stateService.getServerConfig();\n      }),\n    );\n\n    // If you need to fetch a new config when an event occurs, add an observable that emits on that event here\n    merge(\n      this.refreshTimer$, // an overridable interval\n      this.environmentService.urls, // when environment URLs change (including when app is started)\n      this._forceFetchConfig, // manual\n    )\n      .pipe(\n        concatMap(() => latestServerConfig$),\n        map((data) => (data == null ? null : new ServerConfig(data))),\n      )\n      .subscribe((config) => this._serverConfig.next(config));\n\n    this.inited = true;\n  }\n\n  getFeatureFlag$<T extends FeatureFlagValue>(key: FeatureFlag, defaultValue?: T) {\n    return this.serverConfig$.pipe(\n      map((serverConfig) => {\n        if (serverConfig?.featureStates == null || serverConfig.featureStates[key] == null) {\n          return defaultValue;\n        }\n\n        return serverConfig.featureStates[key] as T;\n      }),\n    );\n  }\n\n  async getFeatureFlag<T extends FeatureFlagValue>(key: FeatureFlag, defaultValue?: T) {\n    return await firstValueFrom(this.getFeatureFlag$(key, defaultValue));\n  }\n\n  triggerServerConfigFetch() {\n    this._forceFetchConfig.next();\n  }\n\n  private async saveConfig(data: ServerConfigData) {\n    if ((await this.authService.getAuthStatus()) === AuthenticationStatus.LoggedOut) {\n      return;\n    }\n\n    await this.stateService.setServerConfig(data);\n    this.environmentService.setCloudWebVaultUrl(data.environment?.cloudRegion);\n  }\n\n  /**\n   * Verifies whether the server version meets the minimum required version\n   * @param minimumRequiredServerVersion The minimum version required\n   * @returns True if the server version is greater than or equal to the minimum required version\n   */\n  checkServerMeetsVersionRequirement$(minimumRequiredServerVersion: SemVer) {\n    return this.serverConfig$.pipe(\n      map((serverConfig) => {\n        if (serverConfig == null) {\n          return false;\n        }\n        const serverVersion = new SemVer(serverConfig.version);\n        return serverVersion.compare(minimumRequiredServerVersion) >= 0;\n      }),\n    );\n  }\n}\n","import { ConfigServiceAbstraction } from \"@bitwarden/common/platform/abstractions/config/config.service.abstraction\";\nimport { ConfigService } from \"@bitwarden/common/platform/services/config/config.service\";\n\nimport {\n  authServiceFactory,\n  AuthServiceInitOptions,\n} from \"../../../auth/background/service-factories/auth-service.factory\";\n\nimport { configApiServiceFactory, ConfigApiServiceInitOptions } from \"./config-api.service.factory\";\nimport {\n  environmentServiceFactory,\n  EnvironmentServiceInitOptions,\n} from \"./environment-service.factory\";\nimport { FactoryOptions, CachedServices, factory } from \"./factory-options\";\nimport { logServiceFactory, LogServiceInitOptions } from \"./log-service.factory\";\nimport { stateServiceFactory, StateServiceInitOptions } from \"./state-service.factory\";\n\ntype ConfigServiceFactoryOptions = FactoryOptions & {\n  configServiceOptions?: {\n    subscribe?: boolean;\n  };\n};\n\nexport type ConfigServiceInitOptions = ConfigServiceFactoryOptions &\n  StateServiceInitOptions &\n  ConfigApiServiceInitOptions &\n  AuthServiceInitOptions &\n  EnvironmentServiceInitOptions &\n  LogServiceInitOptions;\n\nexport function configServiceFactory(\n  cache: { configService?: ConfigServiceAbstraction } & CachedServices,\n  opts: ConfigServiceInitOptions,\n): Promise<ConfigServiceAbstraction> {\n  return factory(\n    cache,\n    \"configService\",\n    opts,\n    async () =>\n      new ConfigService(\n        await stateServiceFactory(cache, opts),\n        await configApiServiceFactory(cache, opts),\n        await authServiceFactory(cache, opts),\n        await environmentServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n        opts.configServiceOptions?.subscribe ?? true,\n      ),\n  );\n}\n","import { ConfigApiServiceAbstraction } from \"@bitwarden/common/platform/abstractions/config/config-api.service.abstraction\";\nimport { ConfigApiService } from \"@bitwarden/common/platform/services/config/config-api.service\";\n\nimport {\n  authServiceFactory,\n  AuthServiceInitOptions,\n} from \"../../../auth/background/service-factories/auth-service.factory\";\n\nimport { apiServiceFactory, ApiServiceInitOptions } from \"./api-service.factory\";\nimport { FactoryOptions, CachedServices, factory } from \"./factory-options\";\n\ntype ConfigApiServiceFactoyOptions = FactoryOptions;\n\nexport type ConfigApiServiceInitOptions = ConfigApiServiceFactoyOptions &\n  ApiServiceInitOptions &\n  AuthServiceInitOptions;\n\nexport function configApiServiceFactory(\n  cache: { configApiService?: ConfigApiServiceAbstraction } & CachedServices,\n  opts: ConfigApiServiceInitOptions,\n): Promise<ConfigApiServiceAbstraction> {\n  return factory(\n    cache,\n    \"configApiService\",\n    opts,\n    async () =>\n      new ConfigApiService(\n        await apiServiceFactory(cache, opts),\n        await authServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { CipherService as AbstractCipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CipherService } from \"@bitwarden/common/vault/services/cipher.service\";\n\nimport {\n  AutofillSettingsServiceInitOptions,\n  autofillSettingsServiceFactory,\n} from \"../../../autofill/background/service_factories/autofill-settings-service.factory\";\nimport {\n  CipherFileUploadServiceInitOptions,\n  cipherFileUploadServiceFactory,\n} from \"../../../background/service-factories/cipher-file-upload-service.factory\";\nimport {\n  searchServiceFactory,\n  SearchServiceInitOptions,\n} from \"../../../background/service-factories/search-service.factory\";\nimport {\n  SettingsServiceInitOptions,\n  settingsServiceFactory,\n} from \"../../../background/service-factories/settings-service.factory\";\nimport {\n  apiServiceFactory,\n  ApiServiceInitOptions,\n} from \"../../../platform/background/service-factories/api-service.factory\";\nimport {\n  configServiceFactory,\n  ConfigServiceInitOptions,\n} from \"../../../platform/background/service-factories/config-service.factory\";\nimport {\n  cryptoServiceFactory,\n  CryptoServiceInitOptions,\n} from \"../../../platform/background/service-factories/crypto-service.factory\";\nimport {\n  EncryptServiceInitOptions,\n  encryptServiceFactory,\n} from \"../../../platform/background/service-factories/encrypt-service.factory\";\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  i18nServiceFactory,\n  I18nServiceInitOptions,\n} from \"../../../platform/background/service-factories/i18n-service.factory\";\nimport {\n  stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../../platform/background/service-factories/state-service.factory\";\n\ntype CipherServiceFactoryOptions = FactoryOptions;\n\nexport type CipherServiceInitOptions = CipherServiceFactoryOptions &\n  CryptoServiceInitOptions &\n  SettingsServiceInitOptions &\n  ApiServiceInitOptions &\n  CipherFileUploadServiceInitOptions &\n  I18nServiceInitOptions &\n  SearchServiceInitOptions &\n  StateServiceInitOptions &\n  AutofillSettingsServiceInitOptions &\n  EncryptServiceInitOptions &\n  ConfigServiceInitOptions;\n\nexport function cipherServiceFactory(\n  cache: { cipherService?: AbstractCipherService } & CachedServices,\n  opts: CipherServiceInitOptions,\n): Promise<AbstractCipherService> {\n  return factory(\n    cache,\n    \"cipherService\",\n    opts,\n    async () =>\n      new CipherService(\n        await cryptoServiceFactory(cache, opts),\n        await settingsServiceFactory(cache, opts),\n        await apiServiceFactory(cache, opts),\n        await i18nServiceFactory(cache, opts),\n        await searchServiceFactory(cache, opts),\n        await stateServiceFactory(cache, opts),\n        await autofillSettingsServiceFactory(cache, opts),\n        await encryptServiceFactory(cache, opts),\n        await cipherFileUploadServiceFactory(cache, opts),\n        await configServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { SearchService as AbstractSearchService } from \"@bitwarden/common/abstractions/search.service\";\nimport { SearchService } from \"@bitwarden/common/services/search.service\";\n\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../platform/background/service-factories/factory-options\";\nimport {\n  i18nServiceFactory,\n  I18nServiceInitOptions,\n} from \"../../platform/background/service-factories/i18n-service.factory\";\nimport {\n  logServiceFactory,\n  LogServiceInitOptions,\n} from \"../../platform/background/service-factories/log-service.factory\";\n\ntype SearchServiceFactoryOptions = FactoryOptions;\n\nexport type SearchServiceInitOptions = SearchServiceFactoryOptions &\n  LogServiceInitOptions &\n  I18nServiceInitOptions;\n\nexport function searchServiceFactory(\n  cache: { searchService?: AbstractSearchService } & CachedServices,\n  opts: SearchServiceInitOptions,\n): Promise<AbstractSearchService> {\n  return factory(\n    cache,\n    \"searchService\",\n    opts,\n    async () =>\n      new SearchService(\n        await logServiceFactory(cache, opts),\n        await i18nServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { Account } from \"../../models/account\";\nimport { CachedServices } from \"../../platform/background/service-factories/factory-options\";\nimport {\n  i18nServiceFactory,\n  I18nServiceInitOptions,\n} from \"../../platform/background/service-factories/i18n-service.factory\";\nimport {\n  logServiceFactory,\n  LogServiceInitOptions,\n} from \"../../platform/background/service-factories/log-service.factory\";\nimport {\n  stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../platform/background/service-factories/state-service.factory\";\nimport { BrowserStateService } from \"../../platform/services/abstractions/browser-state.service\";\nimport {\n  AUTOFILL_CARD_ID,\n  AUTOFILL_ID,\n  AUTOFILL_IDENTITY_ID,\n  COPY_IDENTIFIER_ID,\n  COPY_PASSWORD_ID,\n  COPY_USERNAME_ID,\n  COPY_VERIFICATION_CODE_ID,\n  CREATE_CARD_ID,\n  CREATE_IDENTITY_ID,\n  CREATE_LOGIN_ID,\n  GENERATE_PASSWORD_ID,\n  NOOP_COMMAND_SUFFIX,\n  ROOT_ID,\n  SEPARATOR_ID,\n} from \"../constants\";\n\nimport { InitContextMenuItems } from \"./abstractions/main-context-menu-handler\";\n\nexport class MainContextMenuHandler {\n  initRunning = false;\n  private initContextMenuItems: InitContextMenuItems[] = [\n    {\n      id: ROOT_ID,\n      title: \"Bitwarden\",\n    },\n    {\n      id: AUTOFILL_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"autoFillLogin\"),\n    },\n    {\n      id: COPY_USERNAME_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"copyUsername\"),\n    },\n    {\n      id: COPY_PASSWORD_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"copyPassword\"),\n    },\n    {\n      id: COPY_VERIFICATION_CODE_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"copyVerificationCode\"),\n      checkPremiumAccess: true,\n    },\n    {\n      id: SEPARATOR_ID + 1,\n      type: \"separator\",\n      parentId: ROOT_ID,\n    },\n    {\n      id: AUTOFILL_IDENTITY_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"autoFillIdentity\"),\n    },\n    {\n      id: AUTOFILL_CARD_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"autoFillCard\"),\n    },\n    {\n      id: SEPARATOR_ID + 2,\n      type: \"separator\",\n      parentId: ROOT_ID,\n    },\n    {\n      id: GENERATE_PASSWORD_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"generatePasswordCopied\"),\n    },\n    {\n      id: COPY_IDENTIFIER_ID,\n      parentId: ROOT_ID,\n      title: this.i18nService.t(\"copyElementIdentifier\"),\n    },\n  ];\n  private noCardsContextMenuItems: chrome.contextMenus.CreateProperties[] = [\n    {\n      id: `${AUTOFILL_CARD_ID}_NOTICE`,\n      enabled: false,\n      parentId: AUTOFILL_CARD_ID,\n      title: this.i18nService.t(\"noCards\"),\n      type: \"normal\",\n    },\n    {\n      id: `${AUTOFILL_CARD_ID}_${SEPARATOR_ID}`,\n      parentId: AUTOFILL_CARD_ID,\n      type: \"separator\",\n    },\n    {\n      id: `${AUTOFILL_CARD_ID}_${CREATE_CARD_ID}`,\n      parentId: AUTOFILL_CARD_ID,\n      title: this.i18nService.t(\"addCardMenu\"),\n      type: \"normal\",\n    },\n  ];\n  private noIdentitiesContextMenuItems: chrome.contextMenus.CreateProperties[] = [\n    {\n      id: `${AUTOFILL_IDENTITY_ID}_NOTICE`,\n      enabled: false,\n      parentId: AUTOFILL_IDENTITY_ID,\n      title: this.i18nService.t(\"noIdentities\"),\n      type: \"normal\",\n    },\n    {\n      id: `${AUTOFILL_IDENTITY_ID}_${SEPARATOR_ID}`,\n      parentId: AUTOFILL_IDENTITY_ID,\n      type: \"separator\",\n    },\n    {\n      id: `${AUTOFILL_IDENTITY_ID}_${CREATE_IDENTITY_ID}`,\n      parentId: AUTOFILL_IDENTITY_ID,\n      title: this.i18nService.t(\"addIdentityMenu\"),\n      type: \"normal\",\n    },\n  ];\n  private noLoginsContextMenuItems: chrome.contextMenus.CreateProperties[] = [\n    {\n      id: `${AUTOFILL_ID}_NOTICE`,\n      enabled: false,\n      parentId: AUTOFILL_ID,\n      title: this.i18nService.t(\"noMatchingLogins\"),\n      type: \"normal\",\n    },\n    {\n      id: `${AUTOFILL_ID}_${SEPARATOR_ID}1`,\n      parentId: AUTOFILL_ID,\n      type: \"separator\",\n    },\n  ];\n\n  constructor(\n    private stateService: BrowserStateService,\n    private i18nService: I18nService,\n    private logService: LogService,\n  ) {}\n\n  static async mv3Create(cachedServices: CachedServices) {\n    const stateFactory = new StateFactory(GlobalState, Account);\n    const serviceOptions: StateServiceInitOptions & I18nServiceInitOptions & LogServiceInitOptions =\n      {\n        cryptoFunctionServiceOptions: {\n          win: self,\n        },\n        encryptServiceOptions: {\n          logMacFailures: false,\n        },\n        i18nServiceOptions: {\n          systemLanguage: chrome.i18n.getUILanguage(),\n        },\n        logServiceOptions: {\n          isDev: false,\n        },\n        stateServiceOptions: {\n          stateFactory: stateFactory,\n        },\n      };\n\n    return new MainContextMenuHandler(\n      await stateServiceFactory(cachedServices, serviceOptions),\n      await i18nServiceFactory(cachedServices, serviceOptions),\n      await logServiceFactory(cachedServices, serviceOptions),\n    );\n  }\n\n  /**\n   *\n   * @returns a boolean showing whether or not items were created\n   */\n  async init(): Promise<boolean> {\n    const menuDisabled = await this.stateService.getDisableContextMenuItem();\n    if (menuDisabled) {\n      await MainContextMenuHandler.removeAll();\n      return false;\n    }\n\n    if (this.initRunning) {\n      return true;\n    }\n    this.initRunning = true;\n\n    try {\n      for (const options of this.initContextMenuItems) {\n        if (options.checkPremiumAccess && !(await this.stateService.getCanAccessPremium())) {\n          continue;\n        }\n\n        delete options.checkPremiumAccess;\n        await MainContextMenuHandler.create({ ...options, contexts: [\"all\"] });\n      }\n    } catch (error) {\n      this.logService.warning(error.message);\n    } finally {\n      this.initRunning = false;\n    }\n    return true;\n  }\n\n  /**\n   * Creates a context menu item\n   *\n   * @param options - the options for the context menu item\n   */\n  private static create = async (options: chrome.contextMenus.CreateProperties) => {\n    if (!chrome.contextMenus) {\n      return;\n    }\n\n    return new Promise<void>((resolve, reject) => {\n      chrome.contextMenus.create(options, () => {\n        if (chrome.runtime.lastError) {\n          return reject(chrome.runtime.lastError);\n        }\n        resolve();\n      });\n    });\n  };\n\n  static async removeAll() {\n    return new Promise<void>((resolve, reject) => {\n      chrome.contextMenus.removeAll(() => {\n        if (chrome.runtime.lastError) {\n          reject(chrome.runtime.lastError);\n          return;\n        }\n\n        resolve();\n      });\n    });\n  }\n\n  static remove(menuItemId: string) {\n    return new Promise<void>((resolve, reject) => {\n      chrome.contextMenus.remove(menuItemId, () => {\n        if (chrome.runtime.lastError) {\n          reject(chrome.runtime.lastError);\n          return;\n        }\n\n        resolve();\n      });\n    });\n  }\n\n  async loadOptions(title: string, optionId: string, cipher?: CipherView) {\n    try {\n      const sanitizedTitle = MainContextMenuHandler.sanitizeContextMenuTitle(title);\n\n      const createChildItem = async (parentId: string) => {\n        const menuItemId = `${parentId}_${optionId}`;\n\n        return await MainContextMenuHandler.create({\n          type: \"normal\",\n          id: menuItemId,\n          parentId,\n          title: sanitizedTitle,\n          contexts: [\"all\"],\n        });\n      };\n\n      if (\n        !cipher ||\n        (cipher.type === CipherType.Login && !Utils.isNullOrEmpty(cipher.login?.password))\n      ) {\n        await createChildItem(AUTOFILL_ID);\n\n        if (cipher?.viewPassword ?? true) {\n          await createChildItem(COPY_PASSWORD_ID);\n        }\n      }\n\n      if (\n        !cipher ||\n        (cipher.type === CipherType.Login && !Utils.isNullOrEmpty(cipher.login?.username))\n      ) {\n        await createChildItem(COPY_USERNAME_ID);\n      }\n\n      const canAccessPremium = await this.stateService.getCanAccessPremium();\n      if (canAccessPremium && (!cipher || !Utils.isNullOrEmpty(cipher.login?.totp))) {\n        await createChildItem(COPY_VERIFICATION_CODE_ID);\n      }\n\n      if ((!cipher || cipher.type === CipherType.Card) && optionId !== CREATE_LOGIN_ID) {\n        await createChildItem(AUTOFILL_CARD_ID);\n      }\n\n      if ((!cipher || cipher.type === CipherType.Identity) && optionId !== CREATE_LOGIN_ID) {\n        await createChildItem(AUTOFILL_IDENTITY_ID);\n      }\n    } catch (error) {\n      this.logService.warning(error.message);\n    }\n  }\n\n  static sanitizeContextMenuTitle(title: string): string {\n    return title.replace(/&/g, \"&&\");\n  }\n\n  async noAccess() {\n    if (await this.init()) {\n      const authed = await this.stateService.getIsAuthenticated();\n      this.loadOptions(\n        this.i18nService.t(authed ? \"unlockVaultMenu\" : \"loginToVaultMenu\"),\n        NOOP_COMMAND_SUFFIX,\n      ).catch((error) => this.logService.warning(error.message));\n    }\n  }\n\n  async noCards() {\n    try {\n      for (const option of this.noCardsContextMenuItems) {\n        await MainContextMenuHandler.create(option);\n      }\n    } catch (error) {\n      this.logService.warning(error.message);\n    }\n  }\n\n  async noIdentities() {\n    try {\n      for (const option of this.noIdentitiesContextMenuItems) {\n        await MainContextMenuHandler.create(option);\n      }\n    } catch (error) {\n      this.logService.warning(error.message);\n    }\n  }\n\n  async noLogins() {\n    try {\n      for (const option of this.noLoginsContextMenuItems) {\n        await MainContextMenuHandler.create(option);\n      }\n\n      await this.loadOptions(this.i18nService.t(\"addLoginMenu\"), CREATE_LOGIN_ID);\n    } catch (error) {\n      this.logService.warning(error.message);\n    }\n  }\n}\n","import { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport {\n  authServiceFactory,\n  AuthServiceInitOptions,\n} from \"../../auth/background/service-factories/auth-service.factory\";\nimport { Account } from \"../../models/account\";\nimport { CachedServices } from \"../../platform/background/service-factories/factory-options\";\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport {\n  cipherServiceFactory,\n  CipherServiceInitOptions,\n} from \"../../vault/background/service_factories/cipher-service.factory\";\nimport { AutofillCipherTypeId } from \"../types\";\n\nimport { MainContextMenuHandler } from \"./main-context-menu-handler\";\n\nconst NOT_IMPLEMENTED = (..._args: unknown[]) => Promise.resolve();\n\nconst LISTENED_TO_COMMANDS = [\n  \"loggedIn\",\n  \"unlocked\",\n  \"syncCompleted\",\n  \"bgUpdateContextMenu\",\n  \"editedCipher\",\n  \"addedCipher\",\n  \"deletedCipher\",\n];\n\nexport class CipherContextMenuHandler {\n  constructor(\n    private mainContextMenuHandler: MainContextMenuHandler,\n    private authService: AuthService,\n    private cipherService: CipherService,\n  ) {}\n\n  static async create(cachedServices: CachedServices) {\n    const stateFactory = new StateFactory(GlobalState, Account);\n    const serviceOptions: AuthServiceInitOptions & CipherServiceInitOptions = {\n      apiServiceOptions: {\n        logoutCallback: NOT_IMPLEMENTED,\n      },\n      cryptoFunctionServiceOptions: {\n        win: self,\n      },\n      encryptServiceOptions: {\n        logMacFailures: false,\n      },\n      i18nServiceOptions: {\n        systemLanguage: chrome.i18n.getUILanguage(),\n      },\n      keyConnectorServiceOptions: {\n        logoutCallback: NOT_IMPLEMENTED,\n      },\n      logServiceOptions: {\n        isDev: false,\n      },\n      platformUtilsServiceOptions: {\n        biometricCallback: () => Promise.resolve(false),\n        clipboardWriteCallback: NOT_IMPLEMENTED,\n        win: self,\n      },\n      stateServiceOptions: {\n        stateFactory: stateFactory,\n      },\n    };\n    return new CipherContextMenuHandler(\n      await MainContextMenuHandler.mv3Create(cachedServices),\n      await authServiceFactory(cachedServices, serviceOptions),\n      await cipherServiceFactory(cachedServices, serviceOptions),\n    );\n  }\n\n  static async windowsOnFocusChangedListener(windowId: number, serviceCache: CachedServices) {\n    const cipherContextMenuHandler = await CipherContextMenuHandler.create(serviceCache);\n    const tab = await BrowserApi.getTabFromCurrentWindow();\n    await cipherContextMenuHandler.update(tab?.url);\n  }\n\n  static async tabsOnActivatedListener(\n    activeInfo: chrome.tabs.TabActiveInfo,\n    serviceCache: CachedServices,\n  ) {\n    const cipherContextMenuHandler = await CipherContextMenuHandler.create(serviceCache);\n    const tab = await BrowserApi.getTab(activeInfo.tabId);\n    await cipherContextMenuHandler.update(tab.url);\n  }\n\n  static async tabsOnReplacedListener(\n    addedTabId: number,\n    removedTabId: number,\n    serviceCache: CachedServices,\n  ) {\n    const cipherContextMenuHandler = await CipherContextMenuHandler.create(serviceCache);\n    const tab = await BrowserApi.getTab(addedTabId);\n    await cipherContextMenuHandler.update(tab.url);\n  }\n\n  static async tabsOnUpdatedListener(\n    tabId: number,\n    changeInfo: chrome.tabs.TabChangeInfo,\n    tab: chrome.tabs.Tab,\n    serviceCache: CachedServices,\n  ) {\n    if (changeInfo.status !== \"complete\") {\n      return;\n    }\n    const cipherContextMenuHandler = await CipherContextMenuHandler.create(serviceCache);\n    await cipherContextMenuHandler.update(tab.url);\n  }\n\n  static async messageListener(\n    message: { command: string },\n    sender: chrome.runtime.MessageSender,\n    cachedServices: CachedServices,\n  ) {\n    if (!CipherContextMenuHandler.shouldListen(message)) {\n      return;\n    }\n    const cipherContextMenuHandler = await CipherContextMenuHandler.create(cachedServices);\n    await cipherContextMenuHandler.messageListener(message);\n  }\n\n  private static shouldListen(message: { command: string }) {\n    return LISTENED_TO_COMMANDS.includes(message.command);\n  }\n\n  async messageListener(message: { command: string }, sender?: chrome.runtime.MessageSender) {\n    if (!CipherContextMenuHandler.shouldListen(message)) {\n      return;\n    }\n\n    const activeTabs = await BrowserApi.getActiveTabs();\n    if (!activeTabs || activeTabs.length === 0) {\n      return;\n    }\n\n    await this.update(activeTabs[0].url);\n  }\n\n  async update(url: string) {\n    if (this.mainContextMenuHandler.initRunning) {\n      return;\n    }\n\n    const authStatus = await this.authService.getAuthStatus();\n    await MainContextMenuHandler.removeAll();\n    if (authStatus !== AuthenticationStatus.Unlocked) {\n      // Should I pass in the auth status or even have two separate methods for this\n      // on MainContextMenuHandler\n      await this.mainContextMenuHandler.noAccess();\n      return;\n    }\n\n    const menuEnabled = await this.mainContextMenuHandler.init();\n    if (!menuEnabled) {\n      return;\n    }\n\n    const ciphers = await this.cipherService.getAllDecryptedForUrl(url, [\n      CipherType.Card,\n      CipherType.Identity,\n    ]);\n    ciphers.sort((a, b) => this.cipherService.sortCiphersByLastUsedThenName(a, b));\n\n    const groupedCiphers: Record<AutofillCipherTypeId, CipherView[]> = ciphers.reduce(\n      (ciphersByType, cipher) => {\n        if (!cipher?.type) {\n          return ciphersByType;\n        }\n\n        const existingCiphersOfType = ciphersByType[cipher.type as AutofillCipherTypeId] || [];\n\n        return {\n          ...ciphersByType,\n          [cipher.type]: [...existingCiphersOfType, cipher],\n        };\n      },\n      {\n        [CipherType.Login]: [],\n        [CipherType.Card]: [],\n        [CipherType.Identity]: [],\n      },\n    );\n\n    if (groupedCiphers[CipherType.Login].length === 0) {\n      await this.mainContextMenuHandler.noLogins();\n    }\n\n    if (groupedCiphers[CipherType.Identity].length === 0) {\n      await this.mainContextMenuHandler.noIdentities();\n    }\n\n    if (groupedCiphers[CipherType.Card].length === 0) {\n      await this.mainContextMenuHandler.noCards();\n    }\n\n    for (const cipher of ciphers) {\n      await this.updateForCipher(cipher);\n    }\n  }\n\n  private async updateForCipher(cipher: CipherView) {\n    if (\n      cipher == null ||\n      !new Set([CipherType.Login, CipherType.Card, CipherType.Identity]).has(cipher.type)\n    ) {\n      return;\n    }\n\n    let title = cipher.name;\n\n    if (cipher.type === CipherType.Login && !Utils.isNullOrEmpty(title) && cipher.login?.username) {\n      title += ` (${cipher.login.username})`;\n    }\n\n    if (cipher.type === CipherType.Card && cipher.card?.subTitle) {\n      title += ` ${cipher.card.subTitle}`;\n    }\n\n    await this.mainContextMenuHandler.loadOptions(title, cipher.id, cipher);\n  }\n}\n","import { VaultTimeoutSettingsService as AbstractVaultTimeoutSettingsService } from \"@bitwarden/common/abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { VaultTimeoutSettingsService } from \"@bitwarden/common/services/vault-timeout/vault-timeout-settings.service\";\n\nimport {\n  policyServiceFactory,\n  PolicyServiceInitOptions,\n} from \"../../admin-console/background/service-factories/policy-service.factory\";\nimport {\n  tokenServiceFactory,\n  TokenServiceInitOptions,\n} from \"../../auth/background/service-factories/token-service.factory\";\nimport {\n  CryptoServiceInitOptions,\n  cryptoServiceFactory,\n} from \"../../platform/background/service-factories/crypto-service.factory\";\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../platform/background/service-factories/factory-options\";\nimport {\n  StateServiceInitOptions,\n  stateServiceFactory,\n} from \"../../platform/background/service-factories/state-service.factory\";\n\ntype VaultTimeoutSettingsServiceFactoryOptions = FactoryOptions;\n\nexport type VaultTimeoutSettingsServiceInitOptions = VaultTimeoutSettingsServiceFactoryOptions &\n  CryptoServiceInitOptions &\n  TokenServiceInitOptions &\n  PolicyServiceInitOptions &\n  StateServiceInitOptions;\n\nexport function vaultTimeoutSettingsServiceFactory(\n  cache: { vaultTimeoutSettingsService?: AbstractVaultTimeoutSettingsService } & CachedServices,\n  opts: VaultTimeoutSettingsServiceInitOptions,\n): Promise<AbstractVaultTimeoutSettingsService> {\n  return factory(\n    cache,\n    \"vaultTimeoutSettingsService\",\n    opts,\n    async () =>\n      new VaultTimeoutSettingsService(\n        await cryptoServiceFactory(cache, opts),\n        await tokenServiceFactory(cache, opts),\n        await policyServiceFactory(cache, opts),\n        await stateServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { UserVerificationService as AbstractUserVerificationService } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification.service.abstraction\";\nimport { UserVerificationService } from \"@bitwarden/common/auth/services/user-verification/user-verification.service\";\n\nimport {\n  VaultTimeoutSettingsServiceInitOptions,\n  vaultTimeoutSettingsServiceFactory,\n} from \"../../../background/service-factories/vault-timeout-settings-service.factory\";\nimport {\n  CryptoServiceInitOptions,\n  cryptoServiceFactory,\n} from \"../../../platform/background/service-factories/crypto-service.factory\";\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  I18nServiceInitOptions,\n  i18nServiceFactory,\n} from \"../../../platform/background/service-factories/i18n-service.factory\";\nimport {\n  LogServiceInitOptions,\n  logServiceFactory,\n} from \"../../../platform/background/service-factories/log-service.factory\";\nimport {\n  platformUtilsServiceFactory,\n  PlatformUtilsServiceInitOptions,\n} from \"../../../platform/background/service-factories/platform-utils-service.factory\";\nimport {\n  StateServiceInitOptions,\n  stateServiceFactory,\n} from \"../../../platform/background/service-factories/state-service.factory\";\n\nimport { PinCryptoServiceInitOptions, pinCryptoServiceFactory } from \"./pin-crypto-service.factory\";\nimport {\n  UserVerificationApiServiceInitOptions,\n  userVerificationApiServiceFactory,\n} from \"./user-verification-api-service.factory\";\n\ntype UserVerificationServiceFactoryOptions = FactoryOptions;\n\nexport type UserVerificationServiceInitOptions = UserVerificationServiceFactoryOptions &\n  StateServiceInitOptions &\n  CryptoServiceInitOptions &\n  I18nServiceInitOptions &\n  UserVerificationApiServiceInitOptions &\n  PinCryptoServiceInitOptions &\n  LogServiceInitOptions &\n  VaultTimeoutSettingsServiceInitOptions &\n  PlatformUtilsServiceInitOptions;\n\nexport function userVerificationServiceFactory(\n  cache: { userVerificationService?: AbstractUserVerificationService } & CachedServices,\n  opts: UserVerificationServiceInitOptions,\n): Promise<AbstractUserVerificationService> {\n  return factory(\n    cache,\n    \"userVerificationService\",\n    opts,\n    async () =>\n      new UserVerificationService(\n        await stateServiceFactory(cache, opts),\n        await cryptoServiceFactory(cache, opts),\n        await i18nServiceFactory(cache, opts),\n        await userVerificationApiServiceFactory(cache, opts),\n        await pinCryptoServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n        await vaultTimeoutSettingsServiceFactory(cache, opts),\n        await platformUtilsServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { UserVerificationApiServiceAbstraction } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification-api.service.abstraction\";\nimport { UserVerificationApiService } from \"@bitwarden/common/auth/services/user-verification/user-verification-api.service\";\n\nimport {\n  ApiServiceInitOptions,\n  apiServiceFactory,\n} from \"../../../platform/background/service-factories/api-service.factory\";\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../../platform/background/service-factories/factory-options\";\n\ntype UserVerificationApiServiceFactoryOptions = FactoryOptions;\n\nexport type UserVerificationApiServiceInitOptions = UserVerificationApiServiceFactoryOptions &\n  ApiServiceInitOptions;\n\nexport function userVerificationApiServiceFactory(\n  cache: { userVerificationApiService?: UserVerificationApiServiceAbstraction } & CachedServices,\n  opts: UserVerificationApiServiceInitOptions,\n): Promise<UserVerificationApiServiceAbstraction> {\n  return factory(\n    cache,\n    \"userVerificationApiService\",\n    opts,\n    async () => new UserVerificationApiService(await apiServiceFactory(cache, opts)),\n  );\n}\n","import { PinCryptoServiceAbstraction, PinCryptoService } from \"@bitwarden/auth/common\";\n\nimport {\n  VaultTimeoutSettingsServiceInitOptions,\n  vaultTimeoutSettingsServiceFactory,\n} from \"../../../background/service-factories/vault-timeout-settings-service.factory\";\nimport {\n  CryptoServiceInitOptions,\n  cryptoServiceFactory,\n} from \"../../../platform/background/service-factories/crypto-service.factory\";\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  LogServiceInitOptions,\n  logServiceFactory,\n} from \"../../../platform/background/service-factories/log-service.factory\";\nimport {\n  StateServiceInitOptions,\n  stateServiceFactory,\n} from \"../../../platform/background/service-factories/state-service.factory\";\n\ntype PinCryptoServiceFactoryOptions = FactoryOptions;\n\nexport type PinCryptoServiceInitOptions = PinCryptoServiceFactoryOptions &\n  StateServiceInitOptions &\n  CryptoServiceInitOptions &\n  VaultTimeoutSettingsServiceInitOptions &\n  LogServiceInitOptions;\n\nexport function pinCryptoServiceFactory(\n  cache: { pinCryptoService?: PinCryptoServiceAbstraction } & CachedServices,\n  opts: PinCryptoServiceInitOptions,\n): Promise<PinCryptoServiceAbstraction> {\n  return factory(\n    cache,\n    \"pinCryptoService\",\n    opts,\n    async () =>\n      new PinCryptoService(\n        await stateServiceFactory(cache, opts),\n        await cryptoServiceFactory(cache, opts),\n        await vaultTimeoutSettingsServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { EventCollectionService as AbstractEventCollectionService } from \"@bitwarden/common/abstractions/event/event-collection.service\";\nimport { EventCollectionService } from \"@bitwarden/common/services/event/event-collection.service\";\n\nimport {\n  organizationServiceFactory,\n  OrganizationServiceInitOptions,\n} from \"../../admin-console/background/service-factories/organization-service.factory\";\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../platform/background/service-factories/factory-options\";\nimport {\n  stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../platform/background/service-factories/state-service.factory\";\nimport {\n  cipherServiceFactory,\n  CipherServiceInitOptions,\n} from \"../../vault/background/service_factories/cipher-service.factory\";\n\nimport {\n  eventUploadServiceFactory,\n  EventUploadServiceInitOptions,\n} from \"./event-upload-service.factory\";\n\ntype EventCollectionServiceOptions = FactoryOptions;\n\nexport type EventCollectionServiceInitOptions = EventCollectionServiceOptions &\n  CipherServiceInitOptions &\n  StateServiceInitOptions &\n  OrganizationServiceInitOptions &\n  EventUploadServiceInitOptions;\n\nexport function eventCollectionServiceFactory(\n  cache: { eventCollectionService?: AbstractEventCollectionService } & CachedServices,\n  opts: EventCollectionServiceInitOptions,\n): Promise<AbstractEventCollectionService> {\n  return factory(\n    cache,\n    \"eventCollectionService\",\n    opts,\n    async () =>\n      new EventCollectionService(\n        await cipherServiceFactory(cache, opts),\n        await stateServiceFactory(cache, opts),\n        await organizationServiceFactory(cache, opts),\n        await eventUploadServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { EventUploadService as AbstractEventUploadService } from \"@bitwarden/common/abstractions/event/event-upload.service\";\nimport { EventUploadService } from \"@bitwarden/common/services/event/event-upload.service\";\n\nimport {\n  ApiServiceInitOptions,\n  apiServiceFactory,\n} from \"../../platform/background/service-factories/api-service.factory\";\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../platform/background/service-factories/factory-options\";\nimport {\n  logServiceFactory,\n  LogServiceInitOptions,\n} from \"../../platform/background/service-factories/log-service.factory\";\nimport {\n  stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../platform/background/service-factories/state-service.factory\";\n\ntype EventUploadServiceOptions = FactoryOptions;\n\nexport type EventUploadServiceInitOptions = EventUploadServiceOptions &\n  ApiServiceInitOptions &\n  StateServiceInitOptions &\n  LogServiceInitOptions;\n\nexport function eventUploadServiceFactory(\n  cache: { eventUploadService?: AbstractEventUploadService } & CachedServices,\n  opts: EventUploadServiceInitOptions,\n): Promise<AbstractEventUploadService> {\n  return factory(\n    cache,\n    \"eventUploadService\",\n    opts,\n    async () =>\n      new EventUploadService(\n        await apiServiceFactory(cache, opts),\n        await stateServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n      ),\n  );\n}\n","import {\n  PasswordGenerationService,\n  PasswordGenerationServiceAbstraction,\n} from \"@bitwarden/common/tools/generator/password\";\n\nimport {\n  policyServiceFactory,\n  PolicyServiceInitOptions,\n} from \"../../../admin-console/background/service-factories/policy-service.factory\";\nimport {\n  CryptoServiceInitOptions,\n  cryptoServiceFactory,\n} from \"../../../platform/background/service-factories/crypto-service.factory\";\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../../platform/background/service-factories/state-service.factory\";\n\ntype PasswordGenerationServiceFactoryOptions = FactoryOptions;\n\nexport type PasswordGenerationServiceInitOptions = PasswordGenerationServiceFactoryOptions &\n  CryptoServiceInitOptions &\n  PolicyServiceInitOptions &\n  StateServiceInitOptions;\n\nexport function passwordGenerationServiceFactory(\n  cache: { passwordGenerationService?: PasswordGenerationServiceAbstraction } & CachedServices,\n  opts: PasswordGenerationServiceInitOptions,\n): Promise<PasswordGenerationServiceAbstraction> {\n  return factory(\n    cache,\n    \"passwordGenerationService\",\n    opts,\n    async () =>\n      new PasswordGenerationService(\n        await cryptoServiceFactory(cache, opts),\n        await policyServiceFactory(cache, opts),\n        await stateServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { TotpService as AbstractTotpService } from \"@bitwarden/common/vault/abstractions/totp.service\";\nimport { TotpService } from \"@bitwarden/common/vault/services/totp.service\";\n\nimport {\n  CryptoFunctionServiceInitOptions,\n  cryptoFunctionServiceFactory,\n} from \"../../../platform/background/service-factories/crypto-function-service.factory\";\nimport {\n  FactoryOptions,\n  CachedServices,\n  factory,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  LogServiceInitOptions,\n  logServiceFactory,\n} from \"../../../platform/background/service-factories/log-service.factory\";\n\ntype TotpServiceOptions = FactoryOptions;\n\nexport type TotpServiceInitOptions = TotpServiceOptions &\n  CryptoFunctionServiceInitOptions &\n  LogServiceInitOptions;\n\nexport function totpServiceFactory(\n  cache: { totpService?: AbstractTotpService } & CachedServices,\n  opts: TotpServiceInitOptions,\n): Promise<AbstractTotpService> {\n  return factory(\n    cache,\n    \"totpService\",\n    opts,\n    async () =>\n      new TotpService(\n        await cryptoFunctionServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n      ),\n  );\n}\n","const AutofillPort = {\n  InjectedScript: \"autofill-injected-script-port\",\n} as const;\n\nexport { AutofillPort };\n","// String values affect code flow in autofill.ts and must not be changed\nexport type FillScriptActions = \"click_on_opid\" | \"focus_by_opid\" | \"fill_by_opid\";\n\nexport type FillScript = [action: FillScriptActions, opid: string, value?: string];\n\nexport type AutofillScriptProperties = {\n  delay_between_operations?: number;\n};\n\nexport type AutofillInsertActions = {\n  fill_by_opid: ({ opid, value }: { opid: string; value: string }) => void;\n  click_on_opid: ({ opid }: { opid: string }) => void;\n  focus_by_opid: ({ opid }: { opid: string }) => void;\n};\n\nexport default class AutofillScript {\n  script: FillScript[] = [];\n  properties: AutofillScriptProperties = {};\n  metadata: any = {}; // Unused, not written or read\n  autosubmit: any = null; // Appears to be unused, read but not written\n  savedUrls: string[];\n  untrustedIframe: boolean;\n  itemType: string; // Appears to be unused, read but not written\n}\n","export class AutoFillConstants {\n  static readonly UsernameFieldNames: string[] = [\n    // English\n    \"username\",\n    \"user name\",\n    \"email\",\n    \"email address\",\n    \"e-mail\",\n    \"e-mail address\",\n    \"userid\",\n    \"user id\",\n    \"customer id\",\n    \"login id\",\n    \"login\",\n    // German\n    \"benutzername\",\n    \"benutzer name\",\n    \"email adresse\",\n    \"e-mail adresse\",\n    \"benutzerid\",\n    \"benutzer id\",\n  ];\n\n  static readonly TotpFieldNames: string[] = [\n    \"totp\",\n    \"2fa\",\n    \"mfa\",\n    \"totpcode\",\n    \"2facode\",\n    \"approvals_code\",\n    \"code\",\n    \"mfacode\",\n    \"otc\",\n    \"otc-code\",\n    \"otp-code\",\n    \"otpcode\",\n    \"pin\",\n    \"security_code\",\n    \"twofactor\",\n    \"twofa\",\n    \"twofactorcode\",\n    \"verificationCode\",\n  ];\n\n  static readonly SearchFieldNames: string[] = [\"search\", \"query\", \"find\", \"go\"];\n\n  static readonly FieldIgnoreList: string[] = [\"captcha\", \"findanything\", \"forgot\"];\n\n  static readonly PasswordFieldExcludeList: string[] = [\n    ...AutoFillConstants.FieldIgnoreList,\n    \"onetimepassword\",\n  ];\n\n  static readonly ExcludedAutofillLoginTypes: string[] = [\n    \"hidden\",\n    \"file\",\n    \"button\",\n    \"image\",\n    \"reset\",\n    \"search\",\n  ];\n\n  static readonly ExcludedAutofillTypes: string[] = [\n    \"radio\",\n    \"checkbox\",\n    ...AutoFillConstants.ExcludedAutofillLoginTypes,\n  ];\n\n  static readonly ExcludedOverlayTypes: string[] = [\n    \"textarea\",\n    ...AutoFillConstants.ExcludedAutofillTypes,\n  ];\n}\n\nexport class CreditCardAutoFillConstants {\n  static readonly CardAttributes: string[] = [\n    \"autoCompleteType\",\n    \"data-stripe\",\n    \"htmlName\",\n    \"htmlID\",\n    \"label-tag\",\n    \"placeholder\",\n    \"label-left\",\n    \"label-top\",\n    \"data-recurly\",\n  ];\n\n  static readonly CardAttributesExtended: string[] = [\n    ...CreditCardAutoFillConstants.CardAttributes,\n    \"label-right\",\n  ];\n\n  static readonly CardHolderFieldNames: string[] = [\n    \"cc-name\",\n    \"card-name\",\n    \"cardholder-name\",\n    \"cardholder\",\n    \"name\",\n    \"nom\",\n  ];\n\n  static readonly CardHolderFieldNameValues: string[] = [\n    \"cc-name\",\n    \"card-name\",\n    \"cardholder-name\",\n    \"cardholder\",\n    \"tbName\",\n  ];\n\n  static readonly CardNumberFieldNames: string[] = [\n    \"cc-number\",\n    \"cc-num\",\n    \"card-number\",\n    \"card-num\",\n    \"number\",\n    \"cc\",\n    \"cc-no\",\n    \"card-no\",\n    \"credit-card\",\n    \"numero-carte\",\n    \"carte\",\n    \"carte-credit\",\n    \"num-carte\",\n    \"cb-num\",\n    \"card-pan\",\n  ];\n\n  static readonly CardNumberFieldNameValues: string[] = [\n    \"cc-number\",\n    \"cc-num\",\n    \"card-number\",\n    \"card-num\",\n    \"cc-no\",\n    \"card-no\",\n    \"numero-carte\",\n    \"num-carte\",\n    \"cb-num\",\n  ];\n\n  static readonly CardExpiryFieldNames: string[] = [\n    \"cc-exp\",\n    \"card-exp\",\n    \"cc-expiration\",\n    \"card-expiration\",\n    \"cc-ex\",\n    \"card-ex\",\n    \"card-expire\",\n    \"card-expiry\",\n    \"validite\",\n    \"expiration\",\n    \"expiry\",\n    \"mm-yy\",\n    \"mm-yyyy\",\n    \"yy-mm\",\n    \"yyyy-mm\",\n    \"expiration-date\",\n    \"payment-card-expiration\",\n    \"payment-cc-date\",\n  ];\n\n  static readonly CardExpiryFieldNameValues: string[] = [\n    \"mm-yy\",\n    \"mm-yyyy\",\n    \"yy-mm\",\n    \"yyyy-mm\",\n    \"expiration-date\",\n    \"payment-card-expiration\",\n  ];\n\n  static readonly ExpiryMonthFieldNames: string[] = [\n    \"exp-month\",\n    \"cc-exp-month\",\n    \"cc-month\",\n    \"card-month\",\n    \"cc-mo\",\n    \"card-mo\",\n    \"exp-mo\",\n    \"card-exp-mo\",\n    \"cc-exp-mo\",\n    \"card-expiration-month\",\n    \"expiration-month\",\n    \"cc-mm\",\n    \"cc-m\",\n    \"card-mm\",\n    \"card-m\",\n    \"card-exp-mm\",\n    \"cc-exp-mm\",\n    \"exp-mm\",\n    \"exp-m\",\n    \"expire-month\",\n    \"expire-mo\",\n    \"expiry-month\",\n    \"expiry-mo\",\n    \"card-expire-month\",\n    \"card-expire-mo\",\n    \"card-expiry-month\",\n    \"card-expiry-mo\",\n    \"mois-validite\",\n    \"mois-expiration\",\n    \"m-validite\",\n    \"m-expiration\",\n    \"expiry-date-field-month\",\n    \"expiration-date-month\",\n    \"expiration-date-mm\",\n    \"exp-mon\",\n    \"validity-mo\",\n    \"exp-date-mo\",\n    \"cb-date-mois\",\n    \"date-m\",\n  ];\n\n  static readonly ExpiryYearFieldNames: string[] = [\n    \"exp-year\",\n    \"cc-exp-year\",\n    \"cc-year\",\n    \"card-year\",\n    \"cc-yr\",\n    \"card-yr\",\n    \"exp-yr\",\n    \"card-exp-yr\",\n    \"cc-exp-yr\",\n    \"card-expiration-year\",\n    \"expiration-year\",\n    \"cc-yy\",\n    \"cc-y\",\n    \"card-yy\",\n    \"card-y\",\n    \"card-exp-yy\",\n    \"cc-exp-yy\",\n    \"exp-yy\",\n    \"exp-y\",\n    \"cc-yyyy\",\n    \"card-yyyy\",\n    \"card-exp-yyyy\",\n    \"cc-exp-yyyy\",\n    \"expire-year\",\n    \"expire-yr\",\n    \"expiry-year\",\n    \"expiry-yr\",\n    \"card-expire-year\",\n    \"card-expire-yr\",\n    \"card-expiry-year\",\n    \"card-expiry-yr\",\n    \"an-validite\",\n    \"an-expiration\",\n    \"annee-validite\",\n    \"annee-expiration\",\n    \"expiry-date-field-year\",\n    \"expiration-date-year\",\n    \"cb-date-ann\",\n    \"expiration-date-yy\",\n    \"expiration-date-yyyy\",\n    \"validity-year\",\n    \"exp-date-year\",\n    \"date-y\",\n  ];\n\n  static readonly CVVFieldNames: string[] = [\n    \"cvv\",\n    \"cvc\",\n    \"cvv2\",\n    \"cc-csc\",\n    \"cc-cvv\",\n    \"card-csc\",\n    \"card-cvv\",\n    \"cvd\",\n    \"cid\",\n    \"cvc2\",\n    \"cnv\",\n    \"cvn2\",\n    \"cc-code\",\n    \"card-code\",\n    \"code-securite\",\n    \"security-code\",\n    \"crypto\",\n    \"card-verif\",\n    \"verification-code\",\n    \"csc\",\n    \"ccv\",\n  ];\n\n  static readonly CardBrandFieldNames: string[] = [\n    \"cc-type\",\n    \"card-type\",\n    \"card-brand\",\n    \"cc-brand\",\n    \"cb-type\",\n  ];\n\n  // Each index represents a language. These three arrays should all be the same length.\n  // 0: English, 1: Danish, 2: German/Dutch, 3: French/Spanish/Italian, 4: Russian, 5: Portuguese\n  static readonly MonthAbbr = [\"mm\", \"mm\", \"mm\", \"mm\", \"мм\", \"mm\"];\n  static readonly YearAbbrShort = [\"yy\", \"åå\", \"jj\", \"aa\", \"гг\", \"rr\"];\n  static readonly YearAbbrLong = [\"yyyy\", \"åååå\", \"jjjj\", \"aa\", \"гггг\", \"rrrr\"];\n}\n\nexport class IdentityAutoFillConstants {\n  static readonly IdentityAttributes: string[] = [\n    \"autoCompleteType\",\n    \"data-stripe\",\n    \"htmlName\",\n    \"htmlID\",\n    \"label-tag\",\n    \"placeholder\",\n    \"label-left\",\n    \"label-top\",\n    \"data-recurly\",\n  ];\n\n  static readonly FullNameFieldNames: string[] = [\"name\", \"full-name\", \"your-name\"];\n\n  static readonly FullNameFieldNameValues: string[] = [\"full-name\", \"your-name\"];\n\n  static readonly TitleFieldNames: string[] = [\n    \"honorific-prefix\",\n    \"prefix\",\n    \"title\",\n    // German\n    \"anrede\",\n  ];\n\n  static readonly FirstnameFieldNames: string[] = [\n    // English\n    \"f-name\",\n    \"first-name\",\n    \"given-name\",\n    \"first-n\",\n    // German\n    \"vorname\",\n  ];\n\n  static readonly MiddlenameFieldNames: string[] = [\n    \"m-name\",\n    \"middle-name\",\n    \"additional-name\",\n    \"middle-initial\",\n    \"middle-n\",\n    \"middle-i\",\n  ];\n\n  static readonly LastnameFieldNames: string[] = [\n    // English\n    \"l-name\",\n    \"last-name\",\n    \"s-name\",\n    \"surname\",\n    \"family-name\",\n    \"family-n\",\n    \"last-n\",\n    // German\n    \"nachname\",\n    \"familienname\",\n  ];\n\n  static readonly EmailFieldNames: string[] = [\"e-mail\", \"email-address\"];\n\n  static readonly AddressFieldNames: string[] = [\n    \"address\",\n    \"street-address\",\n    \"addr\",\n    \"street\",\n    \"mailing-addr\",\n    \"billing-addr\",\n    \"mail-addr\",\n    \"bill-addr\",\n    // German\n    \"strasse\",\n    \"adresse\",\n  ];\n\n  static readonly AddressFieldNameValues: string[] = [\n    \"mailing-addr\",\n    \"billing-addr\",\n    \"mail-addr\",\n    \"bill-addr\",\n  ];\n\n  static readonly Address1FieldNames: string[] = [\n    \"address-1\",\n    \"address-line-1\",\n    \"addr-1\",\n    \"street-1\",\n  ];\n\n  static readonly Address2FieldNames: string[] = [\n    \"address-2\",\n    \"address-line-2\",\n    \"addr-2\",\n    \"street-2\",\n  ];\n\n  static readonly Address3FieldNames: string[] = [\n    \"address-3\",\n    \"address-line-3\",\n    \"addr-3\",\n    \"street-3\",\n  ];\n\n  static readonly PostalCodeFieldNames: string[] = [\n    \"postal\",\n    \"zip\",\n    \"zip2\",\n    \"zip-code\",\n    \"postal-code\",\n    \"post-code\",\n    \"address-zip\",\n    \"address-postal\",\n    \"address-code\",\n    \"address-postal-code\",\n    \"address-zip-code\",\n    // German\n    \"plz\",\n    \"postleitzahl\",\n  ];\n\n  static readonly CityFieldNames: string[] = [\n    \"city\",\n    \"town\",\n    \"address-level-2\",\n    \"address-city\",\n    \"address-town\",\n    // German\n    \"ort\",\n    \"stadt\",\n    \"wohnort\",\n  ];\n\n  static readonly StateFieldNames: string[] = [\n    \"state\",\n    \"province\",\n    \"provence\",\n    \"address-level-1\",\n    \"address-state\",\n    \"address-province\",\n    // German\n    \"bundesland\",\n  ];\n\n  static readonly CountryFieldNames: string[] = [\n    \"country\",\n    \"country-code\",\n    \"country-name\",\n    \"address-country\",\n    \"address-country-name\",\n    \"address-country-code\",\n    // German\n    \"land\",\n  ];\n\n  static readonly PhoneFieldNames: string[] = [\n    \"phone\",\n    \"mobile\",\n    \"mobile-phone\",\n    \"tel\",\n    \"telephone\",\n    \"phone-number\",\n    // German\n    \"telefon\",\n    \"telefonnummer\",\n    \"mobil\",\n    \"handy\",\n  ];\n\n  static readonly UserNameFieldNames: string[] = [\"user-name\", \"user-id\", \"screen-name\"];\n\n  static readonly CompanyFieldNames: string[] = [\n    \"company\",\n    \"company-name\",\n    \"organization\",\n    \"organization-name\",\n    // German\n    \"firma\",\n  ];\n\n  static readonly IsoCountries: { [id: string]: string } = {\n    afghanistan: \"AF\",\n    \"aland islands\": \"AX\",\n    albania: \"AL\",\n    algeria: \"DZ\",\n    \"american samoa\": \"AS\",\n    andorra: \"AD\",\n    angola: \"AO\",\n    anguilla: \"AI\",\n    antarctica: \"AQ\",\n    \"antigua and barbuda\": \"AG\",\n    argentina: \"AR\",\n    armenia: \"AM\",\n    aruba: \"AW\",\n    australia: \"AU\",\n    austria: \"AT\",\n    azerbaijan: \"AZ\",\n    bahamas: \"BS\",\n    bahrain: \"BH\",\n    bangladesh: \"BD\",\n    barbados: \"BB\",\n    belarus: \"BY\",\n    belgium: \"BE\",\n    belize: \"BZ\",\n    benin: \"BJ\",\n    bermuda: \"BM\",\n    bhutan: \"BT\",\n    bolivia: \"BO\",\n    \"bosnia and herzegovina\": \"BA\",\n    botswana: \"BW\",\n    \"bouvet island\": \"BV\",\n    brazil: \"BR\",\n    \"british indian ocean territory\": \"IO\",\n    \"brunei darussalam\": \"BN\",\n    bulgaria: \"BG\",\n    \"burkina faso\": \"BF\",\n    burundi: \"BI\",\n    cambodia: \"KH\",\n    cameroon: \"CM\",\n    canada: \"CA\",\n    \"cape verde\": \"CV\",\n    \"cayman islands\": \"KY\",\n    \"central african republic\": \"CF\",\n    chad: \"TD\",\n    chile: \"CL\",\n    china: \"CN\",\n    \"christmas island\": \"CX\",\n    \"cocos (keeling) islands\": \"CC\",\n    colombia: \"CO\",\n    comoros: \"KM\",\n    congo: \"CG\",\n    \"congo, democratic republic\": \"CD\",\n    \"cook islands\": \"CK\",\n    \"costa rica\": \"CR\",\n    \"cote d'ivoire\": \"CI\",\n    croatia: \"HR\",\n    cuba: \"CU\",\n    cyprus: \"CY\",\n    \"czech republic\": \"CZ\",\n    denmark: \"DK\",\n    djibouti: \"DJ\",\n    dominica: \"DM\",\n    \"dominican republic\": \"DO\",\n    ecuador: \"EC\",\n    egypt: \"EG\",\n    \"el salvador\": \"SV\",\n    \"equatorial guinea\": \"GQ\",\n    eritrea: \"ER\",\n    estonia: \"EE\",\n    ethiopia: \"ET\",\n    \"falkland islands\": \"FK\",\n    \"faroe islands\": \"FO\",\n    fiji: \"FJ\",\n    finland: \"FI\",\n    france: \"FR\",\n    \"french guiana\": \"GF\",\n    \"french polynesia\": \"PF\",\n    \"french southern territories\": \"TF\",\n    gabon: \"GA\",\n    gambia: \"GM\",\n    georgia: \"GE\",\n    germany: \"DE\",\n    ghana: \"GH\",\n    gibraltar: \"GI\",\n    greece: \"GR\",\n    greenland: \"GL\",\n    grenada: \"GD\",\n    guadeloupe: \"GP\",\n    guam: \"GU\",\n    guatemala: \"GT\",\n    guernsey: \"GG\",\n    guinea: \"GN\",\n    \"guinea-bissau\": \"GW\",\n    guyana: \"GY\",\n    haiti: \"HT\",\n    \"heard island & mcdonald islands\": \"HM\",\n    \"holy see (vatican city state)\": \"VA\",\n    honduras: \"HN\",\n    \"hong kong\": \"HK\",\n    hungary: \"HU\",\n    iceland: \"IS\",\n    india: \"IN\",\n    indonesia: \"ID\",\n    \"iran, islamic republic of\": \"IR\",\n    iraq: \"IQ\",\n    ireland: \"IE\",\n    \"isle of man\": \"IM\",\n    israel: \"IL\",\n    italy: \"IT\",\n    jamaica: \"JM\",\n    japan: \"JP\",\n    jersey: \"JE\",\n    jordan: \"JO\",\n    kazakhstan: \"KZ\",\n    kenya: \"KE\",\n    kiribati: \"KI\",\n    \"republic of korea\": \"KR\",\n    \"south korea\": \"KR\",\n    \"democratic people's republic of korea\": \"KP\",\n    \"north korea\": \"KP\",\n    kuwait: \"KW\",\n    kyrgyzstan: \"KG\",\n    \"lao people's democratic republic\": \"LA\",\n    latvia: \"LV\",\n    lebanon: \"LB\",\n    lesotho: \"LS\",\n    liberia: \"LR\",\n    \"libyan arab jamahiriya\": \"LY\",\n    liechtenstein: \"LI\",\n    lithuania: \"LT\",\n    luxembourg: \"LU\",\n    macao: \"MO\",\n    macedonia: \"MK\",\n    madagascar: \"MG\",\n    malawi: \"MW\",\n    malaysia: \"MY\",\n    maldives: \"MV\",\n    mali: \"ML\",\n    malta: \"MT\",\n    \"marshall islands\": \"MH\",\n    martinique: \"MQ\",\n    mauritania: \"MR\",\n    mauritius: \"MU\",\n    mayotte: \"YT\",\n    mexico: \"MX\",\n    \"micronesia, federated states of\": \"FM\",\n    moldova: \"MD\",\n    monaco: \"MC\",\n    mongolia: \"MN\",\n    montenegro: \"ME\",\n    montserrat: \"MS\",\n    morocco: \"MA\",\n    mozambique: \"MZ\",\n    myanmar: \"MM\",\n    namibia: \"NA\",\n    nauru: \"NR\",\n    nepal: \"NP\",\n    netherlands: \"NL\",\n    \"netherlands antilles\": \"AN\",\n    \"new caledonia\": \"NC\",\n    \"new zealand\": \"NZ\",\n    nicaragua: \"NI\",\n    niger: \"NE\",\n    nigeria: \"NG\",\n    niue: \"NU\",\n    \"norfolk island\": \"NF\",\n    \"northern mariana islands\": \"MP\",\n    norway: \"NO\",\n    oman: \"OM\",\n    pakistan: \"PK\",\n    palau: \"PW\",\n    \"palestinian territory, occupied\": \"PS\",\n    panama: \"PA\",\n    \"papua new guinea\": \"PG\",\n    paraguay: \"PY\",\n    peru: \"PE\",\n    philippines: \"PH\",\n    pitcairn: \"PN\",\n    poland: \"PL\",\n    portugal: \"PT\",\n    \"puerto rico\": \"PR\",\n    qatar: \"QA\",\n    reunion: \"RE\",\n    romania: \"RO\",\n    \"russian federation\": \"RU\",\n    rwanda: \"RW\",\n    \"saint barthelemy\": \"BL\",\n    \"saint helena\": \"SH\",\n    \"saint kitts and nevis\": \"KN\",\n    \"saint lucia\": \"LC\",\n    \"saint martin\": \"MF\",\n    \"saint pierre and miquelon\": \"PM\",\n    \"saint vincent and grenadines\": \"VC\",\n    samoa: \"WS\",\n    \"san marino\": \"SM\",\n    \"sao tome and principe\": \"ST\",\n    \"saudi arabia\": \"SA\",\n    senegal: \"SN\",\n    serbia: \"RS\",\n    seychelles: \"SC\",\n    \"sierra leone\": \"SL\",\n    singapore: \"SG\",\n    slovakia: \"SK\",\n    slovenia: \"SI\",\n    \"solomon islands\": \"SB\",\n    somalia: \"SO\",\n    \"south africa\": \"ZA\",\n    \"south georgia and sandwich isl.\": \"GS\",\n    spain: \"ES\",\n    \"sri lanka\": \"LK\",\n    sudan: \"SD\",\n    suriname: \"SR\",\n    \"svalbard and jan mayen\": \"SJ\",\n    swaziland: \"SZ\",\n    sweden: \"SE\",\n    switzerland: \"CH\",\n    \"syrian arab republic\": \"SY\",\n    taiwan: \"TW\",\n    tajikistan: \"TJ\",\n    tanzania: \"TZ\",\n    thailand: \"TH\",\n    \"timor-leste\": \"TL\",\n    togo: \"TG\",\n    tokelau: \"TK\",\n    tonga: \"TO\",\n    \"trinidad and tobago\": \"TT\",\n    tunisia: \"TN\",\n    turkey: \"TR\",\n    turkmenistan: \"TM\",\n    \"turks and caicos islands\": \"TC\",\n    tuvalu: \"TV\",\n    uganda: \"UG\",\n    ukraine: \"UA\",\n    \"united arab emirates\": \"AE\",\n    \"united kingdom\": \"GB\",\n    \"united states\": \"US\",\n    \"united states outlying islands\": \"UM\",\n    uruguay: \"UY\",\n    uzbekistan: \"UZ\",\n    vanuatu: \"VU\",\n    venezuela: \"VE\",\n    vietnam: \"VN\",\n    \"virgin islands, british\": \"VG\",\n    \"virgin islands, u.s.\": \"VI\",\n    \"wallis and futuna\": \"WF\",\n    \"western sahara\": \"EH\",\n    yemen: \"YE\",\n    zambia: \"ZM\",\n    zimbabwe: \"ZW\",\n  };\n\n  static readonly IsoStates: { [id: string]: string } = {\n    alabama: \"AL\",\n    alaska: \"AK\",\n    \"american samoa\": \"AS\",\n    arizona: \"AZ\",\n    arkansas: \"AR\",\n    california: \"CA\",\n    colorado: \"CO\",\n    connecticut: \"CT\",\n    delaware: \"DE\",\n    \"district of columbia\": \"DC\",\n    \"federated states of micronesia\": \"FM\",\n    florida: \"FL\",\n    georgia: \"GA\",\n    guam: \"GU\",\n    hawaii: \"HI\",\n    idaho: \"ID\",\n    illinois: \"IL\",\n    indiana: \"IN\",\n    iowa: \"IA\",\n    kansas: \"KS\",\n    kentucky: \"KY\",\n    louisiana: \"LA\",\n    maine: \"ME\",\n    \"marshall islands\": \"MH\",\n    maryland: \"MD\",\n    massachusetts: \"MA\",\n    michigan: \"MI\",\n    minnesota: \"MN\",\n    mississippi: \"MS\",\n    missouri: \"MO\",\n    montana: \"MT\",\n    nebraska: \"NE\",\n    nevada: \"NV\",\n    \"new hampshire\": \"NH\",\n    \"new jersey\": \"NJ\",\n    \"new mexico\": \"NM\",\n    \"new york\": \"NY\",\n    \"north carolina\": \"NC\",\n    \"north dakota\": \"ND\",\n    \"northern mariana islands\": \"MP\",\n    ohio: \"OH\",\n    oklahoma: \"OK\",\n    oregon: \"OR\",\n    palau: \"PW\",\n    pennsylvania: \"PA\",\n    \"puerto rico\": \"PR\",\n    \"rhode island\": \"RI\",\n    \"south carolina\": \"SC\",\n    \"south dakota\": \"SD\",\n    tennessee: \"TN\",\n    texas: \"TX\",\n    utah: \"UT\",\n    vermont: \"VT\",\n    \"virgin islands\": \"VI\",\n    virginia: \"VA\",\n    washington: \"WA\",\n    \"west virginia\": \"WV\",\n    wisconsin: \"WI\",\n    wyoming: \"WY\",\n  };\n\n  static readonly IsoProvinces: { [id: string]: string } = {\n    alberta: \"AB\",\n    \"british columbia\": \"BC\",\n    manitoba: \"MB\",\n    \"new brunswick\": \"NB\",\n    \"newfoundland and labrador\": \"NL\",\n    \"nova scotia\": \"NS\",\n    ontario: \"ON\",\n    \"prince edward island\": \"PE\",\n    quebec: \"QC\",\n    saskatchewan: \"SK\",\n  };\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { EventCollectionService } from \"@bitwarden/common/abstractions/event/event-collection.service\";\nimport { SettingsService } from \"@bitwarden/common/abstractions/settings.service\";\nimport { UserVerificationService } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification.service.abstraction\";\nimport { AutofillSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport { EventType } from \"@bitwarden/common/enums\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { TotpService } from \"@bitwarden/common/vault/abstractions/totp.service\";\nimport { FieldType, UriMatchType, CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRepromptType } from \"@bitwarden/common/vault/enums/cipher-reprompt-type\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { FieldView } from \"@bitwarden/common/vault/models/view/field.view\";\n\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { BrowserStateService } from \"../../platform/services/abstractions/browser-state.service\";\nimport { openVaultItemPasswordRepromptPopout } from \"../../vault/popup/utils/vault-popout-window\";\nimport { AutofillPort } from \"../enums/autofill-port.enums\";\nimport AutofillField from \"../models/autofill-field\";\nimport AutofillPageDetails from \"../models/autofill-page-details\";\nimport AutofillScript from \"../models/autofill-script\";\nimport { InlineMenuVisibilitySetting } from \"../utils/autofill-overlay.enum\";\n\nimport {\n  AutoFillOptions,\n  AutofillService as AutofillServiceInterface,\n  FormData,\n  GenerateFillScriptOptions,\n  PageDetail,\n} from \"./abstractions/autofill.service\";\nimport {\n  AutoFillConstants,\n  CreditCardAutoFillConstants,\n  IdentityAutoFillConstants,\n} from \"./autofill-constants\";\n\nexport default class AutofillService implements AutofillServiceInterface {\n  private openVaultItemPasswordRepromptPopout = openVaultItemPasswordRepromptPopout;\n  private openPasswordRepromptPopoutDebounce: NodeJS.Timeout;\n  private currentlyOpeningPasswordRepromptPopout = false;\n  private autofillScriptPortsSet = new Set<chrome.runtime.Port>();\n\n  constructor(\n    private cipherService: CipherService,\n    private stateService: BrowserStateService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private totpService: TotpService,\n    private eventCollectionService: EventCollectionService,\n    private logService: LogService,\n    private settingsService: SettingsService,\n    private userVerificationService: UserVerificationService,\n  ) {}\n\n  /**\n   * Triggers on installation of the extension Handles injecting\n   * content scripts into all tabs that are currently open, and\n   * sets up a listener to ensure content scripts can identify\n   * if the extension context has been disconnected.\n   */\n  async loadAutofillScriptsOnInstall() {\n    BrowserApi.addListener(chrome.runtime.onConnect, this.handleInjectedScriptPortConnection);\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.injectAutofillScriptsInAllTabs();\n  }\n\n  /**\n   * Triggers a complete reload of all autofill scripts on tabs open within\n   * the user's browsing session. This is done by first disconnecting all\n   * existing autofill content script ports, which cleans up existing object\n   * instances, and then re-injecting the autofill scripts into all tabs.\n   */\n  async reloadAutofillScripts() {\n    this.autofillScriptPortsSet.forEach((port) => {\n      port.disconnect();\n      this.autofillScriptPortsSet.delete(port);\n    });\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.injectAutofillScriptsInAllTabs();\n  }\n\n  /**\n   * Injects the autofill scripts into the current tab and all frames\n   * found within the tab. Temporarily, will conditionally inject\n   * the refactor of the core autofill script if the feature flag\n   * is enabled.\n   * @param {chrome.tabs.Tab} tab\n   * @param {number} frameId\n   * @param {boolean} triggeringOnPageLoad\n   */\n  async injectAutofillScripts(\n    tab: chrome.tabs.Tab,\n    frameId = 0,\n    triggeringOnPageLoad = true,\n  ): Promise<void> {\n    const mainAutofillScript = (await this.getOverlayVisibility())\n      ? \"bootstrap-autofill-overlay.js\"\n      : \"bootstrap-autofill.js\";\n\n    const injectedScripts = [mainAutofillScript];\n\n    const autoFillOnPageLoadIsEnabled = await this.getAutofillOnPageLoad();\n\n    if (triggeringOnPageLoad && autoFillOnPageLoadIsEnabled) {\n      injectedScripts.push(\"autofiller.js\");\n    } else {\n      await BrowserApi.executeScriptInTab(tab.id, {\n        file: \"content/content-message-handler.js\",\n        runAt: \"document_start\",\n      });\n    }\n\n    injectedScripts.push(\"notificationBar.js\", \"contextMenuHandler.js\");\n\n    for (const injectedScript of injectedScripts) {\n      await BrowserApi.executeScriptInTab(tab.id, {\n        file: `content/${injectedScript}`,\n        frameId,\n        runAt: \"document_start\",\n      });\n    }\n  }\n\n  /**\n   * Gets all forms with password fields and formats the data\n   * for both forms and password input elements.\n   * @param {AutofillPageDetails} pageDetails\n   * @returns {FormData[]}\n   */\n  getFormsWithPasswordFields(pageDetails: AutofillPageDetails): FormData[] {\n    const formData: FormData[] = [];\n\n    const passwordFields = AutofillService.loadPasswordFields(pageDetails, true, true, false, true);\n\n    // TODO: this logic prevents multi-step account creation forms (that just start with email)\n    // from being passed on to the notification bar content script - even if autofill-init.js found the form and email field.\n    // ex: https://signup.live.com/\n    if (passwordFields.length === 0) {\n      return formData;\n    }\n\n    // Back up check for cases where there are several password fields detected,\n    // but they are not all part of the form b/c of bad HTML\n\n    // gather password fields that don't have an enclosing form\n    const passwordFieldsWithoutForm = passwordFields.filter((pf) => pf.form === undefined);\n    const formKeys = Object.keys(pageDetails.forms);\n    const formCount = formKeys.length;\n\n    // if we have 3 password fields and only 1 form, and there are password fields that are not within a form\n    // but there is at least one password field within the form, then most likely this is a poorly built password change form\n    if (passwordFields.length === 3 && formCount == 1 && passwordFieldsWithoutForm.length > 0) {\n      // Only one form so get the singular form key\n      const soloFormKey = formKeys[0];\n\n      const atLeastOnePasswordFieldWithinSoloForm =\n        passwordFields.filter((pf) => pf.form !== null && pf.form === soloFormKey).length > 0;\n\n      if (atLeastOnePasswordFieldWithinSoloForm) {\n        // We have a form with at least one password field,\n        // so let's make an assumption that the password fields without a form are actually part of this form\n        passwordFieldsWithoutForm.forEach((pf) => {\n          pf.form = soloFormKey;\n        });\n      }\n    }\n\n    for (const formKey in pageDetails.forms) {\n      // eslint-disable-next-line\n      if (!pageDetails.forms.hasOwnProperty(formKey)) {\n        continue;\n      }\n\n      const formPasswordFields = passwordFields.filter((pf) => formKey === pf.form);\n      if (formPasswordFields.length > 0) {\n        let uf = this.findUsernameField(pageDetails, formPasswordFields[0], false, false, false);\n        if (uf == null) {\n          // not able to find any viewable username fields. maybe there are some \"hidden\" ones?\n          uf = this.findUsernameField(pageDetails, formPasswordFields[0], true, true, false);\n        }\n        formData.push({\n          form: pageDetails.forms[formKey],\n          password: formPasswordFields[0],\n          username: uf,\n          passwords: formPasswordFields,\n        });\n      }\n    }\n\n    return formData;\n  }\n\n  /**\n   * Gets the overlay's visibility setting from the autofill settings service.\n   */\n  async getOverlayVisibility(): Promise<InlineMenuVisibilitySetting> {\n    return await firstValueFrom(this.autofillSettingsService.inlineMenuVisibility$);\n  }\n\n  /**\n   * Gets the setting for automatically copying TOTP upon autofill from the autofill settings service.\n   */\n  async getShouldAutoCopyTotp(): Promise<boolean> {\n    return await firstValueFrom(this.autofillSettingsService.autoCopyTotp$);\n  }\n\n  /**\n   * Gets the autofill on page load setting from the autofill settings service.\n   */\n  async getAutofillOnPageLoad(): Promise<boolean> {\n    return await firstValueFrom(this.autofillSettingsService.autofillOnPageLoad$);\n  }\n\n  /**\n   * Autofill a given tab with a given login item\n   * @param {AutoFillOptions} options Instructions about the autofill operation, including tab and login item\n   * @returns {Promise<string | null>} The TOTP code of the successfully autofilled login, if any\n   */\n  async doAutoFill(options: AutoFillOptions): Promise<string | null> {\n    const tab = options.tab;\n    if (!tab || !options.cipher || !options.pageDetails || !options.pageDetails.length) {\n      throw new Error(\"Nothing to auto-fill.\");\n    }\n\n    let totp: string | null = null;\n\n    const canAccessPremium = await this.stateService.getCanAccessPremium();\n    const defaultUriMatch = (await this.stateService.getDefaultUriMatch()) ?? UriMatchType.Domain;\n\n    if (!canAccessPremium) {\n      options.cipher.login.totp = null;\n    }\n\n    let didAutofill = false;\n    await Promise.all(\n      options.pageDetails.map(async (pd) => {\n        // make sure we're still on correct tab\n        if (pd.tab.id !== tab.id || pd.tab.url !== tab.url) {\n          return;\n        }\n\n        const fillScript = await this.generateFillScript(pd.details, {\n          skipUsernameOnlyFill: options.skipUsernameOnlyFill || false,\n          onlyEmptyFields: options.onlyEmptyFields || false,\n          onlyVisibleFields: options.onlyVisibleFields || false,\n          fillNewPassword: options.fillNewPassword || false,\n          allowTotpAutofill: options.allowTotpAutofill || false,\n          cipher: options.cipher,\n          tabUrl: tab.url,\n          defaultUriMatch: defaultUriMatch,\n        });\n\n        if (!fillScript || !fillScript.script || !fillScript.script.length) {\n          return;\n        }\n\n        if (\n          fillScript.untrustedIframe &&\n          options.allowUntrustedIframe != undefined &&\n          !options.allowUntrustedIframe\n        ) {\n          this.logService.info(\"Auto-fill on page load was blocked due to an untrusted iframe.\");\n          return;\n        }\n\n        // Add a small delay between operations\n        fillScript.properties.delay_between_operations = 20;\n\n        didAutofill = true;\n        if (!options.skipLastUsed) {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.cipherService.updateLastUsedDate(options.cipher.id);\n        }\n\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        BrowserApi.tabSendMessage(\n          tab,\n          {\n            command: \"fillForm\",\n            fillScript: fillScript,\n            url: tab.url,\n            pageDetailsUrl: pd.details.url,\n          },\n          { frameId: pd.frameId },\n        );\n\n        // Skip getting the TOTP code for clipboard in these cases\n        if (\n          options.cipher.type !== CipherType.Login ||\n          totp !== null ||\n          !options.cipher.login.totp ||\n          (!canAccessPremium && !options.cipher.organizationUseTotp)\n        ) {\n          return;\n        }\n\n        const shouldAutoCopyTotp = await this.getShouldAutoCopyTotp();\n\n        totp = shouldAutoCopyTotp\n          ? await this.totpService.getCode(options.cipher.login.totp)\n          : null;\n      }),\n    );\n\n    if (didAutofill) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.eventCollectionService.collect(EventType.Cipher_ClientAutofilled, options.cipher.id);\n      if (totp !== null) {\n        return totp;\n      } else {\n        return null;\n      }\n    } else {\n      throw new Error(\"Did not auto-fill.\");\n    }\n  }\n\n  /**\n   * Autofill the specified tab with the next login item from the cache\n   * @param {PageDetail[]} pageDetails The data scraped from the page\n   * @param {chrome.tabs.Tab} tab The tab to be autofilled\n   * @param {boolean} fromCommand Whether the autofill is triggered by a keyboard shortcut (`true`) or autofill on page load (`false`)\n   * @returns {Promise<string | null>} The TOTP code of the successfully autofilled login, if any\n   */\n  async doAutoFillOnTab(\n    pageDetails: PageDetail[],\n    tab: chrome.tabs.Tab,\n    fromCommand: boolean,\n  ): Promise<string | null> {\n    let cipher: CipherView;\n    if (fromCommand) {\n      cipher = await this.cipherService.getNextCipherForUrl(tab.url);\n    } else {\n      const lastLaunchedCipher = await this.cipherService.getLastLaunchedForUrl(tab.url, true);\n      if (\n        lastLaunchedCipher &&\n        Date.now().valueOf() - lastLaunchedCipher.localData?.lastLaunched?.valueOf() < 30000\n      ) {\n        cipher = lastLaunchedCipher;\n      } else {\n        cipher = await this.cipherService.getLastUsedForUrl(tab.url, true);\n      }\n    }\n\n    if (cipher == null || (cipher.reprompt === CipherRepromptType.Password && !fromCommand)) {\n      return null;\n    }\n\n    if (await this.isPasswordRepromptRequired(cipher, tab)) {\n      if (fromCommand) {\n        this.cipherService.updateLastUsedIndexForUrl(tab.url);\n      }\n\n      return null;\n    }\n\n    const totpCode = await this.doAutoFill({\n      tab: tab,\n      cipher: cipher,\n      pageDetails: pageDetails,\n      skipLastUsed: !fromCommand,\n      skipUsernameOnlyFill: !fromCommand,\n      onlyEmptyFields: !fromCommand,\n      onlyVisibleFields: !fromCommand,\n      fillNewPassword: fromCommand,\n      allowUntrustedIframe: fromCommand,\n      allowTotpAutofill: fromCommand,\n    });\n\n    // Update last used index as autofill has succeeded\n    if (fromCommand) {\n      this.cipherService.updateLastUsedIndexForUrl(tab.url);\n    }\n\n    return totpCode;\n  }\n\n  async isPasswordRepromptRequired(cipher: CipherView, tab: chrome.tabs.Tab): Promise<boolean> {\n    const userHasMasterPasswordAndKeyHash =\n      await this.userVerificationService.hasMasterPasswordAndMasterKeyHash();\n    if (cipher.reprompt === CipherRepromptType.Password && userHasMasterPasswordAndKeyHash) {\n      if (!this.isDebouncingPasswordRepromptPopout()) {\n        await this.openVaultItemPasswordRepromptPopout(tab, {\n          cipherId: cipher.id,\n          action: \"autofill\",\n        });\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Autofill the active tab with the next cipher from the cache\n   * @param {PageDetail[]} pageDetails The data scraped from the page\n   * @param {boolean} fromCommand Whether the autofill is triggered by a keyboard shortcut (`true`) or autofill on page load (`false`)\n   * @returns {Promise<string | null>} The TOTP code of the successfully autofilled login, if any\n   */\n  async doAutoFillActiveTab(\n    pageDetails: PageDetail[],\n    fromCommand: boolean,\n    cipherType?: CipherType,\n  ): Promise<string | null> {\n    if (!pageDetails[0]?.details?.fields?.length) {\n      return null;\n    }\n\n    const tab = await this.getActiveTab();\n\n    if (!tab || !tab.url) {\n      return null;\n    }\n\n    if (!cipherType || cipherType === CipherType.Login) {\n      return await this.doAutoFillOnTab(pageDetails, tab, fromCommand);\n    }\n\n    // Cipher is a non-login type\n    const cipher: CipherView = (\n      (await this.cipherService.getAllDecryptedForUrl(tab.url, [cipherType])) || []\n    ).find(({ type }) => type === cipherType);\n\n    if (!cipher || cipher.reprompt !== CipherRepromptType.None) {\n      return null;\n    }\n\n    return await this.doAutoFill({\n      tab: tab,\n      cipher: cipher,\n      pageDetails: pageDetails,\n      skipLastUsed: !fromCommand,\n      skipUsernameOnlyFill: !fromCommand,\n      onlyEmptyFields: !fromCommand,\n      onlyVisibleFields: !fromCommand,\n      fillNewPassword: false,\n      allowUntrustedIframe: fromCommand,\n      allowTotpAutofill: false,\n    });\n  }\n\n  /**\n   * Gets the active tab from the current window.\n   * Throws an error if no tab is found.\n   * @returns {Promise<chrome.tabs.Tab>}\n   * @private\n   */\n  private async getActiveTab(): Promise<chrome.tabs.Tab> {\n    const tab = await BrowserApi.getTabFromCurrentWindow();\n    if (!tab) {\n      throw new Error(\"No tab found.\");\n    }\n\n    return tab;\n  }\n\n  /**\n   * Generates the autofill script for the specified page details and cipher.\n   * @param {AutofillPageDetails} pageDetails\n   * @param {GenerateFillScriptOptions} options\n   * @returns {Promise<AutofillScript | null>}\n   * @private\n   */\n  private async generateFillScript(\n    pageDetails: AutofillPageDetails,\n    options: GenerateFillScriptOptions,\n  ): Promise<AutofillScript | null> {\n    if (!pageDetails || !options.cipher) {\n      return null;\n    }\n\n    let fillScript = new AutofillScript();\n    const filledFields: { [id: string]: AutofillField } = {};\n    const fields = options.cipher.fields;\n\n    if (fields && fields.length) {\n      const fieldNames: string[] = [];\n\n      fields.forEach((f) => {\n        if (AutofillService.hasValue(f.name)) {\n          fieldNames.push(f.name.toLowerCase());\n        }\n      });\n\n      pageDetails.fields.forEach((field) => {\n        // eslint-disable-next-line\n        if (filledFields.hasOwnProperty(field.opid)) {\n          return;\n        }\n\n        if (!field.viewable && field.tagName !== \"span\") {\n          return;\n        }\n\n        // Check if the input is an untyped/mistyped search input\n        if (AutofillService.isSearchField(field)) {\n          return;\n        }\n\n        const matchingIndex = this.findMatchingFieldIndex(field, fieldNames);\n        if (matchingIndex > -1) {\n          const matchingField: FieldView = fields[matchingIndex];\n          let val: string;\n          if (matchingField.type === FieldType.Linked) {\n            // Assumption: Linked Field is not being used to autofill a boolean value\n            val = options.cipher.linkedFieldValue(matchingField.linkedId) as string;\n          } else {\n            val = matchingField.value;\n            if (val == null && matchingField.type === FieldType.Boolean) {\n              val = \"false\";\n            }\n          }\n\n          filledFields[field.opid] = field;\n          AutofillService.fillByOpid(fillScript, field, val);\n        }\n      });\n    }\n\n    switch (options.cipher.type) {\n      case CipherType.Login:\n        fillScript = await this.generateLoginFillScript(\n          fillScript,\n          pageDetails,\n          filledFields,\n          options,\n        );\n        break;\n      case CipherType.Card:\n        fillScript = this.generateCardFillScript(fillScript, pageDetails, filledFields, options);\n        break;\n      case CipherType.Identity:\n        fillScript = this.generateIdentityFillScript(\n          fillScript,\n          pageDetails,\n          filledFields,\n          options,\n        );\n        break;\n      default:\n        return null;\n    }\n\n    return fillScript;\n  }\n\n  /**\n   * Generates the autofill script for the specified page details and login cipher item.\n   * @param {AutofillScript} fillScript\n   * @param {AutofillPageDetails} pageDetails\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {GenerateFillScriptOptions} options\n   * @returns {Promise<AutofillScript | null>}\n   * @private\n   */\n  private async generateLoginFillScript(\n    fillScript: AutofillScript,\n    pageDetails: AutofillPageDetails,\n    filledFields: { [id: string]: AutofillField },\n    options: GenerateFillScriptOptions,\n  ): Promise<AutofillScript | null> {\n    if (!options.cipher.login) {\n      return null;\n    }\n\n    const passwords: AutofillField[] = [];\n    const usernames: AutofillField[] = [];\n    const totps: AutofillField[] = [];\n    let pf: AutofillField = null;\n    let username: AutofillField = null;\n    let totp: AutofillField = null;\n    const login = options.cipher.login;\n    fillScript.savedUrls =\n      login?.uris?.filter((u) => u.match != UriMatchType.Never).map((u) => u.uri) ?? [];\n\n    fillScript.untrustedIframe = this.inUntrustedIframe(pageDetails.url, options);\n\n    let passwordFields = AutofillService.loadPasswordFields(\n      pageDetails,\n      false,\n      false,\n      options.onlyEmptyFields,\n      options.fillNewPassword,\n    );\n    if (!passwordFields.length && !options.onlyVisibleFields) {\n      // not able to find any viewable password fields. maybe there are some \"hidden\" ones?\n      passwordFields = AutofillService.loadPasswordFields(\n        pageDetails,\n        true,\n        true,\n        options.onlyEmptyFields,\n        options.fillNewPassword,\n      );\n    }\n\n    for (const formKey in pageDetails.forms) {\n      // eslint-disable-next-line\n      if (!pageDetails.forms.hasOwnProperty(formKey)) {\n        continue;\n      }\n\n      passwordFields.forEach((passField) => {\n        pf = passField;\n        passwords.push(pf);\n\n        if (login.username) {\n          username = this.findUsernameField(pageDetails, pf, false, false, false);\n\n          if (!username && !options.onlyVisibleFields) {\n            // not able to find any viewable username fields. maybe there are some \"hidden\" ones?\n            username = this.findUsernameField(pageDetails, pf, true, true, false);\n          }\n\n          if (username) {\n            usernames.push(username);\n          }\n        }\n\n        if (options.allowTotpAutofill && login.totp) {\n          totp = this.findTotpField(pageDetails, pf, false, false, false);\n\n          if (!totp && !options.onlyVisibleFields) {\n            // not able to find any viewable totp fields. maybe there are some \"hidden\" ones?\n            totp = this.findTotpField(pageDetails, pf, true, true, false);\n          }\n\n          if (totp) {\n            totps.push(totp);\n          }\n        }\n      });\n    }\n\n    if (passwordFields.length && !passwords.length) {\n      // The page does not have any forms with password fields. Use the first password field on the page and the\n      // input field just before it as the username.\n\n      pf = passwordFields[0];\n      passwords.push(pf);\n\n      if (login.username && pf.elementNumber > 0) {\n        username = this.findUsernameField(pageDetails, pf, false, false, true);\n\n        if (!username && !options.onlyVisibleFields) {\n          // not able to find any viewable username fields. maybe there are some \"hidden\" ones?\n          username = this.findUsernameField(pageDetails, pf, true, true, true);\n        }\n\n        if (username) {\n          usernames.push(username);\n        }\n      }\n\n      if (options.allowTotpAutofill && login.totp && pf.elementNumber > 0) {\n        totp = this.findTotpField(pageDetails, pf, false, false, true);\n\n        if (!totp && !options.onlyVisibleFields) {\n          // not able to find any viewable username fields. maybe there are some \"hidden\" ones?\n          totp = this.findTotpField(pageDetails, pf, true, true, true);\n        }\n\n        if (totp) {\n          totps.push(totp);\n        }\n      }\n    }\n\n    if (!passwordFields.length) {\n      // No password fields on this page. Let's try to just fuzzy fill the username.\n      pageDetails.fields.forEach((f) => {\n        if (\n          !options.skipUsernameOnlyFill &&\n          f.viewable &&\n          (f.type === \"text\" || f.type === \"email\" || f.type === \"tel\") &&\n          AutofillService.fieldIsFuzzyMatch(f, AutoFillConstants.UsernameFieldNames)\n        ) {\n          usernames.push(f);\n        }\n\n        if (\n          options.allowTotpAutofill &&\n          f.viewable &&\n          (f.type === \"text\" || f.type === \"number\") &&\n          (AutofillService.fieldIsFuzzyMatch(f, AutoFillConstants.TotpFieldNames) ||\n            f.autoCompleteType === \"one-time-code\")\n        ) {\n          totps.push(f);\n        }\n      });\n    }\n\n    usernames.forEach((u) => {\n      // eslint-disable-next-line\n      if (filledFields.hasOwnProperty(u.opid)) {\n        return;\n      }\n\n      filledFields[u.opid] = u;\n      AutofillService.fillByOpid(fillScript, u, login.username);\n    });\n\n    passwords.forEach((p) => {\n      // eslint-disable-next-line\n      if (filledFields.hasOwnProperty(p.opid)) {\n        return;\n      }\n\n      filledFields[p.opid] = p;\n      AutofillService.fillByOpid(fillScript, p, login.password);\n    });\n\n    if (options.allowTotpAutofill) {\n      await Promise.all(\n        totps.map(async (t) => {\n          if (Object.prototype.hasOwnProperty.call(filledFields, t.opid)) {\n            return;\n          }\n\n          filledFields[t.opid] = t;\n          const totpValue = await this.totpService.getCode(login.totp);\n          AutofillService.fillByOpid(fillScript, t, totpValue);\n        }),\n      );\n    }\n\n    fillScript = AutofillService.setFillScriptForFocus(filledFields, fillScript);\n    return fillScript;\n  }\n\n  /**\n   * Generates the autofill script for the specified page details and credit card cipher item.\n   * @param {AutofillScript} fillScript\n   * @param {AutofillPageDetails} pageDetails\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {GenerateFillScriptOptions} options\n   * @returns {AutofillScript|null}\n   * @private\n   */\n  private generateCardFillScript(\n    fillScript: AutofillScript,\n    pageDetails: AutofillPageDetails,\n    filledFields: { [id: string]: AutofillField },\n    options: GenerateFillScriptOptions,\n  ): AutofillScript | null {\n    if (!options.cipher.card) {\n      return null;\n    }\n\n    const fillFields: { [id: string]: AutofillField } = {};\n\n    pageDetails.fields.forEach((f) => {\n      if (AutofillService.isExcludedFieldType(f, AutoFillConstants.ExcludedAutofillTypes)) {\n        return;\n      }\n\n      for (let i = 0; i < CreditCardAutoFillConstants.CardAttributes.length; i++) {\n        const attr = CreditCardAutoFillConstants.CardAttributes[i];\n        // eslint-disable-next-line\n        if (!f.hasOwnProperty(attr) || !f[attr] || !f.viewable) {\n          continue;\n        }\n\n        // ref https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#autofill\n        // ref https://developers.google.com/web/fundamentals/design-and-ux/input/forms/\n        if (\n          !fillFields.cardholderName &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            CreditCardAutoFillConstants.CardHolderFieldNames,\n            CreditCardAutoFillConstants.CardHolderFieldNameValues,\n          )\n        ) {\n          fillFields.cardholderName = f;\n          break;\n        } else if (\n          !fillFields.number &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            CreditCardAutoFillConstants.CardNumberFieldNames,\n            CreditCardAutoFillConstants.CardNumberFieldNameValues,\n          )\n        ) {\n          fillFields.number = f;\n          break;\n        } else if (\n          !fillFields.exp &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            CreditCardAutoFillConstants.CardExpiryFieldNames,\n            CreditCardAutoFillConstants.CardExpiryFieldNameValues,\n          )\n        ) {\n          fillFields.exp = f;\n          break;\n        } else if (\n          !fillFields.expMonth &&\n          AutofillService.isFieldMatch(f[attr], CreditCardAutoFillConstants.ExpiryMonthFieldNames)\n        ) {\n          fillFields.expMonth = f;\n          break;\n        } else if (\n          !fillFields.expYear &&\n          AutofillService.isFieldMatch(f[attr], CreditCardAutoFillConstants.ExpiryYearFieldNames)\n        ) {\n          fillFields.expYear = f;\n          break;\n        } else if (\n          !fillFields.code &&\n          AutofillService.isFieldMatch(f[attr], CreditCardAutoFillConstants.CVVFieldNames)\n        ) {\n          fillFields.code = f;\n          break;\n        } else if (\n          !fillFields.brand &&\n          AutofillService.isFieldMatch(f[attr], CreditCardAutoFillConstants.CardBrandFieldNames)\n        ) {\n          fillFields.brand = f;\n          break;\n        }\n      }\n    });\n\n    const card = options.cipher.card;\n    this.makeScriptAction(fillScript, card, fillFields, filledFields, \"cardholderName\");\n    this.makeScriptAction(fillScript, card, fillFields, filledFields, \"number\");\n    this.makeScriptAction(fillScript, card, fillFields, filledFields, \"code\");\n    this.makeScriptAction(fillScript, card, fillFields, filledFields, \"brand\");\n\n    if (fillFields.expMonth && AutofillService.hasValue(card.expMonth)) {\n      let expMonth: string = card.expMonth;\n\n      if (fillFields.expMonth.selectInfo && fillFields.expMonth.selectInfo.options) {\n        let index: number = null;\n        const siOptions = fillFields.expMonth.selectInfo.options;\n        if (siOptions.length === 12) {\n          index = parseInt(card.expMonth, null) - 1;\n        } else if (siOptions.length === 13) {\n          if (\n            siOptions[0][0] != null &&\n            siOptions[0][0] !== \"\" &&\n            (siOptions[12][0] == null || siOptions[12][0] === \"\")\n          ) {\n            index = parseInt(card.expMonth, null) - 1;\n          } else {\n            index = parseInt(card.expMonth, null);\n          }\n        }\n\n        if (index != null) {\n          const option = siOptions[index];\n          if (option.length > 1) {\n            expMonth = option[1];\n          }\n        }\n      } else if (\n        (this.fieldAttrsContain(fillFields.expMonth, \"mm\") ||\n          fillFields.expMonth.maxLength === 2) &&\n        expMonth.length === 1\n      ) {\n        expMonth = \"0\" + expMonth;\n      }\n\n      filledFields[fillFields.expMonth.opid] = fillFields.expMonth;\n      AutofillService.fillByOpid(fillScript, fillFields.expMonth, expMonth);\n    }\n\n    if (fillFields.expYear && AutofillService.hasValue(card.expYear)) {\n      let expYear: string = card.expYear;\n      if (fillFields.expYear.selectInfo && fillFields.expYear.selectInfo.options) {\n        for (let i = 0; i < fillFields.expYear.selectInfo.options.length; i++) {\n          const o: [string, string] = fillFields.expYear.selectInfo.options[i];\n          if (o[0] === card.expYear || o[1] === card.expYear) {\n            expYear = o[1];\n            break;\n          }\n          if (\n            o[1].length === 2 &&\n            card.expYear.length === 4 &&\n            o[1] === card.expYear.substring(2)\n          ) {\n            expYear = o[1];\n            break;\n          }\n          const colonIndex = o[1].indexOf(\":\");\n          if (colonIndex > -1 && o[1].length > colonIndex + 1) {\n            const val = o[1].substring(colonIndex + 2);\n            if (val != null && val.trim() !== \"\" && val === card.expYear) {\n              expYear = o[1];\n              break;\n            }\n          }\n        }\n      } else if (\n        this.fieldAttrsContain(fillFields.expYear, \"yyyy\") ||\n        fillFields.expYear.maxLength === 4\n      ) {\n        if (expYear.length === 2) {\n          expYear = \"20\" + expYear;\n        }\n      } else if (\n        this.fieldAttrsContain(fillFields.expYear, \"yy\") ||\n        fillFields.expYear.maxLength === 2\n      ) {\n        if (expYear.length === 4) {\n          expYear = expYear.substr(2);\n        }\n      }\n\n      filledFields[fillFields.expYear.opid] = fillFields.expYear;\n      AutofillService.fillByOpid(fillScript, fillFields.expYear, expYear);\n    }\n\n    if (\n      fillFields.exp &&\n      AutofillService.hasValue(card.expMonth) &&\n      AutofillService.hasValue(card.expYear)\n    ) {\n      const fullMonth = (\"0\" + card.expMonth).slice(-2);\n\n      let fullYear: string = card.expYear;\n      let partYear: string = null;\n      if (fullYear.length === 2) {\n        partYear = fullYear;\n        fullYear = \"20\" + fullYear;\n      } else if (fullYear.length === 4) {\n        partYear = fullYear.substr(2, 2);\n      }\n\n      let exp: string = null;\n      for (let i = 0; i < CreditCardAutoFillConstants.MonthAbbr.length; i++) {\n        if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] +\n              \"/\" +\n              CreditCardAutoFillConstants.YearAbbrLong[i],\n          )\n        ) {\n          exp = fullMonth + \"/\" + fullYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] +\n              \"/\" +\n              CreditCardAutoFillConstants.YearAbbrShort[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = fullMonth + \"/\" + partYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrLong[i] +\n              \"/\" +\n              CreditCardAutoFillConstants.MonthAbbr[i],\n          )\n        ) {\n          exp = fullYear + \"/\" + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrShort[i] +\n              \"/\" +\n              CreditCardAutoFillConstants.MonthAbbr[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = partYear + \"/\" + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] +\n              \"-\" +\n              CreditCardAutoFillConstants.YearAbbrLong[i],\n          )\n        ) {\n          exp = fullMonth + \"-\" + fullYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] +\n              \"-\" +\n              CreditCardAutoFillConstants.YearAbbrShort[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = fullMonth + \"-\" + partYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrLong[i] +\n              \"-\" +\n              CreditCardAutoFillConstants.MonthAbbr[i],\n          )\n        ) {\n          exp = fullYear + \"-\" + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrShort[i] +\n              \"-\" +\n              CreditCardAutoFillConstants.MonthAbbr[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = partYear + \"-\" + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrLong[i] + CreditCardAutoFillConstants.MonthAbbr[i],\n          )\n        ) {\n          exp = fullYear + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.YearAbbrShort[i] + CreditCardAutoFillConstants.MonthAbbr[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = partYear + fullMonth;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] + CreditCardAutoFillConstants.YearAbbrLong[i],\n          )\n        ) {\n          exp = fullMonth + fullYear;\n        } else if (\n          this.fieldAttrsContain(\n            fillFields.exp,\n            CreditCardAutoFillConstants.MonthAbbr[i] + CreditCardAutoFillConstants.YearAbbrShort[i],\n          ) &&\n          partYear != null\n        ) {\n          exp = fullMonth + partYear;\n        }\n\n        if (exp != null) {\n          break;\n        }\n      }\n\n      if (exp == null) {\n        exp = fullYear + \"-\" + fullMonth;\n      }\n\n      this.makeScriptActionWithValue(fillScript, exp, fillFields.exp, filledFields);\n    }\n\n    return fillScript;\n  }\n\n  /**\n   * Determines whether an iframe is potentially dangerous (\"untrusted\") to autofill\n   * @param {string} pageUrl The url of the page/iframe, usually from AutofillPageDetails\n   * @param {GenerateFillScriptOptions} options The GenerateFillScript options\n   * @returns {boolean} `true` if the iframe is untrusted and a warning should be shown, `false` otherwise\n   * @private\n   */\n  private inUntrustedIframe(pageUrl: string, options: GenerateFillScriptOptions): boolean {\n    // If the pageUrl (from the content script) matches the tabUrl (from the sender tab), we are not in an iframe\n    // This also avoids a false positive if no URI is saved and the user triggers auto-fill anyway\n    if (pageUrl === options.tabUrl) {\n      return false;\n    }\n\n    // Check the pageUrl against cipher URIs using the configured match detection.\n    // Remember: if we are in this function, the tabUrl already matches a saved URI for the login.\n    // We need to verify the pageUrl also matches.\n    const equivalentDomains = this.settingsService.getEquivalentDomains(pageUrl);\n    const matchesUri = options.cipher.login.matchesUri(\n      pageUrl,\n      equivalentDomains,\n      options.defaultUriMatch,\n    );\n    return !matchesUri;\n  }\n\n  /**\n   * Used when handling autofill on credit card fields. Determines whether\n   * the field has an attribute that matches the given value.\n   * @param {AutofillField} field\n   * @param {string} containsVal\n   * @returns {boolean}\n   * @private\n   */\n  private fieldAttrsContain(field: AutofillField, containsVal: string): boolean {\n    if (!field) {\n      return false;\n    }\n\n    let doesContain = false;\n    CreditCardAutoFillConstants.CardAttributesExtended.forEach((attr) => {\n      // eslint-disable-next-line\n      if (doesContain || !field.hasOwnProperty(attr) || !field[attr]) {\n        return;\n      }\n\n      let val = field[attr];\n      val = val.replace(/ /g, \"\").toLowerCase();\n      doesContain = val.indexOf(containsVal) > -1;\n    });\n\n    return doesContain;\n  }\n\n  /**\n   * Generates the autofill script for the specified page details and identify cipher item.\n   * @param {AutofillScript} fillScript\n   * @param {AutofillPageDetails} pageDetails\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {GenerateFillScriptOptions} options\n   * @returns {AutofillScript}\n   * @private\n   */\n  private generateIdentityFillScript(\n    fillScript: AutofillScript,\n    pageDetails: AutofillPageDetails,\n    filledFields: { [id: string]: AutofillField },\n    options: GenerateFillScriptOptions,\n  ): AutofillScript {\n    if (!options.cipher.identity) {\n      return null;\n    }\n\n    const fillFields: { [id: string]: AutofillField } = {};\n\n    pageDetails.fields.forEach((f) => {\n      if (AutofillService.isExcludedFieldType(f, AutoFillConstants.ExcludedAutofillTypes)) {\n        return;\n      }\n\n      for (let i = 0; i < IdentityAutoFillConstants.IdentityAttributes.length; i++) {\n        const attr = IdentityAutoFillConstants.IdentityAttributes[i];\n        // eslint-disable-next-line\n        if (!f.hasOwnProperty(attr) || !f[attr] || !f.viewable) {\n          continue;\n        }\n\n        // ref https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#autofill\n        // ref https://developers.google.com/web/fundamentals/design-and-ux/input/forms/\n        if (\n          !fillFields.name &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            IdentityAutoFillConstants.FullNameFieldNames,\n            IdentityAutoFillConstants.FullNameFieldNameValues,\n          )\n        ) {\n          fillFields.name = f;\n          break;\n        } else if (\n          !fillFields.firstName &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.FirstnameFieldNames)\n        ) {\n          fillFields.firstName = f;\n          break;\n        } else if (\n          !fillFields.middleName &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.MiddlenameFieldNames)\n        ) {\n          fillFields.middleName = f;\n          break;\n        } else if (\n          !fillFields.lastName &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.LastnameFieldNames)\n        ) {\n          fillFields.lastName = f;\n          break;\n        } else if (\n          !fillFields.title &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.TitleFieldNames)\n        ) {\n          fillFields.title = f;\n          break;\n        } else if (\n          !fillFields.email &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.EmailFieldNames)\n        ) {\n          fillFields.email = f;\n          break;\n        } else if (\n          !fillFields.address &&\n          AutofillService.isFieldMatch(\n            f[attr],\n            IdentityAutoFillConstants.AddressFieldNames,\n            IdentityAutoFillConstants.AddressFieldNameValues,\n          )\n        ) {\n          fillFields.address = f;\n          break;\n        } else if (\n          !fillFields.address1 &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.Address1FieldNames)\n        ) {\n          fillFields.address1 = f;\n          break;\n        } else if (\n          !fillFields.address2 &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.Address2FieldNames)\n        ) {\n          fillFields.address2 = f;\n          break;\n        } else if (\n          !fillFields.address3 &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.Address3FieldNames)\n        ) {\n          fillFields.address3 = f;\n          break;\n        } else if (\n          !fillFields.postalCode &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.PostalCodeFieldNames)\n        ) {\n          fillFields.postalCode = f;\n          break;\n        } else if (\n          !fillFields.city &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.CityFieldNames)\n        ) {\n          fillFields.city = f;\n          break;\n        } else if (\n          !fillFields.state &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.StateFieldNames)\n        ) {\n          fillFields.state = f;\n          break;\n        } else if (\n          !fillFields.country &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.CountryFieldNames)\n        ) {\n          fillFields.country = f;\n          break;\n        } else if (\n          !fillFields.phone &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.PhoneFieldNames)\n        ) {\n          fillFields.phone = f;\n          break;\n        } else if (\n          !fillFields.username &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.UserNameFieldNames)\n        ) {\n          fillFields.username = f;\n          break;\n        } else if (\n          !fillFields.company &&\n          AutofillService.isFieldMatch(f[attr], IdentityAutoFillConstants.CompanyFieldNames)\n        ) {\n          fillFields.company = f;\n          break;\n        }\n      }\n    });\n\n    const identity = options.cipher.identity;\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"title\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"firstName\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"middleName\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"lastName\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"address1\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"address2\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"address3\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"city\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"postalCode\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"company\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"email\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"phone\");\n    this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"username\");\n\n    let filledState = false;\n    if (fillFields.state && identity.state && identity.state.length > 2) {\n      const stateLower = identity.state.toLowerCase();\n      const isoState =\n        IdentityAutoFillConstants.IsoStates[stateLower] ||\n        IdentityAutoFillConstants.IsoProvinces[stateLower];\n      if (isoState) {\n        filledState = true;\n        this.makeScriptActionWithValue(fillScript, isoState, fillFields.state, filledFields);\n      }\n    }\n\n    if (!filledState) {\n      this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"state\");\n    }\n\n    let filledCountry = false;\n    if (fillFields.country && identity.country && identity.country.length > 2) {\n      const countryLower = identity.country.toLowerCase();\n      const isoCountry = IdentityAutoFillConstants.IsoCountries[countryLower];\n      if (isoCountry) {\n        filledCountry = true;\n        this.makeScriptActionWithValue(fillScript, isoCountry, fillFields.country, filledFields);\n      }\n    }\n\n    if (!filledCountry) {\n      this.makeScriptAction(fillScript, identity, fillFields, filledFields, \"country\");\n    }\n\n    if (fillFields.name && (identity.firstName || identity.lastName)) {\n      let fullName = \"\";\n      if (AutofillService.hasValue(identity.firstName)) {\n        fullName = identity.firstName;\n      }\n      if (AutofillService.hasValue(identity.middleName)) {\n        if (fullName !== \"\") {\n          fullName += \" \";\n        }\n        fullName += identity.middleName;\n      }\n      if (AutofillService.hasValue(identity.lastName)) {\n        if (fullName !== \"\") {\n          fullName += \" \";\n        }\n        fullName += identity.lastName;\n      }\n\n      this.makeScriptActionWithValue(fillScript, fullName, fillFields.name, filledFields);\n    }\n\n    if (fillFields.address && AutofillService.hasValue(identity.address1)) {\n      let address = \"\";\n      if (AutofillService.hasValue(identity.address1)) {\n        address = identity.address1;\n      }\n      if (AutofillService.hasValue(identity.address2)) {\n        if (address !== \"\") {\n          address += \", \";\n        }\n        address += identity.address2;\n      }\n      if (AutofillService.hasValue(identity.address3)) {\n        if (address !== \"\") {\n          address += \", \";\n        }\n        address += identity.address3;\n      }\n\n      this.makeScriptActionWithValue(fillScript, address, fillFields.address, filledFields);\n    }\n\n    return fillScript;\n  }\n\n  /**\n   * Accepts an HTMLInputElement type value and a list of\n   * excluded types and returns true if the type is excluded.\n   * @param {string} type\n   * @param {string[]} excludedTypes\n   * @returns {boolean}\n   * @private\n   */\n  private static isExcludedType(type: string, excludedTypes: string[]) {\n    return excludedTypes.indexOf(type) > -1;\n  }\n\n  private static isSearchField(field: AutofillField) {\n    const matchFieldAttributeValues = [field.type, field.htmlName, field.htmlID, field.placeholder];\n    const matchPattern = new RegExp(AutoFillConstants.SearchFieldNames.join(\"|\"), \"gi\");\n\n    return Boolean(matchFieldAttributeValues.join(\" \").match(matchPattern));\n  }\n\n  static isExcludedFieldType(field: AutofillField, excludedTypes: string[]) {\n    if (AutofillService.forCustomFieldsOnly(field)) {\n      return true;\n    }\n\n    if (this.isExcludedType(field.type, excludedTypes)) {\n      return true;\n    }\n\n    // Check if the input is an untyped/mistyped search input\n    if (this.isSearchField(field)) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Accepts the value of a field, a list of possible options that define if\n   * a field can be matched to a vault cipher, and a secondary optional list\n   * of options that define if a field can be matched to a vault cipher. Returns\n   * true if the field value matches one of the options.\n   * @param {string} value\n   * @param {string[]} options\n   * @param {string[]} containsOptions\n   * @returns {boolean}\n   * @private\n   */\n  private static isFieldMatch(\n    value: string,\n    options: string[],\n    containsOptions?: string[],\n  ): boolean {\n    value = value\n      .trim()\n      .toLowerCase()\n      .replace(/[^a-zA-Z0-9]+/g, \"\");\n    for (let i = 0; i < options.length; i++) {\n      let option = options[i];\n      const checkValueContains = containsOptions == null || containsOptions.indexOf(option) > -1;\n      option = option.toLowerCase().replace(/-/g, \"\");\n      if (value === option || (checkValueContains && value.indexOf(option) > -1)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Helper method used to create a script action for a field. Conditionally\n   * accepts a fieldProp value that will be used in place of the dataProp value.\n   * @param {AutofillScript} fillScript\n   * @param cipherData\n   * @param {{[p: string]: AutofillField}} fillFields\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {string} dataProp\n   * @param {string} fieldProp\n   * @private\n   */\n  private makeScriptAction(\n    fillScript: AutofillScript,\n    cipherData: any,\n    fillFields: { [id: string]: AutofillField },\n    filledFields: { [id: string]: AutofillField },\n    dataProp: string,\n    fieldProp?: string,\n  ) {\n    fieldProp = fieldProp || dataProp;\n    this.makeScriptActionWithValue(\n      fillScript,\n      cipherData[dataProp],\n      fillFields[fieldProp],\n      filledFields,\n    );\n  }\n\n  /**\n   * Handles updating the list of filled fields and adding a script action\n   * to the fill script. If a select field is passed as part of the fill options,\n   * we iterate over the options to check if the passed value matches one of the\n   * options. If it does, we add a script action to select the option.\n   * @param {AutofillScript} fillScript\n   * @param dataValue\n   * @param {AutofillField} field\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @private\n   */\n  private makeScriptActionWithValue(\n    fillScript: AutofillScript,\n    dataValue: any,\n    field: AutofillField,\n    filledFields: { [id: string]: AutofillField },\n  ) {\n    let doFill = false;\n    if (AutofillService.hasValue(dataValue) && field) {\n      if (field.type === \"select-one\" && field.selectInfo && field.selectInfo.options) {\n        for (let i = 0; i < field.selectInfo.options.length; i++) {\n          const option = field.selectInfo.options[i];\n          for (let j = 0; j < option.length; j++) {\n            if (\n              AutofillService.hasValue(option[j]) &&\n              option[j].toLowerCase() === dataValue.toLowerCase()\n            ) {\n              doFill = true;\n              if (option.length > 1) {\n                dataValue = option[1];\n              }\n              break;\n            }\n          }\n\n          if (doFill) {\n            break;\n          }\n        }\n      } else {\n        doFill = true;\n      }\n    }\n\n    if (doFill) {\n      filledFields[field.opid] = field;\n      AutofillService.fillByOpid(fillScript, field, dataValue);\n    }\n  }\n\n  static valueIsLikePassword(value: string) {\n    if (value == null) {\n      return false;\n    }\n    // Removes all whitespace, _ and - characters\n    const cleanedValue = value.toLowerCase().replace(/[\\s_-]/g, \"\");\n\n    if (cleanedValue.indexOf(\"password\") < 0) {\n      return false;\n    }\n\n    if (AutoFillConstants.PasswordFieldExcludeList.some((i) => cleanedValue.indexOf(i) > -1)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  static fieldHasDisqualifyingAttributeValue(field: AutofillField) {\n    const checkedAttributeValues = [field.htmlID, field.htmlName, field.placeholder];\n    let valueIsOnExclusionList = false;\n\n    for (let i = 0; i < checkedAttributeValues.length; i++) {\n      const checkedAttributeValue = checkedAttributeValues[i];\n      const cleanedValue = checkedAttributeValue?.toLowerCase().replace(/[\\s_-]/g, \"\");\n\n      valueIsOnExclusionList = Boolean(\n        cleanedValue && AutoFillConstants.FieldIgnoreList.some((i) => cleanedValue.indexOf(i) > -1),\n      );\n\n      if (valueIsOnExclusionList) {\n        break;\n      }\n    }\n\n    return valueIsOnExclusionList;\n  }\n\n  /**\n   * Accepts a pageDetails object with a list of fields and returns a list of\n   * fields that are likely to be password fields.\n   * @param {AutofillPageDetails} pageDetails\n   * @param {boolean} canBeHidden\n   * @param {boolean} canBeReadOnly\n   * @param {boolean} mustBeEmpty\n   * @param {boolean} fillNewPassword\n   * @returns {AutofillField[]}\n   */\n  static loadPasswordFields(\n    pageDetails: AutofillPageDetails,\n    canBeHidden: boolean,\n    canBeReadOnly: boolean,\n    mustBeEmpty: boolean,\n    fillNewPassword: boolean,\n  ) {\n    const arr: AutofillField[] = [];\n\n    pageDetails.fields.forEach((f) => {\n      if (AutofillService.isExcludedFieldType(f, AutoFillConstants.ExcludedAutofillLoginTypes)) {\n        return;\n      }\n\n      // If any attribute values match disqualifying values, the entire field should not be used\n      if (AutofillService.fieldHasDisqualifyingAttributeValue(f)) {\n        return;\n      }\n\n      const isPassword = f.type === \"password\";\n\n      const isLikePassword = () => {\n        if (f.type !== \"text\") {\n          return false;\n        }\n\n        if (AutofillService.valueIsLikePassword(f.htmlID)) {\n          return true;\n        }\n\n        if (AutofillService.valueIsLikePassword(f.htmlName)) {\n          return true;\n        }\n\n        if (AutofillService.valueIsLikePassword(f.placeholder)) {\n          return true;\n        }\n\n        return false;\n      };\n\n      if (\n        !f.disabled &&\n        (canBeReadOnly || !f.readonly) &&\n        (isPassword || isLikePassword()) &&\n        (canBeHidden || f.viewable) &&\n        (!mustBeEmpty || f.value == null || f.value.trim() === \"\") &&\n        (fillNewPassword || f.autoCompleteType !== \"new-password\")\n      ) {\n        arr.push(f);\n      }\n    });\n\n    return arr;\n  }\n\n  /**\n   * Accepts a pageDetails object with a list of fields and returns a list of\n   * fields that are likely to be username fields.\n   * @param {AutofillPageDetails} pageDetails\n   * @param {AutofillField} passwordField\n   * @param {boolean} canBeHidden\n   * @param {boolean} canBeReadOnly\n   * @param {boolean} withoutForm\n   * @returns {AutofillField}\n   * @private\n   */\n  private findUsernameField(\n    pageDetails: AutofillPageDetails,\n    passwordField: AutofillField,\n    canBeHidden: boolean,\n    canBeReadOnly: boolean,\n    withoutForm: boolean,\n  ): AutofillField | null {\n    let usernameField: AutofillField = null;\n    for (let i = 0; i < pageDetails.fields.length; i++) {\n      const f = pageDetails.fields[i];\n      if (AutofillService.forCustomFieldsOnly(f)) {\n        continue;\n      }\n\n      if (f.elementNumber >= passwordField.elementNumber) {\n        break;\n      }\n\n      if (\n        !f.disabled &&\n        (canBeReadOnly || !f.readonly) &&\n        (withoutForm || f.form === passwordField.form) &&\n        (canBeHidden || f.viewable) &&\n        (f.type === \"text\" || f.type === \"email\" || f.type === \"tel\")\n      ) {\n        usernameField = f;\n\n        if (this.findMatchingFieldIndex(f, AutoFillConstants.UsernameFieldNames) > -1) {\n          // We found an exact match. No need to keep looking.\n          break;\n        }\n      }\n    }\n\n    return usernameField;\n  }\n\n  /**\n   * Accepts a pageDetails object with a list of fields and returns a list of\n   * fields that are likely to be TOTP fields.\n   * @param {AutofillPageDetails} pageDetails\n   * @param {AutofillField} passwordField\n   * @param {boolean} canBeHidden\n   * @param {boolean} canBeReadOnly\n   * @param {boolean} withoutForm\n   * @returns {AutofillField}\n   * @private\n   */\n  private findTotpField(\n    pageDetails: AutofillPageDetails,\n    passwordField: AutofillField,\n    canBeHidden: boolean,\n    canBeReadOnly: boolean,\n    withoutForm: boolean,\n  ): AutofillField | null {\n    let totpField: AutofillField = null;\n    for (let i = 0; i < pageDetails.fields.length; i++) {\n      const f = pageDetails.fields[i];\n      if (AutofillService.forCustomFieldsOnly(f)) {\n        continue;\n      }\n\n      const fieldIsDisqualified = AutofillService.fieldHasDisqualifyingAttributeValue(f);\n\n      if (\n        !fieldIsDisqualified &&\n        !f.disabled &&\n        (canBeReadOnly || !f.readonly) &&\n        (withoutForm || f.form === passwordField.form) &&\n        (canBeHidden || f.viewable) &&\n        (f.type === \"text\" || f.type === \"number\") &&\n        AutofillService.fieldIsFuzzyMatch(f, AutoFillConstants.TotpFieldNames)\n      ) {\n        totpField = f;\n\n        if (\n          this.findMatchingFieldIndex(f, AutoFillConstants.TotpFieldNames) > -1 ||\n          f.autoCompleteType === \"one-time-code\"\n        ) {\n          // We found an exact match. No need to keep looking.\n          break;\n        }\n      }\n    }\n\n    return totpField;\n  }\n\n  /**\n   * Accepts a field and returns the index of the first matching property\n   * present in a list of attribute names.\n   * @param {AutofillField} field\n   * @param {string[]} names\n   * @returns {number}\n   * @private\n   */\n  private findMatchingFieldIndex(field: AutofillField, names: string[]): number {\n    for (let i = 0; i < names.length; i++) {\n      if (names[i].indexOf(\"=\") > -1) {\n        if (this.fieldPropertyIsPrefixMatch(field, \"htmlID\", names[i], \"id\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"htmlName\", names[i], \"name\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"label-left\", names[i], \"label\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"label-right\", names[i], \"label\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"label-tag\", names[i], \"label\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"label-aria\", names[i], \"label\")) {\n          return i;\n        }\n        if (this.fieldPropertyIsPrefixMatch(field, \"placeholder\", names[i], \"placeholder\")) {\n          return i;\n        }\n      }\n\n      if (this.fieldPropertyIsMatch(field, \"htmlID\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"htmlName\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"label-left\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"label-right\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"label-tag\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"label-aria\", names[i])) {\n        return i;\n      }\n      if (this.fieldPropertyIsMatch(field, \"placeholder\", names[i])) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  /**\n   * Accepts a field, property, name, and prefix and returns true if the field\n   * contains a value that matches the given prefixed property.\n   * @param field\n   * @param {string} property\n   * @param {string} name\n   * @param {string} prefix\n   * @param {string} separator\n   * @returns {boolean}\n   * @private\n   */\n  private fieldPropertyIsPrefixMatch(\n    field: any,\n    property: string,\n    name: string,\n    prefix: string,\n    separator = \"=\",\n  ): boolean {\n    if (name.indexOf(prefix + separator) === 0) {\n      const sepIndex = name.indexOf(separator);\n      const val = name.substring(sepIndex + 1);\n      return val != null && this.fieldPropertyIsMatch(field, property, val);\n    }\n    return false;\n  }\n\n  /**\n   * Identifies if a given property within a field matches the value\n   * of the passed \"name\" parameter. If the name starts with \"regex=\",\n   * the value is tested against a case-insensitive regular expression.\n   * If the name starts with \"csv=\", the value is treated as a\n   * comma-separated list of values to match.\n   * @param field\n   * @param {string} property\n   * @param {string} name\n   * @returns {boolean}\n   * @private\n   */\n  private fieldPropertyIsMatch(field: any, property: string, name: string): boolean {\n    let fieldVal = field[property] as string;\n    if (!AutofillService.hasValue(fieldVal)) {\n      return false;\n    }\n\n    fieldVal = fieldVal.trim().replace(/(?:\\r\\n|\\r|\\n)/g, \"\");\n    if (name.startsWith(\"regex=\")) {\n      try {\n        const regexParts = name.split(\"=\", 2);\n        if (regexParts.length === 2) {\n          const regex = new RegExp(regexParts[1], \"i\");\n          return regex.test(fieldVal);\n        }\n      } catch (e) {\n        this.logService.error(e);\n      }\n    } else if (name.startsWith(\"csv=\")) {\n      const csvParts = name.split(\"=\", 2);\n      if (csvParts.length === 2) {\n        const csvVals = csvParts[1].split(\",\");\n        for (let i = 0; i < csvVals.length; i++) {\n          const val = csvVals[i];\n          if (val != null && val.trim().toLowerCase() === fieldVal.toLowerCase()) {\n            return true;\n          }\n        }\n        return false;\n      }\n    }\n\n    return fieldVal.toLowerCase() === name;\n  }\n\n  /**\n   * Accepts a field and returns true if the field contains a\n   * value that matches any of the names in the provided list.\n   * @param {AutofillField} field\n   * @param {string[]} names\n   * @returns {boolean}\n   */\n  static fieldIsFuzzyMatch(field: AutofillField, names: string[]): boolean {\n    if (AutofillService.hasValue(field.htmlID) && this.fuzzyMatch(names, field.htmlID)) {\n      return true;\n    }\n    if (AutofillService.hasValue(field.htmlName) && this.fuzzyMatch(names, field.htmlName)) {\n      return true;\n    }\n    if (\n      AutofillService.hasValue(field[\"label-tag\"]) &&\n      this.fuzzyMatch(names, field[\"label-tag\"])\n    ) {\n      return true;\n    }\n    if (AutofillService.hasValue(field.placeholder) && this.fuzzyMatch(names, field.placeholder)) {\n      return true;\n    }\n    if (\n      AutofillService.hasValue(field[\"label-left\"]) &&\n      this.fuzzyMatch(names, field[\"label-left\"])\n    ) {\n      return true;\n    }\n    if (\n      AutofillService.hasValue(field[\"label-top\"]) &&\n      this.fuzzyMatch(names, field[\"label-top\"])\n    ) {\n      return true;\n    }\n    if (\n      AutofillService.hasValue(field[\"label-aria\"]) &&\n      this.fuzzyMatch(names, field[\"label-aria\"])\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Accepts a list of options and a value and returns\n   * true if the value matches any of the options.\n   * @param {string[]} options\n   * @param {string} value\n   * @returns {boolean}\n   * @private\n   */\n  private static fuzzyMatch(options: string[], value: string): boolean {\n    if (options == null || options.length === 0 || value == null || value === \"\") {\n      return false;\n    }\n\n    value = value\n      .replace(/(?:\\r\\n|\\r|\\n)/g, \"\")\n      .trim()\n      .toLowerCase();\n\n    for (let i = 0; i < options.length; i++) {\n      if (value.indexOf(options[i]) > -1) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Accepts a string and returns true if the\n   * string is not falsy and not empty.\n   * @param {string} str\n   * @returns {boolean}\n   */\n  static hasValue(str: string): boolean {\n    return Boolean(str && str !== \"\");\n  }\n\n  /**\n   * Sets the `focus_by_opid` autofill script\n   * action to the last field that was filled.\n   * @param {{[p: string]: AutofillField}} filledFields\n   * @param {AutofillScript} fillScript\n   * @returns {AutofillScript}\n   */\n  static setFillScriptForFocus(\n    filledFields: { [id: string]: AutofillField },\n    fillScript: AutofillScript,\n  ): AutofillScript {\n    let lastField: AutofillField = null;\n    let lastPasswordField: AutofillField = null;\n\n    for (const opid in filledFields) {\n      // eslint-disable-next-line\n      if (filledFields.hasOwnProperty(opid) && filledFields[opid].viewable) {\n        lastField = filledFields[opid];\n\n        if (filledFields[opid].type === \"password\") {\n          lastPasswordField = filledFields[opid];\n        }\n      }\n    }\n\n    // Prioritize password field over others.\n    if (lastPasswordField) {\n      fillScript.script.push([\"focus_by_opid\", lastPasswordField.opid]);\n    } else if (lastField) {\n      fillScript.script.push([\"focus_by_opid\", lastField.opid]);\n    }\n\n    return fillScript;\n  }\n\n  /**\n   * Updates a fill script to place the `cilck_on_opid`, `focus_on_opid`, and `fill_by_opid`\n   * fill script actions associated with the provided field.\n   * @param {AutofillScript} fillScript\n   * @param {AutofillField} field\n   * @param {string} value\n   */\n  static fillByOpid(fillScript: AutofillScript, field: AutofillField, value: string): void {\n    if (field.maxLength && value && value.length > field.maxLength) {\n      value = value.substr(0, value.length);\n    }\n    if (field.tagName !== \"span\") {\n      fillScript.script.push([\"click_on_opid\", field.opid]);\n      fillScript.script.push([\"focus_by_opid\", field.opid]);\n    }\n    fillScript.script.push([\"fill_by_opid\", field.opid, value]);\n  }\n\n  /**\n   * Identifies if the field is a custom field, a custom\n   * field is defined as a field that is a `span` element.\n   * @param {AutofillField} field\n   * @returns {boolean}\n   */\n  static forCustomFieldsOnly(field: AutofillField): boolean {\n    return field.tagName === \"span\";\n  }\n\n  /**\n   * Handles debouncing the opening of the master password reprompt popout.\n   */\n  private isDebouncingPasswordRepromptPopout() {\n    if (this.currentlyOpeningPasswordRepromptPopout) {\n      return true;\n    }\n\n    this.currentlyOpeningPasswordRepromptPopout = true;\n    clearTimeout(this.openPasswordRepromptPopoutDebounce);\n\n    this.openPasswordRepromptPopoutDebounce = setTimeout(() => {\n      this.currentlyOpeningPasswordRepromptPopout = false;\n    }, 100);\n\n    return false;\n  }\n\n  /**\n   * Handles incoming long-lived connections from injected autofill scripts.\n   * Stores the port in a set to facilitate disconnecting ports if the extension\n   * needs to re-inject the autofill scripts.\n   *\n   * @param port - The port that was connected\n   */\n  private handleInjectedScriptPortConnection = (port: chrome.runtime.Port) => {\n    if (port.name !== AutofillPort.InjectedScript) {\n      return;\n    }\n\n    this.autofillScriptPortsSet.add(port);\n    port.onDisconnect.addListener(this.handleInjectScriptPortOnDisconnect);\n  };\n\n  /**\n   * Handles disconnecting ports that relate to injected autofill scripts.\n\n   * @param port - The port that was disconnected\n   */\n  private handleInjectScriptPortOnDisconnect = (port: chrome.runtime.Port) => {\n    if (port.name !== AutofillPort.InjectedScript) {\n      return;\n    }\n\n    this.autofillScriptPortsSet.delete(port);\n  };\n\n  /**\n   * Queries all open tabs in the user's browsing session\n   * and injects the autofill scripts into the page.\n   */\n  private async injectAutofillScriptsInAllTabs() {\n    const tabs = await BrowserApi.tabsQuery({});\n    for (let index = 0; index < tabs.length; index++) {\n      const tab = tabs[index];\n      if (tab.url?.startsWith(\"http\")) {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.injectAutofillScripts(tab, 0, false);\n      }\n    }\n  }\n}\n","import {\n  UserVerificationServiceInitOptions,\n  userVerificationServiceFactory,\n} from \"../../../auth/background/service-factories/user-verification-service.factory\";\nimport {\n  EventCollectionServiceInitOptions,\n  eventCollectionServiceFactory,\n} from \"../../../background/service-factories/event-collection-service.factory\";\nimport {\n  settingsServiceFactory,\n  SettingsServiceInitOptions,\n} from \"../../../background/service-factories/settings-service.factory\";\nimport {\n  CachedServices,\n  factory,\n  FactoryOptions,\n} from \"../../../platform/background/service-factories/factory-options\";\nimport {\n  logServiceFactory,\n  LogServiceInitOptions,\n} from \"../../../platform/background/service-factories/log-service.factory\";\nimport {\n  stateServiceFactory,\n  StateServiceInitOptions,\n} from \"../../../platform/background/service-factories/state-service.factory\";\nimport {\n  cipherServiceFactory,\n  CipherServiceInitOptions,\n} from \"../../../vault/background/service_factories/cipher-service.factory\";\nimport {\n  TotpServiceInitOptions,\n  totpServiceFactory,\n} from \"../../../vault/background/service_factories/totp-service.factory\";\nimport { AutofillService as AbstractAutoFillService } from \"../../services/abstractions/autofill.service\";\nimport AutofillService from \"../../services/autofill.service\";\n\nimport {\n  AutofillSettingsServiceInitOptions,\n  autofillSettingsServiceFactory,\n} from \"./autofill-settings-service.factory\";\n\ntype AutoFillServiceOptions = FactoryOptions;\n\nexport type AutoFillServiceInitOptions = AutoFillServiceOptions &\n  CipherServiceInitOptions &\n  StateServiceInitOptions &\n  AutofillSettingsServiceInitOptions &\n  TotpServiceInitOptions &\n  EventCollectionServiceInitOptions &\n  LogServiceInitOptions &\n  SettingsServiceInitOptions &\n  UserVerificationServiceInitOptions;\n\nexport function autofillServiceFactory(\n  cache: { autofillService?: AbstractAutoFillService } & CachedServices,\n  opts: AutoFillServiceInitOptions,\n): Promise<AbstractAutoFillService> {\n  return factory(\n    cache,\n    \"autofillService\",\n    opts,\n    async () =>\n      new AutofillService(\n        await cipherServiceFactory(cache, opts),\n        await stateServiceFactory(cache, opts),\n        await autofillSettingsServiceFactory(cache, opts),\n        await totpServiceFactory(cache, opts),\n        await eventCollectionServiceFactory(cache, opts),\n        await logServiceFactory(cache, opts),\n        await settingsServiceFactory(cache, opts),\n        await userVerificationServiceFactory(cache, opts),\n      ),\n  );\n}\n","import { BrowserApi } from \"../../platform/browser/browser-api\";\n\nexport const clearClipboardAlarmName = \"clearClipboard\";\n\nexport class ClearClipboard {\n  /**\n    We currently rely on an active tab with an injected content script (`../content/misc-utils.ts`) to clear the clipboard via `window.navigator.clipboard.writeText(text)`\n    \n    With https://bugs.chromium.org/p/chromium/issues/detail?id=1160302 it was said that service workers,\n    would have access to the clipboard api and then we could migrate to a simpler solution\n    */\n  static async run() {\n    const activeTabs = await BrowserApi.getActiveTabs();\n    if (!activeTabs || activeTabs.length === 0) {\n      return;\n    }\n\n    BrowserApi.sendTabsMessage(activeTabs[0].id, {\n      command: \"clearClipboard\",\n    });\n  }\n}\n","import { BrowserApi } from \"../../platform/browser/browser-api\";\n\n/**\n * Copies text to the clipboard in a MV3 safe way.\n * @param tab - The tab that the text will be sent to so that it can be copied to the users clipboard this needs to be an active tab or the DOM won't be able to be used to do the action. The tab sent in here should be from a user started action or queried for active tabs.\n * @param text - The text that you want added to the users clipboard.\n */\nexport const copyToClipboard = async (tab: chrome.tabs.Tab, text: string) => {\n  if (tab.id == null) {\n    throw new Error(\"Cannot copy text to clipboard with a tab that does not have an id.\");\n  }\n\n  BrowserApi.sendTabsMessage(tab.id, {\n    command: \"copyText\",\n    text: text,\n  });\n};\n","import { clearClipboardAlarmName } from \"../../autofill/clipboard\";\nimport { BrowserApi } from \"../browser/browser-api\";\n\nexport const alarmKeys = [clearClipboardAlarmName] as const;\nexport type AlarmKeys = (typeof alarmKeys)[number];\n\ntype AlarmState = { [T in AlarmKeys]: number | undefined };\n\nconst alarmState: AlarmState = {\n  clearClipboard: null,\n  //TODO once implemented vaultTimeout: null;\n  //TODO once implemented checkNotifications: null;\n  //TODO once implemented (if necessary) processReload: null;\n};\n\n/**\n * Retrieves the set alarm time (planned execution) for a give an commandName {@link AlarmState}\n * @param commandName A command that has been previously registered with {@link AlarmState}\n * @returns {Promise<number>} null or Unix epoch timestamp when the alarm action is supposed to execute\n * @example\n * // getAlarmTime(clearClipboard)\n */\nexport async function getAlarmTime(commandName: AlarmKeys): Promise<number> {\n  let alarmTime: number;\n  if (BrowserApi.manifestVersion == 3) {\n    const fromSessionStore = await chrome.storage.session.get(commandName);\n    alarmTime = fromSessionStore[commandName];\n  } else {\n    alarmTime = alarmState[commandName];\n  }\n\n  return alarmTime;\n}\n\n/**\n * Registers an action that should execute after the given time has passed\n * @param commandName A command that has been previously registered with {@link AlarmState}\n * @param delay_ms The number of ms from now in which the command should execute from\n * @example\n * // setAlarmTime(clearClipboard, 5000) register the clearClipboard action which will execute when at least 5 seconds from now have passed\n */\nexport async function setAlarmTime(commandName: AlarmKeys, delay_ms: number): Promise<void> {\n  if (!delay_ms || delay_ms === 0) {\n    await this.clearAlarmTime(commandName);\n    return;\n  }\n\n  const time = Date.now() + delay_ms;\n  await setAlarmTimeInternal(commandName, time);\n}\n\n/**\n * Clears the time currently set for a given command\n * @param commandName A command that has been previously registered with {@link AlarmState}\n */\nexport async function clearAlarmTime(commandName: AlarmKeys): Promise<void> {\n  await setAlarmTimeInternal(commandName, null);\n}\n\nasync function setAlarmTimeInternal(commandName: AlarmKeys, time: number): Promise<void> {\n  if (BrowserApi.manifestVersion == 3) {\n    await chrome.storage.session.set({ [commandName]: time });\n  } else {\n    alarmState[commandName] = time;\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { AutofillSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport { PasswordGenerationServiceAbstraction } from \"@bitwarden/common/tools/generator/password\";\n\nimport { setAlarmTime } from \"../../platform/alarms/alarm-state\";\n\nimport { clearClipboardAlarmName } from \"./clear-clipboard\";\nimport { copyToClipboard } from \"./copy-to-clipboard-command\";\n\nexport class GeneratePasswordToClipboardCommand {\n  constructor(\n    private passwordGenerationService: PasswordGenerationServiceAbstraction,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n  ) {}\n\n  async getClearClipboard() {\n    return await firstValueFrom(this.autofillSettingsService.clearClipboardDelay$);\n  }\n\n  async generatePasswordToClipboard(tab: chrome.tabs.Tab) {\n    const [options] = await this.passwordGenerationService.getOptions();\n    const password = await this.passwordGenerationService.generatePassword(options);\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    copyToClipboard(tab, password);\n\n    const clearClipboard = await this.getClearClipboard();\n\n    if (clearClipboard != null) {\n      await setAlarmTime(clearClipboardAlarmName, clearClipboard * 1000);\n    }\n  }\n}\n","import { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport AutofillPageDetails from \"../models/autofill-page-details\";\nimport { AutofillService } from \"../services/abstractions/autofill.service\";\n\nexport class AutofillTabCommand {\n  constructor(private autofillService: AutofillService) {}\n\n  async doAutofillTabCommand(tab: chrome.tabs.Tab) {\n    if (!tab.id) {\n      throw new Error(\"Tab does not have an id, cannot complete autofill.\");\n    }\n\n    const details = await this.collectPageDetails(tab.id);\n    await this.autofillService.doAutoFillOnTab(\n      [\n        {\n          frameId: 0,\n          tab: tab,\n          details: details,\n        },\n      ],\n      tab,\n      true,\n    );\n  }\n\n  async doAutofillTabWithCipherCommand(tab: chrome.tabs.Tab, cipher: CipherView) {\n    if (!tab.id) {\n      throw new Error(\"Tab does not have an id, cannot complete autofill.\");\n    }\n\n    const details = await this.collectPageDetails(tab.id);\n    await this.autofillService.doAutoFill({\n      tab: tab,\n      cipher: cipher,\n      pageDetails: [\n        {\n          frameId: 0,\n          tab: tab,\n          details: details,\n        },\n      ],\n      skipLastUsed: false,\n      skipUsernameOnlyFill: false,\n      onlyEmptyFields: false,\n      onlyVisibleFields: false,\n      fillNewPassword: true,\n      allowTotpAutofill: true,\n    });\n  }\n\n  private async collectPageDetails(tabId: number): Promise<AutofillPageDetails> {\n    return new Promise((resolve, reject) => {\n      chrome.tabs.sendMessage(\n        tabId,\n        {\n          command: \"collectPageDetailsImmediately\",\n        },\n        (response: AutofillPageDetails) => {\n          if (chrome.runtime.lastError) {\n            reject(chrome.runtime.lastError);\n            return;\n          }\n\n          resolve(response);\n        },\n      );\n    });\n  }\n}\n","import { EventCollectionService } from \"@bitwarden/common/abstractions/event/event-collection.service\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { UserVerificationService } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification.service.abstraction\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { EventType } from \"@bitwarden/common/enums\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { TotpService } from \"@bitwarden/common/vault/abstractions/totp.service\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherRepromptType } from \"@bitwarden/common/vault/enums/cipher-reprompt-type\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport {\n  authServiceFactory,\n  AuthServiceInitOptions,\n} from \"../../auth/background/service-factories/auth-service.factory\";\nimport { userVerificationServiceFactory } from \"../../auth/background/service-factories/user-verification-service.factory\";\nimport { openUnlockPopout } from \"../../auth/popup/utils/auth-popout-window\";\nimport { autofillSettingsServiceFactory } from \"../../autofill/background/service_factories/autofill-settings-service.factory\";\nimport { eventCollectionServiceFactory } from \"../../background/service-factories/event-collection-service.factory\";\nimport { Account } from \"../../models/account\";\nimport { CachedServices } from \"../../platform/background/service-factories/factory-options\";\nimport { stateServiceFactory } from \"../../platform/background/service-factories/state-service.factory\";\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { passwordGenerationServiceFactory } from \"../../tools/background/service_factories/password-generation-service.factory\";\nimport {\n  cipherServiceFactory,\n  CipherServiceInitOptions,\n} from \"../../vault/background/service_factories/cipher-service.factory\";\nimport { totpServiceFactory } from \"../../vault/background/service_factories/totp-service.factory\";\nimport {\n  openAddEditVaultItemPopout,\n  openVaultItemPasswordRepromptPopout,\n} from \"../../vault/popup/utils/vault-popout-window\";\nimport { LockedVaultPendingNotificationsData } from \"../background/abstractions/notification.background\";\nimport { autofillServiceFactory } from \"../background/service_factories/autofill-service.factory\";\nimport { copyToClipboard, GeneratePasswordToClipboardCommand } from \"../clipboard\";\nimport { AutofillTabCommand } from \"../commands/autofill-tab-command\";\nimport {\n  AUTOFILL_CARD_ID,\n  AUTOFILL_ID,\n  AUTOFILL_IDENTITY_ID,\n  COPY_IDENTIFIER_ID,\n  COPY_PASSWORD_ID,\n  COPY_USERNAME_ID,\n  COPY_VERIFICATION_CODE_ID,\n  CREATE_CARD_ID,\n  CREATE_IDENTITY_ID,\n  CREATE_LOGIN_ID,\n  GENERATE_PASSWORD_ID,\n  NOOP_COMMAND_SUFFIX,\n} from \"../constants\";\nimport { AutofillCipherTypeId } from \"../types\";\n\nexport type CopyToClipboardOptions = { text: string; tab: chrome.tabs.Tab };\nexport type CopyToClipboardAction = (options: CopyToClipboardOptions) => void;\nexport type AutofillAction = (tab: chrome.tabs.Tab, cipher: CipherView) => Promise<void>;\n\nexport type GeneratePasswordToClipboardAction = (tab: chrome.tabs.Tab) => Promise<void>;\n\nconst NOT_IMPLEMENTED = (..._args: unknown[]) =>\n  Promise.reject<never>(\"This action is not implemented inside of a service worker context.\");\n\nexport class ContextMenuClickedHandler {\n  constructor(\n    private copyToClipboard: CopyToClipboardAction,\n    private generatePasswordToClipboard: GeneratePasswordToClipboardAction,\n    private autofillAction: AutofillAction,\n    private authService: AuthService,\n    private cipherService: CipherService,\n    private stateService: StateService,\n    private totpService: TotpService,\n    private eventCollectionService: EventCollectionService,\n    private userVerificationService: UserVerificationService,\n  ) {}\n\n  static async mv3Create(cachedServices: CachedServices) {\n    const stateFactory = new StateFactory(GlobalState, Account);\n    const serviceOptions: AuthServiceInitOptions & CipherServiceInitOptions = {\n      apiServiceOptions: {\n        logoutCallback: NOT_IMPLEMENTED,\n      },\n      cryptoFunctionServiceOptions: {\n        win: self,\n      },\n      encryptServiceOptions: {\n        logMacFailures: false,\n      },\n      i18nServiceOptions: {\n        systemLanguage: chrome.i18n.getUILanguage(),\n      },\n      keyConnectorServiceOptions: {\n        logoutCallback: NOT_IMPLEMENTED,\n      },\n      logServiceOptions: {\n        isDev: false,\n      },\n      platformUtilsServiceOptions: {\n        biometricCallback: NOT_IMPLEMENTED,\n        clipboardWriteCallback: NOT_IMPLEMENTED,\n        win: self,\n      },\n      stateServiceOptions: {\n        stateFactory: stateFactory,\n      },\n      autofillSettingsServiceOptions: {\n        stateFactory: autofillSettingsServiceFactory,\n      },\n    };\n\n    const generatePasswordToClipboardCommand = new GeneratePasswordToClipboardCommand(\n      await passwordGenerationServiceFactory(cachedServices, serviceOptions),\n      await autofillSettingsServiceFactory(cachedServices, serviceOptions),\n    );\n\n    const autofillCommand = new AutofillTabCommand(\n      await autofillServiceFactory(cachedServices, serviceOptions),\n    );\n\n    return new ContextMenuClickedHandler(\n      (options) => copyToClipboard(options.tab, options.text),\n      (tab) => generatePasswordToClipboardCommand.generatePasswordToClipboard(tab),\n      (tab, cipher) => autofillCommand.doAutofillTabWithCipherCommand(tab, cipher),\n      await authServiceFactory(cachedServices, serviceOptions),\n      await cipherServiceFactory(cachedServices, serviceOptions),\n      await stateServiceFactory(cachedServices, serviceOptions),\n      await totpServiceFactory(cachedServices, serviceOptions),\n      await eventCollectionServiceFactory(cachedServices, serviceOptions),\n      await userVerificationServiceFactory(cachedServices, serviceOptions),\n    );\n  }\n\n  static async onClickedListener(\n    info: chrome.contextMenus.OnClickData,\n    tab?: chrome.tabs.Tab,\n    cachedServices: CachedServices = {},\n  ) {\n    const contextMenuClickedHandler = await ContextMenuClickedHandler.mv3Create(cachedServices);\n    await contextMenuClickedHandler.run(info, tab);\n  }\n\n  static async messageListener(\n    message: { command: string; data: LockedVaultPendingNotificationsData },\n    sender: chrome.runtime.MessageSender,\n    cachedServices: CachedServices,\n  ) {\n    if (\n      message.command !== \"unlockCompleted\" ||\n      message.data.target !== \"contextmenus.background\"\n    ) {\n      return;\n    }\n\n    const contextMenuClickedHandler = await ContextMenuClickedHandler.mv3Create(cachedServices);\n    await contextMenuClickedHandler.run(\n      message.data.commandToRetry.message.contextMenuOnClickData,\n      message.data.commandToRetry.sender.tab,\n    );\n  }\n\n  async run(info: chrome.contextMenus.OnClickData, tab: chrome.tabs.Tab) {\n    if (!tab) {\n      return;\n    }\n\n    switch (info.menuItemId) {\n      case GENERATE_PASSWORD_ID:\n        await this.generatePasswordToClipboard(tab);\n        break;\n      case COPY_IDENTIFIER_ID:\n        this.copyToClipboard({ text: await this.getIdentifier(tab, info), tab: tab });\n        break;\n      default:\n        await this.cipherAction(info, tab);\n    }\n  }\n\n  async cipherAction(info: chrome.contextMenus.OnClickData, tab: chrome.tabs.Tab) {\n    if (!tab) {\n      return;\n    }\n\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      const retryMessage: LockedVaultPendingNotificationsData = {\n        commandToRetry: {\n          message: { command: NOOP_COMMAND_SUFFIX, contextMenuOnClickData: info },\n          sender: { tab: tab },\n        },\n        target: \"contextmenus.background\",\n      };\n      await BrowserApi.tabSendMessageData(\n        tab,\n        \"addToLockedVaultPendingNotifications\",\n        retryMessage,\n      );\n\n      await openUnlockPopout(tab);\n      return;\n    }\n\n    // NOTE: We don't actually use the first part of this ID, we further switch based on the parentMenuItemId\n    // I would really love to not add it but that is a departure from how it currently works.\n    const menuItemId = (info.menuItemId as string).split(\"_\")[1]; // We create all the ids, we can guarantee they are strings\n    let cipher: CipherView | undefined;\n    const isCreateCipherAction = [CREATE_LOGIN_ID, CREATE_IDENTITY_ID, CREATE_CARD_ID].includes(\n      menuItemId as string,\n    );\n\n    if (isCreateCipherAction) {\n      // pass; defer to logic below\n    } else if (menuItemId === NOOP_COMMAND_SUFFIX) {\n      const additionalCiphersToGet =\n        info.parentMenuItemId === AUTOFILL_IDENTITY_ID\n          ? [CipherType.Identity]\n          : info.parentMenuItemId === AUTOFILL_CARD_ID\n            ? [CipherType.Card]\n            : [];\n\n      // This NOOP item has come through which is generally only for no access state but since we got here\n      // we are actually unlocked we will do our best to find a good match of an item to autofill this is useful\n      // in scenarios like unlock on autofill\n      const ciphers = await this.cipherService.getAllDecryptedForUrl(\n        tab.url,\n        additionalCiphersToGet,\n      );\n\n      cipher = ciphers[0];\n    } else {\n      const ciphers = await this.cipherService.getAllDecrypted();\n      cipher = ciphers.find(({ id }) => id === menuItemId);\n    }\n\n    if (!cipher && !isCreateCipherAction) {\n      return;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.stateService.setLastActive(new Date().getTime());\n    switch (info.parentMenuItemId) {\n      case AUTOFILL_ID:\n      case AUTOFILL_IDENTITY_ID:\n      case AUTOFILL_CARD_ID: {\n        const cipherType = this.getCipherCreationType(menuItemId);\n\n        if (cipherType) {\n          await openAddEditVaultItemPopout(tab, { cipherType });\n          break;\n        }\n\n        if (await this.isPasswordRepromptRequired(cipher)) {\n          await openVaultItemPasswordRepromptPopout(tab, {\n            cipherId: cipher.id,\n            // The action here is passed on to the single-use reprompt window and doesn't change based on cipher type\n            action: AUTOFILL_ID,\n          });\n        } else {\n          await this.autofillAction(tab, cipher);\n        }\n\n        break;\n      }\n      case COPY_USERNAME_ID:\n        if (menuItemId === CREATE_LOGIN_ID) {\n          await openAddEditVaultItemPopout(tab, { cipherType: CipherType.Login });\n          break;\n        }\n\n        this.copyToClipboard({ text: cipher.login.username, tab: tab });\n        break;\n      case COPY_PASSWORD_ID:\n        if (menuItemId === CREATE_LOGIN_ID) {\n          await openAddEditVaultItemPopout(tab, { cipherType: CipherType.Login });\n          break;\n        }\n\n        if (await this.isPasswordRepromptRequired(cipher)) {\n          await openVaultItemPasswordRepromptPopout(tab, {\n            cipherId: cipher.id,\n            action: COPY_PASSWORD_ID,\n          });\n        } else {\n          this.copyToClipboard({ text: cipher.login.password, tab: tab });\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.eventCollectionService.collect(EventType.Cipher_ClientCopiedPassword, cipher.id);\n        }\n\n        break;\n      case COPY_VERIFICATION_CODE_ID:\n        if (menuItemId === CREATE_LOGIN_ID) {\n          await openAddEditVaultItemPopout(tab, { cipherType: CipherType.Login });\n          break;\n        }\n\n        if (await this.isPasswordRepromptRequired(cipher)) {\n          await openVaultItemPasswordRepromptPopout(tab, {\n            cipherId: cipher.id,\n            action: COPY_VERIFICATION_CODE_ID,\n          });\n        } else {\n          this.copyToClipboard({\n            text: await this.totpService.getCode(cipher.login.totp),\n            tab: tab,\n          });\n        }\n\n        break;\n    }\n  }\n\n  private async isPasswordRepromptRequired(cipher: CipherView): Promise<boolean> {\n    return (\n      cipher.reprompt === CipherRepromptType.Password &&\n      (await this.userVerificationService.hasMasterPasswordAndMasterKeyHash())\n    );\n  }\n\n  private getCipherCreationType(menuItemId?: string): AutofillCipherTypeId | null {\n    return menuItemId === CREATE_IDENTITY_ID\n      ? CipherType.Identity\n      : menuItemId === CREATE_CARD_ID\n        ? CipherType.Card\n        : menuItemId === CREATE_LOGIN_ID\n          ? CipherType.Login\n          : null;\n  }\n\n  private async getIdentifier(tab: chrome.tabs.Tab, info: chrome.contextMenus.OnClickData) {\n    return new Promise<string>((resolve, reject) => {\n      BrowserApi.sendTabsMessage(\n        tab.id,\n        { command: \"getClickedElement\" },\n        { frameId: info.frameId },\n        (identifier: string) => {\n          if (chrome.runtime.lastError) {\n            reject(chrome.runtime.lastError);\n            return;\n          }\n\n          resolve(identifier);\n        },\n      );\n    });\n  }\n}\n","import { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { EncryptService } from \"@bitwarden/common/platform/abstractions/encrypt.service\";\nimport { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\nimport { ContainerService } from \"@bitwarden/common/platform/services/container.service\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\n\nimport { authServiceFactory } from \"../../auth/background/service-factories/auth-service.factory\";\nimport { Account } from \"../../models/account\";\nimport { stateServiceFactory } from \"../../platform/background/service-factories/state-service.factory\";\nimport { BrowserStateService } from \"../../platform/services/abstractions/browser-state.service\";\nimport IconDetails from \"../../vault/background/models/icon-details\";\nimport { cipherServiceFactory } from \"../../vault/background/service_factories/cipher-service.factory\";\nimport { BrowserApi } from \"../browser/browser-api\";\nimport BrowserPlatformUtilsService from \"../services/browser-platform-utils.service\";\n\nexport type BadgeOptions = {\n  tab?: chrome.tabs.Tab;\n  windowId?: number;\n};\n\nexport class UpdateBadge {\n  private authService: AuthService;\n  private stateService: BrowserStateService;\n  private cipherService: CipherService;\n  private badgeAction: typeof chrome.action | typeof chrome.browserAction;\n  private sidebarAction: OperaSidebarAction | FirefoxSidebarAction;\n  private inited = false;\n  private win: Window & typeof globalThis;\n\n  private static readonly listenedToCommands = [\n    \"updateBadge\",\n    \"loggedIn\",\n    \"unlocked\",\n    \"syncCompleted\",\n    \"bgUpdateContextMenu\",\n    \"editedCipher\",\n    \"addedCipher\",\n    \"deletedCipher\",\n  ];\n\n  static async windowsOnFocusChangedListener(\n    windowId: number,\n    serviceCache: Record<string, unknown>,\n  ) {\n    await new UpdateBadge(self).run({ windowId, existingServices: serviceCache });\n  }\n\n  static async tabsOnActivatedListener(\n    activeInfo: chrome.tabs.TabActiveInfo,\n    serviceCache: Record<string, unknown>,\n  ) {\n    await new UpdateBadge(self).run({\n      tabId: activeInfo.tabId,\n      existingServices: serviceCache,\n      windowId: activeInfo.windowId,\n    });\n  }\n\n  static async tabsOnReplacedListener(\n    addedTabId: number,\n    removedTabId: number,\n    serviceCache: Record<string, unknown>,\n  ) {\n    await new UpdateBadge(self).run({ tabId: addedTabId, existingServices: serviceCache });\n  }\n\n  static async tabsOnUpdatedListener(\n    tabId: number,\n    changeInfo: chrome.tabs.TabChangeInfo,\n    tab: chrome.tabs.Tab,\n    serviceCache: Record<string, unknown>,\n  ) {\n    await new UpdateBadge(self).run({\n      tabId,\n      existingServices: serviceCache,\n      windowId: tab.windowId,\n    });\n  }\n\n  static async messageListener(\n    message: { command: string; tabId: number },\n    serviceCache: Record<string, unknown>,\n  ) {\n    if (!UpdateBadge.listenedToCommands.includes(message.command)) {\n      return;\n    }\n\n    await new UpdateBadge(self).run({ existingServices: serviceCache });\n  }\n\n  constructor(win: Window & typeof globalThis) {\n    this.badgeAction = BrowserApi.getBrowserAction();\n    this.sidebarAction = BrowserApi.getSidebarAction(self);\n    this.win = win;\n  }\n\n  async run(opts?: {\n    tabId?: number;\n    windowId?: number;\n    existingServices?: Record<string, unknown>;\n  }): Promise<void> {\n    await this.initServices(opts?.existingServices);\n\n    const authStatus = await this.authService.getAuthStatus();\n\n    await this.setBadgeBackgroundColor();\n\n    switch (authStatus) {\n      case AuthenticationStatus.LoggedOut: {\n        await this.setLoggedOut();\n        break;\n      }\n      case AuthenticationStatus.Locked: {\n        await this.setLocked();\n        break;\n      }\n      case AuthenticationStatus.Unlocked: {\n        const tab = await this.getTab(opts?.tabId, opts?.windowId);\n        await this.setUnlocked({ tab, windowId: tab?.windowId });\n        break;\n      }\n    }\n  }\n\n  async setLoggedOut(): Promise<void> {\n    await this.setBadgeIcon(\"_gray\");\n    await this.clearBadgeText();\n  }\n\n  async setLocked() {\n    await this.setBadgeIcon(\"_locked\");\n    await this.clearBadgeText();\n  }\n\n  private async clearBadgeText() {\n    const tabs = await BrowserApi.getActiveTabs();\n    if (tabs != null) {\n      tabs.forEach(async (tab) => {\n        if (tab.id != null) {\n          await this.setBadgeText(\"\", tab.id);\n        }\n      });\n    }\n  }\n\n  async setUnlocked(opts: BadgeOptions) {\n    await this.initServices();\n\n    await this.setBadgeIcon(\"\");\n\n    const disableBadgeCounter = await this.stateService.getDisableBadgeCounter();\n    if (disableBadgeCounter) {\n      return;\n    }\n\n    const ciphers = await this.cipherService.getAllDecryptedForUrl(opts?.tab?.url);\n    let countText = ciphers.length == 0 ? \"\" : ciphers.length.toString();\n    if (ciphers.length > 9) {\n      countText = \"9+\";\n    }\n    await this.setBadgeText(countText, opts?.tab?.id);\n  }\n\n  setBadgeBackgroundColor(color = \"#294e5f\") {\n    if (this.badgeAction?.setBadgeBackgroundColor) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.badgeAction.setBadgeBackgroundColor({ color });\n    }\n    if (this.isOperaSidebar(this.sidebarAction)) {\n      this.sidebarAction.setBadgeBackgroundColor({ color });\n    }\n  }\n\n  setBadgeText(text: string, tabId?: number) {\n    this.setActionText(text, tabId);\n    this.setSideBarText(text, tabId);\n  }\n\n  async setBadgeIcon(iconSuffix: string, windowId?: number) {\n    const options: IconDetails = {\n      path: {\n        19: \"/images/icon19\" + iconSuffix + \".png\",\n        38: \"/images/icon38\" + iconSuffix + \".png\",\n      },\n    };\n    if (windowId && BrowserPlatformUtilsService.isFirefox()) {\n      options.windowId = windowId;\n    }\n\n    await this.setActionIcon(options);\n    await this.setSidebarActionIcon(options);\n  }\n\n  private setActionText(text: string, tabId?: number) {\n    if (this.badgeAction?.setBadgeText) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.badgeAction.setBadgeText({ text, tabId });\n    }\n  }\n\n  private setSideBarText(text: string, tabId?: number) {\n    if (this.isOperaSidebar(this.sidebarAction)) {\n      this.sidebarAction.setBadgeText({ text, tabId });\n    } else if (this.sidebarAction) {\n      // Firefox\n      const title = `Bitwarden${Utils.isNullOrEmpty(text) ? \"\" : ` [${text}]`}`;\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.sidebarAction.setTitle({ title, tabId });\n    }\n  }\n\n  private async setActionIcon(options: IconDetails) {\n    if (!this.badgeAction?.setIcon) {\n      return;\n    }\n\n    if (this.useSyncApiCalls) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.badgeAction.setIcon(options);\n    } else {\n      await new Promise<void>((resolve) => this.badgeAction.setIcon(options, () => resolve()));\n    }\n  }\n\n  private async setSidebarActionIcon(options: IconDetails) {\n    if (!this.sidebarAction?.setIcon) {\n      return;\n    }\n\n    if (this.isOperaSidebar(this.sidebarAction)) {\n      await new Promise<void>((resolve) =>\n        (this.sidebarAction as OperaSidebarAction).setIcon(options, () => resolve()),\n      );\n    } else {\n      await this.sidebarAction.setIcon(options);\n    }\n  }\n\n  private async getTab(tabId?: number, windowId?: number) {\n    return (\n      (await BrowserApi.getTab(tabId)) ??\n      (windowId\n        ? await BrowserApi.tabsQueryFirst({ active: true, windowId })\n        : await BrowserApi.tabsQueryFirst({ active: true, currentWindow: true })) ??\n      (await BrowserApi.tabsQueryFirst({ active: true, lastFocusedWindow: true })) ??\n      (await BrowserApi.tabsQueryFirst({ active: true }))\n    );\n  }\n\n  private get useSyncApiCalls() {\n    return (\n      BrowserPlatformUtilsService.isFirefox() || BrowserPlatformUtilsService.isSafari(this.win)\n    );\n  }\n\n  private async initServices(existingServiceCache?: Record<string, unknown>): Promise<UpdateBadge> {\n    if (this.inited) {\n      return this;\n    }\n\n    const serviceCache: Record<string, unknown> = existingServiceCache || {};\n    const opts = {\n      cryptoFunctionServiceOptions: { win: self },\n      encryptServiceOptions: { logMacFailures: false },\n      logServiceOptions: { isDev: false },\n      platformUtilsServiceOptions: {\n        clipboardWriteCallback: (clipboardValue: string, clearMs: number) =>\n          Promise.reject(\"not implemented\"),\n        biometricCallback: () => Promise.reject(\"not implemented\"),\n        win: self,\n      },\n      stateServiceOptions: {\n        stateFactory: new StateFactory(GlobalState, Account),\n      },\n      apiServiceOptions: {\n        logoutCallback: () => Promise.reject(\"not implemented\"),\n      },\n      keyConnectorServiceOptions: {\n        logoutCallback: () => Promise.reject(\"not implemented\"),\n      },\n      i18nServiceOptions: {\n        systemLanguage: BrowserApi.getUILanguage(),\n      },\n    };\n    this.stateService = await stateServiceFactory(serviceCache, opts);\n    this.authService = await authServiceFactory(serviceCache, opts);\n    this.cipherService = await cipherServiceFactory(serviceCache, opts);\n\n    // Needed for cipher decryption\n    if (!self.bitwardenContainerService) {\n      new ContainerService(\n        serviceCache.cryptoService as CryptoService,\n        serviceCache.encryptService as EncryptService,\n      ).attachToGlobal(self);\n    }\n\n    this.inited = true;\n\n    return this;\n  }\n\n  private isOperaSidebar(\n    action: OperaSidebarAction | FirefoxSidebarAction,\n  ): action is OperaSidebarAction {\n    return action != null && (action as OperaSidebarAction).setBadgeText != null;\n  }\n}\n","import { Observable } from \"rxjs\";\n\nimport { OrganizationData } from \"../../admin-console/models/data/organization.data\";\nimport { PolicyData } from \"../../admin-console/models/data/policy.data\";\nimport { ProviderData } from \"../../admin-console/models/data/provider.data\";\nimport { Policy } from \"../../admin-console/models/domain/policy\";\nimport { AdminAuthRequestStorable } from \"../../auth/models/domain/admin-auth-req-storable\";\nimport { ForceSetPasswordReason } from \"../../auth/models/domain/force-set-password-reason\";\nimport { KdfConfig } from \"../../auth/models/domain/kdf-config\";\nimport { BiometricKey } from \"../../auth/types/biometric-key\";\nimport { EventData } from \"../../models/data/event.data\";\nimport { WindowState } from \"../../models/domain/window-state\";\nimport { GeneratorOptions } from \"../../tools/generator/generator-options\";\nimport { GeneratedPasswordHistory, PasswordGeneratorOptions } from \"../../tools/generator/password\";\nimport { UsernameGeneratorOptions } from \"../../tools/generator/username\";\nimport { SendData } from \"../../tools/send/models/data/send.data\";\nimport { SendView } from \"../../tools/send/models/view/send.view\";\nimport { UserId } from \"../../types/guid\";\nimport { DeviceKey, MasterKey } from \"../../types/key\";\nimport { UriMatchType } from \"../../vault/enums\";\nimport { CipherData } from \"../../vault/models/data/cipher.data\";\nimport { LocalData } from \"../../vault/models/data/local.data\";\nimport { CipherView } from \"../../vault/models/view/cipher.view\";\nimport { AddEditCipherInfo } from \"../../vault/types/add-edit-cipher-info\";\nimport { KdfType, ThemeType } from \"../enums\";\nimport { ServerConfigData } from \"../models/data/server-config.data\";\nimport {\n  Account,\n  AccountDecryptionOptions,\n  AccountSettingsSettings,\n} from \"../models/domain/account\";\nimport { EncString } from \"../models/domain/enc-string\";\nimport { StorageOptions } from \"../models/domain/storage-options\";\nimport { SymmetricCryptoKey } from \"../models/domain/symmetric-crypto-key\";\n\n/**\n * Options for customizing the initiation behavior.\n */\nexport type InitOptions = {\n  /**\n   * Whether or not to run state migrations as part of the init process. Defaults to true.\n   *\n   * If false, the init method will instead wait for migrations to complete before doing its\n   * other init operations. Make sure migrations have either already completed, or will complete\n   * before calling {@link StateService.init} with `runMigrations: false`.\n   */\n  runMigrations?: boolean;\n};\n\nexport abstract class StateService<T extends Account = Account> {\n  accounts$: Observable<{ [userId: string]: T }>;\n  activeAccount$: Observable<string>;\n  /**\n   * @deprecated use accountService.activeAccount$ instead\n   */\n  activeAccountUnlocked$: Observable<boolean>;\n\n  addAccount: (account: T) => Promise<void>;\n  setActiveUser: (userId: string) => Promise<void>;\n  clean: (options?: StorageOptions) => Promise<UserId>;\n  init: (initOptions?: InitOptions) => Promise<void>;\n\n  getAccessToken: (options?: StorageOptions) => Promise<string>;\n  setAccessToken: (value: string, options?: StorageOptions) => Promise<void>;\n  getAddEditCipherInfo: (options?: StorageOptions) => Promise<AddEditCipherInfo>;\n  setAddEditCipherInfo: (value: AddEditCipherInfo, options?: StorageOptions) => Promise<void>;\n  getAlwaysShowDock: (options?: StorageOptions) => Promise<boolean>;\n  setAlwaysShowDock: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getApiKeyClientId: (options?: StorageOptions) => Promise<string>;\n  setApiKeyClientId: (value: string, options?: StorageOptions) => Promise<void>;\n  getApiKeyClientSecret: (options?: StorageOptions) => Promise<string>;\n  setApiKeyClientSecret: (value: string, options?: StorageOptions) => Promise<void>;\n  getAutoConfirmFingerPrints: (options?: StorageOptions) => Promise<boolean>;\n  setAutoConfirmFingerprints: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getBiometricFingerprintValidated: (options?: StorageOptions) => Promise<boolean>;\n  setBiometricFingerprintValidated: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getBiometricUnlock: (options?: StorageOptions) => Promise<boolean>;\n  setBiometricUnlock: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getCanAccessPremium: (options?: StorageOptions) => Promise<boolean>;\n  getHasPremiumPersonally: (options?: StorageOptions) => Promise<boolean>;\n  setHasPremiumPersonally: (value: boolean, options?: StorageOptions) => Promise<void>;\n  setHasPremiumFromOrganization: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getHasPremiumFromOrganization: (options?: StorageOptions) => Promise<boolean>;\n  getConvertAccountToKeyConnector: (options?: StorageOptions) => Promise<boolean>;\n  setConvertAccountToKeyConnector: (value: boolean, options?: StorageOptions) => Promise<void>;\n  /**\n   * Gets the user's master key\n   */\n  getMasterKey: (options?: StorageOptions) => Promise<MasterKey>;\n  /**\n   * Sets the user's master key\n   */\n  setMasterKey: (value: MasterKey, options?: StorageOptions) => Promise<void>;\n  /**\n   * Gets the user key encrypted by the master key\n   */\n  getMasterKeyEncryptedUserKey: (options?: StorageOptions) => Promise<string>;\n  /**\n   * Sets the user key encrypted by the master key\n   */\n  setMasterKeyEncryptedUserKey: (value: string, options?: StorageOptions) => Promise<void>;\n  /**\n   * Gets the user's auto key\n   */\n  getUserKeyAutoUnlock: (options?: StorageOptions) => Promise<string>;\n  /**\n   * Sets the user's auto key\n   */\n  setUserKeyAutoUnlock: (value: string, options?: StorageOptions) => Promise<void>;\n  /**\n   * Gets the user's biometric key\n   */\n  getUserKeyBiometric: (options?: StorageOptions) => Promise<string>;\n  /**\n   * Checks if the user has a biometric key available\n   */\n  hasUserKeyBiometric: (options?: StorageOptions) => Promise<boolean>;\n  /**\n   * Sets the user's biometric key\n   */\n  setUserKeyBiometric: (value: BiometricKey, options?: StorageOptions) => Promise<void>;\n  /**\n   * Gets the user key encrypted by the Pin key.\n   * Used when Lock with MP on Restart is disabled\n   */\n  getPinKeyEncryptedUserKey: (options?: StorageOptions) => Promise<EncString>;\n  /**\n   * Sets the user key encrypted by the Pin key.\n   * Used when Lock with MP on Restart is disabled\n   */\n  setPinKeyEncryptedUserKey: (value: EncString, options?: StorageOptions) => Promise<void>;\n  /**\n   * Gets the ephemeral version of the user key encrypted by the Pin key.\n   * Used when Lock with MP on Restart is enabled\n   */\n  getPinKeyEncryptedUserKeyEphemeral: (options?: StorageOptions) => Promise<EncString>;\n  /**\n   * Sets the ephemeral version of the user key encrypted by the Pin key.\n   * Used when Lock with MP on Restart is enabled\n   */\n  setPinKeyEncryptedUserKeyEphemeral: (value: EncString, options?: StorageOptions) => Promise<void>;\n  /**\n   * @deprecated For migration purposes only, use getUserKeyMasterKey instead\n   */\n  getEncryptedCryptoSymmetricKey: (options?: StorageOptions) => Promise<string>;\n  /**\n   * @deprecated For legacy purposes only, use getMasterKey instead\n   */\n  getCryptoMasterKey: (options?: StorageOptions) => Promise<SymmetricCryptoKey>;\n  /**\n   * @deprecated For migration purposes only, use getUserKeyAuto instead\n   */\n  getCryptoMasterKeyAuto: (options?: StorageOptions) => Promise<string>;\n  /**\n   * @deprecated For migration purposes only, use setUserKeyAuto instead\n   */\n  setCryptoMasterKeyAuto: (value: string, options?: StorageOptions) => Promise<void>;\n  /**\n   * @deprecated For migration purposes only, use getUserKeyBiometric instead\n   */\n  getCryptoMasterKeyBiometric: (options?: StorageOptions) => Promise<string>;\n  /**\n   * @deprecated For migration purposes only, use hasUserKeyBiometric instead\n   */\n  hasCryptoMasterKeyBiometric: (options?: StorageOptions) => Promise<boolean>;\n  /**\n   * @deprecated For migration purposes only, use setUserKeyBiometric instead\n   */\n  setCryptoMasterKeyBiometric: (value: BiometricKey, options?: StorageOptions) => Promise<void>;\n  getDecryptedCiphers: (options?: StorageOptions) => Promise<CipherView[]>;\n  setDecryptedCiphers: (value: CipherView[], options?: StorageOptions) => Promise<void>;\n  getDecryptedPasswordGenerationHistory: (\n    options?: StorageOptions,\n  ) => Promise<GeneratedPasswordHistory[]>;\n  setDecryptedPasswordGenerationHistory: (\n    value: GeneratedPasswordHistory[],\n    options?: StorageOptions,\n  ) => Promise<void>;\n  /**\n   * @deprecated For migration purposes only, use getDecryptedUserKeyPin instead\n   */\n  getDecryptedPinProtected: (options?: StorageOptions) => Promise<EncString>;\n  /**\n   * @deprecated For migration purposes only, use setDecryptedUserKeyPin instead\n   */\n  setDecryptedPinProtected: (value: EncString, options?: StorageOptions) => Promise<void>;\n  /**\n   * @deprecated Do not call this, use PolicyService\n   */\n  getDecryptedPolicies: (options?: StorageOptions) => Promise<Policy[]>;\n  /**\n   * @deprecated Do not call this, use PolicyService\n   */\n  setDecryptedPolicies: (value: Policy[], options?: StorageOptions) => Promise<void>;\n  /**\n   * @deprecated Do not call this directly, use SendService\n   */\n  getDecryptedSends: (options?: StorageOptions) => Promise<SendView[]>;\n  /**\n   * @deprecated Do not call this directly, use SendService\n   */\n  setDecryptedSends: (value: SendView[], options?: StorageOptions) => Promise<void>;\n  getDefaultUriMatch: (options?: StorageOptions) => Promise<UriMatchType>;\n  setDefaultUriMatch: (value: UriMatchType, options?: StorageOptions) => Promise<void>;\n  getDisableAddLoginNotification: (options?: StorageOptions) => Promise<boolean>;\n  setDisableAddLoginNotification: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getDisableBadgeCounter: (options?: StorageOptions) => Promise<boolean>;\n  setDisableBadgeCounter: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getDisableChangedPasswordNotification: (options?: StorageOptions) => Promise<boolean>;\n  setDisableChangedPasswordNotification: (\n    value: boolean,\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getDisableContextMenuItem: (options?: StorageOptions) => Promise<boolean>;\n  setDisableContextMenuItem: (value: boolean, options?: StorageOptions) => Promise<void>;\n  /**\n   * @deprecated Do not call this, use SettingsService\n   */\n  getDisableFavicon: (options?: StorageOptions) => Promise<boolean>;\n  /**\n   * @deprecated Do not call this, use SettingsService\n   */\n  setDisableFavicon: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getDisableGa: (options?: StorageOptions) => Promise<boolean>;\n  setDisableGa: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getDontShowCardsCurrentTab: (options?: StorageOptions) => Promise<boolean>;\n  setDontShowCardsCurrentTab: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getDontShowIdentitiesCurrentTab: (options?: StorageOptions) => Promise<boolean>;\n  setDontShowIdentitiesCurrentTab: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getDuckDuckGoSharedKey: (options?: StorageOptions) => Promise<string>;\n  setDuckDuckGoSharedKey: (value: string, options?: StorageOptions) => Promise<void>;\n  getDeviceKey: (options?: StorageOptions) => Promise<DeviceKey | null>;\n  setDeviceKey: (value: DeviceKey | null, options?: StorageOptions) => Promise<void>;\n  getAdminAuthRequest: (options?: StorageOptions) => Promise<AdminAuthRequestStorable | null>;\n  setAdminAuthRequest: (\n    adminAuthRequest: AdminAuthRequestStorable,\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getShouldTrustDevice: (options?: StorageOptions) => Promise<boolean | null>;\n  setShouldTrustDevice: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getAccountDecryptionOptions: (\n    options?: StorageOptions,\n  ) => Promise<AccountDecryptionOptions | null>;\n  setAccountDecryptionOptions: (\n    value: AccountDecryptionOptions,\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getEmail: (options?: StorageOptions) => Promise<string>;\n  setEmail: (value: string, options?: StorageOptions) => Promise<void>;\n  getEmailVerified: (options?: StorageOptions) => Promise<boolean>;\n  setEmailVerified: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getEnableAlwaysOnTop: (options?: StorageOptions) => Promise<boolean>;\n  setEnableAlwaysOnTop: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getEnableBrowserIntegration: (options?: StorageOptions) => Promise<boolean>;\n  setEnableBrowserIntegration: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getEnableBrowserIntegrationFingerprint: (options?: StorageOptions) => Promise<boolean>;\n  setEnableBrowserIntegrationFingerprint: (\n    value: boolean,\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getEnableCloseToTray: (options?: StorageOptions) => Promise<boolean>;\n  setEnableCloseToTray: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getEnableDuckDuckGoBrowserIntegration: (options?: StorageOptions) => Promise<boolean>;\n  setEnableDuckDuckGoBrowserIntegration: (\n    value: boolean,\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getEnableMinimizeToTray: (options?: StorageOptions) => Promise<boolean>;\n  setEnableMinimizeToTray: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getEnableStartToTray: (options?: StorageOptions) => Promise<boolean>;\n  setEnableStartToTray: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getEnableTray: (options?: StorageOptions) => Promise<boolean>;\n  setEnableTray: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getEncryptedCiphers: (options?: StorageOptions) => Promise<{ [id: string]: CipherData }>;\n  setEncryptedCiphers: (\n    value: { [id: string]: CipherData },\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getEncryptedPasswordGenerationHistory: (\n    options?: StorageOptions,\n  ) => Promise<GeneratedPasswordHistory[]>;\n  setEncryptedPasswordGenerationHistory: (\n    value: GeneratedPasswordHistory[],\n    options?: StorageOptions,\n  ) => Promise<void>;\n  /**\n   * @deprecated For migration purposes only, use getEncryptedUserKeyPin instead\n   */\n  getEncryptedPinProtected: (options?: StorageOptions) => Promise<string>;\n  /**\n   * @deprecated For migration purposes only, use setEncryptedUserKeyPin instead\n   */\n  setEncryptedPinProtected: (value: string, options?: StorageOptions) => Promise<void>;\n  /**\n   * @deprecated Do not call this directly, use PolicyService\n   */\n  getEncryptedPolicies: (options?: StorageOptions) => Promise<{ [id: string]: PolicyData }>;\n  /**\n   * @deprecated Do not call this directly, use PolicyService\n   */\n  setEncryptedPolicies: (\n    value: { [id: string]: PolicyData },\n    options?: StorageOptions,\n  ) => Promise<void>;\n  /**\n   * @deprecated Do not call this directly, use SendService\n   */\n  getEncryptedSends: (options?: StorageOptions) => Promise<{ [id: string]: SendData }>;\n  /**\n   * @deprecated Do not call this directly, use SendService\n   */\n  setEncryptedSends: (value: { [id: string]: SendData }, options?: StorageOptions) => Promise<void>;\n  getEquivalentDomains: (options?: StorageOptions) => Promise<string[][]>;\n  setEquivalentDomains: (value: string, options?: StorageOptions) => Promise<void>;\n  getEventCollection: (options?: StorageOptions) => Promise<EventData[]>;\n  setEventCollection: (value: EventData[], options?: StorageOptions) => Promise<void>;\n  getEverBeenUnlocked: (options?: StorageOptions) => Promise<boolean>;\n  setEverBeenUnlocked: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getForceSetPasswordReason: (options?: StorageOptions) => Promise<ForceSetPasswordReason>;\n  setForceSetPasswordReason: (\n    value: ForceSetPasswordReason,\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getInstalledVersion: (options?: StorageOptions) => Promise<string>;\n  setInstalledVersion: (value: string, options?: StorageOptions) => Promise<void>;\n  getIsAuthenticated: (options?: StorageOptions) => Promise<boolean>;\n  getKdfConfig: (options?: StorageOptions) => Promise<KdfConfig>;\n  setKdfConfig: (kdfConfig: KdfConfig, options?: StorageOptions) => Promise<void>;\n  getKdfType: (options?: StorageOptions) => Promise<KdfType>;\n  setKdfType: (value: KdfType, options?: StorageOptions) => Promise<void>;\n  getKeyHash: (options?: StorageOptions) => Promise<string>;\n  setKeyHash: (value: string, options?: StorageOptions) => Promise<void>;\n  getLastActive: (options?: StorageOptions) => Promise<number>;\n  setLastActive: (value: number, options?: StorageOptions) => Promise<void>;\n  getLastSync: (options?: StorageOptions) => Promise<string>;\n  setLastSync: (value: string, options?: StorageOptions) => Promise<void>;\n  getLocalData: (options?: StorageOptions) => Promise<{ [cipherId: string]: LocalData }>;\n  setLocalData: (\n    value: { [cipherId: string]: LocalData },\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getLocale: (options?: StorageOptions) => Promise<string>;\n  setLocale: (value: string, options?: StorageOptions) => Promise<void>;\n  getMainWindowSize: (options?: StorageOptions) => Promise<number>;\n  setMainWindowSize: (value: number, options?: StorageOptions) => Promise<void>;\n  getMinimizeOnCopyToClipboard: (options?: StorageOptions) => Promise<boolean>;\n  setMinimizeOnCopyToClipboard: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getNeverDomains: (options?: StorageOptions) => Promise<{ [id: string]: unknown }>;\n  setNeverDomains: (value: { [id: string]: unknown }, options?: StorageOptions) => Promise<void>;\n  getOpenAtLogin: (options?: StorageOptions) => Promise<boolean>;\n  setOpenAtLogin: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getOrganizationInvitation: (options?: StorageOptions) => Promise<any>;\n  setOrganizationInvitation: (value: any, options?: StorageOptions) => Promise<void>;\n  /**\n   * @deprecated Do not call this directly, use OrganizationService\n   */\n  getOrganizations: (options?: StorageOptions) => Promise<{ [id: string]: OrganizationData }>;\n  /**\n   * @deprecated Do not call this directly, use OrganizationService\n   */\n  setOrganizations: (\n    value: { [id: string]: OrganizationData },\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getPasswordGenerationOptions: (options?: StorageOptions) => Promise<PasswordGeneratorOptions>;\n  setPasswordGenerationOptions: (\n    value: PasswordGeneratorOptions,\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getUsernameGenerationOptions: (options?: StorageOptions) => Promise<UsernameGeneratorOptions>;\n  setUsernameGenerationOptions: (\n    value: UsernameGeneratorOptions,\n    options?: StorageOptions,\n  ) => Promise<void>;\n  getGeneratorOptions: (options?: StorageOptions) => Promise<GeneratorOptions>;\n  setGeneratorOptions: (value: GeneratorOptions, options?: StorageOptions) => Promise<void>;\n  /**\n   * Gets the user's Pin, encrypted by the user key\n   */\n  getProtectedPin: (options?: StorageOptions) => Promise<string>;\n  /**\n   * Sets the user's Pin, encrypted by the user key\n   */\n  setProtectedPin: (value: string, options?: StorageOptions) => Promise<void>;\n  getProviders: (options?: StorageOptions) => Promise<{ [id: string]: ProviderData }>;\n  setProviders: (value: { [id: string]: ProviderData }, options?: StorageOptions) => Promise<void>;\n  getRefreshToken: (options?: StorageOptions) => Promise<string>;\n  setRefreshToken: (value: string, options?: StorageOptions) => Promise<void>;\n  getRememberedEmail: (options?: StorageOptions) => Promise<string>;\n  setRememberedEmail: (value: string, options?: StorageOptions) => Promise<void>;\n  getSecurityStamp: (options?: StorageOptions) => Promise<string>;\n  setSecurityStamp: (value: string, options?: StorageOptions) => Promise<void>;\n  /**\n   * @deprecated Do not call this directly, use SettingsService\n   */\n  getSettings: (options?: StorageOptions) => Promise<AccountSettingsSettings>;\n  /**\n   * @deprecated Do not call this directly, use SettingsService\n   */\n  setSettings: (value: AccountSettingsSettings, options?: StorageOptions) => Promise<void>;\n  getTheme: (options?: StorageOptions) => Promise<ThemeType>;\n  setTheme: (value: ThemeType, options?: StorageOptions) => Promise<void>;\n  getTwoFactorToken: (options?: StorageOptions) => Promise<string>;\n  setTwoFactorToken: (value: string, options?: StorageOptions) => Promise<void>;\n  getUserId: (options?: StorageOptions) => Promise<string>;\n  getUsesKeyConnector: (options?: StorageOptions) => Promise<boolean>;\n  setUsesKeyConnector: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getVaultTimeout: (options?: StorageOptions) => Promise<number>;\n  setVaultTimeout: (value: number, options?: StorageOptions) => Promise<void>;\n  getVaultTimeoutAction: (options?: StorageOptions) => Promise<string>;\n  setVaultTimeoutAction: (value: string, options?: StorageOptions) => Promise<void>;\n  getApproveLoginRequests: (options?: StorageOptions) => Promise<boolean>;\n  setApproveLoginRequests: (value: boolean, options?: StorageOptions) => Promise<void>;\n  getWindow: () => Promise<WindowState>;\n  setWindow: (value: WindowState) => Promise<void>;\n  /**\n   * @deprecated Do not call this directly, use ConfigService\n   */\n  getServerConfig: (options?: StorageOptions) => Promise<ServerConfigData>;\n  /**\n   * @deprecated Do not call this directly, use ConfigService\n   */\n  setServerConfig: (value: ServerConfigData, options?: StorageOptions) => Promise<void>;\n\n  getAvatarColor: (options?: StorageOptions) => Promise<string | null | undefined>;\n  setAvatarColor: (value: string, options?: StorageOptions) => Promise<void>;\n  /**\n   * fetches string value of URL user tried to navigate to while unauthenticated.\n   * @param options Defines the storage options for the URL; Defaults to session Storage.\n   * @returns route called prior to successful login.\n   */\n  getDeepLinkRedirectUrl: (options?: StorageOptions) => Promise<string>;\n  /**\n   * Store URL in session storage by default, but can be configured. Developed to handle\n   * unauthN interrupted navigation.\n   * @param url URL of route\n   * @param options Defines the storage options for the URL; Defaults to session Storage.\n   */\n  setDeepLinkRedirectUrl: (url: string, options?: StorageOptions) => Promise<void>;\n  nextUpActiveUser: () => Promise<UserId>;\n}\n","import { ReplaySubject } from \"rxjs\";\n\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { ConfigApiServiceAbstraction } from \"@bitwarden/common/platform/abstractions/config/config-api.service.abstraction\";\nimport { ServerConfig } from \"@bitwarden/common/platform/abstractions/config/server-config\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { ConfigService } from \"@bitwarden/common/platform/services/config/config.service\";\n\nimport { browserSession, sessionSync } from \"../decorators/session-sync-observable\";\n\n@browserSession\nexport class BrowserConfigService extends ConfigService {\n  @sessionSync<ServerConfig>({ initializer: ServerConfig.fromJSON })\n  protected _serverConfig: ReplaySubject<ServerConfig | null>;\n\n  constructor(\n    stateService: StateService,\n    configApiService: ConfigApiServiceAbstraction,\n    authService: AuthService,\n    environmentService: EnvironmentService,\n    logService: LogService,\n    subscribe = false,\n  ) {\n    super(stateService, configApiService, authService, environmentService, logService, subscribe);\n  }\n}\n","import { ServerConfigResponse } from \"../../models/response/server-config.response\";\n\nexport abstract class ConfigApiServiceAbstraction {\n  get: () => Promise<ServerConfigResponse>;\n}\n","import { AuthenticationStatus } from \"../enums/authentication-status\";\n\nexport abstract class AuthService {\n  getAuthStatus: (userId?: string) => Promise<AuthenticationStatus>;\n  logOut: (callback: () => void) => void;\n}\n","import { ReplaySubject } from \"rxjs\";\n\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\n\nimport { browserSession, sessionSync } from \"../decorators/session-sync-observable\";\n\nimport I18nService from \"./i18n.service\";\n\n@browserSession\nexport class BrowserI18nService extends I18nService {\n  @sessionSync({ initializer: (s: string) => s })\n  protected _locale: ReplaySubject<string>;\n\n  constructor(\n    systemLanguage: string,\n    private stateService: StateService,\n  ) {\n    super(systemLanguage);\n  }\n}\n","import { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\n\nexport default class BrowserMessagingPrivateModeBackgroundService implements MessagingService {\n  send(subscriber: string, arg: any = {}) {\n    const message = Object.assign({}, { command: subscriber }, arg);\n    (window as any).bitwardenPopupMainMessageListener(message);\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../../platform/models/domain/symmetric-crypto-key\";\nimport { SendFileData } from \"../data/send-file.data\";\nimport { SendFileView } from \"../view/send-file.view\";\n\nexport class SendFile extends Domain {\n  id: string;\n  size: string;\n  sizeName: string;\n  fileName: EncString;\n\n  constructor(obj?: SendFileData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.size = obj.size;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        sizeName: null,\n        fileName: null,\n      },\n      [\"id\", \"sizeName\"],\n    );\n  }\n\n  async decrypt(key: SymmetricCryptoKey): Promise<SendFileView> {\n    const view = await this.decryptObj(\n      new SendFileView(this),\n      {\n        fileName: null,\n      },\n      null,\n      key,\n    );\n    return view;\n  }\n\n  static fromJSON(obj: Jsonify<SendFile>) {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new SendFile(), obj, {\n      fileName: EncString.fromJSON(obj.fileName),\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport Domain from \"../../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../../platform/models/domain/symmetric-crypto-key\";\nimport { SendTextData } from \"../data/send-text.data\";\nimport { SendTextView } from \"../view/send-text.view\";\n\nexport class SendText extends Domain {\n  text: EncString;\n  hidden: boolean;\n\n  constructor(obj?: SendTextData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.hidden = obj.hidden;\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        text: null,\n      },\n      [],\n    );\n  }\n\n  decrypt(key: SymmetricCryptoKey): Promise<SendTextView> {\n    return this.decryptObj(\n      new SendTextView(this),\n      {\n        text: null,\n      },\n      null,\n      key,\n    );\n  }\n\n  static fromJSON(obj: Jsonify<SendText>) {\n    if (obj == null) {\n      return null;\n    }\n\n    return Object.assign(new SendText(), obj, {\n      text: EncString.fromJSON(obj.text),\n    });\n  }\n}\n","import { Jsonify } from \"type-fest\";\n\nimport { Utils } from \"../../../../platform/misc/utils\";\nimport Domain from \"../../../../platform/models/domain/domain-base\";\nimport { EncString } from \"../../../../platform/models/domain/enc-string\";\nimport { SendType } from \"../../enums/send-type\";\nimport { SendData } from \"../data/send.data\";\nimport { SendView } from \"../view/send.view\";\n\nimport { SendFile } from \"./send-file\";\nimport { SendText } from \"./send-text\";\n\nexport class Send extends Domain {\n  id: string;\n  accessId: string;\n  type: SendType;\n  name: EncString;\n  notes: EncString;\n  file: SendFile;\n  text: SendText;\n  key: EncString;\n  maxAccessCount?: number;\n  accessCount: number;\n  revisionDate: Date;\n  expirationDate: Date;\n  deletionDate: Date;\n  password: string;\n  disabled: boolean;\n  hideEmail: boolean;\n\n  constructor(obj?: SendData) {\n    super();\n    if (obj == null) {\n      return;\n    }\n\n    this.buildDomainModel(\n      this,\n      obj,\n      {\n        id: null,\n        accessId: null,\n        name: null,\n        notes: null,\n        key: null,\n      },\n      [\"id\", \"accessId\"],\n    );\n\n    this.type = obj.type;\n    this.maxAccessCount = obj.maxAccessCount;\n    this.accessCount = obj.accessCount;\n    this.password = obj.password;\n    this.disabled = obj.disabled;\n    this.revisionDate = obj.revisionDate != null ? new Date(obj.revisionDate) : null;\n    this.deletionDate = obj.deletionDate != null ? new Date(obj.deletionDate) : null;\n    this.expirationDate = obj.expirationDate != null ? new Date(obj.expirationDate) : null;\n    this.hideEmail = obj.hideEmail;\n\n    switch (this.type) {\n      case SendType.Text:\n        this.text = new SendText(obj.text);\n        break;\n      case SendType.File:\n        this.file = new SendFile(obj.file);\n        break;\n      default:\n        break;\n    }\n  }\n\n  async decrypt(): Promise<SendView> {\n    const model = new SendView(this);\n\n    const cryptoService = Utils.getContainerService().getCryptoService();\n\n    try {\n      model.key = await cryptoService.decryptToBytes(this.key, null);\n      model.cryptoKey = await cryptoService.makeSendKey(model.key);\n    } catch (e) {\n      // TODO: error?\n    }\n\n    await this.decryptObj(\n      model,\n      {\n        name: null,\n        notes: null,\n      },\n      null,\n      model.cryptoKey,\n    );\n\n    switch (this.type) {\n      case SendType.File:\n        model.file = await this.file.decrypt(model.cryptoKey);\n        break;\n      case SendType.Text:\n        model.text = await this.text.decrypt(model.cryptoKey);\n        break;\n      default:\n        break;\n    }\n\n    return model;\n  }\n\n  static fromJSON(obj: Jsonify<Send>) {\n    if (obj == null) {\n      return null;\n    }\n\n    const revisionDate = obj.revisionDate == null ? null : new Date(obj.revisionDate);\n    const expirationDate = obj.expirationDate == null ? null : new Date(obj.expirationDate);\n    const deletionDate = obj.deletionDate == null ? null : new Date(obj.deletionDate);\n\n    return Object.assign(new Send(), obj, {\n      key: EncString.fromJSON(obj.key),\n      name: EncString.fromJSON(obj.name),\n      notes: EncString.fromJSON(obj.notes),\n      text: SendText.fromJSON(obj.text),\n      file: SendFile.fromJSON(obj.file),\n      revisionDate,\n      expirationDate,\n      deletionDate,\n    });\n  }\n}\n","import { Send } from \"../domain/send\";\n\nimport { SendRequest } from \"./send.request\";\n\nexport class SendWithIdRequest extends SendRequest {\n  id: string;\n\n  constructor(send: Send) {\n    super(send);\n    this.id = send.id;\n  }\n}\n","import { BehaviorSubject, Observable, concatMap, distinctUntilChanged, map } from \"rxjs\";\n\nimport { CryptoService } from \"../../../platform/abstractions/crypto.service\";\nimport { I18nService } from \"../../../platform/abstractions/i18n.service\";\nimport { KeyGenerationService } from \"../../../platform/abstractions/key-generation.service\";\nimport { StateService } from \"../../../platform/abstractions/state.service\";\nimport { KdfType } from \"../../../platform/enums\";\nimport { Utils } from \"../../../platform/misc/utils\";\nimport { EncArrayBuffer } from \"../../../platform/models/domain/enc-array-buffer\";\nimport { EncString } from \"../../../platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { UserKey } from \"../../../types/key\";\nimport { SendType } from \"../enums/send-type\";\nimport { SendData } from \"../models/data/send.data\";\nimport { Send } from \"../models/domain/send\";\nimport { SendFile } from \"../models/domain/send-file\";\nimport { SendText } from \"../models/domain/send-text\";\nimport { SendWithIdRequest } from \"../models/request/send-with-id.request\";\nimport { SendView } from \"../models/view/send.view\";\nimport { SEND_KDF_ITERATIONS } from \"../send-kdf\";\n\nimport { InternalSendService as InternalSendServiceAbstraction } from \"./send.service.abstraction\";\n\nexport class SendService implements InternalSendServiceAbstraction {\n  readonly sendKeySalt = \"bitwarden-send\";\n  readonly sendKeyPurpose = \"send\";\n\n  protected _sends: BehaviorSubject<Send[]> = new BehaviorSubject([]);\n  protected _sendViews: BehaviorSubject<SendView[]> = new BehaviorSubject([]);\n\n  sends$ = this._sends.asObservable();\n  sendViews$ = this._sendViews.asObservable();\n\n  constructor(\n    private cryptoService: CryptoService,\n    private i18nService: I18nService,\n    private keyGenerationService: KeyGenerationService,\n    private stateService: StateService,\n  ) {\n    this.stateService.activeAccountUnlocked$\n      .pipe(\n        concatMap(async (unlocked) => {\n          if (Utils.global.bitwardenContainerService == null) {\n            return;\n          }\n\n          if (!unlocked) {\n            this._sends.next([]);\n            this._sendViews.next([]);\n            return;\n          }\n\n          const data = await this.stateService.getEncryptedSends();\n\n          await this.updateObservables(data);\n        }),\n      )\n      .subscribe();\n  }\n\n  async clearCache(): Promise<void> {\n    await this._sendViews.next([]);\n  }\n\n  async encrypt(\n    model: SendView,\n    file: File | ArrayBuffer,\n    password: string,\n    key?: SymmetricCryptoKey,\n  ): Promise<[Send, EncArrayBuffer]> {\n    let fileData: EncArrayBuffer = null;\n    const send = new Send();\n    send.id = model.id;\n    send.type = model.type;\n    send.disabled = model.disabled;\n    send.hideEmail = model.hideEmail;\n    send.maxAccessCount = model.maxAccessCount;\n    if (model.key == null) {\n      const key = await this.keyGenerationService.createKeyWithPurpose(\n        128,\n        this.sendKeyPurpose,\n        this.sendKeySalt,\n      );\n      model.key = key.material;\n      model.cryptoKey = key.derivedKey;\n    }\n    if (password != null) {\n      const passwordKey = await this.keyGenerationService.deriveKeyFromPassword(\n        password,\n        model.key,\n        KdfType.PBKDF2_SHA256,\n        { iterations: SEND_KDF_ITERATIONS },\n      );\n      send.password = passwordKey.keyB64;\n    }\n    send.key = await this.cryptoService.encrypt(model.key, key);\n    send.name = await this.cryptoService.encrypt(model.name, model.cryptoKey);\n    send.notes = await this.cryptoService.encrypt(model.notes, model.cryptoKey);\n    if (send.type === SendType.Text) {\n      send.text = new SendText();\n      send.text.text = await this.cryptoService.encrypt(model.text.text, model.cryptoKey);\n      send.text.hidden = model.text.hidden;\n    } else if (send.type === SendType.File) {\n      send.file = new SendFile();\n      if (file != null) {\n        if (file instanceof ArrayBuffer) {\n          const [name, data] = await this.encryptFileData(\n            model.file.fileName,\n            file,\n            model.cryptoKey,\n          );\n          send.file.fileName = name;\n          fileData = data;\n        } else {\n          fileData = await this.parseFile(send, file, model.cryptoKey);\n        }\n      }\n    }\n\n    return [send, fileData];\n  }\n\n  get(id: string): Send {\n    const sends = this._sends.getValue();\n    return sends.find((send) => send.id === id);\n  }\n\n  get$(id: string): Observable<Send | undefined> {\n    return this.sends$.pipe(\n      distinctUntilChanged((oldSends, newSends) => {\n        const oldSend = oldSends.find((oldSend) => oldSend.id === id);\n        const newSend = newSends.find((newSend) => newSend.id === id);\n        if (!oldSend || !newSend) {\n          // If either oldSend or newSend is not found, consider them different\n          return false;\n        }\n\n        // Compare each property of the old and new Send objects\n        const allPropertiesSame = Object.keys(newSend).every((key) => {\n          if (\n            (oldSend[key as keyof Send] != null && newSend[key as keyof Send] === null) ||\n            (oldSend[key as keyof Send] === null && newSend[key as keyof Send] != null)\n          ) {\n            // If a key from either old or new send is not found, and the key from the other send has a value, consider them different\n            return false;\n          }\n\n          switch (key) {\n            case \"name\":\n            case \"notes\":\n            case \"key\":\n              if (oldSend[key] === null && newSend[key] === null) {\n                return true;\n              }\n\n              return oldSend[key].encryptedString === newSend[key].encryptedString;\n            case \"text\":\n              if (oldSend[key].text == null && newSend[key].text == null) {\n                return true;\n              }\n              if (\n                (oldSend[key].text != null && newSend[key].text == null) ||\n                (oldSend[key].text == null && newSend[key].text != null)\n              ) {\n                return false;\n              }\n              return oldSend[key].text.encryptedString === newSend[key].text.encryptedString;\n            case \"file\":\n              //Files are never updated so never will be changed.\n              return true;\n            case \"revisionDate\":\n            case \"expirationDate\":\n            case \"deletionDate\":\n              if (oldSend[key] === null && newSend[key] === null) {\n                return true;\n              }\n              return oldSend[key].getTime() === newSend[key].getTime();\n            default:\n              // For other properties, compare directly\n              return oldSend[key as keyof Send] === newSend[key as keyof Send];\n          }\n        });\n\n        return allPropertiesSame;\n      }),\n      map((sends) => sends.find((o) => o.id === id)),\n    );\n  }\n\n  async getFromState(id: string): Promise<Send> {\n    const sends = await this.stateService.getEncryptedSends();\n    // eslint-disable-next-line\n    if (sends == null || !sends.hasOwnProperty(id)) {\n      return null;\n    }\n\n    return new Send(sends[id]);\n  }\n\n  async getAll(): Promise<Send[]> {\n    const sends = await this.stateService.getEncryptedSends();\n    const response: Send[] = [];\n    for (const id in sends) {\n      // eslint-disable-next-line\n      if (sends.hasOwnProperty(id)) {\n        response.push(new Send(sends[id]));\n      }\n    }\n    return response;\n  }\n\n  async getAllDecryptedFromState(): Promise<SendView[]> {\n    let decSends = await this.stateService.getDecryptedSends();\n    if (decSends != null) {\n      return decSends;\n    }\n\n    decSends = [];\n    const hasKey = await this.cryptoService.hasUserKey();\n    if (!hasKey) {\n      throw new Error(\"No user key found.\");\n    }\n\n    const promises: Promise<any>[] = [];\n    const sends = await this.getAll();\n    sends.forEach((send) => {\n      promises.push(send.decrypt().then((f) => decSends.push(f)));\n    });\n\n    await Promise.all(promises);\n    decSends.sort(Utils.getSortFunction(this.i18nService, \"name\"));\n\n    await this.stateService.setDecryptedSends(decSends);\n    return decSends;\n  }\n\n  async upsert(send: SendData | SendData[]): Promise<any> {\n    let sends = await this.stateService.getEncryptedSends();\n    if (sends == null) {\n      sends = {};\n    }\n    if (send instanceof SendData) {\n      const s = send as SendData;\n      sends[s.id] = s;\n    } else {\n      (send as SendData[]).forEach((s) => {\n        sends[s.id] = s;\n      });\n    }\n\n    await this.replace(sends);\n  }\n\n  async clear(userId?: string): Promise<any> {\n    if (userId == null || userId == (await this.stateService.getUserId())) {\n      this._sends.next([]);\n      this._sendViews.next([]);\n    }\n    await this.stateService.setDecryptedSends(null, { userId: userId });\n    await this.stateService.setEncryptedSends(null, { userId: userId });\n  }\n\n  async delete(id: string | string[]): Promise<any> {\n    const sends = await this.stateService.getEncryptedSends();\n    if (sends == null) {\n      return;\n    }\n\n    if (typeof id === \"string\") {\n      if (sends[id] == null) {\n        return;\n      }\n      delete sends[id];\n    } else {\n      (id as string[]).forEach((i) => {\n        delete sends[i];\n      });\n    }\n\n    await this.replace(sends);\n  }\n\n  async replace(sends: { [id: string]: SendData }): Promise<any> {\n    await this.updateObservables(sends);\n    await this.stateService.setEncryptedSends(sends);\n  }\n\n  async getRotatedKeys(newUserKey: UserKey): Promise<SendWithIdRequest[]> {\n    if (newUserKey == null) {\n      throw new Error(\"New user key is required for rotation.\");\n    }\n\n    const requests = await Promise.all(\n      this._sends.value.map(async (send) => {\n        const sendKey = await this.cryptoService.decryptToBytes(send.key);\n        send.key = await this.cryptoService.encrypt(sendKey, newUserKey);\n        return new SendWithIdRequest(send);\n      }),\n    );\n    // separate return for easier debugging\n    return requests;\n  }\n\n  private parseFile(send: Send, file: File, key: SymmetricCryptoKey): Promise<EncArrayBuffer> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsArrayBuffer(file);\n      reader.onload = async (evt) => {\n        try {\n          const [name, data] = await this.encryptFileData(\n            file.name,\n            evt.target.result as ArrayBuffer,\n            key,\n          );\n          send.file.fileName = name;\n          resolve(data);\n        } catch (e) {\n          reject(e);\n        }\n      };\n      reader.onerror = () => {\n        reject(\"Error reading file.\");\n      };\n    });\n  }\n\n  private async encryptFileData(\n    fileName: string,\n    data: ArrayBuffer,\n    key: SymmetricCryptoKey,\n  ): Promise<[EncString, EncArrayBuffer]> {\n    const encFileName = await this.cryptoService.encrypt(fileName, key);\n    const encFileData = await this.cryptoService.encryptToBytes(new Uint8Array(data), key);\n    return [encFileName, encFileData];\n  }\n\n  private async updateObservables(sendsMap: { [id: string]: SendData }) {\n    const sends = Object.values(sendsMap || {}).map((f) => new Send(f));\n    this._sends.next(sends);\n\n    if (await this.cryptoService.hasUserKey()) {\n      this._sendViews.next(await this.decryptSends(sends));\n    }\n  }\n\n  private async decryptSends(sends: Send[]) {\n    const decryptSendPromises = sends.map((s) => s.decrypt());\n    const decryptedSends = await Promise.all(decryptSendPromises);\n\n    decryptedSends.sort(Utils.getSortFunction(this.i18nService, \"name\"));\n    return decryptedSends;\n  }\n}\n","export const SEND_KDF_ITERATIONS = 100000;\n","import { BehaviorSubject } from \"rxjs\";\n\nimport { Send } from \"@bitwarden/common/tools/send/models/domain/send\";\nimport { SendView } from \"@bitwarden/common/tools/send/models/view/send.view\";\nimport { SendService } from \"@bitwarden/common/tools/send/services/send.service\";\n\nimport { browserSession, sessionSync } from \"../platform/decorators/session-sync-observable\";\n\n@browserSession\nexport class BrowserSendService extends SendService {\n  @sessionSync({ initializer: Send.fromJSON, initializeAs: \"array\" })\n  protected _sends: BehaviorSubject<Send[]>;\n  @sessionSync({ initializer: SendView.fromJSON, initializeAs: \"array\" })\n  protected _sendViews: BehaviorSubject<SendView[]>;\n}\n","import { firstValueFrom, timeout } from \"rxjs\";\n\nimport { SearchService } from \"../../abstractions/search.service\";\nimport { VaultTimeoutSettingsService } from \"../../abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { VaultTimeoutService as VaultTimeoutServiceAbstraction } from \"../../abstractions/vault-timeout/vault-timeout.service\";\nimport { AuthService } from \"../../auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"../../auth/enums/authentication-status\";\nimport { ClientType } from \"../../enums\";\nimport { VaultTimeoutAction } from \"../../enums/vault-timeout-action.enum\";\nimport { CryptoService } from \"../../platform/abstractions/crypto.service\";\nimport { MessagingService } from \"../../platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"../../platform/abstractions/platform-utils.service\";\nimport { StateService } from \"../../platform/abstractions/state.service\";\nimport { CipherService } from \"../../vault/abstractions/cipher.service\";\nimport { CollectionService } from \"../../vault/abstractions/collection.service\";\nimport { FolderService } from \"../../vault/abstractions/folder/folder.service.abstraction\";\n\nexport class VaultTimeoutService implements VaultTimeoutServiceAbstraction {\n  private inited = false;\n\n  constructor(\n    private cipherService: CipherService,\n    private folderService: FolderService,\n    private collectionService: CollectionService,\n    private cryptoService: CryptoService,\n    protected platformUtilsService: PlatformUtilsService,\n    private messagingService: MessagingService,\n    private searchService: SearchService,\n    private stateService: StateService,\n    private authService: AuthService,\n    private vaultTimeoutSettingsService: VaultTimeoutSettingsService,\n    private lockedCallback: (userId?: string) => Promise<void> = null,\n    private loggedOutCallback: (expired: boolean, userId?: string) => Promise<void> = null,\n  ) {}\n\n  async init(checkOnInterval: boolean) {\n    if (this.inited) {\n      return;\n    }\n    // TODO: Remove after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3483)\n    await this.migrateKeyForNeverLockIfNeeded();\n\n    this.inited = true;\n    if (checkOnInterval) {\n      this.startCheck();\n    }\n  }\n\n  startCheck() {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.checkVaultTimeout();\n    setInterval(() => this.checkVaultTimeout(), 10 * 1000); // check every 10 seconds\n  }\n\n  async checkVaultTimeout(): Promise<void> {\n    // Get whether or not the view is open a single time so it can be compared for each user\n    const isViewOpen = await this.platformUtilsService.isViewOpen();\n\n    const activeUserId = await firstValueFrom(this.stateService.activeAccount$.pipe(timeout(500)));\n\n    const accounts = await firstValueFrom(this.stateService.accounts$);\n    for (const userId in accounts) {\n      if (userId != null && (await this.shouldLock(userId, activeUserId, isViewOpen))) {\n        await this.executeTimeoutAction(userId);\n      }\n    }\n  }\n\n  async lock(userId?: string): Promise<void> {\n    const authed = await this.stateService.getIsAuthenticated({ userId: userId });\n    if (!authed) {\n      return;\n    }\n\n    const availableActions = await firstValueFrom(\n      this.vaultTimeoutSettingsService.availableVaultTimeoutActions$(userId),\n    );\n    const supportsLock = availableActions.includes(VaultTimeoutAction.Lock);\n    if (!supportsLock) {\n      await this.logOut(userId);\n    }\n\n    if (userId == null || userId === (await this.stateService.getUserId())) {\n      this.searchService.clearIndex();\n      await this.folderService.clearCache();\n      await this.collectionService.clearActiveUserCache();\n    }\n\n    await this.stateService.setEverBeenUnlocked(true, { userId: userId });\n    await this.stateService.setUserKeyAutoUnlock(null, { userId: userId });\n    await this.stateService.setCryptoMasterKeyAuto(null, { userId: userId });\n\n    await this.cryptoService.clearUserKey(false, userId);\n    await this.cryptoService.clearMasterKey(userId);\n    await this.cryptoService.clearOrgKeys(true, userId);\n    await this.cryptoService.clearKeyPair(true, userId);\n\n    await this.cipherService.clearCache(userId);\n\n    this.messagingService.send(\"locked\", { userId: userId });\n\n    if (this.lockedCallback != null) {\n      await this.lockedCallback(userId);\n    }\n  }\n\n  async logOut(userId?: string): Promise<void> {\n    if (this.loggedOutCallback != null) {\n      await this.loggedOutCallback(false, userId);\n    }\n  }\n\n  private async shouldLock(\n    userId: string,\n    activeUserId: string,\n    isViewOpen: boolean,\n  ): Promise<boolean> {\n    if (isViewOpen && userId === activeUserId) {\n      // We know a view is open and this is the currently active user\n      // which means they are likely looking at their vault\n      // and they should not lock.\n      return false;\n    }\n\n    const authStatus = await this.authService.getAuthStatus(userId);\n    if (\n      authStatus === AuthenticationStatus.Locked ||\n      authStatus === AuthenticationStatus.LoggedOut\n    ) {\n      return false;\n    }\n\n    const vaultTimeout = await this.vaultTimeoutSettingsService.getVaultTimeout(userId);\n    if (vaultTimeout == null || vaultTimeout < 0) {\n      return false;\n    }\n\n    const lastActive = await this.stateService.getLastActive({ userId: userId });\n    if (lastActive == null) {\n      return false;\n    }\n\n    const vaultTimeoutSeconds = vaultTimeout * 60;\n    const diffSeconds = (new Date().getTime() - lastActive) / 1000;\n    return diffSeconds >= vaultTimeoutSeconds;\n  }\n\n  private async executeTimeoutAction(userId: string): Promise<void> {\n    const timeoutAction = await firstValueFrom(\n      this.vaultTimeoutSettingsService.vaultTimeoutAction$(userId),\n    );\n    timeoutAction === VaultTimeoutAction.LogOut\n      ? await this.logOut(userId)\n      : await this.lock(userId);\n  }\n\n  private async migrateKeyForNeverLockIfNeeded(): Promise<void> {\n    // Web can't set vault timeout to never\n    if (this.platformUtilsService.getClientType() == ClientType.Web) {\n      return;\n    }\n    const accounts = await firstValueFrom(this.stateService.accounts$);\n    for (const userId in accounts) {\n      if (userId != null) {\n        await this.cryptoService.migrateAutoKeyIfNeeded(userId);\n        // Legacy users should be logged out since we're not on the web vault and can't migrate.\n        if (await this.cryptoService.isLegacyUser(null, userId)) {\n          await this.logOut(userId);\n        }\n      }\n    }\n  }\n}\n","export enum FeatureFlag {\n  BrowserFilelessImport = \"browser-fileless-import\",\n  ItemShare = \"item-share\",\n  FlexibleCollectionsV1 = \"flexible-collections-v-1\", // v-1 is intentional\n  BulkCollectionAccess = \"bulk-collection-access\",\n  VaultOnboarding = \"vault-onboarding\",\n  GeneratorToolsModernization = \"generator-tools-modernization\",\n  KeyRotationImprovements = \"key-rotation-improvements\",\n  FlexibleCollectionsMigration = \"flexible-collections-migration\",\n  AC1607_PresentUserOffboardingSurvey = \"AC-1607_present-user-offboarding-survey\",\n}\n\n// Replace this with a type safe lookup of the feature flag values in PM-2282\nexport type FeatureFlagValue = number | string | boolean;\n","import { VaultTimeoutService as BaseVaultTimeoutService } from \"@bitwarden/common/services/vault-timeout/vault-timeout.service\";\n\nimport { SafariApp } from \"../../browser/safariApp\";\n\nexport default class VaultTimeoutService extends BaseVaultTimeoutService {\n  startCheck() {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.checkVaultTimeout();\n    if (this.platformUtilsService.isSafari()) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.checkSafari();\n    } else {\n      setInterval(() => this.checkVaultTimeout(), 10 * 1000); // check every 10 seconds\n    }\n  }\n\n  // This is a work-around to safari adding an arbitrary delay to setTimeout and\n  //  setIntervals. It works by calling the native extension which sleeps for 10s,\n  //  efficiently replicating setInterval.\n  async checkSafari() {\n    // eslint-disable-next-line\n    while (true) {\n      try {\n        await SafariApp.sendMessageToApp(\"sleep\");\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.checkVaultTimeout();\n      } catch (e) {\n        // eslint-disable-next-line\n        console.log(\"Exception Safari VaultTimeout\", e);\n      }\n    }\n  }\n}\n","const FilelessImportType = {\n  LP: \"LP\",\n} as const;\n\ntype FilelessImportTypeKeys = (typeof FilelessImportType)[keyof typeof FilelessImportType];\n\nconst FilelessImportPort = {\n  NotificationBar: \"fileless-importer-notification-bar\",\n  LpImporter: \"lp-fileless-importer\",\n} as const;\n\nexport { FilelessImportType, FilelessImportTypeKeys, FilelessImportPort };\n","import { firstValueFrom } from \"rxjs\";\n\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"@bitwarden/common/admin-console/enums\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { FeatureFlag } from \"@bitwarden/common/enums/feature-flag.enum\";\nimport { ConfigServiceAbstraction } from \"@bitwarden/common/platform/abstractions/config/config.service.abstraction\";\nimport { SyncService } from \"@bitwarden/common/vault/abstractions/sync/sync.service.abstraction\";\nimport { ImportServiceAbstraction } from \"@bitwarden/importer/core\";\n\nimport NotificationBackground from \"../../autofill/background/notification.background\";\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport {\n  FilelessImportPort,\n  FilelessImportType,\n  FilelessImportTypeKeys,\n} from \"../enums/fileless-import.enums\";\n\nimport {\n  ImportNotificationMessageHandlers,\n  LpImporterMessageHandlers,\n  FilelessImporterBackground as FilelessImporterBackgroundInterface,\n  FilelessImportPortMessage,\n} from \"./abstractions/fileless-importer.background\";\n\nclass FilelessImporterBackground implements FilelessImporterBackgroundInterface {\n  private static readonly filelessImporterPortNames: Set<string> = new Set([\n    FilelessImportPort.LpImporter,\n    FilelessImportPort.NotificationBar,\n  ]);\n  private importNotificationsPort: chrome.runtime.Port;\n  private lpImporterPort: chrome.runtime.Port;\n  private readonly importNotificationsPortMessageHandlers: ImportNotificationMessageHandlers = {\n    startFilelessImport: ({ message }) => this.startFilelessImport(message.importType),\n    cancelFilelessImport: ({ message, port }) =>\n      this.cancelFilelessImport(message.importType, port.sender),\n  };\n  private readonly lpImporterPortMessageHandlers: LpImporterMessageHandlers = {\n    displayLpImportNotification: ({ port }) =>\n      this.displayFilelessImportNotification(port.sender.tab, FilelessImportType.LP),\n    startLpImport: ({ message }) => this.triggerLpImport(message.data),\n  };\n\n  /**\n   * Creates a new instance of the fileless importer background logic.\n   *\n   * @param configService - Identifies if the feature flag is enabled.\n   * @param authService - Verifies if the auth status of the user.\n   * @param policyService - Identifies if the user account has a policy that disables personal ownership.\n   * @param notificationBackground - Used to inject the notification bar into the tab.\n   * @param importService - Used to import the export data into the vault.\n   * @param syncService - Used to trigger a full sync after the import is completed.\n   */\n  constructor(\n    private configService: ConfigServiceAbstraction,\n    private authService: AuthService,\n    private policyService: PolicyService,\n    private notificationBackground: NotificationBackground,\n    private importService: ImportServiceAbstraction,\n    private syncService: SyncService,\n  ) {}\n\n  /**\n   * Initializes the fileless importer background logic.\n   */\n  init() {\n    this.setupPortMessageListeners();\n  }\n\n  /**\n   * Starts an import of the export data pulled from the tab.\n   *\n   * @param importType - The type of import to start. Identifies the used content script.\n   */\n  private startFilelessImport(importType: FilelessImportTypeKeys) {\n    if (importType === FilelessImportType.LP) {\n      this.lpImporterPort?.postMessage({ command: \"startLpFilelessImport\" });\n    }\n  }\n\n  /**\n   * Cancels an import of the export data pulled from the tab. This closes any\n   * existing notifications that are present in the tab, and triggers importer\n   * specific behavior based on the import type.\n   *\n   * @param importType - The type of import to cancel. Identifies the used content script.\n   * @param sender - The sender of the message.\n   */\n  private async cancelFilelessImport(\n    importType: FilelessImportTypeKeys,\n    sender: chrome.runtime.MessageSender,\n  ) {\n    if (importType === FilelessImportType.LP) {\n      this.triggerLpImporterCsvDownload();\n    }\n\n    await BrowserApi.tabSendMessage(sender.tab, { command: \"closeNotificationBar\" });\n  }\n\n  /**\n   * Injects the notification bar into the passed tab.\n   *\n   * @param tab\n   * @param importType\n   */\n  private async displayFilelessImportNotification(tab: chrome.tabs.Tab, importType: string) {\n    await this.notificationBackground.requestFilelessImport(tab, importType);\n  }\n\n  /**\n   * Triggers the download of the CSV file from the LP importer. This is triggered\n   * when the user opts to not save the export to Bitwarden within the notification bar.\n   */\n  private triggerLpImporterCsvDownload() {\n    this.lpImporterPort?.postMessage({ command: \"triggerCsvDownload\" });\n    this.lpImporterPort?.disconnect();\n  }\n\n  /**\n   * Completes the import process for the LP importer. This is triggered when the\n   * user opts to save the export to Bitwarden within the notification bar.\n   *\n   * @param data - The export data to import.\n   * @param sender - The sender of the message.\n   */\n  private async triggerLpImport(data: string) {\n    if (!data) {\n      return;\n    }\n\n    const promptForPassword_callback = async () => \"\";\n    const importer = this.importService.getImporter(\n      \"lastpasscsv\",\n      promptForPassword_callback,\n      null,\n    );\n\n    try {\n      const result = await this.importService.import(importer, data, null, null, false);\n      if (result.success) {\n        this.importNotificationsPort?.postMessage({ command: \"filelessImportCompleted\" });\n        await this.syncService.fullSync(true);\n      }\n    } catch (error) {\n      this.importNotificationsPort?.postMessage({\n        command: \"filelessImportFailed\",\n        importErrorMessage: Object.values(error).length\n          ? error\n          : chrome.i18n.getMessage(\"importNetworkError\"),\n      });\n    }\n  }\n\n  /**\n   * Identifies if the user account has a policy that disables personal ownership.\n   */\n  private async removeIndividualVault(): Promise<boolean> {\n    return await firstValueFrom(\n      this.policyService.policyAppliesToActiveUser$(PolicyType.PersonalOwnership),\n    );\n  }\n\n  /**\n   * Sets up onConnect listeners for the extension.\n   */\n  private setupPortMessageListeners() {\n    chrome.runtime.onConnect.addListener(this.handlePortOnConnect);\n  }\n\n  /**\n   * Handles connections from content scripts that affect the fileless importer behavior.\n   * Is used to facilitate the passing of data and user actions to enact the import\n   * of web content to the Bitwarden vault. Along with this, a check is made to ensure\n   * that the feature flag is enabled and the user is authenticated.\n   */\n  private handlePortOnConnect = async (port: chrome.runtime.Port) => {\n    if (!FilelessImporterBackground.filelessImporterPortNames.has(port.name)) {\n      return;\n    }\n\n    const filelessImportFeatureFlagEnabled = await this.configService.getFeatureFlag<boolean>(\n      FeatureFlag.BrowserFilelessImport,\n    );\n    const userAuthStatus = await this.authService.getAuthStatus();\n    const removeIndividualVault = await this.removeIndividualVault();\n    const filelessImportEnabled =\n      filelessImportFeatureFlagEnabled &&\n      userAuthStatus === AuthenticationStatus.Unlocked &&\n      !removeIndividualVault;\n    port.postMessage({ command: \"verifyFeatureFlag\", filelessImportEnabled });\n\n    if (!filelessImportEnabled) {\n      return;\n    }\n\n    port.onMessage.addListener(this.handleImporterPortMessage);\n    port.onDisconnect.addListener(this.handleImporterPortDisconnect);\n\n    switch (port.name) {\n      case FilelessImportPort.LpImporter:\n        this.lpImporterPort = port;\n        break;\n      case FilelessImportPort.NotificationBar:\n        this.importNotificationsPort = port;\n        break;\n    }\n  };\n\n  /**\n   * Handles messages that are sent from fileless importer content scripts.\n   * @param message - The message that was sent.\n   * @param port - The port that the message was sent from.\n   */\n  private handleImporterPortMessage = (\n    message: FilelessImportPortMessage,\n    port: chrome.runtime.Port,\n  ) => {\n    let handler: CallableFunction | undefined;\n\n    switch (port.name) {\n      case FilelessImportPort.LpImporter:\n        handler = this.lpImporterPortMessageHandlers[message.command];\n        break;\n      case FilelessImportPort.NotificationBar:\n        handler = this.importNotificationsPortMessageHandlers[message.command];\n        break;\n    }\n\n    if (!handler) {\n      return;\n    }\n\n    handler({ message, port });\n  };\n\n  /**\n   * Handles disconnections from fileless importer content scripts.\n   * @param port - The port that was disconnected.\n   */\n  private handleImporterPortDisconnect = (port: chrome.runtime.Port) => {\n    switch (port.name) {\n      case FilelessImportPort.LpImporter:\n        this.lpImporterPort = null;\n        break;\n      case FilelessImportPort.NotificationBar:\n        this.importNotificationsPort = null;\n        break;\n    }\n  };\n}\n\nexport default FilelessImporterBackground;\n","import {\n  BehaviorSubject,\n  EmptyError,\n  filter,\n  firstValueFrom,\n  fromEvent,\n  fromEventPattern,\n  merge,\n  Observable,\n  Subject,\n  switchMap,\n  take,\n  takeUntil,\n  throwError,\n} from \"rxjs\";\n\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { UserRequestedFallbackAbortReason } from \"@bitwarden/common/vault/abstractions/fido2/fido2-client.service.abstraction\";\nimport {\n  Fido2UserInterfaceService as Fido2UserInterfaceServiceAbstraction,\n  Fido2UserInterfaceSession,\n  NewCredentialParams,\n  PickCredentialParams,\n} from \"@bitwarden/common/vault/abstractions/fido2/fido2-user-interface.service.abstraction\";\n\nimport { BrowserApi } from \"../../platform/browser/browser-api\";\nimport { closeFido2Popout, openFido2Popout } from \"../popup/utils/vault-popout-window\";\n\nconst BrowserFido2MessageName = \"BrowserFido2UserInterfaceServiceMessage\";\n\nexport class SessionClosedError extends Error {\n  constructor() {\n    super(\"Fido2UserInterfaceSession was closed\");\n  }\n}\n\nexport type BrowserFido2Message = { sessionId: string } & (\n  | /**\n   * This message is used by popouts to announce that they are ready\n   * to recieve messages.\n   **/ {\n      type: \"ConnectResponse\";\n    }\n  /**\n   * This message is used to announce the creation of a new session.\n   * It is used by popouts to know when to close.\n   **/\n  | {\n      type: \"NewSessionCreatedRequest\";\n    }\n  | {\n      type: \"PickCredentialRequest\";\n      cipherIds: string[];\n      userVerification: boolean;\n      fallbackSupported: boolean;\n    }\n  | {\n      type: \"PickCredentialResponse\";\n      cipherId?: string;\n      userVerified: boolean;\n    }\n  | {\n      type: \"ConfirmNewCredentialRequest\";\n      credentialName: string;\n      userName: string;\n      userVerification: boolean;\n      fallbackSupported: boolean;\n    }\n  | {\n      type: \"ConfirmNewCredentialResponse\";\n      cipherId: string;\n      userVerified: boolean;\n    }\n  | {\n      type: \"InformExcludedCredentialRequest\";\n      existingCipherIds: string[];\n      fallbackSupported: boolean;\n    }\n  | {\n      type: \"InformCredentialNotFoundRequest\";\n      fallbackSupported: boolean;\n    }\n  | {\n      type: \"AbortRequest\";\n    }\n  | {\n      type: \"AbortResponse\";\n      fallbackRequested: boolean;\n    }\n);\n\n/**\n * Browser implementation of the {@link Fido2UserInterfaceService}.\n * The user interface is implemented as a popout and the service uses the browser's messaging API to communicate with it.\n */\nexport class BrowserFido2UserInterfaceService implements Fido2UserInterfaceServiceAbstraction {\n  constructor(private authService: AuthService) {}\n\n  async newSession(\n    fallbackSupported: boolean,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ): Promise<Fido2UserInterfaceSession> {\n    return await BrowserFido2UserInterfaceSession.create(\n      this.authService,\n      fallbackSupported,\n      tab,\n      abortController,\n    );\n  }\n}\n\nexport class BrowserFido2UserInterfaceSession implements Fido2UserInterfaceSession {\n  static async create(\n    authService: AuthService,\n    fallbackSupported: boolean,\n    tab: chrome.tabs.Tab,\n    abortController?: AbortController,\n  ): Promise<BrowserFido2UserInterfaceSession> {\n    return new BrowserFido2UserInterfaceSession(\n      authService,\n      fallbackSupported,\n      tab,\n      abortController,\n    );\n  }\n\n  static sendMessage(msg: BrowserFido2Message) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.sendMessage(BrowserFido2MessageName, msg);\n  }\n\n  static abortPopout(sessionId: string, fallbackRequested = false) {\n    this.sendMessage({\n      sessionId: sessionId,\n      type: \"AbortResponse\",\n      fallbackRequested: fallbackRequested,\n    });\n  }\n\n  static confirmNewCredentialResponse(sessionId: string, cipherId: string, userVerified: boolean) {\n    this.sendMessage({\n      sessionId: sessionId,\n      type: \"ConfirmNewCredentialResponse\",\n      cipherId,\n      userVerified,\n    });\n  }\n\n  private closed = false;\n  private messages$ = (BrowserApi.messageListener$() as Observable<BrowserFido2Message>).pipe(\n    filter((msg) => msg.sessionId === this.sessionId),\n  );\n  private connected$ = new BehaviorSubject(false);\n  private windowClosed$: Observable<number>;\n  private destroy$ = new Subject<void>();\n\n  private constructor(\n    private readonly authService: AuthService,\n    private readonly fallbackSupported: boolean,\n    private readonly tab: chrome.tabs.Tab,\n    readonly abortController = new AbortController(),\n    readonly sessionId = Utils.newGuid(),\n  ) {\n    this.messages$\n      .pipe(\n        filter((msg) => msg.type === \"ConnectResponse\"),\n        take(1),\n        takeUntil(this.destroy$),\n      )\n      .subscribe(() => {\n        this.connected$.next(true);\n      });\n\n    // Handle session aborted by RP\n    fromEvent(abortController.signal, \"abort\")\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(() => {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.close();\n        BrowserFido2UserInterfaceSession.sendMessage({\n          type: \"AbortRequest\",\n          sessionId: this.sessionId,\n        });\n      });\n\n    // Handle session aborted by user\n    this.messages$\n      .pipe(\n        filter((msg) => msg.type === \"AbortResponse\"),\n        take(1),\n        takeUntil(this.destroy$),\n      )\n      .subscribe((msg) => {\n        if (msg.type === \"AbortResponse\") {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.close();\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.abort(msg.fallbackRequested);\n        }\n      });\n\n    this.windowClosed$ = fromEventPattern(\n      // FIXME: Make sure that is does not cause a memory leak in Safari or use BrowserApi.AddListener\n      // and test that it doesn't break. Tracking Ticket: https://bitwarden.atlassian.net/browse/PM-4735\n      // eslint-disable-next-line no-restricted-syntax\n      (handler: any) => chrome.windows.onRemoved.addListener(handler),\n      (handler: any) => chrome.windows.onRemoved.removeListener(handler),\n    );\n\n    BrowserFido2UserInterfaceSession.sendMessage({\n      type: \"NewSessionCreatedRequest\",\n      sessionId,\n    });\n  }\n\n  async pickCredential({\n    cipherIds,\n    userVerification,\n  }: PickCredentialParams): Promise<{ cipherId: string; userVerified: boolean }> {\n    const data: BrowserFido2Message = {\n      type: \"PickCredentialRequest\",\n      cipherIds,\n      sessionId: this.sessionId,\n      userVerification,\n      fallbackSupported: this.fallbackSupported,\n    };\n\n    await this.send(data);\n    const response = await this.receive(\"PickCredentialResponse\");\n\n    return { cipherId: response.cipherId, userVerified: response.userVerified };\n  }\n\n  async confirmNewCredential({\n    credentialName,\n    userName,\n    userVerification,\n  }: NewCredentialParams): Promise<{ cipherId: string; userVerified: boolean }> {\n    const data: BrowserFido2Message = {\n      type: \"ConfirmNewCredentialRequest\",\n      sessionId: this.sessionId,\n      credentialName,\n      userName,\n      userVerification,\n      fallbackSupported: this.fallbackSupported,\n    };\n\n    await this.send(data);\n    const response = await this.receive(\"ConfirmNewCredentialResponse\");\n\n    return { cipherId: response.cipherId, userVerified: response.userVerified };\n  }\n\n  async informExcludedCredential(existingCipherIds: string[]): Promise<void> {\n    const data: BrowserFido2Message = {\n      type: \"InformExcludedCredentialRequest\",\n      sessionId: this.sessionId,\n      existingCipherIds,\n      fallbackSupported: this.fallbackSupported,\n    };\n\n    await this.send(data);\n    await this.receive(\"AbortResponse\");\n  }\n\n  async ensureUnlockedVault(): Promise<void> {\n    if ((await this.authService.getAuthStatus()) !== AuthenticationStatus.Unlocked) {\n      await this.connect();\n    }\n  }\n\n  async informCredentialNotFound(): Promise<void> {\n    const data: BrowserFido2Message = {\n      type: \"InformCredentialNotFoundRequest\",\n      sessionId: this.sessionId,\n      fallbackSupported: this.fallbackSupported,\n    };\n\n    await this.send(data);\n    await this.receive(\"AbortResponse\");\n  }\n\n  async close() {\n    await closeFido2Popout(this.sessionId);\n    this.closed = true;\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  private async abort(fallback = false) {\n    this.abortController.abort(fallback ? UserRequestedFallbackAbortReason : undefined);\n  }\n\n  private async send(msg: BrowserFido2Message): Promise<void> {\n    if (!this.connected$.value) {\n      await this.connect();\n    }\n    BrowserFido2UserInterfaceSession.sendMessage(msg);\n  }\n\n  private async receive<T extends BrowserFido2Message[\"type\"]>(\n    type: T,\n  ): Promise<BrowserFido2Message & { type: T }> {\n    try {\n      const response = await firstValueFrom(\n        this.messages$.pipe(\n          filter((msg) => msg.sessionId === this.sessionId && msg.type === type),\n          takeUntil(this.destroy$),\n        ),\n      );\n      return response as BrowserFido2Message & { type: T };\n    } catch (error) {\n      if (error instanceof EmptyError) {\n        throw new SessionClosedError();\n      }\n      throw error;\n    }\n  }\n\n  private async connect(): Promise<void> {\n    if (this.closed) {\n      throw new Error(\"Cannot re-open closed session\");\n    }\n\n    const connectPromise = firstValueFrom(\n      merge(\n        this.connected$.pipe(filter((connected) => connected === true)),\n        fromEvent(this.abortController.signal, \"abort\").pipe(\n          switchMap(() => throwError(() => new SessionClosedError())),\n        ),\n      ),\n    );\n\n    const popoutId = await openFido2Popout(this.tab, {\n      sessionId: this.sessionId,\n      fallbackSupported: this.fallbackSupported,\n    });\n\n    this.windowClosed$\n      .pipe(\n        filter((windowId) => {\n          return popoutId === windowId;\n        }),\n        takeUntil(this.destroy$),\n      )\n      .subscribe(() => {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.close();\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.abort(true);\n      });\n\n    await connectPromise;\n  }\n}\n","import { BrowserApi } from \"../../platform/browser/browser-api\";\n\nimport { Fido2Service as Fido2ServiceInterface } from \"./abstractions/fido2.service\";\n\nexport default class Fido2Service implements Fido2ServiceInterface {\n  async init() {\n    const tabs = await BrowserApi.tabsQuery({});\n    tabs.forEach((tab) => {\n      if (tab.url?.startsWith(\"https\")) {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.injectFido2ContentScripts({ tab } as chrome.runtime.MessageSender);\n      }\n    });\n\n    BrowserApi.addListener(chrome.runtime.onConnect, (port) => {\n      if (port.name === \"fido2ContentScriptReady\") {\n        port.postMessage({ command: \"fido2ContentScriptInit\" });\n      }\n    });\n  }\n\n  /**\n   * Injects the FIDO2 content script into the current tab.\n   * @param {chrome.runtime.MessageSender}  sender\n   * @returns {Promise<void>}\n   */\n  async injectFido2ContentScripts(sender: chrome.runtime.MessageSender): Promise<void> {\n    await BrowserApi.executeScriptInTab(sender.tab.id, {\n      file: \"content/fido2/content-script.js\",\n      frameId: sender.frameId,\n      runAt: \"document_start\",\n    });\n  }\n}\n","import { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nimport { CipherStatus } from \"./cipher-status.model\";\n\nexport type VaultFilterFunction = (cipher: CipherView) => boolean;\n\nexport class VaultFilter {\n  cipherType?: CipherType;\n  selectedCollection = false; // This is needed because of how the \"Unassigned\" collection works. It has a null id.\n  selectedCollectionId?: string;\n  status?: CipherStatus;\n  selectedFolder = false; // This is needed because of how the \"No Folder\" folder works. It has a null id.\n  selectedFolderId?: string;\n  selectedOrganizationId?: string;\n  myVaultOnly = false;\n  refreshCollectionsAndFolders = false;\n\n  constructor(init?: Partial<VaultFilter>) {\n    Object.assign(this, init);\n  }\n\n  resetFilter() {\n    this.cipherType = null;\n    this.status = null;\n    this.selectedCollection = false;\n    this.selectedCollectionId = null;\n    this.selectedFolder = false;\n    this.selectedFolderId = null;\n  }\n\n  resetOrganization() {\n    this.myVaultOnly = false;\n    this.selectedOrganizationId = null;\n    this.resetFilter();\n  }\n\n  buildFilter(): VaultFilterFunction {\n    return (cipher) => {\n      let cipherPassesFilter = true;\n      if (this.status === \"favorites\" && cipherPassesFilter) {\n        cipherPassesFilter = cipher.favorite;\n      }\n      if (this.status === \"trash\" && cipherPassesFilter) {\n        cipherPassesFilter = cipher.isDeleted;\n      }\n      if (this.cipherType != null && cipherPassesFilter) {\n        cipherPassesFilter = cipher.type === this.cipherType;\n      }\n      if (this.selectedFolder && this.selectedFolderId == null && cipherPassesFilter) {\n        cipherPassesFilter = cipher.folderId == null;\n      }\n      if (this.selectedFolder && this.selectedFolderId != null && cipherPassesFilter) {\n        cipherPassesFilter = cipher.folderId === this.selectedFolderId;\n      }\n      if (this.selectedCollection && this.selectedCollectionId == null && cipherPassesFilter) {\n        cipherPassesFilter =\n          cipher.organizationId != null &&\n          (cipher.collectionIds == null || cipher.collectionIds.length === 0);\n      }\n      if (this.selectedCollection && this.selectedCollectionId != null && cipherPassesFilter) {\n        cipherPassesFilter =\n          cipher.collectionIds != null && cipher.collectionIds.includes(this.selectedCollectionId);\n      }\n      if (this.selectedOrganizationId != null && cipherPassesFilter) {\n        cipherPassesFilter = cipher.organizationId === this.selectedOrganizationId;\n      }\n      if (this.myVaultOnly && cipherPassesFilter) {\n        cipherPassesFilter = cipher.organizationId === null;\n      }\n      return cipherPassesFilter;\n    };\n  }\n}\n","import { ITreeNodeObject, TreeNode } from \"@bitwarden/common/vault/models/domain/tree-node\";\n\nexport class DynamicTreeNode<T extends ITreeNodeObject> {\n  fullList: T[];\n  nestedList: TreeNode<T>[];\n\n  hasId(id: string): boolean {\n    return this.fullList != null && this.fullList.filter((i: T) => i.id === id).length > 0;\n  }\n\n  constructor(init?: Partial<DynamicTreeNode<T>>) {\n    Object.assign(this, init);\n  }\n}\n","import { KeyDefinition, VAULT_FILTER_DISK } from \"../../../platform/state\";\n\nexport const COLLAPSED_GROUPINGS = KeyDefinition.array<string>(\n  VAULT_FILTER_DISK,\n  \"collapsedGroupings\",\n  {\n    deserializer: (obj) => obj,\n  },\n);\n","import { Observable } from \"rxjs\";\n\nimport { SymmetricCryptoKey } from \"../../../platform/models/domain/symmetric-crypto-key\";\nimport { FolderData } from \"../../models/data/folder.data\";\nimport { Folder } from \"../../models/domain/folder\";\nimport { FolderView } from \"../../models/view/folder.view\";\n\nexport abstract class FolderService {\n  folders$: Observable<Folder[]>;\n  folderViews$: Observable<FolderView[]>;\n\n  clearCache: () => Promise<void>;\n  encrypt: (model: FolderView, key?: SymmetricCryptoKey) => Promise<Folder>;\n  get: (id: string) => Promise<Folder>;\n  getAllFromState: () => Promise<Folder[]>;\n  /**\n   * @deprecated Only use in CLI!\n   */\n  getFromState: (id: string) => Promise<Folder>;\n  /**\n   * @deprecated Only use in CLI!\n   */\n  getAllDecryptedFromState: () => Promise<FolderView[]>;\n  decryptFolders: (folders: Folder[]) => Promise<FolderView[]>;\n}\n\nexport abstract class InternalFolderService extends FolderService {\n  upsert: (folder: FolderData | FolderData[]) => Promise<void>;\n  replace: (folders: { [id: string]: FolderData }) => Promise<void>;\n  clear: (userId: string) => Promise<any>;\n  delete: (id: string | string[]) => Promise<any>;\n}\n","import { SymmetricCryptoKey } from \"../../platform/models/domain/symmetric-crypto-key\";\nimport { UriMatchType } from \"../enums\";\nimport { CipherType } from \"../enums/cipher-type\";\nimport { CipherData } from \"../models/data/cipher.data\";\nimport { Cipher } from \"../models/domain/cipher\";\nimport { Field } from \"../models/domain/field\";\nimport { CipherView } from \"../models/view/cipher.view\";\nimport { FieldView } from \"../models/view/field.view\";\n\nexport abstract class CipherService {\n  clearCache: (userId?: string) => Promise<void>;\n  encrypt: (\n    model: CipherView,\n    keyForEncryption?: SymmetricCryptoKey,\n    keyForCipherKeyDecryption?: SymmetricCryptoKey,\n    originalCipher?: Cipher,\n  ) => Promise<Cipher>;\n  encryptFields: (fieldsModel: FieldView[], key: SymmetricCryptoKey) => Promise<Field[]>;\n  encryptField: (fieldModel: FieldView, key: SymmetricCryptoKey) => Promise<Field>;\n  get: (id: string) => Promise<Cipher>;\n  getAll: () => Promise<Cipher[]>;\n  getAllDecrypted: () => Promise<CipherView[]>;\n  getAllDecryptedForGrouping: (groupingId: string, folder?: boolean) => Promise<CipherView[]>;\n  getAllDecryptedForUrl: (\n    url: string,\n    includeOtherTypes?: CipherType[],\n    defaultMatch?: UriMatchType,\n  ) => Promise<CipherView[]>;\n  getAllFromApiForOrganization: (organizationId: string) => Promise<CipherView[]>;\n  /**\n   * Gets ciphers belonging to the specified organization that the user has explicit collection level access to.\n   * Ciphers that are not assigned to any collections are only included for users with admin access.\n   */\n  getManyFromApiForOrganization: (organizationId: string) => Promise<CipherView[]>;\n  getLastUsedForUrl: (url: string, autofillOnPageLoad: boolean) => Promise<CipherView>;\n  getLastLaunchedForUrl: (url: string, autofillOnPageLoad: boolean) => Promise<CipherView>;\n  getNextCipherForUrl: (url: string) => Promise<CipherView>;\n  updateLastUsedIndexForUrl: (url: string) => void;\n  updateLastUsedDate: (id: string) => Promise<void>;\n  updateLastLaunchedDate: (id: string) => Promise<void>;\n  saveNeverDomain: (domain: string) => Promise<void>;\n  createWithServer: (cipher: Cipher, orgAdmin?: boolean) => Promise<any>;\n  updateWithServer: (cipher: Cipher, orgAdmin?: boolean, isNotClone?: boolean) => Promise<any>;\n  shareWithServer: (\n    cipher: CipherView,\n    organizationId: string,\n    collectionIds: string[],\n  ) => Promise<any>;\n  shareManyWithServer: (\n    ciphers: CipherView[],\n    organizationId: string,\n    collectionIds: string[],\n  ) => Promise<any>;\n  saveAttachmentWithServer: (\n    cipher: Cipher,\n    unencryptedFile: any,\n    admin?: boolean,\n  ) => Promise<Cipher>;\n  saveAttachmentRawWithServer: (\n    cipher: Cipher,\n    filename: string,\n    data: ArrayBuffer,\n    admin?: boolean,\n  ) => Promise<Cipher>;\n  saveCollectionsWithServer: (cipher: Cipher) => Promise<any>;\n  upsert: (cipher: CipherData | CipherData[]) => Promise<any>;\n  replace: (ciphers: { [id: string]: CipherData }) => Promise<any>;\n  clear: (userId: string) => Promise<any>;\n  moveManyWithServer: (ids: string[], folderId: string) => Promise<any>;\n  delete: (id: string | string[]) => Promise<any>;\n  deleteWithServer: (id: string, asAdmin?: boolean) => Promise<any>;\n  deleteManyWithServer: (ids: string[], asAdmin?: boolean) => Promise<any>;\n  deleteAttachment: (id: string, attachmentId: string) => Promise<void>;\n  deleteAttachmentWithServer: (id: string, attachmentId: string) => Promise<void>;\n  sortCiphersByLastUsed: (a: CipherView, b: CipherView) => number;\n  sortCiphersByLastUsedThenName: (a: CipherView, b: CipherView) => number;\n  getLocaleSortingFunction: () => (a: CipherView, b: CipherView) => number;\n  softDelete: (id: string | string[]) => Promise<any>;\n  softDeleteWithServer: (id: string, asAdmin?: boolean) => Promise<any>;\n  softDeleteManyWithServer: (ids: string[], asAdmin?: boolean) => Promise<any>;\n  restore: (\n    cipher: { id: string; revisionDate: string } | { id: string; revisionDate: string }[],\n  ) => Promise<any>;\n  restoreWithServer: (id: string, asAdmin?: boolean) => Promise<any>;\n  restoreManyWithServer: (\n    ids: string[],\n    organizationId?: string,\n    asAdmin?: boolean,\n  ) => Promise<void>;\n  getKeyForCipherKeyDecryption: (cipher: Cipher) => Promise<any>;\n}\n","import { Observable } from \"rxjs\";\n\nimport { CollectionId } from \"../../types/guid\";\nimport { CollectionData } from \"../models/data/collection.data\";\nimport { Collection } from \"../models/domain/collection\";\nimport { TreeNode } from \"../models/domain/tree-node\";\nimport { CollectionView } from \"../models/view/collection.view\";\n\nexport abstract class CollectionService {\n  clearActiveUserCache: () => Promise<void>;\n  encrypt: (model: CollectionView) => Promise<Collection>;\n  decryptedCollectionViews$: (ids: CollectionId[]) => Observable<CollectionView[]>;\n  /**\n   * @deprecated This method will soon be made private, use `decryptedCollectionViews$` instead.\n   */\n  decryptMany: (collections: Collection[]) => Promise<CollectionView[]>;\n  get: (id: string) => Promise<Collection>;\n  getAll: () => Promise<Collection[]>;\n  getAllDecrypted: () => Promise<CollectionView[]>;\n  getAllNested: (collections?: CollectionView[]) => Promise<TreeNode<CollectionView>[]>;\n  getNested: (id: string) => Promise<TreeNode<CollectionView>>;\n  upsert: (collection: CollectionData | CollectionData[]) => Promise<any>;\n  replace: (collections: { [id: string]: CollectionData }) => Promise<any>;\n  clear: (userId: string) => Promise<any>;\n  delete: (id: string | string[]) => Promise<any>;\n}\n","import { Observable } from \"rxjs\";\n\nimport { ListResponse } from \"../../../models/response/list.response\";\nimport { PolicyType } from \"../../enums\";\nimport { PolicyData } from \"../../models/data/policy.data\";\nimport { MasterPasswordPolicyOptions } from \"../../models/domain/master-password-policy-options\";\nimport { Policy } from \"../../models/domain/policy\";\nimport { ResetPasswordPolicyOptions } from \"../../models/domain/reset-password-policy-options\";\nimport { PolicyResponse } from \"../../models/response/policy.response\";\n\nexport abstract class PolicyService {\n  /**\n   * All {@link Policy} objects for the active user (from sync data).\n   * May include policies that are disabled or otherwise do not apply to the user.\n   * @see {@link get$} or {@link policyAppliesToActiveUser$} if you want to know when a policy applies to a user.\n   */\n  policies$: Observable<Policy[]>;\n\n  /**\n   * @returns the first {@link Policy} found that applies to the active user.\n   * A policy \"applies\" if it is enabled and the user is not exempt (e.g. because they are an Owner).\n   * @param policyType the {@link PolicyType} to search for\n   * @param policyFilter Optional predicate to apply when filtering policies\n   */\n  get$: (policyType: PolicyType, policyFilter?: (policy: Policy) => boolean) => Observable<Policy>;\n\n  /**\n   * All {@link Policy} objects for the specified user (from sync data).\n   * May include policies that are disabled or otherwise do not apply to the user.\n   * @see {@link policyAppliesToUser} if you want to know when a policy applies to the user.\n   * @deprecated Use {@link policies$} instead\n   */\n  getAll: (type?: PolicyType, userId?: string) => Promise<Policy[]>;\n\n  /**\n   * @returns true if the {@link PolicyType} applies to the current user, otherwise false.\n   * @remarks A policy \"applies\" if it is enabled and the user is not exempt (e.g. because they are an Owner).\n   */\n  policyAppliesToActiveUser$: (\n    policyType: PolicyType,\n    policyFilter?: (policy: Policy) => boolean,\n  ) => Observable<boolean>;\n\n  /**\n   * @returns true if the {@link PolicyType} applies to the specified user, otherwise false.\n   * @remarks A policy \"applies\" if it is enabled and the user is not exempt (e.g. because they are an Owner).\n   * @see {@link policyAppliesToActiveUser$} if you only want to know about the current user.\n   */\n  policyAppliesToUser: (\n    policyType: PolicyType,\n    policyFilter?: (policy: Policy) => boolean,\n    userId?: string,\n  ) => Promise<boolean>;\n\n  // Policy specific interfaces\n\n  /**\n   * Combines all Master Password policies that apply to the user.\n   * @returns a set of options which represent the minimum Master Password settings that the user must\n   * comply with in order to comply with **all** Master Password policies.\n   */\n  masterPasswordPolicyOptions$: (policies?: Policy[]) => Observable<MasterPasswordPolicyOptions>;\n\n  /**\n   * Evaluates whether a proposed Master Password complies with all Master Password policies that apply to the user.\n   */\n  evaluateMasterPassword: (\n    passwordStrength: number,\n    newPassword: string,\n    enforcedPolicyOptions?: MasterPasswordPolicyOptions,\n  ) => boolean;\n\n  /**\n   * @returns Reset Password policy options for the specified organization and a boolean indicating whether the policy\n   * is enabled\n   */\n  getResetPasswordPolicyOptions: (\n    policies: Policy[],\n    orgId: string,\n  ) => [ResetPasswordPolicyOptions, boolean];\n\n  // Helpers\n\n  /**\n   * Instantiates {@link Policy} objects from {@link PolicyResponse} objects.\n   */\n  mapPolicyFromResponse: (policyResponse: PolicyResponse) => Policy;\n\n  /**\n   * Instantiates {@link Policy} objects from {@link ListResponse<PolicyResponse>} objects.\n   */\n  mapPoliciesFromToken: (policiesResponse: ListResponse<PolicyResponse>) => Policy[];\n}\n\nexport abstract class InternalPolicyService extends PolicyService {\n  upsert: (policy: PolicyData) => Promise<any>;\n  replace: (policies: { [id: string]: PolicyData }) => Promise<void>;\n  clear: (userId?: string) => Promise<any>;\n}\n","import { Injectable } from \"@angular/core\";\nimport { firstValueFrom, from, map, mergeMap, Observable } from \"rxjs\";\n\nimport {\n  isMember,\n  OrganizationService,\n} from \"@bitwarden/common/admin-console/abstractions/organization/organization.service.abstraction\";\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"@bitwarden/common/admin-console/enums\";\nimport { Organization } from \"@bitwarden/common/admin-console/models/domain/organization\";\nimport { ActiveUserState, StateProvider } from \"@bitwarden/common/platform/state\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { TreeNode } from \"@bitwarden/common/vault/models/domain/tree-node\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport { ServiceUtils } from \"@bitwarden/common/vault/service-utils\";\n\nimport { DeprecatedVaultFilterService as DeprecatedVaultFilterServiceAbstraction } from \"../../abstractions/deprecated-vault-filter.service\";\nimport { DynamicTreeNode } from \"../models/dynamic-tree-node.model\";\n\nimport { COLLAPSED_GROUPINGS } from \"./../../../../../common/src/vault/services/key-state/collapsed-groupings.state\";\n\nconst NestingDelimiter = \"/\";\n\n@Injectable()\nexport class VaultFilterService implements DeprecatedVaultFilterServiceAbstraction {\n  private collapsedGroupingsState: ActiveUserState<string[]> =\n    this.stateProvider.getActive(COLLAPSED_GROUPINGS);\n  private readonly collapsedGroupings$: Observable<Set<string>> =\n    this.collapsedGroupingsState.state$.pipe(map((c) => new Set(c)));\n\n  constructor(\n    protected organizationService: OrganizationService,\n    protected folderService: FolderService,\n    protected cipherService: CipherService,\n    protected collectionService: CollectionService,\n    protected policyService: PolicyService,\n    protected stateProvider: StateProvider,\n  ) {}\n\n  async storeCollapsedFilterNodes(collapsedFilterNodes: Set<string>): Promise<void> {\n    await this.collapsedGroupingsState.update(() => Array.from(collapsedFilterNodes));\n  }\n\n  async buildCollapsedFilterNodes(): Promise<Set<string>> {\n    return await firstValueFrom(this.collapsedGroupings$);\n  }\n\n  async buildOrganizations(): Promise<Organization[]> {\n    let organizations = await this.organizationService.getAll();\n    if (organizations != null) {\n      organizations = organizations.filter(isMember).sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    return organizations;\n  }\n\n  buildNestedFolders(organizationId?: string): Observable<DynamicTreeNode<FolderView>> {\n    const transformation = async (storedFolders: FolderView[]) => {\n      let folders: FolderView[];\n\n      // If no org or \"My Vault\" is selected, show all folders\n      if (organizationId == null || organizationId == \"MyVault\") {\n        folders = storedFolders;\n      } else {\n        // Otherwise, show only folders that have ciphers from the selected org and the \"no folder\" folder\n        const ciphers = await this.cipherService.getAllDecrypted();\n        const orgCiphers = ciphers.filter((c) => c.organizationId == organizationId);\n        folders = storedFolders.filter(\n          (f) => orgCiphers.some((oc) => oc.folderId == f.id) || f.id == null,\n        );\n      }\n\n      const nestedFolders = await this.getAllFoldersNested(folders);\n      return new DynamicTreeNode<FolderView>({\n        fullList: folders,\n        nestedList: nestedFolders,\n      });\n    };\n\n    return this.folderService.folderViews$.pipe(\n      mergeMap((folders) => from(transformation(folders))),\n    );\n  }\n\n  async buildCollections(organizationId?: string): Promise<DynamicTreeNode<CollectionView>> {\n    const storedCollections = await this.collectionService.getAllDecrypted();\n    let collections: CollectionView[];\n    if (organizationId != null) {\n      collections = storedCollections.filter((c) => c.organizationId === organizationId);\n    } else {\n      collections = storedCollections;\n    }\n    const nestedCollections = await this.collectionService.getAllNested(collections);\n    return new DynamicTreeNode<CollectionView>({\n      fullList: collections,\n      nestedList: nestedCollections,\n    });\n  }\n\n  async checkForSingleOrganizationPolicy(): Promise<boolean> {\n    return await firstValueFrom(\n      this.policyService.policyAppliesToActiveUser$(PolicyType.SingleOrg),\n    );\n  }\n\n  async checkForPersonalOwnershipPolicy(): Promise<boolean> {\n    return await firstValueFrom(\n      this.policyService.policyAppliesToActiveUser$(PolicyType.PersonalOwnership),\n    );\n  }\n\n  protected async getAllFoldersNested(folders: FolderView[]): Promise<TreeNode<FolderView>[]> {\n    const nodes: TreeNode<FolderView>[] = [];\n    folders.forEach((f) => {\n      const folderCopy = new FolderView();\n      folderCopy.id = f.id;\n      folderCopy.revisionDate = f.revisionDate;\n      const parts = f.name != null ? f.name.replace(/^\\/+|\\/+$/g, \"\").split(NestingDelimiter) : [];\n      ServiceUtils.nestedTraverse(nodes, 0, parts, folderCopy, null, NestingDelimiter);\n    });\n    return nodes;\n  }\n\n  async getFolderNested(id: string): Promise<TreeNode<FolderView>> {\n    const folders = await this.getAllFoldersNested(\n      await firstValueFrom(this.folderService.folderViews$),\n    );\n    return ServiceUtils.getTreeNodeObjectFromList(folders, id) as TreeNode<FolderView>;\n  }\n}\n","import { VaultFilter } from \"@bitwarden/angular/vault/vault-filter/models/vault-filter.model\";\nimport { VaultFilterService as BaseVaultFilterService } from \"@bitwarden/angular/vault/vault-filter/services/vault-filter.service\";\nimport { OrganizationService } from \"@bitwarden/common/admin-console/abstractions/organization/organization.service.abstraction\";\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { StateProvider } from \"@bitwarden/common/platform/state\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\n\nexport class VaultFilterService extends BaseVaultFilterService {\n  vaultFilter: VaultFilter = new VaultFilter();\n\n  allVaults = \"allVaults\";\n  myVault = \"myVault\";\n\n  constructor(\n    organizationService: OrganizationService,\n    folderService: FolderService,\n    cipherService: CipherService,\n    collectionService: CollectionService,\n    policyService: PolicyService,\n    stateProvider: StateProvider,\n    private accountService: AccountService,\n  ) {\n    super(\n      organizationService,\n      folderService,\n      cipherService,\n      collectionService,\n      policyService,\n      stateProvider,\n    );\n    this.vaultFilter.myVaultOnly = false;\n    this.vaultFilter.selectedOrganizationId = null;\n\n    this.accountService.activeAccount$.subscribe((account) => {\n      this.setVaultFilter(this.allVaults);\n    });\n  }\n\n  getVaultFilter() {\n    return this.vaultFilter;\n  }\n\n  setVaultFilter(filter: string) {\n    if (filter === this.allVaults) {\n      this.vaultFilter.myVaultOnly = false;\n      this.vaultFilter.selectedOrganizationId = null;\n    } else if (filter === this.myVault) {\n      this.vaultFilter.myVaultOnly = true;\n      this.vaultFilter.selectedOrganizationId = null;\n    } else {\n      this.vaultFilter.myVaultOnly = false;\n      this.vaultFilter.selectedOrganizationId = filter;\n    }\n  }\n\n  clear() {\n    this.setVaultFilter(this.allVaults);\n  }\n\n  filterCipherForSelectedVault(cipher: CipherView) {\n    if (!this.vaultFilter.selectedOrganizationId && !this.vaultFilter.myVaultOnly) {\n      return false;\n    }\n    if (this.vaultFilter.selectedOrganizationId) {\n      if (cipher.organizationId === this.vaultFilter.selectedOrganizationId) {\n        return false;\n      }\n    } else if (this.vaultFilter.myVaultOnly) {\n      if (!cipher.organizationId) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n","import { VaultTimeoutService } from \"@bitwarden/common/abstractions/vault-timeout/vault-timeout.service\";\nimport { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { PasswordGenerationServiceAbstraction } from \"@bitwarden/common/tools/generator/password\";\n\nimport { openUnlockPopout } from \"../auth/popup/utils/auth-popout-window\";\nimport { LockedVaultPendingNotificationsData } from \"../autofill/background/abstractions/notification.background\";\nimport { BrowserApi } from \"../platform/browser/browser-api\";\n\nimport MainBackground from \"./main.background\";\n\nexport default class CommandsBackground {\n  private isSafari: boolean;\n  private isVivaldi: boolean;\n\n  constructor(\n    private main: MainBackground,\n    private passwordGenerationService: PasswordGenerationServiceAbstraction,\n    private platformUtilsService: PlatformUtilsService,\n    private vaultTimeoutService: VaultTimeoutService,\n    private authService: AuthService,\n  ) {\n    this.isSafari = this.platformUtilsService.isSafari();\n    this.isVivaldi = this.platformUtilsService.isVivaldi();\n  }\n\n  async init() {\n    BrowserApi.messageListener(\"commands.background\", (msg: any) => {\n      if (msg.command === \"unlockCompleted\" && msg.data.target === \"commands.background\") {\n        this.processCommand(\n          msg.data.commandToRetry.message.command,\n          msg.data.commandToRetry.sender,\n        ).catch((error) => this.main.logService.error(error));\n      }\n    });\n\n    if (chrome && chrome.commands) {\n      chrome.commands.onCommand.addListener(async (command: string) => {\n        await this.processCommand(command);\n      });\n    }\n  }\n\n  private async processCommand(command: string, sender?: chrome.runtime.MessageSender) {\n    switch (command) {\n      case \"generate_password\":\n        await this.generatePasswordToClipboard();\n        break;\n      case \"autofill_login\":\n        await this.autoFillLogin(sender ? sender.tab : null);\n        break;\n      case \"open_popup\":\n        await this.openPopup();\n        break;\n      case \"lock_vault\":\n        await this.vaultTimeoutService.lock();\n        break;\n      default:\n        break;\n    }\n  }\n\n  private async generatePasswordToClipboard() {\n    const options = (await this.passwordGenerationService.getOptions())?.[0] ?? {};\n    const password = await this.passwordGenerationService.generatePassword(options);\n    this.platformUtilsService.copyToClipboard(password, { window: window });\n    await this.passwordGenerationService.addHistory(password);\n  }\n\n  private async autoFillLogin(tab?: chrome.tabs.Tab) {\n    if (!tab) {\n      tab = await BrowserApi.getTabFromCurrentWindowId();\n    }\n\n    if (tab == null) {\n      return;\n    }\n\n    if ((await this.authService.getAuthStatus()) < AuthenticationStatus.Unlocked) {\n      const retryMessage: LockedVaultPendingNotificationsData = {\n        commandToRetry: {\n          message: { command: \"autofill_login\" },\n          sender: { tab: tab },\n        },\n        target: \"commands.background\",\n      };\n      await BrowserApi.tabSendMessageData(\n        tab,\n        \"addToLockedVaultPendingNotifications\",\n        retryMessage,\n      );\n\n      await openUnlockPopout(tab);\n      return;\n    }\n\n    await this.main.collectPageDetailsForContentScript(tab, \"autofill_cmd\");\n  }\n\n  private async openPopup() {\n    // Chrome APIs cannot open popup\n    if (!this.isSafari) {\n      return;\n    }\n\n    await this.main.openPopup();\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport { NotificationsService } from \"@bitwarden/common/abstractions/notifications.service\";\nimport { VaultTimeoutService } from \"@bitwarden/common/abstractions/vault-timeout/vault-timeout.service\";\nimport { AccountService } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { VaultTimeoutAction } from \"@bitwarden/common/enums/vault-timeout-action.enum\";\n\nimport { BrowserStateService } from \"../platform/services/abstractions/browser-state.service\";\n\nconst IdleInterval = 60 * 5; // 5 minutes\n\nexport default class IdleBackground {\n  private idle: typeof chrome.idle | typeof browser.idle | null;\n  private idleTimer: number = null;\n  private idleState = \"active\";\n\n  constructor(\n    private vaultTimeoutService: VaultTimeoutService,\n    private stateService: BrowserStateService,\n    private notificationsService: NotificationsService,\n    private accountService: AccountService,\n  ) {\n    this.idle = chrome.idle || (browser != null ? browser.idle : null);\n  }\n\n  async init() {\n    if (!this.idle) {\n      return;\n    }\n\n    const idleHandler = (newState: string) => {\n      if (newState === \"active\") {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.notificationsService.reconnectFromActivity();\n      } else {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.notificationsService.disconnectFromInactivity();\n      }\n    };\n    if (this.idle.onStateChanged && this.idle.setDetectionInterval) {\n      this.idle.setDetectionInterval(IdleInterval);\n      this.idle.onStateChanged.addListener(idleHandler);\n    } else {\n      this.pollIdle(idleHandler);\n    }\n\n    if (this.idle.onStateChanged) {\n      this.idle.onStateChanged.addListener(\n        async (newState: chrome.idle.IdleState | browser.idle.IdleState) => {\n          if (newState === \"locked\") {\n            // Need to check if any of the current users have their timeout set to `onLocked`\n            const allUsers = await firstValueFrom(this.accountService.accounts$);\n            for (const userId in allUsers) {\n              // If the screen is locked or the screensaver activates\n              const timeout = await this.stateService.getVaultTimeout({ userId: userId });\n              if (timeout === -2) {\n                // On System Lock vault timeout option\n                const action = await this.stateService.getVaultTimeoutAction({ userId: userId });\n                if (action === VaultTimeoutAction.LogOut) {\n                  await this.vaultTimeoutService.logOut(userId);\n                } else {\n                  await this.vaultTimeoutService.lock(userId);\n                }\n              }\n            }\n          }\n        },\n      );\n    }\n  }\n\n  private pollIdle(handler: (newState: string) => void) {\n    if (this.idleTimer != null) {\n      window.clearTimeout(this.idleTimer);\n      this.idleTimer = null;\n    }\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.idle.queryState(IdleInterval, (state: string) => {\n      if (state !== this.idleState) {\n        this.idleState = state;\n        handler(state);\n      }\n      this.idleTimer = window.setTimeout(() => this.pollIdle(handler), 5000);\n    });\n  }\n}\n","import { AuthService } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { StateService } from \"@bitwarden/common/platform/abstractions/state.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { EncString } from \"@bitwarden/common/platform/models/domain/enc-string\";\nimport { SymmetricCryptoKey } from \"@bitwarden/common/platform/models/domain/symmetric-crypto-key\";\nimport { UserKey, MasterKey } from \"@bitwarden/common/types/key\";\n\nimport { BrowserApi } from \"../platform/browser/browser-api\";\n\nimport RuntimeBackground from \"./runtime.background\";\n\nconst MessageValidTimeout = 10 * 1000;\nconst EncryptionAlgorithm = \"sha1\";\n\ntype Message = {\n  command: string;\n\n  // Filled in by this service\n  userId?: string;\n  timestamp?: number;\n\n  // Used for sharing secret\n  publicKey?: string;\n};\n\ntype OuterMessage = {\n  message: Message | EncString;\n  appId: string;\n};\n\ntype ReceiveMessage = {\n  timestamp: number;\n  command: string;\n  response?: any;\n\n  // Unlock key\n  keyB64?: string;\n  userKeyB64?: string;\n};\n\ntype ReceiveMessageOuter = {\n  command: string;\n  appId: string;\n\n  // Should only have one of these.\n  message?: EncString;\n  sharedSecret?: string;\n};\n\nexport class NativeMessagingBackground {\n  private connected = false;\n  private connecting: boolean;\n  private port: browser.runtime.Port | chrome.runtime.Port;\n\n  private resolver: any = null;\n  private privateKey: Uint8Array = null;\n  private publicKey: Uint8Array = null;\n  private secureSetupResolve: any = null;\n  private sharedSecret: SymmetricCryptoKey;\n  private appId: string;\n  private validatingFingerprint: boolean;\n\n  constructor(\n    private cryptoService: CryptoService,\n    private cryptoFunctionService: CryptoFunctionService,\n    private runtimeBackground: RuntimeBackground,\n    private i18nService: I18nService,\n    private messagingService: MessagingService,\n    private appIdService: AppIdService,\n    private platformUtilsService: PlatformUtilsService,\n    private stateService: StateService,\n    private logService: LogService,\n    private authService: AuthService,\n  ) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.stateService.setBiometricFingerprintValidated(false);\n\n    if (chrome?.permissions?.onAdded) {\n      // Reload extension to activate nativeMessaging\n      chrome.permissions.onAdded.addListener((permissions) => {\n        if (permissions.permissions?.includes(\"nativeMessaging\")) {\n          BrowserApi.reloadExtension(null);\n        }\n      });\n    }\n  }\n\n  async connect() {\n    this.appId = await this.appIdService.getAppId();\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.stateService.setBiometricFingerprintValidated(false);\n\n    return new Promise<void>((resolve, reject) => {\n      this.port = BrowserApi.connectNative(\"com.8bit.bitwarden\");\n\n      this.connecting = true;\n\n      const connectedCallback = () => {\n        this.connected = true;\n        this.connecting = false;\n        resolve();\n      };\n\n      // Safari has a bundled native component which is always available, no need to\n      // check if the desktop app is running.\n      if (this.platformUtilsService.isSafari()) {\n        connectedCallback();\n      }\n\n      this.port.onMessage.addListener(async (message: ReceiveMessageOuter) => {\n        switch (message.command) {\n          case \"connected\":\n            connectedCallback();\n            break;\n          case \"disconnected\":\n            if (this.connecting) {\n              reject(\"startDesktop\");\n            }\n            this.connected = false;\n            this.port.disconnect();\n            break;\n          case \"setupEncryption\": {\n            // Ignore since it belongs to another device\n            if (message.appId !== this.appId) {\n              return;\n            }\n\n            const encrypted = Utils.fromB64ToArray(message.sharedSecret);\n            const decrypted = await this.cryptoFunctionService.rsaDecrypt(\n              encrypted,\n              this.privateKey,\n              EncryptionAlgorithm,\n            );\n\n            if (this.validatingFingerprint) {\n              this.validatingFingerprint = false;\n              // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n              // eslint-disable-next-line @typescript-eslint/no-floating-promises\n              this.stateService.setBiometricFingerprintValidated(true);\n            }\n            this.sharedSecret = new SymmetricCryptoKey(decrypted);\n            this.secureSetupResolve();\n            break;\n          }\n          case \"invalidateEncryption\":\n            // Ignore since it belongs to another device\n            if (message.appId !== this.appId) {\n              return;\n            }\n\n            this.sharedSecret = null;\n            this.privateKey = null;\n            this.connected = false;\n\n            this.messagingService.send(\"showDialog\", {\n              title: { key: \"nativeMessagingInvalidEncryptionTitle\" },\n              content: { key: \"nativeMessagingInvalidEncryptionDesc\" },\n              acceptButtonText: { key: \"ok\" },\n              cancelButtonText: null,\n              type: \"danger\",\n            });\n            break;\n          case \"verifyFingerprint\": {\n            if (this.sharedSecret == null) {\n              this.validatingFingerprint = true;\n              // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n              // eslint-disable-next-line @typescript-eslint/no-floating-promises\n              this.showFingerprintDialog();\n            }\n            break;\n          }\n          case \"wrongUserId\":\n            this.showWrongUserDialog();\n            break;\n          default:\n            // Ignore since it belongs to another device\n            if (!this.platformUtilsService.isSafari() && message.appId !== this.appId) {\n              return;\n            }\n\n            // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.onMessage(message.message);\n        }\n      });\n\n      this.port.onDisconnect.addListener((p: any) => {\n        let error;\n        if (BrowserApi.isWebExtensionsApi) {\n          error = p.error.message;\n        } else {\n          error = chrome.runtime.lastError.message;\n        }\n\n        this.sharedSecret = null;\n        this.privateKey = null;\n        this.connected = false;\n\n        const reason = error != null ? \"desktopIntegrationDisabled\" : null;\n        reject(reason);\n      });\n    });\n  }\n\n  showWrongUserDialog() {\n    this.messagingService.send(\"showDialog\", {\n      title: { key: \"nativeMessagingWrongUserTitle\" },\n      content: { key: \"nativeMessagingWrongUserDesc\" },\n      acceptButtonText: { key: \"ok\" },\n      cancelButtonText: null,\n      type: \"danger\",\n    });\n  }\n\n  async send(message: Message) {\n    if (!this.connected) {\n      await this.connect();\n    }\n\n    message.userId = await this.stateService.getUserId();\n    message.timestamp = Date.now();\n\n    if (this.platformUtilsService.isSafari()) {\n      this.postMessage(message as any);\n    } else {\n      this.postMessage({ appId: this.appId, message: await this.encryptMessage(message) });\n    }\n  }\n\n  async encryptMessage(message: Message) {\n    if (this.sharedSecret == null) {\n      await this.secureCommunication();\n    }\n\n    return await this.cryptoService.encrypt(JSON.stringify(message), this.sharedSecret);\n  }\n\n  getResponse(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.resolver = resolve;\n    });\n  }\n\n  private postMessage(message: OuterMessage) {\n    // Wrap in try-catch to when the port disconnected without triggering `onDisconnect`.\n    try {\n      const msg: any = message;\n      if (message.message instanceof EncString) {\n        // Alternative, backwards-compatible serialization of EncString\n        msg.message = {\n          encryptedString: message.message.encryptedString,\n          encryptionType: message.message.encryptionType,\n          data: message.message.data,\n          iv: message.message.iv,\n          mac: message.message.mac,\n        };\n      }\n      this.port.postMessage(msg);\n    } catch (e) {\n      this.logService.error(\"NativeMessaging port disconnected, disconnecting.\");\n\n      this.sharedSecret = null;\n      this.privateKey = null;\n      this.connected = false;\n\n      this.messagingService.send(\"showDialog\", {\n        title: { key: \"nativeMessagingInvalidEncryptionTitle\" },\n        content: { key: \"nativeMessagingInvalidEncryptionDesc\" },\n        acceptButtonText: { key: \"ok\" },\n        cancelButtonText: null,\n        type: \"danger\",\n      });\n    }\n  }\n\n  private async onMessage(rawMessage: ReceiveMessage | EncString) {\n    let message = rawMessage as ReceiveMessage;\n    if (!this.platformUtilsService.isSafari()) {\n      message = JSON.parse(\n        await this.cryptoService.decryptToUtf8(rawMessage as EncString, this.sharedSecret),\n      );\n    }\n\n    if (Math.abs(message.timestamp - Date.now()) > MessageValidTimeout) {\n      this.logService.error(\"NativeMessage is to old, ignoring.\");\n      return;\n    }\n\n    switch (message.command) {\n      case \"biometricUnlock\": {\n        if (message.response === \"not enabled\") {\n          this.messagingService.send(\"showDialog\", {\n            title: { key: \"biometricsNotEnabledTitle\" },\n            content: { key: \"biometricsNotEnabledDesc\" },\n            acceptButtonText: { key: \"ok\" },\n            cancelButtonText: null,\n            type: \"danger\",\n          });\n          break;\n        } else if (message.response === \"not supported\") {\n          this.messagingService.send(\"showDialog\", {\n            title: { key: \"biometricsNotSupportedTitle\" },\n            content: { key: \"biometricsNotSupportedDesc\" },\n            acceptButtonText: { key: \"ok\" },\n            cancelButtonText: null,\n            type: \"danger\",\n          });\n          break;\n        } else if (message.response === \"canceled\") {\n          break;\n        }\n\n        // Check for initial setup of biometric unlock\n        const enabled = await this.stateService.getBiometricUnlock();\n        if (enabled === null || enabled === false) {\n          if (message.response === \"unlocked\") {\n            await this.stateService.setBiometricUnlock(true);\n          }\n          break;\n        }\n\n        // Ignore unlock if already unlocked\n        if ((await this.authService.getAuthStatus()) === AuthenticationStatus.Unlocked) {\n          break;\n        }\n\n        if (message.response === \"unlocked\") {\n          try {\n            if (message.userKeyB64) {\n              const userKey = new SymmetricCryptoKey(\n                Utils.fromB64ToArray(message.userKeyB64),\n              ) as UserKey;\n              await this.cryptoService.setUserKey(userKey);\n            } else if (message.keyB64) {\n              // Backwards compatibility to support cases in which the user hasn't updated their desktop app\n              // TODO: Remove after 2023.10 release (https://bitwarden.atlassian.net/browse/PM-3472)\n              let encUserKey = await this.stateService.getEncryptedCryptoSymmetricKey();\n              encUserKey ||= await this.stateService.getMasterKeyEncryptedUserKey();\n              if (!encUserKey) {\n                throw new Error(\"No encrypted user key found\");\n              }\n              const masterKey = new SymmetricCryptoKey(\n                Utils.fromB64ToArray(message.keyB64),\n              ) as MasterKey;\n              const userKey = await this.cryptoService.decryptUserKeyWithMasterKey(\n                masterKey,\n                new EncString(encUserKey),\n              );\n              await this.cryptoService.setMasterKey(masterKey);\n              await this.cryptoService.setUserKey(userKey);\n            } else {\n              throw new Error(\"No key received\");\n            }\n          } catch (e) {\n            this.logService.error(\"Unable to set key: \" + e);\n            this.messagingService.send(\"showDialog\", {\n              title: { key: \"biometricsFailedTitle\" },\n              content: { key: \"biometricsFailedDesc\" },\n              acceptButtonText: { key: \"ok\" },\n              cancelButtonText: null,\n              type: \"danger\",\n            });\n\n            // Exit early\n            if (this.resolver) {\n              this.resolver(message);\n            }\n            return;\n          }\n\n          // Verify key is correct by attempting to decrypt a secret\n          try {\n            await this.cryptoService.getFingerprint(await this.stateService.getUserId());\n          } catch (e) {\n            this.logService.error(\"Unable to verify key: \" + e);\n            await this.cryptoService.clearKeys();\n            this.showWrongUserDialog();\n\n            // Exit early\n            if (this.resolver) {\n              this.resolver(message);\n            }\n            return;\n          }\n\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.runtimeBackground.processMessage({ command: \"unlocked\" }, null);\n        }\n        break;\n      }\n      default:\n        this.logService.error(\"NativeMessage, got unknown command: \" + message.command);\n        break;\n    }\n\n    if (this.resolver) {\n      this.resolver(message);\n    }\n  }\n\n  private async secureCommunication() {\n    const [publicKey, privateKey] = await this.cryptoFunctionService.rsaGenerateKeyPair(2048);\n    this.publicKey = publicKey;\n    this.privateKey = privateKey;\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.sendUnencrypted({\n      command: \"setupEncryption\",\n      publicKey: Utils.fromBufferToB64(publicKey),\n      userId: await this.stateService.getUserId(),\n    });\n\n    return new Promise((resolve, reject) => (this.secureSetupResolve = resolve));\n  }\n\n  private async sendUnencrypted(message: Message) {\n    if (!this.connected) {\n      await this.connect();\n    }\n\n    message.timestamp = Date.now();\n\n    this.postMessage({ appId: this.appId, message: message });\n  }\n\n  private async showFingerprintDialog() {\n    const fingerprint = await this.cryptoService.getFingerprint(\n      await this.stateService.getUserId(),\n      this.publicKey,\n    );\n\n    this.messagingService.send(\"showNativeMessagingFinterprintDialog\", {\n      fingerprint: fingerprint,\n    });\n  }\n}\n","type Runner<T> = (abortController: AbortController) => Promise<T>;\n\n/**\n * Manages abort controllers for long running tasks and allow separate\n * execution contexts to abort each other by using ids.\n */\nexport class AbortManager {\n  private abortControllers = new Map<string, AbortController>();\n\n  runWithAbortController<T>(id: string, runner: Runner<T>): Promise<T> {\n    const abortController = new AbortController();\n    this.abortControllers.set(id, abortController);\n    return runner(abortController).finally(() => {\n      this.abortControllers.delete(id);\n    });\n  }\n\n  abort(id: string) {\n    this.abortControllers.get(id)?.abort();\n  }\n}\n","import { NotificationsService } from \"@bitwarden/common/abstractions/notifications.service\";\nimport { AutofillSettingsServiceAbstraction } from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport { ConfigServiceAbstraction } from \"@bitwarden/common/platform/abstractions/config/config.service.abstraction\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { SystemService } from \"@bitwarden/common/platform/abstractions/system.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\n\nimport {\n  closeUnlockPopout,\n  openSsoAuthResultPopout,\n  openTwoFactorAuthPopout,\n} from \"../auth/popup/utils/auth-popout-window\";\nimport { LockedVaultPendingNotificationsData } from \"../autofill/background/abstractions/notification.background\";\nimport { AutofillService } from \"../autofill/services/abstractions/autofill.service\";\nimport { AutofillOverlayVisibility } from \"../autofill/utils/autofill-overlay.enum\";\nimport { BrowserApi } from \"../platform/browser/browser-api\";\nimport { BrowserStateService } from \"../platform/services/abstractions/browser-state.service\";\nimport { BrowserEnvironmentService } from \"../platform/services/browser-environment.service\";\nimport BrowserPlatformUtilsService from \"../platform/services/browser-platform-utils.service\";\nimport { AbortManager } from \"../vault/background/abort-manager\";\nimport { Fido2Service } from \"../vault/services/abstractions/fido2.service\";\n\nimport MainBackground from \"./main.background\";\n\nexport default class RuntimeBackground {\n  private autofillTimeout: any;\n  private pageDetailsToAutoFill: any[] = [];\n  private onInstalledReason: string = null;\n  private lockedVaultPendingNotifications: LockedVaultPendingNotificationsData[] = [];\n  private abortManager = new AbortManager();\n\n  constructor(\n    private main: MainBackground,\n    private autofillService: AutofillService,\n    private platformUtilsService: BrowserPlatformUtilsService,\n    private i18nService: I18nService,\n    private notificationsService: NotificationsService,\n    private stateService: BrowserStateService,\n    private autofillSettingsService: AutofillSettingsServiceAbstraction,\n    private systemService: SystemService,\n    private environmentService: BrowserEnvironmentService,\n    private messagingService: MessagingService,\n    private logService: LogService,\n    private configService: ConfigServiceAbstraction,\n    private fido2Service: Fido2Service,\n  ) {\n    // onInstalled listener must be wired up before anything else, so we do it in the ctor\n    chrome.runtime.onInstalled.addListener((details: any) => {\n      this.onInstalledReason = details.reason;\n    });\n  }\n\n  async init() {\n    if (!chrome.runtime) {\n      return;\n    }\n\n    await this.checkOnInstalled();\n    const backgroundMessageListener = (\n      msg: any,\n      sender: chrome.runtime.MessageSender,\n      sendResponse: any,\n    ) => {\n      const messagesWithResponse = [\n        \"checkFido2FeatureEnabled\",\n        \"fido2RegisterCredentialRequest\",\n        \"fido2GetCredentialRequest\",\n      ];\n\n      if (messagesWithResponse.includes(msg.command)) {\n        this.processMessage(msg, sender).then(\n          (value) => sendResponse({ result: value }),\n          (error) => sendResponse({ error: { ...error, message: error.message } }),\n        );\n        return true;\n      }\n\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.processMessage(msg, sender);\n      return false;\n    };\n\n    BrowserApi.messageListener(\"runtime.background\", backgroundMessageListener);\n    if (this.main.popupOnlyContext) {\n      (window as any).bitwardenBackgroundMessageListener = backgroundMessageListener;\n    }\n  }\n\n  async processMessage(msg: any, sender: chrome.runtime.MessageSender) {\n    switch (msg.command) {\n      case \"loggedIn\":\n      case \"unlocked\": {\n        let item: LockedVaultPendingNotificationsData;\n\n        if (this.lockedVaultPendingNotifications?.length > 0) {\n          item = this.lockedVaultPendingNotifications.pop();\n          await closeUnlockPopout();\n        }\n\n        await this.notificationsService.updateConnection(msg.command === \"loggedIn\");\n        await this.main.refreshBadge();\n        await this.main.refreshMenu(false);\n        this.systemService.cancelProcessReload();\n\n        if (item) {\n          await BrowserApi.focusWindow(item.commandToRetry.sender.tab.windowId);\n          await BrowserApi.focusTab(item.commandToRetry.sender.tab.id);\n          await BrowserApi.tabSendMessageData(\n            item.commandToRetry.sender.tab,\n            \"unlockCompleted\",\n            item,\n          );\n        }\n        break;\n      }\n      case \"addToLockedVaultPendingNotifications\":\n        this.lockedVaultPendingNotifications.push(msg.data);\n        break;\n      case \"logout\":\n        await this.main.logout(msg.expired, msg.userId);\n        break;\n      case \"syncCompleted\":\n        if (msg.successfully) {\n          setTimeout(async () => {\n            await this.main.refreshBadge();\n            await this.main.refreshMenu();\n          }, 2000);\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.main.avatarUpdateService.loadColorFromState();\n          this.configService.triggerServerConfigFetch();\n        }\n        break;\n      case \"openPopup\":\n        await this.main.openPopup();\n        break;\n      case \"triggerAutofillScriptInjection\":\n        await this.autofillService.injectAutofillScripts(sender.tab, sender.frameId);\n        break;\n      case \"bgCollectPageDetails\":\n        await this.main.collectPageDetailsForContentScript(sender.tab, msg.sender, sender.frameId);\n        break;\n      case \"bgUpdateContextMenu\":\n      case \"editedCipher\":\n      case \"addedCipher\":\n      case \"deletedCipher\":\n        await this.main.refreshBadge();\n        await this.main.refreshMenu();\n        break;\n      case \"bgReseedStorage\":\n        await this.main.reseedStorage();\n        break;\n      case \"collectPageDetailsResponse\":\n        switch (msg.sender) {\n          case \"autofiller\":\n          case \"autofill_cmd\": {\n            // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.stateService.setLastActive(new Date().getTime());\n            const totpCode = await this.autofillService.doAutoFillActiveTab(\n              [\n                {\n                  frameId: sender.frameId,\n                  tab: msg.tab,\n                  details: msg.details,\n                },\n              ],\n              msg.sender === \"autofill_cmd\",\n            );\n            if (totpCode != null) {\n              this.platformUtilsService.copyToClipboard(totpCode, { window: window });\n            }\n            break;\n          }\n          case \"autofill_card\": {\n            await this.autofillService.doAutoFillActiveTab(\n              [\n                {\n                  frameId: sender.frameId,\n                  tab: msg.tab,\n                  details: msg.details,\n                },\n              ],\n              false,\n              CipherType.Card,\n            );\n            break;\n          }\n          case \"autofill_identity\": {\n            await this.autofillService.doAutoFillActiveTab(\n              [\n                {\n                  frameId: sender.frameId,\n                  tab: msg.tab,\n                  details: msg.details,\n                },\n              ],\n              false,\n              CipherType.Identity,\n            );\n            break;\n          }\n          case \"contextMenu\":\n            clearTimeout(this.autofillTimeout);\n            this.pageDetailsToAutoFill.push({\n              frameId: sender.frameId,\n              tab: msg.tab,\n              details: msg.details,\n            });\n            this.autofillTimeout = setTimeout(async () => await this.autofillPage(msg.tab), 300);\n            break;\n          default:\n            break;\n        }\n        break;\n      case \"authResult\": {\n        const vaultUrl = this.environmentService.getWebVaultUrl();\n\n        if (msg.referrer == null || Utils.getHostname(vaultUrl) !== msg.referrer) {\n          return;\n        }\n\n        if (msg.lastpass) {\n          this.messagingService.send(\"importCallbackLastPass\", {\n            code: msg.code,\n            state: msg.state,\n          });\n        } else {\n          try {\n            await openSsoAuthResultPopout(msg);\n          } catch {\n            this.logService.error(\"Unable to open sso popout tab\");\n          }\n        }\n        break;\n      }\n      case \"webAuthnResult\": {\n        const vaultUrl = this.environmentService.getWebVaultUrl();\n\n        if (msg.referrer == null || Utils.getHostname(vaultUrl) !== msg.referrer) {\n          return;\n        }\n\n        await openTwoFactorAuthPopout(msg);\n        break;\n      }\n      case \"reloadPopup\":\n        this.messagingService.send(\"reloadPopup\");\n        break;\n      case \"emailVerificationRequired\":\n        this.messagingService.send(\"showDialog\", {\n          title: { key: \"emailVerificationRequired\" },\n          content: { key: \"emailVerificationRequiredDesc\" },\n          acceptButtonText: { key: \"ok\" },\n          cancelButtonText: null,\n          type: \"info\",\n        });\n        break;\n      case \"getClickedElementResponse\":\n        this.platformUtilsService.copyToClipboard(msg.identifier, { window: window });\n        break;\n      case \"triggerFido2ContentScriptInjection\":\n        await this.fido2Service.injectFido2ContentScripts(sender);\n        break;\n      case \"fido2AbortRequest\":\n        this.abortManager.abort(msg.abortedRequestId);\n        break;\n      case \"checkFido2FeatureEnabled\":\n        return await this.main.fido2ClientService.isFido2FeatureEnabled(msg.hostname, msg.origin);\n      case \"fido2RegisterCredentialRequest\":\n        return await this.abortManager.runWithAbortController(\n          msg.requestId,\n          async (abortController) => {\n            try {\n              return await this.main.fido2ClientService.createCredential(\n                msg.data,\n                sender.tab,\n                abortController,\n              );\n            } finally {\n              await BrowserApi.focusTab(sender.tab.id);\n              await BrowserApi.focusWindow(sender.tab.windowId);\n            }\n          },\n        );\n      case \"fido2GetCredentialRequest\":\n        return await this.abortManager.runWithAbortController(\n          msg.requestId,\n          async (abortController) => {\n            try {\n              return await this.main.fido2ClientService.assertCredential(\n                msg.data,\n                sender.tab,\n                abortController,\n              );\n            } finally {\n              await BrowserApi.focusTab(sender.tab.id);\n              await BrowserApi.focusWindow(sender.tab.windowId);\n            }\n          },\n        );\n      case \"switchAccount\": {\n        await this.main.switchAccount(msg.userId);\n      }\n    }\n  }\n\n  private async autofillPage(tabToAutoFill: chrome.tabs.Tab) {\n    const totpCode = await this.autofillService.doAutoFill({\n      tab: tabToAutoFill,\n      cipher: this.main.loginToAutoFill,\n      pageDetails: this.pageDetailsToAutoFill,\n      fillNewPassword: true,\n      allowTotpAutofill: true,\n    });\n\n    if (totpCode != null) {\n      this.platformUtilsService.copyToClipboard(totpCode, { window: window });\n    }\n\n    // reset\n    this.main.loginToAutoFill = null;\n    this.pageDetailsToAutoFill = [];\n  }\n\n  private async checkOnInstalled() {\n    setTimeout(async () => {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.autofillService.loadAutofillScriptsOnInstall();\n\n      if (this.onInstalledReason != null) {\n        if (this.onInstalledReason === \"install\") {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          BrowserApi.createNewTab(\"https://bitwarden.com/browser-start/\");\n          await this.autofillSettingsService.setInlineMenuVisibility(\n            AutofillOverlayVisibility.OnFieldFocus,\n          );\n\n          if (await this.environmentService.hasManagedEnvironment()) {\n            await this.environmentService.setUrlsToManagedEnvironment();\n          }\n        }\n\n        this.onInstalledReason = null;\n      }\n    }, 100);\n  }\n}\n","import { firstValueFrom } from \"rxjs\";\n\nimport {\n  PinCryptoServiceAbstraction,\n  PinCryptoService,\n  LoginStrategyServiceAbstraction,\n  LoginStrategyService,\n  AuthRequestServiceAbstraction,\n  AuthRequestService,\n} from \"@bitwarden/auth/common\";\nimport { AvatarUpdateService as AvatarUpdateServiceAbstraction } from \"@bitwarden/common/abstractions/account/avatar-update.service\";\nimport { ApiService as ApiServiceAbstraction } from \"@bitwarden/common/abstractions/api.service\";\nimport { AuditService as AuditServiceAbstraction } from \"@bitwarden/common/abstractions/audit.service\";\nimport { EventCollectionService as EventCollectionServiceAbstraction } from \"@bitwarden/common/abstractions/event/event-collection.service\";\nimport { EventUploadService as EventUploadServiceAbstraction } from \"@bitwarden/common/abstractions/event/event-upload.service\";\nimport { NotificationsService as NotificationsServiceAbstraction } from \"@bitwarden/common/abstractions/notifications.service\";\nimport { SearchService as SearchServiceAbstraction } from \"@bitwarden/common/abstractions/search.service\";\nimport { SettingsService as SettingsServiceAbstraction } from \"@bitwarden/common/abstractions/settings.service\";\nimport { VaultTimeoutSettingsService as VaultTimeoutSettingsServiceAbstraction } from \"@bitwarden/common/abstractions/vault-timeout/vault-timeout-settings.service\";\nimport { InternalOrganizationServiceAbstraction } from \"@bitwarden/common/admin-console/abstractions/organization/organization.service.abstraction\";\nimport { PolicyApiServiceAbstraction } from \"@bitwarden/common/admin-console/abstractions/policy/policy-api.service.abstraction\";\nimport { InternalPolicyService as InternalPolicyServiceAbstraction } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { ProviderService as ProviderServiceAbstraction } from \"@bitwarden/common/admin-console/abstractions/provider.service\";\nimport { PolicyApiService } from \"@bitwarden/common/admin-console/services/policy/policy-api.service\";\nimport { ProviderService } from \"@bitwarden/common/admin-console/services/provider.service\";\nimport { AccountService as AccountServiceAbstraction } from \"@bitwarden/common/auth/abstractions/account.service\";\nimport { AuthService as AuthServiceAbstraction } from \"@bitwarden/common/auth/abstractions/auth.service\";\nimport { DeviceTrustCryptoServiceAbstraction } from \"@bitwarden/common/auth/abstractions/device-trust-crypto.service.abstraction\";\nimport { DevicesServiceAbstraction } from \"@bitwarden/common/auth/abstractions/devices/devices.service.abstraction\";\nimport { DevicesApiServiceAbstraction } from \"@bitwarden/common/auth/abstractions/devices-api.service.abstraction\";\nimport { KeyConnectorService as KeyConnectorServiceAbstraction } from \"@bitwarden/common/auth/abstractions/key-connector.service\";\nimport { SsoLoginServiceAbstraction } from \"@bitwarden/common/auth/abstractions/sso-login.service.abstraction\";\nimport { TokenService as TokenServiceAbstraction } from \"@bitwarden/common/auth/abstractions/token.service\";\nimport { TwoFactorService as TwoFactorServiceAbstraction } from \"@bitwarden/common/auth/abstractions/two-factor.service\";\nimport { UserVerificationApiServiceAbstraction } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification-api.service.abstraction\";\nimport { UserVerificationService as UserVerificationServiceAbstraction } from \"@bitwarden/common/auth/abstractions/user-verification/user-verification.service.abstraction\";\nimport { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { ForceSetPasswordReason } from \"@bitwarden/common/auth/models/domain/force-set-password-reason\";\nimport { AccountServiceImplementation } from \"@bitwarden/common/auth/services/account.service\";\nimport { AuthService } from \"@bitwarden/common/auth/services/auth.service\";\nimport { DeviceTrustCryptoService } from \"@bitwarden/common/auth/services/device-trust-crypto.service.implementation\";\nimport { DevicesServiceImplementation } from \"@bitwarden/common/auth/services/devices/devices.service.implementation\";\nimport { DevicesApiServiceImplementation } from \"@bitwarden/common/auth/services/devices-api.service.implementation\";\nimport { KeyConnectorService } from \"@bitwarden/common/auth/services/key-connector.service\";\nimport { SsoLoginService } from \"@bitwarden/common/auth/services/sso-login.service\";\nimport { TokenService } from \"@bitwarden/common/auth/services/token.service\";\nimport { TwoFactorService } from \"@bitwarden/common/auth/services/two-factor.service\";\nimport { UserVerificationApiService } from \"@bitwarden/common/auth/services/user-verification/user-verification-api.service\";\nimport { UserVerificationService } from \"@bitwarden/common/auth/services/user-verification/user-verification.service\";\nimport {\n  AutofillSettingsServiceAbstraction,\n  AutofillSettingsService,\n} from \"@bitwarden/common/autofill/services/autofill-settings.service\";\nimport { AppIdService as AppIdServiceAbstraction } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { ConfigApiServiceAbstraction } from \"@bitwarden/common/platform/abstractions/config/config-api.service.abstraction\";\nimport { CryptoFunctionService as CryptoFunctionServiceAbstraction } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { CryptoService as CryptoServiceAbstraction } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { EncryptService } from \"@bitwarden/common/platform/abstractions/encrypt.service\";\nimport { FileUploadService as FileUploadServiceAbstraction } from \"@bitwarden/common/platform/abstractions/file-upload/file-upload.service\";\nimport { I18nService as I18nServiceAbstraction } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { KeyGenerationService as KeyGenerationServiceAbstraction } from \"@bitwarden/common/platform/abstractions/key-generation.service\";\nimport { LogService as LogServiceAbstraction } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { MessagingService as MessagingServiceAbstraction } from \"@bitwarden/common/platform/abstractions/messaging.service\";\nimport { PlatformUtilsService as PlatformUtilsServiceAbstraction } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport {\n  AbstractMemoryStorageService,\n  AbstractStorageService,\n  ObservableStorageService,\n} from \"@bitwarden/common/platform/abstractions/storage.service\";\nimport { SystemService as SystemServiceAbstraction } from \"@bitwarden/common/platform/abstractions/system.service\";\nimport {\n  BiometricStateService,\n  DefaultBiometricStateService,\n} from \"@bitwarden/common/platform/biometrics/biometric-state.service\";\nimport { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\nimport { AppIdService } from \"@bitwarden/common/platform/services/app-id.service\";\nimport { ConfigApiService } from \"@bitwarden/common/platform/services/config/config-api.service\";\nimport { ConsoleLogService } from \"@bitwarden/common/platform/services/console-log.service\";\nimport { ContainerService } from \"@bitwarden/common/platform/services/container.service\";\nimport { EncryptServiceImplementation } from \"@bitwarden/common/platform/services/cryptography/encrypt.service.implementation\";\nimport { MultithreadEncryptServiceImplementation } from \"@bitwarden/common/platform/services/cryptography/multithread-encrypt.service.implementation\";\nimport { FileUploadService } from \"@bitwarden/common/platform/services/file-upload/file-upload.service\";\nimport { KeyGenerationService } from \"@bitwarden/common/platform/services/key-generation.service\";\nimport { MemoryStorageService } from \"@bitwarden/common/platform/services/memory-storage.service\";\nimport { MigrationBuilderService } from \"@bitwarden/common/platform/services/migration-builder.service\";\nimport { MigrationRunner } from \"@bitwarden/common/platform/services/migration-runner\";\nimport { SystemService } from \"@bitwarden/common/platform/services/system.service\";\nimport { WebCryptoFunctionService } from \"@bitwarden/common/platform/services/web-crypto-function.service\";\nimport {\n  ActiveUserStateProvider,\n  DerivedStateProvider,\n  GlobalStateProvider,\n  SingleUserStateProvider,\n  StateProvider,\n} from \"@bitwarden/common/platform/state\";\n/* eslint-disable import/no-restricted-paths -- We need the implementation to inject, but generally these should not be accessed */\nimport { DefaultActiveUserStateProvider } from \"@bitwarden/common/platform/state/implementations/default-active-user-state.provider\";\nimport { DefaultGlobalStateProvider } from \"@bitwarden/common/platform/state/implementations/default-global-state.provider\";\nimport { DefaultSingleUserStateProvider } from \"@bitwarden/common/platform/state/implementations/default-single-user-state.provider\";\nimport { DefaultStateProvider } from \"@bitwarden/common/platform/state/implementations/default-state.provider\";\n/* eslint-enable import/no-restricted-paths */\nimport { AvatarUpdateService } from \"@bitwarden/common/services/account/avatar-update.service\";\nimport { ApiService } from \"@bitwarden/common/services/api.service\";\nimport { AuditService } from \"@bitwarden/common/services/audit.service\";\nimport { EventCollectionService } from \"@bitwarden/common/services/event/event-collection.service\";\nimport { EventUploadService } from \"@bitwarden/common/services/event/event-upload.service\";\nimport { NotificationsService } from \"@bitwarden/common/services/notifications.service\";\nimport { SearchService } from \"@bitwarden/common/services/search.service\";\nimport { VaultTimeoutSettingsService } from \"@bitwarden/common/services/vault-timeout/vault-timeout-settings.service\";\nimport {\n  PasswordGenerationService,\n  PasswordGenerationServiceAbstraction,\n} from \"@bitwarden/common/tools/generator/password\";\nimport {\n  UsernameGenerationService,\n  UsernameGenerationServiceAbstraction,\n} from \"@bitwarden/common/tools/generator/username\";\nimport {\n  PasswordStrengthService,\n  PasswordStrengthServiceAbstraction,\n} from \"@bitwarden/common/tools/password-strength\";\nimport { SendApiService } from \"@bitwarden/common/tools/send/services/send-api.service\";\nimport { SendApiService as SendApiServiceAbstraction } from \"@bitwarden/common/tools/send/services/send-api.service.abstraction\";\nimport { InternalSendService as InternalSendServiceAbstraction } from \"@bitwarden/common/tools/send/services/send.service.abstraction\";\nimport { UserId } from \"@bitwarden/common/types/guid\";\nimport { CipherService as CipherServiceAbstraction } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService as CollectionServiceAbstraction } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { Fido2AuthenticatorService as Fido2AuthenticatorServiceAbstraction } from \"@bitwarden/common/vault/abstractions/fido2/fido2-authenticator.service.abstraction\";\nimport { Fido2ClientService as Fido2ClientServiceAbstraction } from \"@bitwarden/common/vault/abstractions/fido2/fido2-client.service.abstraction\";\nimport { Fido2UserInterfaceService as Fido2UserInterfaceServiceAbstraction } from \"@bitwarden/common/vault/abstractions/fido2/fido2-user-interface.service.abstraction\";\nimport { CipherFileUploadService as CipherFileUploadServiceAbstraction } from \"@bitwarden/common/vault/abstractions/file-upload/cipher-file-upload.service\";\nimport { FolderApiServiceAbstraction } from \"@bitwarden/common/vault/abstractions/folder/folder-api.service.abstraction\";\nimport { InternalFolderService as InternalFolderServiceAbstraction } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { SyncNotifierService as SyncNotifierServiceAbstraction } from \"@bitwarden/common/vault/abstractions/sync/sync-notifier.service.abstraction\";\nimport { SyncService as SyncServiceAbstraction } from \"@bitwarden/common/vault/abstractions/sync/sync.service.abstraction\";\nimport { TotpService as TotpServiceAbstraction } from \"@bitwarden/common/vault/abstractions/totp.service\";\nimport { VaultSettingsService as VaultSettingsServiceAbstraction } from \"@bitwarden/common/vault/abstractions/vault-settings/vault-settings.service\";\nimport { CipherView } from \"@bitwarden/common/vault/models/view/cipher.view\";\nimport { CipherService } from \"@bitwarden/common/vault/services/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/services/collection.service\";\nimport { Fido2AuthenticatorService } from \"@bitwarden/common/vault/services/fido2/fido2-authenticator.service\";\nimport { Fido2ClientService } from \"@bitwarden/common/vault/services/fido2/fido2-client.service\";\nimport { CipherFileUploadService } from \"@bitwarden/common/vault/services/file-upload/cipher-file-upload.service\";\nimport { FolderApiService } from \"@bitwarden/common/vault/services/folder/folder-api.service\";\nimport { FolderService } from \"@bitwarden/common/vault/services/folder/folder.service\";\nimport { SyncNotifierService } from \"@bitwarden/common/vault/services/sync/sync-notifier.service\";\nimport { SyncService } from \"@bitwarden/common/vault/services/sync/sync.service\";\nimport { TotpService } from \"@bitwarden/common/vault/services/totp.service\";\nimport { VaultSettingsService } from \"@bitwarden/common/vault/services/vault-settings/vault-settings.service\";\nimport {\n  ImportApiService,\n  ImportApiServiceAbstraction,\n  ImportService,\n  ImportServiceAbstraction,\n} from \"@bitwarden/importer/core\";\nimport {\n  IndividualVaultExportService,\n  IndividualVaultExportServiceAbstraction,\n  OrganizationVaultExportService,\n  OrganizationVaultExportServiceAbstraction,\n  VaultExportService,\n  VaultExportServiceAbstraction,\n} from \"@bitwarden/vault-export-core\";\n\nimport { BrowserOrganizationService } from \"../admin-console/services/browser-organization.service\";\nimport { BrowserPolicyService } from \"../admin-console/services/browser-policy.service\";\nimport ContextMenusBackground from \"../autofill/background/context-menus.background\";\nimport NotificationBackground from \"../autofill/background/notification.background\";\nimport OverlayBackground from \"../autofill/background/overlay.background\";\nimport TabsBackground from \"../autofill/background/tabs.background\";\nimport WebRequestBackground from \"../autofill/background/web-request.background\";\nimport { CipherContextMenuHandler } from \"../autofill/browser/cipher-context-menu-handler\";\nimport { ContextMenuClickedHandler } from \"../autofill/browser/context-menu-clicked-handler\";\nimport { MainContextMenuHandler } from \"../autofill/browser/main-context-menu-handler\";\nimport { AutofillService as AutofillServiceAbstraction } from \"../autofill/services/abstractions/autofill.service\";\nimport AutofillService from \"../autofill/services/autofill.service\";\nimport { SafariApp } from \"../browser/safariApp\";\nimport { Account } from \"../models/account\";\nimport { BrowserApi } from \"../platform/browser/browser-api\";\nimport { flagEnabled } from \"../platform/flags\";\nimport { UpdateBadge } from \"../platform/listeners/update-badge\";\nimport { BrowserStateService as StateServiceAbstraction } from \"../platform/services/abstractions/browser-state.service\";\nimport { BrowserConfigService } from \"../platform/services/browser-config.service\";\nimport { BrowserCryptoService } from \"../platform/services/browser-crypto.service\";\nimport { BrowserEnvironmentService } from \"../platform/services/browser-environment.service\";\nimport { BrowserI18nService } from \"../platform/services/browser-i18n.service\";\nimport BrowserLocalStorageService from \"../platform/services/browser-local-storage.service\";\nimport BrowserMessagingPrivateModeBackgroundService from \"../platform/services/browser-messaging-private-mode-background.service\";\nimport BrowserMessagingService from \"../platform/services/browser-messaging.service\";\nimport BrowserPlatformUtilsService from \"../platform/services/browser-platform-utils.service\";\nimport { BrowserStateService } from \"../platform/services/browser-state.service\";\nimport { LocalBackedSessionStorageService } from \"../platform/services/local-backed-session-storage.service\";\nimport { BackgroundDerivedStateProvider } from \"../platform/state/background-derived-state.provider\";\nimport { BackgroundMemoryStorageService } from \"../platform/storage/background-memory-storage.service\";\nimport { BrowserSendService } from \"../services/browser-send.service\";\nimport { BrowserSettingsService } from \"../services/browser-settings.service\";\nimport VaultTimeoutService from \"../services/vault-timeout/vault-timeout.service\";\nimport FilelessImporterBackground from \"../tools/background/fileless-importer.background\";\nimport { BrowserFido2UserInterfaceService } from \"../vault/fido2/browser-fido2-user-interface.service\";\nimport { Fido2Service as Fido2ServiceAbstraction } from \"../vault/services/abstractions/fido2.service\";\nimport Fido2Service from \"../vault/services/fido2.service\";\nimport { VaultFilterService } from \"../vault/services/vault-filter.service\";\n\nimport CommandsBackground from \"./commands.background\";\nimport IdleBackground from \"./idle.background\";\nimport { NativeMessagingBackground } from \"./nativeMessaging.background\";\nimport RuntimeBackground from \"./runtime.background\";\n\nexport default class MainBackground {\n  messagingService: MessagingServiceAbstraction;\n  storageService: AbstractStorageService;\n  secureStorageService: AbstractStorageService;\n  memoryStorageService: AbstractMemoryStorageService;\n  memoryStorageForStateProviders: AbstractMemoryStorageService & ObservableStorageService;\n  i18nService: I18nServiceAbstraction;\n  platformUtilsService: PlatformUtilsServiceAbstraction;\n  logService: LogServiceAbstraction;\n  keyGenerationService: KeyGenerationServiceAbstraction;\n  cryptoService: CryptoServiceAbstraction;\n  cryptoFunctionService: CryptoFunctionServiceAbstraction;\n  tokenService: TokenServiceAbstraction;\n  appIdService: AppIdServiceAbstraction;\n  apiService: ApiServiceAbstraction;\n  environmentService: BrowserEnvironmentService;\n  settingsService: SettingsServiceAbstraction;\n  cipherService: CipherServiceAbstraction;\n  folderService: InternalFolderServiceAbstraction;\n  collectionService: CollectionServiceAbstraction;\n  vaultTimeoutService: VaultTimeoutService;\n  vaultTimeoutSettingsService: VaultTimeoutSettingsServiceAbstraction;\n  syncService: SyncServiceAbstraction;\n  passwordGenerationService: PasswordGenerationServiceAbstraction;\n  passwordStrengthService: PasswordStrengthServiceAbstraction;\n  totpService: TotpServiceAbstraction;\n  autofillService: AutofillServiceAbstraction;\n  containerService: ContainerService;\n  auditService: AuditServiceAbstraction;\n  authService: AuthServiceAbstraction;\n  loginStrategyService: LoginStrategyServiceAbstraction;\n  importApiService: ImportApiServiceAbstraction;\n  importService: ImportServiceAbstraction;\n  exportService: VaultExportServiceAbstraction;\n  searchService: SearchServiceAbstraction;\n  notificationsService: NotificationsServiceAbstraction;\n  stateService: StateServiceAbstraction;\n  autofillSettingsService: AutofillSettingsServiceAbstraction;\n  systemService: SystemServiceAbstraction;\n  eventCollectionService: EventCollectionServiceAbstraction;\n  eventUploadService: EventUploadServiceAbstraction;\n  policyService: InternalPolicyServiceAbstraction;\n  sendService: InternalSendServiceAbstraction;\n  fileUploadService: FileUploadServiceAbstraction;\n  cipherFileUploadService: CipherFileUploadServiceAbstraction;\n  organizationService: InternalOrganizationServiceAbstraction;\n  providerService: ProviderServiceAbstraction;\n  keyConnectorService: KeyConnectorServiceAbstraction;\n  userVerificationService: UserVerificationServiceAbstraction;\n  twoFactorService: TwoFactorServiceAbstraction;\n  vaultFilterService: VaultFilterService;\n  usernameGenerationService: UsernameGenerationServiceAbstraction;\n  encryptService: EncryptService;\n  folderApiService: FolderApiServiceAbstraction;\n  policyApiService: PolicyApiServiceAbstraction;\n  sendApiService: SendApiServiceAbstraction;\n  userVerificationApiService: UserVerificationApiServiceAbstraction;\n  syncNotifierService: SyncNotifierServiceAbstraction;\n  fido2UserInterfaceService: Fido2UserInterfaceServiceAbstraction;\n  fido2AuthenticatorService: Fido2AuthenticatorServiceAbstraction;\n  fido2ClientService: Fido2ClientServiceAbstraction;\n  avatarUpdateService: AvatarUpdateServiceAbstraction;\n  mainContextMenuHandler: MainContextMenuHandler;\n  cipherContextMenuHandler: CipherContextMenuHandler;\n  configService: BrowserConfigService;\n  configApiService: ConfigApiServiceAbstraction;\n  devicesApiService: DevicesApiServiceAbstraction;\n  devicesService: DevicesServiceAbstraction;\n  deviceTrustCryptoService: DeviceTrustCryptoServiceAbstraction;\n  authRequestService: AuthRequestServiceAbstraction;\n  accountService: AccountServiceAbstraction;\n  globalStateProvider: GlobalStateProvider;\n  pinCryptoService: PinCryptoServiceAbstraction;\n  singleUserStateProvider: SingleUserStateProvider;\n  activeUserStateProvider: ActiveUserStateProvider;\n  derivedStateProvider: DerivedStateProvider;\n  stateProvider: StateProvider;\n  fido2Service: Fido2ServiceAbstraction;\n  individualVaultExportService: IndividualVaultExportServiceAbstraction;\n  organizationVaultExportService: OrganizationVaultExportServiceAbstraction;\n  vaultSettingsService: VaultSettingsServiceAbstraction;\n  biometricStateService: BiometricStateService;\n  ssoLoginService: SsoLoginServiceAbstraction;\n\n  // Passed to the popup for Safari to workaround issues with theming, downloading, etc.\n  backgroundWindow = window;\n\n  onUpdatedRan: boolean;\n  onReplacedRan: boolean;\n  loginToAutoFill: CipherView = null;\n\n  private commandsBackground: CommandsBackground;\n  private contextMenusBackground: ContextMenusBackground;\n  private idleBackground: IdleBackground;\n  private notificationBackground: NotificationBackground;\n  private overlayBackground: OverlayBackground;\n  private filelessImporterBackground: FilelessImporterBackground;\n  private runtimeBackground: RuntimeBackground;\n  private tabsBackground: TabsBackground;\n  private webRequestBackground: WebRequestBackground;\n\n  private syncTimeout: any;\n  private isSafari: boolean;\n  private nativeMessagingBackground: NativeMessagingBackground;\n  popupOnlyContext: boolean;\n\n  constructor(public isPrivateMode: boolean = false) {\n    this.popupOnlyContext = isPrivateMode || BrowserApi.manifestVersion === 3;\n\n    // Services\n    const lockedCallback = async (userId?: string) => {\n      if (this.notificationsService != null) {\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.notificationsService.updateConnection(false);\n      }\n      await this.refreshBadge();\n      await this.refreshMenu(true);\n      if (this.systemService != null) {\n        await this.systemService.clearPendingClipboard();\n        await this.systemService.startProcessReload(this.authService);\n      }\n    };\n\n    const logoutCallback = async (expired: boolean, userId?: UserId) =>\n      await this.logout(expired, userId);\n\n    this.messagingService = this.popupOnlyContext\n      ? new BrowserMessagingPrivateModeBackgroundService()\n      : new BrowserMessagingService();\n    this.logService = new ConsoleLogService(false);\n    this.cryptoFunctionService = new WebCryptoFunctionService(self);\n    this.keyGenerationService = new KeyGenerationService(this.cryptoFunctionService);\n    this.storageService = new BrowserLocalStorageService();\n    this.secureStorageService = new BrowserLocalStorageService();\n    this.memoryStorageService =\n      BrowserApi.manifestVersion === 3\n        ? new LocalBackedSessionStorageService(\n            new EncryptServiceImplementation(this.cryptoFunctionService, this.logService, false),\n            this.keyGenerationService,\n          )\n        : new MemoryStorageService();\n    this.memoryStorageForStateProviders =\n      BrowserApi.manifestVersion === 3\n        ? new LocalBackedSessionStorageService(\n            new EncryptServiceImplementation(this.cryptoFunctionService, this.logService, false),\n            this.keyGenerationService,\n          )\n        : new BackgroundMemoryStorageService();\n    this.globalStateProvider = new DefaultGlobalStateProvider(\n      this.memoryStorageForStateProviders,\n      this.storageService as BrowserLocalStorageService,\n    );\n    this.encryptService = flagEnabled(\"multithreadDecryption\")\n      ? new MultithreadEncryptServiceImplementation(\n          this.cryptoFunctionService,\n          this.logService,\n          true,\n        )\n      : new EncryptServiceImplementation(this.cryptoFunctionService, this.logService, true);\n\n    this.singleUserStateProvider = new DefaultSingleUserStateProvider(\n      this.memoryStorageForStateProviders,\n      this.storageService as BrowserLocalStorageService,\n    );\n    this.accountService = new AccountServiceImplementation(\n      this.messagingService,\n      this.logService,\n      this.globalStateProvider,\n    );\n    this.activeUserStateProvider = new DefaultActiveUserStateProvider(\n      this.accountService,\n      this.memoryStorageForStateProviders,\n      this.storageService as BrowserLocalStorageService,\n    );\n    this.derivedStateProvider = new BackgroundDerivedStateProvider(\n      this.memoryStorageForStateProviders,\n    );\n    this.stateProvider = new DefaultStateProvider(\n      this.activeUserStateProvider,\n      this.singleUserStateProvider,\n      this.globalStateProvider,\n      this.derivedStateProvider,\n    );\n    this.environmentService = new BrowserEnvironmentService(\n      this.logService,\n      this.stateProvider,\n      this.accountService,\n    );\n    this.biometricStateService = new DefaultBiometricStateService(this.stateProvider);\n\n    const migrationRunner = new MigrationRunner(\n      this.storageService,\n      this.logService,\n      new MigrationBuilderService(),\n    );\n\n    this.stateService = new BrowserStateService(\n      this.storageService,\n      this.secureStorageService,\n      this.memoryStorageService,\n      this.logService,\n      new StateFactory(GlobalState, Account),\n      this.accountService,\n      this.environmentService,\n      migrationRunner,\n    );\n    this.platformUtilsService = new BrowserPlatformUtilsService(\n      this.messagingService,\n      (clipboardValue, clearMs) => {\n        if (this.systemService != null) {\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.systemService.clearClipboard(clipboardValue, clearMs);\n        }\n      },\n      async () => {\n        if (this.nativeMessagingBackground != null) {\n          const promise = this.nativeMessagingBackground.getResponse();\n\n          try {\n            await this.nativeMessagingBackground.send({ command: \"biometricUnlock\" });\n          } catch (e) {\n            return Promise.reject(e);\n          }\n\n          return promise.then((result) => result.response === \"unlocked\");\n        }\n      },\n      window,\n    );\n    this.i18nService = new BrowserI18nService(BrowserApi.getUILanguage(), this.stateService);\n    this.cryptoService = new BrowserCryptoService(\n      this.keyGenerationService,\n      this.cryptoFunctionService,\n      this.encryptService,\n      this.platformUtilsService,\n      this.logService,\n      this.stateService,\n      this.accountService,\n      this.stateProvider,\n    );\n    this.tokenService = new TokenService(this.stateService);\n    this.appIdService = new AppIdService(this.storageService);\n    this.apiService = new ApiService(\n      this.tokenService,\n      this.platformUtilsService,\n      this.environmentService,\n      this.appIdService,\n      (expired: boolean) => this.logout(expired),\n    );\n    this.settingsService = new BrowserSettingsService(this.stateService);\n    this.fileUploadService = new FileUploadService(this.logService);\n    this.cipherFileUploadService = new CipherFileUploadService(\n      this.apiService,\n      this.fileUploadService,\n    );\n    this.searchService = new SearchService(this.logService, this.i18nService);\n\n    this.collectionService = new CollectionService(\n      this.cryptoService,\n      this.i18nService,\n      this.stateProvider,\n    );\n    this.syncNotifierService = new SyncNotifierService();\n    this.organizationService = new BrowserOrganizationService(\n      this.stateService,\n      this.stateProvider,\n    );\n    this.policyService = new BrowserPolicyService(this.stateService, this.organizationService);\n    this.autofillSettingsService = new AutofillSettingsService(\n      this.stateProvider,\n      this.policyService,\n    );\n    this.policyApiService = new PolicyApiService(\n      this.policyService,\n      this.apiService,\n      this.stateService,\n    );\n    this.keyConnectorService = new KeyConnectorService(\n      this.stateService,\n      this.cryptoService,\n      this.apiService,\n      this.tokenService,\n      this.logService,\n      this.organizationService,\n      this.keyGenerationService,\n      logoutCallback,\n    );\n\n    this.passwordStrengthService = new PasswordStrengthService();\n\n    this.passwordGenerationService = new PasswordGenerationService(\n      this.cryptoService,\n      this.policyService,\n      this.stateService,\n    );\n\n    this.twoFactorService = new TwoFactorService(this.i18nService, this.platformUtilsService);\n\n    // eslint-disable-next-line\n    const that = this;\n    const backgroundMessagingService = new (class extends MessagingServiceAbstraction {\n      // AuthService should send the messages to the background not popup.\n      send = (subscriber: string, arg: any = {}) => {\n        const message = Object.assign({}, { command: subscriber }, arg);\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        that.runtimeBackground.processMessage(message, that as any);\n      };\n    })();\n\n    this.devicesApiService = new DevicesApiServiceImplementation(this.apiService);\n    this.deviceTrustCryptoService = new DeviceTrustCryptoService(\n      this.keyGenerationService,\n      this.cryptoFunctionService,\n      this.cryptoService,\n      this.encryptService,\n      this.stateService,\n      this.appIdService,\n      this.devicesApiService,\n      this.i18nService,\n      this.platformUtilsService,\n    );\n\n    this.devicesService = new DevicesServiceImplementation(this.devicesApiService);\n\n    this.authRequestService = new AuthRequestService(\n      this.appIdService,\n      this.cryptoService,\n      this.apiService,\n      this.stateService,\n    );\n\n    this.authService = new AuthService(\n      backgroundMessagingService,\n      this.cryptoService,\n      this.apiService,\n      this.stateService,\n    );\n\n    this.loginStrategyService = new LoginStrategyService(\n      this.cryptoService,\n      this.apiService,\n      this.tokenService,\n      this.appIdService,\n      this.platformUtilsService,\n      backgroundMessagingService,\n      this.logService,\n      this.keyConnectorService,\n      this.environmentService,\n      this.stateService,\n      this.twoFactorService,\n      this.i18nService,\n      this.encryptService,\n      this.passwordStrengthService,\n      this.policyService,\n      this.deviceTrustCryptoService,\n      this.authRequestService,\n    );\n\n    this.ssoLoginService = new SsoLoginService(this.stateProvider);\n\n    this.userVerificationApiService = new UserVerificationApiService(this.apiService);\n\n    this.configApiService = new ConfigApiService(this.apiService, this.authService);\n\n    this.configService = new BrowserConfigService(\n      this.stateService,\n      this.configApiService,\n      this.authService,\n      this.environmentService,\n      this.logService,\n      true,\n    );\n\n    this.cipherService = new CipherService(\n      this.cryptoService,\n      this.settingsService,\n      this.apiService,\n      this.i18nService,\n      this.searchService,\n      this.stateService,\n      this.autofillSettingsService,\n      this.encryptService,\n      this.cipherFileUploadService,\n      this.configService,\n    );\n    this.folderService = new FolderService(\n      this.cryptoService,\n      this.i18nService,\n      this.cipherService,\n      this.stateService,\n      this.stateProvider,\n    );\n    this.folderApiService = new FolderApiService(this.folderService, this.apiService);\n\n    this.vaultTimeoutSettingsService = new VaultTimeoutSettingsService(\n      this.cryptoService,\n      this.tokenService,\n      this.policyService,\n      this.stateService,\n    );\n\n    this.pinCryptoService = new PinCryptoService(\n      this.stateService,\n      this.cryptoService,\n      this.vaultTimeoutSettingsService,\n      this.logService,\n    );\n\n    this.userVerificationService = new UserVerificationService(\n      this.stateService,\n      this.cryptoService,\n      this.i18nService,\n      this.userVerificationApiService,\n      this.pinCryptoService,\n      this.logService,\n      this.vaultTimeoutSettingsService,\n      this.platformUtilsService,\n    );\n\n    this.vaultFilterService = new VaultFilterService(\n      this.organizationService,\n      this.folderService,\n      this.cipherService,\n      this.collectionService,\n      this.policyService,\n      this.stateProvider,\n      this.accountService,\n    );\n\n    this.vaultSettingsService = new VaultSettingsService(this.stateProvider);\n\n    this.vaultTimeoutService = new VaultTimeoutService(\n      this.cipherService,\n      this.folderService,\n      this.collectionService,\n      this.cryptoService,\n      this.platformUtilsService,\n      this.messagingService,\n      this.searchService,\n      this.stateService,\n      this.authService,\n      this.vaultTimeoutSettingsService,\n      lockedCallback,\n      logoutCallback,\n    );\n    this.containerService = new ContainerService(this.cryptoService, this.encryptService);\n    this.sendService = new BrowserSendService(\n      this.cryptoService,\n      this.i18nService,\n      this.keyGenerationService,\n      this.stateService,\n    );\n    this.sendApiService = new SendApiService(\n      this.apiService,\n      this.fileUploadService,\n      this.sendService,\n    );\n    this.providerService = new ProviderService(this.stateService);\n    this.syncService = new SyncService(\n      this.apiService,\n      this.settingsService,\n      this.folderService,\n      this.cipherService,\n      this.cryptoService,\n      this.collectionService,\n      this.messagingService,\n      this.policyService,\n      this.sendService,\n      this.logService,\n      this.keyConnectorService,\n      this.stateService,\n      this.providerService,\n      this.folderApiService,\n      this.organizationService,\n      this.sendApiService,\n      logoutCallback,\n    );\n    this.eventUploadService = new EventUploadService(\n      this.apiService,\n      this.stateService,\n      this.logService,\n    );\n    this.eventCollectionService = new EventCollectionService(\n      this.cipherService,\n      this.stateService,\n      this.organizationService,\n      this.eventUploadService,\n    );\n    this.totpService = new TotpService(this.cryptoFunctionService, this.logService);\n\n    this.autofillService = new AutofillService(\n      this.cipherService,\n      this.stateService,\n      this.autofillSettingsService,\n      this.totpService,\n      this.eventCollectionService,\n      this.logService,\n      this.settingsService,\n      this.userVerificationService,\n    );\n    this.auditService = new AuditService(this.cryptoFunctionService, this.apiService);\n\n    this.importApiService = new ImportApiService(this.apiService);\n\n    this.importService = new ImportService(\n      this.cipherService,\n      this.folderService,\n      this.importApiService,\n      this.i18nService,\n      this.collectionService,\n      this.cryptoService,\n    );\n\n    this.individualVaultExportService = new IndividualVaultExportService(\n      this.folderService,\n      this.cipherService,\n      this.cryptoService,\n      this.cryptoFunctionService,\n      this.stateService,\n    );\n\n    this.organizationVaultExportService = new OrganizationVaultExportService(\n      this.cipherService,\n      this.apiService,\n      this.cryptoService,\n      this.cryptoFunctionService,\n      this.stateService,\n      this.collectionService,\n    );\n\n    this.exportService = new VaultExportService(\n      this.individualVaultExportService,\n      this.organizationVaultExportService,\n    );\n\n    this.notificationsService = new NotificationsService(\n      this.logService,\n      this.syncService,\n      this.appIdService,\n      this.apiService,\n      this.environmentService,\n      logoutCallback,\n      this.stateService,\n      this.authService,\n      this.messagingService,\n    );\n\n    this.fido2Service = new Fido2Service();\n    this.fido2UserInterfaceService = new BrowserFido2UserInterfaceService(this.authService);\n    this.fido2AuthenticatorService = new Fido2AuthenticatorService(\n      this.cipherService,\n      this.fido2UserInterfaceService,\n      this.syncService,\n      this.logService,\n    );\n    this.fido2ClientService = new Fido2ClientService(\n      this.fido2AuthenticatorService,\n      this.configService,\n      this.authService,\n      this.stateService,\n      this.vaultSettingsService,\n      this.logService,\n    );\n\n    const systemUtilsServiceReloadCallback = () => {\n      const forceWindowReload =\n        this.platformUtilsService.isSafari() ||\n        this.platformUtilsService.isFirefox() ||\n        this.platformUtilsService.isOpera();\n      BrowserApi.reloadExtension(forceWindowReload ? self : null);\n      return Promise.resolve();\n    };\n\n    this.systemService = new SystemService(\n      this.messagingService,\n      this.platformUtilsService,\n      systemUtilsServiceReloadCallback,\n      this.stateService,\n      this.autofillSettingsService,\n      this.vaultTimeoutSettingsService,\n    );\n\n    // Other fields\n    this.isSafari = this.platformUtilsService.isSafari();\n\n    // Background\n    this.runtimeBackground = new RuntimeBackground(\n      this,\n      this.autofillService,\n      this.platformUtilsService as BrowserPlatformUtilsService,\n      this.i18nService,\n      this.notificationsService,\n      this.stateService,\n      this.autofillSettingsService,\n      this.systemService,\n      this.environmentService,\n      this.messagingService,\n      this.logService,\n      this.configService,\n      this.fido2Service,\n    );\n    this.nativeMessagingBackground = new NativeMessagingBackground(\n      this.cryptoService,\n      this.cryptoFunctionService,\n      this.runtimeBackground,\n      this.i18nService,\n      this.messagingService,\n      this.appIdService,\n      this.platformUtilsService,\n      this.stateService,\n      this.logService,\n      this.authService,\n    );\n    this.commandsBackground = new CommandsBackground(\n      this,\n      this.passwordGenerationService,\n      this.platformUtilsService,\n      this.vaultTimeoutService,\n      this.authService,\n    );\n    this.notificationBackground = new NotificationBackground(\n      this.autofillService,\n      this.cipherService,\n      this.authService,\n      this.policyService,\n      this.folderService,\n      this.stateService,\n      this.environmentService,\n      this.logService,\n    );\n    this.overlayBackground = new OverlayBackground(\n      this.cipherService,\n      this.autofillService,\n      this.authService,\n      this.environmentService,\n      this.settingsService,\n      this.stateService,\n      this.autofillSettingsService,\n      this.i18nService,\n      this.platformUtilsService,\n    );\n    this.filelessImporterBackground = new FilelessImporterBackground(\n      this.configService,\n      this.authService,\n      this.policyService,\n      this.notificationBackground,\n      this.importService,\n      this.syncService,\n    );\n    this.tabsBackground = new TabsBackground(\n      this,\n      this.notificationBackground,\n      this.overlayBackground,\n    );\n    if (!this.popupOnlyContext) {\n      const contextMenuClickedHandler = new ContextMenuClickedHandler(\n        (options) => this.platformUtilsService.copyToClipboard(options.text, { window: self }),\n        async (_tab) => {\n          const options = (await this.passwordGenerationService.getOptions())?.[0] ?? {};\n          const password = await this.passwordGenerationService.generatePassword(options);\n          this.platformUtilsService.copyToClipboard(password, { window: window });\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          this.passwordGenerationService.addHistory(password);\n        },\n        async (tab, cipher) => {\n          this.loginToAutoFill = cipher;\n          if (tab == null) {\n            return;\n          }\n\n          // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          BrowserApi.tabSendMessage(tab, {\n            command: \"collectPageDetails\",\n            tab: tab,\n            sender: \"contextMenu\",\n          });\n        },\n        this.authService,\n        this.cipherService,\n        this.stateService,\n        this.totpService,\n        this.eventCollectionService,\n        this.userVerificationService,\n      );\n\n      this.contextMenusBackground = new ContextMenusBackground(contextMenuClickedHandler);\n    }\n\n    this.idleBackground = new IdleBackground(\n      this.vaultTimeoutService,\n      this.stateService,\n      this.notificationsService,\n      this.accountService,\n    );\n    this.webRequestBackground = new WebRequestBackground(\n      this.platformUtilsService,\n      this.cipherService,\n      this.authService,\n    );\n\n    this.usernameGenerationService = new UsernameGenerationService(\n      this.cryptoService,\n      this.stateService,\n      this.apiService,\n    );\n\n    this.avatarUpdateService = new AvatarUpdateService(this.apiService, this.stateService);\n\n    if (!this.popupOnlyContext) {\n      this.mainContextMenuHandler = new MainContextMenuHandler(\n        this.stateService,\n        this.i18nService,\n        this.logService,\n      );\n\n      this.cipherContextMenuHandler = new CipherContextMenuHandler(\n        this.mainContextMenuHandler,\n        this.authService,\n        this.cipherService,\n      );\n    }\n  }\n\n  async bootstrap() {\n    this.containerService.attachToGlobal(window);\n\n    await this.stateService.init();\n\n    await this.vaultTimeoutService.init(true);\n    await (this.i18nService as BrowserI18nService).init();\n    await (this.eventUploadService as EventUploadService).init(true);\n    await this.runtimeBackground.init();\n    await this.notificationBackground.init();\n    this.filelessImporterBackground.init();\n    await this.commandsBackground.init();\n\n    this.configService.init();\n    this.twoFactorService.init();\n\n    await this.overlayBackground.init();\n\n    await this.tabsBackground.init();\n    if (!this.popupOnlyContext) {\n      this.contextMenusBackground?.init();\n    }\n    await this.idleBackground.init();\n    await this.webRequestBackground.init();\n\n    await this.fido2Service.init();\n\n    if (this.platformUtilsService.isFirefox() && !this.isPrivateMode) {\n      // Set Private Mode windows to the default icon - they do not share state with the background page\n      const privateWindows = await BrowserApi.getPrivateModeWindows();\n      privateWindows.forEach(async (win) => {\n        await new UpdateBadge(self).setBadgeIcon(\"\", win.id);\n      });\n\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      BrowserApi.onWindowCreated(async (win) => {\n        if (win.incognito) {\n          await new UpdateBadge(self).setBadgeIcon(\"\", win.id);\n        }\n      });\n    }\n\n    return new Promise<void>((resolve) => {\n      setTimeout(async () => {\n        await this.environmentService.setUrlsFromStorage();\n        // Workaround to ignore stateService.activeAccount until URLs are set\n        // TODO: Remove this when implementing ticket PM-2637\n        this.environmentService.initialized = true;\n        if (!this.isPrivateMode) {\n          await this.refreshBadge();\n        }\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.fullSync(true);\n        setTimeout(() => this.notificationsService.init(), 2500);\n        resolve();\n      }, 500);\n    });\n  }\n\n  async refreshBadge() {\n    await new UpdateBadge(self).run({ existingServices: this as any });\n  }\n\n  async refreshMenu(forLocked = false) {\n    if (!chrome.windows || !chrome.contextMenus) {\n      return;\n    }\n\n    await MainContextMenuHandler.removeAll();\n\n    if (forLocked) {\n      await this.mainContextMenuHandler?.noAccess();\n      this.onUpdatedRan = this.onReplacedRan = false;\n      return;\n    }\n\n    await this.mainContextMenuHandler?.init();\n\n    const tab = await BrowserApi.getTabFromCurrentWindow();\n    if (tab) {\n      await this.cipherContextMenuHandler?.update(tab.url);\n      this.onUpdatedRan = this.onReplacedRan = false;\n    }\n  }\n\n  /**\n   * Switch accounts to indicated userId -- null is no active user\n   */\n  async switchAccount(userId: UserId) {\n    try {\n      await this.stateService.setActiveUser(userId);\n\n      if (userId == null) {\n        await this.stateService.setRememberedEmail(null);\n        await this.refreshBadge();\n        await this.refreshMenu();\n        await this.overlayBackground.updateOverlayCiphers();\n        return;\n      }\n\n      const status = await this.authService.getAuthStatus(userId);\n      const forcePasswordReset =\n        (await this.stateService.getForceSetPasswordReason({ userId: userId })) !=\n        ForceSetPasswordReason.None;\n\n      await this.systemService.clearPendingClipboard();\n      await this.notificationsService.updateConnection(false);\n\n      if (status === AuthenticationStatus.Locked) {\n        this.messagingService.send(\"locked\", { userId: userId });\n      } else if (forcePasswordReset) {\n        this.messagingService.send(\"update-temp-password\", { userId: userId });\n      } else {\n        this.messagingService.send(\"unlocked\", { userId: userId });\n        await this.refreshBadge();\n        await this.refreshMenu();\n        await this.overlayBackground.updateOverlayCiphers();\n        await this.syncService.fullSync(false);\n      }\n    } finally {\n      this.messagingService.send(\"switchAccountFinish\", { userId: userId });\n    }\n  }\n\n  async logout(expired: boolean, userId?: UserId) {\n    userId ??= (await firstValueFrom(this.accountService.activeAccount$))?.id;\n\n    await this.eventUploadService.uploadEvents(userId);\n\n    await Promise.all([\n      this.syncService.setLastSync(new Date(0), userId),\n      this.cryptoService.clearKeys(userId),\n      this.settingsService.clear(userId),\n      this.cipherService.clear(userId),\n      this.folderService.clear(userId),\n      this.collectionService.clear(userId),\n      this.policyService.clear(userId),\n      this.passwordGenerationService.clear(userId),\n      this.vaultTimeoutSettingsService.clear(userId),\n      this.keyConnectorService.clear(),\n      this.vaultFilterService.clear(),\n      this.biometricStateService.logout(userId),\n      // We intentionally do not clear the autofillSettingsService\n    ]);\n\n    //Needs to be checked before state is cleaned\n    const needStorageReseed = await this.needsStorageReseed();\n\n    const currentUserId = await this.stateService.getUserId();\n    const newActiveUser = await this.stateService.clean({ userId: userId });\n\n    if (userId == null || userId === currentUserId) {\n      this.searchService.clearIndex();\n    }\n\n    if (newActiveUser != null) {\n      // we have a new active user, do not continue tearing down application\n      await this.switchAccount(newActiveUser as UserId);\n      this.messagingService.send(\"switchAccountFinish\");\n    } else {\n      this.messagingService.send(\"doneLoggingOut\", { expired: expired, userId: userId });\n    }\n\n    if (needStorageReseed) {\n      await this.reseedStorage();\n    }\n\n    if (BrowserApi.manifestVersion === 3) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      BrowserApi.sendMessage(\"updateBadge\");\n    }\n    await this.refreshBadge();\n    await this.mainContextMenuHandler.noAccess();\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.notificationsService.updateConnection(false);\n    await this.systemService.clearPendingClipboard();\n    await this.systemService.startProcessReload(this.authService);\n  }\n\n  private async needsStorageReseed(): Promise<boolean> {\n    const currentVaultTimeout = await this.stateService.getVaultTimeout();\n    return currentVaultTimeout == null ? false : true;\n  }\n\n  async collectPageDetailsForContentScript(tab: any, sender: string, frameId: number = null) {\n    if (tab == null || !tab.id) {\n      return;\n    }\n\n    const options: any = {};\n    if (frameId != null) {\n      options.frameId = frameId;\n    }\n\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    BrowserApi.tabSendMessage(\n      tab,\n      {\n        command: \"collectPageDetails\",\n        tab: tab,\n        sender: sender,\n      },\n      options,\n    );\n  }\n\n  async openPopup() {\n    // Chrome APIs cannot open popup\n\n    // TODO: Do we need to open this popup?\n    if (!this.isSafari) {\n      return;\n    }\n    await SafariApp.sendMessageToApp(\"showPopover\", null, true);\n  }\n\n  async reseedStorage() {\n    if (\n      !this.platformUtilsService.isChrome() &&\n      !this.platformUtilsService.isVivaldi() &&\n      !this.platformUtilsService.isOpera()\n    ) {\n      return;\n    }\n\n    const getStorage = (): Promise<any> =>\n      new Promise((resolve) => {\n        chrome.storage.local.get(null, (o: any) => resolve(o));\n      });\n\n    const clearStorage = (): Promise<void> =>\n      new Promise((resolve) => {\n        chrome.storage.local.clear(() => resolve());\n      });\n\n    const storage = await getStorage();\n    await clearStorage();\n\n    for (const key in storage) {\n      // eslint-disable-next-line\n      if (!storage.hasOwnProperty(key)) {\n        continue;\n      }\n      await this.storageService.save(key, storage[key]);\n    }\n  }\n\n  private async fullSync(override = false) {\n    const syncInternal = 6 * 60 * 60 * 1000; // 6 hours\n    const lastSync = await this.syncService.getLastSync();\n\n    let lastSyncAgo = syncInternal + 1;\n    if (lastSync != null) {\n      lastSyncAgo = new Date().getTime() - lastSync.getTime();\n    }\n\n    if (override || lastSyncAgo >= syncInternal) {\n      await this.syncService.fullSync(override);\n      this.scheduleNextSync();\n    } else {\n      this.scheduleNextSync();\n    }\n  }\n\n  private scheduleNextSync() {\n    if (this.syncTimeout) {\n      clearTimeout(this.syncTimeout);\n    }\n\n    this.syncTimeout = setTimeout(async () => await this.fullSync(), 5 * 60 * 1000); // check every 5 minutes\n  }\n}\n","import { ClearClipboard, clearClipboardAlarmName } from \"../../autofill/clipboard\";\n\nimport { alarmKeys, clearAlarmTime, getAlarmTime } from \"./alarm-state\";\n\nexport const onAlarmListener = async (alarm: chrome.alarms.Alarm) => {\n  alarmKeys.forEach(async (key) => {\n    const executionTime = await getAlarmTime(key);\n    if (!executionTime) {\n      return;\n    }\n\n    const currentDate = Date.now();\n    if (executionTime > currentDate) {\n      return;\n    }\n\n    await clearAlarmTime(key);\n\n    switch (key) {\n      case clearClipboardAlarmName:\n        // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ClearClipboard.run();\n        break;\n      default:\n    }\n  });\n};\n","import { CachedServices } from \"../background/service-factories/factory-options\";\n\ntype Listener<T extends unknown[]> = (...args: [...T, CachedServices]) => Promise<void>;\n\nexport const combine = <T extends unknown[]>(\n  listeners: Listener<T>[],\n  startingServices: CachedServices = {},\n) => {\n  return async (...args: T) => {\n    const cachedServices = { ...startingServices };\n    for (const listener of listeners) {\n      await listener(...[...args, cachedServices]);\n    }\n  };\n};\n","import { AuthenticationStatus } from \"@bitwarden/common/auth/enums/authentication-status\";\nimport { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\n\nimport { authServiceFactory } from \"../../auth/background/service-factories/auth-service.factory\";\nimport { autofillServiceFactory } from \"../../autofill/background/service_factories/autofill-service.factory\";\nimport { autofillSettingsServiceFactory } from \"../../autofill/background/service_factories/autofill-settings-service.factory\";\nimport { GeneratePasswordToClipboardCommand } from \"../../autofill/clipboard\";\nimport { AutofillTabCommand } from \"../../autofill/commands/autofill-tab-command\";\nimport { Account } from \"../../models/account\";\nimport {\n  passwordGenerationServiceFactory,\n  PasswordGenerationServiceInitOptions,\n} from \"../../tools/background/service_factories/password-generation-service.factory\";\nimport { CachedServices } from \"../background/service-factories/factory-options\";\nimport { logServiceFactory } from \"../background/service-factories/log-service.factory\";\nimport { BrowserApi } from \"../browser/browser-api\";\n\nexport const onCommandListener = async (command: string, tab: chrome.tabs.Tab) => {\n  switch (command) {\n    case \"autofill_login\":\n      await doAutoFillLogin(tab);\n      break;\n    case \"generate_password\":\n      await doGeneratePasswordToClipboard(tab);\n      break;\n  }\n};\n\nconst doAutoFillLogin = async (tab: chrome.tabs.Tab): Promise<void> => {\n  const cachedServices: CachedServices = {};\n  const opts = {\n    cryptoFunctionServiceOptions: {\n      win: self,\n    },\n    encryptServiceOptions: {\n      logMacFailures: true,\n    },\n    logServiceOptions: {\n      isDev: false,\n    },\n    platformUtilsServiceOptions: {\n      clipboardWriteCallback: () => Promise.resolve(),\n      biometricCallback: () => Promise.resolve(false),\n      win: self,\n    },\n    stateServiceOptions: {\n      stateFactory: new StateFactory(GlobalState, Account),\n    },\n    apiServiceOptions: {\n      logoutCallback: () => Promise.resolve(),\n    },\n    keyConnectorServiceOptions: {\n      logoutCallback: () => Promise.resolve(),\n    },\n    i18nServiceOptions: {\n      systemLanguage: BrowserApi.getUILanguage(),\n    },\n  };\n  const logService = await logServiceFactory(cachedServices, opts);\n  const authService = await authServiceFactory(cachedServices, opts);\n  const autofillService = await autofillServiceFactory(cachedServices, opts);\n\n  const authStatus = await authService.getAuthStatus();\n  if (authStatus < AuthenticationStatus.Unlocked) {\n    // TODO: Add back in unlock on autofill\n    logService.info(\"Currently not unlocked, MV3 does not support unlock on autofill currently.\");\n    return;\n  }\n\n  const command = new AutofillTabCommand(autofillService);\n  await command.doAutofillTabCommand(tab);\n};\n\nconst doGeneratePasswordToClipboard = async (tab: chrome.tabs.Tab): Promise<void> => {\n  const stateFactory = new StateFactory(GlobalState, Account);\n\n  const cache = {};\n  const options: PasswordGenerationServiceInitOptions = {\n    cryptoFunctionServiceOptions: {\n      win: self,\n    },\n    encryptServiceOptions: {\n      logMacFailures: false,\n    },\n    logServiceOptions: {\n      isDev: false,\n    },\n    platformUtilsServiceOptions: {\n      biometricCallback: () => Promise.resolve(true),\n      clipboardWriteCallback: () => Promise.resolve(),\n      win: self,\n    },\n    stateServiceOptions: {\n      stateFactory: stateFactory,\n    },\n    autofillSettingsServiceOptions: {\n      stateFactory: autofillSettingsServiceFactory,\n    },\n  };\n\n  const command = new GeneratePasswordToClipboardCommand(\n    await passwordGenerationServiceFactory(cache, options),\n    await autofillSettingsServiceFactory(cache, options),\n  );\n  // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n  command.generatePasswordToClipboard(tab);\n};\n","import { CipherContextMenuHandler } from \"../../autofill/browser/cipher-context-menu-handler\";\nimport { ContextMenuClickedHandler } from \"../../autofill/browser/context-menu-clicked-handler\";\n\nimport { combine } from \"./combine\";\nimport { onCommandListener } from \"./on-command-listener\";\nimport { onInstallListener } from \"./on-install-listener\";\nimport { UpdateBadge } from \"./update-badge\";\n\nconst windowsOnFocusChangedListener = combine([\n  UpdateBadge.windowsOnFocusChangedListener,\n  CipherContextMenuHandler.windowsOnFocusChangedListener,\n]);\n\nconst tabsOnActivatedListener = combine([\n  UpdateBadge.tabsOnActivatedListener,\n  CipherContextMenuHandler.tabsOnActivatedListener,\n]);\n\nconst tabsOnReplacedListener = combine([\n  UpdateBadge.tabsOnReplacedListener,\n  CipherContextMenuHandler.tabsOnReplacedListener,\n]);\n\nconst tabsOnUpdatedListener = combine([\n  UpdateBadge.tabsOnUpdatedListener,\n  CipherContextMenuHandler.tabsOnUpdatedListener,\n]);\n\nconst contextMenusClickedListener = ContextMenuClickedHandler.onClickedListener;\n\n// TODO: All message listeners should be RuntimeMessage in Notifications follow up then this type annotation can be inferred\nconst runtimeMessageListener = combine<\n  [message: { command: string }, sender: chrome.runtime.MessageSender]\n>([\n  UpdateBadge.messageListener,\n  CipherContextMenuHandler.messageListener,\n  ContextMenuClickedHandler.messageListener,\n]);\n\nexport {\n  windowsOnFocusChangedListener,\n  tabsOnActivatedListener,\n  tabsOnReplacedListener,\n  tabsOnUpdatedListener,\n  contextMenusClickedListener,\n  runtimeMessageListener,\n  onCommandListener,\n  onInstallListener,\n};\n","import MainBackground from \"../background/main.background\";\n\nimport { onAlarmListener } from \"./alarms/on-alarm-listener\";\nimport { registerAlarms } from \"./alarms/register-alarms\";\nimport { BrowserApi } from \"./browser/browser-api\";\nimport {\n  contextMenusClickedListener,\n  onCommandListener,\n  onInstallListener,\n  runtimeMessageListener,\n  windowsOnFocusChangedListener,\n  tabsOnActivatedListener,\n  tabsOnReplacedListener,\n  tabsOnUpdatedListener,\n} from \"./listeners\";\n\nif (BrowserApi.manifestVersion === 3) {\n  chrome.commands.onCommand.addListener(onCommandListener);\n  chrome.runtime.onInstalled.addListener(onInstallListener);\n  chrome.alarms.onAlarm.addListener(onAlarmListener);\n  registerAlarms();\n  chrome.windows.onFocusChanged.addListener(windowsOnFocusChangedListener);\n  chrome.tabs.onActivated.addListener(tabsOnActivatedListener);\n  chrome.tabs.onReplaced.addListener(tabsOnReplacedListener);\n  chrome.tabs.onUpdated.addListener(tabsOnUpdatedListener);\n  chrome.contextMenus.onClicked.addListener(contextMenusClickedListener);\n  BrowserApi.messageListener(\n    \"runtime.background\",\n    (message: { command: string }, sender, sendResponse) => {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      runtimeMessageListener(message, sender);\n    },\n  );\n} else {\n  const bitwardenMain = ((window as any).bitwardenMain = new MainBackground());\n  // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n  bitwardenMain.bootstrap().then(() => {\n    // Finished bootstrapping\n  });\n}\n","import { StateFactory } from \"@bitwarden/common/platform/factories/state-factory\";\nimport { GlobalState } from \"@bitwarden/common/platform/models/domain/global-state\";\n\nimport { Account } from \"../../models/account\";\nimport {\n  EnvironmentServiceInitOptions,\n  environmentServiceFactory,\n} from \"../background/service-factories/environment-service.factory\";\nimport { BrowserApi } from \"../browser/browser-api\";\n\nexport async function onInstallListener(details: chrome.runtime.InstalledDetails) {\n  const cache = {};\n  const opts: EnvironmentServiceInitOptions = {\n    encryptServiceOptions: {\n      logMacFailures: false,\n    },\n    cryptoFunctionServiceOptions: {\n      win: self,\n    },\n    logServiceOptions: {\n      isDev: false,\n    },\n    stateServiceOptions: {\n      stateFactory: new StateFactory(GlobalState, Account),\n    },\n  };\n  const environmentService = await environmentServiceFactory(cache, opts);\n\n  setTimeout(async () => {\n    if (details.reason != null && details.reason === chrome.runtime.OnInstalledReason.INSTALL) {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      BrowserApi.createNewTab(\"https://bitwarden.com/browser-start/\");\n\n      if (await environmentService.hasManagedEnvironment()) {\n        await environmentService.setUrlsToManagedEnvironment();\n      }\n    }\n  }, 100);\n}\n","const NUMBER_OF_ALARMS = 6;\n\nexport function registerAlarms() {\n  alarmsToBeCreated(NUMBER_OF_ALARMS);\n}\n\n/**\n * Creates staggered alarms that periodically (1min) raise OnAlarm events. The staggering is calculated based on the number of alarms passed in.\n * @param numberOfAlarms Number of named alarms, that shall be registered\n * @example\n * // alarmsToBeCreated(2) results in 2 alarms separated by 30 seconds\n * @example\n * // alarmsToBeCreated(4) results in 4 alarms separated by 15 seconds\n * @example\n * // alarmsToBeCreated(6) results in 6 alarms separated by 10 seconds\n * @example\n * // alarmsToBeCreated(60) results in 60 alarms separated by 1 second\n */\nfunction alarmsToBeCreated(numberOfAlarms: number): void {\n  const oneMinuteInMs = 60 * 1000;\n  const offset = oneMinuteInMs / numberOfAlarms;\n\n  let calculatedWhen: number = Date.now() + offset;\n\n  for (let index = 0; index < numberOfAlarms; index++) {\n    // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    chrome.alarms.create(`bw_alarm${index}`, { periodInMinutes: 1, when: calculatedWhen });\n    calculatedWhen += offset;\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// expose the module cache\n__webpack_require__.c = __webpack_module_cache__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + \"encrypt-worker\" + \".js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t352: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk_bitwarden_browser\"] = self[\"webpackChunk_bitwarden_browser\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// module cache are used so entry inlining is disabled\n// startup\n// Load entry module and return exports\nvar __webpack_exports__ = __webpack_require__.O(undefined, [736], () => (__webpack_require__(77301)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","leafPrototypes","getProto","EncryptionType","AuthenticationType","EXPECTED_NUM_PARTS_BY_ENCRYPTION_TYPE","AesCbc256_B64","AesCbc128_HmacSha256_B64","AesCbc256_HmacSha256_B64","Rsa2048_OaepSha256_B64","Rsa2048_OaepSha1_B64","Rsa2048_OaepSha256_HmacSha256_B64","Rsa2048_OaepSha1_HmacSha256_B64","FileUploadType","HashPurpose","HtmlStorageLocation","KdfType","KdfConfig","constructor","iterations","memory","parallelism","this","RangeWithDefault","min","max","defaultValue","Error","inRange","value","ARGON2_MEMORY","ARGON2_PARALLELISM","ARGON2_ITERATIONS","PBKDF2_ITERATIONS","PBKDF2_SHA256","KeySuffixOptions","LogLevelType","StorageLocation","ThemeType","nodeURL","window","static","inited","isNode","process","release","name","isBrowser","isMobileBrowser","isMobile","isAppleMobileBrowser","isAppleMobile","global","g","self","str","Uint8Array","Buffer","from","binaryString","atob","bytes","length","i","charCodeAt","fromB64ToArray","fromUrlB64ToB64","parseInt","substr","strUtf8","unescape","encodeURIComponent","arr","buffer","toString","binary","byteLength","String","fromCharCode","btoa","fromB64toUrlB64","fromBufferToB64","b64Str","replace","apply","Array","prototype","map","call","x","slice","join","hexString","arrayBuffer","ArrayBuffer","uint8Array","hexByte","byteValue","urlB64Str","output","fromB64ToUtf8","utfStr","decodeURIComponent","escape","fromBufferToUrlB64","fromUtf8ToArray","c","r","Math","random","id","RegExp","test","uriString","isNullOrWhitespace","trim","startsWith","indexOf","hostname","validHosts","url","getUrl","host","parseResult","allowPrivateDomains","isIp","domain","search","Map","split","forEach","pair","parts","set","toLowerCase","i18nService","prop","a","b","collator","compare","localeCompare","obj","undefined","target","source","Object","assign","keys","filter","k","Number","isNaN","getUrlObject","s","charAt","toUpperCase","bgColor","threshold","svgTextFill","bgColorHexNums","substring","hash","color","bitwardenContainerService","fromEntries","record","entries","e","destination","denormalizedPath","win","mobile","navigator","userAgent","vendor","opera","match","ms","Promise","resolve","setTimeout","generator","of","pipe","switchMap","targetDate","diffTime","getTime","Date","now","floor","hasProtocol","URL","regexpEmojiPresentation","originalMinimumPasswordLength","minimumPasswordLength","DomainMatchBlacklist","Set","init","EncString","encryptedStringOrType","data","iv","mac","initFromData","initFromEncryptedString","ivBytes","macBytes","dataBytes","toJSON","encryptedString","encType","encryptionType","encPieces","parseEncryptedString","headerPieces","decrypt","orgId","key","decryptedValue","getKeyForDecryption","encryptService","getContainerService","getEncryptService","decryptToUtf8","cryptoService","getCryptoService","getOrgKey","getUserKeyWithLegacySupport","PinCryptoService","stateService","vaultTimeoutSettingsService","logService","decryptUserKeyWithPin","pin","pinLockType","isPinLockSet","pinKeyEncryptedUserKey","oldPinKeyEncryptedMasterKey","getPinKeyEncryptedKeys","kdf","getKdfType","kdfConfig","getKdfConfig","userKey","email","getEmail","decryptAndMigrateOldPinKey","validatePin","warning","error","getPinKeyEncryptedUserKey","getEncryptedPinProtected","getPinKeyEncryptedUserKeyEphemeral","getDecryptedPinProtected","protectedPin","getProtectedPin","TwoFactorProviderType","ForceSetPasswordReason","ClientType","DeviceType","PreloginRequest","response","getResponseProperty","propertyName","exactName","otherCasePropertyName","ErrorResponse","status","identityResponse","super","errorModel","responseErrorModel","message","validationErrors","captchaSiteKey","HCaptcha_SiteKey","captchaRequired","statusCode","getSingleMessage","hasOwnProperty","getAllMessages","messages","item","prefix","lastSep","lastIndexOf","push","TokenRequest","twoFactor","device","alterIdentityTokenHeaders","headers","setTwoFactor","setAuthRequestAccessCode","accessCode","authRequest","toIdentityToken","clientId","scope","client_id","deviceType","type","deviceIdentifier","identifier","deviceName","token","provider","twoFactorToken","twoFactorProvider","twoFactorRemember","remember","PasswordTokenRequest","masterPasswordHash","captchaResponse","grant_type","username","password","fromUtf8ToUrlB64","AuthResult","resetMasterPassword","forcePasswordReset","None","twoFactorProviders","requiresCaptcha","requiresTwoFactor","DeviceRequest","appId","platformUtilsService","getDevice","getDeviceString","pushToken","TokenTwoFactorRequest","IdentityCaptchaResponse","siteKey","MasterPasswordPolicyResponse","minComplexity","minLength","requireUpper","requireLower","requireNumbers","requireSpecial","enforceOnLogin","KeyConnectorUserDecryptionOptionResponse","keyConnectorUrl","TrustedDeviceUserDecryptionOptionResponse","hasAdminApproval","hasLoginApprovingDevice","hasManageResetPasswordPermission","EncryptedPrivateKey","encryptedPrivateKey","EncryptedUserKey","encryptedUserKey","WebAuthnPrfDecryptionOptionResponse","UserDecryptionOptionsResponse","hasMasterPassword","TrustedDeviceOption","trustedDeviceOption","KeyConnectorOption","keyConnectorOption","WebAuthnPrfOption","webAuthnPrfOption","IdentityTokenResponse","accessToken","access_token","expiresIn","expires_in","refreshToken","refresh_token","tokenType","token_type","privateKey","kdfIterations","kdfMemory","kdfParallelism","apiUseKeyConnector","masterPasswordPolicy","UserDecryptionOptions","userDecryptionOptions","IdentityTwoFactorResponse","twoFactorProviders2","captchaToken","ssoEmail2faSessionToken","Android","iOS","AndroidAmazon","WindowsDesktop","MacOsDesktop","LinuxDesktop","UWP","WindowsCLI","MacOsCLI","LinuxCLI","EventSystemUser","EventType","HttpStatusCode","NativeMessagingVersion","NotificationType","ProductType","InitializerKey","CipherRepromptType","CipherType","FieldType","LoginLinkedId","CardLinkedId","IdentityLinkedId","SecureNoteType","UriMatchType","KeysRequest","publicKey","AdminAuthRequestStorable","fromBufferToByteString","privateKeyBuffer","fromByteStringToArray","KeyConnectorUserDecryptionOption","TrustedDeviceUserDecryptionOption","SymmetricCryptoKey","encKey","macKey","keyB64","encKeyB64","macKeyB64","fromString","AttachmentView","size","sizeName","fileName","fileSize","fromJSON","LinkedMetadata","propertyKey","_i18nKey","i18nKey","linkedFieldOption","linkedFieldOptions","ItemView","CardView","cardholderName","expMonth","expYear","code","_brand","_number","_subTitle","maskedCode","repeat","maskedNumber","number","brand","subTitle","count","expiration","exp","formatYear","year","cardNum","re","CardholderName","ExpMonth","ExpYear","Code","Brand","FieldView","f","newField","showValue","showCount","linkedId","maskedValue","IdentityView","title","middleName","address1","address2","address3","city","state","postalCode","country","company","phone","ssn","passportNumber","licenseNumber","_firstName","_lastName","firstName","lastName","fullName","fullAddress","address","fullAddressPart2","addressPart2","Title","MiddleName","Address1","Address2","Address3","City","State","PostalCode","Country","Company","Email","Phone","Ssn","Username","PassportNumber","LicenseNumber","FirstName","LastName","FullName","Fido2CredentialView","creationDate","userDisplayName","CanLaunchWhitelist","SafeUrls","uri","LoginUriView","u","_uri","_domain","_hostname","_host","_canLaunch","getDomain","RegularExpression","getHostname","getHost","hostnameOrUri","hostOrUri","isWebsite","canLaunch","launchUri","matchesUri","targetUri","equivalentDomains","defaultUriMatch","matchType","Domain","targetDomain","matchDomains","add","matchesDomain","Host","urlHost","Exact","StartsWith","Never","has","domainUrlHost","get","LoginView","l","passwordRevisionDate","totp","uris","autofillOnPageLoad","fido2Credentials","hasUris","maskedPassword","some","hasTotp","find","hasFido2Credentials","Password","PasswordHistoryView","ph","lastUsedDate","SecureNoteView","n","CipherView","initializerKey","organizationId","folderId","notes","favorite","organizationUseTotp","edit","viewPassword","login","identity","card","secureNote","attachments","fields","passwordHistory","collectionIds","revisionDate","deletedDate","reprompt","localData","Login","SecureNote","Card","Identity","hasPasswordHistory","hasAttachments","hasOldAttachments","hasFields","passwordRevisionDisplayDate","isDeleted","linkedFieldValue","linkedFieldI18nKey","view","ServerConfigData","serverConfigResponse","featureStates","version","gitHash","server","ThirdPartyServerConfigData","utcDate","toISOString","environment","EnvironmentServerConfigData","cloudRegion","vault","api","notifications","sso","EncryptionPair","encrypted","decrypted","decryptedFromJson","encryptedFromJson","DataEncryptionPair","AccountData","ciphers","sends","policies","passwordGenerationHistory","addEditCipherInfo","cipher","AccountKeys","cryptoSymmetricKey","merge","masterKey","deviceKey","cryptoMasterKey","decObj","AccountProfile","vaultTimeoutAction","pinProtected","serverConfig","AccountTokens","AccountDecryptionOptions","accountDecryptionOptions","responseOptions","usingKeyConnector","profile","settings","tokens","decryptionOptions","adminAuthRequest","json","LoginStrategy","apiService","tokenService","appIdService","messagingService","twoFactorService","captchaBypassToken","logInTwoFactor","tokenRequest","authResult","startLogIn","clearSelectedProvider","postIdentityToken","processTwoFactorResponse","processCaptchaResponse","processTokenResponse","buildDeviceRequest","getAppId","buildTwoFactor","userProvidedTwoFactor","storedTwoFactorToken","getTwoFactorToken","Remember","saveAccountInformation","tokenResponse","accountInformation","decodeToken","userId","sub","getDeviceKey","accountKeys","getAdminAuthRequest","addAccount","hasPremiumPersonally","premium","kdfType","fromResponse","result","encryptionKeyMigrationRequired","requiresEncryptionKeyMigration","getClientType","Web","AdminForcePasswordReset","setTwoFactorToken","setMasterKey","setUserKey","setPrivateKey","send","createKeyPairForOldAccount","makeKeyPair","postAccountKeys","setProviders","ssoEmail2FaSessionToken","AuthRequestLoginStrategy","authRequestCredentials","authRequestId","deviceTrustCryptoService","logIn","credentials","decryptedMasterKey","decryptedMasterKeyHash","setMasterKeyHash","setMasterKeyEncryptedUserKey","decryptedUserKey","trySetUserKeyWithMasterKey","trustDeviceIfRequired","getMasterKey","decryptUserKeyWithMasterKey","buildDomainModel","dataObj","notEncList","objProp","buildDataModel","notEncStringList","decryptObj","viewModel","promises","theProp","p","then","mapProp","val","all","MasterPasswordPolicyOptions","policy","options","PasswordLoginStrategy","passwordStrengthService","policyService","loginStrategyService","forcePasswordResetReason","setForceSetPasswordReason","masterPassword","makePreloginKey","localMasterKeyHash","hashMasterKey","LocalAuthorization","masterKeyHash","masterPasswordPolicyOptions","getMasterPasswordPolicyOptionsFromResponse","evaluateMasterPassword","WeakMasterPassword","passwordStrength","getPasswordStrength","score","SsoTokenRequest","codeVerifier","redirectUri","code_verifier","redirect_uri","SsoLoginStrategy","keyConnectorService","authRequestService","redirectUrl","ssoAuthResult","shouldSetMasterKeyFromKeyConnector","convertNewSsoUserToKeyConnector","getKeyConnectorUrl","setMasterKeyFromUrl","userHasMasterPassword","masterKeyEncryptedUserKey","trySetUserKeyWithApprovedAdminRequestIfExists","hasUserKey","trySetUserKeyWithDeviceKey","adminAuthReqStorable","adminAuthReqResponse","getAuthRequest","NotFound","setAdminAuthRequest","requestApproved","setKeysAfterDecryptingSharedMasterKeyAndHash","setUserKeyAfterDecryptingSharedUserKey","showToast","t","encDevicePrivateKey","encUserKey","decryptUserKeyWithDeviceKey","UserApiTokenRequest","clientSecret","client_secret","UserApiLoginStrategy","environmentService","setApiKeyClientId","setApiKeyClientSecret","WebAuthnLoginTokenRequest","deviceResponse","JSON","stringify","WebAuthnLoginStrategy","idTokenResponse","prfKey","decryptToBytes","rsaDecrypt","LoginStrategyService","logInStrategy","pushNotificationSubject","Subject","strategy","clearState","Sso","UserApi","AuthRequest","WebAuthn","saveState","authingWithUserApiKey","authingWithSso","authingWithPassword","authingWithPasswordless","preloginResponse","postPrelogin","makeMasterKey","authResponsePushNotification","notification","next","getPushNotificationObs$","asObservable","startSessionTimeout","clearSessionTimeout","sessionTimeout","clearTimeout","PasswordlessAuthRequest","AuthRequestService","approveOrDenyAuthRequest","approve","pubKey","getKeyHash","encryptedMasterKeyHash","keyToEncrypt","rsaEncrypt","getUserKey","encryptedKey","putAuthRequest","authReqResponse","authReqPrivateKey","decryptPubKeyEncryptedUserKey","decryptPubKeyEncryptedMasterKeyAndHash","pubKeyEncryptedUserKey","decryptedUserKeyBytes","pubKeyEncryptedMasterKey","pubKeyEncryptedMasterKeyHash","decryptedMasterKeyArrayBuffer","decryptedMasterKeyHashArrayBuffer","fromBufferToUtf8","ListResponse","dr","continuationToken","PolicyData","enabled","PolicyResponse","PolicyApiService","getPolicy","getPolicies","getPoliciesByToken","organizationUserId","encodeRFC3986URIComponent","getMasterPasswordPolicyResponseForOrgUser","getMasterPasswordPolicyOptsForOrgUser","masterPasswordPolicyResponse","mapPolicyFromResponse","firstValueFrom","masterPasswordPolicyOptions$","putPolicy","request","upsert","DeriveDefinition","stateDefinition","uniqueDerivationName","definition","isKeyDefinition","derive","deserialize","serialized","deserializer","cleanupDelayMs","clearOnCleanup","buildCacheKey","storageKey","StateProvider","array","elementDeserializer","element","valueDeserializer","jsonValue","KeyDefinition","errorKeyName","v","USER_KEY_DEFINITION_MARKER","Symbol","isUserKeyDefinition","keyDefinition","UserKeyDefinition","clearOn","buildKey","isGuid","StateDefinition","defaultStorageLocation","storageLocationOverrides","ACCOUNT_MEMORY","CRYPTO_DISK","CRYPTO_MEMORY","SSO_DISK","ENVIRONMENT_DISK","GENERATOR_DISK","web","BIOMETRIC_SETTINGS_DISK","ORGANIZATIONS_DISK","PROVIDERS_DISK","FOLDER_DISK","VAULT_SETTINGS_DISK","COLLECTION_DATA","AUTOFILL_SETTINGS_DISK","AUTOFILL_SETTINGS_DISK_LOCAL","VAULT_FILTER_DISK","OrganizationApiKeyType","OrganizationConnectionType","OrganizationUserStatusType","OrganizationUserType","ProviderType","ProviderUserStatusType","ProviderUserType","ScimProviderType","PolicyType","Provider","useEvents","canAccess","isProviderAdmin","Confirmed","canCreateOrganizations","canManageUsers","canAccessEventLogs","ProviderAdmin","ProviderService","providers","getProviders","getAll","save","AuthenticationStatus","accountInfoEqual","AccountService","ACCOUNT_ACCOUNTS","accountInfo","ACCOUNT_ACTIVE_ACCOUNT_ID","AccountServiceImplementation","globalStateProvider","lock","logout","accountLock$","accountLogout$","accountsState","activeAccountIdState","accounts$","state$","accounts","activeAccount$","combineLatestWith","distinctUntilChanged","shareReplay","bufferSize","refCount","accountData","update","setAccountName","setAccountInfo","setAccountEmail","setAccountStatus","LoggedOut","Locked","setMaxAccountStatus","maxStatus","shouldUpdate","switchAccount","_","delete","newAccountInfo","oldAccountInfo","AuthService","getAuthStatus","getIsAuthenticated","hasUserKeyInMemory","hasUserKeyStored","Auto","getEverBeenUnlocked","getUserKeyFromStorage","Unlocked","logOut","callback","SecretVerificationRequest","UpdateDevicesTrustRequest","DeviceKeysUpdateRequest","DeviceTrustCryptoService","keyGenerationService","cryptoFunctionService","devicesApiService","getShouldTrustDevice","setShouldTrustDevice","trustDevice","makeDeviceKey","devicePublicKey","devicePrivateKey","rsaGenerateKeyPair","devicePublicKeyEncryptedUserKey","userKeyEncryptedDevicePublicKey","deviceKeyEncryptedDevicePrivateKey","encrypt","updateTrustedDeviceKeys","setDeviceKey","rotateDevicesTrust","newUserKey","oldUserKey","activeUserKey$","secretVerificationRequest","currentDeviceKeys","getDeviceKeys","decryptedDevicePublicKey","encryptedPublicKey","encryptedNewUserKey","encryptedDevicePublicKey","currentDeviceUpdateRequest","trustRequest","currentDevice","otherDevices","updateTrust","createKey","encryptedDevicePrivateKey","supportsDeviceTrust","getAccountDecryptionOptions","DeviceView","DevicesServiceImplementation","getDevices$","defer","getDevices","deviceResponses","getDeviceByIdentifier$","getDeviceByIdentifier","isDeviceKnownForUser$","getKnownDevice","updateTrustedDeviceKeys$","DeviceResponse","ProtectedDeviceResponse","TrustedDeviceKeysRequest","DevicesApiServiceImplementation","updateDevicesTrustRequestModel","KeyConnectorUserKeyRequest","SetKeyConnectorKeyRequest","orgIdentifier","KeyConnectorService","organizationService","logoutCallback","setUsesKeyConnector","usesKeyConnector","getUsesKeyConnector","userNeedsMigration","loggedInUsingSso","getIsExternal","requiredByOrganization","getManagingOrganization","userIsNotUsingKeyConnector","migrateUser","organization","keyConnectorRequest","postUserKeyToKeyConnector","handleKeyConnectorError","postConvertToKeyConnector","masterKeyResponse","getMasterKeyFromKeyConnector","keyArr","o","keyConnectorEnabled","Admin","Owner","isProviderUser","legacyKeyConnectorUrl","makeUserKey","privKey","setPasswordRequest","postSetKeyConnectorKey","setConvertAccountRequired","setConvertAccountToKeyConnector","getConvertAccountRequired","getConvertAccountToKeyConnector","removeConvertAccountRequired","clear","CODE_VERIFIER","SSO_STATE","ORGANIZATION_SSO_IDENTIFIER","organizationIdentifier","SsoLoginService","stateProvider","codeVerifierState","getGlobal","ssoState","orgSsoIdentifierState","activeUserOrgSsoIdentifierState","getActive","getCodeVerifier","setCodeVerifier","getSsoState","setSsoState","getOrganizationSsoIdentifier","setOrganizationSsoIdentifier","getActiveUserOrganizationSsoIdentifier","setActiveUserOrganizationSsoIdentifier","TokenService","decoded","fromUrlB64ToUtf8","parse","setTokens","clientIdClientSecret","setToken","setRefreshToken","setClientId","setClientSecret","getClientId","getApiKeyClientId","getClientSecret","getApiKeyClientSecret","setAccessToken","getToken","getAccessToken","getRefreshToken","clearTwoFactorToken","clearToken","getTokenExpirationDate","d","setUTCSeconds","tokenSecondsRemaining","offsetSeconds","msRemaining","valueOf","round","tokenNeedsRefresh","minutes","getUserId","getEmailVerified","email_verified","getName","getIssuer","iss","isArray","amr","includes","TwoFactorProviders","Authenticator","description","priority","sort","Yubikey","Duo","OrganizationDuo","TwoFactorService","selectedTwoFactorProviderType","getSupportedProviders","twoFactorProvidersData","supportsDuo","supportsWebAuthn","getDefaultProvider","webAuthnSupported","providerType","providerPriority","_value","setSelectedProvider","clearProviders","VerificationType","UserVerificationApiService","postAccountVerifyOTP","postAccountRequestOTP","VerifyOTPRequest","OTP","UserVerificationService","userVerificationApiService","pinCryptoService","getAvailableVerificationOptions","verificationType","biometricsLockSet","biometricsUserKeyStored","hasMasterPasswordAndMasterKeyHash","isBiometricLockSet","Biometric","client","biometrics","supportsSecureStorage","otp","buildRequest","verification","requestClass","alreadyHashed","validateSecretInput","secret","verifyUser","verificationHasSecret","verifyUserByOTP","MasterPassword","verifyUserByMasterPassword","PIN","verifyUserByPIN","Biometrics","verifyUserByBiometrics","compareAndUpdateKeyHash","requestOTP","getMasterKeyHash","ClearClipboardDelay","AUTOFILL_CARD_ID","AUTOFILL_ID","AUTOFILL_IDENTITY_ID","COPY_IDENTIFIER_ID","COPY_PASSWORD_ID","COPY_USERNAME_ID","COPY_VERIFICATION_CODE_ID","CREATE_CARD_ID","CREATE_IDENTITY_ID","CREATE_LOGIN_ID","GENERATE_PASSWORD_ID","NOOP_COMMAND_SUFFIX","ROOT_ID","SEPARATOR_ID","NOTIFICATION_BAR_LIFESPAN_MS","AutofillOverlayElement","AutofillOverlayPort","AutofillOverlayVisibility","AUTOFILL_ON_PAGE_LOAD","AUTOFILL_ON_PAGE_LOAD_DEFAULT","AUTO_COPY_TOTP","AUTOFILL_ON_PAGE_LOAD_CALLOUT_DISMISSED","ACTIVATE_AUTOFILL_ON_PAGE_LOAD_FROM_POLICY","INLINE_MENU_VISIBILITY","CLEAR_CLIPBOARD_DELAY","AutofillSettingsService","autofillOnPageLoadState","autofillOnPageLoad$","autofillOnPageLoadDefaultState","autofillOnPageLoadDefault$","autoCopyTotpState","autoCopyTotp$","autofillOnPageLoadCalloutIsDismissedState","autofillOnPageLoadCalloutIsDismissed$","activateAutofillOnPageLoadFromPolicyState","activateAutofillOnPageLoadFromPolicy$","inlineMenuVisibilityState","inlineMenuVisibility$","clearClipboardDelayState","clearClipboardDelay$","policies$","handleActivateAutofillPolicy","bind","subscribe","setAutofillOnPageLoad","newValue","setAutofillOnPageLoadDefault","setAutoCopyTotp","setAutofillOnPageLoadCalloutIsDismissed","setActivateAutofillOnPageLoadFromPolicy","setInlineMenuVisibility","setClearClipboardDelay","ActivateAutofill","tap","activated","autofillEnabled","MessagingService","REQUIRE_PASSWORD_ON_START","ENCRYPTED_CLIENT_KEY_HALF","DISMISSED_REQUIRE_PASSWORD_ON_START_CALLOUT","PROMPT_CANCELLED","PROMPT_AUTOMATICALLY","DefaultBiometricStateService","requirePasswordOnStartState","requirePasswordOnStart$","encryptedClientKeyHalfState","encryptedClientKeyHalf$","encryptedClientKeyHalfToEncString","dismissedRequirePasswordOnStartCalloutState","dismissedRequirePasswordOnStartCallout$","promptCancelledState","promptCancelled$","promptAutomaticallyState","promptAutomatically$","setRequirePasswordOnStart","currentActiveId","combinedState$","removeEncryptedClientKeyHalf","setEncryptedClientKeyHalf","encryptedKeyHalf","getUser","getRequirePasswordOnStart","getEncryptedClientKeyHalf","setDismissedRequirePasswordOnStartCallout","setPromptCancelled","resetPromptCancelled","setPromptAutomatically","prompt","AccountFactory","accountConstructor","create","args","GlobalStateFactory","globalStateConstructor","StateFactory","globalStateFactory","accountFactory","createGlobal","createAccount","WindowState","GlobalState","theme","System","AppIdService","storageService","makeAndGetAppId","getAnonymousAppId","existingId","htmlStorageLocation","Local","guid","newGuid","ServerConfigResponse","ThirdPartyServerConfigResponse","EnvironmentServerConfigResponse","ConfigApiService","authService","authed","ConsoleLogService","isDev","timersMap","debug","write","Debug","info","Info","Warning","level","console","log","warn","ContainerService","attachToGlobal","EncArrayBuffer","encBytes","minimumLength","ENC_TYPE_LENGTH","throwDecryptionError","b64","EncryptedObject","EncryptServiceImplementation","logMacFailures","plainValue","plainBuf","encObj","aesEncrypt","encryptToBytes","encValue","macLen","encString","resolveLegacyKey","fastParams","aesDecryptFastParameters","computedMac","hmacFast","macData","compareFast","logMacFailed","aesDecryptFast","encThing","hmac","aesDecrypt","algorithm","decryptItems","items","results","hashArray","randomBytes","msg","AttachmentData","CardData","FieldData","IdentityData","Fido2CredentialData","credentialId","keyType","keyAlgorithm","keyCurve","keyValue","rpId","userHandle","userName","counter","rpName","discoverable","LoginUriData","uriChecksum","LoginData","PasswordHistoryData","SecureNoteData","CipherData","Attachment","decryptAttachmentKey","decValue","toAttachmentData","toCardData","Field","toFieldData","toIdentityData","Fido2Credential","toFido2CredentialData","LoginUri","validateChecksum","clearTextUri","localChecksum","toLoginUriData","bypassValidation","toLoginData","toPasswordHistoryData","toSecureNoteData","Cipher","model","reduce","promise","attachment","decAttachment","field","decField","decPh","toCipherData","classInitializers","MultithreadEncryptServiceImplementation","clear$","worker","Worker","restartTimeout","postMessage","fromEvent","jsonItem","className","takeUntil","defaultIfEmpty","terminate","timeout","AzureFileUploadService","upload","renewalCallback","azureUploadBlob","azureUploadBlocks","urlObject","Headers","toUTCString","searchParams","Request","body","cache","method","blobResponse","fetch","baseUrl","blockSize","getMaxBlockSize","blockIndex","numBlocks","ceil","blocksStaged","renewUrlIfNecessary","blockUrl","blockId","encodedBlockId","append","start","blockData","blockHeaders","blockRequest","blockResponse","blockListUrl","blockListXml","expiry","setTime","utfBlockId","fromUtf8ToB64","blockIdList","xml","Version","month","day","compareTo","BitwardenFileUploadService","encryptedFileName","encryptedFileData","apiCall","fd","FormData","blob","Blob","filepath","contentType","FileUploadService","azureFileUploadService","bitwardenFileUploadService","uploadData","fileUploadMethods","fileUploadType","Direct","postDirect","Azure","renewFileUploadUrl","rollback","KeyGenerationService","bitLength","aesGenerateKey","createKeyWithPurpose","purpose","salt","material","hkdf","derivedKey","deriveKeyFromMaterial","deriveKeyFromPassword","pbkdf2","Argon2id","saltHash","argon2","AbstractStorageService","AbstractMemoryStorageService","TYPE","MemoryStorageService","store","updatesSubject","valuesRequireDeserialization","updates$","remove","toStore","structuredClone","updateType","getBypassCache","MigrationBuilder","migrations","with","migrate","addMigrator","helper","migrator","runMigrator","direction","newMigration","shouldMigrate","toVersion","updateVersion","IRREVERSIBLE","Migrator","fromVersion","startVersion","currentVersion","endVersion","USER_EVER_HAD_USER_KEY","EverHadUserKeyMigrator","getAccounts","account","everHadUserKey","setToUser","migrateAccount","getFromUser","rollbackAccount","USER_ENCRYPTED_ORGANIZATION_KEYS","OrganizationKeyMigrator","organizationKeys","ENVIRONMENT_STATE","REGION_KEY","URLS_KEY","MoveEnvironmentStateToProviders","legacyGlobal","region","setToGlobal","environmentUrls","legacyAccounts","updatedLegacyGlobal","globalRegion","getFromGlobal","globalUrls","updatedAccount","userRegion","userUrls","rollbackUser","USER_ENCRYPTED_PROVIDER_KEYS","ProviderKeyMigrator","providerKeys","CLIENT_KEY_HALF","MoveBiometricClientKeyHalfToStateProviders","biometricEncryptionClientKeyHalf","userKeyHalf","USER_ENCRYPTED_FOLDERS","FolderMigrator","folders","LAST_SYNC_KEY","LastSyncMigrator","lastSync","USER_ENABLE_PASSKEYS","EnablePasskeysMigrator","enablePasskeys","globalEnablePasskeys","autofillSettingsStateDefinition","AutofillSettingsKeyMigrator","globalState","autoFillOverlayVisibility","updateAccount","accountSettings","autoFillOnPageLoadDefault","enableAutoFillOnPageLoad","dismissedAutoFillOnPageLoadCallout","disableAutoTotpCopy","activateAutoFillOnPageLoadFromPolicy","inlineMenuVisibility","autoCopyTotp","RequirePasswordOnStartMigrator","requirePasswordOnStart","requirePassword","USER_ENCRYPTED_PRIVATE_KEY","PrivateKeyMigrator","USER_ENCRYPTED_COLLECTIONS","CollectionMigrator","collections","COLLAPSED_GROUPINGS","CollapsedGroupingsMigrator","collapsedGroupings","DISMISSED_BIOMETRIC_REQUIRE_PASSWORD_ON_START_CALLOUT","MoveBiometricPromptsToStateProviders","dismissedBiometricRequirePasswordOnStartCallout","disableAutoBiometricsPrompt","userDismissed","userPromptAutomatically","SM_ONBOARDING_TASKS","SmOnboardingTasksMigrator","smOnboardingTasks","autofillSettingsLocalStateDefinition","ClearClipboardDelayMigrator","clearClipboard","clearClipboardDelay","RevertLastSyncMigrator","FixPremiumMigrator","decodedToken","fixPremium","stateVersion","RemoveEverBeenUnlockedMigrator","everBeenUnlocked","removeEverBeenUnlocked","AddKeyTypeToOrgKeysMigrator","encryptedOrgKeys","newOrgKeys","updateOrgKey","RemoveLegacyEtmKeyMigrator","legacyEtmKey","MoveBiometricAutoPromptToAccount","noAutoPromptBiometrics","MoveStateVersionMigrator","MoveBrowserSettingsToGlobal","tryAddSetting","accountSelector","globalSetter","globalNeverDomainsValue","accumulator","normalizedNeverDomains","neverDomains","targetGlobalState","disableAddLoginNotification","disableChangedPasswordNotification","disableContextMenuItem","MinVersionMigrator","MIN_VERSION","MigrationBuilderService","build","migrationBuilderCache","MigrationHelper","getGlobalKey","removeFromGlobal","removeFromUser","userIds","userKeyBuilderPre9","userKeyBuilder","globalKeyBuilderPre9","MigrationRunner","diskStorage","migrationBuilderService","run","migrationHelper","migrationBuilder","waitForCompletion","isReady","wait","time","nextTime","waitForMigrations","VaultTimeoutAction","SystemService","reloadCallback","autofillSettingsService","reloadInterval","clearClipboardTimeout","clearClipboardTimeoutFunction","startProcessReload","cancelProcessReload","executeProcessReload","getBiometricFingerprintValidated","clearInterval","vaultTimeoutAction$","LogOut","nextUser","nextUpActiveUser","setActiveUser","setInterval","clipboardValue","timeoutMs","clipboardValueNow","readFromClipboard","copyToClipboard","clearing","clearPendingClipboard","DecryptParameters","WebCryptoFunctionService","globalContext","crypto","subtle","wasmSupported","checkIfWasmSupported","wcLen","passwordBuf","toBuf","pbkdf2Params","toWebCryptoAlgorithm","impKey","importKey","deriveBits","passwordArr","saltArr","pass","mem","hashLen","ArgonType","unloadRuntime","ikm","outputByteSize","hkdfParams","hkdfExpand","prk","infoBuf","infoArr","runningOkmLength","previousT","okm","md","md5","valueBytes","toByteString","digest","valueBuf","signingAlgorithm","sign","mac1","mac2","arr1","arr2","getBytes","rand","Uint32Array","createBuffer","putInt32","meta","encKeyByteString","macKeyByteString","decode64","parameters","mode","decipher","createDecipher","toWebCryptoAesMode","dataBuffer","finish","params","rsaParams","rsaExtractPublicKey","impPrivateKey","jwkPrivateKey","exportKey","jwkPublicKeyParams","kty","alg","ext","impPublicKey","key1","key2","aesParams","generateKey","rawKey","modulusLength","publicExponent","keyPair","getRandomValues","buf","encodeUtf8","WebAssembly","instantiate","module","Module","Instance","DEFAULT_OPTIONS","msTimeout","populateOptionsWithDefault","getStoredValue","storage","FAKE","DefaultActiveUserState","accountService","chosenStorageLocation","updatePromise","activeUserId$","userChangeAndInitial$","fullKey","latestStorage$","withLatestFrom","storageUpdate","_userId","share","connector","ReplaySubject","resetOnRefCountZero","timer","configureState","internalUpdate","newState","currentState","getStateForUpdate","combinedDependencies","saveToStorage","first","throwError","DefaultActiveUserStateProvider","memoryStorage","fromBaseKeyDefinition","cacheKey","existingUserState","newUserState","buildActiveUserState","getLocationString","getLocation","DefaultGlobalState","chosenLocation","globalKeyBuilder","initialStorageGet$","getFromState","DefaultGlobalStateProvider","globalStateCache","existingGlobalState","newGlobalState","DefaultSingleUserState","combineLatest","DefaultSingleUserStateProvider","buildSingleUserState","DefaultStateProvider","activeUserStateProvider","singleUserStateProvider","derivedStateProvider","getDerived","getUserState$","take","setUserState","UpdateAvatarRequest","avatarColor","AvatarUpdateService","_avatarUpdate$","BehaviorSubject","avatarUpdate$","loadColorFromState","getAvatarColor","pushUpdate","putAvatar","setAvatarColor","OrganizationConnectionResponse","configType","rawConfig","config","CardApi","FieldApi","IdentityApi","Fido2CredentialApi","LoginUriApi","LoginApi","SecureNoteApi","AttachmentResponse","PasswordHistoryResponse","CipherResponse","h","SelectionReadOnlyResponse","readOnly","hidePasswords","manage","CollectionResponse","externalId","CollectionDetailsResponse","assigned","CollectionAccessDetailsResponse","groups","users","OrganizationExportResponse","OrganizationSponsorshipSyncStatusResponse","lastSyncDate","ProviderOrganizationResponse","providerId","userCount","seats","plan","ProviderOrganizationOrganizationDetailsResponse","organizationName","OrganizationUserBulkPublicKeyResponse","ProviderUserBulkPublicKeyResponse","ProviderUserBulkResponse","PermissionsApi","accessEventLogs","accessImportExport","accessReports","createNewCollections","editAnyCollection","deleteAnyCollection","editAssignedCollections","deleteAssignedCollections","manageCiphers","manageGroups","manageSso","managePolicies","manageUsers","manageResetPassword","manageScim","ProviderUserResponse","permissions","ProviderUserUserDetailsResponse","ProviderResponse","businessName","billingEmail","ApiKeyResponse","apiKey","AuthRequestResponse","requestDeviceType","requestIpAddress","responseDate","requestDate","requestDateUTC","UTC","getUTCFullYear","getUTCMonth","getDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","dateNow","dateNowUTC","isExpired","isAnswered","DeviceVerificationResponse","isDeviceVerificationSectionEnabled","unknownDeviceVerificationEnabled","KeyConnectorUserKeyResponse","PreloginResponse","RegisterResponse","SsoPreValidateResponse","TwoFactorAuthenticatorResponse","TwoFactorDuoResponse","secretKey","integrationKey","TwoFactorEmailResponse","TwoFactorProviderResponse","TwoFactorRecoverResponse","TwoFactorWebAuthnResponse","KeyResponse","migrated","ChallengeResponse","attestation","authenticatorSelection","challenge","fromUrlB64ToArray","excludeCredentials","extensions","pubKeyCredParams","rp","user","TwoFactorYubiKeyResponse","key3","key4","key5","nfc","BillingSourceResponse","cardBrand","needsVerification","BillingInvoiceResponse","pdfUrl","paid","date","amount","BillingTransactionResponse","createdDate","refunded","partiallyRefunded","refundedAmount","paymentMethodType","details","BillingHistoryResponse","invoices","transactions","hasNoHistory","BillingPaymentResponse","balance","paymentSource","ProfileOrganizationResponse","usePolicies","useGroups","useDirectory","useTotp","use2fa","useApi","useSso","useKeyConnector","useScim","useCustomPermissions","useResetPassword","useSecretsManager","usePasswordManager","useActivateAutofillPolicy","selfHost","usersGetPremium","maxCollections","maxStorageGb","hasPublicAndPrivateKeys","ssoBound","resetPasswordEnrolled","providerName","familySponsorshipFriendlyName","familySponsorshipAvailable","planProductType","familySponsorshipLastSyncDateString","familySponsorshipLastSyncDate","familySponsorshipValidUntilString","familySponsorshipValidUntil","familySponsorshipToDelete","accessSecretsManager","limitCollectionCreationDeletion","allowAdminAccessToAllCollectionItems","flexibleCollections","ProfileProviderOrganizationResponse","ProfileProviderResponse","ProfileResponse","organizations","providerOrganizations","emailVerified","masterPasswordHint","premiumPersonally","premiumFromOrganization","culture","twoFactorEnabled","securityStamp","PaymentResponse","userProfile","paymentIntentClientSecret","success","PlanResponse","product","isAnnual","nameLocalizationKey","descriptionLocalizationKey","canBeUsedByBusiness","trialPeriodDays","hasSelfHost","hasPolicies","hasGroups","hasDirectory","hasEvents","has2fa","hasApi","hasSso","hasResetPassword","upgradeSortOrder","displaySortOrder","legacyYear","disabled","passwordManager","secretsManager","PasswordManager","PasswordManagerPlanFeaturesResponse","SecretsManager","SecretsManagerPlanFeaturesResponse","stripeSeatPlanId","baseSeats","basePrice","seatPrice","hasAdditionalSeatsOption","maxAdditionalSeats","maxSeats","stripeServiceAccountPlanId","additionalPricePerServiceAccount","baseServiceAccount","maxServiceAccount","hasAdditionalServiceAccountOption","maxAdditionalServiceAccounts","maxProjects","stripePlanId","stripeStoragePlanId","stripePremiumAccessPlanId","premiumAccessOptionPrice","additionalStoragePricePerGb","baseStorageGb","hasAdditionalStorageOption","maxAdditionalStorage","hasPremiumAccessOption","SubscriptionResponse","storageName","storageGb","license","subscription","upcomingInvoice","BillingSubscriptionResponse","BillingSubscriptionUpcomingInvoiceResponse","trialStartDate","trialEndDate","periodStartDate","periodEndDate","cancelledDate","cancelAtEndDate","cancelled","BillingSubscriptionItemResponse","productId","quantity","interval","sponsoredSubscriptionItem","addonSubscriptionItem","TaxInfoResponse","taxId","taxIdType","line1","line2","TaxRateResponse","rate","CollectionBulkDeleteRequest","ids","BreachAccountResponse","addedDate","breachDate","dataClasses","isActive","isVerified","logoPath","modifiedDate","pwnCount","GlobalDomainResponse","domains","excluded","DomainsResponse","globalEquivalentDomains","EventResponse","cipherId","collectionId","groupId","policyId","providerUserId","providerOrganizationId","actingUserId","ipAddress","installationId","systemUser","domainName","secretId","serviceAccountId","UserKeyResponse","AttachmentUploadDataResponse","attachmentId","cipherResponse","cipherMiniResponse","SendFileApi","SendTextApi","text","hidden","SendResponse","accessId","maxAccessCount","accessCount","expirationDate","deletionDate","disable","hideEmail","file","FolderResponse","SyncResponse","ApiService","customUserAgent","isWebClient","isDesktopClient","IEBrowser","ChromeBrowser","EdgeBrowser","FirefoxBrowser","OperaBrowser","SafariBrowser","UnknownBrowser","VivaldiBrowser","Accept","identityToken","getIdentityUrl","qsStringify","getCredentials","responseJson","isJsonResponse","TwoFactorProviders2","reject","refreshIdentityToken","doAuthRefresh","postAuthRequest","postAdminAuthRequest","getAuthResponse","path","getAuthRequests","getLastAuthRequest","activeRequests","m","getProfile","getUserSubscription","getTaxInfo","putProfile","putTaxInfo","postEmailToken","postEmail","postPassword","setPassword","postSecurityStamp","getAccountRevisionDate","postPasswordHint","postRegister","postPremium","postReinstatePremium","postCancelPremium","postAccountStorage","postAccountPayment","postAccountLicense","postAccountVerifyEmail","postAccountVerifyEmailToken","postAccountVerifyPassword","postAccountRecoverDelete","postAccountRecoverDeleteToken","postAccountKdf","deleteSsoUser","getSsoUserIdentifier","postUserApiKey","postUserRotateApiKey","putUpdateTempPassword","getUserBillingHistory","getUserBillingPayment","getCipher","getFullCipherDetails","getCipherAdmin","getCiphersOrganization","postCipher","postCipherCreate","postCipherAdmin","putCipher","putPartialCipher","putCipherAdmin","deleteCipher","deleteCipherAdmin","deleteManyCiphers","deleteManyCiphersAdmin","putMoveCiphers","putShareCipher","putShareCiphers","putCipherCollections","putCipherCollectionsAdmin","postPurgeCiphers","putDeleteCipher","putDeleteCipherAdmin","putDeleteManyCiphers","putDeleteManyCiphersAdmin","putRestoreCipher","putRestoreCipherAdmin","putRestoreManyCiphers","putRestoreManyCiphersAdmin","getAttachmentData","emergencyAccessId","postCipherAttachment","postCipherAttachmentLegacy","postCipherAttachmentAdminLegacy","deleteCipherAttachment","deleteCipherAttachmentAdmin","postShareCipherAttachment","renewAttachmentUploadUrl","postAttachmentFile","getCollectionAccessDetails","getUserCollections","getCollections","getManyCollectionsWithAccessDetails","getCollectionUsers","postCollection","putCollection","putCollectionUsers","deleteCollection","deleteManyCollections","deleteCollectionUser","getGroupUsers","putGroupUsers","deleteGroupUser","getPlans","postPublicImportDirectory","getTaxRates","getSettingsDomains","putSettingsDomains","getSync","getTwoFactorProviders","getTwoFactorOrganizationProviders","getTwoFactorAuthenticator","getTwoFactorEmail","getTwoFactorDuo","getTwoFactorOrganizationDuo","getTwoFactorYubiKey","getTwoFactorWebAuthn","getTwoFactorWebAuthnChallenge","getTwoFactorRecover","putTwoFactorAuthenticator","putTwoFactorEmail","putTwoFactorDuo","putTwoFactorOrganizationDuo","putTwoFactorYubiKey","putTwoFactorWebAuthn","rawId","getClientExtensionResults","AttestationObject","attestationObject","clientDataJson","clientDataJSON","deleteTwoFactorWebAuthn","putTwoFactorDisable","putTwoFactorOrganizationDisable","postTwoFactorRecover","postTwoFactorEmailSetup","postTwoFactorEmail","getDeviceVerificationSettings","putDeviceVerificationSettings","getCloudCommunicationsEnabled","getOrganizationConnection","createOrganizationConnection","updateOrganizationConnection","organizationConnectionId","deleteOrganizationConnection","postProviderSetup","getProvider","putProvider","getProviderUsers","getProviderUser","postProviderUserInvite","postProviderUserReinvite","postManyProviderUserReinvite","postProviderUserBulkConfirm","deleteManyProviderUsers","postProviderUserAccept","postProviderUserConfirm","postProviderUsersPublicKey","putProviderUser","deleteProviderUser","getProviderClients","postProviderAddOrganization","postProviderCreateOrganization","deleteProviderOrganization","getEvents","end","addEventParameters","getEventsCipher","getEventsOrganization","getEventsOrganizationUser","getEventsProvider","getEventsProviderUser","postEventsCollect","authHeader","getActiveBearerToken","Authorization","getEventsUrl","getUserPublicKey","getHibpBreach","postBitPayInvoice","postSetupPayment","handleError","getKeyConnectorAlive","getOrganizationExport","getApplicationVersionNumber","nativeFetch","preValidateSso","postCreateSponsorship","sponsoredOrgId","isSelfHost","getSponsorshipSyncStatus","deleteRevokeSponsorship","sponsoringOrganizationId","deleteRemoveSponsorship","sponsoringOrgId","postPreValidateSponsorshipToken","sponsorshipToken","postRedeemSponsorship","postResendSponsorshipOffer","doRefreshToken","doApiTokenRefresh","deviceRequest","hasResponse","apiUrl","alterHeaders","getApiUrl","pathParts","requestUrl","normalizePath","requestInit","responseType","responseIsJson","tokenError","isTextResponse","Message","hasBaseUrl","base","typeHeader","AuditService","passwordLeaked","hashBytes","fromBufferToHex","hashStart","hashEnding","breachedAccounts","limit","throttleKey","descriptor","originalMethod","allThrottles","throttles","getThrottles","argsThrottleKey","queue","exec","onFinally","splice","catch","err","EventData","EventCollectionService","cipherService","eventUploadService","collect","eventType","uploadImmediately","orgIds","eventCollection","getEventCollection","event","setEventCollection","uploadEvents","EventRequest","EventUploadService","checkOnInterval","req","clearEvents","NotificationResponse","contextId","payload","SyncCipherCreate","SyncCipherDelete","SyncCipherUpdate","SyncLoginDelete","SyncCipherNotification","SyncFolderCreate","SyncFolderDelete","SyncFolderUpdate","SyncFolderNotification","SyncVault","SyncCiphers","SyncOrganizations","SyncOrgKeys","SyncSettings","UserNotification","SyncSendCreate","SyncSendUpdate","SyncSendDelete","SyncSendNotification","AuthRequestPushNotification","NotificationsService","syncService","connected","inactive","reconnectTimer","urls","getNotificationsUrl","signalrConnection","off","stop","withUrl","accessTokenFactory","skipNegotiation","transport","WebSockets","withHubProtocol","on","processNotification","onclose","reconnect","isAuthedAndUnlocked","updateConnection","sync","reconnectFromActivity","disconnectFromInactivity","isAuthenticated","payloadUserId","UserId","myUserId","syncUpsertCipher","syncDeleteCipher","syncUpsertFolder","syncDeleteFolder","fullSync","syncUpsertSend","syncDeleteSend","getApproveLoginRequests","notificationId","SearchService","indexedEntityId","indexing","index","immediateSearchLocales","defaultSearchableMinLength","searchableMinLength","locale$","locale","registeredPipeline","lunr","Pipeline","registerFunction","normalizeAccentsPipelineFunction","clearIndex","isSearchable","query","normalizeSearchQuery","indexCiphers","builder","Builder","pipeline","ref","boost","extractor","uriExtractor","fieldExtractor","attachmentExtractor","searchCiphers","every","getIndexForSearch","searchCiphersBasic","ciphersMap","searchResults","soWild","Query","wildcard","LEADING","TRAILING","q","tokenizer","term","deleted","loginUri","searchSends","toLocaleLowerCase","sendsMatched","lowPriorityMatched","concat","joined","Text","protocolIndex","queryIndex","searchableFields","metadata","normalize","VaultTimeoutSettingsService","setVaultTimeoutOptions","action","setVaultTimeout","currentAction","getVaultTimeoutAction","setVaultTimeoutAction","refreshAdditionalKeys","availableVaultTimeoutActions$","getAvailableVaultTimeoutActions","pinIsEnabled","aUserKeyPinIsSet","anOldUserKeyPinIsSet","getBiometricUnlock","getVaultTimeout","vaultTimeout","policyAppliesToUser","MaximumVaultTimeout","availableActions","Lock","setEverBeenUnlocked","clearPinKeys","acctDecryptionOpts","DefaultBoundaries","freeze","minDigits","minSpecialCharacters","initializeBoundaries","createBoundary","defaultBoundary","numberCount","specialCount","minConsistentLength","minPolicyLength","policyInEffect","useUppercase","useLowercase","useNumbers","useSpecial","applyPolicy","fitToBounds","boundaries","withUpperBound","uppercase","lowercase","minNumber","special","minSpecial","sanitize","cascade","enabledResult","minLowercase","minUppercase","ambiguous","PasswordGeneratorPolicyOptions","defaultType","minNumberWords","capitalize","includeNumber","inEffect","clone","EFFLongWordList","DefaultPassphraseGenerationOptions","numWords","wordSeparator","PassphraseGeneratorOptionsEvaluator","GeneratedPasswordHistory","DefaultOptions","DefaultPolicy","PasswordGenerationService","generatePassword","generatePassphrase","positions","shuffleArray","allCharSet","lowercaseCharSet","uppercaseCharSet","numberCharSet","specialCharSet","positionChars","randomCharIndex","randomNumber","listLength","wordList","wordIndex","appendRandomNumberToRandomWord","getOptions","getPasswordGenerationOptions","setPasswordGenerationOptions","enforcedOptions","enforcePasswordGeneratorPoliciesOnOptions","getPasswordGeneratorPolicyOptions","evaluator","withPolicy","sanitized","PasswordGenerator","currentPolicy","useUpper","useLower","minNumbers","saveOptions","getHistory","getDecryptedPasswordGenerationHistory","getEncryptedPasswordGenerationHistory","decryptHistory","setDecryptedPasswordGenerationHistory","addHistory","currentHistory","matchesPrevious","unshift","pop","newHistory","encryptHistory","setEncryptedPasswordGenerationHistory","normalizeOptions","enforcedPolicyOptions","evaluatedOptions","santizedOptions","num","history","j","AnonAddyForwarder","generate","anonaddy","redirect","website","statusText","DuckDuckGoForwarder","FastmailForwarder","accountId","getAccountId","using","methodCalls","forDomain","emailPrefix","fastmail","methodResponses","created","notCreated","primaryAccounts","FirefoxRelayForwarder","generated_for","full_address","ForwarderOptions","FastmailForwarderOptions","AnonAddyForwarderOptions","forwardemail","ForwardEmailForwarderOptions","simplelogin","SimpleLoginForwarderOptions","SimpleLoginForwarder","Authentication","note","alias","ForwardEmailForwarder","labels","wordCapitalize","wordIncludeNumber","subaddressType","catchallType","forwardedService","forwardedAnonAddyDomain","forwardedAnonAddyBaseUrl","forwardedForwardEmailDomain","forwardedSimpleLoginBaseUrl","UsernameGenerationService","generateUsername","generateCatchall","generateSubaddress","generateForwarded","generateWord","word","zeroPad","subaddressEmail","atIndex","emailBeginning","emailEnding","subaddressString","randomString","catchallDomain","startString","forwarder","forwarderOptions","forwardedSimpleLoginApiKey","forwardedAnonAddyApiToken","forwardedFirefoxApiToken","forwardedFastmailApiToken","forwardedDuckDuckGoToken","forwardedForwardEmailApiToken","getUsernameGenerationOptions","setUsernameGenerationOptions","charSet","width","SendType","PasswordStrengthService","emailInput","userInputs","globalUserInputs","emailToUserInputs","finalUserInputs","atPosition","SendFileData","SendTextData","SendData","File","SendRequest","fileLength","SendAccessResponse","creatorIdentifier","SendFileDownloadDataResponse","SendFileUploadDataResponse","sendResponse","SendApiService","fileUploadService","sendService","getSend","postSendAccess","getSendFileDownloadData","getSends","postSend","postFileTypeSend","renewSendFileUploadUrl","sendId","fileId","postSendFile","postSendFileLegacy","putSend","putSendRemovePassword","deleteSend","sendData","removePassword","uploadDataResponse","generateMethods","legacyServerSendFileUpload","generatePostDirectCallback","generateRenewFileUploadUrlCallback","generateRollbackCallback","renewResponse","getFlags","envFlags","flagEnabled","flag","flags","sequentialize","caches","getCache","argsCacheKey","SortedCiphersCache","comparator","sortedCiphersByUrl","timeouts","isCached","addCiphers","Ciphers","resetTimer","getLastUsed","getLastLaunched","getNext","updateLastUsedIndex","lastUsedIndex","usedCiphers","lastLaunched","y","getNextIndex","CipherBulkDeleteRequest","CipherBulkMoveRequest","CipherBulkRestoreRequest","AttachmentRequest","CipherRequest","lastKnownRevisionDate","keyApi","attachments2","attachmentRequest","CipherWithIdRequest","CipherBulkShareRequest","CipherCollectionsRequest","CipherCreateRequest","CipherPartialRequest","CipherShareRequest","CIPHER_KEY_ENC_MIN_SERVER_VER","SemVer","CipherService","settingsService","searchService","cipherFileUploadService","configService","sortedCiphersCache","sortCiphersByLastUsed","getDecryptedCipherCache","getDecryptedCiphers","setDecryptedCipherCache","setDecryptedCiphers","clearCache","clearDecryptedCiphersState","keyForEncryption","keyForCipherKeyDecryption","originalCipher","updateModelfromExistingCipher","adjustPasswordHistoryLength","getCipherKeyEncryptionEnabled","userOrOrgKey","getKeyForCipherKeyDecryption","encryptCipherWithCipherKey","encryptCipher","encryptAttachments","attachmentsModel","encAttachments","encryptObjProperty","encryptFields","fieldsModel","encFields","encField","encryptField","fieldModel","Boolean","encryptPasswordHistories","phModels","encPhs","encPh","encryptPasswordHistory","phModel","getEncryptedCiphers","getLocalData","getAllDecrypted","reindexCiphers","orgKeys","getOrgKeys","grouped","agg","decCiphers","groupedCiphers","flat","getLocaleSortingFunction","getAllDecryptedForGrouping","groupingId","folder","getAllDecryptedForUrl","includeOtherTypes","defaultMatch","getEquivalentDomains","getDefaultUriMatch","cipherIsLogin","getAllFromApiForOrganization","decryptOrganizationCiphersResponse","getManyFromApiForOrganization","cr","getLastUsedForUrl","getCipherForUrl","getLastLaunchedForUrl","getNextCipherForUrl","updateLastUsedIndexForUrl","updateLastUsedDate","ciphersLocalData","setLocalData","decryptedCipherCache","cached","updateLastLaunchedDate","saveNeverDomain","getNeverDomains","setNeverDomains","createWithServer","orgAdmin","updateWithServer","isNotClone","shareWithServer","attachmentPromises","shareAttachmentWithServer","encCipher","encryptSharedCipher","shareManyWithServer","encCiphers","saveAttachmentWithServer","unencryptedFile","admin","reader","FileReader","readAsArrayBuffer","onload","evt","cData","saveAttachmentRawWithServer","onerror","filename","cipherKeyEncryptionEnabled","cipherEncKey","encFileName","dataEncKey","makeDataEncKey","encData","saveCollectionsWithServer","setEncryptedCiphers","clearEncryptedCiphersState","moveManyWithServer","deleteWithServer","asAdmin","deleteManyWithServer","deleteAttachment","deleteAttachmentWithServer","aLastUsed","bLastUsed","bothNotNull","sortCiphersByLastUsedThenName","aName","bName","softDelete","setDeletedDate","softDeleteWithServer","softDeleteManyWithServer","restore","clearDeletedDate","restoreWithServer","restoreManyWithServer","restores","existingCipher","existingHiddenFields","Hidden","hiddenFields","ef","matchedField","attachmentView","attachmentResponse","encBuf","decBuf","decryptFromBytes","theObj","modelProp","encryptCipherData","uriHash","viewKey","domainKey","origin","getAutofillOnPageLoadDefault","lastUsed","autofillOnPageLoadDefault","clearSortedCiphers","keyForCipherKeyEncryption","decryptedCipherKey","makeCipherKey","checkServerMeetsVersionRequirement$","CollectionData","CollectionView","Collection","canEdit","org","canEditAnyCollection","canEditAssignedCollections","canDelete","canDeleteAnyCollection","canDeleteAssignedCollections","TreeNode","node","parent","children","ServiceUtils","nodeTree","partIndex","delimiter","partName","nestedTraverse","newPartName","getTreeNodeObject","getTreeNodeObjectFromList","ENCRYPTED_COLLECTION_DATA_KEY","jsonData","DECRYPTED_COLLECTION_DATA_KEY","collection","collectionService","decryptMany","CollectionService","decryptedCollectionViews$","decryptedCollections$","encryptedCollectionDataState","encryptedCollections$","decryptedCollectionDataState","clearActiveUserCache","forceValue","decCollections","getSortFunction","cs","getAllNested","nodes","collectionCopy","getNested","toUpdate","Fido2AlgorithmIdentifier","Fido2AuthenticatorErrorCode","Fido2AuthenticatorError","errorCode","POW_2_32","POW_2_53","TaggedValue","tag","CBOR","decode","tagger","simpleValue","dataView","DataView","ta","offset","tagValueFunction","simpleValFunction","commitRead","readArrayBuffer","readUint8","readUint16","getUint16","readUint32","getUint32","readBreak","readLength","additionalInformation","readIndefiniteStringLength","majorType","initialByte","appendUtf16Data","utf16data","ret","decodeItem","tempArrayBuffer","tempDataView","exponent","fraction","setUint32","getFloat32","readFloat16","getFloat64","elements","fullArrayLength","fullArray","fullArrayOffset","string","retArray","retObject","encode","lastLength","byteView","prepareWrite","newByteLength","requiredLength","oldDataView","uint32count","commitWrite","writeUint8","setUint8","writeUint8Array","writeUint16","setUint16","writeUint32","writeUint64","low","high","writeTypeAndLength","encodeItem","is","setFloat64","writeFloat64","utf8data","charCode","converted","isView","SharedArrayBuffer","mod","writeVarUint","retView","getUint8","getParamSize","keySize","paramBytesForAlg","ES256","ES384","ES512","MAX_OCTET","ENCODED_TAG_SEQ","TAG_SEQ","ENCODED_TAG_INT","TAG_INT","countPadding","padding","needs0x00","p1363ToDer","signature","paramBytes","getParamBytesForAlg","signatureBytes","TypeError","rPadding","rNeeds0x00","sPadding","sNeeds0x00","rActualLength","sActualLength","rLength","sLength","rsBytes","shortLength","dst","subarray","Fido2Utils","bufferSource","bufferSourceToUint8Array","isArrayBuffer","byteToHex","guidToRawFormat","isValidGuid","guidToStandardFormat","AAGUID","KeyUsages","userInterface","makeCredential","tab","abortController","userInterfaceSession","newSession","fallbackSupported","credTypesAndPubKeyAlgs","requestedAlgorithms","NotSupported","requireResidentKey","Unknown","requireUserVerification","ensureUnlockedVault","existingCipherIds","findExcludedCredentials","excludeCredentialDescriptorList","informExcludedCredential","NotAllowed","fido2Credential","pubKeyDer","userVerified","confirmNewCredential","credentialName","rpEntity","userEntity","displayName","userVerification","namedCurve","createKeyPair","pkcs8Key","bufferToString","createKeyView","reencrypted","authData","generateAuthData","userPresence","fmt","attStmt","publicKeyAlgorithm","close","getAssertion","cipherOptions","allowCredentialDescriptorList","findCredentialsById","findCredentialsByRp","informCredentialNotFound","pickCredential","cipherIds","selectedCipherId","selectedCipher","selectedFido2Credential","selectedCredentialId","authenticatorData","sigBase","clientDataHash","generateSignature","getPrivateKeyFromFido2Credential","selectedCredential","stringToBuffer","credential","keyBuffer","rpIdHash","extensionData","attestationData","backupEligibility","backupState","authDataFlags","attestedCredentialData","credentialIdLength","publicKeyJwk","keyX","keyY","coseBytes","UserRequestedFallbackAbortReason","FallbackRequestedError","fallbackRequested","isValidRpId","parsedOrigin","parsedRpId","subdomain","endsWith","authenticator","vaultSettingsService","isFido2FeatureEnabled","userEnabledPasskeys","enablePasskeys$","isUserLoggedIn","isExcludedDomain","serverConfig$","isOriginEqualBitwardenVault","createCredential","AbortController","sameOriginWithAncestors","DOMException","kp","collectedClientData","crossOrigin","clientDataJSONBytes","makeCredentialParams","transports","residentKey","enterpriseAttestationPossible","mapToMakeCredentialParams","signal","aborted","setAbortTimeout","makeCredentialResult","credProps","reason","InvalidState","rk","assertCredential","getAssertionParams","allowedCredentialIds","mapToGetAssertionParams","getAssertionResult","TIMEOUTS","NO_VERIFICATION","DEFAULT","MIN","MAX","WITH_VERIFICATION","clampedTimeout","abort","CipherFileUploadService","adminRequest","legacyServerAttachmentFileUpload","isAdmin","FolderData","FolderRequest","FolderApiService","folderService","postFolder","putFolder","deleteFolder","FolderView","Folder","FOLDER_ENCRYPTED_FOLDERS","FOLDER_DECRYPTED_FOLDERS","values","decryptFolders","FolderService","encryptedFoldersState","decryptedFoldersState","folders$","folderData","folderViews$","getAllFromState","getAllDecryptedFromState","updates","cId","decryptFolderPromises","decryptedFolders","noneFolder","SyncNotifierService","_sync","sync$","OrganizationData","isMember","ProviderData","SyncService","providerService","folderApiService","sendApiService","syncInProgress","getLastSync","setLastSync","forceSync","allowThrowOnError","syncStarted","syncCompleted","needsSync","needsSyncing","syncProfile","syncFolders","syncCollections","syncCiphers","syncSends","syncSettings","syncPolicies","isEdit","localFolder","remoteFolder","localCipher","checkCollections","remoteCipher","localSend","remoteSend","successfully","stamp","getSecurityStamp","setProviderKeys","setOrgKeys","setSecurityStamp","setEmailVerified","setHasPremiumPersonally","setHasPremiumFromOrganization","setForceSetPasswordReasonIfNeeded","syncProfileOrganizations","profileResponse","isOwner","TdeUserWithoutPasswordHasPasswordResetPermission","eqDomains","setEquivalentDomains","B32Chars","SteamChars","TotpService","getCode","period","digits","keyB32","isOtpAuth","isSteamAuth","getQueryParams","digitParams","periodParam","algParam","epoch","timeHex","leftPad","decToHex","timeBytes","fromHexToArray","keyBytes","b32ToBytes","fullCode","trunc","pow","getTimeInterval","b32ToHex","cleanedInput","bits","hex","byteIndex","chunk","VaultSettingsService","enablePasskeysState","setEnablePasskeys","ImportApiService","postImportCiphers","postImportOrganizationCiphers","ImportCiphersRequest","folderRelationships","ImportOrganizationCiphersRequest","collectionRelationships","KvpRequest","CollectionRequest","CollectionWithIdRequest","FolderWithIdRequest","newLineRegex","passwordFieldNames","usernameFieldNames","notesFieldNames","uriFieldNames","parseCsvOptions","encoding","skipEmptyLines","parseXml","validateNoExternalEntities","doc","DOMParser","parseFromString","querySelector","parseCsv","header","parseOptions","splitNewLine","errors","row","parseSingleRowCsv","rowData","parsedRow","makeUriArray","fixUri","returnArr","nameFromUrl","getValueOrDefault","setCardExpiration","expiryRegex","expiryMatch","moveFoldersToCollections","querySelectorDirectChild","parentEl","els","querySelectorAllDirectChild","querySelectorAll","el","parentNode","initLoginCipher","cleanupCipher","processKvp","processFolder","folderName","addRelationship","folderIndex","addFolder","convertToNoteIfNeeded","Generic","processFullName","nameParts","AscendoCsvImporter","fieldLower","AvastCsvImporter","AvastJsonImporter","logins","custName","pwd","loginName","label","cards","holderName","cardNumber","cvv","getCardBrandByPatterns","AviraCsvImporter","secondary_username","BlackBerryCsvImporter","grouping","fav","extra","ChromeCsvImporter","androidPatternRegex","BitwardenCsvImporter","col","addCollection","collectionIndex","delimPosition","login_totp","login_username","login_password","login_uri","CardExport","FieldExport","IdentityExport","Fido2CredentialExport","LoginUriExport","LoginExport","template","toView","toDomain","PasswordHistoryExport","SecureNoteExport","CipherExport","CipherWithIdExport","CollectionExport","CollectionWithIdExport","FolderExport","FolderWithIdExport","BitwardenJsonImporter","parseEncrypted","parseDecrypted","encKeyValidation_DO_NOT_EDIT","orgKey","encKeyValidation","errorMessage","groupingsMap","parseCollections","parseFolders","folderView","collectionView","BitwardenPasswordProtectedImporter","promptForPassword_callback","parsedData","passwordProtected","cannotParseFile","checkPassword","clearTextData","jdoc","makePinKey","BlurCsvImporter","OfficialProps","ButtercupCsvImporter","processingCustomFields","ClipperzHtmlImporter","textarea","textContent","entry","property","actionType","labelLower","CodebookCsvImporter","Category","Favorite","Entry","Note","TOTP","Website","Account","_mappedCredentialsColumns","_mappedPersonalInfoAsIdentityColumns","_mappedSecureNoteColumns","DashlaneCsvImporter","parsePersonalInformationRecordAsIdentity","rowKeys","category","parseCredentialsRecord","parsePaymentRecord","parseIdRecord","parsePersonalInformationRecord","parseSecureNoteRecords","otpSecret","importUnmappedFields","account_name","mappedValues","cc_number","expiration_month","expiration_year","account_holder","account_number","first_name","middle_name","last_name","item_name","dataRow","phone_number","zip","HandledResults","DashlaneJsonImporter","ADDRESS","processAddress","AUTHENTIFIANT","processAuth","BANKSTATEMENT","processNote","IDCARD","PAYMENTMEANS_CREDITCARD","processCard","IDENTITY","processIdentity","secondaryLogin","pseudo","addressName","addressFull","zipcode","bank","owner","nameProperty","EncryptrCsvImporter","Label","Notes","CVV","Expiry","expParts","EnpassCsvImporter","firstRow","containsField","fieldValue","fieldName","fieldNameLower","androidUrlRegex","EnpassJsonImporter","foldersMap","foldersIndexMap","folderTree","buildFolderTree","flattenFolderTree","template_type","processLogin","cleanedValue","sensitive","uuid","parent_uuid","titlePrefix","tree","FirefoxCsvImporter","FskEntryTypesEnum","FSecureFskImporter","parseEntry","service","handleLoginEntry","CreditCard","handleCreditCardEntry","creditNumber","creditCvv","creditExpiry","GnomeJsonImporter","keyRing","display_name","attributes","username_value","attr","NotesHeader","ApplicationsHeader","WebsitesHeader","Delimiter","KasperskyTxtImporter","notesData","applicationsData","websitesData","workingData","parseDataCategory","applications","websites","w","nameKey","itemComment","itemCommentKey","colonIndex","KeePass2XmlImporter","KeePassFileNode","RootNode","rootGroup","traverse","isRootNode","groupPrefixName","groupName","nameEl","cipherIndex","entryString","valueEl","keyEl","attrs","ProtectInMemory","group","KeePassXCsvImporter","Group","KeeperCsvImporter","LastPassCsvImporter","hasFolder","buildBaseCipher","parseSecureNote","parseCard","parseIdentity","ccnum","cardCipher","profilename","firstname","lastname","ccname","cccsc","ccexp","ccexpParts","middlename","extraParts","processedNote","typeParts","mappedData","parseSecureNoteMapping","monthString","getMonth","processingNotes","extraPart","LogMeOnceCsvImporter","MeldiumCsvImporter","DisplayName","UserName","Url","MSecureCsvImporter","mappedBaseColumns","_mappedUserAccountColumns","_mappedCreditCardColumns","_mappedIdentityColumns","_mappedIdCardColumns","_mappedTwoFaColumns","_mappedUserNoteColumns","MykiCsvImporter","nickname","additionalInfo","twofaSecret","authToken","cardName","exp_month","exp_year","firstAddressLine","secondAddressLine","zipCode","idType","idName","idCountry","idNumber","content","NordPassCsvImporter","recordType","evaluateType","cardholdername","cardnumber","cvc","expirydate","full_name","OnePassword1PifImporter","line","trashed","processStandardItem","processWinOpVaultItem","overview","URLs","parsePasswordHistory","notesPlain","parseFields","sections","section","openContents","faveIndex","typeName","location","secureContents","maxSize","designationKey","valueKey","fieldDesignation","street","fieldType","CategoryEnum","LoginFieldTypeEnum","OnePassword1PuxImporter","vaults","categoryUuid","Database","WirelessRouter","Server","API_Credential","BankAccount","SoftwareLicense","EmailAccount","MedicalRecord","DriversLicense","OutdoorLicense","Membership","Passport","RewardsProgram","SocialSecurityNumber","favIndex","processOverview","processLoginFields","processDetails","processSections","tags","inputString","loginFields","loginField","designation","CheckBox","parseSectionFields","sectionTitle","anyField","getFieldName","extractValue","fillLogin","fillApiCredentials","fillCreditCard","fillBankAccount","fillIdentity","fillDriversLicense","fillOutdoorLicense","fillMembership","fillPassport","fillRewardsProgram","fillSSN","email_address","guarded","monthYear","historyItems","CipherImportContext","importRecord","lowerProperty","IgnoredProperties","OnePasswordCsvImporter","loginPropertyParsers","setLoginUsername","setLoginPassword","setLoginUris","creditCardPropertyParsers","setCreditCardNumber","setCreditCardVerification","setCreditCardCardholderName","setCreditCardExpiry","identityPropertyParsers","setIdentityFirstName","setIdentityInitial","setIdentityLastName","setIdentityUserName","setIdentityEmail","setIdentityPhone","setIdentityCompany","quoteChar","escapeChar","getProp","setNotes","setCipherType","altUsername","context","setKnownLoginValue","setKnownCreditCardValue","setKnownIdentityValue","setUnknownValue","getPropByRegexp","regexp","matchingKeys","getPropIncluding","includesMap","func","readableDate","OnePasswordMacCsvImporter","OnePasswordWinCsvImporter","setIdentityAddress","expSplit","PadlockCsvImporter","PassKeepCsvImporter","getValue","PasskyJsonImporter","passkyExport","passwords","PassmanJsonImporter","custom_fields","customField","field_type","PasspackCsvImporter","tagsJson","Tags","tagJson","__parsed_extra","fieldsJson","extraFields","fieldJson","PasswordAgentCsvImporter","newVersion","altFormat","PasswordBossJsonImporter","login_url","identifiers","valObj","expDate","getFullYear","cf","PasswordDragonXmlImporter","records","categoryText","accountName","tagName","PasswordSafeXmlImporter","passwordSafe","notesDelimiter","getAttribute","groupText","PasswordWalletTxtImporter","ProtonPassItemState","ProtonPassJsonImporter","TRASHED","loginContent","totpUri","extraField","creditCardContent","verificationNumber","PsonoJsonImporter","WEBSITE_mappedValues","APP_PWD_mappedValues","BOOKMARK_mappedValues","NOTES_mappedValues","TOTP_mappedValues","ENV_VARIABLES_mappedValues","GPG_mappedValues","psonoExport","handleItemParsing","parentName","folderHasItems","folderHasSubfolders","parsePsonoItem","parseWebsiteLogins","parseApplicationPasswords","parseEnvironmentVariables","parseTOTP","parseBookmarks","parseNotes","website_password_title","website_password_notes","website_password_username","website_password_password","website_password_url","website_password_auto_submit","website_password_url_filter","application_password_title","application_password_notes","application_password_username","application_password_password","bookmark_title","bookmark_notes","bookmark_url","note_title","note_notes","totp_title","totp_notes","totp_code","environment_variables_title","environment_variables_notes","environment_variables_variables","KvPair","parseGPG","mail_gpg_own_key_title","mail_gpg_own_key_public","mail_gpg_own_key_name","mail_gpg_own_key_email","mail_gpg_own_key_private","RememBearCsvImporter","trash","cardholder","expiryMonth","expMonthNumber","expiryYear","expYearNumber","RoboFormCsvImporter","Name","Pwd","Rf_fields","SafariCsvImporter","OTPAuth","SafeInCloudXmlImporter","labelEl","cardEl","labelIdEl","labelId","fieldEl","notesEl","candidates","choice","SaferPassCsvImporter","SecureSafeCsvImporter","urlField","Comment","SplashIdCsvImporter","parseFieldsToNotes","startIndex","StickyPasswordXmlImporter","loginNodes","loginNode","usernameText","passwordText","titleText","linkText","notesText","accountLogin","parentElement","buildGroupText","PropertiesToIgnore","TrueKeyCsvImporter","memo","kind","expiryDate","document_content","UpmCsvImporter","YotiCsvImporter","ZohoVaultCsvImporter","ChamberName","parseData","SecretData","CustomData","featuredImportOptions","regularImportOptions","ImportService","importApiService","getImportOptions","import","importer","fileContents","selectedImportTarget","canAccessImportExport","importResult","SyntaxError","halfway","last","badData","setImportTarget","handleOrganizationalImport","handleIndividualImport","errorResponse","handleServerError","getImporter","format","getImporterInstance","itemType","importTarget","targetCollection","noCollectionRelationShips","relationships","targetFolder","noFolderRelationShips","isNullOrEmpty","newFolderName","ExportHelper","extension","padNumber","getHours","getMinutes","getSeconds","padCharacter","numString","VaultExportService","individualVaultExportService","organizationVaultExportService","getExport","getPasswordProtectedExport","onlyManagedCollections","getFileName","BaseVaultExportService","buildPasswordExport","clearText","encText","jsonDoc","buildCommonCipher","OrganizationVaultExportService","getEncryptedManagedExport","getOrganizationEncryptedExport","getDecryptedManagedExport","getOrganizationDecryptedExport","exportData","exportPromises","decCol","decCipher","buildCsvExport","buildJsonExport","BuildEncryptedExport","allDecCiphers","dC","allCiphers","encCollections","eC","collectionsMap","exportCiphers","IndividualVaultExportService","getEncryptedExport","getDecryptedExport","decFolders","Organization","isManager","Manager","canAccessReports","canCreateNewCollections","canUseAdminCollections","canEditAllCiphers","flexibleCollectionsV1Enabled","Custom","canViewAllCollections","canViewAssignedCollections","canManageGroups","canManageSso","canManageDomainVerification","canManageScim","canManagePolicies","canManageUsersPassword","canManageDeviceApprovals","isExemptFromPolicies","canViewSubscription","canEditSubscription","hasProvider","Msp","canEditPaymentMethods","canViewBillingHistory","hasReseller","Reseller","canAccessSecretsManager","isFreeOrg","OrganizationService","ORGANIZATIONS","_organizations","organizations$","memberOrganizations$","orgs","activeUserOrganizations$","activeUserMemberOrganizations$","activeAccountUnlocked$","concatMap","unlocked","getOrganizations","updateObservables","get$","organizationsMap","canManageSponsorships","hasOrganizations","getByIdentifier","setOrganizations","SafariApp","command","resolveNow","isSafariApi","messageId","MAX_SAFE_INTEGER","browser","runtime","sendNativeMessage","responseData","BrowserPlatformUtilsService","clipboardWriteCallback","biometricCallback","deviceCache","isFirefox","FirefoxExtension","isOpera","OperaExtension","isEdge","EdgeExtension","isVivaldi","VivaldiExtension","isChrome","ChromeExtension","isSafari","SafariExtension","Browser","chrome","opr","addons","safariVersion","isIE","isMacAppStore","isViewOpen","sendMessageWithResponse","lockTimeout","createNewTab","extensionPage","getApplicationVersion","PublicKeyCredential","document","clearMs","sendMessageToApp","clipboard","writeText","queryCommandSupported","createElement","style","position","appendChild","select","execCommand","removeChild","readText","focus","supportsBiometric","getPlatformInfo","os","authenticateBiometric","getAutofillKeyboardShortcut","autofillCommand","commands","shortcut","manifestVersion","getManifest","manifest_version","windowId","getWindowById","getCurrentWindow","windows","getCurrent","populate","updateWindowProperties","focused","tabsQueryFirst","active","WINDOW_ID_CURRENT","tabId","tabs","currentWindow","tabsQuery","tabSendMessage","sendMessage","lastError","responseCallback","incognito","onCreated","addListener","getBackgroundPage","fetchProperties","getViews","getExtensionViews","onMessage","Observable","subscriber","handler","removeListener","onChanged","isBackgroundPage","trackedChromeEventListeners","setupUnloadListeners","findIndex","_event","eventListener","onpagehide","arg","highlighted","isWebExtensionsApi","isFirefoxOnAndroid","finally","i18n","getUILanguage","reload","exemptCurrentHref","views","currentHref","href","application","connectNative","isChromeApi","permission","contains","browserAction","sidebarAction","captureVisibleTab","scripting","executeScript","allFrames","frameIds","frameId","files","injectImmediately","runAt","checkOverrideStatus","levelOfControl","autofillAddressOverridden","privacy","services","autofillAddressEnabled","autofillCreditCardOverridden","autofillCreditCardEnabled","passwordSavingOverridden","passwordSavingEnabled","SyncedItemMetadata","itemBuilder","initializer","initializeAs","keyValuePair","SessionSyncer","subject","memoryStorageService","metaData","ignoreNUpdates","_buffer","observe","sessionKey","updateFromMemory","listenForUpdates","stream","skip","updateSession","messageListener","updateMessageCommand","updateFromMessage","serializedValue","unBuiltValue","browserSession","findStorageService","__syncedItemMetadata","__sessionSyncers","buildSyncer","storageSerice","syncer","isMemoryStorageService","sessionSync","buildOptions","BrowserOrganizationService","Policy","ResetPasswordPolicyOptions","autoEnrollEnabled","PolicyService","_policies","getEncryptedPolicies","policyType","policyFilter","checkPoliciesThatApplyToUser","decryptedPolicies","getDecryptedPolicies","diskPolicies","setDecryptedPolicies","obsPolicies","filteredPolicies","policyAppliesToActiveUser$","newPassword","toLocaleUpperCase","getResetPasswordPolicyOptions","resetPasswordPolicyOptions","ResetPassword","policyResponse","policyData","mapPoliciesFromToken","policiesResponse","setEncryptedPolicies","policiesMap","policySet","Accepted","BrowserPolicyService","ContextMenusBackground","contextMenuClickedHandler","contextMenus","onClicked","sender","cipherAction","commandToRetry","contextMenuOnClickData","tabSendMessageData","urlContainsSearchParams","popoutKey","scrollingContainer","getElementsByTagName","scrollTop","scrollYAmount","delay","containerSelector","container","backgroundInitializationRequired","extensionUrlPath","senderWindowId","singleActionKey","forceCloseExistingWindows","windowOptions","defaultPopoutWindowOptions","height","popupWidth","senderWindow","getWindow","popoutWindowOptions","left","top","buildPopoutUrl","isSingleActionPopoutOpen","createWindow","delayClose","extensionUrl","getURL","removeWindow","popoutUrl","parsedUrl","hashRoute","openPopout","pathname","inPopup","closePopup","windowInfo","popoutTabs","shift","searchParam","searchValue","AuthPopoutType","extensionUnlockUrls","openUnlockPopout","senderTab","skipNotification","windowType","VaultPopoutType","viewVaultItem","addEditVaultItem","fido2Popout","openViewVaultItemPopout","promptWindowPath","queryParamToken","formatQueryString","queryString","openVaultItemPasswordRepromptPopout","openAddEditVaultItemPopout","cipherType","addEditCipherUrl","NotificationQueueMessageType","NotificationBackground","autofillService","notificationQueue","extensionMessageHandlers","unlockCompleted","handleUnlockCompleted","bgGetFolderData","getFolderData","bgCloseNotificationBar","handleCloseNotificationBarMessage","bgAdjustNotificationBar","handleAdjustNotificationBarMessage","bgAddLogin","addLogin","bgChangedPassword","changedPassword","bgRemoveTabFromNotificationQueue","removeTabFromNotificationQueue","bgSaveCipher","handleSaveCipherMessage","bgNeverSave","saveNever","collectPageDetailsResponse","handleCollectPageDetailsResponseMessage","bgUnlockPopoutOpened","unlockVault","checkNotificationQueue","bgReopenUnlockPopout","handleExtensionMessage","messageResponse","setupExtensionMessageListener","cleanupNotificationQueue","doNotificationQueueCheck","currentTab","getTabFromCurrentWindow","expires","tabDomain","queueMessage","sendNotificationQueueMessage","notificationQueueMessage","notificationType","webVaultURL","getWebVaultUrl","typeData","isVaultLocked","wasVaultLocked","getCurrentTheme","removeIndividualVault","importType","getTheme","matchMedia","matches","Dark","Light","authStatus","loginInfo","normalizedUsername","loginDomain","disabledAddLogin","getDisableAddLoginNotification","pushAddLoginToQueue","usernameMatches","getDisableChangedPasswordNotification","pushChangePasswordToQueue","changeData","currentPassword","passwordMatches","forms","getFormsWithPasswordFields","pushUnlockVaultToQueue","requestFilelessImport","pushRequestFilelessImportToQueue","saveOrUpdateCredentials","cipherView","getDecryptedCipherById","updatePassword","folderExists","newCipher","convertAddLoginQueueMessageToCipherView","editItem","setAddEditCipherInfo","PersonalOwnership","messageData","retryCommand","retryHandler","uriView","loginView","buildCipherIcon","iconsServerUrl","isFaviconDisabled","imageEnabled","icon","image","fallbackImage","cardIcons","Visa","Mastercard","Amex","Discover","JCB","Maestro","UnionPay","RuPay","hostnameUri","overlayLoginCiphers","pageDetailsForTab","userAuthStatus","openAutofillOverlay","openOverlay","autofillOverlayElementClosed","overlayElementClosed","autofillOverlayAddNewVaultItem","addNewVaultItem","getAutofillOverlayVisibility","getOverlayVisibility","checkAutofillOverlayFocused","checkOverlayFocused","focusAutofillOverlayList","focusOverlayList","updateAutofillOverlayPosition","updateOverlayPosition","updateAutofillOverlayHidden","updateOverlayHidden","updateFocusedFieldData","setFocusedFieldData","storePageDetails","addEditCipherSubmitted","updateOverlayCiphers","deletedCipher","overlayButtonPortMessageHandlers","overlayButtonClicked","port","handleOverlayButtonClicked","closeAutofillOverlay","closeOverlay","forceCloseAutofillOverlay","overlayPageBlurred","checkOverlayListFocused","redirectOverlayFocusOut","overlayListPortMessageHandlers","checkAutofillOverlayButtonFocused","checkOverlayButtonFocused","fillSelectedListItem","fillSelectedOverlayListItem","getNewVaultItemDetails","viewSelectedCipher","handlePortOnConnect","isOverlayListPort","isOverlayButtonPort","overlayListPort","overlayButtonPort","handleOverlayElementPortMessage","styleSheetUrl","translations","getTranslations","getOverlayCipherData","overlayElement","getIconsUrl","removePageDetails","setupExtensionMessageListeners","getTabFromCurrentWindowId","ciphersViews","isOverlayCiphersPopulated","getDisableFavicon","overlayCiphersArray","overlayCipherData","loginCipherIcon","overlayCipherId","pageDetails","isPasswordRepromptRequired","totpCode","doAutoFill","fillNewPassword","allowTotpAutofill","forceCloseOverlay","disconnect","styles","getOverlayListPosition","getOverlayButtonPosition","focusedFieldData","focusedFieldRects","paddingRight","paddingLeft","focusedFieldStyles","elementOffset","elementHeight","elementTopPosition","elementLeftPosition","fieldPaddingRight","display","portMessage","isFocusingFieldElement","isOpeningFullOverlay","formerAuthStatus","updateOverlayButtonAuthStatus","retryMessage","overlayPageTranslations","opensInANewWindow","translate","buttonPageTitle","toggleBitwardenVaultOverlay","listPageTitle","unlockYourAccount","unlockAccount","fillCredentialsFor","partialUsername","noItemsToShow","newItem","onConnect","TabsBackground","main","notificationBackground","overlayBackground","handleWindowOnFocusChanged","focusedWindowId","updateCurrentTabData","handleTabOnActivated","handleTabOnReplaced","onReplacedRan","handleTabOnUpdated","changeInfo","onUpdatedRan","refreshBadge","refreshMenu","handleTabOnRemoved","setupTabEventListeners","onFocusChanged","onActivated","onReplaced","onUpdated","onRemoved","WebRequestBackground","pendingAuthRequests","webRequest","onAuthRequired","requestId","resolveAuthCredentials","onCompleted","completeAuthRequest","onErrorOccurred","authCredentials","factory","cachedServices","opts","instance","alwaysInitializeNewService","instanceOrPromise","doNotStoreInitializedService","AbstractChromeStorageService","chromeStorageApi","mergeMap","changes","change","keyedObj","BrowserLocalStorageService","local","BrowserMemoryStorageService","session","LocalBackedSessionStorageService","localStorage","sessionStorage","getLocalSession","getSessionEncKey","sessionEncKey","localSession","setLocalSession","sessionJson","setSessionEncKey","setEncryptedLocalSession","setDecryptedLocalSession","jsonSession","encSession","storedKey","input","BackgroundMemoryStorageService","_ports","storageLocation","portName","listenerCallback","onMessageFromForeground","onDisconnect","sendMessageTo","broadcastMessage","originator","logServiceFactory","logServiceOptions","cryptoFunctionServiceFactory","cryptoFunctionServiceOptions","encryptServiceFactory","encryptServiceOptions","keyGenerationServiceFactory","diskStorageServiceFactory","observableDiskStorageServiceFactory","observableMemoryStorageServiceFactory","globalStateProviderFactory","BrowserMessagingService","messagingServiceFactory","Region","RegionDomain","accountServiceFactory","EnvironmentService","initialized","LogService","SendFileView","SendTextView","maskedText","SendView","urlB64Key","maxAccessCountReached","expired","pendingDelete","cryptoKey","globals","authenticatedAccounts","accountActivity","accountDeserializer","buildAccountMapFromJSON","jsonAccounts","partialKeys","DDG_SHARED_KEY","StateService","secureStorageService","stateFactory","migrationRunner","useAccountCache","accountsSubject","activeAccountSubject","hasBeenInited","isRecoveredSession","accountDiskCache","initOptions","runMigrations","setState","createGlobals","initAccountState","updateState","syncAccountFromDisk","storedActiveUser","activeUserId","pushAccounts","activeDiskAccount","getAccountFromDisk","diskAccount","autoKey","getUserKeyAutoUnlock","accountStatus","seedUserEnvironment","scaffoldNewAccountStorage","setLastActive","clearDecryptedDataForActiveUser","clean","reconcileOptions","defaultInMemoryOptions","deAuthenticateAccount","currentUser","dynamicallySetActiveUser","removeAccountFromDisk","removeAccountFromMemory","getTimeoutBasedStorageOptions","getAccount","saveAccount","getAddEditCipherInfo","raw","getAlwaysShowDock","getGlobals","defaultOnDiskOptions","alwaysShowDock","setAlwaysShowDock","saveGlobals","apiKeyClientId","apiKeyClientSecret","getAutoConfirmFingerPrints","autoConfirmFingerPrints","setAutoConfirmFingerprints","biometricFingerprintValidated","setBiometricFingerprintValidated","biometricUnlock","setBiometricUnlock","getCanAccessPremium","getHasPremiumPersonally","getHasPremiumFromOrganization","hasPremiumFromOrganization","convertAccountToKeyConnector","getCryptoMasterKey","getMasterKeyEncryptedUserKey","keySuffix","defaultSecureStorageOptions","setUserKeyAutoUnlock","saveSecureStorageKey","getUserKeyBiometric","hasUserKeyBiometric","setUserKeyBiometric","setPinKeyEncryptedUserKey","pinKeyEncryptedUserKeyEphemeral","setPinKeyEncryptedUserKeyEphemeral","getCryptoMasterKeyAuto","setCryptoMasterKeyAuto","getCryptoMasterKeyB64","setCryptoMasterKeyB64","getCryptoMasterKeyBiometric","hasCryptoMasterKeyBiometric","setCryptoMasterKeyBiometric","setDecryptedPinProtected","getDecryptedSends","setDecryptedSends","setDefaultUriMatch","setDisableAddLoginNotification","getDisableBadgeCounter","disableBadgeCounter","setDisableBadgeCounter","setDisableChangedPasswordNotification","getDisableContextMenuItem","setDisableContextMenuItem","defaultOnDiskLocalOptions","disableFavicon","setDisableFavicon","getDisableGa","disableGa","setDisableGa","getDontShowCardsCurrentTab","dontShowCardsCurrentTab","setDontShowCardsCurrentTab","getDontShowIdentitiesCurrentTab","dontShowIdentitiesCurrentTab","setDontShowIdentitiesCurrentTab","getDuckDuckGoSharedKey","setDuckDuckGoSharedKey","existingDeviceKey","trustDeviceChoiceForDecryption","setAccountDecryptionOptions","setEmail","getEnableAlwaysOnTop","accountPreference","enableAlwaysOnTop","globalPreference","setEnableAlwaysOnTop","getEnableBrowserIntegration","enableBrowserIntegration","setEnableBrowserIntegration","getEnableBrowserIntegrationFingerprint","enableBrowserIntegrationFingerprint","setEnableBrowserIntegrationFingerprint","getEnableCloseToTray","enableCloseToTray","setEnableCloseToTray","getEnableDuckDuckGoBrowserIntegration","enableDuckDuckGoBrowserIntegration","setEnableDuckDuckGoBrowserIntegration","getEnableMinimizeToTray","enableMinimizeToTray","setEnableMinimizeToTray","getEnableStartToTray","enableStartToTray","setEnableStartToTray","getEnableTray","enableTray","setEnableTray","defaultOnDiskMemoryOptions","getEncryptedCryptoSymmetricKey","setEncryptedPinProtected","getEncryptedSends","setEncryptedSends","getForceSetPasswordReason","forceSetPasswordReason","getInstalledVersion","installedVersion","setInstalledVersion","setKdfConfig","setKdfType","keyHash","setKeyHash","getLastActive","getLocale","setLocale","getMainWindowSize","mainWindowSize","setMainWindowSize","getMinimizeOnCopyToClipboard","minimizeOnCopyToClipboard","setMinimizeOnCopyToClipboard","getOpenAtLogin","openAtLogin","setOpenAtLogin","getOrganizationInvitation","organizationInvitation","setOrganizationInvitation","passwordGenerationOptions","usernameGenerationOptions","getGeneratorOptions","generatorOptions","setGeneratorOptions","setProtectedPin","getRememberedEmail","rememberedEmail","setRememberedEmail","getSettings","setSettings","setTheme","accountVaultTimeoutAction","approveLoginRequests","setApproveLoginRequests","setWindow","setServerConfig","getServerConfig","getDeepLinkRedirectUrl","deepLinkRedirectUrl","setDeepLinkRedirectUrl","useMemory","getGlobalsFromMemory","useDisk","getGlobalsFromDisk","saveGlobalsToMemory","saveGlobalsToDisk","useSecureStorage","getAccountFromMemory","getUserIdFromMemory","cachedAccount","setDiskCache","Memory","Both","Disk","saveAccountToMemory","saveAccountToDisk","deleteDiskCache","deepClone","scaffoldNewAccountLocalStorage","scaffoldNewAccountSessionStorage","scaffoldNewAccountMemoryStorage","storedAccount","requestedOptions","defaultOptions","Session","getActiveUserIdFromStorage","removeAccountFromLocalStorage","resetAccount","removeAccountFromSessionStorage","removeAccountFromSecureStorage","persistentAccountInformation","newActiveUser","timeoutAction","stateUpdater","updatedState","withPrototypeForArrayMembers","memberConstructor","memberConverter","originalResult","isPromise","getOwnPropertyDescriptors","withPrototypeForObjectValues","valuesConstructor","valuesConverter","BrowserComponentState","BrowserGroupingsComponentState","collectionCounts","mapToRecord","folderCounts","typeCounts","favoriteCiphers","noFolderCiphers","recordToMap","BrowserSendComponentState","AccountSettings","groupings","sendType","BrowserStateService","storageChangeListener","namespace","respond","getBrowserGroupingComponentState","setBrowserGroupingComponentState","getBrowserVaultItemsComponentState","setBrowserVaultItemsComponentState","getBrowserSendComponentState","setBrowserSendComponentState","getBrowserSendTypeComponentState","setBrowserSendTypeComponentState","EnvironmentUrls","icons","events","webVault","keyConnector","urlsSubject","scimUrl","usUrls","scim","euUrls","activeAccountId$","oldUserId","newUserId","setUrlsFromStorage","regionGlobalState","urlsGlobalState","notificationsUrl","webVaultUrl","getCloudWebVaultUrl","cloudWebVaultUrl","setCloudWebVaultUrl","EU","US","getSendUrl","iconsUrl","identityUrl","eventsUrl","getScimUrl","getRegion","savedUrls","getEnvironmentUrls","envUrls","setRegion","SelfHosted","setUrls","formatUrl","getUrls","cloudWebVault","isEmpty","selectedRegion","setUrlsInternal","isCloud","BrowserEnvironmentService","hasManagedEnvironment","getManagedEnvironment","settingsHaveChanged","env","managed","setUrlsToManagedEnvironment","DefaultDerivedState","parentState$","deriveDefinition","dependencies","forcedValueSubject","derivedState$","derivedStateOrPromise","derivedState","storeValue","derived","DefaultDerivedStateProvider","existingDerivedState","newDerivedState","buildDerivedState","BackgroundDerivedState","portSubscriptions","unsubscribe","stateSubscription","originalMessage","BackgroundDerivedStateProvider","stateProviderFactory","activeUserStateProviderFactory","singleUserStateProviderFactory","derivedStateProviderFactory","environmentServiceFactory","stateServiceFactory","secureStorageServiceFactory","memoryStorageServiceFactory","stateServiceOptions","migrationRunnerFactory","tokenServiceFactory","platformUtilsServiceFactory","platformUtilsServiceOptions","apiServiceFactory","appIdServiceFactory","apiServiceOptions","BaseEncryptedOrganizationKey","EncryptedOrganizationKey","ProviderEncryptedOrganizationKey","toData","providerKey","getProviderKey","USER_ORGANIZATION_KEYS","fromData","USER_PROVIDER_KEYS","getPrivateKey","USER_PRIVATE_KEY","fromWithUserId","encPrivateKeyString","encPrivateKey","USER_PUBLIC_KEY","USER_KEY","CryptoService","platformUtilService","activeUserKeyState","activeUserEverHadUserKey","everHadUserKey$","activeUserEncryptedPrivateKeyState","activeUserPrivateKeyState","activeUserPrivateKey$","activeUserPublicKeyState","activeUserPublicKey$","activeUserEncryptedOrgKeysState","activeUserOrgKeysState","activeUserOrgKeys$","activeUserEncryptedProviderKeysState","activeUserProviderKeysState","activeUserProviderKeys$","storeAdditionalKeys","getKeyFromStorage","isLegacyUser","validateUserKey","clearAllStoredUserKeys","buildProtectedSymmetricKey","clearUserKey","clearStoredKeys","clearStoredUserKey","clearDeprecatedKeys","Pin","userKeyMasterKey","getOrDeriveMasterKey","clearMasterKey","encryptUserKeyWithMasterKey","decUserKey","newKey","stretchKey","hashPurpose","clearMasterKeyHash","storedPasswordHash","localKeyHash","serverKeyHash","ServerAuthorization","providerOrgs","encOrgKeyData","newSymKey","clearOrgKeys","memoryOnly","encProviderKeys","getProviderKeys","clearProviderKeys","getPublicKey","makeOrgKey","shareKey","getFingerprint","fingerprintMaterial","keyFingerprint","userFingerprint","hashPhrase","clearKeyPair","pinKey","pinProtectedUserKey","decryptMasterKeyWithPin","pinProtectedMasterKey","pinProtectedMasterKeyString","makeSendKey","keyMaterial","clearKeys","privateKeyValue","rval","range","bitsNeeded","log2","bytesNeeded","mask","byteArray","initAccount","shouldStoreKey","storePinKey","encPin","validateKdfConfig","minimumEntropy","entropyPerWord","hashArr","phrase","hashNumber","remainder","divide","encryptionKey","protectedSymKey","stretchedEncryptionKey","migrateAutoKeyIfNeeded","oldAutoKey","masterPasswordOnRestart","oldPinKey","pinProtectedKey","encBuffer","BrowserCryptoService","cryptoServiceFactory","authServiceFactory","organizationServiceFactory","policyServiceFactory","autofillSettingsServiceFactory","cipherFileUploadServiceFactory","fileUploadServiceFactory","TranslationService","systemLanguage","localesDirectory","getLocalesJson","supportedTranslationLocales","defaultLocale","localeNames","defaultMessages","localeMessages","translationLocale","Intl","Collator","numeric","sensitivity","loadMessages","p1","p2","p3","messagesObj","formattedLocale","locales","placeholders","placeProp","replaceToken","replaceContent","_locale","_translationLocale","I18nService","getMessage","i18nServiceFactory","i18nServiceOptions","SettingsService","_settings","_disableFavicon","settings$","disableFavicon$","ed","BrowserSettingsService","settingsServiceFactory","ServerConfig","serverConfigData","getAgeInMilliseconds","isValid","expiresSoon","ONE_HOUR_IN_MILLISECONDS","ConfigService","configApiService","_serverConfig","_forceFetchConfig","refreshTimer$","cloudRegion$","latestServerConfig$","delayWhen","saveConfig","catchError","getFeatureFlag$","getFeatureFlag","triggerServerConfigFetch","minimumRequiredServerVersion","configServiceFactory","configApiServiceFactory","configServiceOptions","cipherServiceFactory","searchServiceFactory","MainContextMenuHandler","initRunning","initContextMenuItems","parentId","checkPremiumAccess","noCardsContextMenuItems","noIdentitiesContextMenuItems","noLoginsContextMenuItems","serviceOptions","removeAll","contexts","menuItemId","loadOptions","optionId","sanitizedTitle","sanitizeContextMenuTitle","createChildItem","noAccess","noCards","option","noIdentities","noLogins","NOT_IMPLEMENTED","_args","LISTENED_TO_COMMANDS","CipherContextMenuHandler","mainContextMenuHandler","keyConnectorServiceOptions","mv3Create","serviceCache","cipherContextMenuHandler","activeInfo","getTab","addedTabId","removedTabId","shouldListen","activeTabs","getActiveTabs","ciphersByType","existingCiphersOfType","updateForCipher","vaultTimeoutSettingsServiceFactory","userVerificationServiceFactory","userVerificationApiServiceFactory","pinCryptoServiceFactory","eventCollectionServiceFactory","eventUploadServiceFactory","passwordGenerationServiceFactory","totpServiceFactory","AutofillPort","AutofillScript","script","properties","autosubmit","AutoFillConstants","UsernameFieldNames","TotpFieldNames","SearchFieldNames","FieldIgnoreList","PasswordFieldExcludeList","ExcludedAutofillLoginTypes","ExcludedAutofillTypes","ExcludedOverlayTypes","CreditCardAutoFillConstants","CardAttributes","CardAttributesExtended","CardHolderFieldNames","CardHolderFieldNameValues","CardNumberFieldNames","CardNumberFieldNameValues","CardExpiryFieldNames","CardExpiryFieldNameValues","ExpiryMonthFieldNames","ExpiryYearFieldNames","CVVFieldNames","CardBrandFieldNames","MonthAbbr","YearAbbrShort","YearAbbrLong","IdentityAutoFillConstants","IdentityAttributes","FullNameFieldNames","FullNameFieldNameValues","TitleFieldNames","FirstnameFieldNames","MiddlenameFieldNames","LastnameFieldNames","EmailFieldNames","AddressFieldNames","AddressFieldNameValues","Address1FieldNames","Address2FieldNames","Address3FieldNames","PostalCodeFieldNames","CityFieldNames","StateFieldNames","CountryFieldNames","PhoneFieldNames","UserNameFieldNames","CompanyFieldNames","IsoCountries","afghanistan","albania","algeria","andorra","angola","anguilla","antarctica","argentina","armenia","aruba","australia","austria","azerbaijan","bahamas","bahrain","bangladesh","barbados","belarus","belgium","belize","benin","bermuda","bhutan","bolivia","botswana","brazil","bulgaria","burundi","cambodia","cameroon","canada","chad","chile","china","colombia","comoros","congo","croatia","cuba","cyprus","denmark","djibouti","dominica","ecuador","egypt","eritrea","estonia","ethiopia","fiji","finland","france","gabon","gambia","georgia","germany","ghana","gibraltar","greece","greenland","grenada","guadeloupe","guam","guatemala","guernsey","guinea","guyana","haiti","honduras","hungary","iceland","india","indonesia","iraq","ireland","israel","italy","jamaica","japan","jersey","jordan","kazakhstan","kenya","kiribati","kuwait","kyrgyzstan","latvia","lebanon","lesotho","liberia","liechtenstein","lithuania","luxembourg","macao","macedonia","madagascar","malawi","malaysia","maldives","mali","malta","martinique","mauritania","mauritius","mayotte","mexico","moldova","monaco","mongolia","montenegro","montserrat","morocco","mozambique","myanmar","namibia","nauru","nepal","netherlands","nicaragua","niger","nigeria","niue","norway","oman","pakistan","palau","panama","paraguay","peru","philippines","pitcairn","poland","portugal","qatar","reunion","romania","rwanda","samoa","senegal","serbia","seychelles","singapore","slovakia","slovenia","somalia","spain","sudan","suriname","swaziland","sweden","switzerland","taiwan","tajikistan","tanzania","thailand","togo","tokelau","tonga","tunisia","turkey","turkmenistan","tuvalu","uganda","ukraine","uruguay","uzbekistan","vanuatu","venezuela","vietnam","yemen","zambia","zimbabwe","IsoStates","alabama","alaska","arizona","arkansas","california","colorado","connecticut","delaware","florida","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","ohio","oklahoma","oregon","pennsylvania","tennessee","texas","utah","vermont","virginia","washington","wisconsin","wyoming","IsoProvinces","alberta","manitoba","ontario","quebec","saskatchewan","AutofillService","totpService","eventCollectionService","userVerificationService","currentlyOpeningPasswordRepromptPopout","autofillScriptPortsSet","handleInjectedScriptPortConnection","handleInjectScriptPortOnDisconnect","loadAutofillScriptsOnInstall","injectAutofillScriptsInAllTabs","reloadAutofillScripts","injectAutofillScripts","triggeringOnPageLoad","injectedScripts","autoFillOnPageLoadIsEnabled","getAutofillOnPageLoad","executeScriptInTab","injectedScript","formData","passwordFields","loadPasswordFields","passwordFieldsWithoutForm","pf","form","formKeys","formCount","soloFormKey","formKey","formPasswordFields","uf","findUsernameField","getShouldAutoCopyTotp","canAccessPremium","didAutofill","pd","fillScript","generateFillScript","skipUsernameOnlyFill","onlyEmptyFields","onlyVisibleFields","tabUrl","untrustedIframe","allowUntrustedIframe","delay_between_operations","skipLastUsed","pageDetailsUrl","shouldAutoCopyTotp","Cipher_ClientAutofilled","doAutoFillOnTab","fromCommand","lastLaunchedCipher","userHasMasterPasswordAndKeyHash","isDebouncingPasswordRepromptPopout","doAutoFillActiveTab","getActiveTab","filledFields","fieldNames","hasValue","opid","viewable","isSearchField","matchingIndex","findMatchingFieldIndex","matchingField","Linked","fillByOpid","generateLoginFillScript","generateCardFillScript","generateIdentityFillScript","usernames","totps","inUntrustedIframe","passField","findTotpField","elementNumber","fieldIsFuzzyMatch","autoCompleteType","totpValue","setFillScriptForFocus","fillFields","isExcludedFieldType","isFieldMatch","makeScriptAction","selectInfo","siOptions","fieldAttrsContain","maxLength","fullMonth","fullYear","partYear","makeScriptActionWithValue","pageUrl","containsVal","doesContain","filledState","stateLower","isoState","filledCountry","countryLower","isoCountry","excludedTypes","matchFieldAttributeValues","htmlName","htmlID","placeholder","matchPattern","forCustomFieldsOnly","isExcludedType","containsOptions","checkValueContains","cipherData","dataProp","fieldProp","dataValue","doFill","checkedAttributeValues","valueIsOnExclusionList","checkedAttributeValue","canBeHidden","canBeReadOnly","mustBeEmpty","fieldHasDisqualifyingAttributeValue","isPassword","readonly","valueIsLikePassword","passwordField","withoutForm","usernameField","totpField","names","fieldPropertyIsPrefixMatch","fieldPropertyIsMatch","separator","sepIndex","fieldVal","regexParts","csvParts","csvVals","fuzzyMatch","lastField","lastPasswordField","openPasswordRepromptPopoutDebounce","autofillServiceFactory","clearClipboardAlarmName","ClearClipboard","sendTabsMessage","alarmKeys","alarmState","setAlarmTimeInternal","commandName","GeneratePasswordToClipboardCommand","passwordGenerationService","getClearClipboard","generatePasswordToClipboard","delay_ms","clearAlarmTime","setAlarmTime","AutofillTabCommand","doAutofillTabCommand","collectPageDetails","doAutofillTabWithCipherCommand","ContextMenuClickedHandler","autofillAction","autofillSettingsServiceOptions","generatePasswordToClipboardCommand","getIdentifier","isCreateCipherAction","additionalCiphersToGet","parentMenuItemId","getCipherCreationType","Cipher_ClientCopiedPassword","UpdateBadge","existingServices","listenedToCommands","badgeAction","getBrowserAction","getSidebarAction","initServices","setBadgeBackgroundColor","setLoggedOut","setLocked","setUnlocked","setBadgeIcon","clearBadgeText","setBadgeText","countText","isOperaSidebar","setActionText","setSideBarText","iconSuffix","setActionIcon","setSidebarActionIcon","setTitle","setIcon","useSyncApiCalls","lastFocusedWindow","existingServiceCache","BrowserConfigService","BrowserI18nService","BrowserMessagingPrivateModeBackgroundService","bitwardenPopupMainMessageListener","SendFile","SendText","Send","SendWithIdRequest","SendService","sendKeySalt","sendKeyPurpose","_sends","_sendViews","sends$","sendViews$","fileData","passwordKey","encryptFileData","parseFile","oldSends","newSends","oldSend","newSend","decSends","getRotatedKeys","sendKey","sendsMap","decryptSends","decryptSendPromises","decryptedSends","BrowserSendService","lockedCallback","loggedOutCallback","migrateKeyForNeverLockIfNeeded","startCheck","checkVaultTimeout","shouldLock","executeTimeoutAction","lastActive","vaultTimeoutSeconds","FeatureFlag","VaultTimeoutService","checkSafari","FilelessImportType","FilelessImportPort","FilelessImporterBackground","importService","importNotificationsPortMessageHandlers","startFilelessImport","cancelFilelessImport","lpImporterPortMessageHandlers","displayLpImportNotification","displayFilelessImportNotification","startLpImport","triggerLpImport","filelessImporterPortNames","filelessImportFeatureFlagEnabled","BrowserFilelessImport","filelessImportEnabled","handleImporterPortMessage","handleImporterPortDisconnect","lpImporterPort","importNotificationsPort","setupPortMessageListeners","triggerLpImporterCsvDownload","importErrorMessage","SessionClosedError","BrowserFido2UserInterfaceService","BrowserFido2UserInterfaceSession","sessionId","closed","messages$","messageListener$","connected$","destroy$","windowClosed$","fromEventPattern","receive","connect","closeSingleActionPopout","closeFido2Popout","complete","fallback","EmptyError","connectPromise","popoutId","openFido2Popout","Fido2Service","injectFido2ContentScripts","VaultFilter","selectedCollection","selectedFolder","myVaultOnly","refreshCollectionsAndFolders","resetFilter","selectedCollectionId","selectedFolderId","resetOrganization","selectedOrganizationId","buildFilter","cipherPassesFilter","DynamicTreeNode","hasId","fullList","collapsedGroupingsState","collapsedGroupings$","storeCollapsedFilterNodes","collapsedFilterNodes","buildCollapsedFilterNodes","buildOrganizations","buildNestedFolders","transformation","storedFolders","orgCiphers","oc","nestedFolders","getAllFoldersNested","nestedList","buildCollections","storedCollections","nestedCollections","checkForSingleOrganizationPolicy","SingleOrg","checkForPersonalOwnershipPolicy","folderCopy","getFolderNested","VaultFilterService","vaultFilter","allVaults","myVault","setVaultFilter","getVaultFilter","filterCipherForSelectedVault","CommandsBackground","vaultTimeoutService","processCommand","onCommand","autoFillLogin","openPopup","collectPageDetailsForContentScript","IdleBackground","notificationsService","idleTimer","idleState","idle","idleHandler","onStateChanged","setDetectionInterval","pollIdle","allUsers","queryState","NativeMessagingBackground","runtimeBackground","resolver","secureSetupResolve","onAdded","reloadExtension","connecting","connectedCallback","sharedSecret","validatingFingerprint","acceptButtonText","cancelButtonText","showFingerprintDialog","showWrongUserDialog","timestamp","encryptMessage","secureCommunication","getResponse","rawMessage","abs","userKeyB64","processMessage","sendUnencrypted","fingerprint","AbortManager","abortControllers","runWithAbortController","runner","RuntimeBackground","systemService","fido2Service","pageDetailsToAutoFill","onInstalledReason","lockedVaultPendingNotifications","abortManager","onInstalled","checkOnInstalled","backgroundMessageListener","popupOnlyContext","bitwardenBackgroundMessageListener","closeUnlockPopout","focusWindow","focusTab","avatarUpdateService","reseedStorage","autofillTimeout","autofillPage","vaultUrl","referrer","lastpass","resultData","authResultUrl","openSsoAuthResultPopout","twoFactorAuthData","twoFactorUrl","openTwoFactorAuthPopout","abortedRequestId","fido2ClientService","tabToAutoFill","loginToAutoFill","MainBackground","isPrivateMode","backgroundWindow","memoryStorageForStateProviders","biometricStateService","nativeMessagingBackground","syncNotifierService","policyApiService","that","backgroundMessagingService","devicesService","ssoLoginService","vaultFilterService","containerService","auditService","exportService","fido2UserInterfaceService","fido2AuthenticatorService","forceWindowReload","commandsBackground","filelessImporterBackground","tabsBackground","_tab","contextMenusBackground","idleBackground","webRequestBackground","usernameGenerationService","bootstrap","getPrivateModeWindows","onWindowCreated","forLocked","needStorageReseed","needsStorageReseed","currentUserId","override","syncInternal","lastSyncAgo","scheduleNextSync","syncTimeout","onAlarmListener","alarm","executionTime","alarmTime","getAlarmTime","combine","listeners","startingServices","listener","onCommandListener","doAutoFillLogin","doGeneratePasswordToClipboard","windowsOnFocusChangedListener","tabsOnActivatedListener","tabsOnReplacedListener","tabsOnUpdatedListener","contextMenusClickedListener","onClickedListener","runtimeMessageListener","OnInstalledReason","INSTALL","alarms","onAlarm","numberOfAlarms","calculatedWhen","periodInMinutes","when","alarmsToBeCreated","bitwardenMain","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","loaded","__webpack_modules__","O","chunkIds","fn","notFulfilled","Infinity","fulfilled","getPrototypeOf","__esModule","ns","def","current","getOwnPropertyNames","defineProperty","enumerable","chunkId","globalThis","Function","toStringTag","nmd","paths","scriptUrl","importScripts","currentScript","src","scripts","baseURI","installedChunks","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","chunkLoadingGlobal","__webpack_exports__"],"sourceRoot":""}