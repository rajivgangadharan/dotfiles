"use strict";(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[3943,4145],{35757:(t,e,s)=>{var i;s.d(e,{DY:()=>r,OL:()=>a,S9:()=>i,iW:()=>o,sY:()=>n}),function(t){t.List="list",t.Detail="detail"}(i||(i={}));const a=["tabs","sessions"],n={ERROR_STASH:"Oops, we couldn't save that session at this time.",ERROR_RESTORE:"Oops, we couldn't restore that session at this time.",ERROR_NO_OTHER_TABS:"No tabs to stash.",ERROR_DELETE:"Oops, there was a problem deleting that session.",ERROR_ALL_DELETE:"Oops, there was a problem deleting all sessions.",SUCCESSFUL_STASH_PARTIAL:" saved to a new session.",SUCCESSFUL_RESTORE_PARTIAL:" session restored.",SUCCESSFUL_ALL_DELETE:"All session deleted.",DELETE_PARTIAL:" session deleted."},r="chrome://newtab/",o="https://get.momentumdash.help/hc/en-us/articles/14474141114391"},25113:(t,e,s)=>{s.d(e,{Z:()=>n});var i=s(28149),a=s(1724);class n{constructor({key:t,tabs:e,index:s,color:n="grey",title:r="",collapsed:o=!1}){this.type=a.LL.Group,this.key=t,this.index=s,this.tabs=e.map((t=>new i.O(t))).sort(((t,e)=>t.index-e.index)),this.color=n,this.title=r,this.collapsed=o}}},9128:(t,e,s)=>{s.d(e,{z:()=>n});var i=s(70237),a=s(1724);class n{constructor({id:t,name:e,windows:s,activeWindowKey:i,browser:n,dateCreated:r}){this.windows=[],this.id=t,this.name=e,this.windows=s.map((t=>new a.Rz(t))),this.activeWindowKey=i,this.browser=n,this.dateCreated=r}get totalTabCount(){return this.windows.map((t=>t.tabCount)).reduce(((t,e)=>t+e))}get displayName(){return this.name||i.Z.getFriendlyDateTime(new Date(this.dateCreated))}get sessionDescriptionTabs(){const t=this.totalTabCount;return`${t} tab${t>1?"s":""}`}get sessionDescriptionWindows(){return`${this.windows.length} window${this.windows.length>1?"s":""}`}}},28149:(t,e,s)=>{s.d(e,{O:()=>a,c:()=>n});var i=s(1724);class a{constructor({key:t,title:e,url:s,pinned:a,index:n}){this.type=i.LL.Tab,this.key=t,this.title=e,this.url=s,this.pinned=a,this.index=n}}const n=t=>{if(void 0!==t.id&&void 0!==t.url)return{key:t.id,title:t.title||"",url:t.url,pinned:t.pinned,index:t.index,type:i.LL.Tab}}},1724:(t,e,s)=>{s.d(e,{G0:()=>d,LL:()=>i,Nw:()=>r,Rz:()=>o});var i,a=s(25113),n=s(28149);!function(t){t.Tab="Tab",t.Group="Group"}(i||(i={}));const r=["app","devtools"];class o{constructor({key:t,activeTabKey:e,state:s,type:i,left:r,top:o,width:d,height:h,browserSessionKey:w,tabsAndGroups:c}){this.tabsAndGroups=[],this.key=t,this.activeTabKey=e,this.state=s,this.type=i,this.left=r,this.top=o,this.width=d,this.height=h,w&&(this.browserSessionKey=w),this.tabsAndGroups=c.map((t=>"tabs"in t?new a.Z(t):new n.O(t))).sort(((t,e)=>t.index-e.index))}get tabCount(){let t=0;return this.tabsAndGroups.forEach((e=>{t+=e instanceof n.O?1:e.tabs.length})),t}}const d=t=>{if(void 0!==t.id&&void 0!==t.state&&void 0!==t.type&&"app"!==t.type&&"devtools"!==t.type)return{key:t.id,state:t.state,type:t.type,left:t.left||0,top:t.top||0,width:t.width||window.outerWidth,height:t.height||window.outerHeight}}},94787:(t,e,s)=>{s.d(e,{A:()=>p});var i=s(9128),a=s(1724),n=s(70237),r=s(28149),o=s(25113),d=s(77140),h=s(35757);class w{constructor(t){this.dataService=t}get(t){this.dataService.get(t)}create(t){return this.dataService.create(t.id,t)}update(t,e,s={}){return this.dataService.update(t,e,s)}delete(t){return this.dataService.delete(t)}async ensurePermissions(){return!!await d.H.permissions.contains({permissions:h.OL})||new Promise((t=>{m.cmd("modal.open","PERMISSION_REQUEST",{widgetName:"Tab Stash",permissionExplanation:"To save your tabs for later",permissions:{permissions:h.OL},resolve:t})}))}async closeWindowsAndSetSessionIds(t){var e;for(const s of t.windows)try{if(1===s.tabsAndGroups.length&&(null===(e=s.tabsAndGroups[0])||void 0===e?void 0:e.type)===a.LL.Tab&&s.tabsAndGroups[0].url===h.DY)await d.H.windows.remove(s.key);else{await d.H.windows.removeAndWaitForSessionChange(s.key);const t=await d.H.sessions.getLastClosedSessionId();t&&(s.browserSessionKey=t)}}catch(t){console.warn(t)}return t}async restoreSession(t){const e=t.windows.filter((e=>e.key!==t.activeWindowKey)),s=t.windows.filter((e=>e.key===t.activeWindowKey)),i=await d.H.tabs.query({currentWindow:!0}),a=i.find((t=>t.active));if(!a||!a.id)throw new Error("Could not find active tab id from current window");let n=a.windowId;for(const r of[...e,...s]){const e=await this.restoreWindow(r,t.browser);r.key===t.activeWindowKey&&1===i.length&&e.id&&(a.pinned&&await d.H.tabs.update(a.id,{pinned:!1}),await d.H.tabs.moveToWindow(a.id,e.id),n=e.id,a.pinned&&await d.H.tabs.update(a.id,{pinned:!0}))}await this.focusTabAndWindow(a.id,n)}async getSessionFromWindows(){var t;const e=await d.H.tabs.query({currentWindow:!0}),s=await d.H.tabs.getCurrent();let r=-1;s&&1!==e.length&&s.id&&(await this.pullTabInNewWindow(s),r=s.windowId);const o={id:n.Z.uuidv4(),name:"",windows:[],activeWindowKey:r,browser:this.getCurrentBrowserOrigin(),dateCreated:(new Date).toISOString()},h=await d.H.windows.getAll(),w=null===(t=await d.H.windows.getCurrent())||void 0===t?void 0:t.id;for(const t of h){if(w===t.id||t.type&&a.Nw.includes(t.type))continue;const e=(0,a.G0)(t);if(!e)throw new Error(`window returned by browser (${o.browser}) does not satisfy IWindow type`);const s=await this.setTabsDataForWindow(e,o.browser);o.windows.push(s)}return new i.z(o)}async openPartialSession(t){t instanceof a.Rz?await this.fallbackRestoreWindow(t,this.getCurrentBrowserOrigin()):t instanceof o.Z?await this.createGroup(t):t instanceof r.O&&await d.H.tabs.create({url:t.url,pinned:t.pinned})}async createGroup(t){const e=[];for(const s of t.tabs){const t=await d.H.tabs.create({url:s.url,pinned:s.pinned});t.id&&e.push(t.id)}void 0!==chrome.tabs.group&&await d.H.tabs.group({tabIds:e})}async pullTabInNewWindow(t){const e=t.id;if(!e)throw new Error("Could not read tab id when pulling out tab from window");const s=await d.H.windows.get(t.windowId),i={left:s.left,top:s.top,width:s.width,height:s.height};let a;if("normal"===s.state&&(a=await d.H.windows.create({tabId:e,...i})),a||(a=await d.H.windows.create({tabId:e})),!a)throw new Error("Could not create window when pulling out tab from window");t.pinned&&await d.H.tabs.update(e,{pinned:!0})}async setTabsDataForWindow(t,e){var s;const i=await d.H.tabs.query({windowId:t.key}),n=i.map((t=>{const s=(0,r.c)(t);if(!s)throw new Error(`tab returned by browser (${e})could not be converted to ITab`);return s})).sort(((t,e)=>t.index-e.index)),o=[];for(let t=0;t<n.length;t++){const e=n[t],s=i[t];if(e&&s)if(~s.groupId&&void 0!==s.groupId){const e=i.filter((t=>t.groupId===s.groupId)).length,r={key:s.groupId,index:t,type:a.LL.Group,tabs:n.slice(t,t+e)};t+=e-1,o.push(r)}else o.push(e)}return{...t,activeTabKey:(null===(s=i.find((t=>t.active)))||void 0===s?void 0:s.id)||-1,tabsAndGroups:o}}async restoreWindow(t,e){const s=t.browserSessionKey;let i;return s&&(i=await d.H.sessions.restoreWindow(s)),i||(i=await this.fallbackRestoreWindow(t,e)),i}async fallbackRestoreWindow(t,e){var s,i,n,h,w;let c;const{tabsAndGroups:p,activeTabKey:l,key:u,browserSessionKey:y,...b}=t,m=p.map((t=>t instanceof r.O?[t]:t.tabs)).flat(),g={...b};if(g.type&&a.Nw.includes(g.type)&&(g.type="normal"),g.url=this.getUrlArrayForWindowCreateFromTabs(m,e),["maximized","minimized","fullscreen"].includes(t.state)&&["width","height","left","top"].forEach((t=>delete g[t])),c=await d.H.windows.create(g),c||(["left","top"].forEach((t=>delete g[t])),c=await d.H.windows.create(g)),c||(["width","height"].forEach((t=>delete g[t])),c=await d.H.windows.create(g)),!c)throw new Error("Could not create window");if(void 0!==chrome.tabs.group)for(const t of p){if(!(t instanceof o.Z))continue;const e=t.index,i=e+t.tabs.length,a={tabIds:((null===(s=c.tabs)||void 0===s?void 0:s.slice(e,i))||[]).flatMap((t=>void 0===t.id?[]:[t.id])),createProperties:{windowId:c.id}};await d.H.tabs.group(a)}for(let t=0;t<m.length;t++){const e=m[t];if(null==e?void 0:e.pinned){const e=null===(n=null===(i=c.tabs)||void 0===i?void 0:i[t])||void 0===n?void 0:n.id;if(!e)continue;await d.H.tabs.update(e,{pinned:!0})}}const v=m.find((t=>t.key===l));if(v){const t=m.indexOf(v),e=null===(w=null===(h=c.tabs)||void 0===h?void 0:h[t])||void 0===w?void 0:w.id;e&&await d.H.tabs.update(e,{active:!0})}return c}getUrlArrayForWindowCreateFromTabs(t,e){const s=t=>t.startsWith(e+"-extension://")||t.startsWith(e+"://"),i=t.map((t=>t.url===h.DY&&n.Z.isFirefox()?"/dashboard.html":s(t.url)?t.url.replace(e,this.getCurrentBrowserOrigin()):t.url)).filter((t=>!(s(t)&&n.Z.isFirefox()||t.startsWith("about:"))));return 0===i.length&&i.push("/dashboard.html"),i}getCurrentBrowserOrigin(){return window.location.href.split("-")[0]||"chrome"}async focusTabAndWindow(t,e){t&&await d.H.tabs.update(t,{active:!0}),e&&await d.H.windows.update(e,{focused:!0})}}var c=s(34145);const p=()=>({tabStashService:new w(new c.U("tabs"))})},63943:(t,e,s)=>{s.r(e),s.d(e,{default:()=>h,makeTabsStore:()=>o,useTabsStore:()=>d});var i=s(63420),a=s(94787),n=s(9128),r=s(20144);const o=(t=(0,a.A)().tabStashService)=>(0,i.Q_)("tabs",{state:()=>({data:{},loading:!1,loaded:!1,activeItemId:""}),getters:{getItems:t=>Object.values(t.data).map((t=>new n.z(t))).sort(((t,e)=>Date.parse(e.dateCreated)-Date.parse(t.dateCreated))),getItemById:t=>e=>{const s=t.data[e];return s?new n.z(s):null}},actions:{refresh(){this.loading=!0,t.get({success:t=>{t.forEach((t=>r.ZP.set(this.data,t.id,t))),this.loaded=!0,this.loading=!1}})},async stashSession(){if(!await t.ensurePermissions())return;const e=await t.getSessionFromWindows();return 0===e.windows.length||(await this.create(e),await t.closeWindowsAndSetSessionIds(e),await this.update(e.id,{windows:e.windows})),e},async restoreSession(e){if(await t.ensurePermissions())return await t.restoreSession(e),await this.delete(e.id),!0},async create(e){r.ZP.set(this.data,e.id,e),await t.create(e)},async delete(e){r.ZP.delete(this.data,e),await t.delete(e)},async update(e,s){const i=this.data[e];if(!i)throw new Error(`No data found for ${e}`);const a={...i,...s};r.ZP.set(this.data,e,a);const n=Object.keys(s).join(",");return await t.update(e,a,{queryParams:{update_mask:n}}),a}}}),d=o(),h=d},34145:(t,e,s)=>{s.d(e,{U:()=>o});var i=s(42935),a=s(24960),n=s(67652),r=s(35597);class o{constructor(t,{queryParams:e={},getResponseProperty:s,path:i="",mode:r=n.Z.Sync}={}){this.type=t,this.queryParams=e,this.getResponseProperty=s,this.path=i,this.mode=r,this.dataSync=a.Z}get({id:t,path:e=this.path||this.type,mode:s=this.mode,success:i,failure:a,queryParams:o={},retry:d,responseProperty:h=this.getResponseProperty,appendIdToPath:w,timestampKey:c=this.type}){(async()=>{var p;s===n.Z.Timestamp&&(s=await r.Z.requiresSync(c)?n.Z.Sync:n.Z.Cache,r.Z.addUpdateListener(c,this.refresh.bind(this,{id:t,path:e,queryParams:o,retry:d,responseProperty:h,appendIdToPath:w,timestampKey:c}))),e+=this.buildQueryString((null===(p=this.queryParams)||void 0===p?void 0:p.get)||{},o);const l=[this.type,{id:t,path:e,env:this.getEnv(),mode:s,retry:d,responseProperty:h,appendIdToPath:w,timestampKey:c}];s===n.Z.Server?this.dataSync.sendMessage({handler:"get",args:l}).then(i).catch(a):this.dataSync.sendRecurringCrossTabMessage({msgId:`${this.type}${t?`:${t}`:""}:refreshed`,handler:"get",args:l,success:i,failure:a})})()}refresh({id:t,path:e=this.path||this.type,queryParams:s={},retry:i,responseProperty:a=this.getResponseProperty,appendIdToPath:r,timestampKey:o=this.type}={}){return new Promise(((d,h)=>this.get({id:t,mode:n.Z.Server,path:e,queryParams:s,retry:i,success:d,failure:h,responseProperty:a,appendIdToPath:r,timestampKey:o})))}async create(t,e,{path:s=this.path||this.type,mode:i=this.mode}={}){const a=[this.type,t,e];a.push({path:s,mode:i,env:this.getEnv()}),await this.dataSync.sendMessage({handler:"create",args:a})}async update(t,e,{path:s=this.path||this.type,mode:i=this.mode,queryParams:a={},appendIdToPath:n}={}){var r;const o=this.buildQueryString((null===(r=this.queryParams)||void 0===r?void 0:r.update)||{},a),d=[this.type,t,e];d.push({path:s,mode:i,env:this.getEnv(),queryString:o,appendIdToPath:n}),await this.dataSync.sendMessage({handler:"update",args:d})}async delete(t,{path:e=this.path||this.type,mode:s=this.mode}={}){const i=[this.type,t];i.push({path:e,mode:s,env:this.getEnv()}),await this.dataSync.sendMessage({handler:"delete",args:i})}getEnv(){return{token:localStorage.getItem("token"),clientUuid:localStorage.getItem("client_uuid"),apiUrl:m.globals.urlRootApi,version:m.globals.version,tabId:i.Z}}buildQueryString(...t){const e=t.reduce(((t,e)=>({...e,...t})),{}),s=new URLSearchParams(e).toString();return s?"?"+s:""}}},67652:(t,e,s)=>{var i;s.d(e,{Z:()=>a}),function(t){t.Sync="sync",t.Cache="cache",t.Server="server",t.Timestamp="timestamp"}(i||(i={}));const a=i}}]);