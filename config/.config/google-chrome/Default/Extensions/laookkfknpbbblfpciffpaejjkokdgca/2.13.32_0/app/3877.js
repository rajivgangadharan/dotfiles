(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[3877],{26011:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var o=a(8081),i=a.n(o),n=a(23645),s=a.n(n)()(i());s.push([e.id,".one-time-login[data-v-eb2f9a8a]{display:flex;position:absolute;z-index:20;flex-direction:column;align-items:center;padding-top:22vh;background:hsl(0deg 0% 0%/var(--opacity-stop-5));-webkit-backdrop-filter:blur(0.125rem);backdrop-filter:blur(0.125rem);inset:0}.one-time-login .content[data-v-eb2f9a8a]{max-width:31rem;display:flex;flex-direction:column;align-items:center;gap:.9375rem}.one-time-login .content h2[data-v-eb2f9a8a]{font-size:2.25rem;font-weight:500;text-align:center}.one-time-login .content p[data-v-eb2f9a8a]{margin:0;padding:0;color:var(--color-stop-6);font-size:1.5rem;font-weight:500;text-align:center}.one-time-login .content .actions[data-v-eb2f9a8a]{display:flex;flex-direction:column;align-items:center;padding-top:1.4375rem;gap:.9375rem}.one-time-login .content .actions.horizontal[data-v-eb2f9a8a]{flex-direction:row}.one-time-login .content .sub-actions[data-v-eb2f9a8a]{display:flex;padding-top:1.5rem;gap:.9375rem}.one-time-login .content .sub-actions a[data-v-eb2f9a8a],.one-time-login .content .sub-actions button[data-v-eb2f9a8a]{margin:0;padding:0;border:none;background:none;color:var(--color-stop-5);font-size:.875rem;cursor:pointer}.one-time-login .content .sub-actions a[data-v-eb2f9a8a]:hover,.one-time-login .content .sub-actions button[data-v-eb2f9a8a]:hover{text-decoration:underline}.one-time-login .content .sub-actions a[data-v-eb2f9a8a]:hover:active,.one-time-login .content .sub-actions button[data-v-eb2f9a8a]:hover:active{color:var(--color-stop-4)}",""]);const r=s},78871:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var o=a(35174),i=a(36664);const n=new class{constructor(){this.oneTimeLoginInProgress=!1}startOneTimeLogin(){var e;this.oneTimeLoginInProgress=!0;const t=Date.now(),a=Number(null!==(e=localStorage.getItem("oneTimeLoginStarted"))&&void 0!==e?e:0);if(a&&a>t-1e4)throw new Error("Another login is currently being processed.");localStorage.setItem("oneTimeLoginStarted",String(t))}finalizeOneTimeLogin(){this.oneTimeLoginInProgress=!1}async loginWithOneTimeLoginResponse(e){try{await i.Z.onSuccessfulAuthResponse(e,{keepPreviousUserData:!!e.legacy,migrateLegacy:!!e.legacy})}catch(e){throw await chrome.runtime.sendMessage({type:"oneTimeLogin:response",payload:{success:!1,errorMessage:e}}),e}finally{localStorage.removeItem("oneTimeLoginStarted")}}async redeemOnetimePassword(e){const{otp:t,otpUuid:a,email:i,...n}=e,s={type:"oneTimeLogin",payload:{otp:t,otpUuid:a,email:i},openNewTab:!0,updateSenderTab:!1};return{...(await o.Z.post("user/authenticate",s)).data,...n,email:i}}}},73877:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var o=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"one-time-login app reset-app-styles dark",attrs:{"data-test":"one-time-login"}},[t("transition",{attrs:{name:"fade",mode:"out-in",duration:350}},[t("div",{key:e.activeSubStep,staticClass:"content",attrs:{"data-test":e.activeSubStep}},[e.activeSubStep===e.OneTimeLoginState.PROCESSING?[t("h2",[e._v("Logging you in to Momentumâ€¦")])]:e.activeSubStep===e.OneTimeLoginState.UNSAVED_DATA?[t("h2",[e._v("Unsaved data found")]),e._v(" "),t("p",[e._v("Create an account to save your data.")]),e._v(" "),t("div",{staticClass:"actions"},[t("button",{staticClass:"dash-button dash-button-primary",attrs:{"data-test":"register"},on:{click:e.goToRegistration}},[e._v("Create account and save data")]),e._v(" "),t("button",{staticClass:"dash-button",attrs:{"data-test":"proceed"},on:{click:e.oneTimeLogin}},[e._v("Continue without data")])]),e._v(" "),t("div",{staticClass:"sub-actions"},[t("button",{attrs:{"data-test":"dismiss"},on:{click:e.dismiss}},[e._v("Cancel login")]),e._v(" "),t("a",{attrs:{href:e.helpUrl}},[e._v("Help")])])]:e.activeSubStep===e.OneTimeLoginState.ERROR?[t("h2",[e._v("Oops! Something didn't work")]),e._v(" "),t("p",[e._v("If the problem persists, please contact us.")]),e._v(" "),t("div",{staticClass:"actions horizontal"},[t("button",{staticClass:"dash-button dash-button-primary",attrs:{"data-test":"dismiss"},on:{click:e.dismiss}},[e._v("Dismiss")]),e._v(" "),t("a",{staticClass:"dash-button",attrs:{href:"https://momentumdash.com/contact","data-test":"contact-us"}},[e._v("Contact us")])]),e._v(" "),t("div",{staticClass:"sub-actions"},[t("a",{attrs:{href:e.helpUrl}},[e._v("Help")])])]:e._e()],2)])],1)};o._withStripped=!0;var i=a(20144),n=a(7887),s=a(78871),r=a(35174),c=a(70237);const l=new m.Analytics({feature:"one-time-login"}),d=(0,i.aZ)({name:"OneTimeLogin",props:{subSteps:{type:Array,required:!0},activeSubStepIndex:{type:Number,required:!0},otlParams:{type:Object,default:void 0}},emits:["goToSubStep","dismiss","stepComplete"],setup:()=>({OneTimeLoginState:n.w,oneTimeLoginData:void 0,helpUrl:"https://get.momentumdash.help/hc/en-us/articles/19764520037143"}),computed:{activeSubStep(){var e,t;return null!==(t=null===(e=this.subSteps[this.activeSubStepIndex])||void 0===e?void 0:e.name)&&void 0!==t?t:n.w.ERROR}},async mounted(){var e;await this.redeemOneTimePassword();const t=c.Z.userIsLegacyUnregistered()||!!localStorage.getItem("unregistered"),a=null===(e=this.oneTimeLoginData)||void 0===e?void 0:e.legacy;!t||a?await this.oneTimeLogin():this.setSubStep(n.w.UNSAVED_DATA)},methods:{setSubStep(e){const t=this.subSteps.findIndex((t=>t.name===e));-1!==t&&this.$emit("goToSubStep",t)},dismiss(){this.$emit("dismiss")},complete(){this.$emit("stepComplete")},displayErrorSubStep(e){let t="string"==typeof e?e:"unknown error";e instanceof Error&&(null==e?void 0:e.message)&&(t=e.message);const a=(0,r.y)(e,{default:t});console.error(a),l.capture("one time login error",{message:a.message}),this.setSubStep(n.w.ERROR)},goToRegistration(){m.cmd("modal.open","LOGIN",{force:!0})},async redeemOneTimePassword(){try{if(!this.otlParams)return this.displayErrorSubStep("no otl params defined");l.capture("one time password redeemed"),this.setSubStep(n.w.PROCESSING),s.Z.startOneTimeLogin(),this.oneTimeLoginData=await s.Z.redeemOnetimePassword(this.otlParams)}catch(e){this.displayErrorSubStep(e)}},async oneTimeLogin(){try{if(!this.oneTimeLoginData)return this.displayErrorSubStep("no one time login data");l.capture("one time login activated"),this.setSubStep(n.w.PROCESSING),await s.Z.loginWithOneTimeLoginResponse(this.oneTimeLoginData),s.Z.finalizeOneTimeLogin(),this.complete()}catch(e){this.displayErrorSubStep(e)}}}});a(69792);const u=(0,a(51900).Z)(d,o,[],!1,null,"eb2f9a8a",null).exports},69792:(e,t,a)=>{var o=a(26011);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals),(0,a(45346).Z)("08cdb1fc",o,!1,{})}}]);