"use strict";(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[8610],{28610:(t,e,i)=>{i.r(e),i.d(e,{default:()=>g});var s=i(83578),o=i(2770);const a=s.Z.extend({name:"FocusModel",mixins:[o.Z],data:()=>({id:null,archived:!1,completed:!1,createdDate:m.now(),focus:null,forDate:null,todoId:null,props:["focus","completed","archived","forDate","createdDate","todoId"]}),methods:{updateData(t){o.Z.methods.updateData.call(this,t),this.completed=!!t.completed}}});var d=i(94234),n=i(20144),c=i(40531);const r=new(n.ZP.extend({name:"AutoFocusManager",data:()=>({activeFocus:null,loaded:!1,loading:!1}),computed:{autoFocusEnabled:()=>c.ax.autoFocus&&m.conditionalFeatures.featureEnabled("pinfocus")},watch:{autoFocusEnabled:{async handler(t){t?(this.loaded||this.loading||await this.getInitialLoadedState(),this.getTopTodo().then((t=>this.activeFocus=this.createFocusFromTodo(t)))):this.activeFocus=null},immediate:!0},"activeFocus.focus"(t){this.activeFocus&&m.trigger("todo:set:title",this.activeFocus.todoId,t)}},created(){m.on("todo:globalChange",this.onTodoChange),m.on("todo:loadingStateChange",this.onLoadingStateChange),m.on("todo:activeListLoaded",this.setLoaded)},destroyed(){m.off("todo:globalChange",this.onTodoChange),m.off("todo:loadingStateChange",this.onLoadingStateChange),m.off("todo:activeListLoaded",this.setLoaded)},methods:{getInitialLoadedState(){return this.loading=!0,m.widgetManager.getWidgetAsync("todo").then((t=>{var e,i;"Done"===(null===(e=t.manager.activeProvider.selectedList())||void 0===e||null===(i=e.itemCollection)||void 0===i?void 0:i.listStatus)&&this.setLoaded()}))},setLoaded(){this.loading=!1,this.loaded=!0},toggleComplete(){this.activeFocus&&(this.activeFocus.completed=!this.activeFocus.completed,m.trigger("todo:set:done",this.activeFocus.todoId,this.activeFocus.completed))},onLoadingStateChange(){this.autoFocusEnabled&&this.getTopTodo().then((t=>{var e;!t||this.activeFocus&&(t.get("id")||t.id)===this.activeFocus.todoId?t||null!==(e=this.activeFocus)&&void 0!==e&&e.completed||(this.activeFocus=null):this.activeFocus=this.createFocusFromTodo(t)}))},getTopTodo:()=>m.widgetManager.getWidgetAsync("todo").then((t=>t.getTopTodo())),onTodoChange(...t){var e,i,s;const o=t[0];if(t.find((t=>t&&(t.ignoreRender||t.silent)))||!this.autoFocusEnabled||null==o||!o.changed||!Object.keys(o.changed).length||!1===(null===(e=o.changed)||void 0===e?void 0:e.isLoading))return;const a=(null===(i=o.changed)||void 0===i?void 0:i.completedDate)||(null===(s=o.changed)||void 0===s?void 0:s.modifiedServer);this.getTopTodo().then((t=>{var e,i;t?this.activeFocus=this.createFocusFromTodo(t):null!==(e=this.activeFocus)&&void 0!==e&&e.todoId&&(o.get("id")||o.id).includes(null===(i=this.activeFocus)||void 0===i?void 0:i.todoId)&&(this.activeFocus.completed=o.get("done"),a||(this.activeFocus=null))}))},createFocusFromTodo(t){if(!t)return null;let e=new a;return e.updateData({focus:t.get("title"),archived:!1,completed:t.get("done"),createdDate:m.now(),id:m.utils.uuidv4(),todoId:t.get("id")||t.id,forDate:m.utils.getDateString()}),e}}}));var h=i(81405),l=i(34145),u=i(67652);class p{constructor(t){this.dataService=t}get(t){this.dataService.get(t)}add(t,e){return this.dataService.create(t,e)}update(t,e){return this.dataService.update(t,e)}delete(t){return this.dataService.delete(t)}}var v=i(70237);const g=new(s.Z.extend({name:"FocusCollection",mixins:[d.FZ,d.mX],unreactive:()=>({type:"focus",Model:a,dataService:new p(new l.U("focus",{mode:v.Z.userIsLegacyUnregistered()?u.Z.Cache:u.Z.Timestamp})),newModel:null,analytics:new h.ZP({feature:"focus"})}),computed:{emptyFocus(){return!this.activeFocus.focus},activeFocusInCollection(){const t=v.Z.getDateString(),e=Object.values(this.data.items).filter((e=>!e.archived&&e.forDate===t)).sort(((t,e)=>e.createdDate-t.createdDate));return e.length?e[0]:null},activeFocus(){return r.activeFocus||this.activeFocusInCollection||this.newModel},loaded(){return(!r.autoFocusEnabled||r.loaded)&&this.data.loaded}},created(){this.instantiateNewModel(),m.on("focus:pin",this.onFocusPin),m.on("todo:globalChange",this.onTodoChange),m.on("newDay",this.archiveAll)},destroyed(){m.off("focus:pin",this.onFocusPin),m.off("todo:globalChange",this.onTodoChange),m.off("newDay",this.archiveAll)},methods:{instantiateNewModel(){this.newModel=new this.Model,this.newModel.copyProperties()},async save(){const t=this.emptyFocus;r.activeFocus||this.activeFocus.editProps.focus&&await this[this.emptyFocus?"add":"update"](this.activeFocus),t&&this.instantiateNewModel(),this.analytics.capture("focus "+(t?"add":"edit"),{position:localStorage.getItem("pomodoro-showing")?"pomodoro":"default"}),this.activeFocus.commitChanges(),this.activeFocus.todoId&&m.trigger("todo:set:title",this.activeFocus.todoId,this.activeFocus.focus)},archive(){this.analytics.capture("focus clear",{completed:this.activeFocus.completed}),r.activeFocus?c.ax.autoFocus=!1:d.FZ.methods.archive.call(this,this.activeFocus)},archiveAll(){Object.values(this.data.items).forEach((t=>this.archive(t)))},toggleComplete(){const t=this.activeFocus.completed;this.analytics.capture("focus "+(t?"uncomplete":"complete"),Object.assign({position:localStorage.getItem("pomodoro-showing")?"pomodoro":"default"},t?{}:{autofocus:r.autoFocusEnabled})),r.activeFocus?r.toggleComplete():(this.activeFocus.completed=!t,this.dataService.update(this.activeFocus.id,{completed:!t}).then((()=>{this.activeFocus.todoId&&m.trigger("todo:set:done",this.activeFocus.todoId,!t)})).catch((e=>{throw this.activeFocus.completed=t,e})))},onFocusPin(t){c.ax.autoFocus=!1;let e=r.createFocusFromTodo(t);e&&e.focus&&(e.copyProperties(),this.add(e))},onTodoChange(...t){var e,i;const s=t[0];if(t.find((t=>t&&(t.ignoreRender||t.silent)))||!this.activeFocus||!Object.keys(this.data.items).length||null==s||!s.changed)return;let o=Object.values(this.data.items).find((t=>{var e;return t.todoId&&t.todoId===((null===(e=s.get)||void 0===e?void 0:e.call(s,"id"))||(null==s?void 0:s.id))}));if(!o)return;if(null!==(e=t[0])&&void 0!==e&&null!==(i=e.changed)&&void 0!==i&&i.deleted)return void this.archive();const a=s.get("done"),d=s.get("title");o.completed===a&&o.focus===d||(o.completed=a,o.focus=d,this.dataService.update(o.id,{completed:a,focus:d}))}}}))},94234:(t,e,i)=>{i.d(e,{FZ:()=>a,Ox:()=>c,TF:()=>n,cl:()=>d,mX:()=>r});var s=i(40671),o=i(40531);const a={mixins:[i(85040).Z],data:()=>({collection:new s.F}),unreactive:()=>({type:"",Model:null,dataService:null,names:{}}),computed:{emptyMessage(){return`No ${this.nameLCP} yet`},data(){return this.collection.loaded||this.get(),this.collection},visible(){return o.Fl[this.visibleSetting]}},created(){this.dataService||console.warn('No dataService property detected, please connect a dataService property in "unreactive"'),this.$e.$on(this.type+":refresh",this.refresh),this.$e.$on("resetCollections",this.resetCollection)},destroyed(){this.$e.$off(this.type+":refresh",this.refresh),this.$e.$off("resetCollections",this.resetCollection)},methods:{get({queryParams:t,mode:e}={}){return new Promise(((i,s)=>{this.dataService.get({queryParams:t,mode:e,success:t=>{this.addItemsToCollection(t),i()},failure:t=>{console.error(t),s(t)}})}))},refresh({queryParams:t,retry:e,notifyUserOnFailure:i}={}){return this.dataService.refresh({queryParams:t,retry:e,notifyUserOnFailure:i})},addItemsToCollection(t,e=this.collection){const i=e.items,s=t.map((t=>t.id));return Object.keys(i).forEach((t=>{s.includes(t)||this.$delete(i,t)})),t.forEach((t=>{const e=t.id;let s;e in i?s=i[e]:(s=new this.Model,this.$set(i,e,s)),s.updateData(t)})),this.$set(e,"loaded",!0),t},add(t){const e=t.id=m.utils.uuidv4();this.$set(this.collection.items,e,t);const i=this.getAddRequestBody(t);return this.dataService.add(e,i).then((e=>(this.capture&&this.capture(this.fullNameLCS+" add",{context:{item:t}}),e))).catch((t=>{throw this.$delete(this.collection.items,e),t}))},update(t,e){const i=this.getUpdateRequestBody(t,e);return this.dataService.update(t.id,i).then((e=>(this.capture&&this.capture(this.fullNameLCS+" edit",{context:{item:t}}),e)))},delete(t){return this.dataService.delete(t.id).then((e=>(this.capture&&this.capture(this.fullNameLCS+" delete",{context:{item:t}}),this.$delete(this.collection.items,t.id),e)))},archive(t){return this.$set(t,"archived",!0),this.dataService.update(t.id,{archived:!0}).then((e=>(this.capture&&this.capture(this.fullNameLCS+" archive",{context:{item:t}}),e))).catch((e=>{throw this.$set(t,"archived",!1),e}))},unarchive(t){return this.$set(t,"archived",!1),this.dataService.update(t.id,{archived:!1}).then((e=>(this.capture&&this.capture(this.fullNameLCS+" unarchive",{context:{item:t}}),e))).catch((e=>{throw this.$set(t,"archived",!0),e}))},getAddRequestBody(t){const e={};return t.props.forEach((i=>{void 0!==t.editProps[i]&&(e[i]=t.editProps[i])})),e},getUpdateRequestBody(t){const e={};return t.getChanges().forEach((i=>{const s=i.split(".");1===s.length?e[i]=t.editProps[i]:2===s.length&&(e[s[1]]=t.editProps[s[0]][s[1]])})),e},resetCollection(){this.collection=new s.F}}},d={data:()=>({listPinnedValues:{}}),computed:{pinnedItems(){return this.data.loaded?Object.values(this.data.items).filter((t=>t.pinned&&!t.archived)):[]}},methods:{considerPinnedInList(t){return this.listPinnedValues[t.id]??t.pinned},sortPinned(t,e,i){const s=this.considerPinnedInList(t),o=this.considerPinnedInList(e);return s&&!o?-1:!s&&o?1:(i="function"==typeof i?i(t,e):i)||(t.id>e.id?-1:t.id<e.id?1:0)},togglePinned(t){const e=this.listPinnedValues[t.id];t.id in this.listPinnedValues||(this.listPinnedValues[t.id]=t.pinned),t.pinned=!t.pinned,this.dataService.update(t.id,{pinned:t.pinned}).then((e=>(this.capture&&this.capture(this.fullNameLCS+(t.pinned?" pin":" unpin"),{context:{item:t}}),e))).catch((()=>{t.pinned=!t.pinned,this.listPinnedValues[t.id]=e}))},clearRecentlyChangedItems(){this.listPinnedValues={}}}},n={created(){this.assignRandomItem()},watch:{"randomItem.pinned"(t){t&&this.assignRandomItem()},"randomItem.archived"(t){t&&this.assignRandomItem()},randomItem(){this.randomItem||this.assignRandomItem()},"dashItems.length"(t){t||this.assignRandomItem()},"itemsArray.length"(t,e){!e&&t&&this.assignRandomItem()}},computed:{itemsArray(){return Object.values(this.data.items)},showRandom(){return o.ax["showRandomMetric-"+this.nameCS]},randomItem(){return Object.values(this.data.items).find((t=>t.random))},dashItems(){const t=!this.randomItem||!this.showRandom&&this.pinnedItems.length?[...this.pinnedItems]:[this.randomItem,...this.pinnedItems];return this.dashSort&&t.sort(this.dashSort),t}},methods:{getRandomItem(t){const e=Object.values(t).filter((t=>!t.pinned&&!t.archived));return e[m.utils.getRandomIntBetween(0,e.length-1)]},assignRandomItem(){const t=this.$watch("data.loaded",(e=>{if(e){this.clearRandomItem();const e=this.getRandomItem(this.data.items);e&&(e.random=!0),this.$nextTick((()=>t()))}}),{immediate:!0})},clearRandomItem(){this.randomItem&&(this.randomItem.random=!1)}}},c={computed:{selectedItem(){return Object.values(this.data.items).find((t=>t.selected))}},methods:{clearSelectedItem(){this.selectedItem&&(this.selectedItem.selected=!1)}}},r={data:()=>({mockCollection:new s.F}),computed:{data(){return this.mockCollection.loaded?this.mockCollection:(this.collection.loaded||this.get(),this.collection)}},methods:{mockData(t){this.addItemsToCollection(t,this.mockCollection),this.mockCollection.loaded=!0},clearMockData(){this.mockCollection=new s.F}}}},2770:(t,e,i)=>{i.d(e,{H:()=>o,Z:()=>s});const s={data:()=>({id:"",archived:null,selected:!1,editProps:{}}),methods:{updateData(t){this.props.forEach((e=>this[e]=t[e])),t.id&&(this.id=t.id)},revertChanges(){this.editProps={}},getChanges(){const t=(t,e)=>t.getTime()===e.getTime();let e=[];return this.editProps&&this.props.forEach((i=>{if(Array.isArray(this[i])||Array.isArray(this.editProps[i]))m.utils.arraysAreEqual(this[i],this.editProps[i])||e.push(i);else if(this[i]instanceof Date&&this.editProps[i]instanceof Date)t(this[i],this.editProps[i])||e.push(i);else if("object"==typeof this.editProps[i]&&null!==this.editProps[i])for(let s in this.editProps[i]){let o,a=this[i][s],d=this.editProps[i][s];o=a instanceof Date&&d instanceof Date?!t(a,d):a!==d,o&&e.push(`${i}.${s}`)}else this[i]!==this.editProps[i]&&e.push(i)})),e},commitChanges(){this.beforeCommitChanges&&this.beforeCommitChanges(),this.props.forEach((t=>{void 0!==this.editProps[t]&&(this[t]=this.editProps[t])})),this.revertChanges()},copyProperties(){for(let t of this.props)Array.isArray(this[t])?this.$set(this.editProps,t,[...this[t]]):"object"==typeof this[t]&&null!==this[t]?this.$set(this.editProps,t,{...this[t]}):this.$set(this.editProps,t,this[t])}}},o={maxCharPerLine:14,computed:{brokenName(){return m.utils.lineBreakString(m.utils.removeTags(this.name),this.$options.maxCharPerLine)}}}},85040:(t,e,i)=>{i.d(e,{Z:()=>o});var s=i(25786);const o={unreactive:()=>({names:{}}),computed:{nameLCP(){return this.names.lowerCasePlural||this.type.replace(/([A-Z])/g," $1").trim().toLowerCase()},nameLCS(){return this.names.lowerCaseSingular||(0,s.singularize)(this.nameLCP)},nameCP(){return this.names.capitalizedPlural||m.utils.capitalizeWords(this.nameLCP)},nameCS(){return this.names.capitalizedSingular||m.utils.capitalizeWords(this.nameLCS)},fullNameLCP(){return this.names.fullLowerCasePlural||this.nameLCP},fullNameLCS(){return this.names.fullLowerCaseSingular||(0,s.singularize)(this.fullNameLCP)},fullNameCP(){return this.names.fullCapitalizedPlural||m.utils.capitalizeWords(this.fullNameLCP)},fullNameCS(){return this.names.fullCapitalizedSingular||m.utils.capitalizeWords(this.fullNameLCS)}}}},40671:(t,e,i)=>{i.d(e,{F:()=>o});var s=i(83578);function o(){return new s.Z.observable({loaded:!1,items:{}})}}}]);